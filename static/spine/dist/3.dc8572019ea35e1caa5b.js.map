{"version":3,"file":"3.dc8572019ea35e1caa5b.js","mappings":"4GA8BQ,MAAeA,EACXC,OAEV,WAAAC,CAAaC,GACZC,KAAKH,OAASE,CACf,CAEA,QAAAE,GACC,OAAOD,KAAKH,MACb,CAMO,uBAAOK,CAAkBC,GAC/B,OAAQA,EAAKC,eACZ,IAAK,UAAW,OAAOC,EAAcC,QACrC,IAAK,SAAU,OAAOD,EAAcE,OACpC,IAAK,SAAU,OAAOF,EAAcG,OACpC,IAAK,uBAAwB,OAAOH,EAAcI,qBAClD,IAAK,sBAAuB,OAAOJ,EAAcK,oBACjD,IAAK,sBAAuB,OAAOL,EAAcM,oBACjD,IAAK,qBAAsB,OAAON,EAAcO,mBAChD,QAAS,MAAM,IAAIC,MAAM,0BAA0BV,KAErD,CAEO,qBAAOW,CAAgBX,GAC7B,OAAQA,EAAKC,eACZ,IAAK,iBAAkB,OAAOW,EAAYC,eAC1C,IAAK,cAAe,OAAOD,EAAYE,YACvC,IAAK,SAAU,OAAOF,EAAYG,OAClC,QAAS,MAAM,IAAIL,MAAM,wBAAwBV,KAEnD,EAGD,IAAYE,EAUAU,EC9CAI,EC0DAC,ECZAC,EAOAC,EAOAC,EC4CAC,EA4BAC,EAIAC,GJpGZ,SAAYrB,GACX,4BACA,0BACA,0BACA,sDACA,oDACA,oDACA,iDACA,CARD,CAAYA,IAAAA,EAAa,KAUzB,SAAYU,GACX,2CACA,qCACA,0BACA,CAJD,CAAYA,IAAAA,EAAW,KAMhB,MAAMY,EACZC,aACAC,EAAI,EAAGC,EAAI,EACXC,GAAK,EAAGC,GAAK,EACbC,MAAQ,EAAGC,OAAS,EACpBC,QAAS,EACTC,QAAU,EAAGC,QAAU,EACvBC,cAAgB,EAAGC,eAAiB,EAG9B,MAAMC,UAAoB5C,EAChC,UAAA6C,CAAWC,EAA0BC,GAA4B,CACjE,QAAAC,CAASC,EAAoBC,GAAsB,CACnD,OAAAC,GAAY,EKhEN,MAAMC,EACZC,MAAQ,IAAIC,MACZC,QAAU,IAAID,MAEd,WAAApD,CAAasD,EAAmBC,GAC/BrD,KAAKsD,KAAKF,EAAWC,EACtB,CAEQ,IAAAC,CAAMF,EAAmBC,GAChC,GAAqB,MAAjBA,EACH,MAAM,IAAIxC,MAAM,iCAEjB,IAAI0C,EAAS,IAAIC,EAAmBJ,GAChCK,EAAQ,IAAIP,MAAc,GAC1BQ,EAAwB,KAC5B,OAAa,CACZ,IAAIC,EAAOJ,EAAOK,WAClB,GAAY,MAARD,EACH,MAED,GADAA,EAAOA,EAAKE,OACO,GAAfF,EAAKG,OACRJ,EAAO,UACH,GAAKA,EA+BH,CACN,IAAIK,EAA4B,IAAIC,EACpCD,EAAOE,KAAON,EACdI,EAAOL,KAAOA,EAEd,IAAIQ,EAAcX,EAAOY,YACc,QAAnCD,EAAYE,oBACfL,EAAOM,QAAU,GAC4B,SAAnCH,EAAYE,oBACtBL,EAAOM,QAAU,EAEjBN,EAAOM,QAAUC,WAAWJ,GAE7BH,EAAO5B,OAA2B,IAAlB4B,EAAOM,QAEvBd,EAAOgB,UAAUd,GACjB,IAAIe,EAAIC,SAAShB,EAAM,IACnBiB,EAAID,SAAShB,EAAM,IAEvBF,EAAOgB,UAAUd,GACjB,IAAIxB,EAAQwC,SAAShB,EAAM,IACvBvB,EAASuC,SAAShB,EAAM,IAE5BM,EAAOlC,EAAI2C,EAAId,EAAKzB,MACpB8B,EAAOjC,EAAI4C,EAAIhB,EAAKxB,OAChB6B,EAAO5B,QACV4B,EAAOhC,IAAMyC,EAAItC,GAAUwB,EAAKzB,MAChC8B,EAAO/B,IAAM0C,EAAIzC,GAASyB,EAAKxB,SAE/B6B,EAAOhC,IAAMyC,EAAIvC,GAASyB,EAAKzB,MAC/B8B,EAAO/B,IAAM0C,EAAIxC,GAAUwB,EAAKxB,QAEjC6B,EAAOS,EAAIA,EACXT,EAAOW,EAAIA,EACXX,EAAO9B,MAAQ0C,KAAKC,IAAI3C,GACxB8B,EAAO7B,OAASyC,KAAKC,IAAI1C,GAEM,GAA3BqB,EAAOgB,UAAUd,IAEW,GAA3BF,EAAOgB,UAAUd,IAEpBF,EAAOgB,UAAUd,GAInBM,EAAOzB,cAAgBmC,SAAShB,EAAM,IACtCM,EAAOxB,eAAiBkC,SAAShB,EAAM,IAEvCF,EAAOgB,UAAUd,GACjBM,EAAO3B,QAAUqC,SAAShB,EAAM,IAChCM,EAAO1B,QAAUoC,SAAShB,EAAM,IAEhCM,EAAOc,MAAQJ,SAASlB,EAAOY,aAE/BJ,EAAOe,QAAUpB,EAAKoB,QACtB9E,KAAKmD,QAAQ4B,KAAKhB,EACnB,KAvFgB,CACfL,EAAO,IAAIsB,EACXtB,EAAKO,KAAON,EAEmB,GAA3BJ,EAAOgB,UAAUd,KACpBC,EAAKzB,MAAQwC,SAAShB,EAAM,IAC5BC,EAAKxB,OAASuC,SAAShB,EAAM,IAC7BF,EAAOgB,UAAUd,IAIlBF,EAAOgB,UAAUd,GACjBC,EAAKhB,UAAY9C,EAAQM,iBAAiBuD,EAAM,IAChDC,EAAKf,UAAY/C,EAAQM,iBAAiBuD,EAAM,IAEhD,IAAIwB,EAAW1B,EAAOY,YACtBT,EAAKb,MAAQ9B,EAAYE,YACzByC,EAAKZ,MAAQ/B,EAAYE,YACR,KAAbgE,EACHvB,EAAKb,MAAQ9B,EAAYG,OACJ,KAAb+D,EACRvB,EAAKZ,MAAQ/B,EAAYG,OACJ,MAAb+D,IACRvB,EAAKb,MAAQa,EAAKZ,MAAQ/B,EAAYG,QAEvCwC,EAAKoB,QAAUzB,EAAcM,GAC7BD,EAAKoB,QAAQrC,WAAWiB,EAAKhB,UAAWgB,EAAKf,WAC7Ce,EAAKoB,QAAQlC,SAASc,EAAKb,MAAOa,EAAKZ,OACvCY,EAAKzB,MAAQyB,EAAKoB,QAAQ7E,WAAWgC,MACrCyB,EAAKxB,OAASwB,EAAKoB,QAAQ7E,WAAWiC,OACtClC,KAAKiD,MAAM8B,KAAKrB,EACjB,CAyDD,CACD,CAEA,UAAAwB,CAAYjB,GACX,IAAK,IAAIkB,EAAI,EAAGA,EAAInF,KAAKmD,QAAQW,OAAQqB,IACxC,GAAInF,KAAKmD,QAAQgC,GAAGlB,MAAQA,EAC3B,OAAOjE,KAAKmD,QAAQgC,GAGtB,OAAO,IACR,CAEA,OAAApC,GACC,IAAK,IAAIoC,EAAI,EAAGA,EAAInF,KAAKiD,MAAMa,OAAQqB,IACtCnF,KAAKiD,MAAMkC,GAAGL,QAAQ/B,SAExB,EAGD,MAAMS,EACL4B,MACAP,MAAgB,EAEhB,WAAA/E,CAAaK,GACZH,KAAKoF,MAAQjF,EAAKkF,MAAM,aACzB,CAEA,QAAAzB,GACC,OAAI5D,KAAK6E,OAAS7E,KAAKoF,MAAMtB,OACrB,KACD9D,KAAKoF,MAAMpF,KAAK6E,QACxB,CAEA,SAAAV,GACC,IAAIR,EAAO3D,KAAK4D,WACZ0B,EAAO3B,EAAK4B,QAAQ,KACxB,IAAc,GAAVD,EACH,MAAM,IAAIzE,MAAM,iBAAmB8C,GACpC,OAAOA,EAAK6B,UAAUF,EAAQ,GAAGzB,MAClC,CAEA,SAAAU,CAAWd,GACV,IAAIE,EAAO3D,KAAK4D,WACZ0B,EAAQ3B,EAAK4B,QAAQ,KACzB,IAAc,GAAVD,EACH,MAAM,IAAIzE,MAAM,iBAAmB8C,GACpC,IAAIwB,EAAI,EAAGM,EAAYH,EAAQ,EAC/B,KAAOH,EAAI,EAAGA,IAAK,CAClB,IAAIO,EAAQ/B,EAAK4B,QAAQ,IAAKE,GAC9B,IAAc,GAAVC,EAAa,MACjBjC,EAAM0B,GAAKxB,EAAKgC,OAAOF,EAAWC,EAAQD,GAAW5B,OACrD4B,EAAYC,EAAQ,CACrB,CAEA,OADAjC,EAAM0B,GAAKxB,EAAK6B,UAAUC,GAAW5B,OAC9BsB,EAAI,CACZ,EAGM,MAAMH,EACZf,KACAvB,UACAC,UACAE,MACAC,MACAgC,QACA7C,MACAC,OAGM,MAAM8B,UAA2BrC,EACvC+B,KACAO,KACAO,EACAE,EACAG,MAEAR,QACAS,QC1LM,MAAM,EACJc,WACAvC,cACAwC,OAAmB,CAAC,EACpBC,OAAsB,CAAC,EACvBC,OAAS,EACTC,OAAS,EACTC,YAA2B,CAAC,EAEpC,WAAAnG,CAAauD,EAAiDuC,EAAqB,IAClF5F,KAAKqD,cAAgBA,EACrBrD,KAAK4F,WAAaA,CACnB,CAEQ,UAAAM,CAAWC,GAClB,IAAIC,EAAQD,EAAKd,MAAM,KACvB,IAAK,IAAIF,EAAI,EAAGA,EAAIiB,EAAMtC,OAAQqB,IACjCiB,EAAMjB,GAAKkB,mBAAmBD,EAAMjB,IAGrC,OADOiB,EAAME,KAAK,IAEnB,CAEQ,YAAAC,CAAcC,EAAaC,EAAiCC,GACnE,GAAI1G,KAAKiG,YAAYO,GAAM,CAC1B,IAAIG,EAAO3G,KAAKiG,YAAYO,GACxBI,EAAWC,KAAKF,GAEpB,YADAF,EAAQG,EAET,CAEA,IAAIE,EAAU,IAAIC,eAClBD,EAAQE,iBAAiB,aAKzBF,EAAQG,KAAK,MAAOjH,KAAKkG,WAAWM,IAAM,GAC1CM,EAAQI,OAAS,KACM,KAAlBJ,EAAQK,OAIwB,GAA/BL,EAAQM,aAAatD,OACxB4C,EAAMI,EAAQK,OAAQL,EAAQM,cAE9BX,EAAQK,EAAQM,cAGjBV,EAAMI,EAAQK,OAAQL,EAAQM,aAC/B,EAEDN,EAAQO,QAAU,KACjBX,EAAMI,EAAQK,OAAQL,EAAQM,aAAa,EAE5CN,EAAQQ,MACT,CAEQ,mBAAAC,CAAoBC,GAG3B,IAFA,IAAIC,EAAeZ,KAAKW,GACpBE,EAAQ,IAAIC,WAAWF,EAAa3D,QAC/BqB,EAAI,EAAGA,EAAIsC,EAAa3D,OAAQqB,IACxCuC,EAAMvC,GAAKsC,EAAaG,WAAWzC,GAEpC,OAAOuC,CACR,CAEQ,cAAAG,CAAgBrB,EAAaC,EAAqCC,GACzE,GAAI1G,KAAKiG,YAAYO,GAAM,CAC1B,IAAIsB,EAAS9H,KAAKiG,YAAYO,GAC1BuB,EAAa/H,KAAKuH,oBAAoBO,GAG1C,OAFAE,QAAQC,IAAIzB,EAAKsB,QACjBrB,EAAQsB,EAET,CAEA,IAAIjB,EAAU,IAAIC,eAElBD,EAAQG,KAAK,MAAOjH,KAAKkG,WAAWM,IAAM,GAC1CM,EAAQoB,aAAe,cACvBpB,EAAQI,OAAS,KACM,KAAlBJ,EAAQK,OAGa,MAApBL,EAAQqB,SACXzB,EAAMI,EAAQK,OAAQL,EAAQM,cAE9BX,EAAQ,IAAIkB,WAAWb,EAAQqB,WAIhCzB,EAAMI,EAAQK,OAAQL,EAAQqB,SAC/B,EAEDrB,EAAQO,QAAU,KACjBX,EAAMI,EAAQK,OAAQL,EAAQqB,SAAS,EAGxCrB,EAAQQ,MACT,CAEA,aAAAc,CAAcjC,EAAcQ,GAC3B3G,KAAKiG,YAAYjG,KAAK4F,WAAaO,GAAQQ,CAC5C,CAEA,UAAA0B,CAAWlC,EACVM,EAAsD,KACtDC,EAA+C,MAC/CP,EAAOnG,KAAK4F,WAAaO,EACzBnG,KAAK+F,SAEL/F,KAAK6H,eAAe1B,GAAOQ,IAC1B3G,KAAK6F,OAAOM,GAAQQ,EAChBF,GAASA,EAAQN,EAAMQ,GAC3B3G,KAAK+F,SACL/F,KAAKgG,QAAQ,IACX,CAACsC,EAAelB,KAClBpH,KAAK8F,OAAOK,GAAQ,wBAAwBA,aAAgBgB,WAAWC,IACnEV,GAAOA,EAAMP,EAAM,wBAAwBA,aAAgBgB,WAAWC,KAC1EpH,KAAK+F,SACL/F,KAAKgG,QAAQ,GAEf,CAEA,QAAAuC,CAASpC,EACRM,EAAgD,KAChDC,EAA+C,MAC/CP,EAAOnG,KAAK4F,WAAaO,EACzBnG,KAAK+F,SAEL/F,KAAKuG,aAAaJ,GAAOQ,IACxB3G,KAAK6F,OAAOM,GAAQQ,EAChBF,GAASA,EAAQN,EAAMQ,GAC3B3G,KAAK+F,SACL/F,KAAKgG,QAAQ,IACX,CAACsC,EAAelB,KAClBpH,KAAK8F,OAAOK,GAAQ,sBAAsBA,aAAgBgB,WAAWC,IACjEV,GAAOA,EAAMP,EAAM,sBAAsBA,aAAgBgB,WAAWC,KACxEpH,KAAK+F,SACL/F,KAAKgG,QAAQ,GAEf,CAEA,WAAAwC,CAAarC,EACZM,EAA2D,KAC3DC,EAA+C,MAE/C,IAAI+B,EADJtC,EAAOnG,KAAK4F,WAAaO,EAEzBnG,KAAK+F,SACL,IAAI2C,EAAM,IAAIC,MAgBd,GAfAD,EAAIE,YAAc,YAClBF,EAAIxB,OAAU2B,IACb,IAAI/D,EAAU9E,KAAKqD,cAAcqF,GACjC1I,KAAK6F,OAAO4C,GAAe3D,EAC3B9E,KAAK+F,SACL/F,KAAKgG,SACDS,GAASA,EAAQN,EAAMuC,EAAI,EAEhCA,EAAIrB,QAAWwB,IACd7I,KAAK8F,OAAOK,GAAQ,uBAAuBA,IAC3CnG,KAAK+F,SACL/F,KAAKgG,SACDU,GAAOA,EAAMP,EAAM,uBAAuBA,IAAO,EAGlDnG,KAAKiG,YAAYE,GAAO,CAC3B,IAAIQ,EAAO3G,KAAKiG,YAAYE,GAC5BuC,EAAII,IAAM,yBAA2BnC,CACtC,MACC+B,EAAII,IAAM9I,KAAKkG,WAAWC,EAM5B,CAEA,gBAAA4C,CAAkB5C,EACjBM,EAAuD,KACvDC,EAA+C,MAE/C,IAAIsC,EAAS7C,EAAK8C,YAAY,MAAQ,EAAI9C,EAAKX,UAAU,EAAGW,EAAK8C,YAAY,MAAQ,GACrF9C,EAAOnG,KAAK4F,WAAaO,EACzBnG,KAAK+F,SAEL/F,KAAKuG,aAAaJ,GAAO+C,IACxB,IAAIC,EAAmB,CAAEC,MAAO,GAC5BC,EAAa,IAAInG,MACrB,IACa,IAAIF,EAAakG,GAAY/C,IACxCkD,EAAWtE,KAAe,IAAViE,EAAe7C,EAAO6C,EAAS,IAAM7C,GACrD,IAAIpG,EAAQuJ,SAASC,cAAc,OAGnC,OAFAxJ,EAAMkC,MAAQ,GACdlC,EAAMmC,OAAS,GACR,IAAIM,EAAYzC,EAAM,GAE/B,CAAE,MAAOyJ,GACR,IAAIC,EAAKD,EAKT,OAJAxJ,KAAK8F,OAAOK,GAAQ,+BAA+BA,MAASsD,EAAGC,UAC3DhD,GAAOA,EAAMP,EAAM,+BAA+BA,MAASsD,EAAGC,WAClE1J,KAAK+F,cACL/F,KAAKgG,QAEN,CAEA,IAAK,IAAI2D,KAAaN,EAAY,CACjC,IAAIO,GAAgB,EACpB5J,KAAKwI,YAAYmB,GAAW,CAACE,EAAmB9J,KAG/C,GAFAoJ,EAAYC,QAERD,EAAYC,OAASC,EAAWvF,OACnC,GAAK8F,EAiBJ5J,KAAK8F,OAAOK,GAAQ,oCAAoC0D,eAAuB1D,IAC3EO,GAAOA,EAAMP,EAAM,oCAAoC0D,cAAsB1D,KACjFnG,KAAK+F,SACL/F,KAAKgG,cAnBL,IACC,IAAI8D,EAAQ,IAAI9G,EAAakG,GAAY/C,GACjCnG,KAAK+J,IAAc,IAAVf,EAAe7C,EAAO6C,EAAS,IAAM7C,KAEtDnG,KAAK6F,OAAOM,GAAQ2D,EAChBrD,GAASA,EAAQN,EAAM2D,GAC3B9J,KAAK+F,SACL/F,KAAKgG,QACN,CAAE,MAAOwD,GACR,IAAIC,EAAKD,EACTxJ,KAAK8F,OAAOK,GAAQ,+BAA+BA,MAASsD,EAAGC,UAC3DhD,GAAOA,EAAMP,EAAM,+BAA+BA,MAASsD,EAAGC,WAClE1J,KAAK+F,SACL/F,KAAKgG,QACN,CAOF,IACE,CAAC6D,EAAmBG,KACtBJ,GAAgB,EAChBT,EAAYC,QAERD,EAAYC,OAASC,EAAWvF,SACnC9D,KAAK8F,OAAOK,GAAQ,oCAAoC0D,eAAuB1D,IAC3EO,GAAOA,EAAMP,EAAM,oCAAoC0D,cAAsB1D,KACjFnG,KAAK+F,SACL/F,KAAKgG,SACN,GAEF,KACE,CAACsC,EAAelB,KAClBpH,KAAK8F,OAAOK,GAAQ,+BAA+BA,aAAgBgB,WAAWC,IAC1EV,GAAOA,EAAMP,EAAM,+BAA+BA,aAAgBgB,WAAWC,KACjFpH,KAAK+F,SACL/F,KAAKgG,QAAQ,GAEf,CAEA,GAAA+D,CAAK5D,GAEJ,OADAA,EAAOnG,KAAK4F,WAAaO,EAClBnG,KAAK6F,OAAOM,EACpB,CAEA,MAAA8D,CAAQ9D,GACPA,EAAOnG,KAAK4F,WAAaO,EACzB,IAAI+D,EAAQlK,KAAK6F,OAAOM,GACd+D,EAAOnH,SAAemH,EAAOnH,UACvC/C,KAAK6F,OAAOM,GAAQ,IACrB,CAEA,SAAAgE,GACC,IAAK,IAAIC,KAAOpK,KAAK6F,OAAQ,CAC5B,IAAIqE,EAAQlK,KAAK6F,OAAOuE,GACdF,EAAOnH,SAAemH,EAAOnH,SACxC,CACA/C,KAAK6F,OAAS,CAAC,CAChB,CAEA,iBAAAwE,GACC,OAAsB,GAAfrK,KAAK+F,MACb,CAEA,SAAAuE,GACC,OAAOtK,KAAK+F,MACb,CAEA,SAAAwE,GACC,OAAOvK,KAAKgG,MACb,CAEA,OAAAjD,GACC/C,KAAKmK,WACN,CAEA,SAAAK,GACC,OAAOC,OAAOC,KAAK1K,KAAK8F,QAAQhC,OAAS,CAC1C,CAEA,SAAA6G,GACC,OAAO3K,KAAK8F,MACb,CAEA,WAAA8E,GACC5K,KAAK8F,OAAS,CAAC,CAChB,GL9SD,SAAY3E,GACX,uBACA,2BACA,2BACA,sBACA,CALD,CAAYA,IAAAA,EAAS,KMCd,MAAM0J,EACLC,OACAC,GACCC,YAAc,IAAI9H,MAE1B,WAAApD,CAAYmL,EAA4DC,EAAqB,CAAEC,MAAO,SACrG,GAAIF,aAA2BG,kBAAmB,CACjD,IAAIN,EAASG,EACbjL,KAAK+K,GAA8BD,EAAOO,WAAW,SAAUH,IAAkBJ,EAAOO,WAAW,QAASH,GAC5GlL,KAAK8K,OAASA,EACdA,EAAOQ,iBAAiB,oBAAqB9B,IAExCA,GACHA,EAAE+B,gBACH,IAGDT,EAAOQ,iBAAiB,wBAAyB9B,IAChD,IAAK,IAAIrE,EAAI,EAAGqG,EAAIxL,KAAKgL,YAAYlH,OAAQqB,EAAIqG,EAAGrG,IACnDnF,KAAKgL,YAAY7F,GAAGsG,SACrB,GAEF,MACCzL,KAAK+K,GAAKE,EACVjL,KAAK8K,OAAS9K,KAAK+K,GAAGD,MAExB,CAEA,aAAAY,CAAcC,GACb3L,KAAKgL,YAAYjG,KAAK4G,EACvB,CAEA,gBAAAC,CAAiBD,GAChB,IAAI9G,EAAQ7E,KAAKgL,YAAYzF,QAAQoG,GACjC9G,GAAS,GAAG7E,KAAKgL,YAAYa,OAAOhH,EAAO,EAChD,EAGM,MAAMiH,EACZC,YAAc,EACdA,WAAa,EACbA,iBAAmB,IACnBA,2BAA6B,IAC7BA,iBAAmB,IACnBA,2BAA6B,IAC7BA,iBAAmB,IACnBA,2BAA6B,IAC7BA,iBAAmB,IAEnB,yBAAOC,CAAoBC,GAC1B,OAAOA,GACN,KAAK9K,EAAU+K,OAAQ,OAAOJ,EAAwBK,oBACtD,KAAKhL,EAAUiL,SAAU,OAAON,EAAwBO,IACxD,KAAKlL,EAAUmL,SACf,KAAKnL,EAAUoL,OAAQ,OAAOT,EAAwBK,oBACtD,QAAS,MAAM,IAAItL,MAAM,uBAAyBoL,GAEpD,CAEA,2BAAOO,CAAsBP,EAAsBQ,GAA8B,GAChF,OAAOR,GACN,KAAK9K,EAAU+K,OACf,KAAK/K,EAAUiL,SAAU,OAAOK,EAAoBX,EAAwBO,IAAMP,EAAwBY,UAC1G,KAAKvL,EAAUmL,SAAU,OAAOR,EAAwBa,UACxD,KAAKxL,EAAUoL,OAAQ,OAAOT,EAAwBO,IACtD,QAAS,MAAM,IAAIxL,MAAM,uBAAyBoL,GAEpD,EClEM,MAAMW,UAAkBhN,EACtBiN,QACA/H,QAAwB,KACxBgI,UAAY,EACZC,YAAa,EAEdhB,iDAAkD,EAEzD,WAAAjM,CAAa+M,EAA+D9M,EAAyBgN,GAAsB,GAC1HC,MAAMjN,GACNC,KAAK6M,QAAUA,aAAmBhC,EAA8BgC,EAAU,IAAIhC,EAA6BgC,GAC3G7M,KAAK+M,WAAaA,EAClB/M,KAAKyL,UACLzL,KAAK6M,QAAQnB,cAAc1L,KAC5B,CAEA,UAAAyC,CAAYC,EAA0BC,GACrC,IAAIoI,EAAK/K,KAAK6M,QAAQ9B,GACtB/K,KAAKiN,OACLlC,EAAGmC,cAAcnC,EAAGoC,WAAYpC,EAAGqC,mBAAoB1K,GACvDqI,EAAGmC,cAAcnC,EAAGoC,WAAYpC,EAAGsC,mBAAoBT,EAAUU,kBAAkB3K,GACpF,CAEA,wBAAO2K,CAAmB3K,GACzB,OAAOA,GACN,KAAKtC,EAAcG,OACnB,KAAKH,EAAcO,mBACnB,KAAKP,EAAcK,oBACnB,KAAKL,EAAcM,oBACnB,KAAKN,EAAcI,qBAClB,OAAOJ,EAAcE,OACtB,QACC,OAAOoC,EAEV,CAEA,QAAAC,CAAUC,EAAoBC,GAC7B,IAAIiI,EAAK/K,KAAK6M,QAAQ9B,GACtB/K,KAAKiN,OACLlC,EAAGmC,cAAcnC,EAAGoC,WAAYpC,EAAGwC,eAAgB1K,GACnDkI,EAAGmC,cAAcnC,EAAGoC,WAAYpC,EAAGyC,eAAgB1K,EACpD,CAEA,MAAA2K,CAAQV,GACP,IAAIhC,EAAK/K,KAAK6M,QAAQ9B,GACjB/K,KAAK8E,UACT9E,KAAK8E,QAAU9E,KAAK6M,QAAQ9B,GAAG2C,iBAEhC1N,KAAKiN,OACDL,EAAUe,0CAA0C5C,EAAG6C,YAAY7C,EAAG8C,gCAAgC,GAC1G9C,EAAG+C,WAAW/C,EAAGoC,WAAY,EAAGpC,EAAGgD,KAAMhD,EAAGgD,KAAMhD,EAAGiD,cAAehO,KAAKH,QACzEkL,EAAGmC,cAAcnC,EAAGoC,WAAYpC,EAAGsC,mBAAoBtC,EAAGkD,QAC1DlD,EAAGmC,cAAcnC,EAAGoC,WAAYpC,EAAGqC,mBAAoBL,EAAahC,EAAGmD,qBAAuBnD,EAAGkD,QACjGlD,EAAGmC,cAAcnC,EAAGoC,WAAYpC,EAAGwC,eAAgBxC,EAAGoD,eACtDpD,EAAGmC,cAAcnC,EAAGoC,WAAYpC,EAAGyC,eAAgBzC,EAAGoD,eAClDpB,GAAYhC,EAAGqD,eAAerD,EAAGoC,WACtC,CAEA,OAAA1B,GACCzL,KAAK8E,QAAU,KACf9E,KAAKyN,OAAOzN,KAAK+M,WAClB,CAEA,IAAAE,CAAMoB,EAAe,GACpB,IAAItD,EAAK/K,KAAK6M,QAAQ9B,GACtB/K,KAAK8M,UAAYuB,EACjBtD,EAAGuD,cAAcvD,EAAGwD,SAAWF,GAC/BtD,EAAGyD,YAAYzD,EAAGoC,WAAYnN,KAAK8E,QACpC,CAEA,MAAA2J,GACC,IAAI1D,EAAK/K,KAAK6M,QAAQ9B,GACtBA,EAAGuD,cAAcvD,EAAGwD,SAAWvO,KAAK8M,WACpC/B,EAAGyD,YAAYzD,EAAGoC,WAAY,KAC/B,CAEA,OAAApK,GACC/C,KAAK6M,QAAQjB,iBAAiB5L,MACrBA,KAAK6M,QAAQ9B,GACnB2D,cAAc1O,KAAK8E,QACvB,ECjFM,MAAM6J,UAAqB,EACjC,WAAA7O,CAAa+M,EAA+DjH,EAAqB,IAChGoH,OAAOjN,GACC,IAAI6M,EAAUC,EAAS9M,IAC5B6F,EACJ,ECDM,MAAMgJ,EACZC,MAAQ,IAAI3L,MAEZ,GAAA4L,CAAKC,GACJ,IAAIC,EAAWhP,KAAKgP,SAASD,GAE7B,OADA/O,KAAK6O,MAAc,EAARE,GAAqB,EAARA,GAChBC,CACT,CAEA,QAAAA,CAAUD,GACT,OAAgCE,MAAzBjP,KAAK6O,MAAc,EAARE,EACnB,CAEA,MAAA9E,CAAQ8E,GACP/O,KAAK6O,MAAc,EAARE,QAAaE,CACzB,CAEA,KAAAC,GACClP,KAAK6O,MAAM/K,OAAS,CACrB,EAWM,MAAMqL,EAQQC,EAAsBC,EAAsBC,EAAsBC,EAP/ExD,aAAe,IAAIoD,EAAM,EAAG,EAAG,EAAG,GAClCpD,WAAa,IAAIoD,EAAM,EAAG,EAAG,EAAG,GAChCpD,aAAe,IAAIoD,EAAM,EAAG,EAAG,EAAG,GAClCpD,YAAc,IAAIoD,EAAM,EAAG,EAAG,EAAG,GACjCpD,eAAiB,IAAIoD,EAAM,EAAG,EAAG,EAAG,GACpCpD,cAAgB,IAAIoD,EAAM,EAAG,GAAK,GAAK,GAE9C,WAAArP,CAAoBsP,EAAY,EAAUC,EAAY,EAAUC,EAAY,EAAUC,EAAY,GAA9E,KAAAH,EAAAA,EAAsB,KAAAC,EAAAA,EAAsB,KAAAC,EAAAA,EAAsB,KAAAC,EAAAA,CACtF,CAEA,GAAAC,CAAKJ,EAAWC,EAAWC,EAAWC,GAMrC,OALAvP,KAAKoP,EAAIA,EACTpP,KAAKqP,EAAIA,EACTrP,KAAKsP,EAAIA,EACTtP,KAAKuP,EAAIA,EACTvP,KAAKyP,QACEzP,IACR,CAEA,YAAA0P,CAAcC,GAKb,OAJA3P,KAAKoP,EAAIO,EAAEP,EACXpP,KAAKqP,EAAIM,EAAEN,EACXrP,KAAKsP,EAAIK,EAAEL,EACXtP,KAAKuP,EAAII,EAAEJ,EACJvP,IACR,CAEA,aAAA4P,CAAeC,GAMd,OALAA,EAAuB,KAAjBA,EAAIC,OAAO,GAAYD,EAAIlK,OAAO,GAAKkK,EAC7C7P,KAAKoP,EAAI3K,SAASoL,EAAIlK,OAAO,EAAG,GAAI,IAAM,IAC1C3F,KAAKqP,EAAI5K,SAASoL,EAAIlK,OAAO,EAAG,GAAI,IAAM,IAC1C3F,KAAKsP,EAAI7K,SAASoL,EAAIlK,OAAO,EAAG,GAAI,IAAM,IAC1C3F,KAAKuP,GAAmB,GAAdM,EAAI/L,OAAc,IAAMW,SAASoL,EAAIlK,OAAO,EAAG,GAAI,KAAO,IAC7D3F,IACR,CAEA,GAAA8O,CAAKM,EAAWC,EAAWC,EAAWC,GAMrC,OALAvP,KAAKoP,GAAKA,EACVpP,KAAKqP,GAAKA,EACVrP,KAAKsP,GAAKA,EACVtP,KAAKuP,GAAKA,EACVvP,KAAKyP,QACEzP,IACR,CAEA,KAAAyP,GAYC,OAXIzP,KAAKoP,EAAI,EAAGpP,KAAKoP,EAAI,EAChBpP,KAAKoP,EAAI,IAAGpP,KAAKoP,EAAI,GAE1BpP,KAAKqP,EAAI,EAAGrP,KAAKqP,EAAI,EAChBrP,KAAKqP,EAAI,IAAGrP,KAAKqP,EAAI,GAE1BrP,KAAKsP,EAAI,EAAGtP,KAAKsP,EAAI,EAChBtP,KAAKsP,EAAI,IAAGtP,KAAKsP,EAAI,GAE1BtP,KAAKuP,EAAI,EAAGvP,KAAKuP,EAAI,EAChBvP,KAAKuP,EAAI,IAAGvP,KAAKuP,EAAI,GACvBvP,IACR,CAEA,sBAAO+P,CAAgBC,EAAcjB,GACpCiB,EAAMZ,IAAc,WAARL,KAAwB,IAAM,IAC1CiB,EAAMX,IAAc,SAARN,KAAwB,IAAM,IAC1CiB,EAAMV,IAAc,MAARP,KAAwB,GAAK,IACzCiB,EAAMT,GAAc,IAARR,GAAuB,GACpC,CAEA,oBAAOkB,CAAeD,EAAcjB,GACnCiB,EAAMZ,IAAc,SAARL,KAAwB,IAAM,IAC1CiB,EAAMX,IAAc,MAARN,KAAwB,GAAK,IACzCiB,EAAMV,GAAc,IAARP,GAAuB,GACpC,EAGM,MAAMmB,EACZnE,UAAY,UACZA,WAA4B,EAAfmE,EAAUC,GACvBpE,wBAA0B,IAAMmE,EAAUC,GAC1CpE,cAAgBmE,EAAUE,iBAC1BrE,wBAA0BmE,EAAUC,GAAK,IACzCpE,cAAgBmE,EAAUG,iBAE1B,YAAOZ,CAAOV,EAAeuB,EAAaC,GACzC,OAAIxB,EAAQuB,EAAYA,EACpBvB,EAAQwB,EAAYA,EACjBxB,CACR,CAEA,aAAOyB,CAAQnM,GACd,OAAOM,KAAK8L,IAAIpM,EAAU6L,EAAUQ,OACrC,CAEA,aAAOC,CAAQtM,GACd,OAAOM,KAAKiM,IAAIvM,EAAU6L,EAAUQ,OACrC,CAEA,aAAOG,CAAQ9B,GACd,OAAOA,EAAQ,EAAI,EAAIA,EAAQ,GAAK,EAAI,CACzC,CAEA,YAAO+B,CAAOtM,GACb,OAAOA,EAAI,EAAIG,KAAKoM,MAAMvM,GAAKG,KAAKqM,KAAKxM,EAC1C,CAEA,WAAOyM,CAAMzM,GACZ,IAAIE,EAAIC,KAAKuM,IAAIvM,KAAKC,IAAIJ,GAAI,EAAE,GAChC,OAAOA,EAAI,GAAKE,EAAIA,CACrB,CAEA,uBAAOyM,CAAkBb,EAAaC,GACrC,OAAOL,EAAUkB,qBAAqBd,EAAKC,EAAmB,IAAbD,EAAMC,GACxD,CAEA,2BAAOa,CAAsBd,EAAaC,EAAac,GACtD,IAAIxP,EAAI8C,KAAK2M,SACTC,EAAIhB,EAAMD,EACd,OAAIzO,IAAMwP,EAAOf,GAAOiB,EAAUjB,EAAM3L,KAAK6M,KAAK3P,EAAI0P,GAAKF,EAAOf,IAC3DC,EAAM5L,KAAK6M,MAAM,EAAI3P,GAAK0P,GAAKhB,EAAMc,GAC7C,EAkCM,MAAMI,EACZ1F,6BAAwD,oBAAnB,aAErC,gBAAO2F,CAAcC,EAAsBC,EAAqBC,EAAoBC,EAAmBC,GACtG,IAAK,IAAI5M,EAAIyM,EAAaI,EAAIF,EAAW3M,EAAIyM,EAAcG,EAAa5M,IAAK6M,IAC5EH,EAAKG,GAAKL,EAAOxM,EAEnB,CAEA,mBAAO8M,CAAiBpD,EAAiBqD,EAAcnD,EAAa,GACnE,IAAIoD,EAAUtD,EAAM/K,OACpB,GAAIqO,GAAWD,EAAM,OAAOrD,EAE5B,GADAA,EAAM/K,OAASoO,EACXC,EAAUD,EACb,IAAK,IAAI/M,EAAIgN,EAAShN,EAAI+M,EAAM/M,IAAK0J,EAAM1J,GAAK4J,EAEjD,OAAOF,CACR,CAEA,0BAAOuD,CAAwBvD,EAAiBqD,EAAcnD,EAAa,GAC1E,OAAIF,EAAM/K,QAAUoO,EAAarD,EAC1B4C,EAAMQ,aAAapD,EAAOqD,EAAMnD,EACxC,CAEA,eAAOsD,CAAaH,EAAcI,GACjC,IAAIzD,EAAQ,IAAI3L,MAASgP,GACzB,IAAK,IAAI/M,EAAI,EAAGA,EAAI+M,EAAM/M,IAAK0J,EAAM1J,GAAKmN,EAC1C,OAAOzD,CACR,CAEA,oBAAO0D,CAAeL,GACrB,GAAIT,EAAMe,sBACT,OAAO,IAAIC,aAAaP,GAClB,CACL,IAAIrD,EAAQ,IAAI3L,MAAcgP,GAC9B,IAAK,IAAI/M,EAAI,EAAGA,EAAI0J,EAAM/K,OAAQqB,IAAK0J,EAAM1J,GAAK,EAClD,OAAO0J,CACT,CACD,CAEA,oBAAO6D,CAAeR,GACrB,GAAIT,EAAMe,sBACT,OAAO,IAAIG,WAAWT,GAChB,CACL,IAAIrD,EAAQ,IAAI3L,MAAcgP,GAC9B,IAAK,IAAI/M,EAAI,EAAGA,EAAI0J,EAAM/K,OAAQqB,IAAK0J,EAAM1J,GAAK,EAClD,OAAO0J,CACT,CACD,CAEA,mBAAO+D,CAAc/D,GACpB,OAAO4C,EAAMe,sBAAwB,IAAIC,aAAa5D,GAASA,CAChE,CAEA,wBAAOgE,CAAmB9D,GACzB,OAAO0C,EAAMe,sBAAwB7N,KAAKmO,OAAO/D,GAASA,CAC3D,CAGA,4BAAOgE,CAAuB5H,EAAe6H,GAE7C,CAEA,eAAOhE,CAAaH,EAAiBoE,EAAYC,GAAW,GAC3D,IAAK,IAAI/N,EAAI,EAAGA,EAAI0J,EAAM/K,OAAQqB,IACjC,GAAI0J,EAAM1J,IAAM8N,EAAS,OAAO,EAEjC,OAAO,CACR,EAYM,MAAME,EACJC,MAAQ,IAAIlQ,MACZmQ,aAER,WAAAvT,CAAauT,GACZrT,KAAKqT,aAAeA,CACrB,CAEA,MAAAC,GACC,OAAOtT,KAAKoT,MAAMtP,OAAS,EAAI9D,KAAKoT,MAAMG,MAAQvT,KAAKqT,cACxD,CAEA,IAAAG,CAAMC,GACAA,EAAaC,OAAQD,EAAaC,QACvC1T,KAAKoT,MAAMrO,KAAK0O,EACjB,CAEA,OAAAE,CAASP,GACR,IAAK,IAAIjO,EAAI,EAAGA,EAAIiO,EAAMtP,OAAQqB,IAC5BiO,EAAMjO,GAAWuO,OAAQN,EAAMjO,GAAWuO,QAC/C1T,KAAKoT,MAAMjO,GAAKiO,EAAMjO,EAExB,CAEA,KAAA+J,GACClP,KAAKoT,MAAMtP,OAAS,CACrB,EAGM,MAAM8P,EACQpP,EAAcE,EAAlC,WAAA5E,CAAoB0E,EAAI,EAAUE,EAAI,GAAlB,KAAAF,EAAAA,EAAc,KAAAE,EAAAA,CAClC,CAEA,GAAA8K,CAAKhL,EAAWE,GAGf,OAFA1E,KAAKwE,EAAIA,EACTxE,KAAK0E,EAAIA,EACF1E,IACR,CAEA,MAAA8D,GACC,IAAIU,EAAIxE,KAAKwE,EACTE,EAAI1E,KAAK0E,EACb,OAAOC,KAAK6M,KAAKhN,EAAIA,EAAIE,EAAIA,EAC9B,CAEA,QAAAmP,CAASC,GACR,OAAO,IAAIF,EAAQ5T,KAAKwE,EAAIsP,EAAMtP,EAAGxE,KAAK0E,EAAIoP,EAAMpP,EACrD,CAEA,SAAAqP,GACC,IAAIC,EAAMhU,KAAK8D,SAKf,OAJW,GAAPkQ,IACHhU,KAAKwE,GAAKwP,EACVhU,KAAK0E,GAAKsP,GAEJhU,IACR,CAEA,aAAAiU,GACC,IAAID,EAAMhU,KAAK8D,SACf,OAAO,IAAI8P,EACV5T,KAAKwE,EAAIwP,EACThU,KAAK0E,EAAIsP,EAEX,CAEA,KAAAE,CAAMJ,GACL,IAAIK,EAAMnU,KAAKwE,EAAIsP,EAAMtP,EAAIxE,KAAK0E,EAAIoP,EAAMpP,EACxC0P,EAAQzP,KAAK6M,KAAKxR,KAAKwE,EAAExE,KAAKwE,EAAIxE,KAAK0E,EAAE1E,KAAK0E,GAC9C2P,EAAQ1P,KAAK6M,KAAKsC,EAAMtP,EAAEsP,EAAMtP,EAAIsP,EAAMpP,EAAEoP,EAAMpP,GACtD,OAAOC,KAAK2P,KAAKH,GAAOC,EAAMC,GAC/B,EAGM,MAAME,EACZC,SAAW,KACXC,gBAAkB,EAClBC,MAAQ,EACRC,UAAY,EAEJC,SAAWC,KAAKC,MAAQ,IACxBC,WAAa,EACbC,UAAY,EAEpB,MAAAvH,GACC,IAAIqH,EAAMD,KAAKC,MAAQ,IACvB9U,KAAK0U,MAAQI,EAAM9U,KAAK4U,SACxB5U,KAAKgV,WAAahV,KAAK0U,MACvB1U,KAAK2U,WAAa3U,KAAK0U,MACnB1U,KAAK0U,MAAQ1U,KAAKwU,WAAUxU,KAAK0U,MAAQ1U,KAAKwU,UAClDxU,KAAK4U,SAAWE,EAEhB9U,KAAK+U,aACD/U,KAAKgV,UAAY,IACpBhV,KAAKyU,gBAAkBzU,KAAK+U,WAAa/U,KAAKgV,UAC9ChV,KAAKgV,UAAY,EACjBhV,KAAK+U,WAAa,EAEpB,EC5WM,MAAeE,EACrBhR,KAEA,WAAAnE,CAAamE,GACZ,GAAY,MAARA,EAAc,MAAM,IAAIpD,MAAM,wBAClCb,KAAKiE,KAAOA,CACb,EAOM,MAAeiR,UAAyBD,EACtClJ,cAAgB,EAGxBoJ,IAAkC,MAA5BD,EAAiBE,WAAqB,GAK5CC,MAKAC,SAIAC,oBAAsB,EAGtBC,iBAAqCxV,KAErC,WAAAF,CAAamE,GACZ+I,MAAM/I,EACP,CAaA,oBAAAwR,CAAsBC,EAAYC,EAAevM,EAAewM,EAAkCC,EAAgBC,GACjH1M,EAAQyM,GAAUzM,GAAS,GAAK0M,EAChC,IAAIC,EAAWL,EAAKM,KAAKD,SACrBE,EAAcP,EAAKQ,OACnBZ,EAAWtV,KAAKsV,SAChBD,EAAQrV,KAAKqV,MACjB,GAAa,MAATA,EAAe,CACdY,EAAYnS,OAAS,IAAGwR,EAAWW,GACvC,IAAID,EAAON,EAAKM,KACZxR,EAAIwR,EAAKG,OACTzR,EAAIsR,EAAKI,OACT7G,EAAIyG,EAAKzG,EAAGD,EAAI0G,EAAK1G,EAAGK,EAAIqG,EAAKrG,EAAG4B,EAAIyE,EAAKzE,EACjD,IAAK,IAAIzP,EAAI6T,EAAOU,EAAIR,EAAQQ,EAAIjN,EAAOtH,GAAK,EAAGuU,GAAKP,EAAQ,CAC/D,IAAIQ,EAAKhB,EAASxT,GAAIyU,EAAKjB,EAASxT,EAAI,GACxC8T,EAAcS,GAAKC,EAAK/G,EAAIgH,EAAKjH,EAAI9K,EACrCoR,EAAcS,EAAI,GAAKC,EAAK3G,EAAI4G,EAAKhF,EAAI7M,CAC1C,CACA,MACD,CACA,IAAI5C,EAAI,EAAG0U,EAAO,EAClB,IAAK,IAAIrR,EAAI,EAAGA,EAAIwQ,EAAOxQ,GAAK,EAAG,CAClC,IAAIqG,EAAI6J,EAAMvT,GACdA,GAAK0J,EAAI,EACTgL,GAAQhL,CACT,CACA,IAAIiL,EAAgBV,EAASV,MAC7B,GAA0B,GAAtBY,EAAYnS,OACf,IAAK,IAAIuS,EAAIR,EAAQvG,EAAW,EAAPkH,EAAUH,EAAIjN,EAAOiN,GAAKP,EAAQ,CAC1D,IAAIY,EAAK,EAAGC,EAAK,EACbnL,EAAI6J,EAAMvT,KAEd,IADA0J,GAAK1J,EACEA,EAAI0J,EAAG1J,IAAKwN,GAAK,EAAG,CAC1B,IAAI0G,EAAOS,EAAcpB,EAAMvT,IAC3BwU,EAAKhB,EAAShG,GAAIiH,EAAKjB,EAAShG,EAAI,GAAIsH,EAAStB,EAAShG,EAAI,GAClEoH,IAAOJ,EAAKN,EAAKzG,EAAIgH,EAAKP,EAAK1G,EAAI0G,EAAKG,QAAUS,EAClDD,IAAOL,EAAKN,EAAKrG,EAAI4G,EAAKP,EAAKzE,EAAIyE,EAAKI,QAAUQ,CACnD,CACAhB,EAAcS,GAAKK,EACnBd,EAAcS,EAAI,GAAKM,CACxB,KACM,CACN,IAAIT,EAASD,EACb,IAAK,IAAII,EAAIR,EAAQvG,EAAW,EAAPkH,EAAUK,EAAIL,GAAQ,EAAGH,EAAIjN,EAAOiN,GAAKP,EAAQ,CACzE,IAAIY,EAAK,EAAGC,EAAK,EACbnL,EAAI6J,EAAMvT,KAEd,IADA0J,GAAK1J,EACEA,EAAI0J,EAAG1J,IAAKwN,GAAK,EAAGuH,GAAK,EAAG,CAClC,IAAIb,EAAOS,EAAcpB,EAAMvT,IAC3BwU,EAAKhB,EAAShG,GAAK4G,EAAOW,GAAIN,EAAKjB,EAAShG,EAAI,GAAK4G,EAAOW,EAAI,GAAID,EAAStB,EAAShG,EAAI,GAC9FoH,IAAOJ,EAAKN,EAAKzG,EAAIgH,EAAKP,EAAK1G,EAAI0G,EAAKG,QAAUS,EAClDD,IAAOL,EAAKN,EAAKrG,EAAI4G,EAAKP,EAAKzE,EAAIyE,EAAKI,QAAUQ,CACnD,CACAhB,EAAcS,GAAKK,EACnBd,EAAcS,EAAI,GAAKM,CACxB,CACD,CACD,CAGA,MAAAG,CAAQC,GACW,MAAd/W,KAAKqV,OACR0B,EAAW1B,MAAQ,IAAInS,MAAclD,KAAKqV,MAAMvR,QAChD2N,EAAMC,UAAU1R,KAAKqV,MAAO,EAAG0B,EAAW1B,MAAO,EAAGrV,KAAKqV,MAAMvR,SAE/DiT,EAAW1B,MAAQ,KAEC,MAAjBrV,KAAKsV,UACRyB,EAAWzB,SAAW7D,EAAMc,cAAcvS,KAAKsV,SAASxR,QACxD2N,EAAMC,UAAU1R,KAAKsV,SAAU,EAAGyB,EAAWzB,SAAU,EAAGtV,KAAKsV,SAASxR,SAExEiT,EAAWzB,SAAW,KAEvByB,EAAWxB,oBAAsBvV,KAAKuV,oBACtCwB,EAAWvB,iBAAmBxV,KAAKwV,gBACpC,ECxHM,MAAMwB,UAA8B9B,EAC1ClF,MAAQ,IAAIb,EAAM,EAAG,EAAG,EAAG,GAE3B,WAAArP,CAAamE,GACZ+I,MAAM/I,EACP,CAEA,IAAAgT,GACC,IAAIA,EAAO,IAAID,EAAsBhX,KAAKiE,MAG1C,OAFAjE,KAAK8W,OAAOG,GACZA,EAAKjH,MAAMN,aAAa1P,KAAKgQ,OACtBiH,CACR,EChBM,MAAMC,UAA2BhC,EAGvCiC,QAKAnH,MAAQ,IAAIb,EAAM,MAAQ,MAAQ,MAAQ,GAE1C,WAAArP,CAAamE,GACZ+I,MAAM/I,EACP,CAEA,IAAAgT,GACC,IAAIA,EAAO,IAAIC,EAAmBlX,KAAKiE,MAIvC,OAHAjE,KAAK8W,OAAOG,GACZA,EAAKE,QAAUnX,KAAKmX,QACpBF,EAAKjH,MAAMN,aAAa1P,KAAKgQ,OACtBiH,CACR,EChBM,MAAMG,UAAuBlC,EACnCnR,OAGAoC,KAGAkR,UAKAC,IAGAC,UAGAvH,MAAQ,IAAIb,EAAM,EAAG,EAAG,EAAG,GAG3BlN,MAGAC,OAGAsV,WAIAC,MAEQC,WACRC,UAAY,IAAIxI,EAAM,EAAG,EAAG,EAAG,GAE/B,WAAArP,CAAamE,GACZ+I,MAAM/I,EACP,CAIA,SAAA2T,GACC,IAAIP,EAAYrX,KAAKqX,UACL,MAAZrX,KAAKsX,KAAetX,KAAKsX,IAAIxT,QAAUuT,EAAUvT,SAAQ9D,KAAKsX,IAAM7F,EAAMc,cAAc8E,EAAUvT,SACtG,IAAIwT,EAAMtX,KAAKsX,IACX9L,EAAIxL,KAAKsX,IAAIxT,OACbjC,EAAI7B,KAAK+D,OAAOlC,EAAGC,EAAI9B,KAAK+D,OAAOjC,EAAGG,EAAQ,EAAGC,EAAS,EAC9D,GAAIlC,KAAK+D,kBAAkBC,EAAoB,CAC9C,IAAID,EAAS/D,KAAK+D,OACd8T,EAAe9T,EAAOe,QAAQ7E,WAAWgC,MAAO6V,EAAgB/T,EAAOe,QAAQ7E,WAAWiC,OAC9F,OAAO6B,EAAOM,SACd,KAAK,GACJxC,IAAMkC,EAAOxB,eAAiBwB,EAAO1B,QAAU0B,EAAO7B,QAAU2V,EAChE/V,IAAMiC,EAAOzB,cAAgByB,EAAO3B,QAAU2B,EAAO9B,OAAS6V,EAC9D7V,EAAQ8B,EAAOxB,eAAiBsV,EAChC3V,EAAS6B,EAAOzB,cAAgBwV,EAChC,IAAK,IAAI3S,EAAI,EAAGA,EAAIqG,EAAGrG,GAAK,EAC3BmS,EAAInS,GAAKtD,EAAIwV,EAAUlS,EAAI,GAAKlD,EAChCqV,EAAInS,EAAI,GAAKrD,GAAK,EAAIuV,EAAUlS,IAAMjD,EAEvC,OACD,KAAK,IACJL,IAAMkC,EAAOzB,cAAgByB,EAAO3B,QAAU2B,EAAO9B,OAAS4V,EAC9D/V,GAAKiC,EAAO1B,QAAUyV,EACtB7V,EAAQ8B,EAAOzB,cAAgBuV,EAC/B3V,EAAS6B,EAAOxB,eAAiBuV,EACjC,IAAK,IAAI3S,EAAI,EAAGA,EAAIqG,EAAGrG,GAAK,EAC3BmS,EAAInS,GAAKtD,GAAK,EAAIwV,EAAUlS,IAAMlD,EAClCqV,EAAInS,EAAI,GAAKrD,GAAK,EAAIuV,EAAUlS,EAAI,IAAMjD,EAE3C,OACD,KAAK,IACJL,GAAKkC,EAAO1B,QAAUwV,EACtB/V,GAAKiC,EAAO3B,QAAU0V,EACtB7V,EAAQ8B,EAAOxB,eAAiBsV,EAChC3V,EAAS6B,EAAOzB,cAAgBwV,EAChC,IAAK,IAAI3S,EAAI,EAAGA,EAAIqG,EAAGrG,GAAK,EAC3BmS,EAAInS,GAAKtD,GAAK,EAAIwV,EAAUlS,EAAI,IAAMlD,EACtCqV,EAAInS,EAAI,GAAKrD,EAAIuV,EAAUlS,GAAKjD,EAEjC,OAEDL,GAAKkC,EAAO3B,QAAUyV,EACtB/V,IAAMiC,EAAOxB,eAAiBwB,EAAO1B,QAAU0B,EAAO7B,QAAU4V,EAChE7V,EAAQ8B,EAAOzB,cAAgBuV,EAC/B3V,EAAS6B,EAAOxB,eAAiBuV,CAClC,MAA0B,MAAf9X,KAAK+D,QACflC,EAAIC,EAAI,EACRG,EAAQC,EAAS,IAEjBD,EAAQjC,KAAK+D,OAAOhC,GAAKF,EACzBK,EAASlC,KAAK+D,OAAO/B,GAAKF,GAG3B,IAAK,IAAIqD,EAAI,EAAGA,EAAIqG,EAAGrG,GAAK,EAC3BmS,EAAInS,GAAKtD,EAAIwV,EAAUlS,GAAKlD,EAC5BqV,EAAInS,EAAI,GAAKrD,EAAIuV,EAAUlS,EAAI,GAAKjD,CAEtC,CAKA,aAAA6V,GACC,OAAO/X,KAAK0X,UACb,CAGA,aAAAM,CAAeN,GACd1X,KAAK0X,WAAaA,EACA,MAAdA,IACH1X,KAAKqV,MAAQqC,EAAWrC,MACxBrV,KAAKsV,SAAWoC,EAAWpC,SAC3BtV,KAAKuV,oBAAsBmC,EAAWnC,oBACtCvV,KAAKqX,UAAYK,EAAWL,UAC5BrX,KAAKuX,UAAYG,EAAWH,UAC5BvX,KAAKwX,WAAaE,EAAWF,WAC7BxX,KAAKuV,oBAAsBmC,EAAWnC,oBAExC,CAEA,IAAA0B,GACC,GAAuB,MAAnBjX,KAAK0X,WAAoB,OAAO1X,KAAKiY,gBAEzC,IAAIhB,EAAO,IAAIG,EAAepX,KAAKiE,MAsBnC,OArBAgT,EAAKlT,OAAS/D,KAAK+D,OACnBkT,EAAK9Q,KAAOnG,KAAKmG,KACjB8Q,EAAKjH,MAAMN,aAAa1P,KAAKgQ,OAE7BhQ,KAAK8W,OAAOG,GACZA,EAAKI,UAAY,IAAInU,MAAclD,KAAKqX,UAAUvT,QAClD2N,EAAMC,UAAU1R,KAAKqX,UAAW,EAAGJ,EAAKI,UAAW,EAAGrX,KAAKqX,UAAUvT,QACrEmT,EAAKK,IAAM,IAAIpU,MAAclD,KAAKsX,IAAIxT,QACtC2N,EAAMC,UAAU1R,KAAKsX,IAAK,EAAGL,EAAKK,IAAK,EAAGtX,KAAKsX,IAAIxT,QACnDmT,EAAKM,UAAY,IAAIrU,MAAclD,KAAKuX,UAAUzT,QAClD2N,EAAMC,UAAU1R,KAAKuX,UAAW,EAAGN,EAAKM,UAAW,EAAGvX,KAAKuX,UAAUzT,QACrEmT,EAAKO,WAAaxX,KAAKwX,WAGL,MAAdxX,KAAKyX,QACRR,EAAKQ,MAAQ,IAAIvU,MAAclD,KAAKyX,MAAM3T,QAC1C2N,EAAMC,UAAU1R,KAAKyX,MAAO,EAAGR,EAAKQ,MAAO,EAAGzX,KAAKyX,MAAM3T,SAE1DmT,EAAKhV,MAAQjC,KAAKiC,MAClBgV,EAAK/U,OAASlC,KAAKkC,OAEZ+U,CACR,CAGA,aAAAgB,GACC,IAAIhB,EAAO,IAAIG,EAAepX,KAAKiE,MAOnC,OANAgT,EAAKlT,OAAS/D,KAAK+D,OACnBkT,EAAK9Q,KAAOnG,KAAKmG,KACjB8Q,EAAKjH,MAAMN,aAAa1P,KAAKgQ,OAC7BiH,EAAKzB,iBAAmBxV,KAAKwV,iBAC7ByB,EAAKe,cAAiC,MAAnBhY,KAAK0X,WAAqB1X,KAAK0X,WAAa1X,MAC/DiX,EAAKW,YACEX,CACR,EClKM,MAAMiB,UAAuBhD,EAGnCiD,QAGAC,QAAS,EAITC,eAAgB,EAIhBrI,MAAQ,IAAIb,EAAM,EAAG,EAAG,EAAG,GAE3B,WAAArP,CAAamE,GACZ+I,MAAM/I,EACP,CAEA,IAAAgT,GACC,IAAIA,EAAO,IAAIiB,EAAelY,KAAKiE,MAOnC,OANAjE,KAAK8W,OAAOG,GACZA,EAAKkB,QAAU,IAAIjV,MAAclD,KAAKmY,QAAQrU,QAC9C2N,EAAMC,UAAU1R,KAAKmY,QAAS,EAAGlB,EAAKkB,QAAS,EAAGnY,KAAKmY,QAAQrU,QAC/DmT,EAAKmB,OAASA,OACdnB,EAAKoB,cAAgBrY,KAAKqY,cAC1BpB,EAAKjH,MAAMN,aAAa1P,KAAKgQ,OACtBiH,CACR,EC3BM,MAAMqB,UAAwBpD,EACpC1Q,EAAWE,EAAW6T,SAItBvI,MAAQ,IAAIb,EAAM,IAAM,IAAM,EAAG,GAEjC,WAAArP,CAAamE,GACZ+I,MAAM/I,EACP,CAEA,oBAAAuU,CAAsBxC,EAAYyC,GAGjC,OAFAA,EAAMjU,EAAIxE,KAAKwE,EAAIwR,EAAKzG,EAAIvP,KAAK0E,EAAIsR,EAAK1G,EAAI0G,EAAKG,OACnDsC,EAAM/T,EAAI1E,KAAKwE,EAAIwR,EAAKrG,EAAI3P,KAAK0E,EAAIsR,EAAKzE,EAAIyE,EAAKI,OAC5CqC,CACR,CAEA,oBAAAC,CAAsB1C,GACrB,IAAIvF,EAAMP,EAAUM,OAAOxQ,KAAKuY,UAAW3H,EAAMV,EAAUS,OAAO3Q,KAAKuY,UACnE/T,EAAIiM,EAAMuF,EAAKzG,EAAIqB,EAAMoF,EAAK1G,EAC9B5K,EAAI+L,EAAMuF,EAAKrG,EAAIiB,EAAMoF,EAAKzE,EAClC,OAAO5M,KAAKgU,MAAMjU,EAAGF,GAAK0L,EAAU0I,MACrC,CAEA,IAAA3B,GACC,IAAIA,EAAO,IAAIqB,EAAgBtY,KAAKiE,MAKpC,OAJAgT,EAAKzS,EAAIxE,KAAKwE,EACdyS,EAAKvS,EAAI1E,KAAK0E,EACduS,EAAKsB,SAAWvY,KAAKuY,SACrBtB,EAAKjH,MAAMN,aAAa1P,KAAKgQ,OACtBiH,CACR,EC/BM,MAAM4B,UAAyB5D,EACrClJ,WAAa,EACbA,WAAa,EACbA,WAAa,EACbA,WAAa,EACbA,WAAa,EACbA,WAAa,EACbA,WAAa,EACbA,WAAa,EAEbA,UAAY,EACZA,UAAY,EACZA,WAAa,EACbA,WAAa,EACbA,WAAa,EACbA,WAAa,EACbA,UAAY,EACZA,UAAY,EAEZA,UAAY,EACZA,UAAY,EACZA,WAAa,GACbA,WAAa,GACbA,WAAa,GACbA,WAAa,GACbA,UAAY,GACZA,UAAY,GAEZA,UAAY,GACZA,UAAY,GACZA,WAAa,GACbA,WAAa,GACbA,WAAa,GACbA,WAAa,GACbA,UAAY,GACZA,UAAY,GAEZA,UAAY,GACZA,UAAY,GACZA,WAAa,GACbA,WAAa,GACbA,WAAa,GACbA,WAAa,GACbA,UAAY,GACZA,UAAY,GAGZvH,EAAI,EAGJE,EAAI,EAGJoU,OAAS,EAGTC,OAAS,EAGTR,SAAW,EAGXtW,MAAQ,EAGRC,OAAS,EAGT8N,MAAQ,IAAIb,EAAM,EAAG,EAAG,EAAG,GAG3BhJ,KAEA6S,eACAjV,OAKA8R,OAASpE,EAAMc,cAAc,GAG7B+E,IAAM7F,EAAMc,cAAc,GAE1BoF,UAAY,IAAIxI,EAAM,EAAG,EAAG,EAAG,GAE/B,WAAArP,CAAamE,GACZ+I,MAAM/I,EACP,CAGA,YAAAgV,GACC,IAAIC,EAAelZ,KAAKiC,MAAQjC,KAAK+D,OAAOzB,cAAgBtC,KAAK8Y,OAC7DK,EAAenZ,KAAKkC,OAASlC,KAAK+D,OAAOxB,eAAiBvC,KAAK+Y,OAC/DK,GAAUpZ,KAAKiC,MAAQ,EAAIjC,KAAK8Y,OAAS9Y,KAAK+D,OAAO3B,QAAU8W,EAC/DG,GAAUrZ,KAAKkC,OAAS,EAAIlC,KAAK+Y,OAAS/Y,KAAK+D,OAAO1B,QAAU8W,EAChEG,EAAUF,EAASpZ,KAAK+D,OAAO9B,MAAQiX,EACvCK,EAAUF,EAASrZ,KAAK+D,OAAO7B,OAASiX,EACxCK,EAAUxZ,KAAKuY,SAAW5T,KAAKwL,GAAK,IACpCM,EAAM9L,KAAK8L,IAAI+I,GACf5I,EAAMjM,KAAKiM,IAAI4I,GACfC,EAAYL,EAAS3I,EAAMzQ,KAAKwE,EAChCkV,EAAYN,EAASxI,EACrB+I,EAAYN,EAAS5I,EAAMzQ,KAAK0E,EAChCkV,EAAYP,EAASzI,EACrBiJ,EAAaP,EAAU7I,EAAMzQ,KAAKwE,EAClCsV,EAAaR,EAAU1I,EACvBmJ,EAAaR,EAAU9I,EAAMzQ,KAAK0E,EAClCsV,EAAaT,EAAU3I,EACvBiF,EAAS7V,KAAK6V,OAClBA,EAAOgD,EAAiBoB,KAAOR,EAAYG,EAC3C/D,EAAOgD,EAAiBqB,KAAOP,EAAYD,EAC3C7D,EAAOgD,EAAiBsB,KAAOV,EAAYO,EAC3CnE,EAAOgD,EAAiBuB,KAAOL,EAAaL,EAC5C7D,EAAOgD,EAAiBwB,KAAOR,EAAaG,EAC5CnE,EAAOgD,EAAiByB,KAAOP,EAAaD,EAC5CjE,EAAOgD,EAAiB0B,KAAOV,EAAaD,EAC5C/D,EAAOgD,EAAiB2B,KAAOb,EAAYG,CAC5C,CAEA,SAAAW,CAAW1W,GACV/D,KAAK+D,OAASA,EACd,IAAIuT,EAAMtX,KAAKsX,IACXvT,EAAO5B,QACVmV,EAAI,GAAKvT,EAAOlC,EAChByV,EAAI,GAAKvT,EAAO/B,GAChBsV,EAAI,GAAKvT,EAAOlC,EAChByV,EAAI,GAAKvT,EAAOjC,EAChBwV,EAAI,GAAKvT,EAAOhC,GAChBuV,EAAI,GAAKvT,EAAOjC,EAChBwV,EAAI,GAAKvT,EAAOhC,GAChBuV,EAAI,GAAKvT,EAAO/B,KAEhBsV,EAAI,GAAKvT,EAAOlC,EAChByV,EAAI,GAAKvT,EAAO/B,GAChBsV,EAAI,GAAKvT,EAAOlC,EAChByV,EAAI,GAAKvT,EAAOjC,EAChBwV,EAAI,GAAKvT,EAAOhC,GAChBuV,EAAI,GAAKvT,EAAOjC,EAChBwV,EAAI,GAAKvT,EAAOhC,GAChBuV,EAAI,GAAKvT,EAAO/B,GAElB,CASA,oBAAAyT,CAAsBO,EAAYJ,EAAkCC,EAAgBC,GACnF,IAAI4E,EAAe1a,KAAK6V,OACpBrR,EAAIwR,EAAKG,OAAQzR,EAAIsR,EAAKI,OAC1B7G,EAAIyG,EAAKzG,EAAGD,EAAI0G,EAAK1G,EAAGK,EAAIqG,EAAKrG,EAAG4B,EAAIyE,EAAKzE,EAC7CnP,EAAU,EAAGC,EAAU,EAE3BD,EAAUsY,EAAa7B,EAAiBoB,KACxC5X,EAAUqY,EAAa7B,EAAiBqB,KACxCtE,EAAcC,GAAUzT,EAAUmN,EAAIlN,EAAUiN,EAAI9K,EACpDoR,EAAcC,EAAS,GAAKzT,EAAUuN,EAAItN,EAAUkP,EAAI7M,EACxDmR,GAAUC,EAEV1T,EAAUsY,EAAa7B,EAAiBsB,KACxC9X,EAAUqY,EAAa7B,EAAiBuB,KACxCxE,EAAcC,GAAUzT,EAAUmN,EAAIlN,EAAUiN,EAAI9K,EACpDoR,EAAcC,EAAS,GAAKzT,EAAUuN,EAAItN,EAAUkP,EAAI7M,EACxDmR,GAAUC,EAEV1T,EAAUsY,EAAa7B,EAAiBwB,KACxChY,EAAUqY,EAAa7B,EAAiByB,KACxC1E,EAAcC,GAAUzT,EAAUmN,EAAIlN,EAAUiN,EAAI9K,EACpDoR,EAAcC,EAAS,GAAKzT,EAAUuN,EAAItN,EAAUkP,EAAI7M,EACxDmR,GAAUC,EAEV1T,EAAUsY,EAAa7B,EAAiB0B,KACxClY,EAAUqY,EAAa7B,EAAiB2B,KACxC5E,EAAcC,GAAUzT,EAAUmN,EAAIlN,EAAUiN,EAAI9K,EACpDoR,EAAcC,EAAS,GAAKzT,EAAUuN,EAAItN,EAAUkP,EAAI7M,CACzD,CAEA,IAAAuS,GACC,IAAIA,EAAO,IAAI4B,EAAiB7Y,KAAKiE,MAcrC,OAbAgT,EAAKlT,OAAS/D,KAAK+D,OACnBkT,EAAK+B,eAAiBhZ,KAAKgZ,eAC3B/B,EAAK9Q,KAAOnG,KAAKmG,KACjB8Q,EAAKzS,EAAIxE,KAAKwE,EACdyS,EAAKvS,EAAI1E,KAAK0E,EACduS,EAAK6B,OAAS9Y,KAAK8Y,OACnB7B,EAAK8B,OAAS/Y,KAAK+Y,OACnB9B,EAAKsB,SAAWvY,KAAKuY,SACrBtB,EAAKhV,MAAQjC,KAAKiC,MAClBgV,EAAK/U,OAASlC,KAAKkC,OACnBuP,EAAMC,UAAU1R,KAAKsX,IAAK,EAAGL,EAAKK,IAAK,EAAG,GAC1C7F,EAAMC,UAAU1R,KAAK6V,OAAQ,EAAGoB,EAAKpB,OAAQ,EAAG,GAChDoB,EAAKjH,MAAMN,aAAa1P,KAAKgQ,OACtBiH,CACR,EChMM,MAAM0D,EACZ7Q,MAEA,WAAAhK,CAAagK,GACZ9J,KAAK8J,MAAQA,CACd,CAEA,mBAAA8Q,CAAqBC,EAAY5W,EAAckC,GAC9C,IAAIpC,EAAS/D,KAAK8J,MAAM5E,WAAWiB,GACnC,GAAc,MAAVpC,EAAgB,MAAM,IAAIlD,MAAM,8BAAgCsF,EAAO,wBAA0BlC,EAAO,KAC5GF,EAAOnC,aAAemC,EACtB,IAAIgT,EAAa,IAAI8B,EAAiB5U,GAEtC,OADA8S,EAAW0D,UAAU1W,GACdgT,CACR,CAEA,iBAAA+D,CAAmBD,EAAY5W,EAAckC,GAC5C,IAAIpC,EAAS/D,KAAK8J,MAAM5E,WAAWiB,GACnC,GAAc,MAAVpC,EAAgB,MAAM,IAAIlD,MAAM,8BAAgCsF,EAAO,sBAAwBlC,EAAO,KAC1GF,EAAOnC,aAAemC,EACtB,IAAIgT,EAAa,IAAIK,EAAenT,GAEpC,OADA8S,EAAWhT,OAASA,EACbgT,CACR,CAEA,wBAAAgE,CAA0BF,EAAY5W,GACrC,OAAO,IAAI+S,EAAsB/S,EAClC,CAEA,iBAAA+W,CAAmBH,EAAY5W,GAC9B,OAAO,IAAIiU,EAAejU,EAC3B,CAEA,kBAAAgX,CAAmBJ,EAAY5W,GAC9B,OAAO,IAAIqU,EAAgBrU,EAC5B,CAEA,qBAAAiX,CAAsBL,EAAY5W,GACjC,OAAO,IAAIiT,EAAmBjT,EAC/B,EhBjDM,MAAMkX,EAEZtW,MAGAZ,KAGA+E,OAGAlF,OAGAU,EAAI,EAGJE,EAAI,EAGJ6T,SAAW,EAGXO,OAAS,EAGTC,OAAS,EAGTqC,OAAS,EAGTC,OAAS,EAGTC,cAAgBla,EAAc8K,OAK9BqP,cAAe,EAIfvL,MAAQ,IAAIb,EAEZ,WAAArP,CAAa+E,EAAeZ,EAAc+E,GACzC,GAAInE,EAAQ,EAAG,MAAM,IAAIhE,MAAM,uBAC/B,GAAY,MAARoD,EAAc,MAAM,IAAIpD,MAAM,wBAClCb,KAAK6E,MAAQA,EACb7E,KAAKiE,KAAOA,EACZjE,KAAKgJ,OAASA,CACf,GAID,SAAY5H,GACX,uBAAQ,yCAAiB,uDAAwB,yBAAS,gDAC1D,CAFD,CAAYA,IAAAA,EAAa,KiBjDlB,MAAMoa,EAEZ7U,KAGAoP,SAGA/M,OAGAyS,SAAW,IAAIvY,MAGfsB,EAAI,EAGJE,EAAI,EAGJ6T,SAAW,EAGXO,OAAS,EAGTC,OAAS,EAGTqC,OAAS,EAGTC,OAAS,EAGTK,GAAK,EAGLC,GAAK,EAGLC,UAAY,EAGZC,QAAU,EAGVC,QAAU,EAGVC,QAAU,EAGVC,QAAU,EAIVC,cAAe,EAGf1M,EAAI,EAGJD,EAAI,EAGJK,EAAI,EAGJ4B,EAAI,EAGJ6E,OAAS,EAGTD,OAAS,EAET+F,QAAS,EACTC,QAAS,EAGT,WAAArc,CAAa6G,EAAgBoP,EAAoB/M,GAChD,GAAY,MAARrC,EAAc,MAAM,IAAI9F,MAAM,wBAClC,GAAgB,MAAZkV,EAAkB,MAAM,IAAIlV,MAAM,4BACtCb,KAAK2G,KAAOA,EACZ3G,KAAK+V,SAAWA,EAChB/V,KAAKgJ,OAASA,EACdhJ,KAAKoc,gBACN,CAIA,QAAAC,GACC,OAAOrc,KAAKmc,MACb,CAGA,MAAA1O,GACCzN,KAAKsc,yBAAyBtc,KAAKwE,EAAGxE,KAAK0E,EAAG1E,KAAKuY,SAAUvY,KAAK8Y,OAAQ9Y,KAAK+Y,OAAQ/Y,KAAKob,OAAQpb,KAAKqb,OAC1G,CAKA,oBAAAkB,GACCvc,KAAKsc,yBAAyBtc,KAAKwE,EAAGxE,KAAK0E,EAAG1E,KAAKuY,SAAUvY,KAAK8Y,OAAQ9Y,KAAK+Y,OAAQ/Y,KAAKob,OAAQpb,KAAKqb,OAC1G,CAMA,wBAAAiB,CAA0B9X,EAAWE,EAAW6T,EAAkBO,EAAgBC,EAAgBqC,EAAgBC,GACjHrb,KAAK0b,GAAKlX,EACVxE,KAAK2b,GAAKjX,EACV1E,KAAK4b,UAAYrD,EACjBvY,KAAK6b,QAAU/C,EACf9Y,KAAK8b,QAAU/C,EACf/Y,KAAK+b,QAAUX,EACfpb,KAAKgc,QAAUX,EACfrb,KAAKic,cAAe,EAEpB,IAAIjT,EAAShJ,KAAKgJ,OAClB,GAAc,MAAVA,EAAgB,CACnB,IAAI+M,EAAW/V,KAAK+V,SAChByG,EAAYjE,EAAW,GAAK8C,EAC5BoB,EAAK1G,EAAS+C,OACd4D,EAAK3G,EAASgD,OAOlB,OANA/Y,KAAKuP,EAAIW,EAAUM,OAAO+H,EAAW6C,GAAUtC,EAAS2D,EACxDzc,KAAKsP,EAAIY,EAAUM,OAAOgM,GAAazD,EAAS0D,EAChDzc,KAAK2P,EAAIO,EAAUS,OAAO4H,EAAW6C,GAAUtC,EAAS4D,EACxD1c,KAAKuR,EAAIrB,EAAUS,OAAO6L,GAAazD,EAAS2D,EAChD1c,KAAKmW,OAAS3R,EAAIiY,EAAK1G,EAASvR,OAChCxE,KAAKoW,OAAS1R,EAAIgY,EAAK3G,EAASrR,EAEjC,CAEA,IAAIiY,EAAK3T,EAAOuG,EAAGqN,EAAK5T,EAAOsG,EAAGuN,EAAK7T,EAAO2G,EAAGmN,EAAK9T,EAAOuI,EAI7D,OAHAvR,KAAKmW,OAASwG,EAAKnY,EAAIoY,EAAKlY,EAAIsE,EAAOmN,OACvCnW,KAAKoW,OAASyG,EAAKrY,EAAIsY,EAAKpY,EAAIsE,EAAOoN,OAE/BpW,KAAK2G,KAAK2U,eAClB,KAAKla,EAAc8K,OAAQ,CAC1B,IAAIsQ,EAAYjE,EAAW,GAAK8C,EAC5B0B,EAAK7M,EAAUM,OAAO+H,EAAW6C,GAAUtC,EAC3CkE,EAAK9M,EAAUM,OAAOgM,GAAazD,EACnCkE,EAAK/M,EAAUS,OAAO4H,EAAW6C,GAAUtC,EAC3CoE,EAAKhN,EAAUS,OAAO6L,GAAazD,EAKvC,OAJA/Y,KAAKuP,EAAIoN,EAAKI,EAAKH,EAAKK,EACxBjd,KAAKsP,EAAIqN,EAAKK,EAAKJ,EAAKM,EACxBld,KAAK2P,EAAIkN,EAAKE,EAAKD,EAAKG,OACxBjd,KAAKuR,EAAIsL,EAAKG,EAAKF,EAAKI,EAEzB,CACA,KAAK9b,EAAc+b,gBAAiB,CACnC,IAAIX,EAAYjE,EAAW,GAAK8C,EAChCrb,KAAKuP,EAAIW,EAAUM,OAAO+H,EAAW6C,GAAUtC,EAC/C9Y,KAAKsP,EAAIY,EAAUM,OAAOgM,GAAazD,EACvC/Y,KAAK2P,EAAIO,EAAUS,OAAO4H,EAAW6C,GAAUtC,EAC/C9Y,KAAKuR,EAAIrB,EAAUS,OAAO6L,GAAazD,EACvC,KACD,CACA,KAAK3X,EAAcgc,uBAAwB,CAC1C,IAAIC,EAAIV,EAAKA,EAAKE,EAAKA,EACnBS,EAAM,EACND,EAAI,MACPA,EAAI1Y,KAAKC,IAAI+X,EAAKG,EAAKF,EAAKC,GAAMQ,EAClCT,EAAKC,EAAKQ,EACVP,EAAKH,EAAKU,EACVC,EAAM3Y,KAAKgU,MAAMkE,EAAIF,GAAMzM,EAAU0I,SAErC+D,EAAK,EACLE,EAAK,EACLS,EAAM,GAAK3Y,KAAKgU,MAAMmE,EAAIF,GAAM1M,EAAU0I,QAE3C,IAAI2E,EAAKhF,EAAW6C,EAASkC,EACzBE,EAAKjF,EAAW8C,EAASiC,EAAM,GAC/BP,EAAK7M,EAAUM,OAAO+M,GAAMzE,EAC5BkE,EAAK9M,EAAUM,OAAOgN,GAAMzE,EAC5BkE,EAAK/M,EAAUS,OAAO4M,GAAMzE,EAC5BoE,EAAKhN,EAAUS,OAAO6M,GAAMzE,EAahC,OAZA/Y,KAAKuP,EAAIoN,EAAKI,EAAKH,EAAKK,EACxBjd,KAAKsP,EAAIqN,EAAKK,EAAKJ,EAAKM,EACxBld,KAAK2P,EAAIkN,EAAKE,EAAKD,EAAKG,EACxBjd,KAAKuR,EAAIsL,EAAKG,EAAKF,EAAKI,EAKxBld,KAAKuP,GAAK5K,KAAK8Y,KAAKzd,KAAK+V,SAAS+C,QAClC9Y,KAAKsP,GAAK3K,KAAK8Y,KAAKzd,KAAK+V,SAAS+C,QAClC9Y,KAAK2P,GAAKhL,KAAK8Y,KAAKzd,KAAK+V,SAASgD,aAClC/Y,KAAKuR,GAAK5M,KAAK8Y,KAAKzd,KAAK+V,SAASgD,QAEnC,CACA,KAAK3X,EAAcsc,QACnB,KAAKtc,EAAcuc,oBAAqB,CACvC,IAAIlN,EAAMP,EAAUM,OAAO+H,GACvB3H,EAAMV,EAAUS,OAAO4H,GACvBqF,GAAMjB,EAAKlM,EAAMmM,EAAKhM,GAAO5Q,KAAK+V,SAAS+C,OAC3C+E,GAAMhB,EAAKpM,EAAMqM,EAAKlM,GAAO5Q,KAAK+V,SAASgD,OAC3CsE,EAAI1Y,KAAK6M,KAAKoM,EAAKA,EAAKC,EAAKA,GAC7BR,EAAI,OAASA,EAAI,EAAIA,GACzBO,GAAMP,EACNQ,GAAMR,EACNA,EAAI1Y,KAAK6M,KAAKoM,EAAKA,EAAKC,EAAKA,GACzB7d,KAAK2G,KAAK2U,eAAiBla,EAAcsc,SACxCf,EAAKG,EAAKF,EAAKC,EAAK,IAAO7c,KAAK+V,SAAS+C,OAAS,GAAK9Y,KAAK+V,SAASgD,OAAS,KAAIsE,GAAKA,GAC5F,IAAIjO,EAAIzK,KAAKwL,GAAK,EAAIxL,KAAKgU,MAAMkF,EAAID,GACjCE,EAAKnZ,KAAK8L,IAAIrB,GAAKiO,EACnBU,EAAKpZ,KAAKiM,IAAIxB,GAAKiO,EACnBN,EAAK7M,EAAUM,OAAO4K,GAAUtC,EAChCkE,EAAK9M,EAAUM,OAAO,GAAK6K,GAAUtC,EACrCkE,EAAK/M,EAAUS,OAAOyK,GAAUtC,EAChCoE,EAAKhN,EAAUS,OAAO,GAAK0K,GAAUtC,EACzC/Y,KAAKuP,EAAIqO,EAAKb,EAAKe,EAAKb,EACxBjd,KAAKsP,EAAIsO,EAAKZ,EAAKc,EAAKZ,EACxBld,KAAK2P,EAAIkO,EAAKd,EAAKgB,EAAKd,EACxBjd,KAAKuR,EAAIsM,EAAKb,EAAKe,EAAKb,EACxB,KACD,EAEAld,KAAKuP,GAAKvP,KAAK+V,SAAS+C,OACxB9Y,KAAKsP,GAAKtP,KAAK+V,SAAS+C,OACxB9Y,KAAK2P,GAAK3P,KAAK+V,SAASgD,OACxB/Y,KAAKuR,GAAKvR,KAAK+V,SAASgD,MACzB,CAGA,cAAAqD,GACC,IAAIzV,EAAO3G,KAAK2G,KAChB3G,KAAKwE,EAAImC,EAAKnC,EACdxE,KAAK0E,EAAIiC,EAAKjC,EACd1E,KAAKuY,SAAW5R,EAAK4R,SACrBvY,KAAK8Y,OAASnS,EAAKmS,OACnB9Y,KAAK+Y,OAASpS,EAAKoS,OACnB/Y,KAAKob,OAASzU,EAAKyU,OACnBpb,KAAKqb,OAAS1U,EAAK0U,MACpB,CAGA,iBAAA2C,GACC,OAAOrZ,KAAKgU,MAAM3Y,KAAK2P,EAAG3P,KAAKuP,GAAKW,EAAU0I,MAC/C,CAGA,iBAAAqF,GACC,OAAOtZ,KAAKgU,MAAM3Y,KAAKuR,EAAGvR,KAAKsP,GAAKY,EAAU0I,MAC/C,CAGA,cAAAsF,GACC,OAAOvZ,KAAK6M,KAAKxR,KAAKuP,EAAIvP,KAAKuP,EAAIvP,KAAK2P,EAAI3P,KAAK2P,EAClD,CAGA,cAAAwO,GACC,OAAOxZ,KAAK6M,KAAKxR,KAAKsP,EAAItP,KAAKsP,EAAItP,KAAKuR,EAAIvR,KAAKuR,EAClD,CAUA,sBAAA6M,GACCpe,KAAKic,cAAe,EACpB,IAAIjT,EAAShJ,KAAKgJ,OAClB,GAAc,MAAVA,EAQH,OAPAhJ,KAAK0b,GAAK1b,KAAKmW,OACfnW,KAAK2b,GAAK3b,KAAKoW,OACfpW,KAAK4b,UAAYjX,KAAKgU,MAAM3Y,KAAK2P,EAAG3P,KAAKuP,GAAKW,EAAU0I,OACxD5Y,KAAK6b,QAAUlX,KAAK6M,KAAKxR,KAAKuP,EAAIvP,KAAKuP,EAAIvP,KAAK2P,EAAI3P,KAAK2P,GACzD3P,KAAK8b,QAAUnX,KAAK6M,KAAKxR,KAAKsP,EAAItP,KAAKsP,EAAItP,KAAKuR,EAAIvR,KAAKuR,GACzDvR,KAAK+b,QAAU,OACf/b,KAAKgc,QAAUrX,KAAKgU,MAAM3Y,KAAKuP,EAAIvP,KAAKsP,EAAItP,KAAK2P,EAAI3P,KAAKuR,EAAGvR,KAAKuP,EAAIvP,KAAKuR,EAAIvR,KAAKsP,EAAItP,KAAK2P,GAAKO,EAAU0I,QAG7G,IAAI+D,EAAK3T,EAAOuG,EAAGqN,EAAK5T,EAAOsG,EAAGuN,EAAK7T,EAAO2G,EAAGmN,EAAK9T,EAAOuI,EACzD8M,EAAM,GAAK1B,EAAKG,EAAKF,EAAKC,GAC1ByB,EAAKte,KAAKmW,OAASnN,EAAOmN,OAAQoI,EAAKve,KAAKoW,OAASpN,EAAOoN,OAChEpW,KAAK0b,GAAM4C,EAAKxB,EAAKuB,EAAME,EAAK3B,EAAKyB,EACrCre,KAAK2b,GAAM4C,EAAK5B,EAAK0B,EAAMC,EAAKzB,EAAKwB,EACrC,IAAIG,EAAKH,EAAMvB,EACX3H,EAAKkJ,EAAM1B,EACX8B,EAAKJ,EAAMzB,EACX8B,EAAKL,EAAMxB,EACX8B,EAAKH,EAAKxe,KAAKuP,EAAIkP,EAAKze,KAAK2P,EAC7BiP,EAAKJ,EAAKxe,KAAKsP,EAAImP,EAAKze,KAAKuR,EAC7BsN,EAAK1J,EAAKnV,KAAK2P,EAAI+O,EAAK1e,KAAKuP,EAC7BuP,EAAK3J,EAAKnV,KAAKuR,EAAImN,EAAK1e,KAAKsP,EAGjC,GAFAtP,KAAK+b,QAAU,EACf/b,KAAK6b,QAAUlX,KAAK6M,KAAKmN,EAAKA,EAAKE,EAAKA,GACpC7e,KAAK6b,QAAU,KAAQ,CAC1B,IAAIkD,EAAMJ,EAAKG,EAAKF,EAAKC,EACzB7e,KAAK8b,QAAUiD,EAAM/e,KAAK6b,QAC1B7b,KAAKgc,QAAUrX,KAAKgU,MAAMgG,EAAKC,EAAKC,EAAKC,EAAIC,GAAO7O,EAAU0I,OAC9D5Y,KAAK4b,UAAYjX,KAAKgU,MAAMkG,EAAIF,GAAMzO,EAAU0I,MACjD,MACC5Y,KAAK6b,QAAU,EACf7b,KAAK8b,QAAUnX,KAAK6M,KAAKoN,EAAKA,EAAKE,EAAKA,GACxC9e,KAAKgc,QAAU,EACfhc,KAAK4b,UAAY,GAAKjX,KAAKgU,MAAMmG,EAAIF,GAAM1O,EAAU0I,MAEvD,CAGA,YAAAoG,CAAcC,GACb,IAAI1P,EAAIvP,KAAKuP,EAAGD,EAAItP,KAAKsP,EAAGK,EAAI3P,KAAK2P,EAAG4B,EAAIvR,KAAKuR,EAC7C2N,EAAS,GAAK3P,EAAIgC,EAAIjC,EAAIK,GAC1BnL,EAAIya,EAAMza,EAAIxE,KAAKmW,OAAQzR,EAAIua,EAAMva,EAAI1E,KAAKoW,OAGlD,OAFA6I,EAAMza,EAAKA,EAAI+M,EAAI2N,EAASxa,EAAI4K,EAAI4P,EACpCD,EAAMva,EAAKA,EAAI6K,EAAI2P,EAAS1a,EAAImL,EAAIuP,EAC7BD,CACR,CAGA,YAAAE,CAAcC,GACb,IAAI5a,EAAI4a,EAAM5a,EAAGE,EAAI0a,EAAM1a,EAG3B,OAFA0a,EAAM5a,EAAIA,EAAIxE,KAAKuP,EAAI7K,EAAI1E,KAAKsP,EAAItP,KAAKmW,OACzCiJ,EAAM1a,EAAIF,EAAIxE,KAAK2P,EAAIjL,EAAI1E,KAAKuR,EAAIvR,KAAKoW,OAClCgJ,CACR,CAGA,oBAAAC,CAAsBC,GACrB,IAAI1O,EAAMV,EAAUS,OAAO2O,GAAgB7O,EAAMP,EAAUM,OAAO8O,GAClE,OAAO3a,KAAKgU,MAAM3Y,KAAKuP,EAAIqB,EAAM5Q,KAAK2P,EAAIc,EAAKzQ,KAAKuR,EAAId,EAAMzQ,KAAKsP,EAAIsB,GAAOV,EAAU0I,OAAS5Y,KAAKuY,SAAWvY,KAAKob,MACvH,CAGA,oBAAAmE,CAAsBC,GACrBA,GAAiBxf,KAAKuY,SAAWvY,KAAKob,OACtC,IAAIxK,EAAMV,EAAUS,OAAO6O,GAAgB/O,EAAMP,EAAUM,OAAOgP,GAClE,OAAO7a,KAAKgU,MAAMlI,EAAMzQ,KAAK2P,EAAIiB,EAAM5Q,KAAKuR,EAAGd,EAAMzQ,KAAKuP,EAAIqB,EAAM5Q,KAAKsP,GAAKY,EAAU0I,MACzF,CAIA,WAAA6G,CAAapb,GACZ,IAAIkL,EAAIvP,KAAKuP,EAAGD,EAAItP,KAAKsP,EAAGK,EAAI3P,KAAK2P,EAAG4B,EAAIvR,KAAKuR,EAC7Cd,EAAMP,EAAUM,OAAOnM,GAAUuM,EAAMV,EAAUS,OAAOtM,GAC5DrE,KAAKuP,EAAIkB,EAAMlB,EAAIqB,EAAMjB,EACzB3P,KAAKsP,EAAImB,EAAMnB,EAAIsB,EAAMW,EACzBvR,KAAK2P,EAAIiB,EAAMrB,EAAIkB,EAAMd,EACzB3P,KAAKuR,EAAIX,EAAMtB,EAAImB,EAAMc,EACzBvR,KAAKic,cAAe,CACrB,EC7VM,MAAMyD,EAEZ/Y,KAGA0O,MAGAsK,OAGAC,cAAgB,EAGhBC,UAAW,EAIXC,SAAU,EAGVC,IAAM,EAGNC,SAAW,EACX7D,QAAS,EAET,WAAArc,CAAa6G,EAAwBoP,GACpC,GAAY,MAARpP,EAAc,MAAM,IAAI9F,MAAM,wBAClC,GAAgB,MAAZkV,EAAkB,MAAM,IAAIlV,MAAM,4BACtCb,KAAK2G,KAAOA,EACZ3G,KAAK+f,IAAMpZ,EAAKoZ,IAChB/f,KAAKggB,SAAWrZ,EAAKqZ,SACrBhgB,KAAK4f,cAAgBjZ,EAAKiZ,cAC1B5f,KAAK6f,SAAWlZ,EAAKkZ,SACrB7f,KAAK8f,QAAUnZ,EAAKmZ,QAEpB9f,KAAKqV,MAAQ,IAAInS,MACjB,IAAK,IAAIiC,EAAI,EAAGA,EAAIwB,EAAK0O,MAAMvR,OAAQqB,IACtCnF,KAAKqV,MAAMtQ,KAAKgR,EAASkK,SAAStZ,EAAK0O,MAAMlQ,GAAGlB,OACjDjE,KAAK2f,OAAS5J,EAASkK,SAAStZ,EAAKgZ,OAAO1b,KAC7C,CAEA,QAAAoY,GACC,OAAOrc,KAAKmc,MACb,CAGA,KAAA+D,GACClgB,KAAKyN,QACN,CAEA,MAAAA,GACC,IAAIkS,EAAS3f,KAAK2f,OACdtK,EAAQrV,KAAKqV,MACjB,OAAQA,EAAMvR,QACd,KAAK,EACJ9D,KAAKmgB,OAAO9K,EAAM,GAAIsK,EAAOxJ,OAAQwJ,EAAOvJ,OAAQpW,KAAK6f,SAAU7f,KAAK8f,QAAS9f,KAAK2G,KAAKyZ,QAASpgB,KAAK+f,KACzG,MACD,KAAK,EACJ/f,KAAKqgB,OAAOhL,EAAM,GAAIA,EAAM,GAAIsK,EAAOxJ,OAAQwJ,EAAOvJ,OAAQpW,KAAK4f,cAAe5f,KAAK8f,QAAS9f,KAAKggB,SAAUhgB,KAAK+f,KAGtH,CAGA,MAAAI,CAAQnK,EAAYsK,EAAiBC,EAAiBV,EAAmBC,EAAkBM,EAAkBjV,GACvG6K,EAAKiG,cAAcjG,EAAKoI,yBAC7B,IAAIoC,EAAIxK,EAAKhN,OAET2T,EAAK6D,EAAEjR,EAAGqN,EAAK4D,EAAElR,EAAGuN,EAAK2D,EAAE7Q,EAAGmN,EAAK0D,EAAEjP,EACrCkP,GAAczK,EAAK+F,QAAU/F,EAAK4F,UAAW8E,EAAK,EAAGC,EAAK,EAE9D,OAAO3K,EAAKrP,KAAK2U,eAChB,KAAKla,EAAc+b,gBAClBuD,EAAKJ,EAAUtK,EAAKG,OACpBwK,EAAKJ,EAAUvK,EAAKI,OACpB,MACD,KAAKhV,EAAcgc,uBAClBqD,GAAc9b,KAAKgU,MAAMkE,EAAIF,GAAMzM,EAAU0I,OAC7C,IAAIgI,EAAKjc,KAAKC,IAAI+X,EAAKG,EAAKF,EAAKC,IAAOF,EAAKA,EAAKE,EAAKA,GACvDD,GAAMC,EAAK+D,EACX9D,EAAKH,EAAKiE,EAEX,QACC,IAAIpc,EAAI8b,EAAUE,EAAErK,OAAQzR,EAAI6b,EAAUC,EAAEpK,OACxC7E,EAAIoL,EAAKG,EAAKF,EAAKC,EACvB6D,GAAMlc,EAAIsY,EAAKpY,EAAIkY,GAAMrL,EAAIyE,EAAK0F,GAClCiF,GAAMjc,EAAIiY,EAAKnY,EAAIqY,GAAMtL,EAAIyE,EAAK2F,GAEpC8E,GAAc9b,KAAKgU,MAAMgI,EAAID,GAAMxQ,EAAU0I,OACzC5C,EAAK6F,QAAU,IAAG4E,GAAc,KAChCA,EAAa,IAChBA,GAAc,IACNA,GAAc,MAAKA,GAAc,KAC1C,IAAIhE,EAAKzG,EAAK6F,QAASa,EAAK1G,EAAK8F,QACjC,GAAI+D,GAAYC,EAAS,CACxB,OAAQ9J,EAAKrP,KAAK2U,eACjB,KAAKla,EAAcsc,QACnB,KAAKtc,EAAcuc,oBAClB+C,EAAKJ,EAAUtK,EAAKG,OACpBwK,EAAKJ,EAAUvK,EAAKI,OAEtB,IAAI9G,EAAI0G,EAAKrP,KAAK7C,OAAS2Y,EAAIoE,EAAKlc,KAAK6M,KAAKkP,EAAKA,EAAKC,EAAKA,GAC7D,GAAKd,GAAYgB,EAAKvR,GAAOwQ,GAAWe,EAAKvR,GAAMA,EAAI,KAAQ,CAC9D,IAAI+N,GAAKwD,EAAKvR,EAAI,GAAKnE,EAAQ,EAC/BsR,GAAMY,EACF+C,IAAS1D,GAAMW,EACpB,CACD,CACArH,EAAKsG,yBAAyBtG,EAAK0F,GAAI1F,EAAK2F,GAAI3F,EAAK4F,UAAY6E,EAAatV,EAAOsR,EAAIC,EAAI1G,EAAK+F,QACjG/F,EAAKgG,QACP,CAIA,MAAAqE,CAAQrX,EAAc8X,EAAaR,EAAiBC,EAAiBQ,EAAiBjB,EAAkBE,EAAkB7U,GACzH,GAAa,GAATA,EAEH,YADA2V,EAAMvE,uBAGFvT,EAAOiT,cAAcjT,EAAOoV,yBAC5B0C,EAAM7E,cAAc6E,EAAM1C,yBAC/B,IAAI4C,EAAKhY,EAAO0S,GAAIuF,EAAKjY,EAAO2S,GAAIuF,EAAMlY,EAAO6S,QAASY,EAAKyE,EAAKC,EAAMnY,EAAO8S,QAASsF,EAAMN,EAAMjF,QAClGwF,EAAM,EAAGC,EAAM,EAAGC,EAAK,EACvBL,EAAM,GACTA,GAAOA,EACPG,EAAM,IACNE,GAAM,IAENF,EAAM,EACNE,EAAK,GAEFJ,EAAM,IACTA,GAAOA,EACPI,GAAMA,GAEHH,EAAM,GACTA,GAAOA,EACPE,EAAM,KAENA,EAAM,EACP,IAAIE,EAAKV,EAAMpF,GAAI+F,EAAK,EAAGC,EAAM,EAAGC,EAAM,EAAGpS,EAAIvG,EAAOuG,EAAGD,EAAItG,EAAOsG,EAAGK,EAAI3G,EAAO2G,EAAG4B,EAAIvI,EAAOuI,EAC9F1P,EAAI8C,KAAKC,IAAIsc,EAAMC,IAAQ,KAC1Btf,GAKJ4f,EAAKX,EAAMnF,GACX+F,EAAMnS,EAAIiS,EAAKlS,EAAImS,EAAKzY,EAAOmN,OAC/BwL,EAAMhS,EAAI6R,EAAKjQ,EAAIkQ,EAAKzY,EAAOoN,SAN/BqL,EAAK,EACLC,EAAMnS,EAAIiS,EAAKxY,EAAOmN,OACtBwL,EAAMhS,EAAI6R,EAAKxY,EAAOoN,QAMvB,IAAIwL,EAAK5Y,EAAOA,OAChBuG,EAAIqS,EAAGrS,EACPD,EAAIsS,EAAGtS,EACPK,EAAIiS,EAAGjS,EACP4B,EAAIqQ,EAAGrQ,EACP,IAEqEsQ,EAAIC,EAFrE3M,EAAK,GAAK5F,EAAIgC,EAAIjC,EAAIK,GAAInL,EAAIkd,EAAME,EAAGzL,OAAQzR,EAAIid,EAAMC,EAAGxL,OAC5DkI,GAAM9Z,EAAI+M,EAAI7M,EAAI4K,GAAK6F,EAAK6L,EAAIzC,GAAM7Z,EAAI6K,EAAI/K,EAAImL,GAAKwF,EAAK8L,EAC5Dc,EAAKpd,KAAK6M,KAAK8M,EAAKA,EAAKC,EAAKA,GAAKyD,EAAKlB,EAAMna,KAAK7C,OAASsd,EAChE,GAAIW,EAAK,KAGR,OAFA/hB,KAAKmgB,OAAOnX,EAAQsX,EAASC,GAAS,EAAOT,GAAS,EAAO3U,QAC7D2V,EAAMxE,yBAAyBkF,EAAIC,EAAI,EAAGX,EAAMjF,QAASiF,EAAMhF,QAASgF,EAAM/E,QAAS+E,EAAM9E,SAG9FxX,EAAI8b,EAAUsB,EAAGzL,OACjBzR,EAAI6b,EAAUqB,EAAGxL,OACjB,IAAIsK,GAAMlc,EAAI+M,EAAI7M,EAAI4K,GAAK6F,EAAK6L,EAAIL,GAAMjc,EAAI6K,EAAI/K,EAAImL,GAAKwF,EAAK8L,EAC5DJ,EAAKH,EAAKA,EAAKC,EAAKA,EACxB,GAAgB,GAAZX,EAAe,CAClBA,GAAYkB,GAAOE,EAAM,GAAK,EAC9B,IAAIa,EAAKtd,KAAK6M,KAAKqP,GAAKqB,EAAKD,EAAKF,EAAKC,EAAKd,EAAMlB,EAClD,GAAIkC,EAAK,EAAG,CACX,IAAI1B,EAAI7b,KAAK2L,IAAI,EAAG4R,GAAiB,EAAXlC,IAAiB,EAC3CQ,GAAK0B,EAAKlC,GAAY,EAAIQ,EAAIA,IAAMyB,EACpCvB,GAAMF,EAAIE,EACVC,GAAMH,EAAIG,EACVE,EAAKH,EAAKA,EAAKC,EAAKA,CACrB,CACD,CACAwB,EACA,GAAItgB,EAAG,CACNmgB,GAAMd,EACN,IAAIzQ,GAAOoQ,EAAKkB,EAAKA,EAAKC,EAAKA,IAAO,EAAID,EAAKC,GAC3CvR,GAAO,EACVA,GAAO,EACCA,EAAM,IACdA,EAAM,EACFqP,IAASrD,IAAO9X,KAAK6M,KAAKqP,IAAOkB,EAAKC,GAAM,GAAK7W,EAAQ,IAE9D2W,EAAKnd,KAAK2P,KAAK7D,GAAOsQ,EACtBxR,EAAIwS,EAAKC,EAAKvR,EACdnB,EAAI0S,EAAKrd,KAAKiM,IAAIkR,GAClBD,EAAKld,KAAKgU,MAAMgI,EAAKpR,EAAImR,EAAKpR,EAAGoR,EAAKnR,EAAIoR,EAAKrR,EAChD,KAAO,CACNC,EAAI2R,EAAMc,EACV1S,EAAI6R,EAAMa,EACV,IAAII,EAAK7S,EAAIA,EAAG8S,EAAK/S,EAAIA,EAAGgT,EAAK3d,KAAKgU,MAAMgI,EAAID,GAChD/Q,EAAI0S,EAAKN,EAAKA,EAAKK,EAAKvB,EAAKuB,EAAKC,EAClC,IAAIE,GAAM,EAAIF,EAAKN,EAAIS,EAAKH,EAAKD,EAEjC,GADA7Q,EAAIgR,EAAKA,EAAK,EAAIC,EAAK7S,EACnB4B,GAAK,EAAG,CACX,IAAIkR,EAAI9d,KAAK6M,KAAKD,GACdgR,EAAK,IAAGE,GAAKA,GACjBA,IAAMF,EAAKE,GAAK,EAChB,IAAIC,EAAKD,EAAID,EAAIG,EAAKhT,EAAI8S,EACtBrT,EAAIzK,KAAKC,IAAI8d,GAAM/d,KAAKC,IAAI+d,GAAMD,EAAKC,EAC3C,GAAIvT,EAAIA,GAAKyR,EAAI,CAChBnc,EAAIC,KAAK6M,KAAKqP,EAAKzR,EAAIA,GAAK2R,EAC5Bc,EAAKS,EAAK3d,KAAKgU,MAAMjU,EAAG0K,GACxB0S,EAAKnd,KAAKgU,MAAMjU,EAAIyc,GAAM/R,EAAI2S,GAAMb,GACpC,MAAMiB,CACP,CACD,CACA,IAAIS,EAAW1S,EAAUC,GAAI0S,EAAOd,EAAKxS,EAAGuT,EAAUD,EAAOA,EAAME,EAAO,EACtEC,EAAW,EAAGC,EAAOlB,EAAKxS,EAAG2T,EAAUD,EAAOA,EAAME,EAAO,EAC/DxT,GAAKJ,EAAIwS,GAAMK,EAAKC,GAChB1S,IAAM,GAAKA,GAAK,IACnBA,EAAIhL,KAAK2P,KAAK3E,GACdnL,EAAI+K,EAAI5K,KAAK8L,IAAId,GAAKoS,EACtBrd,EAAI4K,EAAI3K,KAAKiM,IAAIjB,GACjB4B,EAAI/M,EAAIA,EAAIE,EAAIA,EACZ6M,EAAIuR,IACPF,EAAWjT,EACXmT,EAAUvR,EACVsR,EAAOre,EACPue,EAAOre,GAEJ6M,EAAI2R,IACPF,EAAWrT,EACXuT,EAAU3R,EACV0R,EAAOze,EACP2e,EAAOze,IAGLmc,IAAOiC,EAAUI,GAAW,GAC/BrB,EAAKS,EAAK3d,KAAKgU,MAAMoK,EAAOhC,EAAS8B,GACrCf,EAAKc,EAAW7B,IAEhBc,EAAKS,EAAK3d,KAAKgU,MAAMwK,EAAOpC,EAASkC,GACrCnB,EAAKkB,EAAWjC,EAElB,CACA,IAAIqC,EAAKze,KAAKgU,MAAM8I,EAAID,GAAMD,EAC1BhJ,EAAWvP,EAAO4S,UACtBiG,GAAMA,EAAKuB,GAAMlT,EAAU0I,OAASyI,EAAM9I,EACtCsJ,EAAK,IACRA,GAAM,IACEA,GAAM,MAAKA,GAAM,KAC1B7Y,EAAOsT,yBAAyB0E,EAAIC,EAAI1I,EAAWsJ,EAAK1W,EAAOsR,EAAIzT,EAAO8S,QAAS,EAAG,GACtFvD,EAAWuI,EAAMlF,UACjBkG,IAAOA,EAAKsB,GAAMlT,EAAU0I,OAASkI,EAAM/E,SAAWwF,EAAKD,EAAM/I,EAC7DuJ,EAAK,IACRA,GAAM,IACEA,GAAM,MAAKA,GAAM,KAC1BhB,EAAMxE,yBAAyBkF,EAAIC,EAAIlJ,EAAWuJ,EAAK3W,EAAO2V,EAAMjF,QAASiF,EAAMhF,QAASgF,EAAM/E,QAAS+E,EAAM9E,QAClH,EC5QM,MAAeqH,EACFpf,KAAqBqf,MAAsB/H,aAA9D,WAAAzb,CAAmBmE,EAAqBqf,EAAsB/H,GAA3C,KAAAtX,KAAAA,EAAqB,KAAAqf,MAAAA,EAAsB,KAAA/H,aAAAA,CAAyB,ElBMjF,MAAMgI,UAA2BF,EAGvChO,MAAQ,IAAInS,MAGZyc,OAGA6D,aAGAC,YAGAC,WAGAC,eAGAC,SAGAC,QAGAC,UAGAC,aAEA,WAAAjkB,CAAamE,GACZ+I,MAAM/I,EAAM,GAAG,EAChB,GAMD,SAAY5C,GACX,qBAAO,wBACP,CAFD,CAAYA,IAAAA,EAAY,KAOxB,SAAYC,GACX,uBAAQ,qBAAO,wBACf,CAFD,CAAYA,IAAAA,EAAW,KAOvB,SAAYC,GACX,yBAAS,qBAAO,8BAChB,CAFD,CAAYA,IAAAA,EAAU,KmBjDf,MAAMyiB,EACZjY,aAAe,EAAGA,eAAiB,EAAGA,cAAgB,EACtDA,eAAiB,KAGjBpF,KAGA0O,MAGAsK,OAGAiE,SAAW,EAGXC,QAAU,EAGVC,UAAY,EAGZC,aAAe,EAEfE,OAAS,IAAI/gB,MAAiBghB,UAAY,IAAIhhB,MAC9C+b,MAAQ,IAAI/b,MAAiBihB,OAAS,IAAIjhB,MAAiBiV,QAAU,IAAIjV,MACzEkhB,SAAW,IAAIlhB,MAEfiZ,QAAS,EAET,WAAArc,CAAa6G,EAA0BoP,GACtC,GAAY,MAARpP,EAAc,MAAM,IAAI9F,MAAM,wBAClC,GAAgB,MAAZkV,EAAkB,MAAM,IAAIlV,MAAM,4BACtCb,KAAK2G,KAAOA,EACZ3G,KAAKqV,MAAQ,IAAInS,MACjB,IAAK,IAAIiC,EAAI,EAAGqG,EAAI7E,EAAK0O,MAAMvR,OAAQqB,EAAIqG,EAAGrG,IAC7CnF,KAAKqV,MAAMtQ,KAAKgR,EAASkK,SAAStZ,EAAK0O,MAAMlQ,GAAGlB,OACjDjE,KAAK2f,OAAS5J,EAASsO,SAAS1d,EAAKgZ,OAAO1b,MAC5CjE,KAAK4jB,SAAWjd,EAAKid,SACrB5jB,KAAK6jB,QAAUld,EAAKkd,QACpB7jB,KAAK8jB,UAAYnd,EAAKmd,UACtB9jB,KAAK+jB,aAAepd,EAAKod,YAC1B,CAEA,QAAA1H,GACC,OAAOrc,KAAKmc,MACb,CAGA,KAAA+D,GACClgB,KAAKyN,QACN,CAEA,MAAAA,GACC,IAAIsJ,EAAa/W,KAAK2f,OAAO2E,gBAC7B,KAAMvN,aAAsBmB,GAAiB,OAE7C,IAAI4L,EAAY9jB,KAAK8jB,UAAWC,EAAe/jB,KAAK+jB,aAClB5hB,EAAS2hB,EAAY,EACvD,KADgBC,EAAe,GACZ5hB,GAAQ,OAE3B,IAAIwE,EAAO3G,KAAK2G,KACZ4d,EAAiB5d,EAAK8c,aAAeniB,EAAYkjB,QACjDd,EAAa/c,EAAK+c,WAClBe,EAAWf,GAAcniB,EAAWmjB,QAASC,EAAQjB,GAAcniB,EAAWqjB,WAC9EC,EAAY7kB,KAAKqV,MAAMvR,OAAQghB,EAAcL,EAAWI,EAAYA,EAAY,EAChFxP,EAAQrV,KAAKqV,MACb4O,EAASxS,EAAMQ,aAAajS,KAAKikB,OAAQa,GAAc3M,EAAyB,KAChF0L,EAAU7jB,KAAK6jB,QACnB,GAAIc,IAAUJ,EAAgB,CACzBI,IAAOxM,EAAU1G,EAAMQ,aAAajS,KAAKmY,QAAS0M,IACtD,IAAIE,EAAgBpe,EAAK8c,aAAeniB,EAAY0jB,OACpD,IAAK,IAAI7f,EAAI,EAAGqG,EAAIsZ,EAAc,EAAG3f,EAAIqG,GAAI,CAC5C,IAAIwK,EAAOX,EAAMlQ,GACb8f,EAAcjP,EAAKrP,KAAK7C,OAC5B,GAAImhB,EAAcjB,EAAekB,QAC5BP,IAAOxM,EAAQhT,GAAK,GACxB8e,IAAS9e,GAAK,OACR,GAAIof,EAAgB,CAC1B,GAAII,EAAO,CACV,IAAIngB,EAAIygB,EAAcjP,EAAKzG,EAAG7K,EAAIugB,EAAcjP,EAAKrG,EACjD7L,EAASa,KAAK6M,KAAKhN,EAAIA,EAAIE,EAAIA,GACnCyT,EAAQhT,GAAKrB,CACd,CACAmgB,IAAS9e,GAAK0e,CACf,KAAO,CACN,IAAIrf,EAAIygB,EAAcjP,EAAKzG,EAAG7K,EAAIugB,EAAcjP,EAAKrG,EACjD7L,EAASa,KAAK6M,KAAKhN,EAAIA,EAAIE,EAAIA,GAC/BigB,IAAOxM,EAAQhT,GAAKrB,GACxBmgB,IAAS9e,IAAM4f,EAAgBE,EAAcpB,EAAUA,GAAW/f,EAASmhB,CAC5E,CACD,CACD,MACC,IAAK,IAAI9f,EAAI,EAAGA,EAAI2f,EAAa3f,IAChC8e,EAAO9e,GAAK0e,EAGd,IAAIK,EAAYlkB,KAAKmlB,sBAAsCpO,EAAY+N,EAAaL,EACnF9d,EAAK6c,cAAgBniB,EAAamjB,QAASD,GACxCa,EAAQlB,EAAU,GAAImB,EAAQnB,EAAU,GAAIP,EAAiBhd,EAAKgd,eAClE2B,GAAM,EACV,GAAsB,GAAlB3B,EACH2B,EAAM5B,GAAcniB,EAAWgkB,UAC3B,CACJD,GAAM,EACN,IAAI9E,EAAIxgB,KAAK2f,OAAO3J,KACpB2N,GAAkBnD,EAAEjR,EAAIiR,EAAEjP,EAAIiP,EAAElR,EAAIkR,EAAE7Q,EAAI,EAAIO,EAAUQ,QAAUR,EAAUQ,MAC7E,CACA,IAAK,IAAIvL,EAAI,EAAGqb,EAAI,EAAGrb,EAAI0f,EAAW1f,IAAKqb,GAAK,EAAG,CAClD,IAAIxK,EAAOX,EAAMlQ,GACjB6Q,EAAKG,SAAWiP,EAAQpP,EAAKG,QAAU4N,EACvC/N,EAAKI,SAAWiP,EAAQrP,EAAKI,QAAU2N,EACvC,IAAIvf,EAAI0f,EAAU1D,GAAI9b,EAAIwf,EAAU1D,EAAI,GAAIlC,EAAK9Z,EAAI4gB,EAAO7G,EAAK7Z,EAAI2gB,EACrE,GAAIV,EAAO,CACV,IAAI7gB,EAASqU,EAAQhT,GACrB,GAAc,GAAVrB,EAAa,CAChB,IAAIuZ,GAAK1Y,KAAK6M,KAAK8M,EAAKA,EAAKC,EAAKA,GAAMza,EAAS,GAAKggB,EAAY,EAClE9N,EAAKzG,GAAK8N,EACVrH,EAAKrG,GAAK0N,CACX,CACD,CAGA,GAFA+H,EAAQ5gB,EACR6gB,EAAQ3gB,EACJvC,EAAQ,CACX,IAAIoN,EAAIyG,EAAKzG,EAAGD,EAAI0G,EAAK1G,EAAGK,EAAIqG,EAAKrG,EAAG4B,EAAIyE,EAAKzE,EAAGnC,EAAI,EAAGqB,EAAM,EAAGG,EAAM,EAQ1E,GANCxB,EADGqV,EACCP,EAAU1D,EAAI,GACO,GAAjByD,EAAO9e,EAAI,GACf+e,EAAU1D,EAAI,GAEd7b,KAAKgU,MAAM4F,EAAID,GACpBlP,GAAKzK,KAAKgU,MAAMhJ,EAAGJ,GACf+V,EAAK,CACR7U,EAAM9L,KAAK8L,IAAIrB,GACfwB,EAAMjM,KAAKiM,IAAIxB,GACf,IAAItL,EAASkS,EAAKrP,KAAK7C,OACvBshB,IAAUthB,GAAU2M,EAAMlB,EAAIqB,EAAMjB,GAAK2O,GAAMwF,EAC/CuB,IAAUvhB,GAAU8M,EAAMrB,EAAIkB,EAAMd,GAAK4O,GAAMuF,CAChD,MACC1U,GAAKuU,EAEFvU,EAAIc,EAAUC,GACjBf,GAAKc,EAAUsV,IACPpW,GAAKc,EAAUC,KACvBf,GAAKc,EAAUsV,KAChBpW,GAAK0U,EACLrT,EAAM9L,KAAK8L,IAAIrB,GACfwB,EAAMjM,KAAKiM,IAAIxB,GACf4G,EAAKzG,EAAIkB,EAAMlB,EAAIqB,EAAMjB,EACzBqG,EAAK1G,EAAImB,EAAMnB,EAAIsB,EAAMW,EACzByE,EAAKrG,EAAIiB,EAAMrB,EAAIkB,EAAMd,EACzBqG,EAAKzE,EAAIX,EAAMtB,EAAImB,EAAMc,CAC1B,CACAyE,EAAKiG,cAAe,CACrB,CACD,CAEA,qBAAAkJ,CAAuBhf,EAAsB2e,EAAqBL,EAAmBgB,EACpFlB,GACA,IAAI5E,EAAS3f,KAAK2f,OACdiE,EAAW5jB,KAAK4jB,SAChBK,EAASjkB,KAAKikB,OAAQyB,EAAMjU,EAAMQ,aAAajS,KAAKkkB,UAAyB,EAAdY,EAAkB,GAAI7F,EAAuB,KAC5G7G,EAASjS,EAAKiS,OACduN,EAAiBxf,EAAKoP,oBAAqBqQ,EAAaD,EAAiB,EAAGE,EAAY7B,EAAe8B,KAE3G,IAAK3f,EAAKkS,cAAe,CACxB,IAAIF,EAAUhS,EAAKgS,QACnByN,GAAcxN,EAAS,EAAI,EAC3B,IAAI2N,EAAa5N,EAAQyN,GAEzB,GADIH,IAAiB7B,GAAYmC,GAC7BxB,EACH,IAAK,IAAIpf,EAAI,EAAGA,EAAI2f,EAAa3f,IAChC8e,EAAO9e,IAAM4gB,EAEf9G,EAAQxN,EAAMQ,aAAajS,KAAKif,MAAO,GACvC,IAAK,IAAI9Z,EAAI,EAAG6gB,EAAI,EAAGC,EAAQ,EAAG9gB,EAAI2f,EAAa3f,IAAK6gB,GAAK,EAAG,CAC/D,IAAIE,EAAQjC,EAAO9e,GACnBye,GAAYsC,EACZ,IAAI1F,EAAIoD,EAER,GAAIxL,EACHoI,GAAKuF,EACDvF,EAAI,IAAGA,GAAKuF,GAChBE,EAAQ,MACF,IAAIzF,EAAI,EAAG,CACbqF,GAAa7B,EAAemC,SAC/BN,EAAY7B,EAAemC,OAC3BhgB,EAAKsP,qBAAqBkK,EAAQ,EAAG,EAAGV,EAAO,EAAG,IAEnDjf,KAAKomB,kBAAkB5F,EAAGvB,EAAO,EAAGyG,EAAKM,GACzC,QACD,CAAO,GAAIxF,EAAIuF,EAAY,CACtBF,GAAa7B,EAAeqC,QAC/BR,EAAY7B,EAAeqC,MAC3BlgB,EAAKsP,qBAAqBkK,EAAQgG,EAAiB,EAAG,EAAG1G,EAAO,EAAG,IAEpEjf,KAAKsmB,iBAAiB9F,EAAIuF,EAAY9G,EAAO,EAAGyG,EAAKM,GACrD,QACD,EAGA,MAAQC,IAAS,CAChB,IAAIniB,EAASqU,EAAQ8N,GACrB,KAAIzF,EAAI1c,GAAR,CACA,GAAa,GAATmiB,EACHzF,GAAK1c,MACD,CACJ,IAAIyiB,EAAOpO,EAAQ8N,EAAQ,GAC3BzF,GAAKA,EAAI+F,IAASziB,EAASyiB,EAC5B,CACA,KAPwB,CAQzB,CACIN,GAASJ,IACZA,EAAYI,EACR7N,GAAU6N,GAASL,GACtBzf,EAAKsP,qBAAqBkK,EAAQgG,EAAiB,EAAG,EAAG1G,EAAO,EAAG,GACnE9Y,EAAKsP,qBAAqBkK,EAAQ,EAAG,EAAGV,EAAO,EAAG,IAElD9Y,EAAKsP,qBAAqBkK,EAAgB,EAARsG,EAAY,EAAG,EAAGhH,EAAO,EAAG,IAEhEjf,KAAKwmB,iBAAiBhG,EAAGvB,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAIyG,EAAKM,EAC7GvB,GAAatf,EAAI,GAAc,GAAT+gB,EACxB,CACA,OAAOR,CACR,CAGItN,GACHuN,GAAkB,EAClB1G,EAAQxN,EAAMQ,aAAajS,KAAKif,MAAO0G,GACvCxf,EAAKsP,qBAAqBkK,EAAQ,EAAGgG,EAAiB,EAAG1G,EAAO,EAAG,GACnE9Y,EAAKsP,qBAAqBkK,EAAQ,EAAG,EAAGV,EAAO0G,EAAiB,EAAG,GACnE1G,EAAM0G,EAAiB,GAAK1G,EAAM,GAClCA,EAAM0G,EAAiB,GAAK1G,EAAM,KAElC2G,IACAD,GAAkB,EAClB1G,EAAQxN,EAAMQ,aAAajS,KAAKif,MAAO0G,GACvCxf,EAAKsP,qBAAqBkK,EAAQ,EAAGgG,EAAgB1G,EAAO,EAAG,IAIhE,IAAIkF,EAAS1S,EAAMQ,aAAajS,KAAKmkB,OAAQyB,GACzCG,EAAa,EACbU,EAAKxH,EAAM,GAAIyH,EAAKzH,EAAM,GAAI0H,EAAM,EAAGC,EAAM,EAAGC,EAAM,EAAGC,EAAM,EAAGC,EAAK,EAAGC,EAAK,EAC/EC,EAAO,EAAGC,EAAO,EAAGC,EAAQ,EAAGC,EAAQ,EAAGC,EAAO,EAAGC,EAAO,EAAGC,EAAM,EAAGC,EAAM,EACjF,IAAK,IAAIriB,EAAI,EAAGkR,EAAI,EAAGlR,EAAIygB,EAAYzgB,IAAKkR,GAAK,EAChDsQ,EAAM1H,EAAM5I,GACZuQ,EAAM3H,EAAM5I,EAAI,GAChBwQ,EAAM5H,EAAM5I,EAAI,GAChByQ,EAAM7H,EAAM5I,EAAI,GAChB0Q,EAAK9H,EAAM5I,EAAI,GACf2Q,EAAK/H,EAAM5I,EAAI,GACf4Q,EAA8B,OAAtBR,EAAW,EAANE,EAAUE,GACvBK,EAA8B,OAAtBR,EAAW,EAANE,EAAUE,GACvBK,EAAsC,QAAf,GAAbR,EAAME,GAAWJ,EAAKM,GAChCK,EAAsC,QAAf,GAAbR,EAAME,GAAWJ,EAAKM,GAChCK,EAAc,EAAPJ,EAAWE,EAClBG,EAAc,EAAPJ,EAAWE,EAClBG,EAAmB,KAAZZ,EAAMF,GAAaQ,EAAe,UAARE,EACjCK,EAAmB,KAAZZ,EAAMF,GAAaQ,EAAe,UAARE,EACjCrB,GAAcphB,KAAK6M,KAAK+V,EAAMA,EAAMC,EAAMA,GAC1CD,GAAOF,EACPG,GAAOF,EACPD,GAAQF,EACRG,GAAQF,EACRrB,GAAcphB,KAAK6M,KAAK+V,EAAMA,EAAMC,EAAMA,GAC1CD,GAAOF,EACPG,GAAOF,EACPvB,GAAcphB,KAAK6M,KAAK+V,EAAMA,EAAMC,EAAMA,GAC1CD,GAAOF,EAAOF,EACdK,GAAOF,EAAOF,EACdrB,GAAcphB,KAAK6M,KAAK+V,EAAMA,EAAMC,EAAMA,GAC1CrD,EAAOhf,GAAK4gB,EACZU,EAAKM,EACLL,EAAKM,EAMN,GAHCpD,GADG6B,EACSM,EAEAA,EAAa5f,EAAKgS,QAAQyN,EAAa,GAChDrB,EACH,IAAK,IAAIpf,EAAI,EAAGA,EAAI2f,EAAa3f,IAChC8e,EAAO9e,IAAM4gB,EAGf,IAAI3B,EAAWpkB,KAAKokB,SAChBqD,EAAc,EAClB,IAAK,IAAItiB,EAAI,EAAG6gB,EAAI,EAAGC,EAAQ,EAAGyB,EAAU,EAAGviB,EAAI2f,EAAa3f,IAAK6gB,GAAK,EAAG,CAC5E,IAAIE,EAAQjC,EAAO9e,GACnBye,GAAYsC,EACZ,IAAI1F,EAAIoD,EAER,GAAIxL,EACHoI,GAAKuF,EACDvF,EAAI,IAAGA,GAAKuF,GAChBE,EAAQ,MACF,IAAIzF,EAAI,EAAG,CACjBxgB,KAAKomB,kBAAkB5F,EAAGvB,EAAO,EAAGyG,EAAKM,GACzC,QACD,CAAO,GAAIxF,EAAIuF,EAAY,CAC1B/lB,KAAKsmB,iBAAiB9F,EAAIuF,EAAY9G,EAAO0G,EAAiB,EAAGD,EAAKM,GACtE,QACD,EAGA,MAAQC,IAAS,CAChB,IAAIniB,EAASqgB,EAAO8B,GACpB,KAAIzF,EAAI1c,GAAR,CACA,GAAa,GAATmiB,EACHzF,GAAK1c,MACD,CACJ,IAAIyiB,EAAOpC,EAAO8B,EAAQ,GAC1BzF,GAAKA,EAAI+F,IAASziB,EAASyiB,EAC5B,CACA,KAPwB,CAQzB,CAGA,GAAIN,GAASJ,EAAW,CACvBA,EAAYI,EACZ,IAAI0B,EAAa,EAAR1B,EAmBT,IAlBAQ,EAAKxH,EAAM0I,GACXjB,EAAKzH,EAAM0I,EAAK,GAChBhB,EAAM1H,EAAM0I,EAAK,GACjBf,EAAM3H,EAAM0I,EAAK,GACjBd,EAAM5H,EAAM0I,EAAK,GACjBb,EAAM7H,EAAM0I,EAAK,GACjBZ,EAAK9H,EAAM0I,EAAK,GAChBX,EAAK/H,EAAM0I,EAAK,GAChBV,EAA8B,KAAtBR,EAAW,EAANE,EAAUE,GACvBK,EAA8B,KAAtBR,EAAW,EAANE,EAAUE,GACvBK,EAAsC,MAAf,GAAbR,EAAME,GAAWJ,EAAKM,GAChCK,EAAsC,MAAf,GAAbR,EAAME,GAAWJ,EAAKM,GAChCK,EAAc,EAAPJ,EAAWE,EAClBG,EAAc,EAAPJ,EAAWE,EAClBG,EAAmB,IAAZZ,EAAMF,GAAYQ,EAAe,UAARE,EAChCK,EAAmB,IAAZZ,EAAMF,GAAYQ,EAAe,UAARE,EAChCK,EAAc9iB,KAAK6M,KAAK+V,EAAMA,EAAMC,EAAMA,GAC1CpD,EAAS,GAAKqD,EACTE,EAAK,EAAGA,EAAK,EAAGA,IACpBJ,GAAOF,EACPG,GAAOF,EACPD,GAAQF,EACRG,GAAQF,EACRK,GAAe9iB,KAAK6M,KAAK+V,EAAMA,EAAMC,EAAMA,GAC3CpD,EAASuD,GAAMF,EAEhBF,GAAOF,EACPG,GAAOF,EACPG,GAAe9iB,KAAK6M,KAAK+V,EAAMA,EAAMC,EAAMA,GAC3CpD,EAAS,GAAKqD,EACdF,GAAOF,EAAOF,EACdK,GAAOF,EAAOF,EACdK,GAAe9iB,KAAK6M,KAAK+V,EAAMA,EAAMC,EAAMA,GAC3CpD,EAAS,GAAKqD,EACdC,EAAU,CACX,CAIA,IADAlH,GAAKiH,GACGC,IAAW,CAClB,IAAI5jB,EAASsgB,EAASsD,GACtB,KAAIlH,EAAI1c,GAAR,CACA,GAAe,GAAX4jB,EACHlH,GAAK1c,MACD,CACJ,IAAIyiB,EAAOnC,EAASsD,EAAU,GAC9BlH,EAAIkH,GAAWlH,EAAI+F,IAASziB,EAASyiB,EACtC,CACA,KAPwB,CAQzB,CACAvmB,KAAKwmB,iBAAqB,GAAJhG,EAASiG,EAAIC,EAAIC,EAAKC,EAAKC,EAAKC,EAAKC,EAAIC,EAAItB,EAAKM,EAAGvB,GAAatf,EAAI,GAAc,GAAT+gB,EAClG,CACA,OAAOR,CACR,CAEA,iBAAAU,CAAmB5F,EAAWoH,EAAqBziB,EAAWugB,EAAoBM,GACjF,IAAIS,EAAKmB,EAAKziB,GAAIuhB,EAAKkB,EAAKziB,EAAI,GAAImZ,EAAKsJ,EAAKziB,EAAI,GAAKshB,EAAIlI,EAAKqJ,EAAKziB,EAAI,GAAKuhB,EAAItX,EAAIzK,KAAKgU,MAAM4F,EAAID,GACrGoH,EAAIM,GAAKS,EAAKjG,EAAI7b,KAAK8L,IAAIrB,GAC3BsW,EAAIM,EAAI,GAAKU,EAAKlG,EAAI7b,KAAKiM,IAAIxB,GAC/BsW,EAAIM,EAAI,GAAK5W,CACd,CAEA,gBAAAkX,CAAkB9F,EAAWoH,EAAqBziB,EAAWugB,EAAoBM,GAChF,IAAIS,EAAKmB,EAAKziB,EAAI,GAAIuhB,EAAKkB,EAAKziB,EAAI,GAAImZ,EAAKmI,EAAKmB,EAAKziB,GAAIoZ,EAAKmI,EAAKkB,EAAKziB,EAAI,GAAIiK,EAAIzK,KAAKgU,MAAM4F,EAAID,GACrGoH,EAAIM,GAAKS,EAAKjG,EAAI7b,KAAK8L,IAAIrB,GAC3BsW,EAAIM,EAAI,GAAKU,EAAKlG,EAAI7b,KAAKiM,IAAIxB,GAC/BsW,EAAIM,EAAI,GAAK5W,CACd,CAEA,gBAAAoX,CAAkBhG,EAAWiG,EAAYC,EAAYC,EAAaC,EAAaC,EAAaC,EAAaC,EAAYC,EACpHtB,EAAoBM,EAAWvB,GAC/B,GAAS,GAALjE,GAAUqH,MAAMrH,GAInB,OAHAkF,EAAIM,GAAKS,EACTf,EAAIM,EAAI,GAAKU,OACbhB,EAAIM,EAAI,GAAKrhB,KAAKgU,MAAMiO,EAAMF,EAAIC,EAAMF,IAGzC,IAAIqB,EAAKtH,EAAIA,EAAGuH,EAAMD,EAAKtH,EAAG3e,EAAI,EAAI2e,EAAGwH,EAAKnmB,EAAIA,EAAGomB,EAAMD,EAAKnmB,EAC5DqmB,EAAKrmB,EAAI2e,EAAG2H,EAAW,EAALD,EAAQE,EAAOvmB,EAAIsmB,EAAKE,EAAOF,EAAM3H,EACvDhc,EAAIiiB,EAAKwB,EAAMtB,EAAMyB,EAAOvB,EAAMwB,EAAOtB,EAAKgB,EAAKrjB,EAAIgiB,EAAKuB,EAAMrB,EAAMwB,EAAOtB,EAAMuB,EAAOrB,EAAKe,EACrGrC,EAAIM,GAAKxhB,EACTkhB,EAAIM,EAAI,GAAKthB,EACT+f,IAEFiB,EAAIM,EAAI,GADLxF,EAAI,KACM7b,KAAKgU,MAAMiO,EAAMF,EAAIC,EAAMF,GAE3B9hB,KAAKgU,MAAMjU,GAAKgiB,EAAKsB,EAAKpB,EAAMsB,EAAK,EAAIpB,EAAMgB,GAAKtjB,GAAKiiB,EAAKuB,EAAKrB,EAAMuB,EAAK,EAAIrB,EAAMiB,IAExG,EC9ZM,MAAMQ,EAEZ3hB,KAGAqP,KAIAhG,MAIAuY,UAEAxR,WAEQyR,eAERC,gBAMAvS,OAAS,IAAIhT,MAEb,WAAApD,CAAa6G,EAAgBqP,GAC5B,GAAY,MAARrP,EAAc,MAAM,IAAI9F,MAAM,wBAClC,GAAY,MAARmV,EAAc,MAAM,IAAInV,MAAM,wBAClCb,KAAK2G,KAAOA,EACZ3G,KAAKgW,KAAOA,EACZhW,KAAKgQ,MAAQ,IAAIb,EACjBnP,KAAKuoB,UAA8B,MAAlB5hB,EAAK4hB,UAAoB,KAAO,IAAIpZ,EACrDnP,KAAKoc,gBACN,CAGA,WAAAsM,GACC,OAAO1oB,KAAKgW,KAAKD,QAClB,CAGA,aAAAuO,GACC,OAAOtkB,KAAK+W,UACb,CAIA,aAAA4R,CAAe5R,GACV/W,KAAK+W,YAAcA,IACvB/W,KAAK+W,WAAaA,EAClB/W,KAAKwoB,eAAiBxoB,KAAKgW,KAAKD,SAAS6S,KACzC5oB,KAAKkW,OAAOpS,OAAS,EACtB,CAEA,iBAAA+kB,CAAmBD,GAClB5oB,KAAKwoB,eAAiBxoB,KAAKgW,KAAKD,SAAS6S,KAAOA,CACjD,CAIA,iBAAAE,GACC,OAAO9oB,KAAKgW,KAAKD,SAAS6S,KAAO5oB,KAAKwoB,cACvC,CAGA,cAAApM,GACCpc,KAAKgQ,MAAMN,aAAa1P,KAAK2G,KAAKqJ,OACZ,MAAlBhQ,KAAKuoB,WAAmBvoB,KAAKuoB,UAAU7Y,aAAa1P,KAAK2G,KAAK4hB,WAClC,MAA5BvoB,KAAK2G,KAAKoiB,eACb/oB,KAAK+W,WAAa,MAElB/W,KAAK+W,WAAa,KAClB/W,KAAK2oB,cAAc3oB,KAAKgW,KAAKD,SAASuO,cAActkB,KAAK2G,KAAK9B,MAAO7E,KAAK2G,KAAKoiB,iBAEjF,EC3EM,MAAMC,EAGZriB,KAGA0O,MAGAsK,OAGAmE,UAAY,EAGZC,aAAe,EAGfkF,SAAW,EAGXC,SAAW,EAEXtB,KAAO,IAAIhU,EACXuI,QAAS,EAET,WAAArc,CAAa6G,EAA+BoP,GAC3C,GAAY,MAARpP,EAAc,MAAM,IAAI9F,MAAM,wBAClC,GAAgB,MAAZkV,EAAkB,MAAM,IAAIlV,MAAM,4BACtCb,KAAK2G,KAAOA,EACZ3G,KAAK8jB,UAAYnd,EAAKmd,UACtB9jB,KAAK+jB,aAAepd,EAAKod,aACzB/jB,KAAKipB,SAAWtiB,EAAKsiB,SACrBjpB,KAAKkpB,SAAWviB,EAAKuiB,SACrBlpB,KAAKqV,MAAQ,IAAInS,MACjB,IAAK,IAAIiC,EAAI,EAAGA,EAAIwB,EAAK0O,MAAMvR,OAAQqB,IACtCnF,KAAKqV,MAAMtQ,KAAKgR,EAASkK,SAAStZ,EAAK0O,MAAMlQ,GAAGlB,OACjDjE,KAAK2f,OAAS5J,EAASkK,SAAStZ,EAAKgZ,OAAO1b,KAC7C,CAEA,QAAAoY,GACC,OAAOrc,KAAKmc,MACb,CAGA,KAAA+D,GACClgB,KAAKyN,QACN,CAEA,MAAAA,GACKzN,KAAK2G,KAAKyY,MACTpf,KAAK2G,KAAKwiB,SACbnpB,KAAKopB,qBAELppB,KAAKqpB,qBAGFrpB,KAAK2G,KAAKwiB,SACbnpB,KAAKspB,qBAELtpB,KAAKupB,oBAER,CAEA,kBAAAA,GACC,IAAIzF,EAAY9jB,KAAK8jB,UAAWC,EAAe/jB,KAAK+jB,aAAckF,EAAWjpB,KAAKipB,SAAUC,EAAWlpB,KAAKkpB,SACxGvJ,EAAS3f,KAAK2f,OACd2C,EAAK3C,EAAOpQ,EAAGia,EAAK7J,EAAOrQ,EAAGma,EAAK9J,EAAOhQ,EAAGsS,EAAKtC,EAAOpO,EACzDmY,EAAgBpH,EAAKL,EAAKuH,EAAKC,EAAK,EAAIvZ,EAAUQ,QAAUR,EAAUQ,OACtEiT,EAAiB3jB,KAAK2G,KAAKgd,eAAiB+F,EAC5CC,EAAe3pB,KAAK2G,KAAKgjB,aAAeD,EACxCrU,EAAQrV,KAAKqV,MACjB,IAAK,IAAIlQ,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAI6Q,EAAOX,EAAMlQ,GACbykB,GAAW,EAEf,GAAiB,GAAb9F,EAAgB,CACnB,IAAIvU,EAAIyG,EAAKzG,EAAGD,EAAI0G,EAAK1G,EAAGK,EAAIqG,EAAKrG,EAAG4B,EAAIyE,EAAKzE,EAC7CnC,EAAIzK,KAAKgU,MAAM8Q,EAAInH,GAAM3d,KAAKgU,MAAMhJ,EAAGJ,GAAKoU,EAC5CvU,EAAIc,EAAUC,GACjBf,GAAKc,EAAUsV,IACPpW,GAAKc,EAAUC,KACvBf,GAAKc,EAAUsV,KAChBpW,GAAK0U,EACL,IAAIrT,EAAM9L,KAAK8L,IAAIrB,GAAIwB,EAAMjM,KAAKiM,IAAIxB,GACtC4G,EAAKzG,EAAIkB,EAAMlB,EAAIqB,EAAMjB,EACzBqG,EAAK1G,EAAImB,EAAMnB,EAAIsB,EAAMW,EACzByE,EAAKrG,EAAIiB,EAAMrB,EAAIkB,EAAMd,EACzBqG,EAAKzE,EAAIX,EAAMtB,EAAImB,EAAMc,EACzBqY,GAAW,CACZ,CAEA,GAAoB,GAAhB7F,EAAmB,CACtB,IAAI6D,EAAO5nB,KAAK4nB,KAChBjI,EAAOR,aAAayI,EAAKpY,IAAIxP,KAAK2G,KAAKvE,QAASpC,KAAK2G,KAAKtE,UAC1D2T,EAAKG,SAAWyR,EAAKpjB,EAAIwR,EAAKG,QAAU4N,EACxC/N,EAAKI,SAAWwR,EAAKljB,EAAIsR,EAAKI,QAAU2N,EACxC6F,GAAW,CACZ,CAEA,GAAIX,EAAW,EAAG,CACjB,IAAI5L,EAAI1Y,KAAK6M,KAAKwE,EAAKzG,EAAIyG,EAAKzG,EAAIyG,EAAKrG,EAAIqG,EAAKrG,GAC9Cka,EAAKllB,KAAK6M,KAAK8Q,EAAKA,EAAKmH,EAAKA,GAC9BpM,EAAI,OAASA,GAAKA,GAAKwM,EAAKxM,EAAIrd,KAAK2G,KAAKmjB,cAAgBb,GAAY5L,GAC1ErH,EAAKzG,GAAK8N,EACVrH,EAAKrG,GAAK0N,EACVA,EAAI1Y,KAAK6M,KAAKwE,EAAK1G,EAAI0G,EAAK1G,EAAI0G,EAAKzE,EAAIyE,EAAKzE,GAC9CsY,EAAKllB,KAAK6M,KAAKgY,EAAKA,EAAKvH,EAAKA,GAC1B5E,EAAI,OAASA,GAAKA,GAAKwM,EAAKxM,EAAIrd,KAAK2G,KAAKojB,cAAgBd,GAAY5L,GAC1ErH,EAAK1G,GAAK+N,EACVrH,EAAKzE,GAAK8L,EACVuM,GAAW,CACZ,CAEA,GAAIV,EAAW,EAAG,CACjB,IAAI5Z,EAAI0G,EAAK1G,EAAGiC,EAAIyE,EAAKzE,EACrByY,EAAKrlB,KAAKgU,MAAMpH,EAAGjC,GACnBF,EAAIzK,KAAKgU,MAAMsJ,EAAIuH,GAAM7kB,KAAKgU,MAAM8Q,EAAInH,IAAO0H,EAAKrlB,KAAKgU,MAAM3C,EAAKrG,EAAGqG,EAAKzG,IAC5EH,EAAIc,EAAUC,GACjBf,GAAKc,EAAUsV,IACPpW,GAAKc,EAAUC,KACvBf,GAAKc,EAAUsV,KAChBpW,EAAI4a,GAAM5a,EAAIua,GAAgBT,EAC9B,IAAI7L,EAAI1Y,KAAK6M,KAAKlC,EAAIA,EAAIiC,EAAIA,GAC9ByE,EAAK1G,EAAI3K,KAAK8L,IAAIrB,GAAKiO,EACvBrH,EAAKzE,EAAI5M,KAAKiM,IAAIxB,GAAKiO,EACvBuM,GAAW,CACZ,CAEIA,IAAU5T,EAAKiG,cAAe,EACnC,CACD,CAEA,kBAAAqN,GACC,IAAIxF,EAAY9jB,KAAK8jB,UAAWC,EAAe/jB,KAAK+jB,aAAckF,EAAWjpB,KAAKipB,SAAUC,EAAWlpB,KAAKkpB,SACxGvJ,EAAS3f,KAAK2f,OACd2C,EAAK3C,EAAOpQ,EAAGia,EAAK7J,EAAOrQ,EAAGma,EAAK9J,EAAOhQ,EAAGsS,EAAKtC,EAAOpO,EACzDmY,EAAgBpH,EAAKL,EAAKuH,EAAKC,EAAK,EAAIvZ,EAAUQ,QAAUR,EAAUQ,OACtEiT,EAAiB3jB,KAAK2G,KAAKgd,eAAiB+F,EAAeC,EAAe3pB,KAAK2G,KAAKgjB,aAAeD,EACnGrU,EAAQrV,KAAKqV,MACjB,IAAK,IAAIlQ,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAI6Q,EAAOX,EAAMlQ,GACbykB,GAAW,EAEf,GAAiB,GAAb9F,EAAgB,CACnB,IAAIvU,EAAIyG,EAAKzG,EAAGD,EAAI0G,EAAK1G,EAAGK,EAAIqG,EAAKrG,EAAG4B,EAAIyE,EAAKzE,EAC7CnC,EAAIzK,KAAKgU,MAAM8Q,EAAInH,GAAMqB,EACzBvU,EAAIc,EAAUC,GACjBf,GAAKc,EAAUsV,IACPpW,GAAKc,EAAUC,KAAIf,GAAKc,EAAUsV,KAC3CpW,GAAK0U,EACL,IAAIrT,EAAM9L,KAAK8L,IAAIrB,GAAIwB,EAAMjM,KAAKiM,IAAIxB,GACtC4G,EAAKzG,EAAIkB,EAAMlB,EAAIqB,EAAMjB,EACzBqG,EAAK1G,EAAImB,EAAMnB,EAAIsB,EAAMW,EACzByE,EAAKrG,EAAIiB,EAAMrB,EAAIkB,EAAMd,EACzBqG,EAAKzE,EAAIX,EAAMtB,EAAImB,EAAMc,EACzBqY,GAAW,CACZ,CAEA,GAAoB,GAAhB7F,EAAmB,CACtB,IAAI6D,EAAO5nB,KAAK4nB,KAChBjI,EAAOR,aAAayI,EAAKpY,IAAIxP,KAAK2G,KAAKvE,QAASpC,KAAK2G,KAAKtE,UAC1D2T,EAAKG,QAAUyR,EAAKpjB,EAAIuf,EACxB/N,EAAKI,QAAUwR,EAAKljB,EAAIqf,EACxB6F,GAAW,CACZ,CAEA,GAAIX,EAAW,EAAG,CACjB,IAAI5L,GAAK1Y,KAAK6M,KAAK8Q,EAAKA,EAAKmH,EAAKA,GAAM,EAAIzpB,KAAK2G,KAAKmjB,cAAgBb,EAAW,EACjFjT,EAAKzG,GAAK8N,EACVrH,EAAKrG,GAAK0N,EACVA,GAAK1Y,KAAK6M,KAAKgY,EAAKA,EAAKvH,EAAKA,GAAM,EAAIjiB,KAAK2G,KAAKojB,cAAgBd,EAAW,EAC7EjT,EAAK1G,GAAK+N,EACVrH,EAAKzE,GAAK8L,EACVuM,GAAW,CACZ,CAEA,GAAIV,EAAW,EAAG,CACjB,IAAI9Z,EAAIzK,KAAKgU,MAAMsJ,EAAIuH,GAAM7kB,KAAKgU,MAAM8Q,EAAInH,GACxClT,EAAIc,EAAUC,GACjBf,GAAKc,EAAUsV,IACPpW,GAAKc,EAAUC,KAAIf,GAAKc,EAAUsV,KAC3C,IAAIlW,EAAI0G,EAAK1G,EAAGiC,EAAIyE,EAAKzE,EACzBnC,EAAIzK,KAAKgU,MAAMpH,EAAGjC,IAAMF,EAAIc,EAAUC,GAAK,EAAIwZ,GAAgBT,EAC/D,IAAI7L,EAAI1Y,KAAK6M,KAAKlC,EAAIA,EAAIiC,EAAIA,GAC9ByE,EAAK1G,EAAI3K,KAAK8L,IAAIrB,GAAKiO,EACvBrH,EAAKzE,EAAI5M,KAAKiM,IAAIxB,GAAKiO,EACvBuM,GAAW,CACZ,CAEIA,IAAU5T,EAAKiG,cAAe,EACnC,CACD,CAEA,kBAAAoN,GACC,IAAIvF,EAAY9jB,KAAK8jB,UAAWC,EAAe/jB,KAAK+jB,aAAckF,EAAWjpB,KAAKipB,SAAUC,EAAWlpB,KAAKkpB,SACxGvJ,EAAS3f,KAAK2f,OACbA,EAAO1D,cAAc0D,EAAOvB,yBACjC,IAAI/I,EAAQrV,KAAKqV,MACjB,IAAK,IAAIlQ,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAI6Q,EAAOX,EAAMlQ,GACZ6Q,EAAKiG,cAAcjG,EAAKoI,yBAE7B,IAAI7F,EAAWvC,EAAK4F,UACpB,GAAiB,GAAbkI,EAAgB,CACnB,IAAI1U,EAAIuQ,EAAO/D,UAAYrD,EAAWvY,KAAK2G,KAAKgd,eAChDvU,GAAsD,KAAhD,OAAU,mBAAqBA,EAAI,IAAO,IAChDmJ,GAAYnJ,EAAI0U,CACjB,CAEA,IAAItf,EAAIwR,EAAK0F,GAAIhX,EAAIsR,EAAK2F,GACN,GAAhBoI,IACHvf,IAAMmb,EAAOjE,GAAKlX,EAAIxE,KAAK2G,KAAKvE,SAAW2hB,EAC3Crf,IAAMib,EAAOhE,GAAKjX,EAAI1E,KAAK2G,KAAKtE,SAAW0hB,GAG5C,IAAIjL,EAAS9C,EAAK6F,QAAS9C,EAAS/C,EAAK8F,QACzB,GAAZmN,IACCnQ,EAAS,OAASA,GAAUA,GAAU6G,EAAO9D,QAAU/C,EAAS9Y,KAAK2G,KAAKmjB,cAAgBb,GAAYnQ,GACtGC,EAAS,OAASA,GAAUA,GAAU4G,EAAO7D,QAAU/C,EAAS/Y,KAAK2G,KAAKojB,cAAgBd,GAAYlQ,IAG3G,IAAIsC,EAASrF,EAAKgG,QAClB,GAAgB,GAAZkN,EAAe,CAClB,IAAI9Z,EAAIuQ,EAAO3D,QAAUX,EAASrb,KAAK2G,KAAKgjB,aAC5Cva,GAAsD,KAAhD,OAAU,mBAAqBA,EAAI,IAAO,IAChD4G,EAAKqF,QAAUjM,EAAI8Z,CACpB,CAEAlT,EAAKsG,yBAAyB9X,EAAGE,EAAG6T,EAAUO,EAAQC,EAAQ/C,EAAK+F,QAASV,EAC7E,CACD,CAEA,kBAAA+N,GACC,IAAItF,EAAY9jB,KAAK8jB,UAAWC,EAAe/jB,KAAK+jB,aAAckF,EAAWjpB,KAAKipB,SAAUC,EAAWlpB,KAAKkpB,SACxGvJ,EAAS3f,KAAK2f,OACbA,EAAO1D,cAAc0D,EAAOvB,yBACjC,IAAI/I,EAAQrV,KAAKqV,MACjB,IAAK,IAAIlQ,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAI6Q,EAAOX,EAAMlQ,GACZ6Q,EAAKiG,cAAcjG,EAAKoI,yBAE7B,IAAI7F,EAAWvC,EAAK4F,UACH,GAAbkI,IAAgBvL,IAAaoH,EAAO/D,UAAY5b,KAAK2G,KAAKgd,gBAAkBG,GAEhF,IAAItf,EAAIwR,EAAK0F,GAAIhX,EAAIsR,EAAK2F,GACN,GAAhBoI,IACHvf,IAAMmb,EAAOjE,GAAK1b,KAAK2G,KAAKvE,SAAW2hB,EACvCrf,IAAMib,EAAOhE,GAAK3b,KAAK2G,KAAKtE,SAAW0hB,GAGxC,IAAIjL,EAAS9C,EAAK6F,QAAS9C,EAAS/C,EAAK8F,QACzB,GAAZmN,IACCnQ,EAAS,OAASA,IAAY6G,EAAO9D,QAAU,EAAI7b,KAAK2G,KAAKmjB,cAAgBb,EAAY,GACzFlQ,EAAS,OAASA,IAAY4G,EAAO7D,QAAU,EAAI9b,KAAK2G,KAAKojB,cAAgBd,EAAY,IAG9F,IAAI5N,EAASrF,EAAKgG,QACF,GAAZkN,IAAe7N,IAAWsE,EAAO3D,QAAUhc,KAAK2G,KAAKgjB,cAAgBT,GAEzElT,EAAKsG,yBAAyB9X,EAAGE,EAAG6T,EAAUO,EAAQC,EAAQ/C,EAAK+F,QAASV,EAC7E,CACD,EC/PM,MAAM4O,EAEZtjB,KAGA0O,MAGA6U,MAGAC,UAGAC,cAGAC,qBAGAC,gBAGAC,aAAe,IAAIrnB,MACnBsnB,iBAAmB,IAAItnB,MAGvB2X,KAGA7K,MAKA4Y,KAAO,EAIP9P,OAAS,EAITC,OAAS,EAGTvU,EAAI,EAGJE,EAAI,EAEJ,WAAA5E,CAAa6G,GACZ,GAAY,MAARA,EAAc,MAAM,IAAI9F,MAAM,wBAClCb,KAAK2G,KAAOA,EAEZ3G,KAAKqV,MAAQ,IAAInS,MACjB,IAAK,IAAIiC,EAAI,EAAGA,EAAIwB,EAAK0O,MAAMvR,OAAQqB,IAAK,CAC3C,IACI6Q,EADAyU,EAAW9jB,EAAK0O,MAAMlQ,GAE1B,GAAuB,MAAnBslB,EAASzhB,OACZgN,EAAO,IAAIwF,EAAKiP,EAAUzqB,KAAM,UAC5B,CACJ,IAAIgJ,EAAShJ,KAAKqV,MAAMoV,EAASzhB,OAAOnE,OACxCmR,EAAO,IAAIwF,EAAKiP,EAAUzqB,KAAMgJ,GAChCA,EAAOyS,SAAS1W,KAAKiR,EACtB,CACAhW,KAAKqV,MAAMtQ,KAAKiR,EACjB,CAEAhW,KAAKkqB,MAAQ,IAAIhnB,MACjBlD,KAAKmqB,UAAY,IAAIjnB,MACrB,IAAK,IAAIiC,EAAI,EAAGA,EAAIwB,EAAKujB,MAAMpmB,OAAQqB,IAAK,CAC3C,IAAIulB,EAAW/jB,EAAKujB,MAAM/kB,GACtB6Q,EAAOhW,KAAKqV,MAAMqV,EAASD,SAAS5lB,OACpC6Q,EAAO,IAAI4S,EAAKoC,EAAU1U,GAC9BhW,KAAKkqB,MAAMnlB,KAAK2Q,GAChB1V,KAAKmqB,UAAUplB,KAAK2Q,EACrB,CAEA1V,KAAKoqB,cAAgB,IAAIlnB,MACzB,IAAK,IAAIiC,EAAI,EAAGA,EAAIwB,EAAKyjB,cAActmB,OAAQqB,IAAK,CACnD,IAAIwlB,EAAmBhkB,EAAKyjB,cAAcjlB,GAC1CnF,KAAKoqB,cAAcrlB,KAAK,IAAI2a,EAAaiL,EAAkB3qB,MAC5D,CAEAA,KAAKqqB,qBAAuB,IAAInnB,MAChC,IAAK,IAAIiC,EAAI,EAAGA,EAAIwB,EAAK0jB,qBAAqBvmB,OAAQqB,IAAK,CAC1D,IAAIylB,EAA0BjkB,EAAK0jB,qBAAqBllB,GACxDnF,KAAKqqB,qBAAqBtlB,KAAK,IAAIikB,EAAoB4B,EAAyB5qB,MACjF,CAEAA,KAAKsqB,gBAAkB,IAAIpnB,MAC3B,IAAK,IAAIiC,EAAI,EAAGA,EAAIwB,EAAK2jB,gBAAgBxmB,OAAQqB,IAAK,CACrD,IAAI0lB,EAAqBlkB,EAAK2jB,gBAAgBnlB,GAC9CnF,KAAKsqB,gBAAgBvlB,KAAK,IAAIif,EAAe6G,EAAoB7qB,MAClE,CAEAA,KAAKgQ,MAAQ,IAAIb,EAAM,EAAG,EAAG,EAAG,GAChCnP,KAAK8qB,aACN,CAIA,WAAAA,GACmB9qB,KAAKuqB,aACXzmB,OAAS,EACrB9D,KAAKwqB,iBAAiB1mB,OAAS,EAE/B,IAAIuR,EAAQrV,KAAKqV,MACjB,IAAK,IAAIlQ,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAI6Q,EAAOX,EAAMlQ,GACjB6Q,EAAKkG,OAASlG,EAAKrP,KAAK4U,aACxBvF,EAAKmG,QAAUnG,EAAKkG,MACrB,CAEA,GAAiB,MAAblc,KAAK6a,KAAc,CACtB,IAAIkQ,EAAY/qB,KAAK6a,KAAKxF,MAC1B,IAAK,IAAIlQ,EAAI,EAAGqG,EAAIxL,KAAK6a,KAAKxF,MAAMvR,OAAQqB,EAAIqG,EAAGrG,IAAK,CACvD,IAAI6Q,EAAOhW,KAAKqV,MAAM0V,EAAU5lB,GAAGN,OACnC,GACCmR,EAAKkG,QAAS,EACdlG,EAAKmG,QAAS,EACdnG,EAAOA,EAAKhN,aACI,MAARgN,EACV,CACD,CAGA,IAAIoU,EAAgBpqB,KAAKoqB,cACrBC,EAAuBrqB,KAAKqqB,qBAC5BC,EAAkBtqB,KAAKsqB,gBACvBU,EAAUZ,EAActmB,OAAQmnB,EAAiBZ,EAAqBvmB,OAAQonB,EAAYZ,EAAgBxmB,OAC1GqnB,EAAkBH,EAAUC,EAAiBC,EAEjD/I,EACA,IAAK,IAAIhd,EAAI,EAAGA,EAAIgmB,EAAiBhmB,IAAK,CACzC,IAAK,IAAIwiB,EAAK,EAAGA,EAAKqD,EAASrD,IAAM,CACpC,IAAIyD,EAAahB,EAAczC,GAC/B,GAAIyD,EAAWzkB,KAAK2c,OAASne,EAAG,CAC/BnF,KAAKqrB,iBAAiBD,GACtB,SAASjJ,CACV,CACD,CACA,IAAK,IAAIwF,EAAK,EAAGA,EAAKsD,EAAgBtD,IAAM,CAC3C,IAAIyD,EAAaf,EAAqB1C,GACtC,GAAIyD,EAAWzkB,KAAK2c,OAASne,EAAG,CAC/BnF,KAAKsrB,wBAAwBF,GAC7B,SAASjJ,CACV,CACD,CACA,IAAK,IAAIwF,EAAK,EAAGA,EAAKuD,EAAWvD,IAAM,CACtC,IAAIyD,EAAad,EAAgB3C,GACjC,GAAIyD,EAAWzkB,KAAK2c,OAASne,EAAG,CAC/BnF,KAAKurB,mBAAmBH,GACxB,SAASjJ,CACV,CACD,CACD,CAEA,IAAK,IAAIhd,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IACxCnF,KAAKwrB,SAASnW,EAAMlQ,GACtB,CAEA,gBAAAkmB,CAAkBD,GAEjB,GADAA,EAAWjP,OAASiP,EAAWzL,OAAOtD,cAAgB+O,EAAWzkB,KAAK4U,cAA8B,MAAbvb,KAAK6a,MAAgBpJ,EAAMzC,SAAShP,KAAK6a,KAAK4Q,YAAaL,EAAWzkB,MAAM,KAC9JykB,EAAWjP,OAAQ,OAExB,IAAIwD,EAASyL,EAAWzL,OACxB3f,KAAKwrB,SAAS7L,GAEd,IAAI+L,EAAcN,EAAW/V,MACzBrM,EAAS0iB,EAAY,GAGzB,GAFA1rB,KAAKwrB,SAASxiB,GAEV0iB,EAAY5nB,OAAS,EAAG,CAC3B,IAAIgd,EAAQ4K,EAAYA,EAAY5nB,OAAS,GACvC9D,KAAKuqB,aAAahlB,QAAQub,IAAU,GAAI9gB,KAAKwqB,iBAAiBzlB,KAAK+b,EAC1E,CAEA9gB,KAAKuqB,aAAaxlB,KAAKqmB,GAEvBprB,KAAK2rB,UAAU3iB,EAAOyS,UACtBiQ,EAAYA,EAAY5nB,OAAS,GAAGoY,QAAS,CAC9C,CAEA,kBAAAqP,CAAoBH,GAEnB,GADAA,EAAWjP,OAASiP,EAAWzL,OAAO3J,KAAKqG,cAAgB+O,EAAWzkB,KAAK4U,cAA8B,MAAbvb,KAAK6a,MAAgBpJ,EAAMzC,SAAShP,KAAK6a,KAAK4Q,YAAaL,EAAWzkB,MAAM,KACnKykB,EAAWjP,OAAQ,OAExB,IAAIzG,EAAO0V,EAAWzL,OAClBiM,EAAYlW,EAAK/O,KAAK9B,MACtBgnB,EAAWnW,EAAKM,KACH,MAAbhW,KAAK6a,MAAc7a,KAAK8rB,6BAA6B9rB,KAAK6a,KAAM+Q,EAAWC,GAClD,MAAzB7rB,KAAK2G,KAAKolB,aAAuB/rB,KAAK2G,KAAKolB,aAAe/rB,KAAK6a,MAClE7a,KAAK8rB,6BAA6B9rB,KAAK2G,KAAKolB,YAAaH,EAAWC,GACrE,IAAK,IAAI1mB,EAAI,EAAGqG,EAAIxL,KAAK2G,KAAKqlB,MAAMloB,OAAQqB,EAAIqG,EAAGrG,IAClDnF,KAAK8rB,6BAA6B9rB,KAAK2G,KAAKqlB,MAAM7mB,GAAIymB,EAAWC,GAElE,IAAI9U,EAAarB,EAAK4O,gBAClBvN,aAAsBmB,GAAgBlY,KAAKisB,iCAAiClV,EAAY8U,GAE5F,IAAIH,EAAcN,EAAW/V,MACzBwP,EAAY6G,EAAY5nB,OAC5B,IAAK,IAAIqB,EAAI,EAAGA,EAAI0f,EAAW1f,IAC9BnF,KAAKwrB,SAASE,EAAYvmB,IAE3BnF,KAAKuqB,aAAaxlB,KAAKqmB,GAEvB,IAAK,IAAIjmB,EAAI,EAAGA,EAAI0f,EAAW1f,IAC9BnF,KAAK2rB,UAAUD,EAAYvmB,GAAGsW,UAC/B,IAAK,IAAItW,EAAI,EAAGA,EAAI0f,EAAW1f,IAC9BumB,EAAYvmB,GAAG+W,QAAS,CAC1B,CAEA,uBAAAoP,CAAyBF,GAExB,GADAA,EAAWjP,OAASiP,EAAWzL,OAAOtD,cAAgB+O,EAAWzkB,KAAK4U,cAA8B,MAAbvb,KAAK6a,MAAgBpJ,EAAMzC,SAAShP,KAAK6a,KAAK4Q,YAAaL,EAAWzkB,MAAM,KAC9JykB,EAAWjP,OAAQ,OAExBnc,KAAKwrB,SAASJ,EAAWzL,QAEzB,IAAI+L,EAAcN,EAAW/V,MACzBwP,EAAY6G,EAAY5nB,OAC5B,GAAIsnB,EAAWzkB,KAAKyY,MACnB,IAAK,IAAIja,EAAI,EAAGA,EAAI0f,EAAW1f,IAAK,CACnC,IAAI2b,EAAQ4K,EAAYvmB,GACxBnF,KAAKwrB,SAAS1K,EAAM9X,QACdhJ,KAAKuqB,aAAahlB,QAAQub,IAAU,GAAI9gB,KAAKwqB,iBAAiBzlB,KAAK+b,EAC1E,MAEA,IAAK,IAAI3b,EAAI,EAAGA,EAAI0f,EAAW1f,IAC9BnF,KAAKwrB,SAASE,EAAYvmB,IAI5BnF,KAAKuqB,aAAaxlB,KAAKqmB,GAEvB,IAAK,IAAIzD,EAAK,EAAGA,EAAK9C,EAAW8C,IAChC3nB,KAAK2rB,UAAUD,EAAY/D,GAAIlM,UAChC,IAAK,IAAIkM,EAAK,EAAGA,EAAK9C,EAAW8C,IAChC+D,EAAY/D,GAAIzL,QAAS,CAC3B,CAEA,4BAAA4P,CAA8BjR,EAAY+Q,EAAmBC,GAC5D,IAAIK,EAAcrR,EAAKqR,YAAYN,GACnC,GAAKM,EACL,IAAK,IAAI9hB,KAAO8hB,EACflsB,KAAKisB,iCAAiCC,EAAY9hB,GAAMyhB,EAE1D,CAEA,gCAAAI,CAAkClV,EAAwB8U,GACzD,KAAM9U,aAAsBmB,GAAiB,OAC7C,IAAIiU,EAA6BpV,EAAY1B,MAC7C,GAAiB,MAAb8W,EACHnsB,KAAKwrB,SAASK,OACV,CACJ,IAAIxW,EAAQrV,KAAKqV,MACblQ,EAAI,EACR,KAAOA,EAAIgnB,EAAUroB,QAAQ,CAC5B,IAAI+gB,EAAYsH,EAAUhnB,KAC1B,IAAK,IAAIqG,EAAIrG,EAAI0f,EAAW1f,EAAIqG,EAAGrG,IAAK,CACvC,IAAIinB,EAAYD,EAAUhnB,GAC1BnF,KAAKwrB,SAASnW,EAAM+W,GACrB,CACD,CACD,CACD,CAEA,QAAAZ,CAAUxV,GACT,GAAIA,EAAKkG,OAAQ,OACjB,IAAIlT,EAASgN,EAAKhN,OACJ,MAAVA,GAAgBhJ,KAAKwrB,SAASxiB,GAClCgN,EAAKkG,QAAS,EACdlc,KAAKuqB,aAAaxlB,KAAKiR,EACxB,CAEA,SAAA2V,CAAWtW,GACV,IAAK,IAAIlQ,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAI6Q,EAAOX,EAAMlQ,GACZ6Q,EAAKmG,SACNnG,EAAKkG,QAAQlc,KAAK2rB,UAAU3V,EAAKyF,UACrCzF,EAAKkG,QAAS,EACf,CACD,CAMA,oBAAAK,GACC,IAAIiO,EAAmBxqB,KAAKwqB,iBAC5B,IAAK,IAAIrlB,EAAI,EAAGqG,EAAIgf,EAAiB1mB,OAAQqB,EAAIqG,EAAGrG,IAAK,CACxD,IAAI6Q,EAAOwU,EAAiBrlB,GAC5B6Q,EAAK0F,GAAK1F,EAAKxR,EACfwR,EAAK2F,GAAK3F,EAAKtR,EACfsR,EAAK4F,UAAY5F,EAAKuC,SACtBvC,EAAK6F,QAAU7F,EAAK8C,OACpB9C,EAAK8F,QAAU9F,EAAK+C,OACpB/C,EAAK+F,QAAU/F,EAAKoF,OACpBpF,EAAKgG,QAAUhG,EAAKqF,OACpBrF,EAAKiG,cAAe,CACrB,CACA,IAAI6O,EAAc9qB,KAAKuqB,aACvB,IAAK,IAAIplB,EAAI,EAAGqG,EAAIsf,EAAYhnB,OAAQqB,EAAIqG,EAAGrG,IAC9C2lB,EAAY3lB,GAAGsI,QACjB,CAGA,cAAA2O,GACCpc,KAAKqsB,sBACLrsB,KAAKssB,qBACN,CAGA,mBAAAD,GACC,IAAIhX,EAAQrV,KAAKqV,MACjB,IAAK,IAAIlQ,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IACxCkQ,EAAMlQ,GAAGiX,iBAEV,IAAIgO,EAAgBpqB,KAAKoqB,cACzB,IAAK,IAAIjlB,EAAI,EAAGqG,EAAI4e,EAActmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CACrD,IAAIimB,EAAahB,EAAcjlB,GAC/BimB,EAAWrL,IAAMqL,EAAWzkB,KAAKoZ,IACjCqL,EAAWpL,SAAWoL,EAAWzkB,KAAKqZ,SACtCoL,EAAWxL,cAAgBwL,EAAWzkB,KAAKiZ,cAC3CwL,EAAWvL,SAAWuL,EAAWzkB,KAAKkZ,SACtCuL,EAAWtL,QAAUsL,EAAWzkB,KAAKmZ,OACtC,CAEA,IAAIuK,EAAuBrqB,KAAKqqB,qBAChC,IAAK,IAAIllB,EAAI,EAAGqG,EAAI6e,EAAqBvmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC5D,IAAIimB,EAAaf,EAAqBllB,GAClCwB,EAAOykB,EAAWzkB,KACtBykB,EAAWtH,UAAYnd,EAAKmd,UAC5BsH,EAAWrH,aAAepd,EAAKod,aAC/BqH,EAAWnC,SAAWtiB,EAAKsiB,SAC3BmC,EAAWlC,SAAWviB,EAAKuiB,QAC5B,CAEA,IAAIoB,EAAkBtqB,KAAKsqB,gBAC3B,IAAK,IAAInlB,EAAI,EAAGqG,EAAI8e,EAAgBxmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CACvD,IAAIimB,EAAad,EAAgBnlB,GAC7BwB,EAAOykB,EAAWzkB,KACtBykB,EAAWxH,SAAWjd,EAAKid,SAC3BwH,EAAWvH,QAAUld,EAAKkd,QAC1BuH,EAAWtH,UAAYnd,EAAKmd,UAC5BsH,EAAWrH,aAAepd,EAAKod,YAChC,CACD,CAGA,mBAAAuI,GACC,IAAIpC,EAAQlqB,KAAKkqB,MACjBzY,EAAMC,UAAUwY,EAAO,EAAGlqB,KAAKmqB,UAAW,EAAGD,EAAMpmB,QACnD,IAAK,IAAIqB,EAAI,EAAGqG,EAAI0e,EAAMpmB,OAAQqB,EAAIqG,EAAGrG,IACxC+kB,EAAM/kB,GAAGiX,gBACX,CAGA,WAAAmQ,GACC,OAAyB,GAArBvsB,KAAKqV,MAAMvR,OAAoB,KAC5B9D,KAAKqV,MAAM,EACnB,CAGA,QAAA4K,CAAUuM,GACT,GAAgB,MAAZA,EAAkB,MAAM,IAAI3rB,MAAM,4BACtC,IAAIwU,EAAQrV,KAAKqV,MACjB,IAAK,IAAIlQ,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAI6Q,EAAOX,EAAMlQ,GACjB,GAAI6Q,EAAKrP,KAAK1C,MAAQuoB,EAAU,OAAOxW,CACxC,CACA,OAAO,IACR,CAGA,aAAAyW,CAAeD,GACd,GAAgB,MAAZA,EAAkB,MAAM,IAAI3rB,MAAM,4BACtC,IAAIwU,EAAQrV,KAAKqV,MACjB,IAAK,IAAIlQ,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IACxC,GAAIkQ,EAAMlQ,GAAGwB,KAAK1C,MAAQuoB,EAAU,OAAOrnB,EAC5C,OAAQ,CACT,CAKA,QAAAkf,CAAUqI,GACT,GAAgB,MAAZA,EAAkB,MAAM,IAAI7rB,MAAM,4BACtC,IAAIqpB,EAAQlqB,KAAKkqB,MACjB,IAAK,IAAI/kB,EAAI,EAAGqG,EAAI0e,EAAMpmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAIuQ,EAAOwU,EAAM/kB,GACjB,GAAIuQ,EAAK/O,KAAK1C,MAAQyoB,EAAU,OAAOhX,CACxC,CACA,OAAO,IACR,CAGA,aAAAiX,CAAeD,GACd,GAAgB,MAAZA,EAAkB,MAAM,IAAI7rB,MAAM,4BACtC,IAAIqpB,EAAQlqB,KAAKkqB,MACjB,IAAK,IAAI/kB,EAAI,EAAGqG,EAAI0e,EAAMpmB,OAAQqB,EAAIqG,EAAGrG,IACxC,GAAI+kB,EAAM/kB,GAAGwB,KAAK1C,MAAQyoB,EAAU,OAAOvnB,EAC5C,OAAQ,CACT,CAKA,aAAAynB,CAAeC,GACd,IAAIhS,EAAO7a,KAAK2G,KAAKmmB,SAASD,GAC9B,GAAY,MAARhS,EAAc,MAAM,IAAIha,MAAM,mBAAqBgsB,GACvD7sB,KAAK+sB,QAAQlS,EACd,CAYA,OAAAkS,CAASC,GACR,GAAIA,GAAWhtB,KAAK6a,KAApB,CACA,GAAe,MAAXmS,EACH,GAAiB,MAAbhtB,KAAK6a,KACRmS,EAAQC,UAAUjtB,KAAMA,KAAK6a,UACzB,CACJ,IAAIqP,EAAQlqB,KAAKkqB,MACjB,IAAK,IAAI/kB,EAAI,EAAGqG,EAAI0e,EAAMpmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAIuQ,EAAOwU,EAAM/kB,GACblB,EAAOyR,EAAK/O,KAAKoiB,eACrB,GAAY,MAAR9kB,EAAc,CACjB,IAAI8S,EAAyBiW,EAAQ1I,cAAcnf,EAAGlB,GACpC,MAAd8S,GAAoBrB,EAAKiT,cAAc5R,EAC5C,CACD,CACD,CAED/W,KAAK6a,KAAOmS,EACZhtB,KAAK8qB,aAjB2B,CAkBjC,CAQA,mBAAAoC,CAAqBR,EAAkB3D,GACtC,OAAO/oB,KAAKskB,cAActkB,KAAK2G,KAAKgmB,cAAcD,GAAW3D,EAC9D,CAOA,aAAAzE,CAAesH,EAAmB7C,GACjC,GAAsB,MAAlBA,EAAwB,MAAM,IAAIloB,MAAM,kCAC5C,GAAiB,MAAbb,KAAK6a,KAAc,CACtB,IAAI9D,EAAyB/W,KAAK6a,KAAKyJ,cAAcsH,EAAW7C,GAChE,GAAkB,MAAdhS,EAAoB,OAAOA,CAChC,CACA,OAA6B,MAAzB/W,KAAK2G,KAAKolB,YAA4B/rB,KAAK2G,KAAKolB,YAAYzH,cAAcsH,EAAW7C,GAClF,IACR,CAKA,aAAAJ,CAAe+D,EAAkB3D,GAChC,GAAgB,MAAZ2D,EAAkB,MAAM,IAAI7rB,MAAM,4BACtC,IAAIqpB,EAAQlqB,KAAKkqB,MACjB,IAAK,IAAI/kB,EAAI,EAAGqG,EAAI0e,EAAMpmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAIuQ,EAAOwU,EAAM/kB,GACjB,GAAIuQ,EAAK/O,KAAK1C,MAAQyoB,EAAU,CAC/B,IAAI3V,EAAyB,KAC7B,GAAsB,MAAlBgS,IACHhS,EAAa/W,KAAKskB,cAAcnf,EAAG4jB,GACjB,MAAdhS,GACH,MAAM,IAAIlW,MAAM,yBAA2BkoB,EAAiB,eAAiB2D,GAG/E,YADAhX,EAAKiT,cAAc5R,EAEpB,CACD,CACA,MAAM,IAAIlW,MAAM,mBAAqB6rB,EACtC,CAMA,gBAAAS,CAAkBC,GACjB,GAAsB,MAAlBA,EAAwB,MAAM,IAAIvsB,MAAM,kCAC5C,IAAIupB,EAAgBpqB,KAAKoqB,cACzB,IAAK,IAAIjlB,EAAI,EAAGqG,EAAI4e,EAActmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CACrD,IAAIkoB,EAAejD,EAAcjlB,GACjC,GAAIkoB,EAAa1mB,KAAK1C,MAAQmpB,EAAgB,OAAOC,CACtD,CACA,OAAO,IACR,CAKA,uBAAAC,CAAyBF,GACxB,GAAsB,MAAlBA,EAAwB,MAAM,IAAIvsB,MAAM,kCAC5C,IAAIwpB,EAAuBrqB,KAAKqqB,qBAChC,IAAK,IAAIllB,EAAI,EAAGqG,EAAI6e,EAAqBvmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC5D,IAAIimB,EAAaf,EAAqBllB,GACtC,GAAIimB,EAAWzkB,KAAK1C,MAAQmpB,EAAgB,OAAOhC,CACpD,CACA,OAAO,IACR,CAKA,kBAAAmC,CAAoBH,GACnB,GAAsB,MAAlBA,EAAwB,MAAM,IAAIvsB,MAAM,kCAC5C,IAAIypB,EAAkBtqB,KAAKsqB,gBAC3B,IAAK,IAAInlB,EAAI,EAAGqG,EAAI8e,EAAgBxmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CACvD,IAAIimB,EAAad,EAAgBnlB,GACjC,GAAIimB,EAAWzkB,KAAK1C,MAAQmpB,EAAgB,OAAOhC,CACpD,CACA,OAAO,IACR,CAMA,SAAAoC,CAAW3X,EAAiB3D,EAAe0V,EAAsB,IAAI1kB,MAAc,IAClF,GAAc,MAAV2S,EAAgB,MAAM,IAAIhV,MAAM,0BACpC,GAAY,MAARqR,EAAc,MAAM,IAAIrR,MAAM,wBAClC,IAAIspB,EAAYnqB,KAAKmqB,UACjBtH,EAAO4K,OAAOC,kBAAmB3K,EAAO0K,OAAOC,kBAAmBzK,EAAOwK,OAAOE,kBAAmBxK,EAAOsK,OAAOE,kBACrH,IAAK,IAAIxoB,EAAI,EAAGqG,EAAI2e,EAAUrmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CACjD,IAAIuQ,EAAOyU,EAAUhlB,GACrB,IAAKuQ,EAAKM,KAAKmG,OAAQ,SACvB,IAAIwJ,EAAiB,EACjBrQ,EAA8B,KAC9ByB,EAAarB,EAAK4O,gBACtB,GAAIvN,aAAsB8B,EACzB8M,EAAiB,EACjBrQ,EAAW7D,EAAMQ,aAAa2V,EAAMjC,EAAgB,GACjC5O,EAAYtB,qBAAqBC,EAAKM,KAAMV,EAAU,EAAG,QACtE,GAAIyB,aAAsBK,EAAgB,CAChD,IAAIwW,EAAwB7W,EAC5B4O,EAAiBiI,EAAKrY,oBACtBD,EAAW7D,EAAMQ,aAAa2V,EAAMjC,EAAgB,GACpDiI,EAAKnY,qBAAqBC,EAAM,EAAGiQ,EAAgBrQ,EAAU,EAAG,EACjE,CACA,GAAgB,MAAZA,EACH,IAAK,IAAIqS,EAAK,EAAGkG,EAAKvY,EAASxR,OAAQ6jB,EAAKkG,EAAIlG,GAAM,EAAG,CACxD,IAAInjB,EAAI8Q,EAASqS,GAAKjjB,EAAI4Q,EAASqS,EAAK,GACxC9E,EAAOle,KAAK2L,IAAIuS,EAAMre,GACtBue,EAAOpe,KAAK2L,IAAIyS,EAAMre,GACtBue,EAAOte,KAAK4L,IAAI0S,EAAMze,GACtB2e,EAAOxe,KAAK4L,IAAI4S,EAAMze,EACvB,CAEF,CACAmR,EAAOrG,IAAIqT,EAAME,GACjB7Q,EAAK1C,IAAIyT,EAAOJ,EAAMM,EAAOJ,EAC9B,CAGA,MAAAtV,CAAQiH,GACP1U,KAAK4oB,MAAQlU,CACd,ErBtkBM,MAAMoZ,EAEZ7pB,KACA8pB,UACAC,YAGAC,SAEA,WAAAnuB,CAAamE,EAAc8pB,EAA4BE,GACtD,GAAY,MAARhqB,EAAc,MAAM,IAAIpD,MAAM,wBAClC,GAAiB,MAAbktB,EAAmB,MAAM,IAAIltB,MAAM,6BACvCb,KAAKiE,KAAOA,EACZjE,KAAK+tB,UAAYA,EACjB/tB,KAAKguB,YAAc,GACnB,IAAK,IAAI7oB,EAAI,EAAGA,EAAI4oB,EAAUjqB,OAAQqB,IACrCnF,KAAKguB,YAAYD,EAAU5oB,GAAG+oB,kBAAmB,EAClDluB,KAAKiuB,SAAWA,CACjB,CAEA,WAAAE,CAAahZ,GACZ,OAA+B,GAAxBnV,KAAKguB,YAAY7Y,EACzB,CAOA,KAAA+K,CAAOnK,EAAoBnB,EAAkBgU,EAAcwF,EAAeC,EAAsBljB,EAAe6H,EAAiB/N,GAC/H,GAAgB,MAAZ8Q,EAAkB,MAAM,IAAIlV,MAAM,4BAElCutB,GAAyB,GAAjBpuB,KAAKiuB,WAChBrF,GAAQ5oB,KAAKiuB,SACTrZ,EAAW,IAAGA,GAAY5U,KAAKiuB,WAGpC,IAAIF,EAAY/tB,KAAK+tB,UACrB,IAAK,IAAI5oB,EAAI,EAAGqG,EAAIuiB,EAAUjqB,OAAQqB,EAAIqG,EAAGrG,IAC5C4oB,EAAU5oB,GAAG+a,MAAMnK,EAAUnB,EAAUgU,EAAMyF,EAAQljB,EAAO6H,EAAO/N,EACrE,CAIA,mBAAOqpB,CAAcC,EAA2B5O,EAAgB6O,EAAe,GAC9E,IAAIC,EAAM,EACNC,EAAOH,EAAOzqB,OAAS0qB,EAAO,EAClC,GAAY,GAARE,EAAW,OAAOF,EACtB,IAAIG,EAAUD,IAAS,EACvB,OAAa,CAKZ,GAJIH,GAAQI,EAAU,GAAKH,IAAS7O,EACnC8O,EAAME,EAAU,EAEhBD,EAAOC,EACJF,GAAOC,EAAM,OAAQD,EAAM,GAAKD,EACpCG,EAAWF,EAAMC,IAAU,CAC5B,CACD,CAEA,mBAAOE,CAAcL,EAA2B5O,EAAgB6O,GAC/D,IAAK,IAAIrpB,EAAI,EAAG0pB,EAAON,EAAOzqB,OAAS0qB,EAAMrpB,GAAK0pB,EAAM1pB,GAAKqpB,EAC5D,GAAID,EAAOppB,GAAKwa,EAAQ,OAAOxa,EAChC,OAAQ,CACT,GAgCD,SAAY3D,GAGX,qBAMA,qBAKA,yBAOA,gBACA,CAtBD,CAAYA,IAAAA,EAAQ,KA4BpB,SAAYC,GACX,qBAAO,sBACP,CAFD,CAAYA,IAAAA,EAAY,KAIxB,SAAYC,GACX,uBAAQ,6BAAW,qBAAO,qBAC1B,+BAAY,qBAAO,uBACnB,qBAAO,6BACP,mCAAc,kDACd,wDAAwB,sDAAuB,8CAC/C,2BACA,CAPD,CAAYA,IAAAA,EAAY,KAUjB,MAAeotB,EACrB/iB,cAAgB,EAAGA,eAAiB,EAAGA,cAAgB,EACvDA,mBAAqB,GAEboY,OAIR,WAAArkB,CAAaiV,GACZ,GAAIA,GAAc,EAAG,MAAM,IAAIlU,MAAM,2BAA6BkU,GAClE/U,KAAKmkB,OAAS1S,EAAMc,eAAewC,EAAa,GAAK+Z,EAAcC,YACpE,CAGA,aAAAC,GACC,OAAOhvB,KAAKmkB,OAAOrgB,OAASgrB,EAAcC,YAAc,CACzD,CAGA,SAAAE,CAAWC,GACVlvB,KAAKmkB,OAAO+K,EAAaJ,EAAcC,aAAeD,EAAc7gB,MACrE,CAGA,UAAAkhB,CAAYD,GACXlvB,KAAKmkB,OAAO+K,EAAaJ,EAAcC,aAAeD,EAAcM,OACrE,CAIA,YAAAC,CAAcH,GACb,IAAIrqB,EAAQqqB,EAAaJ,EAAcC,YACvC,GAAIlqB,GAAS7E,KAAKmkB,OAAOrgB,OAAQ,OAAOgrB,EAAc7gB,OACtD,IAAIqhB,EAAOtvB,KAAKmkB,OAAOtf,GACvB,OAAIyqB,GAAQR,EAAc7gB,OAAe6gB,EAAc7gB,OACnDqhB,GAAQR,EAAcM,QAAgBN,EAAcM,QACjDN,EAAcS,MACtB,CAKA,QAAAC,CAAUN,EAAoBvI,EAAaC,EAAaC,EAAaC,GACpE,IAAIG,EAA0B,KAAX,GAANN,EAAUE,GAAaK,EAA0B,KAAX,GAANN,EAAUE,GACnDK,EAAgC,MAAT,GAAbR,EAAME,GAAW,GAAYO,EAAgC,MAAT,GAAbR,EAAME,GAAW,GAClEO,EAAc,EAAPJ,EAAWE,EAAOG,EAAc,EAAPJ,EAAWE,EAC3CG,EAAY,GAANZ,EAAYM,EAAe,UAARE,EAAoBK,EAAY,GAANZ,EAAYM,EAAe,UAARE,EAEtEjiB,EAAI+pB,EAAaJ,EAAcC,YAC/B5K,EAASnkB,KAAKmkB,OAClBA,EAAOhf,KAAO2pB,EAAcS,OAE5B,IAAI/qB,EAAI+iB,EAAK7iB,EAAI8iB,EACjB,IAAK,IAAIhc,EAAIrG,EAAI2pB,EAAcC,YAAc,EAAG5pB,EAAIqG,EAAGrG,GAAK,EAC3Dgf,EAAOhf,GAAKX,EACZ2f,EAAOhf,EAAI,GAAKT,EAChB6iB,GAAOF,EACPG,GAAOF,EACPD,GAAQF,EACRG,GAAQF,EACR5iB,GAAK+iB,EACL7iB,GAAK8iB,CAEP,CAGA,eAAAiI,CAAiBP,EAAoBQ,GACpCA,EAAUxf,EAAUT,MAAMigB,EAAS,EAAG,GACtC,IAAIvL,EAASnkB,KAAKmkB,OACdhf,EAAI+pB,EAAaJ,EAAcC,YAC/BO,EAAOnL,EAAOhf,GAClB,GAAImqB,GAAQR,EAAc7gB,OAAQ,OAAOyhB,EACzC,GAAIJ,GAAQR,EAAcM,QAAS,OAAO,EAC1CjqB,IACA,IAAIX,EAAI,EACR,IAAK,IAAImR,EAAQxQ,EAAGqG,EAAIrG,EAAI2pB,EAAcC,YAAc,EAAG5pB,EAAIqG,EAAGrG,GAAK,EAEtE,GADAX,EAAI2f,EAAOhf,GACPX,GAAKkrB,EAAS,CACjB,IAAIC,EAAeC,EAQnB,OAPIzqB,GAAKwQ,GACRga,EAAQ,EACRC,EAAQ,IAERD,EAAQxL,EAAOhf,EAAI,GACnByqB,EAAQzL,EAAOhf,EAAI,IAEbyqB,GAASzL,EAAOhf,EAAI,GAAKyqB,IAAUF,EAAUC,IAAUnrB,EAAImrB,EACnE,CAED,IAAIjrB,EAAIyf,EAAOhf,EAAI,GACnB,OAAOT,GAAK,EAAIA,IAAMgrB,EAAUlrB,IAAM,EAAIA,EAC3C,EAMM,MAAMqrB,UAAuBf,EACnC/iB,eAAiB,EACjBA,kBAAoB,EAAGA,sBAAwB,EAC/CA,gBAAkB,EAGlBqgB,UAGA0D,OAEA,WAAAhwB,CAAaiV,GACZ/H,MAAM+H,GACN/U,KAAK8vB,OAASre,EAAMc,cAAcwC,GAAc,EACjD,CAEA,aAAAmZ,GACC,OAAQxsB,EAAaS,QAAU,IAAMnC,KAAKosB,SAC3C,CAGA,QAAA2D,CAAUb,EAAoBtG,EAAcvkB,GAC3C6qB,IAAe,EACflvB,KAAK8vB,OAAOZ,GAActG,EAC1B5oB,KAAK8vB,OAAOZ,EAAaW,EAAeG,UAAY3rB,CACrD,CAEA,KAAA6b,CAAOnK,EAAoBnB,EAAkBgU,EAAcyF,EAAsBljB,EAAe6H,EAAiB/N,GAChH,IAAI6qB,EAAS9vB,KAAK8vB,OAEd9Z,EAAOD,EAASV,MAAMrV,KAAKosB,WAC/B,IAAKpW,EAAKmG,OAAQ,OAClB,GAAIyM,EAAOkH,EAAO,GAAI,CACrB,OAAQ9c,GACR,KAAKxR,EAASyuB,MAEb,YADAja,EAAKuC,SAAWvC,EAAKrP,KAAK4R,UAE3B,KAAK/W,EAAS0uB,MACb,IAAI9gB,EAAI4G,EAAKrP,KAAK4R,SAAWvC,EAAKuC,SAClCvC,EAAKuC,WAAanJ,EAAqD,KAAhD,OAAU,mBAAqBA,EAAI,IAAO,KAAajE,EAE/E,MACD,CAEA,GAAIyd,GAAQkH,EAAOA,EAAOhsB,OAAS+rB,EAAeM,SAAU,CAC3D,IAAI/gB,EAAI0gB,EAAOA,EAAOhsB,OAAS+rB,EAAeO,eAC9C,OAAQpd,GACR,KAAKxR,EAASyuB,MACbja,EAAKuC,SAAWvC,EAAKrP,KAAK4R,SAAWnJ,EAAIjE,EACzC,MACD,KAAK3J,EAAS0uB,MACd,KAAK1uB,EAAS6uB,QACbjhB,GAAK4G,EAAKrP,KAAK4R,SAAWvC,EAAKuC,SAC/BnJ,GAAsD,KAAhD,OAAU,mBAAqBA,EAAI,IAAO,IACjD,KAAK5N,EAASsN,IACbkH,EAAKuC,UAAYnJ,EAAIjE,EAEtB,MACD,CAGA,IAAImlB,EAAQxC,EAAUQ,aAAawB,EAAQlH,EAAMiH,EAAeM,SAC5DI,EAAeT,EAAOQ,EAAQT,EAAeO,eAC7Cpb,EAAY8a,EAAOQ,GACnBZ,EAAU1vB,KAAKyvB,iBAAiBa,GAAS,GAAK,EACjD,GAAK1H,EAAO5T,IAAc8a,EAAOQ,EAAQT,EAAeW,WAAaxb,IAElE5F,EAAI0gB,EAAOQ,EAAQT,EAAeG,UAAYO,EAElD,OADAnhB,EAAImhB,GAAgBnhB,EAAqD,KAAhD,OAAU,mBAAqBA,EAAI,IAAO,KAAasgB,EACxE1c,GACR,KAAKxR,EAASyuB,MACbja,EAAKuC,SAAWvC,EAAKrP,KAAK4R,UAAYnJ,EAAqD,KAAhD,OAAU,mBAAqBA,EAAI,IAAO,KAAajE,EAClG,MACD,KAAK3J,EAAS0uB,MACd,KAAK1uB,EAAS6uB,QACbjhB,GAAK4G,EAAKrP,KAAK4R,SAAWvC,EAAKuC,SAChC,KAAK/W,EAASsN,IACbkH,EAAKuC,WAAanJ,EAAqD,KAAhD,OAAU,mBAAqBA,EAAI,IAAO,KAAajE,EAEhF,EAIM,MAAMslB,UAA0B3B,EACtC/iB,eAAiB,EACjBA,kBAAoB,EAAGA,eAAiB,EAAGA,eAAiB,EAC5DA,SAAW,EAAGA,SAAW,EAGzBqgB,UAGA0D,OAEA,WAAAhwB,CAAaiV,GACZ/H,MAAM+H,GACN/U,KAAK8vB,OAASre,EAAMc,cAAcwC,EAAa0b,EAAkBN,QAClE,CAEA,aAAAjC,GACC,OAAQxsB,EAAagvB,WAAa,IAAM1wB,KAAKosB,SAC9C,CAGA,QAAA2D,CAAUb,EAAoBtG,EAAcpkB,EAAWE,GACtDwqB,GAAcuB,EAAkBN,QAChCnwB,KAAK8vB,OAAOZ,GAActG,EAC1B5oB,KAAK8vB,OAAOZ,EAAauB,EAAkBE,GAAKnsB,EAChDxE,KAAK8vB,OAAOZ,EAAauB,EAAkBG,GAAKlsB,CACjD,CAEA,KAAAwb,CAAOnK,EAAoBnB,EAAkBgU,EAAcyF,EAAsBljB,EAAe6H,EAAiB/N,GAChH,IAAI6qB,EAAS9vB,KAAK8vB,OAEd9Z,EAAOD,EAASV,MAAMrV,KAAKosB,WAC/B,IAAKpW,EAAKmG,OAAQ,OAClB,GAAIyM,EAAOkH,EAAO,GAAI,CACrB,OAAQ9c,GACR,KAAKxR,EAASyuB,MAGb,OAFAja,EAAKxR,EAAIwR,EAAKrP,KAAKnC,OACnBwR,EAAKtR,EAAIsR,EAAKrP,KAAKjC,GAEpB,KAAKlD,EAAS0uB,MACbla,EAAKxR,IAAMwR,EAAKrP,KAAKnC,EAAIwR,EAAKxR,GAAK2G,EACnC6K,EAAKtR,IAAMsR,EAAKrP,KAAKjC,EAAIsR,EAAKtR,GAAKyG,EAEpC,MACD,CAEA,IAAI3G,EAAI,EAAGE,EAAI,EACf,GAAIkkB,GAAQkH,EAAOA,EAAOhsB,OAAS2sB,EAAkBN,SACpD3rB,EAAIsrB,EAAOA,EAAOhsB,OAAS2sB,EAAkBI,QAC7CnsB,EAAIorB,EAAOA,EAAOhsB,OAAS2sB,EAAkBK,YACvC,CAEN,IAAIR,EAAQxC,EAAUQ,aAAawB,EAAQlH,EAAM6H,EAAkBN,SACnE3rB,EAAIsrB,EAAOQ,EAAQG,EAAkBI,QACrCnsB,EAAIorB,EAAOQ,EAAQG,EAAkBK,QACrC,IAAI9b,EAAY8a,EAAOQ,GACnBZ,EAAU1vB,KAAKyvB,gBAAgBa,EAAQG,EAAkBN,QAAU,EACtE,GAAKvH,EAAO5T,IAAc8a,EAAOQ,EAAQG,EAAkBD,WAAaxb,IAEzExQ,IAAMsrB,EAAOQ,EAAQG,EAAkBE,GAAKnsB,GAAKkrB,EACjDhrB,IAAMorB,EAAOQ,EAAQG,EAAkBG,GAAKlsB,GAAKgrB,CAClD,CACA,OAAQ1c,GACR,KAAKxR,EAASyuB,MACbja,EAAKxR,EAAIwR,EAAKrP,KAAKnC,EAAIA,EAAI2G,EAC3B6K,EAAKtR,EAAIsR,EAAKrP,KAAKjC,EAAIA,EAAIyG,EAC3B,MACD,KAAK3J,EAAS0uB,MACd,KAAK1uB,EAAS6uB,QACbra,EAAKxR,IAAMwR,EAAKrP,KAAKnC,EAAIA,EAAIwR,EAAKxR,GAAK2G,EACvC6K,EAAKtR,IAAMsR,EAAKrP,KAAKjC,EAAIA,EAAIsR,EAAKtR,GAAKyG,EACvC,MACD,KAAK3J,EAASsN,IACbkH,EAAKxR,GAAKA,EAAI2G,EACd6K,EAAKtR,GAAKA,EAAIyG,EAEhB,EAIM,MAAM4lB,WAAsBN,EAClC,WAAA3wB,CAAaiV,GACZ/H,MAAM+H,EACP,CAEA,aAAAmZ,GACC,OAAQxsB,EAAaijB,OAAS,IAAM3kB,KAAKosB,SAC1C,CAEA,KAAAlM,CAAOnK,EAAoBnB,EAAkBgU,EAAcyF,EAAsBljB,EAAe6H,EAAiB/N,GAChH,IAAI6qB,EAAS9vB,KAAK8vB,OAEd9Z,EAAOD,EAASV,MAAMrV,KAAKosB,WAC/B,IAAKpW,EAAKmG,OAAQ,OAClB,GAAIyM,EAAOkH,EAAO,GAAI,CACrB,OAAQ9c,GACR,KAAKxR,EAASyuB,MAGb,OAFAja,EAAK8C,OAAS9C,EAAKrP,KAAKmS,YACxB9C,EAAK+C,OAAS/C,EAAKrP,KAAKoS,QAEzB,KAAKvX,EAAS0uB,MACbla,EAAK8C,SAAW9C,EAAKrP,KAAKmS,OAAS9C,EAAK8C,QAAU3N,EAClD6K,EAAK+C,SAAW/C,EAAKrP,KAAKoS,OAAS/C,EAAK+C,QAAU5N,EAEnD,MACD,CAEA,IAAI3G,EAAI,EAAGE,EAAI,EACf,GAAIkkB,GAAQkH,EAAOA,EAAOhsB,OAASitB,GAAcZ,SAChD3rB,EAAIsrB,EAAOA,EAAOhsB,OAASitB,GAAcF,QAAU7a,EAAKrP,KAAKmS,OAC7DpU,EAAIorB,EAAOA,EAAOhsB,OAASitB,GAAcD,QAAU9a,EAAKrP,KAAKoS,WACvD,CAEN,IAAIuX,EAAQxC,EAAUQ,aAAawB,EAAQlH,EAAMmI,GAAcZ,SAC/D3rB,EAAIsrB,EAAOQ,EAAQS,GAAcF,QACjCnsB,EAAIorB,EAAOQ,EAAQS,GAAcD,QACjC,IAAI9b,EAAY8a,EAAOQ,GACnBZ,EAAU1vB,KAAKyvB,gBAAgBa,EAAQS,GAAcZ,QAAU,EAClE,GAAKvH,EAAO5T,IAAc8a,EAAOQ,EAAQS,GAAcP,WAAaxb,IAErExQ,GAAKA,GAAKsrB,EAAOQ,EAAQS,GAAcJ,GAAKnsB,GAAKkrB,GAAW1Z,EAAKrP,KAAKmS,OACtEpU,GAAKA,GAAKorB,EAAOQ,EAAQS,GAAcH,GAAKlsB,GAAKgrB,GAAW1Z,EAAKrP,KAAKoS,MACvE,CACA,GAAa,GAAT5N,EACC6H,GAASxR,EAASsN,KACrBkH,EAAK8C,QAAUtU,EAAIwR,EAAKrP,KAAKmS,OAC7B9C,EAAK+C,QAAUrU,EAAIsR,EAAKrP,KAAKoS,SAE7B/C,EAAK8C,OAAStU,EACdwR,EAAK+C,OAASrU,OAET,CACN,IAAIssB,EAAK,EAAGhH,EAAK,EACjB,GAAI/kB,GAAaxD,EAAawvB,OAC7B,OAAQje,GACR,KAAKxR,EAASyuB,MACbe,EAAKhb,EAAKrP,KAAKmS,OACfkR,EAAKhU,EAAKrP,KAAKoS,OACf/C,EAAK8C,OAASkY,GAAMrsB,KAAKC,IAAIJ,GAAK0L,EAAUW,OAAOmgB,GAAMA,GAAM7lB,EAC/D6K,EAAK+C,OAASiR,GAAMrlB,KAAKC,IAAIF,GAAKwL,EAAUW,OAAOmZ,GAAMA,GAAM7e,EAC/D,MACD,KAAK3J,EAAS0uB,MACd,KAAK1uB,EAAS6uB,QACbW,EAAKhb,EAAK8C,OACVkR,EAAKhU,EAAK+C,OACV/C,EAAK8C,OAASkY,GAAMrsB,KAAKC,IAAIJ,GAAK0L,EAAUW,OAAOmgB,GAAMA,GAAM7lB,EAC/D6K,EAAK+C,OAASiR,GAAMrlB,KAAKC,IAAIF,GAAKwL,EAAUW,OAAOmZ,GAAMA,GAAM7e,EAC/D,MACD,KAAK3J,EAASsN,IACbkiB,EAAKhb,EAAK8C,OACVkR,EAAKhU,EAAK+C,OACV/C,EAAK8C,OAASkY,GAAMrsB,KAAKC,IAAIJ,GAAK0L,EAAUW,OAAOmgB,GAAMhb,EAAKrP,KAAKmS,QAAU3N,EAC7E6K,EAAK+C,OAASiR,GAAMrlB,KAAKC,IAAIF,GAAKwL,EAAUW,OAAOmZ,GAAMhU,EAAKrP,KAAKoS,QAAU5N,OAG9E,OAAQ6H,GACR,KAAKxR,EAASyuB,MACbe,EAAKrsB,KAAKC,IAAIoR,EAAKrP,KAAKmS,QAAU5I,EAAUW,OAAOrM,GACnDwlB,EAAKrlB,KAAKC,IAAIoR,EAAKrP,KAAKoS,QAAU7I,EAAUW,OAAOnM,GACnDsR,EAAK8C,OAASkY,GAAMxsB,EAAIwsB,GAAM7lB,EAC9B6K,EAAK+C,OAASiR,GAAMtlB,EAAIslB,GAAM7e,EAC9B,MACD,KAAK3J,EAAS0uB,MACd,KAAK1uB,EAAS6uB,QACbW,EAAKrsB,KAAKC,IAAIoR,EAAK8C,QAAU5I,EAAUW,OAAOrM,GAC9CwlB,EAAKrlB,KAAKC,IAAIoR,EAAK+C,QAAU7I,EAAUW,OAAOnM,GAC9CsR,EAAK8C,OAASkY,GAAMxsB,EAAIwsB,GAAM7lB,EAC9B6K,EAAK+C,OAASiR,GAAMtlB,EAAIslB,GAAM7e,EAC9B,MACD,KAAK3J,EAASsN,IACbkiB,EAAK9gB,EAAUW,OAAOrM,GACtBwlB,EAAK9Z,EAAUW,OAAOnM,GACtBsR,EAAK8C,OAASnU,KAAKC,IAAIoR,EAAK8C,QAAUkY,GAAMxsB,EAAIG,KAAKC,IAAIoR,EAAKrP,KAAKmS,QAAUkY,GAAM7lB,EACnF6K,EAAK+C,OAASpU,KAAKC,IAAIoR,EAAK+C,QAAUiR,GAAMtlB,EAAIC,KAAKC,IAAIoR,EAAKrP,KAAKoS,QAAUiR,GAAM7e,EAGtF,CACD,EAIM,MAAM+lB,WAAsBT,EAClC,WAAA3wB,CAAaiV,GACZ/H,MAAM+H,EACP,CAEA,aAAAmZ,GACC,OAAQxsB,EAAayvB,OAAS,IAAMnxB,KAAKosB,SAC1C,CAEA,KAAAlM,CAAOnK,EAAoBnB,EAAkBgU,EAAcyF,EAAsBljB,EAAe6H,EAAiB/N,GAChH,IAAI6qB,EAAS9vB,KAAK8vB,OAEd9Z,EAAOD,EAASV,MAAMrV,KAAKosB,WAC/B,IAAKpW,EAAKmG,OAAQ,OAClB,GAAIyM,EAAOkH,EAAO,GAAI,CACrB,OAAQ9c,GACR,KAAKxR,EAASyuB,MAGb,OAFAja,EAAKoF,OAASpF,EAAKrP,KAAKyU,YACxBpF,EAAKqF,OAASrF,EAAKrP,KAAK0U,QAEzB,KAAK7Z,EAAS0uB,MACbla,EAAKoF,SAAWpF,EAAKrP,KAAKyU,OAASpF,EAAKoF,QAAUjQ,EAClD6K,EAAKqF,SAAWrF,EAAKrP,KAAK0U,OAASrF,EAAKqF,QAAUlQ,EAEnD,MACD,CAEA,IAAI3G,EAAI,EAAGE,EAAI,EACf,GAAIkkB,GAAQkH,EAAOA,EAAOhsB,OAASotB,GAAcf,SAChD3rB,EAAIsrB,EAAOA,EAAOhsB,OAASotB,GAAcL,QACzCnsB,EAAIorB,EAAOA,EAAOhsB,OAASotB,GAAcJ,YACnC,CAEN,IAAIR,EAAQxC,EAAUQ,aAAawB,EAAQlH,EAAMsI,GAAcf,SAC/D3rB,EAAIsrB,EAAOQ,EAAQY,GAAcL,QACjCnsB,EAAIorB,EAAOQ,EAAQY,GAAcJ,QACjC,IAAI9b,EAAY8a,EAAOQ,GACnBZ,EAAU1vB,KAAKyvB,gBAAgBa,EAAQY,GAAcf,QAAU,EAClE,GAAKvH,EAAO5T,IAAc8a,EAAOQ,EAAQY,GAAcV,WAAaxb,IAErExQ,IAASsrB,EAAOQ,EAAQY,GAAcP,GAAKnsB,GAAKkrB,EAChDhrB,IAASorB,EAAOQ,EAAQY,GAAcN,GAAKlsB,GAAKgrB,CACjD,CACA,OAAQ1c,GACR,KAAKxR,EAASyuB,MACbja,EAAKoF,OAASpF,EAAKrP,KAAKyU,OAAS5W,EAAI2G,EACrC6K,EAAKqF,OAASrF,EAAKrP,KAAK0U,OAAS3W,EAAIyG,EACrC,MACD,KAAK3J,EAAS0uB,MACd,KAAK1uB,EAAS6uB,QACbra,EAAKoF,SAAWpF,EAAKrP,KAAKyU,OAAS5W,EAAIwR,EAAKoF,QAAUjQ,EACtD6K,EAAKqF,SAAWrF,EAAKrP,KAAK0U,OAAS3W,EAAIsR,EAAKqF,QAAUlQ,EACtD,MACD,KAAK3J,EAASsN,IACbkH,EAAKoF,QAAU5W,EAAI2G,EACnB6K,EAAKqF,QAAU3W,EAAIyG,EAErB,EAIM,MAAMimB,WAAsBtC,EAClC/iB,eAAiB,EACjBA,kBAAoB,EAAGA,eAAiB,EAAGA,eAAiB,EAAGA,eAAiB,EAAGA,eAAiB,EACpGA,SAAW,EAAGA,SAAW,EAAGA,SAAW,EAAGA,SAAW,EAGrD6f,UAGAkE,OAEA,WAAAhwB,CAAaiV,GACZ/H,MAAM+H,GACN/U,KAAK8vB,OAASre,EAAMc,cAAcwC,EAAaqc,GAAcjB,QAC9D,CAEA,aAAAjC,GACC,OAAQxsB,EAAasO,OAAS,IAAMhQ,KAAK4rB,SAC1C,CAGA,QAAAmE,CAAUb,EAAoBtG,EAAcxZ,EAAWC,EAAWC,EAAWC,GAC5E2f,GAAckC,GAAcjB,QAC5BnwB,KAAK8vB,OAAOZ,GAActG,EAC1B5oB,KAAK8vB,OAAOZ,EAAakC,GAAcC,GAAKjiB,EAC5CpP,KAAK8vB,OAAOZ,EAAakC,GAAcE,GAAKjiB,EAC5CrP,KAAK8vB,OAAOZ,EAAakC,GAAcG,GAAKjiB,EAC5CtP,KAAK8vB,OAAOZ,EAAakC,GAAcI,GAAKjiB,CAC7C,CAEA,KAAA2Q,CAAOnK,EAAoBnB,EAAkBgU,EAAcyF,EAAsBljB,EAAe6H,EAAiB/N,GAChH,IAAIyQ,EAAOK,EAASmU,MAAMlqB,KAAK4rB,WAC/B,IAAKlW,EAAKM,KAAKmG,OAAQ,OACvB,IAAI2T,EAAS9vB,KAAK8vB,OAClB,GAAIlH,EAAOkH,EAAO,GAAI,CACrB,OAAQ9c,GACR,KAAKxR,EAASyuB,MAEb,YADAva,EAAK1F,MAAMN,aAAagG,EAAK/O,KAAKqJ,OAEnC,KAAKxO,EAAS0uB,MACb,IAAIlgB,EAAQ0F,EAAK1F,MAAOigB,EAAQva,EAAK/O,KAAKqJ,MAC1CA,EAAMlB,KAAKmhB,EAAM7gB,EAAIY,EAAMZ,GAAKjE,GAAQ8kB,EAAM5gB,EAAIW,EAAMX,GAAKlE,GAAQ8kB,EAAM3gB,EAAIU,EAAMV,GAAKnE,GACxF8kB,EAAM1gB,EAAIS,EAAMT,GAAKpE,GAExB,MACD,CAEA,IAAIiE,EAAI,EAAGC,EAAI,EAAGC,EAAI,EAAGC,EAAI,EAC7B,GAAIqZ,GAAQkH,EAAOA,EAAOhsB,OAASstB,GAAcjB,SAAU,CAC1D,IAAIhrB,EAAI2qB,EAAOhsB,OACfsL,EAAI0gB,EAAO3qB,EAAIisB,GAAcK,QAC7BpiB,EAAIygB,EAAO3qB,EAAIisB,GAAcM,QAC7BpiB,EAAIwgB,EAAO3qB,EAAIisB,GAAcO,QAC7BpiB,EAAIugB,EAAO3qB,EAAIisB,GAAcQ,OAC9B,KAAO,CAEN,IAAItB,EAAQxC,EAAUQ,aAAawB,EAAQlH,EAAMwI,GAAcjB,SAC/D/gB,EAAI0gB,EAAOQ,EAAQc,GAAcK,QACjCpiB,EAAIygB,EAAOQ,EAAQc,GAAcM,QACjCpiB,EAAIwgB,EAAOQ,EAAQc,GAAcO,QACjCpiB,EAAIugB,EAAOQ,EAAQc,GAAcQ,QACjC,IAAI5c,EAAY8a,EAAOQ,GACnBZ,EAAU1vB,KAAKyvB,gBAAgBa,EAAQc,GAAcjB,QAAU,EAClE,GAAKvH,EAAO5T,IAAc8a,EAAOQ,EAAQc,GAAcZ,WAAaxb,IAErE5F,IAAM0gB,EAAOQ,EAAQc,GAAcC,GAAKjiB,GAAKsgB,EAC7CrgB,IAAMygB,EAAOQ,EAAQc,GAAcE,GAAKjiB,GAAKqgB,EAC7CpgB,IAAMwgB,EAAOQ,EAAQc,GAAcG,GAAKjiB,GAAKogB,EAC7CngB,IAAMugB,EAAOQ,EAAQc,GAAcI,GAAKjiB,GAAKmgB,CAC9C,CACA,GAAa,GAATvkB,EACHuK,EAAK1F,MAAMR,IAAIJ,EAAGC,EAAGC,EAAGC,OACpB,CACJ,IAAIS,EAAQ0F,EAAK1F,MACbgD,GAASxR,EAASyuB,OAAOjgB,EAAMN,aAAagG,EAAK/O,KAAKqJ,OAC1DA,EAAMlB,KAAKM,EAAIY,EAAMZ,GAAKjE,GAAQkE,EAAIW,EAAMX,GAAKlE,GAAQmE,EAAIU,EAAMV,GAAKnE,GAAQoE,EAAIS,EAAMT,GAAKpE,EAChG,CACD,EAIM,MAAM0mB,WAAyB/C,EACrC/iB,eAAiB,EACjBA,kBAAoB,EAAGA,eAAiB,EAAGA,eAAiB,EAAGA,eAAiB,EAAGA,eAAiB,EACpGA,gBAAkB,EAAGA,gBAAkB,EAAGA,gBAAkB,EAC5DA,SAAW,EAAGA,SAAW,EAAGA,SAAW,EAAGA,SAAW,EAAGA,UAAY,EAAGA,UAAY,EAAGA,UAAY,EAIlG6f,UAGAkE,OAEA,WAAAhwB,CAAaiV,GACZ/H,MAAM+H,GACN/U,KAAK8vB,OAASre,EAAMc,cAAcwC,EAAa8c,GAAiB1B,QACjE,CAEA,aAAAjC,GACC,OAAQxsB,EAAaowB,UAAY,IAAM9xB,KAAK4rB,SAC7C,CAGA,QAAAmE,CAAUb,EAAoBtG,EAAcxZ,EAAWC,EAAWC,EAAWC,EAAWwiB,EAAYC,EAAYC,GAC/G/C,GAAc2C,GAAiB1B,QAC/BnwB,KAAK8vB,OAAOZ,GAActG,EAC1B5oB,KAAK8vB,OAAOZ,EAAa2C,GAAiBR,GAAKjiB,EAC/CpP,KAAK8vB,OAAOZ,EAAa2C,GAAiBP,GAAKjiB,EAC/CrP,KAAK8vB,OAAOZ,EAAa2C,GAAiBN,GAAKjiB,EAC/CtP,KAAK8vB,OAAOZ,EAAa2C,GAAiBL,GAAKjiB,EAC/CvP,KAAK8vB,OAAOZ,EAAa2C,GAAiBK,IAAMH,EAChD/xB,KAAK8vB,OAAOZ,EAAa2C,GAAiBM,IAAMH,EAChDhyB,KAAK8vB,OAAOZ,EAAa2C,GAAiBO,IAAMH,CACjD,CAEA,KAAA/R,CAAOnK,EAAoBnB,EAAkBgU,EAAcyF,EAAsBljB,EAAe6H,EAAiB/N,GAChH,IAAIyQ,EAAOK,EAASmU,MAAMlqB,KAAK4rB,WAC/B,IAAKlW,EAAKM,KAAKmG,OAAQ,OACvB,IAAI2T,EAAS9vB,KAAK8vB,OAClB,GAAIlH,EAAOkH,EAAO,GAAI,CACrB,OAAQ9c,GACR,KAAKxR,EAASyuB,MAGb,OAFAva,EAAK1F,MAAMN,aAAagG,EAAK/O,KAAKqJ,YAClC0F,EAAK6S,UAAU7Y,aAAagG,EAAK/O,KAAK4hB,WAEvC,KAAK/mB,EAAS0uB,MACb,IAAImC,EAAQ3c,EAAK1F,MAAOsiB,EAAO5c,EAAK6S,UAAWgK,EAAa7c,EAAK/O,KAAKqJ,MAAOwiB,EAAY9c,EAAK/O,KAAK4hB,UACnG8J,EAAMvjB,KAAKyjB,EAAWnjB,EAAIijB,EAAMjjB,GAAKjE,GAAQonB,EAAWljB,EAAIgjB,EAAMhjB,GAAKlE,GAAQonB,EAAWjjB,EAAI+iB,EAAM/iB,GAAKnE,GACvGonB,EAAWhjB,EAAI8iB,EAAM9iB,GAAKpE,GAC5BmnB,EAAKxjB,KAAK0jB,EAAUpjB,EAAIkjB,EAAKljB,GAAKjE,GAAQqnB,EAAUnjB,EAAIijB,EAAKjjB,GAAKlE,GAAQqnB,EAAUljB,EAAIgjB,EAAKhjB,GAAKnE,EAAO,GAE1G,MACD,CAEA,IAAIiE,EAAI,EAAGC,EAAI,EAAGC,EAAI,EAAGC,EAAI,EAAGwiB,EAAK,EAAGC,EAAK,EAAGC,EAAK,EACrD,GAAIrJ,GAAQkH,EAAOA,EAAOhsB,OAAS+tB,GAAiB1B,SAAU,CAC7D,IAAIhrB,EAAI2qB,EAAOhsB,OACfsL,EAAI0gB,EAAO3qB,EAAI0sB,GAAiBJ,QAChCpiB,EAAIygB,EAAO3qB,EAAI0sB,GAAiBH,QAChCpiB,EAAIwgB,EAAO3qB,EAAI0sB,GAAiBF,QAChCpiB,EAAIugB,EAAO3qB,EAAI0sB,GAAiBD,QAChCG,EAAKjC,EAAO3qB,EAAI0sB,GAAiBY,SACjCT,EAAKlC,EAAO3qB,EAAI0sB,GAAiBa,SACjCT,EAAKnC,EAAO3qB,EAAI0sB,GAAiBc,QAClC,KAAO,CAEN,IAAIrC,EAAQxC,EAAUQ,aAAawB,EAAQlH,EAAMiJ,GAAiB1B,SAClE/gB,EAAI0gB,EAAOQ,EAAQuB,GAAiBJ,QACpCpiB,EAAIygB,EAAOQ,EAAQuB,GAAiBH,QACpCpiB,EAAIwgB,EAAOQ,EAAQuB,GAAiBF,QACpCpiB,EAAIugB,EAAOQ,EAAQuB,GAAiBD,QACpCG,EAAKjC,EAAOQ,EAAQuB,GAAiBY,SACrCT,EAAKlC,EAAOQ,EAAQuB,GAAiBa,SACrCT,EAAKnC,EAAOQ,EAAQuB,GAAiBc,SACrC,IAAI3d,EAAY8a,EAAOQ,GACnBZ,EAAU1vB,KAAKyvB,gBAAgBa,EAAQuB,GAAiB1B,QAAU,EACrE,GAAKvH,EAAO5T,IAAc8a,EAAOQ,EAAQuB,GAAiBrB,WAAaxb,IAExE5F,IAAM0gB,EAAOQ,EAAQuB,GAAiBR,GAAKjiB,GAAKsgB,EAChDrgB,IAAMygB,EAAOQ,EAAQuB,GAAiBP,GAAKjiB,GAAKqgB,EAChDpgB,IAAMwgB,EAAOQ,EAAQuB,GAAiBN,GAAKjiB,GAAKogB,EAChDngB,IAAMugB,EAAOQ,EAAQuB,GAAiBL,GAAKjiB,GAAKmgB,EAChDqC,IAAOjC,EAAOQ,EAAQuB,GAAiBK,IAAMH,GAAMrC,EACnDsC,IAAOlC,EAAOQ,EAAQuB,GAAiBM,IAAMH,GAAMtC,EACnDuC,IAAOnC,EAAOQ,EAAQuB,GAAiBO,IAAMH,GAAMvC,CACpD,CACA,GAAa,GAATvkB,EACHuK,EAAK1F,MAAMR,IAAIJ,EAAGC,EAAGC,EAAGC,GACxBmG,EAAK6S,UAAU/Y,IAAIuiB,EAAIC,EAAIC,EAAI,OACzB,CACN,IAAII,EAAQ3c,EAAK1F,MAAOsiB,EAAO5c,EAAK6S,UAChCvV,GAASxR,EAASyuB,QACrBoC,EAAM3iB,aAAagG,EAAK/O,KAAKqJ,OAC7BsiB,EAAK5iB,aAAagG,EAAK/O,KAAK4hB,YAE7B8J,EAAMvjB,KAAKM,EAAIijB,EAAMjjB,GAAKjE,GAAQkE,EAAIgjB,EAAMhjB,GAAKlE,GAAQmE,EAAI+iB,EAAM/iB,GAAKnE,GAAQoE,EAAI8iB,EAAM9iB,GAAKpE,GAC/FmnB,EAAKxjB,KAAKijB,EAAKO,EAAKljB,GAAKjE,GAAQ6mB,EAAKM,EAAKjjB,GAAKlE,GAAQ8mB,EAAKK,EAAKhjB,GAAKnE,EAAO,EAC/E,CACD,EAIM,MAAMynB,GAEZhH,UAGAkE,OAGA+C,gBAEA,WAAA/yB,CAAaiV,GACZ/U,KAAK8vB,OAASre,EAAMc,cAAcwC,GAClC/U,KAAK6yB,gBAAkB,IAAI3vB,MAAc6R,EAC1C,CAEA,aAAAmZ,GACC,OAAQxsB,EAAaqV,YAAc,IAAM/W,KAAK4rB,SAC/C,CAGA,aAAAoD,GACC,OAAOhvB,KAAK8vB,OAAOhsB,MACpB,CAGA,QAAAisB,CAAUb,EAAoBtG,EAAcG,GAC3C/oB,KAAK8vB,OAAOZ,GAActG,EAC1B5oB,KAAK6yB,gBAAgB3D,GAAcnG,CACpC,CAEA,KAAA7I,CAAOnK,EAAoBnB,EAAkBgU,EAAcyF,EAAsBljB,EAAe6H,EAAiB/N,GAChH,IAAIyQ,EAAOK,EAASmU,MAAMlqB,KAAK4rB,WAC/B,IAAKlW,EAAKM,KAAKmG,OAAQ,OACvB,GAAIlX,GAAaxD,EAAawvB,OAG7B,YAFIje,GAASxR,EAASyuB,OACrBjwB,KAAK2oB,cAAc5S,EAAUL,EAAMA,EAAK/O,KAAKoiB,iBAI/C,IAAI+G,EAAS9vB,KAAK8vB,OAClB,GAAIlH,EAAOkH,EAAO,GAEjB,YADI9c,GAASxR,EAASyuB,OAASjd,GAASxR,EAAS0uB,OAAOlwB,KAAK2oB,cAAc5S,EAAUL,EAAMA,EAAK/O,KAAKoiB,iBAItG,IAAImG,EAAa,EAEhBA,EADGtG,GAAQkH,EAAOA,EAAOhsB,OAAS,GACrBgsB,EAAOhsB,OAAS,EAEhBgqB,EAAUQ,aAAawB,EAAQlH,EAAM,GAAK,EAExD,IAAIG,EAAiB/oB,KAAK6yB,gBAAgB3D,GAC1CnZ,EAASmU,MAAMlqB,KAAK4rB,WAClBjD,cAAgC,MAAlBI,EAAyB,KAAOhT,EAASuO,cAActkB,KAAK4rB,UAAW7C,GACxF,CAEA,aAAAJ,CAAc5S,EAAoBL,EAAYqT,GAC7CrT,EAAKqB,WAA+B,MAAlBgS,EAAyB,KAAOhT,EAASuO,cAActkB,KAAK4rB,UAAW7C,EAC1F,EAGD,IAAI+J,GAA4B,KAGzB,MAAMC,WAAuBjE,EAEnClD,UAGA7U,WAGA+Y,OAGAkD,cAEA,WAAAlzB,CAAaiV,GACZ/H,MAAM+H,GACN/U,KAAK8vB,OAASre,EAAMc,cAAcwC,GAClC/U,KAAKgzB,cAAgB,IAAI9vB,MAAyB6R,GACrC,MAAT+d,KAAeA,GAAQrhB,EAAMc,cAAc,IAChD,CAEA,aAAA2b,GACC,OAAQxsB,EAAawU,QAAU,MAAQlW,KAAK+W,WAAW5B,GAAKnV,KAAK4rB,SAClE,CAIA,QAAAmE,CAAUb,EAAoBtG,EAActT,GAC3CtV,KAAK8vB,OAAOZ,GAActG,EAC1B5oB,KAAKgzB,cAAc9D,GAAc5Z,CAClC,CAEA,KAAA4K,CAAOnK,EAAoBnB,EAAkBgU,EAAcqK,EAA2B9nB,EAAe6H,EAAiB/N,GACrH,IAAIyQ,EAAaK,EAASmU,MAAMlqB,KAAK4rB,WACrC,IAAKlW,EAAKM,KAAKmG,OAAQ,OACvB,IAAI+W,EAA6Bxd,EAAK4O,gBACtC,KAAM4O,aAA0Bhe,IAA0Cge,EAAgB1d,kBAAoBxV,KAAK+W,WAAa,OAEhI,IAAId,EAA6BP,EAAKQ,OACZ,GAAtBD,EAAYnS,SAAakP,EAAQxR,EAASyuB,OAE9C,IAAI+C,EAAgBhzB,KAAKgzB,cACrBG,EAAcH,EAAc,GAAGlvB,OAE/BgsB,EAAS9vB,KAAK8vB,OAClB,GAAIlH,EAAOkH,EAAO,GAAI,CACrB,IAAIsD,EAAqCF,EACzC,OAAQlgB,GACR,KAAKxR,EAASyuB,MAEb,YADAha,EAAYnS,OAAS,GAEtB,KAAKtC,EAAS0uB,MACb,GAAa,GAAT/kB,EAAY,CACf8K,EAAYnS,OAAS,EACrB,KACD,CACA,IAAIoS,EAAwBzE,EAAMQ,aAAagE,EAAakd,GAC5D,GAA8B,MAA1BC,EAAiB/d,MAAe,CAEnC,IAAIge,EAAgBD,EAAiB9d,SACrC,IAAK,IAAInQ,EAAI,EAAGA,EAAIguB,EAAahuB,IAChC+Q,EAAO/Q,KAAOkuB,EAAcluB,GAAK+Q,EAAO/Q,IAAMgG,CAChD,MAGC,IADAA,EAAQ,EAAIA,EACHhG,EAAI,EAAGA,EAAIguB,EAAahuB,IAChC+Q,EAAO/Q,IAAMgG,EAGhB,MACD,CAEA,IAAI+K,EAAwBzE,EAAMQ,aAAagE,EAAakd,GAC5D,GAAIvK,GAAQkH,EAAOA,EAAOhsB,OAAS,GAAI,CACtC,IAAIwvB,EAAeN,EAAclD,EAAOhsB,OAAS,GACjD,GAAa,GAATqH,EACH,GAAI6H,GAASxR,EAASsN,IAAK,CAC1B,IAAIskB,EAAmBF,EACvB,GAA8B,MAA1BE,EAAiB/d,MAAe,CAEnC,IAAIge,EAAgBD,EAAiB9d,SACrC,IAAK,IAAInQ,EAAI,EAAGA,EAAIguB,EAAahuB,IAChC+Q,EAAO/Q,IAAMmuB,EAAanuB,GAAKkuB,EAAcluB,EAE/C,MAEC,IAAK,IAAIA,EAAI,EAAGA,EAAIguB,EAAahuB,IAChC+Q,EAAO/Q,IAAMmuB,EAAanuB,EAE7B,MACCsM,EAAMC,UAAU4hB,EAAc,EAAGpd,EAAQ,EAAGid,QAG7C,OAAQngB,GACR,KAAKxR,EAASyuB,MAAO,CACpB,IAAImD,EAAmBF,EACvB,GAA8B,MAA1BE,EAAiB/d,MAAe,CAEnC,IAAIge,EAAgBD,EAAiB9d,SACrC,IAAK,IAAInQ,EAAI,EAAGA,EAAIguB,EAAahuB,IAAK,CACrC,IAAI8qB,EAAQoD,EAAcluB,GAC1B+Q,EAAO/Q,GAAK8qB,GAASqD,EAAanuB,GAAK8qB,GAAS9kB,CACjD,CACD,MAEC,IAAK,IAAIhG,EAAI,EAAGA,EAAIguB,EAAahuB,IAChC+Q,EAAO/Q,GAAKmuB,EAAanuB,GAAKgG,EAEhC,KACD,CACA,KAAK3J,EAAS0uB,MACd,KAAK1uB,EAAS6uB,QACb,IAAK,IAAIlrB,EAAI,EAAGA,EAAIguB,EAAahuB,IAChC+Q,EAAO/Q,KAAOmuB,EAAanuB,GAAK+Q,EAAO/Q,IAAMgG,EAC9C,MACD,KAAK3J,EAASsN,IACb,IAAIskB,EAAmBF,EACvB,GAA8B,MAA1BE,EAAiB/d,MAAe,CAEnC,IAAIge,EAAgBD,EAAiB9d,SACrC,IAAK,IAAInQ,EAAI,EAAGA,EAAIguB,EAAahuB,IAChC+Q,EAAO/Q,KAAOmuB,EAAanuB,GAAKkuB,EAAcluB,IAAMgG,CAEtD,MAEC,IAAK,IAAIhG,EAAI,EAAGA,EAAIguB,EAAahuB,IAChC+Q,EAAO/Q,IAAMmuB,EAAanuB,GAAKgG,EAInC,MACD,CAGA,IAAImlB,EAAQxC,EAAUQ,aAAawB,EAAQlH,GACvC2K,EAAeP,EAAc1C,EAAQ,GACrCkD,EAAeR,EAAc1C,GAC7Btb,EAAY8a,EAAOQ,GACnBZ,EAAU1vB,KAAKyvB,gBAAgBa,EAAQ,EAAG,GAAK1H,EAAO5T,IAAc8a,EAAOQ,EAAQ,GAAKtb,IAE5F,GAAa,GAAT7J,EACH,GAAI6H,GAASxR,EAASsN,IAAK,CAC1B,IAAIskB,EAAmBF,EACvB,GAA8B,MAA1BE,EAAiB/d,MAAe,CAEnC,IAAIge,EAAgBD,EAAiB9d,SACrC,IAAK,IAAInQ,EAAI,EAAGA,EAAIguB,EAAahuB,IAAK,CACrC,IAAIohB,EAAOgN,EAAapuB,GACxB+Q,EAAO/Q,IAAMohB,GAAQiN,EAAaruB,GAAKohB,GAAQmJ,EAAU2D,EAAcluB,EACxE,CACD,MAEC,IAAK,IAAIA,EAAI,EAAGA,EAAIguB,EAAahuB,IAAK,CACrC,IAAIohB,EAAOgN,EAAapuB,GACxB+Q,EAAO/Q,IAAMohB,GAAQiN,EAAaruB,GAAKohB,GAAQmJ,CAChD,CAEF,MACC,IAAK,IAAIvqB,EAAI,EAAGA,EAAIguB,EAAahuB,IAAK,CACrC,IAAIohB,EAAOgN,EAAapuB,GACxB+Q,EAAO/Q,GAAKohB,GAAQiN,EAAaruB,GAAKohB,GAAQmJ,CAC/C,MAGD,OAAQ1c,GACR,KAAKxR,EAASyuB,MAAO,CACpB,IAAImD,EAAmBF,EACvB,GAA8B,MAA1BE,EAAiB/d,MAAe,CAEnC,IAAIge,EAAgBD,EAAiB9d,SACrC,IAAK,IAAInQ,EAAI,EAAGA,EAAIguB,EAAahuB,IAAK,CACrC,IAAIohB,EAAOgN,EAAapuB,GAAI8qB,EAAQoD,EAAcluB,GAClD+Q,EAAO/Q,GAAK8qB,GAAS1J,GAAQiN,EAAaruB,GAAKohB,GAAQmJ,EAAUO,GAAS9kB,CAC3E,CACD,MAEC,IAAK,IAAIhG,EAAI,EAAGA,EAAIguB,EAAahuB,IAAK,CACrC,IAAIohB,EAAOgN,EAAapuB,GACxB+Q,EAAO/Q,IAAMohB,GAAQiN,EAAaruB,GAAKohB,GAAQmJ,GAAWvkB,CAC3D,CAED,KACD,CACA,KAAK3J,EAAS0uB,MACd,KAAK1uB,EAAS6uB,QACb,IAAK,IAAIlrB,EAAI,EAAGA,EAAIguB,EAAahuB,IAAK,CACrC,IAAIohB,EAAOgN,EAAapuB,GACxB+Q,EAAO/Q,KAAOohB,GAAQiN,EAAaruB,GAAKohB,GAAQmJ,EAAUxZ,EAAO/Q,IAAMgG,CACxE,CACA,MACD,KAAK3J,EAASsN,IACb,IAAIskB,EAAmBF,EACvB,GAA8B,MAA1BE,EAAiB/d,MAAe,CAEnC,IAAIge,EAAgBD,EAAiB9d,SACrC,IAAK,IAAInQ,EAAI,EAAGA,EAAIguB,EAAahuB,IAAK,CACrC,IAAIohB,EAAOgN,EAAapuB,GACxB+Q,EAAO/Q,KAAOohB,GAAQiN,EAAaruB,GAAKohB,GAAQmJ,EAAU2D,EAAcluB,IAAMgG,CAC/E,CACD,MAEC,IAAK,IAAIhG,EAAI,EAAGA,EAAIguB,EAAahuB,IAAK,CACrC,IAAIohB,EAAOgN,EAAapuB,GACxB+Q,EAAO/Q,KAAOohB,GAAQiN,EAAaruB,GAAKohB,GAAQmJ,GAAWvkB,CAC5D,EAIJ,EAIM,MAAMsoB,GAEZ3D,OAGAzB,OAEA,WAAAvuB,CAAaiV,GACZ/U,KAAK8vB,OAASre,EAAMc,cAAcwC,GAClC/U,KAAKquB,OAAS,IAAInrB,MAAa6R,EAChC,CAEA,aAAAmZ,GACC,OAAOxsB,EAAagyB,OAAS,EAC9B,CAGA,aAAA1E,GACC,OAAOhvB,KAAK8vB,OAAOhsB,MACpB,CAGA,QAAAisB,CAAUb,EAAoBwE,GAC7B1zB,KAAK8vB,OAAOZ,GAAcwE,EAAM9K,KAChC5oB,KAAKquB,OAAOa,GAAcwE,CAC3B,CAGA,KAAAxT,CAAOnK,EAAoBnB,EAAkBgU,EAAcqK,EAA2B9nB,EAAe6H,EAAiB/N,GACrH,GAAmB,MAAfguB,EAAqB,OACzB,IAAInD,EAAS9vB,KAAK8vB,OACd/a,EAAa/U,KAAK8vB,OAAOhsB,OAE7B,GAAI8Q,EAAWgU,EACd5oB,KAAKkgB,MAAMnK,EAAUnB,EAAU6Y,OAAOkG,UAAWV,EAAa9nB,EAAO6H,EAAO/N,GAC5E2P,GAAY,OACN,GAAIA,GAAYkb,EAAO/a,EAAa,GAC1C,OACD,GAAI6T,EAAOkH,EAAO,GAAI,OAEtB,IAAIQ,EAAQ,EACZ,GAAI1b,EAAWkb,EAAO,GACrBQ,EAAQ,MACJ,CACJA,EAAQxC,EAAUQ,aAAawB,EAAQlb,GACvC,IAAII,EAAY8a,EAAOQ,GACvB,KAAOA,EAAQ,GACVR,EAAOQ,EAAQ,IAAMtb,GACzBsb,GAEF,CACA,KAAOA,EAAQvb,GAAc6T,GAAQkH,EAAOQ,GAAQA,IACnD2C,EAAYluB,KAAK/E,KAAKquB,OAAOiC,GAC/B,EAIM,MAAMsD,GAEZ9D,OAGA+D,WAEA,WAAA/zB,CAAaiV,GACZ/U,KAAK8vB,OAASre,EAAMc,cAAcwC,GAClC/U,KAAK6zB,WAAa,IAAI3wB,MAAqB6R,EAC5C,CAEA,aAAAmZ,GACC,OAAOxsB,EAAayoB,WAAa,EAClC,CAGA,aAAA6E,GACC,OAAOhvB,KAAK8vB,OAAOhsB,MACpB,CAKA,QAAAisB,CAAUb,EAAoBtG,EAAcuB,GAC3CnqB,KAAK8vB,OAAOZ,GAActG,EAC1B5oB,KAAK6zB,WAAW3E,GAAc/E,CAC/B,CAEA,KAAAjK,CAAOnK,EAAoBnB,EAAkBgU,EAAcqK,EAA2B9nB,EAAe6H,EAAiB/N,GACrH,IAAIklB,EAAyBpU,EAASoU,UAClCD,EAAqBnU,EAASmU,MAClC,GAAIjlB,GAAaxD,EAAawvB,OAE7B,YADIje,GAASxR,EAASyuB,OAAOxe,EAAMC,UAAUqE,EAASmU,MAAO,EAAGnU,EAASoU,UAAW,EAAGpU,EAASmU,MAAMpmB,SAIvG,IAAIgsB,EAAS9vB,KAAK8vB,OAClB,GAAIlH,EAAOkH,EAAO,GAEjB,YADI9c,GAASxR,EAASyuB,OAASjd,GAASxR,EAAS0uB,OAAOze,EAAMC,UAAUqE,EAASmU,MAAO,EAAGnU,EAASoU,UAAW,EAAGpU,EAASmU,MAAMpmB,SAIlI,IAAIwsB,EAAQ,EAEXA,EADG1H,GAAQkH,EAAOA,EAAOhsB,OAAS,GAC1BgsB,EAAOhsB,OAAS,EAEhBgqB,EAAUQ,aAAawB,EAAQlH,GAAQ,EAEhD,IAAIkL,EAAwB9zB,KAAK6zB,WAAWvD,GAC5C,GAA6B,MAAzBwD,EACHriB,EAAMC,UAAUwY,EAAO,EAAGC,EAAW,EAAGD,EAAMpmB,aAE9C,IAAK,IAAIqB,EAAI,EAAGqG,EAAIsoB,EAAsBhwB,OAAQqB,EAAIqG,EAAGrG,IACxDglB,EAAUhlB,GAAK+kB,EAAM4J,EAAsB3uB,GAE9C,EAKM,MAAM4uB,WAA6BjF,EACzC/iB,eAAiB,EACjBA,kBAAoB,EAAGA,iBAAmB,EAAGA,sBAAwB,EAAGA,4BAA8B,EAAGA,sBAAwB,EAAGA,qBAAuB,EAC3JA,WAAa,EAAGA,gBAAkB,EAAGA,sBAAwB,EAAGA,gBAAkB,EAAGA,eAAiB,EAGtGioB,kBAGAlE,OAEA,WAAAhwB,CAAaiV,GACZ/H,MAAM+H,GACN/U,KAAK8vB,OAASre,EAAMc,cAAcwC,EAAagf,GAAqB5D,QACrE,CAEA,aAAAjC,GACC,OAAQxsB,EAAa2rB,cAAgB,IAAMrtB,KAAKg0B,iBACjD,CAGA,QAAAjE,CAAUb,EAAoBtG,EAAc7I,EAAaC,EAAkBJ,EAAuBC,EAAmBC,GACpHoP,GAAc6E,GAAqB5D,QACnCnwB,KAAK8vB,OAAOZ,GAActG,EAC1B5oB,KAAK8vB,OAAOZ,EAAa6E,GAAqBE,KAAOlU,EACrD/f,KAAK8vB,OAAOZ,EAAa6E,GAAqBG,UAAYlU,EAC1DhgB,KAAK8vB,OAAOZ,EAAa6E,GAAqBI,gBAAkBvU,EAChE5f,KAAK8vB,OAAOZ,EAAa6E,GAAqBK,UAAYvU,EAAW,EAAI,EACzE7f,KAAK8vB,OAAOZ,EAAa6E,GAAqBM,SAAWvU,EAAU,EAAI,CACxE,CAEA,KAAAI,CAAOnK,EAAoBnB,EAAkBgU,EAAcqK,EAA2B9nB,EAAe6H,EAAiB/N,GACrH,IAAI6qB,EAAS9vB,KAAK8vB,OACd1E,EAA2BrV,EAASqU,cAAcpqB,KAAKg0B,mBAC3D,IAAK5I,EAAWjP,OAAQ,OACxB,GAAIyM,EAAOkH,EAAO,GAAI,CACrB,OAAQ9c,GACR,KAAKxR,EAASyuB,MAMb,OALA7E,EAAWrL,IAAMqL,EAAWzkB,KAAKoZ,IACjCqL,EAAWpL,SAAWoL,EAAWzkB,KAAKqZ,SACtCoL,EAAWxL,cAAgBwL,EAAWzkB,KAAKiZ,cAC3CwL,EAAWvL,SAAWuL,EAAWzkB,KAAKkZ,cACtCuL,EAAWtL,QAAUsL,EAAWzkB,KAAKmZ,SAEtC,KAAKte,EAAS0uB,MACb9E,EAAWrL,MAAQqL,EAAWzkB,KAAKoZ,IAAMqL,EAAWrL,KAAO5U,EAC3DigB,EAAWpL,WAAaoL,EAAWzkB,KAAKqZ,SAAWoL,EAAWpL,UAAY7U,EAC1EigB,EAAWxL,cAAgBwL,EAAWzkB,KAAKiZ,cAC3CwL,EAAWvL,SAAWuL,EAAWzkB,KAAKkZ,SACtCuL,EAAWtL,QAAUsL,EAAWzkB,KAAKmZ,QAEtC,MACD,CAEA,GAAI8I,GAAQkH,EAAOA,EAAOhsB,OAASiwB,GAAqB5D,SAuBvD,YAtBInd,GAASxR,EAASyuB,OACrB7E,EAAWrL,IAAMqL,EAAWzkB,KAAKoZ,KAAO+P,EAAOA,EAAOhsB,OAASiwB,GAAqBO,UAAYlJ,EAAWzkB,KAAKoZ,KAAO5U,EACvHigB,EAAWpL,SAAWoL,EAAWzkB,KAAKqZ,UAClC8P,EAAOA,EAAOhsB,OAASiwB,GAAqBQ,eAAiBnJ,EAAWzkB,KAAKqZ,UAAY7U,EACzFlG,GAAaxD,EAAawvB,QAC7B7F,EAAWxL,cAAgBwL,EAAWzkB,KAAKiZ,cAC3CwL,EAAWvL,SAAWuL,EAAWzkB,KAAKkZ,SACtCuL,EAAWtL,QAAUsL,EAAWzkB,KAAKmZ,UAErCsL,EAAWxL,cAAgBkQ,EAAOA,EAAOhsB,OAASiwB,GAAqBS,qBACvEpJ,EAAWvL,SAAyE,GAA9DiQ,EAAOA,EAAOhsB,OAASiwB,GAAqBU,eAClErJ,EAAWtL,QAAuE,GAA7DgQ,EAAOA,EAAOhsB,OAASiwB,GAAqBW,iBAGlEtJ,EAAWrL,MAAQ+P,EAAOA,EAAOhsB,OAASiwB,GAAqBO,UAAYlJ,EAAWrL,KAAO5U,EAC7FigB,EAAWpL,WAAa8P,EAAOA,EAAOhsB,OAASiwB,GAAqBQ,eAAiBnJ,EAAWpL,UAAY7U,EACxGlG,GAAaxD,EAAakzB,QAC7BvJ,EAAWxL,cAAgBkQ,EAAOA,EAAOhsB,OAASiwB,GAAqBS,qBACvEpJ,EAAWvL,SAAyE,GAA9DiQ,EAAOA,EAAOhsB,OAASiwB,GAAqBU,eAClErJ,EAAWtL,QAAuE,GAA7DgQ,EAAOA,EAAOhsB,OAASiwB,GAAqBW,iBAOpE,IAAIpE,EAAQxC,EAAUQ,aAAawB,EAAQlH,EAAMmL,GAAqB5D,SAClEpQ,EAAM+P,EAAOQ,EAAQyD,GAAqBO,UAC1CtU,EAAW8P,EAAOQ,EAAQyD,GAAqBQ,eAC/Cvf,EAAY8a,EAAOQ,GACnBZ,EAAU1vB,KAAKyvB,gBAAgBa,EAAQyD,GAAqB5D,QAAU,EACzE,GAAKvH,EAAO5T,IAAc8a,EAAOQ,EAAQyD,GAAqBvD,WAAaxb,IAExEhC,GAASxR,EAASyuB,OACrB7E,EAAWrL,IAAMqL,EAAWzkB,KAAKoZ,KAAOA,GAAO+P,EAAOQ,EAAQyD,GAAqBE,KAAOlU,GAAO2P,EAAUtE,EAAWzkB,KAAKoZ,KAAO5U,EAClIigB,EAAWpL,SAAWoL,EAAWzkB,KAAKqZ,UAClCA,GAAY8P,EAAOQ,EAAQyD,GAAqBG,UAAYlU,GAAY0P,EAAUtE,EAAWzkB,KAAKqZ,UAAY7U,EAC9GlG,GAAaxD,EAAawvB,QAC7B7F,EAAWxL,cAAgBwL,EAAWzkB,KAAKiZ,cAC3CwL,EAAWvL,SAAWuL,EAAWzkB,KAAKkZ,SACtCuL,EAAWtL,QAAUsL,EAAWzkB,KAAKmZ,UAErCsL,EAAWxL,cAAgBkQ,EAAOQ,EAAQyD,GAAqBS,qBAC/DpJ,EAAWvL,SAAiE,GAAtDiQ,EAAOQ,EAAQyD,GAAqBU,eAC1DrJ,EAAWtL,QAA+D,GAArDgQ,EAAOQ,EAAQyD,GAAqBW,iBAG1DtJ,EAAWrL,MAAQA,GAAO+P,EAAOQ,EAAQyD,GAAqBE,KAAOlU,GAAO2P,EAAUtE,EAAWrL,KAAO5U,EACxGigB,EAAWpL,WAAaA,GAAY8P,EAAOQ,EAAQyD,GAAqBG,UAAYlU,GAAY0P,EAAUtE,EAAWpL,UAAY7U,EAC7HlG,GAAaxD,EAAakzB,QAC7BvJ,EAAWxL,cAAgBkQ,EAAOQ,EAAQyD,GAAqBS,qBAC/DpJ,EAAWvL,SAAiE,GAAtDiQ,EAAOQ,EAAQyD,GAAqBU,eAC1DrJ,EAAWtL,QAA+D,GAArDgQ,EAAOQ,EAAQyD,GAAqBW,eAG5D,EAKM,MAAME,WAAoC9F,EAChD/iB,eAAiB,EACjBA,kBAAoB,EAAGA,oBAAsB,EAAGA,uBAAyB,EAAGA,mBAAqB,EAAGA,mBAAqB,EACzHA,cAAgB,EAAGA,iBAAmB,EAAGA,aAAe,EAAGA,aAAe,EAG1E8oB,yBAGA/E,OAEA,WAAAhwB,CAAaiV,GACZ/H,MAAM+H,GACN/U,KAAK8vB,OAASre,EAAMc,cAAcwC,EAAa6f,GAA4BzE,QAC5E,CAEA,aAAAjC,GACC,OAAQxsB,EAAaozB,qBAAuB,IAAM90B,KAAK60B,wBACxD,CAGA,QAAA9E,CAAUb,EAAoBtG,EAAc9E,EAAmBC,EAAsBkF,EAAkBC,GACtGgG,GAAc0F,GAA4BzE,QAC1CnwB,KAAK8vB,OAAOZ,GAActG,EAC1B5oB,KAAK8vB,OAAOZ,EAAa0F,GAA4BG,QAAUjR,EAC/D9jB,KAAK8vB,OAAOZ,EAAa0F,GAA4BI,WAAajR,EAClE/jB,KAAK8vB,OAAOZ,EAAa0F,GAA4BK,OAAShM,EAC9DjpB,KAAK8vB,OAAOZ,EAAa0F,GAA4BM,OAAShM,CAC/D,CAEA,KAAAhJ,CAAOnK,EAAoBnB,EAAkBgU,EAAcqK,EAA2B9nB,EAAe6H,EAAiB/N,GACrH,IAAI6qB,EAAS9vB,KAAK8vB,OAEd1E,EAAkCrV,EAASsU,qBAAqBrqB,KAAK60B,0BACzE,IAAKzJ,EAAWjP,OAAQ,OACxB,GAAIyM,EAAOkH,EAAO,GAAI,CACrB,IAAInpB,EAAOykB,EAAWzkB,KACtB,OAAQqM,GACR,KAAKxR,EAASyuB,MAKb,OAJA7E,EAAWtH,UAAYnd,EAAKmd,UAC5BsH,EAAWrH,aAAepd,EAAKod,aAC/BqH,EAAWnC,SAAWtiB,EAAKsiB,cAC3BmC,EAAWlC,SAAWviB,EAAKuiB,UAE5B,KAAK1nB,EAAS0uB,MACb9E,EAAWtH,YAAcnd,EAAKmd,UAAYsH,EAAWtH,WAAa3Y,EAClEigB,EAAWrH,eAAiBpd,EAAKod,aAAeqH,EAAWrH,cAAgB5Y,EAC3EigB,EAAWnC,WAAatiB,EAAKsiB,SAAWmC,EAAWnC,UAAY9d,EAC/DigB,EAAWlC,WAAaviB,EAAKuiB,SAAWkC,EAAWlC,UAAY/d,EAEhE,MACD,CAEA,IAAIhJ,EAAS,EAAGuuB,EAAY,EAAG/L,EAAQ,EAAGwM,EAAQ,EAClD,GAAIvI,GAAQkH,EAAOA,EAAOhsB,OAAS8wB,GAA4BzE,SAAU,CACxE,IAAIhrB,EAAI2qB,EAAOhsB,OACf3B,EAAS2tB,EAAO3qB,EAAIyvB,GAA4BO,aAChDzE,EAAYZ,EAAO3qB,EAAIyvB,GAA4BQ,gBACnDzQ,EAAQmL,EAAO3qB,EAAIyvB,GAA4BS,YAC/ClE,EAAQrB,EAAO3qB,EAAIyvB,GAA4BU,WAChD,KAAO,CAEN,IAAIhF,EAAQxC,EAAUQ,aAAawB,EAAQlH,EAAMgM,GAA4BzE,SAC7EhuB,EAAS2tB,EAAOQ,EAAQsE,GAA4BO,aACpDzE,EAAYZ,EAAOQ,EAAQsE,GAA4BQ,gBACvDzQ,EAAQmL,EAAOQ,EAAQsE,GAA4BS,YACnDlE,EAAQrB,EAAOQ,EAAQsE,GAA4BU,YACnD,IAAItgB,EAAY8a,EAAOQ,GACnBZ,EAAU1vB,KAAKyvB,gBAAgBa,EAAQsE,GAA4BzE,QAAU,EAChF,GAAKvH,EAAO5T,IAAc8a,EAAOQ,EAAQsE,GAA4BpE,WAAaxb,IAEnF7S,IAAW2tB,EAAOQ,EAAQsE,GAA4BG,QAAU5yB,GAAUutB,EAC1EgB,IAAcZ,EAAOQ,EAAQsE,GAA4BI,WAAatE,GAAahB,EACnF/K,IAAUmL,EAAOQ,EAAQsE,GAA4BK,OAAStQ,GAAS+K,EACvEyB,IAAUrB,EAAOQ,EAAQsE,GAA4BM,OAAS/D,GAASzB,CACxE,CACA,GAAI1c,GAASxR,EAASyuB,MAAO,CAC5B,IAAItpB,EAAOykB,EAAWzkB,KACtBykB,EAAWtH,UAAYnd,EAAKmd,WAAa3hB,EAASwE,EAAKmd,WAAa3Y,EACpEigB,EAAWrH,aAAepd,EAAKod,cAAgB2M,EAAY/pB,EAAKod,cAAgB5Y,EAChFigB,EAAWnC,SAAWtiB,EAAKsiB,UAAYtE,EAAQhe,EAAKsiB,UAAY9d,EAChEigB,EAAWlC,SAAWviB,EAAKuiB,UAAYiI,EAAQxqB,EAAKuiB,UAAY/d,CACjE,MACCigB,EAAWtH,YAAc3hB,EAASipB,EAAWtH,WAAa3Y,EAC1DigB,EAAWrH,eAAiB2M,EAAYtF,EAAWrH,cAAgB5Y,EACnEigB,EAAWnC,WAAatE,EAAQyG,EAAWnC,UAAY9d,EACvDigB,EAAWlC,WAAaiI,EAAQ/F,EAAWlC,UAAY/d,CAEzD,EAIM,MAAMoqB,WAAuCzG,EACnD/iB,eAAiB,EACjBA,kBAAoB,EAAGA,mBAAqB,EAC5CA,aAAe,EAGfypB,oBAGA1F,OAEA,WAAAhwB,CAAaiV,GACZ/H,MAAM+H,GACN/U,KAAK8vB,OAASre,EAAMc,cAAcwC,EAAawgB,GAA+BpF,QAC/E,CAEA,aAAAjC,GACC,OAAQxsB,EAAa+zB,wBAA0B,IAAMz1B,KAAKw1B,mBAC3D,CAGA,QAAAzF,CAAUb,EAAoBtG,EAAc7Z,GAC3CmgB,GAAcqG,GAA+BpF,QAC7CnwB,KAAK8vB,OAAOZ,GAActG,EAC1B5oB,KAAK8vB,OAAOZ,EAAaqG,GAA+BG,OAAS3mB,CAClE,CAEA,KAAAmR,CAAOnK,EAAoBnB,EAAkBgU,EAAcqK,EAA2B9nB,EAAe6H,EAAiB/N,GACrH,IAAI6qB,EAAS9vB,KAAK8vB,OACd1E,EAA6BrV,EAASuU,gBAAgBtqB,KAAKw1B,qBAC/D,IAAKpK,EAAWjP,OAAQ,OACxB,GAAIyM,EAAOkH,EAAO,GAAI,CACrB,OAAQ9c,GACR,KAAKxR,EAASyuB,MAEb,YADA7E,EAAWxH,SAAWwH,EAAWzkB,KAAKid,UAEvC,KAAKpiB,EAAS0uB,MACb9E,EAAWxH,WAAawH,EAAWzkB,KAAKid,SAAWwH,EAAWxH,UAAYzY,EAE3E,MACD,CAEA,IAAIyY,EAAW,EACf,GAAIgF,GAAQkH,EAAOA,EAAOhsB,OAASyxB,GAA+BpF,SACjEvM,EAAWkM,EAAOA,EAAOhsB,OAASyxB,GAA+BI,gBAC7D,CAEJ,IAAIrF,EAAQxC,EAAUQ,aAAawB,EAAQlH,EAAM2M,GAA+BpF,SAChFvM,EAAWkM,EAAOQ,EAAQiF,GAA+BI,YACzD,IAAI3gB,EAAY8a,EAAOQ,GACnBZ,EAAU1vB,KAAKyvB,gBAAgBa,EAAQiF,GAA+BpF,QAAU,EACnF,GAAKvH,EAAO5T,IAAc8a,EAAOQ,EAAQiF,GAA+B/E,WAAaxb,IAEtF4O,IAAakM,EAAOQ,EAAQiF,GAA+BG,OAAS9R,GAAY8L,CACjF,CACI1c,GAASxR,EAASyuB,MACrB7E,EAAWxH,SAAWwH,EAAWzkB,KAAKid,UAAYA,EAAWwH,EAAWzkB,KAAKid,UAAYzY,EAEzFigB,EAAWxH,WAAaA,EAAWwH,EAAWxH,UAAYzY,CAC5D,EAIM,MAAMyqB,WAAsCL,GAClD,WAAAz1B,CAAaiV,GACZ/H,MAAM+H,EACP,CAEA,aAAAmZ,GACC,OAAQxsB,EAAam0B,uBAAyB,IAAM71B,KAAKw1B,mBAC1D,CAEA,KAAAtV,CAAOnK,EAAoBnB,EAAkBgU,EAAcqK,EAA2B9nB,EAAe6H,EAAiB/N,GACrH,IAAI6qB,EAAS9vB,KAAK8vB,OACd1E,EAA6BrV,EAASuU,gBAAgBtqB,KAAKw1B,qBAC/D,IAAKpK,EAAWjP,OAAQ,OACxB,GAAIyM,EAAOkH,EAAO,GAAI,CACrB,OAAQ9c,GACR,KAAKxR,EAASyuB,MAEb,YADA7E,EAAWvH,QAAUuH,EAAWzkB,KAAKkd,SAEtC,KAAKriB,EAAS0uB,MACb9E,EAAWvH,UAAYuH,EAAWzkB,KAAKkd,QAAUuH,EAAWvH,SAAW1Y,EAExE,MACD,CAEA,IAAI0Y,EAAU,EACd,GAAI+E,GAAQkH,EAAOA,EAAOhsB,OAAS8xB,GAA8BzF,SAChEtM,EAAUiM,EAAOA,EAAOhsB,OAAS8xB,GAA8BD,gBAC3D,CAEJ,IAAIrF,EAAQxC,EAAUQ,aAAawB,EAAQlH,EAAMgN,GAA8BzF,SAC/EtM,EAAUiM,EAAOQ,EAAQsF,GAA8BD,YACvD,IAAI3gB,EAAY8a,EAAOQ,GACnBZ,EAAU1vB,KAAKyvB,gBAAgBa,EAAQsF,GAA8BzF,QAAU,EAClF,GAAKvH,EAAO5T,IAAc8a,EAAOQ,EAAQsF,GAA8BpF,WAAaxb,IAErF6O,IAAYiM,EAAOQ,EAAQsF,GAA8BF,OAAS7R,GAAW6L,CAC9E,CAEI1c,GAASxR,EAASyuB,MACrB7E,EAAWvH,QAAUuH,EAAWzkB,KAAKkd,SAAWA,EAAUuH,EAAWzkB,KAAKkd,SAAW1Y,EAErFigB,EAAWvH,UAAYA,EAAUuH,EAAWvH,SAAW1Y,CACzD,EAKM,MAAM2qB,WAAkChH,EAC9C/iB,eAAiB,EACjBA,kBAAoB,EAAGA,oBAAsB,EAAGA,uBAAyB,EACzEA,cAAgB,EAAGA,iBAAmB,EAGtCypB,oBAGA1F,OAEA,WAAAhwB,CAAaiV,GACZ/H,MAAM+H,GACN/U,KAAK8vB,OAASre,EAAMc,cAAcwC,EAAa+gB,GAA0B3F,QAC1E,CAEA,aAAAjC,GACC,OAAQxsB,EAAaq0B,mBAAqB,IAAM/1B,KAAKw1B,mBACtD,CAGA,QAAAzF,CAAUb,EAAoBtG,EAAc9E,EAAmBC,GAC9DmL,GAAc4G,GAA0B3F,QACxCnwB,KAAK8vB,OAAOZ,GAActG,EAC1B5oB,KAAK8vB,OAAOZ,EAAa4G,GAA0Bf,QAAUjR,EAC7D9jB,KAAK8vB,OAAOZ,EAAa4G,GAA0Bd,WAAajR,CACjE,CAEA,KAAA7D,CAAOnK,EAAoBnB,EAAkBgU,EAAcqK,EAA2B9nB,EAAe6H,EAAiB/N,GACrH,IAAI6qB,EAAS9vB,KAAK8vB,OACd1E,EAA6BrV,EAASuU,gBAAgBtqB,KAAKw1B,qBAC/D,IAAKpK,EAAWjP,OAAQ,OACxB,GAAIyM,EAAOkH,EAAO,GAAI,CACrB,OAAQ9c,GACR,KAAKxR,EAASyuB,MAGb,OAFA7E,EAAWtH,UAAYsH,EAAWzkB,KAAKmd,eACvCsH,EAAWrH,aAAeqH,EAAWzkB,KAAKod,cAE3C,KAAKviB,EAAS0uB,MACb9E,EAAWtH,YAAcsH,EAAWzkB,KAAKmd,UAAYsH,EAAWtH,WAAa3Y,EAC7EigB,EAAWrH,eAAiBqH,EAAWzkB,KAAKod,aAAeqH,EAAWrH,cAAgB5Y,EAEvF,MACD,CAEA,IAAIhJ,EAAS,EAAGuuB,EAAY,EAC5B,GAAI9H,GAAQkH,EAAOA,EAAOhsB,OAASgyB,GAA0B3F,SAC5DhuB,EAAS2tB,EAAOA,EAAOhsB,OAASgyB,GAA0BX,aAC1DzE,EAAYZ,EAAOA,EAAOhsB,OAASgyB,GAA0BV,oBACvD,CAEN,IAAI9E,EAAQxC,EAAUQ,aAAawB,EAAQlH,EAAMkN,GAA0B3F,SAC3EhuB,EAAS2tB,EAAOQ,EAAQwF,GAA0BX,aAClDzE,EAAYZ,EAAOQ,EAAQwF,GAA0BV,gBACrD,IAAIpgB,EAAY8a,EAAOQ,GACnBZ,EAAU1vB,KAAKyvB,gBAAgBa,EAAQwF,GAA0B3F,QAAU,EAC9E,GAAKvH,EAAO5T,IAAc8a,EAAOQ,EAAQwF,GAA0BtF,WAAaxb,IAEjF7S,IAAW2tB,EAAOQ,EAAQwF,GAA0Bf,QAAU5yB,GAAUutB,EACxEgB,IAAcZ,EAAOQ,EAAQwF,GAA0Bd,WAAatE,GAAahB,CAClF,CAEI1c,GAASxR,EAASyuB,OACrB7E,EAAWtH,UAAYsH,EAAWzkB,KAAKmd,WAAa3hB,EAASipB,EAAWzkB,KAAKmd,WAAa3Y,EAC1FigB,EAAWrH,aAAeqH,EAAWzkB,KAAKod,cAAgB2M,EAAYtF,EAAWzkB,KAAKod,cAAgB5Y,IAEtGigB,EAAWtH,YAAc3hB,EAASipB,EAAWtH,WAAa3Y,EAC1DigB,EAAWrH,eAAiB2M,EAAYtF,EAAWrH,cAAgB5Y,EAErE,EsB5/CD,IAAY6qB,IAAZ,SAAYA,GACX,uBAAQ,iCAAa,mBAAM,+BAAY,mBAAM,qBAAO,0BACpD,CAFD,CAAYA,KAAAA,GAAc,KCQnB,MAAMC,GACZtvB,KACAuvB,SACAC,WACAC,YACAxN,KACAyN,OACAC,QAEA,WAAAx2B,CAAa8oB,EAAcjiB,GAC1B,GAAY,MAARA,EAAc,MAAM,IAAI9F,MAAM,wBAClCb,KAAK4oB,KAAOA,EACZ5oB,KAAK2G,KAAOA,CACb,EClBM,MAAM4vB,GACZtyB,KACAiyB,SACAC,WACAC,YACAI,UACAH,OACAC,QAEA,WAAAx2B,CAAamE,GACZjE,KAAKiE,KAAOA,CACb,ECPM,MAAMwyB,WAAyBpT,EAErChO,MAAQ,IAAInS,MAGZyc,OAGAC,cAAgB,EAGhBC,UAAW,EAIXC,SAAU,EAIVM,SAAU,EAGVL,IAAM,EAGNC,SAAW,EAEX,WAAAlgB,CAAamE,GACZ+I,MAAM/I,EAAM,GAAG,EAChB,ECvBM,MAAMyyB,GAGZzyB,KAGAoR,MAAQ,IAAInS,MAGZgnB,MAAQ,IAAIhnB,MACZ8oB,MAAQ,IAAI9oB,MAMZ6oB,YAGAsC,OAAS,IAAInrB,MAGbyzB,WAAa,IAAIzzB,MAGjBknB,cAAgB,IAAIlnB,MAGpBmnB,qBAAuB,IAAInnB,MAG3BonB,gBAAkB,IAAIpnB,MAGtBsB,EAGAE,EAGAzC,MAGAC,OAGA00B,QAGAC,KAIAC,IAAM,EAGNC,WAGAP,UAKA,QAAAvW,CAAUuM,GACT,GAAgB,MAAZA,EAAkB,MAAM,IAAI3rB,MAAM,4BACtC,IAAIwU,EAAQrV,KAAKqV,MACjB,IAAK,IAAIlQ,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAI6Q,EAAOX,EAAMlQ,GACjB,GAAI6Q,EAAK/R,MAAQuoB,EAAU,OAAOxW,CACnC,CACA,OAAO,IACR,CAEA,aAAAyW,CAAeD,GACd,GAAgB,MAAZA,EAAkB,MAAM,IAAI3rB,MAAM,4BACtC,IAAIwU,EAAQrV,KAAKqV,MACjB,IAAK,IAAIlQ,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IACxC,GAAIkQ,EAAMlQ,GAAGlB,MAAQuoB,EAAU,OAAOrnB,EACvC,OAAQ,CACT,CAKA,QAAAkf,CAAUqI,GACT,GAAgB,MAAZA,EAAkB,MAAM,IAAI7rB,MAAM,4BACtC,IAAIqpB,EAAQlqB,KAAKkqB,MACjB,IAAK,IAAI/kB,EAAI,EAAGqG,EAAI0e,EAAMpmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAIuQ,EAAOwU,EAAM/kB,GACjB,GAAIuQ,EAAKzR,MAAQyoB,EAAU,OAAOhX,CACnC,CACA,OAAO,IACR,CAEA,aAAAiX,CAAeD,GACd,GAAgB,MAAZA,EAAkB,MAAM,IAAI7rB,MAAM,4BACtC,IAAIqpB,EAAQlqB,KAAKkqB,MACjB,IAAK,IAAI/kB,EAAI,EAAGqG,EAAI0e,EAAMpmB,OAAQqB,EAAIqG,EAAGrG,IACxC,GAAI+kB,EAAM/kB,GAAGlB,MAAQyoB,EAAU,OAAOvnB,EACvC,OAAQ,CACT,CAKA,QAAA2nB,CAAUD,GACT,GAAgB,MAAZA,EAAkB,MAAM,IAAIhsB,MAAM,4BACtC,IAAImrB,EAAQhsB,KAAKgsB,MACjB,IAAK,IAAI7mB,EAAI,EAAGqG,EAAIwgB,EAAMloB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAI0V,EAAOmR,EAAM7mB,GACjB,GAAI0V,EAAK5W,MAAQ4oB,EAAU,OAAOhS,CACnC,CACA,OAAO,IACR,CAKA,SAAAmc,CAAWC,GACV,GAAqB,MAAjBA,EAAuB,MAAM,IAAIp2B,MAAM,iCAC3C,IAAIwtB,EAASruB,KAAKquB,OAClB,IAAK,IAAIlpB,EAAI,EAAGqG,EAAI6iB,EAAOvqB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC9C,IAAIuuB,EAAQrF,EAAOlpB,GACnB,GAAIuuB,EAAMzvB,MAAQgzB,EAAe,OAAOvD,CACzC,CACA,OAAO,IACR,CAKA,aAAAwD,CAAeC,GACd,GAAqB,MAAjBA,EAAuB,MAAM,IAAIt2B,MAAM,iCAC3C,IAAI81B,EAAa32B,KAAK22B,WACtB,IAAK,IAAIxxB,EAAI,EAAGqG,EAAImrB,EAAW7yB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAClD,IAAIiyB,EAAYT,EAAWxxB,GAC3B,GAAIiyB,EAAUnzB,MAAQkzB,EAAe,OAAOC,CAC7C,CACA,OAAO,IACR,CAKA,gBAAAjK,CAAkBC,GACjB,GAAsB,MAAlBA,EAAwB,MAAM,IAAIvsB,MAAM,kCAC5C,IAAIupB,EAAgBpqB,KAAKoqB,cACzB,IAAK,IAAIjlB,EAAI,EAAGqG,EAAI4e,EAActmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CACrD,IAAIimB,EAAahB,EAAcjlB,GAC/B,GAAIimB,EAAWnnB,MAAQmpB,EAAgB,OAAOhC,CAC/C,CACA,OAAO,IACR,CAKA,uBAAAkC,CAAyBF,GACxB,GAAsB,MAAlBA,EAAwB,MAAM,IAAIvsB,MAAM,kCAC5C,IAAIwpB,EAAuBrqB,KAAKqqB,qBAChC,IAAK,IAAIllB,EAAI,EAAGqG,EAAI6e,EAAqBvmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC5D,IAAIimB,EAAaf,EAAqBllB,GACtC,GAAIimB,EAAWnnB,MAAQmpB,EAAgB,OAAOhC,CAC/C,CACA,OAAO,IACR,CAKA,kBAAAmC,CAAoBH,GACnB,GAAsB,MAAlBA,EAAwB,MAAM,IAAIvsB,MAAM,kCAC5C,IAAIypB,EAAkBtqB,KAAKsqB,gBAC3B,IAAK,IAAInlB,EAAI,EAAGqG,EAAI8e,EAAgBxmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CACvD,IAAIimB,EAAad,EAAgBnlB,GACjC,GAAIimB,EAAWnnB,MAAQmpB,EAAgB,OAAOhC,CAC/C,CACA,OAAO,IACR,CAEA,uBAAAiM,CAAyBC,GACxB,GAA0B,MAAtBA,EAA4B,MAAM,IAAIz2B,MAAM,sCAChD,IAAIypB,EAAkBtqB,KAAKsqB,gBAC3B,IAAK,IAAInlB,EAAI,EAAGqG,EAAI8e,EAAgBxmB,OAAQqB,EAAIqG,EAAGrG,IAClD,GAAImlB,EAAgBnlB,GAAGlB,MAAQqzB,EAAoB,OAAOnyB,EAC3D,OAAQ,CACT,EChMM,MAAMoyB,GACO3L,UAA0B3nB,KAAqB8S,WAAlE,WAAAjX,CAAmB8rB,EAA0B3nB,EAAqB8S,GAA/C,KAAA6U,UAAAA,EAA0B,KAAA3nB,KAAAA,EAAqB,KAAA8S,WAAAA,CAA0B,EAOtF,MAAMygB,GAEZvzB,KAEAioB,YAAc,IAAIhpB,MAClBmS,MAAQnS,QACRuoB,YAAc,IAAIvoB,MAElB,WAAApD,CAAamE,GACZ,GAAY,MAARA,EAAc,MAAM,IAAIpD,MAAM,wBAClCb,KAAKiE,KAAOA,CACb,CAGA,aAAA0kB,CAAeiD,EAAmB3nB,EAAc8S,GAC/C,GAAkB,MAAdA,EAAoB,MAAM,IAAIlW,MAAM,8BACxC,IAAIqrB,EAAclsB,KAAKksB,YACnBN,GAAaM,EAAYpoB,SAAQooB,EAAYpoB,OAAS8nB,EAAY,GACjEM,EAAYN,KAAYM,EAAYN,GAAa,CAAC,GACvDM,EAAYN,GAAW3nB,GAAQ8S,CAChC,CAGA,OAAA0gB,CAAS5c,GACR,IAAI,IAAI1V,EAAI,EAAGA,EAAI0V,EAAKxF,MAAMvR,OAAQqB,IAAK,CAC1C,IAAI6Q,EAAO6E,EAAKxF,MAAMlQ,GAClBuyB,GAAY,EAChB,IAAK,IAAI1lB,EAAI,EAAGA,EAAIhS,KAAKqV,MAAMvR,OAAQkO,IACtC,GAAIhS,KAAKqV,MAAMrD,IAAMgE,EAAM,CAC1B0hB,GAAY,EACZ,KACD,CAEIA,GAAW13B,KAAKqV,MAAMtQ,KAAKiR,EACjC,CAEA,IAAI,IAAI7Q,EAAI,EAAGA,EAAI0V,EAAK4Q,YAAY3nB,OAAQqB,IAAK,CAChD,IAAIimB,EAAavQ,EAAK4Q,YAAYtmB,GAC9BuyB,GAAY,EAChB,IAAK,IAAI1lB,EAAI,EAAGA,EAAIhS,KAAKyrB,YAAY3nB,OAAQkO,IAC5C,GAAIhS,KAAKyrB,YAAYzZ,IAAMoZ,EAAY,CACtCsM,GAAY,EACZ,KACD,CAEIA,GAAW13B,KAAKyrB,YAAY1mB,KAAKqmB,EACvC,CAEA,IAAIc,EAAcrR,EAAK8c,iBACvB,IAAK,IAAIxyB,EAAI,EAAGA,EAAI+mB,EAAYpoB,OAAQqB,IAAK,CAC5C,IAAI4R,EAAamV,EAAY/mB,GAC7BnF,KAAK2oB,cAAc5R,EAAW6U,UAAW7U,EAAW9S,KAAM8S,EAAWA,WACtE,CACD,CAIA,QAAA6gB,CAAU/c,GACT,IAAI,IAAI1V,EAAI,EAAGA,EAAI0V,EAAKxF,MAAMvR,OAAQqB,IAAK,CAC1C,IAAI6Q,EAAO6E,EAAKxF,MAAMlQ,GAClBuyB,GAAY,EAChB,IAAK,IAAI1lB,EAAI,EAAGA,EAAIhS,KAAKqV,MAAMvR,OAAQkO,IACtC,GAAIhS,KAAKqV,MAAMrD,IAAMgE,EAAM,CAC1B0hB,GAAY,EACZ,KACD,CAEIA,GAAW13B,KAAKqV,MAAMtQ,KAAKiR,EACjC,CAEA,IAAI,IAAI7Q,EAAI,EAAGA,EAAI0V,EAAK4Q,YAAY3nB,OAAQqB,IAAK,CAChD,IAAIimB,EAAavQ,EAAK4Q,YAAYtmB,GAC9BuyB,GAAY,EAChB,IAAK,IAAI1lB,EAAI,EAAGA,EAAIhS,KAAKyrB,YAAY3nB,OAAQkO,IAC5C,GAAIhS,KAAKyrB,YAAYzZ,IAAMoZ,EAAY,CACtCsM,GAAY,EACZ,KACD,CAEIA,GAAW13B,KAAKyrB,YAAY1mB,KAAKqmB,EACvC,CAEA,IAAIc,EAAcrR,EAAK8c,iBACvB,IAAK,IAAIxyB,EAAI,EAAGA,EAAI+mB,EAAYpoB,OAAQqB,IAAK,CAC5C,IAAI4R,EAAamV,EAAY/mB,GACA,MAAzB4R,EAAWA,aACXA,EAAWA,sBAAsBK,GACpCL,EAAWA,WAAaA,EAAWA,WAAWkB,gBAC9CjY,KAAK2oB,cAAc5R,EAAW6U,UAAW7U,EAAW9S,KAAM8S,EAAWA,cAErEA,EAAWA,WAAaA,EAAWA,WAAWE,OAC9CjX,KAAK2oB,cAAc5R,EAAW6U,UAAW7U,EAAW9S,KAAM8S,EAAWA,aAEvE,CACD,CAGA,aAAAuN,CAAesH,EAAmB3nB,GACjC,IAAI4zB,EAAa73B,KAAKksB,YAAYN,GAClC,OAAOiM,EAAaA,EAAW5zB,GAAQ,IACxC,CAGA,gBAAA6zB,CAAkBlM,EAAmB3nB,GACpC,IAAI4zB,EAAa73B,KAAKksB,YAAYN,GAC9BiM,IAAYA,EAAW5zB,GAAQ,KACpC,CAGA,cAAA0zB,GACC,IAAII,EAAU,IAAI70B,MAClB,IAAK,IAAIiC,EAAI,EAAGA,EAAInF,KAAKksB,YAAYpoB,OAAQqB,IAAK,CACjD,IAAI6yB,EAAkBh4B,KAAKksB,YAAY/mB,GACvC,GAAI6yB,EACH,IAAK,IAAI/zB,KAAQ+zB,EAAiB,CACjC,IAAIjhB,EAAaihB,EAAgB/zB,GAC7B8S,GAAYghB,EAAQhzB,KAAK,IAAIwyB,GAAUpyB,EAAGlB,EAAM8S,GACrD,CAEF,CACA,OAAOghB,CACR,CAGA,qBAAAE,CAAuBrM,EAAmBM,GACzC,IAAI8L,EAAkBh4B,KAAKksB,YAAYN,GACvC,GAAIoM,EACH,IAAK,IAAI/zB,KAAQ+zB,EAAiB,CACjC,IAAIjhB,EAAaihB,EAAgB/zB,GAC7B8S,GAAYmV,EAAYnnB,KAAK,IAAIwyB,GAAU3L,EAAW3nB,EAAM8S,GACjE,CAEF,CAGA,KAAA7H,GACClP,KAAKksB,YAAYpoB,OAAS,EAC1B9D,KAAKqV,MAAMvR,OAAS,EACpB9D,KAAKyrB,YAAY3nB,OAAS,CAC3B,CAGA,SAAAmpB,CAAWlX,EAAoBmiB,GAC9B,IAAItM,EAAY,EAChB,IAAK,IAAIzmB,EAAI,EAAGA,EAAI4Q,EAASmU,MAAMpmB,OAAQqB,IAAK,CAC/C,IAAIuQ,EAAOK,EAASmU,MAAM/kB,GACtB+tB,EAAiBxd,EAAK4O,gBAC1B,GAAI4O,GAAkBtH,EAAYsM,EAAQhM,YAAYpoB,OAAQ,CAC7D,IAAI+zB,EAAaK,EAAQhM,YAAYN,GACrC,IAAK,IAAIxhB,KAAOytB,EAEf,GAAI3E,GAD4B2E,EAAWztB,GACL,CACrC,IAAI2M,EAAa/W,KAAKskB,cAAcsH,EAAWxhB,GAC7B,MAAd2M,GAAoBrB,EAAKiT,cAAc5R,GAC3C,KACD,CAEF,CACA6U,GACD,CACD,EC1KM,MAAMuM,GAGZtzB,MAGAZ,KAGAwmB,SAIAza,MAAQ,IAAIb,EAAM,EAAG,EAAG,EAAG,GAI3BoZ,UAGAQ,eAGA9c,UAEA,WAAAnM,CAAa+E,EAAeZ,EAAcwmB,GACzC,GAAI5lB,EAAQ,EAAG,MAAM,IAAIhE,MAAM,uBAC/B,GAAY,MAARoD,EAAc,MAAM,IAAIpD,MAAM,wBAClC,GAAgB,MAAZ4pB,EAAkB,MAAM,IAAI5pB,MAAM,4BACtCb,KAAK6E,MAAQA,EACb7E,KAAKiE,KAAOA,EACZjE,KAAKyqB,SAAWA,CACjB,EC/BM,MAAM2N,WAAgC/U,EAG5ChO,MAAQ,IAAInS,MAGZyc,OAGAmE,UAAY,EAGZC,aAAe,EAGfkF,SAAW,EAGXC,SAAW,EAGXvF,eAAiB,EAGjBvhB,QAAU,EAGVC,QAAU,EAGVynB,aAAe,EAGfC,aAAe,EAGfJ,aAAe,EAEfR,UAAW,EACX/J,OAAQ,EAER,WAAAtf,CAAamE,GACZ+I,MAAM/I,EAAM,GAAG,EAChB,EC3BM,MAAMo0B,GACZtsB,4BAA8B,CAAE,EAA6B,EAAiC,EAA0B,EAAgC,EAA0B,EAA2B,GAC7MA,2BAA6B,CAAC3K,EAAc8K,OAAQ9K,EAAc+b,gBAAiB/b,EAAcgc,uBAAwBhc,EAAcsc,QAAStc,EAAcuc,qBAC9J5R,0BAA4B,CAAE1K,EAAai3B,MAAOj3B,EAAamjB,SAC/DzY,yBAA2B,CAAEzK,EAAY0jB,OAAQ1jB,EAAYg3B,MAAOh3B,EAAYkjB,SAChFzY,wBAA0B,CAAExK,EAAWmjB,QAASnjB,EAAWgkB,MAAOhkB,EAAWqjB,YAC7E7Y,uBAAyB,CAAE5K,EAAU+K,OAAQ/K,EAAUiL,SAAUjL,EAAUmL,SAAUnL,EAAUoL,QAE/FR,mBAAqB,EACrBA,sBAAwB,EACxBA,kBAAoB,EACpBA,kBAAoB,EAEpBA,uBAAyB,EACzBA,kBAAoB,EACpBA,sBAAwB,EAExBA,qBAAuB,EACvBA,oBAAsB,EACtBA,gBAAkB,EAElBA,oBAAsB,EACtBA,qBAAuB,EACvBA,oBAAsB,EAMtB4Y,MAAQ,EAER4T,iBACQC,aAAe,IAAIt1B,MAE3B,WAAApD,CAAay4B,GACZv4B,KAAKu4B,iBAAmBA,CACzB,CAEA,gBAAAE,CAAkBC,GACjB,IAAI/T,EAAQ3kB,KAAK2kB,MAEbgU,EAAe,IAAIjC,GACvBiC,EAAa10B,KAAO,GAEpB,IAAI20B,EAAQ,IAAIC,GAAYH,GAI5B,GAFAC,EAAa9B,KAAO+B,EAAME,aAC1BH,EAAa/B,QAAUgC,EAAME,aACzB,UAAYH,EAAa/B,QAC3B,MAAM,IAAI/1B,MAAM,2EAClB83B,EAAan0B,EAAIo0B,EAAMG,YACvBJ,EAAaj0B,EAAIk0B,EAAMG,YACvBJ,EAAa12B,MAAQ22B,EAAMG,YAC3BJ,EAAaz2B,OAAS02B,EAAMG,YAE5B,IAAIC,EAAeJ,EAAMK,cACrBD,IACHL,EAAa7B,IAAM8B,EAAMG,YAEzBJ,EAAa5B,WAAa6B,EAAME,aAChCH,EAAanC,UAAYoC,EAAME,cAGhC,IAAIttB,EAAI,EAERA,EAAIotB,EAAMM,SAAQ,GAClB,IAAK,IAAI/zB,EAAI,EAAGA,EAAIqG,EAAGrG,IACtByzB,EAAMO,QAAQp0B,KAAK6zB,EAAME,cAG1BttB,EAAIotB,EAAMM,SAAQ,GAClB,IAAK,IAAI/zB,EAAI,EAAGA,EAAIqG,EAAGrG,IAAK,CAC3B,IAAIlB,EAAO20B,EAAME,aACb9vB,EAAc,GAAL7D,EAAS,KAAOwzB,EAAatjB,MAAMujB,EAAMM,SAAQ,IAC1DvyB,EAAO,IAAIwU,EAAShW,EAAGlB,EAAM+E,GACjCrC,EAAK4R,SAAWqgB,EAAMG,YACtBpyB,EAAKnC,EAAIo0B,EAAMG,YAAcpU,EAC7Bhe,EAAKjC,EAAIk0B,EAAMG,YAAcpU,EAC7Bhe,EAAKmS,OAAS8f,EAAMG,YACpBpyB,EAAKoS,OAAS6f,EAAMG,YACpBpyB,EAAKyU,OAASwd,EAAMG,YACpBpyB,EAAK0U,OAASud,EAAMG,YACpBpyB,EAAK7C,OAAS80B,EAAMG,YAAcpU,EAClChe,EAAK2U,cAAgB+c,GAAee,oBAAoBR,EAAMM,SAAQ,IACtEvyB,EAAK4U,aAAeqd,EAAMK,cACtBD,GAAc7pB,EAAMY,gBAAgBpJ,EAAKqJ,MAAO4oB,EAAMS,aAC1DV,EAAatjB,MAAMtQ,KAAK4B,EACzB,CAGA6E,EAAIotB,EAAMM,SAAQ,GAClB,IAAK,IAAI/zB,EAAI,EAAGA,EAAIqG,EAAGrG,IAAK,CAC3B,IAAIunB,EAAWkM,EAAME,aACjBrO,EAAWkO,EAAatjB,MAAMujB,EAAMM,SAAQ,IAC5CvyB,EAAO,IAAIwxB,GAAShzB,EAAGunB,EAAUjC,GACrCtb,EAAMY,gBAAgBpJ,EAAKqJ,MAAO4oB,EAAMS,aAExC,IAAI9Q,EAAYqQ,EAAMS,aACJ,GAAd9Q,GAAiBpZ,EAAMc,cAActJ,EAAK4hB,UAAY,IAAIpZ,EAASoZ,GAEvE5hB,EAAKoiB,eAAiB6P,EAAMU,gBAC5B3yB,EAAKsF,UAAYosB,GAAekB,gBAAgBX,EAAMM,SAAQ,IAC9DP,EAAazO,MAAMnlB,KAAK4B,EACzB,CAGA6E,EAAIotB,EAAMM,SAAQ,GAClB,IAAK,IAAWrL,EAAP1oB,EAAI,EAAOA,EAAIqG,EAAGrG,IAAK,CAC/B,IAAIwB,EAAO,IAAI8vB,GAAiBmC,EAAME,cACtCnyB,EAAK2c,MAAQsV,EAAMM,SAAQ,GAC3BvyB,EAAK4U,aAAeqd,EAAMK,cAC1BpL,EAAK+K,EAAMM,SAAQ,GACnB,IAAK,IAAIvR,EAAK,EAAGA,EAAKkG,EAAIlG,IACzBhhB,EAAK0O,MAAMtQ,KAAK4zB,EAAatjB,MAAMujB,EAAMM,SAAQ,KAClDvyB,EAAKgZ,OAASgZ,EAAatjB,MAAMujB,EAAMM,SAAQ,IAC/CvyB,EAAKoZ,IAAM6Y,EAAMG,YACjBpyB,EAAKqZ,SAAW4Y,EAAMG,YAAcpU,EACpChe,EAAKiZ,cAAgBgZ,EAAMY,WAC3B7yB,EAAKkZ,SAAW+Y,EAAMK,cACtBtyB,EAAKmZ,QAAU8Y,EAAMK,cACrBtyB,EAAKyZ,QAAUwY,EAAMK,cACrBN,EAAavO,cAAcrlB,KAAK4B,EACjC,CAGA6E,EAAIotB,EAAMM,SAAQ,GAClB,IAAK,IAAWrL,EAAP1oB,EAAI,EAAOA,EAAIqG,EAAGrG,IAAK,CAC/B,IAAIwB,EAAO,IAAIyxB,GAAwBQ,EAAME,cAC7CnyB,EAAK2c,MAAQsV,EAAMM,SAAQ,GAC3BvyB,EAAK4U,aAAeqd,EAAMK,cAC1BpL,EAAK+K,EAAMM,SAAQ,GACnB,IAAK,IAAIvR,EAAK,EAAGA,EAAKkG,EAAIlG,IACzBhhB,EAAK0O,MAAMtQ,KAAK4zB,EAAatjB,MAAMujB,EAAMM,SAAQ,KAClDvyB,EAAKgZ,OAASgZ,EAAatjB,MAAMujB,EAAMM,SAAQ,IAC/CvyB,EAAKyY,MAAQwZ,EAAMK,cACnBtyB,EAAKwiB,SAAWyP,EAAMK,cACtBtyB,EAAKgd,eAAiBiV,EAAMG,YAC5BpyB,EAAKvE,QAAUw2B,EAAMG,YAAcpU,EACnChe,EAAKtE,QAAUu2B,EAAMG,YAAcpU,EACnChe,EAAKmjB,aAAe8O,EAAMG,YAC1BpyB,EAAKojB,aAAe6O,EAAMG,YAC1BpyB,EAAKgjB,aAAeiP,EAAMG,YAC1BpyB,EAAKmd,UAAY8U,EAAMG,YACvBpyB,EAAKod,aAAe6U,EAAMG,YAC1BpyB,EAAKsiB,SAAW2P,EAAMG,YACtBpyB,EAAKuiB,SAAW0P,EAAMG,YACtBJ,EAAatO,qBAAqBtlB,KAAK4B,EACxC,CAGA6E,EAAIotB,EAAMM,SAAQ,GAClB,IAAK,IAAWrL,EAAP1oB,EAAI,EAAOA,EAAIqG,EAAGrG,IAAK,CAC/B,IAAIwB,EAAO,IAAI4c,EAAmBqV,EAAME,cACxCnyB,EAAK2c,MAAQsV,EAAMM,SAAQ,GAC3BvyB,EAAK4U,aAAeqd,EAAMK,cAC1BpL,EAAK+K,EAAMM,SAAQ,GACnB,IAAK,IAAIvR,EAAK,EAAGA,EAAKkG,EAAIlG,IACzBhhB,EAAK0O,MAAMtQ,KAAK4zB,EAAatjB,MAAMujB,EAAMM,SAAQ,KAClDvyB,EAAKgZ,OAASgZ,EAAazO,MAAM0O,EAAMM,SAAQ,IAC/CvyB,EAAK6c,aAAe6U,GAAeoB,mBAAmBb,EAAMM,SAAQ,IACpEvyB,EAAK8c,YAAc4U,GAAeqB,kBAAkBd,EAAMM,SAAQ,IAClEvyB,EAAK+c,WAAa2U,GAAesB,iBAAiBf,EAAMM,SAAQ,IAChEvyB,EAAKgd,eAAiBiV,EAAMG,YAC5BpyB,EAAKid,SAAWgV,EAAMG,YAClBpyB,EAAK6c,cAAgBniB,EAAai3B,QAAO3xB,EAAKid,UAAYe,GAC9Dhe,EAAKkd,QAAU+U,EAAMG,YACjBpyB,EAAK8c,aAAeniB,EAAY0jB,QAAUre,EAAK8c,aAAeniB,EAAYg3B,QAAO3xB,EAAKkd,SAAWc,GACrGhe,EAAKmd,UAAY8U,EAAMG,YACvBpyB,EAAKod,aAAe6U,EAAMG,YAC1BJ,EAAarO,gBAAgBvlB,KAAK4B,EACnC,CAGA,IAAIolB,EAAc/rB,KAAK45B,SAAShB,EAAOD,GAAc,EAAMK,GACxC,MAAfjN,IACH4M,EAAa5M,YAAcA,EAC3B4M,EAAa3M,MAAMjnB,KAAKgnB,IAIzB,CACC,IAAI5mB,EAAIwzB,EAAa3M,MAAMloB,OAE3B,IADA2N,EAAMQ,aAAa0mB,EAAa3M,MAAOxgB,EAAIrG,EAAIyzB,EAAMM,SAAQ,IACtD/zB,EAAIqG,EAAGrG,IACbwzB,EAAa3M,MAAM7mB,GAAKnF,KAAK45B,SAAShB,EAAOD,GAAc,EAAOK,EACpE,CAGAxtB,EAAIxL,KAAKw4B,aAAa10B,OACtB,IAAK,IAAIqB,EAAI,EAAGA,EAAIqG,EAAGrG,IAAK,CAC3B,IAAI00B,EAAa75B,KAAKw4B,aAAarzB,GAC/B0V,EAA0B,MAAnBgf,EAAWhf,KAAe8d,EAAa5M,YAAc4M,EAAa7L,SAAS+M,EAAWhf,MACjG,GAAY,MAARA,EAAc,MAAM,IAAIha,MAAM,mBAAqBg5B,EAAWhf,MAClE,IAAI7R,EAAS6R,EAAKyJ,cAAcuV,EAAWjO,UAAWiO,EAAW7wB,QACjE,GAAc,MAAVA,EAAgB,MAAM,IAAInI,MAAM,0BAA4Bg5B,EAAW7wB,QAC3E6wB,EAAWjM,KAAKpY,iBAAmBqkB,EAAWC,cAAgB9wB,EAA6B6wB,EAAWjM,KACtGiM,EAAWjM,KAAK5V,cAAchP,GAC9B6wB,EAAWjM,KAAKhW,WACjB,CACA5X,KAAKw4B,aAAa10B,OAAS,EAG3B0H,EAAIotB,EAAMM,SAAQ,GAClB,IAAK,IAAI/zB,EAAI,EAAGA,EAAIqG,EAAGrG,IAAK,CAC3B,IAAIwB,EAAO,IAAI4vB,GAAUqC,EAAMU,iBAC/B3yB,EAAKuvB,SAAW0C,EAAMM,SAAQ,GAC9BvyB,EAAKwvB,WAAayC,EAAMG,YACxBpyB,EAAKyvB,YAAcwC,EAAME,aACzBnyB,EAAK6vB,UAAYoC,EAAME,aACD,MAAlBnyB,EAAK6vB,YACR7vB,EAAK0vB,OAASuC,EAAMG,YACpBpyB,EAAK2vB,QAAUsC,EAAMG,aAEtBJ,EAAatK,OAAOtpB,KAAK4B,EAC1B,CAGA6E,EAAIotB,EAAMM,SAAQ,GAClB,IAAK,IAAI/zB,EAAI,EAAGA,EAAIqG,EAAGrG,IACtBwzB,EAAahC,WAAW5xB,KAAK/E,KAAK+5B,cAAcnB,EAAOA,EAAME,aAAcH,IAC5E,OAAOA,CACR,CAEQ,QAAAiB,CAAUhB,EAAoBD,EAA4B5M,EAAsBiN,GACvF,IAAIne,EAAO,KACPmf,EAAY,EAEhB,GAAIjO,EAAa,CAEhB,GADAiO,EAAYpB,EAAMM,SAAQ,GACT,GAAbc,EAAgB,OAAO,KAC3Bnf,EAAO,IAAI2c,GAAK,UACjB,KAAO,CACN3c,EAAO,IAAI2c,GAAKoB,EAAMU,iBACtBze,EAAKxF,MAAMvR,OAAS80B,EAAMM,SAAQ,GAClC,IAAK,IAAI/zB,EAAI,EAAGqG,EAAIqP,EAAKxF,MAAMvR,OAAQqB,EAAIqG,EAAGrG,IAC7C0V,EAAKxF,MAAMlQ,GAAKwzB,EAAatjB,MAAMujB,EAAMM,SAAQ,IAElD,IAAK,IAAI/zB,EAAI,EAAGqG,EAAIotB,EAAMM,SAAQ,GAAO/zB,EAAIqG,EAAGrG,IAC/C0V,EAAK4Q,YAAY1mB,KAAK4zB,EAAavO,cAAcwO,EAAMM,SAAQ,KAChE,IAAK,IAAI/zB,EAAI,EAAGqG,EAAIotB,EAAMM,SAAQ,GAAO/zB,EAAIqG,EAAGrG,IAC/C0V,EAAK4Q,YAAY1mB,KAAK4zB,EAAatO,qBAAqBuO,EAAMM,SAAQ,KACvE,IAAK,IAAI/zB,EAAI,EAAGqG,EAAIotB,EAAMM,SAAQ,GAAO/zB,EAAIqG,EAAGrG,IAC/C0V,EAAK4Q,YAAY1mB,KAAK4zB,EAAarO,gBAAgBsO,EAAMM,SAAQ,KAElEc,EAAYpB,EAAMM,SAAQ,EAC3B,CAEA,IAAK,IAAI/zB,EAAI,EAAGA,EAAI60B,EAAW70B,IAAK,CACnC,IAAIymB,EAAYgN,EAAMM,SAAQ,GAC9B,IAAK,IAAIvR,EAAK,EAAGkG,EAAK+K,EAAMM,SAAQ,GAAOvR,EAAKkG,EAAIlG,IAAM,CACzD,IAAI1jB,EAAO20B,EAAMU,gBACbviB,EAAa/W,KAAKi6B,eAAerB,EAAOD,EAAc9d,EAAM+Q,EAAW3nB,EAAM+0B,GAC/D,MAAdjiB,GAAoB8D,EAAK8N,cAAciD,EAAW3nB,EAAM8S,EAC7D,CACD,CACA,OAAO8D,CACR,CAEQ,cAAAof,CAAerB,EAAoBD,EAA4B9d,EAAY+Q,EAAmB7C,EAAwBiQ,GAC7H,IAAIrU,EAAQ3kB,KAAK2kB,MAEb1gB,EAAO20B,EAAMU,gBACL,MAARr1B,IAAcA,EAAO8kB,GAEzB,IAAImR,EAAYtB,EAAMY,WAEtB,OADWnB,GAAe8B,qBAAqBD,IAE/C,KAAKlE,GAAeoE,OAAQ,CAC3B,IAAIj0B,EAAOyyB,EAAMU,gBACb/gB,EAAWqgB,EAAMG,YACjBv0B,EAAIo0B,EAAMG,YACVr0B,EAAIk0B,EAAMG,YACVjgB,EAAS8f,EAAMG,YACfhgB,EAAS6f,EAAMG,YACf92B,EAAQ22B,EAAMG,YACd72B,EAAS02B,EAAMG,YACf/oB,EAAQ4oB,EAAMS,YAEN,MAARlzB,IAAcA,EAAOlC,GACzB,IAAIF,EAAS/D,KAAKu4B,iBAAiB3d,oBAAoBC,EAAM5W,EAAMkC,GACnE,OAAc,MAAVpC,EAAuB,MAC3BA,EAAOoC,KAAOA,EACdpC,EAAOS,EAAIA,EAAImgB,EACf5gB,EAAOW,EAAIA,EAAIigB,EACf5gB,EAAO+U,OAASA,EAChB/U,EAAOgV,OAASA,EAChBhV,EAAOwU,SAAWA,EAClBxU,EAAO9B,MAAQA,EAAQ0iB,EACvB5gB,EAAO7B,OAASA,EAASyiB,EACzBxV,EAAMY,gBAAgBhM,EAAOiM,MAAOA,GACpCjM,EAAOkV,eACAlV,EACR,CACA,KAAKiyB,GAAeqE,YAAa,CAChC,IAAIlH,EAAcyF,EAAMM,SAAQ,GAC5B5jB,EAAWtV,KAAKs6B,aAAa1B,EAAOzF,GACpCnjB,EAAQgpB,EAAeJ,EAAMS,YAAc,EAE3CkB,EAAMv6B,KAAKu4B,iBAAiBxd,yBAAyBF,EAAM5W,GAC/D,OAAW,MAAPs2B,EAAoB,MACxBA,EAAIhlB,oBAAsB4d,GAAe,EACzCoH,EAAIjlB,SAAWA,EAASA,SACxBilB,EAAIllB,MAAQC,EAASD,MACjB2jB,GAAc7pB,EAAMY,gBAAgBwqB,EAAIvqB,MAAOA,GAC5CuqB,EACR,CACA,KAAKvE,GAAewE,KAAM,CACzB,IAAIr0B,EAAOyyB,EAAMU,gBACbtpB,EAAQ4oB,EAAMS,YACdlG,EAAcyF,EAAMM,SAAQ,GAC5B5hB,EAAMtX,KAAKy6B,eAAe7B,EAAOzF,GAAe,EAAG,GACnD5b,EAAYvX,KAAK06B,eAAe9B,GAChCtjB,EAAWtV,KAAKs6B,aAAa1B,EAAOzF,GACpC3b,EAAaohB,EAAMM,SAAQ,GAC3BzhB,EAAQ,KACRxV,EAAQ,EAAGC,EAAS,EACpB82B,IACHvhB,EAAQzX,KAAK06B,eAAe9B,GAC5B32B,EAAQ22B,EAAMG,YACd72B,EAAS02B,EAAMG,aAGJ,MAAR5yB,IAAcA,EAAOlC,GACzB,IAAI2pB,EAAO5tB,KAAKu4B,iBAAiBzd,kBAAkBD,EAAM5W,EAAMkC,GAC/D,OAAY,MAARynB,EAAqB,MACzBA,EAAKznB,KAAOA,EACZgJ,EAAMY,gBAAgB6d,EAAK5d,MAAOA,GAClC4d,EAAKvY,MAAQC,EAASD,MACtBuY,EAAKtY,SAAWA,EAASA,SACzBsY,EAAKrY,oBAAsB4d,GAAe,EAC1CvF,EAAKrW,UAAYA,EACjBqW,EAAKvW,UAAYC,EACjBsW,EAAKhW,YACLgW,EAAKpW,WAAaA,GAAc,EAC5BwhB,IACHpL,EAAKnW,MAAQA,EACbmW,EAAK3rB,MAAQA,EAAQ0iB,EACrBiJ,EAAK1rB,OAASA,EAASyiB,GAEjBiJ,EACR,CACA,KAAKoI,GAAe2E,WAAY,CAC/B,IAAIx0B,EAAOyyB,EAAMU,gBACbtpB,EAAQ4oB,EAAMS,YACdxM,EAAW+L,EAAMU,gBACjBtwB,EAAS4vB,EAAMU,gBACfQ,EAAgBlB,EAAMK,cACtBh3B,EAAQ,EAAGC,EAAS,EACpB82B,IACH/2B,EAAQ22B,EAAMG,YACd72B,EAAS02B,EAAMG,aAGJ,MAAR5yB,IAAcA,EAAOlC,GACzB,IAAI2pB,EAAO5tB,KAAKu4B,iBAAiBzd,kBAAkBD,EAAM5W,EAAMkC,GAC/D,OAAY,MAARynB,EAAqB,MACzBA,EAAKznB,KAAOA,EACZgJ,EAAMY,gBAAgB6d,EAAK5d,MAAOA,GAC9BgpB,IACHpL,EAAK3rB,MAAQA,EAAQ0iB,EACrBiJ,EAAK1rB,OAASA,EAASyiB,GAExB3kB,KAAKw4B,aAAazzB,KAAK,IAAI41B,GAAW/M,EAAMf,EAAUjB,EAAW5iB,EAAQ8wB,IAClElM,EACR,CACA,KAAKoI,GAAe4E,KAAM,CACzB,IAAIxiB,EAASwgB,EAAMK,cACf5gB,EAAgBugB,EAAMK,cACtB9F,EAAcyF,EAAMM,SAAQ,GAC5B5jB,EAAWtV,KAAKs6B,aAAa1B,EAAOzF,GACpChb,EAAU1G,EAAMY,SAAS8gB,EAAc,EAAG,GAC9C,IAAK,IAAIhuB,EAAI,EAAGqG,EAAI2M,EAAQrU,OAAQqB,EAAIqG,EAAGrG,IAC1CgT,EAAQhT,GAAKyzB,EAAMG,YAAcpU,EAClC,IAAI3U,EAAQgpB,EAAeJ,EAAMS,YAAc,EAE3ClzB,EAAOnG,KAAKu4B,iBAAiBvd,kBAAkBH,EAAM5W,GACzD,OAAY,MAARkC,EAAqB,MACzBA,EAAKiS,OAASA,EACdjS,EAAKkS,cAAgBA,EACrBlS,EAAKoP,oBAAsB4d,GAAe,EAC1ChtB,EAAKmP,SAAWA,EAASA,SACzBnP,EAAKkP,MAAQC,EAASD,MACtBlP,EAAKgS,QAAUA,EACX6gB,GAAc7pB,EAAMY,gBAAgB5J,EAAK6J,MAAOA,GAC7C7J,EACR,CACA,KAAK6vB,GAAe6E,MAAO,CAC1B,IAAItiB,EAAWqgB,EAAMG,YACjBv0B,EAAIo0B,EAAMG,YACVr0B,EAAIk0B,EAAMG,YACV/oB,EAAQgpB,EAAeJ,EAAMS,YAAc,EAE3C5gB,EAAQzY,KAAKu4B,iBAAiBtd,mBAAmBJ,EAAM5W,GAC3D,OAAa,MAATwU,EAAsB,MAC1BA,EAAMjU,EAAIA,EAAImgB,EACdlM,EAAM/T,EAAIA,EAAIigB,EACdlM,EAAMF,SAAWA,EACbygB,GAAc7pB,EAAMY,gBAAgB0I,EAAMzI,MAAOA,GAC9CyI,EACR,CACA,KAAKud,GAAe8E,SAAU,CAC7B,IAAIC,EAAenC,EAAMM,SAAQ,GAC7B/F,EAAcyF,EAAMM,SAAQ,GAC5B5jB,EAAWtV,KAAKs6B,aAAa1B,EAAOzF,GACpCnjB,EAAQgpB,EAAeJ,EAAMS,YAAc,EAE3C2B,EAAOh7B,KAAKu4B,iBAAiBrd,sBAAsBL,EAAM5W,GAC7D,OAAY,MAAR+2B,EAAqB,MACzBA,EAAK7jB,QAAUwhB,EAAazO,MAAM6Q,GAClCC,EAAKzlB,oBAAsB4d,GAAe,EAC1C6H,EAAK1lB,SAAWA,EAASA,SACzB0lB,EAAK3lB,MAAQC,EAASD,MAClB2jB,GAAc7pB,EAAMY,gBAAgBirB,EAAKhrB,MAAOA,GAC7CgrB,EACR,EAEA,OAAO,IACR,CAEQ,YAAAV,CAAc1B,EAAoBzF,GACzC,IAAIxN,EAAiBwN,GAAe,EAChC7d,EAAW,IAAI2lB,GACftW,EAAQ3kB,KAAK2kB,MACjB,IAAKiU,EAAMK,cAEV,OADA3jB,EAASA,SAAWtV,KAAKy6B,eAAe7B,EAAOjT,EAAgBhB,GACxDrP,EAER,IAAI4lB,EAAU,IAAIh4B,MACdi4B,EAAa,IAAIj4B,MACrB,IAAK,IAAIiC,EAAI,EAAGA,EAAIguB,EAAahuB,IAAK,CACrC,IAAI0f,EAAY+T,EAAMM,SAAQ,GAC9BiC,EAAWp2B,KAAK8f,GAChB,IAAK,IAAI8C,EAAK,EAAGA,EAAK9C,EAAW8C,IAChCwT,EAAWp2B,KAAK6zB,EAAMM,SAAQ,IAC9BgC,EAAQn2B,KAAK6zB,EAAMG,YAAcpU,GACjCuW,EAAQn2B,KAAK6zB,EAAMG,YAAcpU,GACjCuW,EAAQn2B,KAAK6zB,EAAMG,YAErB,CAGA,OAFAzjB,EAASA,SAAW7D,EAAMmB,aAAasoB,GACvC5lB,EAASD,MAAQ8lB,EACV7lB,CACR,CAEQ,cAAAmlB,CAAgB7B,EAAoBptB,EAAWmZ,GACtD,IAAI9V,EAAQ,IAAI3L,MAAcsI,GAC9B,GAAa,GAATmZ,EACH,IAAK,IAAIxf,EAAI,EAAGA,EAAIqG,EAAGrG,IACtB0J,EAAM1J,GAAKyzB,EAAMG,iBAElB,IAAK,IAAI5zB,EAAI,EAAGA,EAAIqG,EAAGrG,IACtB0J,EAAM1J,GAAKyzB,EAAMG,YAAcpU,EAEjC,OAAO9V,CACR,CAEQ,cAAA6rB,CAAgB9B,GACvB,IAAIptB,EAAIotB,EAAMM,SAAQ,GAClBrqB,EAAQ,IAAI3L,MAAcsI,GAC9B,IAAK,IAAIrG,EAAI,EAAGA,EAAIqG,EAAGrG,IACtB0J,EAAM1J,GAAKyzB,EAAMwC,YAClB,OAAOvsB,CACR,CAEQ,aAAAkrB,CAAenB,EAAoB30B,EAAc00B,GACxD,IAAI5K,EAAY,IAAI7qB,MAChByhB,EAAQ3kB,KAAK2kB,MACbsJ,EAAW,EACXoN,EAAa,IAAIlsB,EACjBmsB,EAAa,IAAInsB,EAGrB,IAAK,IAAIhK,EAAI,EAAGqG,EAAIotB,EAAMM,SAAQ,GAAO/zB,EAAIqG,EAAGrG,IAAK,CACpD,IAAIymB,EAAYgN,EAAMM,SAAQ,GAC9B,IAAK,IAAIvR,EAAK,EAAGkG,EAAK+K,EAAMM,SAAQ,GAAOvR,EAAKkG,EAAIlG,IAAM,CACzD,IAAI4T,EAAe3C,EAAMY,WACrBzkB,EAAa6jB,EAAMM,SAAQ,GAC/B,OAAQqC,GACR,KAAKlD,GAAemD,gBAAiB,CACpC,IAAIC,EAAW,IAAI7I,GAAmB7d,GACtC0mB,EAAS7P,UAAYA,EACrB,IAAK,IAAIsD,EAAa,EAAGA,EAAana,EAAYma,IACjDuM,EAAS1L,SAASb,EAAY0J,EAAMG,YAAaH,EAAMU,iBACxDvL,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,OAAO/a,EAAa,IAC3D,KACD,CACA,KAAKsjB,GAAeqD,WAAY,CAC/B,IAAID,EAAW,IAAIrK,GAAcrc,GACjC0mB,EAAS7P,UAAYA,EACrB,IAAK,IAAIsD,EAAa,EAAGA,EAAana,EAAYma,IAAc,CAC/D,IAAItG,EAAOgQ,EAAMG,YACjB5pB,EAAMY,gBAAgBsrB,EAAYzC,EAAMS,aACxCoC,EAAS1L,SAASb,EAAYtG,EAAMyS,EAAWjsB,EAAGisB,EAAWhsB,EAAGgsB,EAAW/rB,EAAG+rB,EAAW9rB,GACrF2f,EAAana,EAAa,GAAG/U,KAAK27B,UAAU/C,EAAO1J,EAAYuM,EACpE,CACA1N,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,QAAQ/a,EAAa,GAAKqc,GAAcjB,UAC/E,KACD,CACA,KAAKkI,GAAeuD,eAAgB,CACnC,IAAIH,EAAW,IAAI5J,GAAiB9c,GACpC0mB,EAAS7P,UAAYA,EACrB,IAAK,IAAIsD,EAAa,EAAGA,EAAana,EAAYma,IAAc,CAC/D,IAAItG,EAAOgQ,EAAMG,YACjB5pB,EAAMY,gBAAgBsrB,EAAYzC,EAAMS,aACxClqB,EAAMc,cAAcqrB,EAAY1C,EAAMS,aACtCoC,EAAS1L,SAASb,EAAYtG,EAAMyS,EAAWjsB,EAAGisB,EAAWhsB,EAAGgsB,EAAW/rB,EAAG+rB,EAAW9rB,EAAG+rB,EAAWlsB,EACtGksB,EAAWjsB,EAAGisB,EAAWhsB,GACtB4f,EAAana,EAAa,GAAG/U,KAAK27B,UAAU/C,EAAO1J,EAAYuM,EACpE,CACA1N,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,QAAQ/a,EAAa,GAAK8c,GAAiB1B,UAClF,KACD,EAED,CACD,CAGA,IAAK,IAAIhrB,EAAI,EAAGqG,EAAIotB,EAAMM,SAAQ,GAAO/zB,EAAIqG,EAAGrG,IAAK,CACpD,IAAIinB,EAAYwM,EAAMM,SAAQ,GAC9B,IAAK,IAAIvR,EAAK,EAAGkG,EAAK+K,EAAMM,SAAQ,GAAOvR,EAAKkG,EAAIlG,IAAM,CACzD,IAAI4T,EAAe3C,EAAMY,WACrBzkB,EAAa6jB,EAAMM,SAAQ,GAC/B,OAAQqC,GACR,KAAKlD,GAAewD,YAAa,CAChC,IAAIJ,EAAW,IAAI5L,EAAe9a,GAClC0mB,EAASrP,UAAYA,EACrB,IAAK,IAAI8C,EAAa,EAAGA,EAAana,EAAYma,IACjDuM,EAAS1L,SAASb,EAAY0J,EAAMG,YAAaH,EAAMG,aACnD7J,EAAana,EAAa,GAAG/U,KAAK27B,UAAU/C,EAAO1J,EAAYuM,GAEpE1N,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,QAAQ/a,EAAa,GAAK8a,EAAeM,UAChF,KACD,CACA,KAAKkI,GAAeyD,eACpB,KAAKzD,GAAe0D,WACpB,KAAK1D,GAAe2D,WAAY,CAC/B,IAAIP,EACAQ,EAAgB,EAChBV,GAAgBlD,GAAe0D,WAClCN,EAAW,IAAI1K,GAAchc,GACrBwmB,GAAgBlD,GAAe2D,WACvCP,EAAW,IAAIvK,GAAcnc,IAE7B0mB,EAAW,IAAIhL,EAAkB1b,GACjCknB,EAAgBtX,GAEjB8W,EAASrP,UAAYA,EACrB,IAAK,IAAI8C,EAAa,EAAGA,EAAana,EAAYma,IACjDuM,EAAS1L,SAASb,EAAY0J,EAAMG,YAAaH,EAAMG,YAAckD,EACpErD,EAAMG,YAAckD,GACjB/M,EAAana,EAAa,GAAG/U,KAAK27B,UAAU/C,EAAO1J,EAAYuM,GAEpE1N,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,QAAQ/a,EAAa,GAAK0b,EAAkBN,UACnF,KACD,EAED,CACD,CAGA,IAAK,IAAIhrB,EAAI,EAAGqG,EAAIotB,EAAMM,SAAQ,GAAO/zB,EAAIqG,EAAGrG,IAAK,CACpD,IAAIN,EAAQ+zB,EAAMM,SAAQ,GACtBnkB,EAAa6jB,EAAMM,SAAQ,GAC3BuC,EAAW,IAAI1H,GAAqBhf,GACxC0mB,EAASzH,kBAAoBnvB,EAC7B,IAAK,IAAIqqB,EAAa,EAAGA,EAAana,EAAYma,IACjDuM,EAAS1L,SAASb,EAAY0J,EAAMG,YAAaH,EAAMG,YAAaH,EAAMG,YAAcpU,EAAOiU,EAAMY,WAAYZ,EAAMK,cACtHL,EAAMK,eACH/J,EAAana,EAAa,GAAG/U,KAAK27B,UAAU/C,EAAO1J,EAAYuM,GAEpE1N,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,QAAQ/a,EAAa,GAAKgf,GAAqB5D,SACvF,CAGA,IAAK,IAAIhrB,EAAI,EAAGqG,EAAIotB,EAAMM,SAAQ,GAAO/zB,EAAIqG,EAAGrG,IAAK,CACpD,IAAIN,EAAQ+zB,EAAMM,SAAQ,GACtBnkB,EAAa6jB,EAAMM,SAAQ,GAC3BuC,EAAW,IAAI7G,GAA4B7f,GAC/C0mB,EAAS5G,yBAA2BhwB,EACpC,IAAK,IAAIqqB,EAAa,EAAGA,EAAana,EAAYma,IACjDuM,EAAS1L,SAASb,EAAY0J,EAAMG,YAAaH,EAAMG,YAAaH,EAAMG,YAAaH,EAAMG,YAC5FH,EAAMG,aACH7J,EAAana,EAAa,GAAG/U,KAAK27B,UAAU/C,EAAO1J,EAAYuM,GAEpE1N,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,QAAQ/a,EAAa,GAAK6f,GAA4BzE,SAC9F,CAGA,IAAK,IAAIhrB,EAAI,EAAGqG,EAAIotB,EAAMM,SAAQ,GAAO/zB,EAAIqG,EAAGrG,IAAK,CACpD,IAAIN,EAAQ+zB,EAAMM,SAAQ,GACtBvyB,EAAOgyB,EAAarO,gBAAgBzlB,GACxC,IAAK,IAAI8iB,EAAK,EAAGkG,EAAK+K,EAAMM,SAAQ,GAAOvR,EAAKkG,EAAIlG,IAAM,CACzD,IAAI4T,EAAe3C,EAAMY,WACrBzkB,EAAa6jB,EAAMM,SAAQ,GAC/B,OAAQqC,GACR,KAAKlD,GAAe6D,cACpB,KAAK7D,GAAe8D,aAAc,CACjC,IAAIV,EACAQ,EAAgB,EAChBV,GAAgBlD,GAAe8D,cAClCV,EAAW,IAAI7F,GAA8B7gB,GACzCpO,EAAK8c,aAAeniB,EAAY0jB,QAAUre,EAAK8c,aAAeniB,EAAYg3B,QAAO2D,EAAgBtX,KAErG8W,EAAW,IAAIlG,GAA+BxgB,GAC1CpO,EAAK6c,cAAgBniB,EAAai3B,QAAO2D,EAAgBtX,IAE9D8W,EAASjG,oBAAsB3wB,EAC/B,IAAK,IAAIqqB,EAAa,EAAGA,EAAana,EAAYma,IACjDuM,EAAS1L,SAASb,EAAY0J,EAAMG,YAAaH,EAAMG,YAAckD,GACjE/M,EAAana,EAAa,GAAG/U,KAAK27B,UAAU/C,EAAO1J,EAAYuM,GAEpE1N,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,QAAQ/a,EAAa,GAAKwgB,GAA+BpF,UAChG,KACD,CACA,KAAKkI,GAAe+D,SAAU,CAC7B,IAAIX,EAAW,IAAI3F,GAA0B/gB,GAC7C0mB,EAASjG,oBAAsB3wB,EAC/B,IAAK,IAAIqqB,EAAa,EAAGA,EAAana,EAAYma,IACjDuM,EAAS1L,SAASb,EAAY0J,EAAMG,YAAaH,EAAMG,YAAaH,EAAMG,aACtE7J,EAAana,EAAa,GAAG/U,KAAK27B,UAAU/C,EAAO1J,EAAYuM,GAEpE1N,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,QAAQ/a,EAAa,GAAK+gB,GAA0B3F,UAC3F,KACD,EAED,CACD,CAGA,IAAK,IAAIhrB,EAAI,EAAGqG,EAAIotB,EAAMM,SAAQ,GAAO/zB,EAAIqG,EAAGrG,IAAK,CACpD,IAAI0V,EAAO8d,EAAa3M,MAAM4M,EAAMM,SAAQ,IAC5C,IAAK,IAAIvR,EAAK,EAAGkG,EAAK+K,EAAMM,SAAQ,GAAOvR,EAAKkG,EAAIlG,IAAM,CACzD,IAAIiE,EAAYgN,EAAMM,SAAQ,GAC9B,IAAK,IAAImD,EAAM,EAAGC,EAAM1D,EAAMM,SAAQ,GAAOmD,EAAMC,EAAKD,IAAO,CAC9D,IAAItlB,EAAa8D,EAAKyJ,cAAcsH,EAAWgN,EAAMU,iBACjDiD,EAA+B,MAApBxlB,EAAW1B,MACtBC,EAAWyB,EAAWzB,SACtBknB,EAAeD,EAAWjnB,EAASxR,OAAS,EAAI,EAAIwR,EAASxR,OAE7DiR,EAAa6jB,EAAMM,SAAQ,GAC3BuC,EAAW,IAAI1I,GAAehe,GAClC0mB,EAAS7P,UAAYA,EACrB6P,EAAS1kB,WAAaA,EAEtB,IAAK,IAAImY,EAAa,EAAGA,EAAana,EAAYma,IAAc,CAC/D,IACIhZ,EADA0S,EAAOgQ,EAAMG,YAEb0D,EAAM7D,EAAMM,SAAQ,GACxB,GAAW,GAAPuD,EACHvmB,EAASqmB,EAAW9qB,EAAMc,cAAciqB,GAAgBlnB,MACpD,CACJY,EAASzE,EAAMc,cAAciqB,GAC7B,IAAI7mB,EAAQijB,EAAMM,SAAQ,GAE1B,GADAuD,GAAO9mB,EACM,GAATgP,EACH,IAAK,IAAI7iB,EAAI6T,EAAO7T,EAAI26B,EAAK36B,IAC5BoU,EAAOpU,GAAK82B,EAAMG,iBAEnB,IAAK,IAAIj3B,EAAI6T,EAAO7T,EAAI26B,EAAK36B,IAC5BoU,EAAOpU,GAAK82B,EAAMG,YAAcpU,EAElC,IAAK4X,EACJ,IAAK,IAAIz6B,EAAI,EAAG46B,EAAKxmB,EAAOpS,OAAQhC,EAAI46B,EAAI56B,IAC3CoU,EAAOpU,IAAMwT,EAASxT,EAEzB,CAEA25B,EAAS1L,SAASb,EAAYtG,EAAM1S,GAChCgZ,EAAana,EAAa,GAAG/U,KAAK27B,UAAU/C,EAAO1J,EAAYuM,EACpE,CACA1N,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,OAAO/a,EAAa,GAC5D,CACD,CACD,CAGA,IAAI4nB,EAAiB/D,EAAMM,SAAQ,GACnC,GAAIyD,EAAiB,EAAG,CACvB,IAAIlB,EAAW,IAAI7H,GAAkB+I,GACjC3C,EAAYrB,EAAazO,MAAMpmB,OACnC,IAAK,IAAIqB,EAAI,EAAGA,EAAIw3B,EAAgBx3B,IAAK,CACxC,IAAIyjB,EAAOgQ,EAAMG,YACb6D,EAAchE,EAAMM,SAAQ,GAC5B/O,EAAY1Y,EAAMY,SAAS2nB,EAAW,GAC1C,IAAK,IAAIrS,EAAKqS,EAAY,EAAGrS,GAAM,EAAGA,IACrCwC,EAAUxC,IAAO,EAClB,IAAIkV,EAAYprB,EAAMY,SAAS2nB,EAAY4C,EAAa,GACpDE,EAAgB,EAAGC,EAAiB,EACxC,IAAK,IAAIpV,EAAK,EAAGA,EAAKiV,EAAajV,IAAM,CACxC,IAAIiE,EAAYgN,EAAMM,SAAQ,GAE9B,KAAO4D,GAAiBlR,GACvBiR,EAAUE,KAAoBD,IAE/B3S,EAAU2S,EAAgBlE,EAAMM,SAAQ,IAAS4D,GAClD,CAEA,KAAOA,EAAgB9C,GACtB6C,EAAUE,KAAoBD,IAE/B,IAAK,IAAInV,EAAKqS,EAAY,EAAGrS,GAAM,EAAGA,KACf,GAAlBwC,EAAUxC,KAAWwC,EAAUxC,GAAMkV,IAAYE,IACtDtB,EAAS1L,SAAS5qB,EAAGyjB,EAAMuB,EAC5B,CACA4D,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,OAAO6M,EAAiB,GAChE,CAGA,IAAIK,EAAapE,EAAMM,SAAQ,GAC/B,GAAI8D,EAAa,EAAG,CACnB,IAAIvB,EAAW,IAAIhI,GAAcuJ,GACjC,IAAK,IAAI73B,EAAI,EAAGA,EAAI63B,EAAY73B,IAAK,CACpC,IAAIyjB,EAAOgQ,EAAMG,YACbkE,EAAYtE,EAAatK,OAAOuK,EAAMM,SAAQ,IAC9CxF,EAAQ,IAAIuC,GAAMrN,EAAMqU,GAC5BvJ,EAAMwC,SAAW0C,EAAMM,SAAQ,GAC/BxF,EAAMyC,WAAayC,EAAMG,YACzBrF,EAAM0C,YAAcwC,EAAMK,cAAgBL,EAAME,aAAemE,EAAU7G,YAC7C,MAAxB1C,EAAM/sB,KAAK6vB,YACd9C,EAAM2C,OAASuC,EAAMG,YACrBrF,EAAM4C,QAAUsC,EAAMG,aAEvB0C,EAAS1L,SAAS5qB,EAAGuuB,EACtB,CACA3F,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,OAAOkN,EAAa,GAC5D,CAEA,OAAO,IAAIlP,EAAU7pB,EAAM8pB,EAAWE,EACvC,CAEQ,SAAA0N,CAAW/C,EAAoB1J,EAAoBuM,GAC1D,OAAQ7C,EAAMY,YACd,KAAKnB,GAAe6E,cACnBzB,EAAStM,WAAWD,GACpB,MACD,KAAKmJ,GAAe8E,aACnBn9B,KAAKwvB,SAASiM,EAAUvM,EAAY0J,EAAMG,YAAaH,EAAMG,YAAaH,EAAMG,YAAaH,EAAMG,aAGrG,CAEA,QAAAvJ,CAAUiM,EAAyBvM,EAAoBvI,EAAaC,EAAaC,EAAaC,GAC7F2U,EAASjM,SAASN,EAAYvI,EAAKC,EAAKC,EAAKC,EAC9C,EAGD,MAAM+R,GACgCM,QAAuCt0B,MAA2Bu4B,OAAvG,WAAAt9B,CAAY6G,EAAyBwyB,EAAU,IAAIj2B,MAAyB2B,EAAgB,EAAWu4B,EAAS,IAAIC,SAAS12B,EAAKy2B,SAA7F,KAAAjE,QAAAA,EAAuC,KAAAt0B,MAAAA,EAA2B,KAAAu4B,OAAAA,CAEvG,CAEA,QAAA5D,GACC,OAAOx5B,KAAKo9B,OAAOE,QAAQt9B,KAAK6E,QACjC,CAEA,SAAAu2B,GACC,IAAIrsB,EAAQ/O,KAAKo9B,OAAOG,SAASv9B,KAAK6E,OAEtC,OADA7E,KAAK6E,OAAS,EACPkK,CACR,CAEA,SAAAsqB,GACE,IAAItqB,EAAQ/O,KAAKo9B,OAAOI,SAASx9B,KAAK6E,OAEtC,OADA7E,KAAK6E,OAAS,EACPkK,CACT,CAEA,OAAAmqB,CAAQuE,GACP,IAAInuB,EAAItP,KAAKw5B,WACTkE,EAAa,IAAJpuB,EAiBb,OAhBS,IAAJA,IACJA,EAAItP,KAAKw5B,WACTkE,IAAe,IAAJpuB,IAAa,EACf,IAAJA,IACJA,EAAItP,KAAKw5B,WACTkE,IAAe,IAAJpuB,IAAa,GACf,IAAJA,IACJA,EAAItP,KAAKw5B,WACTkE,IAAe,IAAJpuB,IAAa,GACf,IAAJA,IACJA,EAAItP,KAAKw5B,WACTkE,IAAe,IAAJpuB,IAAa,OAKrBmuB,EAAmBC,EAAWA,IAAW,IAAgB,EAATA,EACxD,CAEA,aAAApE,GACC,IAAIz0B,EAAQ7E,KAAKk5B,SAAQ,GACzB,OAAgB,GAATr0B,EAAa,KAAO7E,KAAKm5B,QAAQt0B,EAAQ,EACjD,CAEA,UAAAi0B,GACC,IAAI6E,EAAY39B,KAAKk5B,SAAQ,GAC7B,OAAQyE,GACR,KAAK,EACJ,OAAO,KACR,KAAK,EACJ,MAAO,GAERA,IACA,IAAIC,EAAQ,GAEZ,IAAK,IAAIz4B,EAAI,EAAGA,EAAIw4B,GAAY,CAC/B,IAAIruB,EAAItP,KAAKw5B,WACb,OAAQlqB,GAAK,GACb,KAAK,GACL,KAAK,GACJsuB,GAASC,OAAOC,cAAmB,GAAJxuB,IAAa,EAAsB,GAAlBtP,KAAKw5B,YACrDr0B,GAAK,EACL,MACD,KAAK,GACJy4B,GAASC,OAAOC,cAAmB,GAAJxuB,IAAa,IAAwB,GAAlBtP,KAAKw5B,aAAsB,EAAsB,GAAlBx5B,KAAKw5B,YACtFr0B,GAAK,EACL,MACD,QACCy4B,GAASC,OAAOC,aAAaxuB,GAC7BnK,IAEF,CACA,OAAOy4B,CACR,CAEA,SAAA7E,GACC,IAAIhqB,EAAQ/O,KAAKo9B,OAAOW,WAAW/9B,KAAK6E,OAExC,OADA7E,KAAK6E,OAAS,EACPkK,CACR,CAEA,WAAAkqB,GACC,OAA0B,GAAnBj5B,KAAKw5B,UACb,EAGD,MAAMmB,GACL3xB,OAAgB6R,KAChB+Q,UACAgC,KACAkM,cAEA,WAAAh6B,CAAa8tB,EAAsB/S,EAAc+Q,EAAmB5iB,EAAgB8wB,GACnF95B,KAAK4tB,KAAOA,EACZ5tB,KAAK6a,KAAOA,EACZ7a,KAAK4rB,UAAYA,EACjB5rB,KAAKgJ,OAASA,EACdhJ,KAAK85B,cAAgBA,CACtB,EAGD,MAAMmB,GACc5lB,MAAoCC,SAAvD,WAAAxV,CAAmBuV,EAAuB,KAAaC,EAAyC,MAA7E,KAAAD,MAAAA,EAAoC,KAAAC,SAAAA,CAAiD,ECh2BlG,MAAM0oB,GACZzF,iBAMA5T,MAAQ,EACA6T,aAAe,IAAIt1B,MAE3B,WAAApD,CAAay4B,GACZv4B,KAAKu4B,iBAAmBA,CACzB,CAEA,gBAAAE,CAAkBwF,GACjB,IAAItZ,EAAQ3kB,KAAK2kB,MACbgU,EAAe,IAAIjC,GACnBwH,EAAwB,iBAAX,EAAsBC,KAAKC,MAAMH,GAAQA,EAGtDI,EAAcH,EAAKnoB,SACvB,GAAmB,MAAfsoB,EAAqB,CAGxB,GAFA1F,EAAa9B,KAAOwH,EAAYxH,KAChC8B,EAAa/B,QAAUyH,EAAYC,MAC/B,UAAY3F,EAAa/B,QAC5B,MAAM,IAAI/1B,MAAM,2EACjB83B,EAAan0B,EAAI65B,EAAY75B,EAC7Bm0B,EAAaj0B,EAAI25B,EAAY35B,EAC7Bi0B,EAAa12B,MAAQo8B,EAAYp8B,MACjC02B,EAAaz2B,OAASm8B,EAAYn8B,OAClCy2B,EAAa7B,IAAMuH,EAAYvH,IAC/B6B,EAAa5B,WAAasH,EAAYE,MACvC,CAGA,GAAIL,EAAK7oB,MACR,IAAK,IAAIlQ,EAAI,EAAGA,EAAI+4B,EAAK7oB,MAAMvR,OAAQqB,IAAK,CAC3C,IAAIq5B,EAAUN,EAAK7oB,MAAMlQ,GAErB6D,EAAmB,KACnBy1B,EAAqBz+B,KAAK0+B,SAASF,EAAS,SAAU,MAC1D,GAAkB,MAAdC,IACHz1B,EAAS2vB,EAAa1Y,SAASwe,GACjB,MAAVz1B,GAAgB,MAAM,IAAInI,MAAM,0BAA4B49B,GAEjE,IAAI93B,EAAO,IAAIwU,EAASwd,EAAatjB,MAAMvR,OAAQ06B,EAAQv6B,KAAM+E,GACjErC,EAAK7C,OAAS9D,KAAK0+B,SAASF,EAAS,SAAU,GAAK7Z,EACpDhe,EAAKnC,EAAIxE,KAAK0+B,SAASF,EAAS,IAAK,GAAK7Z,EAC1Che,EAAKjC,EAAI1E,KAAK0+B,SAASF,EAAS,IAAK,GAAK7Z,EAC1Che,EAAK4R,SAAWvY,KAAK0+B,SAASF,EAAS,WAAY,GACnD73B,EAAKmS,OAAS9Y,KAAK0+B,SAASF,EAAS,SAAU,GAC/C73B,EAAKoS,OAAS/Y,KAAK0+B,SAASF,EAAS,SAAU,GAC/C73B,EAAKyU,OAASpb,KAAK0+B,SAASF,EAAS,SAAU,GAC/C73B,EAAK0U,OAASrb,KAAK0+B,SAASF,EAAS,SAAU,GAC/C73B,EAAK2U,cAAgB0iB,GAAaW,wBAAwB3+B,KAAK0+B,SAASF,EAAS,YAAa,WAC9F73B,EAAK4U,aAAevb,KAAK0+B,SAASF,EAAS,QAAQ,GAEnD7F,EAAatjB,MAAMtQ,KAAK4B,EACzB,CAID,GAAIu3B,EAAKhU,MACR,IAAK,IAAI/kB,EAAI,EAAGA,EAAI+4B,EAAKhU,MAAMpmB,OAAQqB,IAAK,CAC3C,IAAIy5B,EAAUV,EAAKhU,MAAM/kB,GACrBunB,EAAmBkS,EAAQ36B,KAC3BuoB,EAAmBoS,EAAQ5oB,KAC3ByU,EAAWkO,EAAa1Y,SAASuM,GACrC,GAAgB,MAAZ/B,EAAkB,MAAM,IAAI5pB,MAAM,wBAA0B2rB,GAChE,IAAI7lB,EAAO,IAAIwxB,GAASQ,EAAazO,MAAMpmB,OAAQ4oB,EAAUjC,GAEzDza,EAAgBhQ,KAAK0+B,SAASE,EAAS,QAAS,MACvC,MAAT5uB,GAAerJ,EAAKqJ,MAAMJ,cAAcI,GAE5C,IAAIsiB,EAAetyB,KAAK0+B,SAASE,EAAS,OAAQ,MACtC,MAARtM,IACH3rB,EAAK4hB,UAAY,IAAIpZ,EAAM,EAAG,EAAG,EAAG,GACpCxI,EAAK4hB,UAAU3Y,cAAc0iB,IAG9B3rB,EAAKoiB,eAAiB/oB,KAAK0+B,SAASE,EAAS,aAAc,MAC3Dj4B,EAAKsF,UAAY+xB,GAAaa,oBAAoB7+B,KAAK0+B,SAASE,EAAS,QAAS,WAClFjG,EAAazO,MAAMnlB,KAAK4B,EACzB,CAID,GAAIu3B,EAAKY,GACR,IAAK,IAAI35B,EAAI,EAAGA,EAAI+4B,EAAKY,GAAGh7B,OAAQqB,IAAK,CACxC,IAAI45B,EAAgBb,EAAKY,GAAG35B,GACxBwB,EAAO,IAAI8vB,GAAiBsI,EAAc96B,MAC9C0C,EAAK2c,MAAQtjB,KAAK0+B,SAASK,EAAe,QAAS,GACnDp4B,EAAK4U,aAAevb,KAAK0+B,SAASK,EAAe,QAAQ,GAEzD,IAAK,IAAI/sB,EAAI,EAAGA,EAAI+sB,EAAc1pB,MAAMvR,OAAQkO,IAAK,CACpD,IAAIwa,EAAWuS,EAAc1pB,MAAMrD,GAC/BgE,EAAO2iB,EAAa1Y,SAASuM,GACjC,GAAY,MAARxW,EAAc,MAAM,IAAInV,MAAM,sBAAwB2rB,GAC1D7lB,EAAK0O,MAAMtQ,KAAKiR,EACjB,CAEA,IAAIgpB,EAAqBD,EAAcpf,OAEvC,GADAhZ,EAAKgZ,OAASgZ,EAAa1Y,SAAS+e,GACjB,MAAfr4B,EAAKgZ,OAAgB,MAAM,IAAI9e,MAAM,6BAA+Bm+B,GAExEr4B,EAAKoZ,IAAM/f,KAAK0+B,SAASK,EAAe,MAAO,GAC/Cp4B,EAAKqZ,SAAWhgB,KAAK0+B,SAASK,EAAe,WAAY,GAAKpa,EAC9Dhe,EAAKiZ,cAAgB5f,KAAK0+B,SAASK,EAAe,gBAAgB,GAAQ,GAAK,EAC/Ep4B,EAAKkZ,SAAW7f,KAAK0+B,SAASK,EAAe,YAAY,GACzDp4B,EAAKmZ,QAAU9f,KAAK0+B,SAASK,EAAe,WAAW,GACvDp4B,EAAKyZ,QAAUpgB,KAAK0+B,SAASK,EAAe,WAAW,GAEvDpG,EAAavO,cAAcrlB,KAAK4B,EACjC,CAID,GAAIu3B,EAAKe,UACR,IAAK,IAAI95B,EAAI,EAAGA,EAAI+4B,EAAKe,UAAUn7B,OAAQqB,IAAK,CAC/C,IAAI45B,EAAgBb,EAAKe,UAAU95B,GAC/BwB,EAAO,IAAIyxB,GAAwB2G,EAAc96B,MACrD0C,EAAK2c,MAAQtjB,KAAK0+B,SAASK,EAAe,QAAS,GACnDp4B,EAAK4U,aAAevb,KAAK0+B,SAASK,EAAe,QAAQ,GAEzD,IAAK,IAAI/sB,EAAI,EAAGA,EAAI+sB,EAAc1pB,MAAMvR,OAAQkO,IAAK,CACpD,IAAIwa,EAAWuS,EAAc1pB,MAAMrD,GAC/BgE,EAAO2iB,EAAa1Y,SAASuM,GACjC,GAAY,MAARxW,EAAc,MAAM,IAAInV,MAAM,wCAA0C2rB,GAC5E7lB,EAAK0O,MAAMtQ,KAAKiR,EACjB,CAEA,IAAIgpB,EAAqBD,EAAcpf,OAEvC,GADAhZ,EAAKgZ,OAASgZ,EAAa1Y,SAAS+e,GACjB,MAAfr4B,EAAKgZ,OAAgB,MAAM,IAAI9e,MAAM,+CAAiDm+B,GAE1Fr4B,EAAKyY,MAAQpf,KAAK0+B,SAASK,EAAe,SAAS,GACnDp4B,EAAKwiB,SAAWnpB,KAAK0+B,SAASK,EAAe,YAAY,GACzDp4B,EAAKgd,eAAiB3jB,KAAK0+B,SAASK,EAAe,WAAY,GAC/Dp4B,EAAKvE,QAAUpC,KAAK0+B,SAASK,EAAe,IAAK,GAAKpa,EACtDhe,EAAKtE,QAAUrC,KAAK0+B,SAASK,EAAe,IAAK,GAAKpa,EACtDhe,EAAKmjB,aAAe9pB,KAAK0+B,SAASK,EAAe,SAAU,GAC3Dp4B,EAAKojB,aAAe/pB,KAAK0+B,SAASK,EAAe,SAAU,GAC3Dp4B,EAAKgjB,aAAe3pB,KAAK0+B,SAASK,EAAe,SAAU,GAE3Dp4B,EAAKmd,UAAY9jB,KAAK0+B,SAASK,EAAe,YAAa,GAC3Dp4B,EAAKod,aAAe/jB,KAAK0+B,SAASK,EAAe,eAAgB,GACjEp4B,EAAKsiB,SAAWjpB,KAAK0+B,SAASK,EAAe,WAAY,GACzDp4B,EAAKuiB,SAAWlpB,KAAK0+B,SAASK,EAAe,WAAY,GAEzDpG,EAAatO,qBAAqBtlB,KAAK4B,EACxC,CAID,GAAIu3B,EAAK/3B,KACR,IAAK,IAAIhB,EAAI,EAAGA,EAAI+4B,EAAK/3B,KAAKrC,OAAQqB,IAAK,CAC1C,IAAI45B,EAAgBb,EAAK/3B,KAAKhB,GAC1BwB,EAAO,IAAI4c,EAAmBwb,EAAc96B,MAChD0C,EAAK2c,MAAQtjB,KAAK0+B,SAASK,EAAe,QAAS,GACnDp4B,EAAK4U,aAAevb,KAAK0+B,SAASK,EAAe,QAAQ,GAEzD,IAAK,IAAI/sB,EAAI,EAAGA,EAAI+sB,EAAc1pB,MAAMvR,OAAQkO,IAAK,CACpD,IAAIwa,EAAWuS,EAAc1pB,MAAMrD,GAC/BgE,EAAO2iB,EAAa1Y,SAASuM,GACjC,GAAY,MAARxW,EAAc,MAAM,IAAInV,MAAM,wCAA0C2rB,GAC5E7lB,EAAK0O,MAAMtQ,KAAKiR,EACjB,CAEA,IAAIgpB,EAAqBD,EAAcpf,OAEvC,GADAhZ,EAAKgZ,OAASgZ,EAAatU,SAAS2a,GACjB,MAAfr4B,EAAKgZ,OAAgB,MAAM,IAAI9e,MAAM,+BAAiCm+B,GAE1Er4B,EAAK6c,aAAewa,GAAakB,uBAAuBl/B,KAAK0+B,SAASK,EAAe,eAAgB,YACrGp4B,EAAK8c,YAAcua,GAAamB,sBAAsBn/B,KAAK0+B,SAASK,EAAe,cAAe,WAClGp4B,EAAK+c,WAAasa,GAAaoB,qBAAqBp/B,KAAK0+B,SAASK,EAAe,aAAc,YAC/Fp4B,EAAKgd,eAAiB3jB,KAAK0+B,SAASK,EAAe,WAAY,GAC/Dp4B,EAAKid,SAAW5jB,KAAK0+B,SAASK,EAAe,WAAY,GACrDp4B,EAAK6c,cAAgBniB,EAAai3B,QAAO3xB,EAAKid,UAAYe,GAC9Dhe,EAAKkd,QAAU7jB,KAAK0+B,SAASK,EAAe,UAAW,GACnDp4B,EAAK8c,aAAeniB,EAAY0jB,QAAUre,EAAK8c,aAAeniB,EAAYg3B,QAAO3xB,EAAKkd,SAAWc,GACrGhe,EAAKmd,UAAY9jB,KAAK0+B,SAASK,EAAe,YAAa,GAC3Dp4B,EAAKod,aAAe/jB,KAAK0+B,SAASK,EAAe,eAAgB,GAEjEpG,EAAarO,gBAAgBvlB,KAAK4B,EACnC,CAID,GAAIu3B,EAAKlS,MACR,IAAK,IAAI7mB,EAAI,EAAGA,EAAI+4B,EAAKlS,MAAMloB,OAAQqB,IAAK,CAC3C,IAAIk6B,EAAUnB,EAAKlS,MAAM7mB,GACrB0V,EAAO,IAAI2c,GAAK6H,EAAQp7B,MAE5B,GAAIo7B,EAAQhqB,MACX,IAAK,IAAIsS,EAAK,EAAGA,EAAK0X,EAAQhqB,MAAMvR,OAAQ6jB,IAAM,CACjD,IAAI3R,EAAO2iB,EAAa1Y,SAASof,EAAQhqB,MAAMsS,IAC/C,GAAY,MAAR3R,EAAc,MAAM,IAAInV,MAAM,wBAA0Bw+B,EAAQhqB,MAAMlQ,IAC1E0V,EAAKxF,MAAMtQ,KAAKiR,EACjB,CAGD,GAAIqpB,EAAQP,GACX,IAAK,IAAInX,EAAK,EAAGA,EAAK0X,EAAQP,GAAGh7B,OAAQ6jB,IAAM,CAC9C,IAAIyD,EAAauN,EAAaxL,iBAAiBkS,EAAQP,GAAGnX,IAC1D,GAAkB,MAAdyD,EAAoB,MAAM,IAAIvqB,MAAM,iCAAmCw+B,EAAQP,GAAG35B,IACtF0V,EAAK4Q,YAAY1mB,KAAKqmB,EACvB,CAGD,GAAIiU,EAAQJ,UACX,IAAK,IAAItX,EAAK,EAAGA,EAAK0X,EAAQJ,UAAUn7B,OAAQ6jB,IAAM,CACrD,IAAIyD,EAAauN,EAAarL,wBAAwB+R,EAAQJ,UAAUtX,IACxE,GAAkB,MAAdyD,EAAoB,MAAM,IAAIvqB,MAAM,wCAA0Cw+B,EAAQJ,UAAU95B,IACpG0V,EAAK4Q,YAAY1mB,KAAKqmB,EACvB,CAGD,GAAIiU,EAAQl5B,KACX,IAAK,IAAIwhB,EAAK,EAAGA,EAAK0X,EAAQl5B,KAAKrC,OAAQ6jB,IAAM,CAChD,IAAIyD,EAAauN,EAAapL,mBAAmB8R,EAAQl5B,KAAKwhB,IAC9D,GAAkB,MAAdyD,EAAoB,MAAM,IAAIvqB,MAAM,mCAAqCw+B,EAAQl5B,KAAKhB,IAC1F0V,EAAK4Q,YAAY1mB,KAAKqmB,EACvB,CAGD,IAAK,IAAIsB,KAAY2S,EAAQnT,YAAa,CACzC,IAAIxW,EAAOijB,EAAatU,SAASqI,GACjC,GAAY,MAARhX,EAAc,MAAM,IAAI7U,MAAM,mBAAqB6rB,GACvD,IAAIkS,EAAUS,EAAQnT,YAAYQ,GAClC,IAAK,IAAI4S,KAAaV,EAAS,CAC9B,IAAI7nB,EAAa/W,KAAKi6B,eAAe2E,EAAQU,GAAYzkB,EAAMnF,EAAK7Q,MAAOy6B,EAAW3G,GACpE,MAAd5hB,GAAoB8D,EAAK8N,cAAcjT,EAAK7Q,MAAOy6B,EAAWvoB,EACnE,CACD,CACA4hB,EAAa3M,MAAMjnB,KAAK8V,GACP,WAAbA,EAAK5W,OAAmB00B,EAAa5M,YAAclR,EACxD,CAID,IAAK,IAAI1V,EAAI,EAAGqG,EAAIxL,KAAKw4B,aAAa10B,OAAQqB,EAAIqG,EAAGrG,IAAK,CACzD,IAAI00B,EAAa75B,KAAKw4B,aAAarzB,GAC/B0V,EAA0B,MAAnBgf,EAAWhf,KAAe8d,EAAa5M,YAAc4M,EAAa7L,SAAS+M,EAAWhf,MACjG,GAAY,MAARA,EAAc,MAAM,IAAIha,MAAM,mBAAqBg5B,EAAWhf,MAClE,IAAI7R,EAAS6R,EAAKyJ,cAAcuV,EAAWjO,UAAWiO,EAAW7wB,QACjE,GAAc,MAAVA,EAAgB,MAAM,IAAInI,MAAM,0BAA4Bg5B,EAAW7wB,QAC3E6wB,EAAWjM,KAAKpY,iBAAmBqkB,EAAWC,cAAkC9wB,EAA2B6wB,EAAWjM,KACtHiM,EAAWjM,KAAK5V,cAA+BhP,GAC/C6wB,EAAWjM,KAAKhW,WACjB,CAIA,GAHA5X,KAAKw4B,aAAa10B,OAAS,EAGvBo6B,EAAK7P,OACR,IAAK,IAAIkR,KAAarB,EAAK7P,OAAQ,CAClC,IAAImR,EAAWtB,EAAK7P,OAAOkR,GACvB54B,EAAO,IAAI4vB,GAAUgJ,GACzB54B,EAAKuvB,SAAWl2B,KAAK0+B,SAASc,EAAU,MAAO,GAC/C74B,EAAKwvB,WAAan2B,KAAK0+B,SAASc,EAAU,QAAS,GACnD74B,EAAKyvB,YAAcp2B,KAAK0+B,SAASc,EAAU,SAAU,IACrD74B,EAAK6vB,UAAYx2B,KAAK0+B,SAASc,EAAU,QAAS,MAC5B,MAAlB74B,EAAK6vB,YACR7vB,EAAK0vB,OAASr2B,KAAK0+B,SAASc,EAAU,SAAU,GAChD74B,EAAK2vB,QAAUt2B,KAAK0+B,SAASc,EAAU,UAAW,IAEnD7G,EAAatK,OAAOtpB,KAAK4B,EAC1B,CAID,GAAIu3B,EAAKvH,WACR,IAAK,IAAIQ,KAAiB+G,EAAKvH,WAAY,CAC1C,IAAI8I,EAAevB,EAAKvH,WAAWQ,GACnCn3B,KAAK+5B,cAAc0F,EAActI,EAAewB,EACjD,CAGD,OAAOA,CACR,CAEA,cAAAsB,CAAgByF,EAAU7kB,EAAY+Q,EAAmB3nB,EAAc00B,GACtE,IAAIhU,EAAQ3kB,KAAK2kB,MAKjB,OAJA1gB,EAAOjE,KAAK0+B,SAASgB,EAAK,OAAQz7B,GAEvBjE,KAAK0+B,SAASgB,EAAK,OAAQ,WAGrC,IAAK,SAAU,CACd,IAAIv5B,EAAOnG,KAAK0+B,SAASgB,EAAK,OAAQz7B,GAClCF,EAAS/D,KAAKu4B,iBAAiB3d,oBAAoBC,EAAM5W,EAAMkC,GACnE,GAAc,MAAVpC,EAAgB,OAAO,KAC3BA,EAAOoC,KAAOA,EACdpC,EAAOS,EAAIxE,KAAK0+B,SAASgB,EAAK,IAAK,GAAK/a,EACxC5gB,EAAOW,EAAI1E,KAAK0+B,SAASgB,EAAK,IAAK,GAAK/a,EACxC5gB,EAAO+U,OAAS9Y,KAAK0+B,SAASgB,EAAK,SAAU,GAC7C37B,EAAOgV,OAAS/Y,KAAK0+B,SAASgB,EAAK,SAAU,GAC7C37B,EAAOwU,SAAWvY,KAAK0+B,SAASgB,EAAK,WAAY,GACjD37B,EAAO9B,MAAQy9B,EAAIz9B,MAAQ0iB,EAC3B5gB,EAAO7B,OAASw9B,EAAIx9B,OAASyiB,EAE7B,IAAI3U,EAAgBhQ,KAAK0+B,SAASgB,EAAK,QAAS,MAIhD,OAHa,MAAT1vB,GAAejM,EAAOiM,MAAMJ,cAAcI,GAE9CjM,EAAOkV,eACAlV,CACR,CACA,IAAK,cAAe,CACnB,IAAIw2B,EAAMv6B,KAAKu4B,iBAAiBxd,yBAAyBF,EAAM5W,GAC/D,GAAW,MAAPs2B,EAAa,OAAO,KACxBv6B,KAAKs6B,aAAaoF,EAAKnF,EAAKmF,EAAIvM,aAAe,GAC/C,IAAInjB,EAAgBhQ,KAAK0+B,SAASgB,EAAK,QAAS,MAEhD,OADa,MAAT1vB,GAAeuqB,EAAIvqB,MAAMJ,cAAcI,GACpCuqB,CACR,CACA,IAAK,OACL,IAAK,aAAc,CAClB,IAAIp0B,EAAOnG,KAAK0+B,SAASgB,EAAK,OAAQz7B,GAClC2pB,EAAO5tB,KAAKu4B,iBAAiBzd,kBAAkBD,EAAM5W,EAAMkC,GAC/D,GAAY,MAARynB,EAAc,OAAO,KACzBA,EAAKznB,KAAOA,EAEZ,IAAI6J,EAAQhQ,KAAK0+B,SAASgB,EAAK,QAAS,MAC3B,MAAT1vB,GAAe4d,EAAK5d,MAAMJ,cAAcI,GAE5C4d,EAAK3rB,MAAQjC,KAAK0+B,SAASgB,EAAK,QAAS,GAAK/a,EAC9CiJ,EAAK1rB,OAASlC,KAAK0+B,SAASgB,EAAK,SAAU,GAAK/a,EAEhD,IAAI3b,EAAiBhJ,KAAK0+B,SAASgB,EAAK,SAAU,MAClD,GAAc,MAAV12B,EAEH,OADAhJ,KAAKw4B,aAAazzB,KAAK,IAAI,GAAW6oB,EAAe5tB,KAAK0+B,SAASgB,EAAK,OAAQ,MAAO9T,EAAW5iB,EAAQhJ,KAAK0+B,SAASgB,EAAK,UAAU,KAChI9R,EAGR,IAAItW,EAAqBooB,EAAIpoB,IAQ7B,OAPAtX,KAAKs6B,aAAaoF,EAAK9R,EAAMtW,EAAIxT,QACjC8pB,EAAKrW,UAAYmoB,EAAInoB,UACrBqW,EAAKvW,UAAYC,EACjBsW,EAAKhW,YAELgW,EAAKnW,MAAQzX,KAAK0+B,SAASgB,EAAK,QAAS,MACzC9R,EAAKpW,WAA6C,EAAhCxX,KAAK0+B,SAASgB,EAAK,OAAQ,GACtC9R,CACR,CACA,IAAK,OAAQ,CACZ,IAAIznB,EAAOnG,KAAKu4B,iBAAiBvd,kBAAkBH,EAAM5W,GACzD,GAAY,MAARkC,EAAc,OAAO,KACzBA,EAAKiS,OAASpY,KAAK0+B,SAASgB,EAAK,UAAU,GAC3Cv5B,EAAKkS,cAAgBrY,KAAK0+B,SAASgB,EAAK,iBAAiB,GAEzD,IAAIvM,EAAcuM,EAAIvM,YACtBnzB,KAAKs6B,aAAaoF,EAAKv5B,EAAMgtB,GAAe,GAE5C,IAAIhb,EAAyB1G,EAAMY,SAAS8gB,EAAc,EAAG,GAC7D,IAAK,IAAIhuB,EAAI,EAAGA,EAAIu6B,EAAIvnB,QAAQrU,OAAQqB,IACvCgT,EAAQhT,GAAKu6B,EAAIvnB,QAAQhT,GAAKwf,EAC/Bxe,EAAKgS,QAAUA,EAEf,IAAInI,EAAgBhQ,KAAK0+B,SAASgB,EAAK,QAAS,MAEhD,OADa,MAAT1vB,GAAe7J,EAAK6J,MAAMJ,cAAcI,GACrC7J,CACR,CACA,IAAK,QAAS,CACb,IAAIsS,EAAQzY,KAAKu4B,iBAAiBtd,mBAAmBJ,EAAM5W,GAC3D,GAAa,MAATwU,EAAe,OAAO,KAC1BA,EAAMjU,EAAIxE,KAAK0+B,SAASgB,EAAK,IAAK,GAAK/a,EACvClM,EAAM/T,EAAI1E,KAAK0+B,SAASgB,EAAK,IAAK,GAAK/a,EACvClM,EAAMF,SAAWvY,KAAK0+B,SAASgB,EAAK,WAAY,GAEhD,IAAI1vB,EAAQhQ,KAAK0+B,SAASgB,EAAK,QAAS,MAExC,OADa,MAAT1vB,GAAeyI,EAAMzI,MAAMJ,cAAcI,GACtCyI,CACR,CACA,IAAK,WAAY,CAChB,IAAIuiB,EAAOh7B,KAAKu4B,iBAAiBrd,sBAAsBL,EAAM5W,GAC7D,GAAY,MAAR+2B,EAAc,OAAO,KAEzB,IAAIyB,EAAMz8B,KAAK0+B,SAASgB,EAAK,MAAO,MACpC,GAAW,MAAPjD,EAAa,CAChB,IAAI/mB,EAAOijB,EAAatU,SAASoY,GACjC,GAAY,MAAR/mB,EAAc,MAAM,IAAI7U,MAAM,gCAAkC47B,GACpEzB,EAAK7jB,QAAUzB,CAChB,CAEA,IAAIyd,EAAcuM,EAAIvM,YACtBnzB,KAAKs6B,aAAaoF,EAAK1E,EAAM7H,GAAe,GAE5C,IAAInjB,EAAgBhQ,KAAK0+B,SAASgB,EAAK,QAAS,MAEhD,OADa,MAAT1vB,GAAegrB,EAAKhrB,MAAMJ,cAAcI,GACrCgrB,CACR,EAED,OAAO,IACR,CAEA,YAAAV,CAAcoF,EAAU3oB,EAA8B4O,GACrD,IAAIhB,EAAQ3kB,KAAK2kB,MACjB5N,EAAWxB,oBAAsBoQ,EACjC,IAAIrQ,EAA0BoqB,EAAIpqB,SAClC,GAAIqQ,GAAkBrQ,EAASxR,OAAQ,CACtC,IAAI67B,EAAiBluB,EAAMmB,aAAa0C,GACxC,GAAa,GAATqP,EACH,IAAK,IAAIxf,EAAI,EAAGqG,EAAI8J,EAASxR,OAAQqB,EAAIqG,EAAGrG,IAC3Cw6B,EAAex6B,IAAMwf,EAGvB,YADA5N,EAAWzB,SAAWqqB,EAEvB,CACA,IAAIzE,EAAU,IAAIh4B,MACdmS,EAAQ,IAAInS,MAChB,IAAK,IAAIiC,EAAI,EAAGqG,EAAI8J,EAASxR,OAAQqB,EAAIqG,GAAI,CAC5C,IAAIqZ,EAAYvP,EAASnQ,KACzBkQ,EAAMtQ,KAAK8f,GACX,IAAK,IAAIgJ,EAAK1oB,EAAgB,EAAZ0f,EAAe1f,EAAI0oB,EAAI1oB,GAAK,EAC7CkQ,EAAMtQ,KAAKuQ,EAASnQ,IACpB+1B,EAAQn2B,KAAKuQ,EAASnQ,EAAI,GAAKwf,GAC/BuW,EAAQn2B,KAAKuQ,EAASnQ,EAAI,GAAKwf,GAC/BuW,EAAQn2B,KAAKuQ,EAASnQ,EAAI,GAE5B,CACA4R,EAAW1B,MAAQA,EACnB0B,EAAWzB,SAAW7D,EAAMmB,aAAasoB,EAC1C,CAEA,aAAAnB,CAAe2F,EAAUz7B,EAAc00B,GACtC,IAAIhU,EAAQ3kB,KAAK2kB,MACboJ,EAAY,IAAI7qB,MAChB+qB,EAAW,EAGf,GAAIyR,EAAIxV,MACP,IAAK,IAAIwC,KAAYgT,EAAIxV,MAAO,CAC/B,IAAI0U,EAAUc,EAAIxV,MAAMwC,GACpBd,EAAY+M,EAAahM,cAAcD,GAC3C,IAAkB,GAAdd,EAAiB,MAAM,IAAI/qB,MAAM,mBAAqB6rB,GAC1D,IAAK,IAAIkT,KAAgBhB,EAAS,CACjC,IAAIiB,EAAcjB,EAAQgB,GAC1B,GAAoB,cAAhBA,EAA8B,CACjC,IAAInE,EAAW,IAAI7I,GAAmBiN,EAAY/7B,QAClD23B,EAAS7P,UAAYA,EAErB,IAAIsD,EAAa,EACjB,IAAK,IAAI/pB,EAAI,EAAGA,EAAI06B,EAAY/7B,OAAQqB,IAAK,CAC5C,IAAI26B,EAAWD,EAAY16B,GAC3Bs2B,EAAS1L,SAASb,IAAclvB,KAAK0+B,SAASoB,EAAU,OAAQ,GAAIA,EAAS77B,KAC9E,CACA8pB,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,OAAO2L,EAASzM,gBAAkB,GAC1E,MAAO,GAAoB,SAAhB4Q,EAAyB,CACnC,IAAInE,EAAW,IAAIrK,GAAcyO,EAAY/7B,QAC7C23B,EAAS7P,UAAYA,EAErB,IAAIsD,EAAa,EACjB,IAAK,IAAI/pB,EAAI,EAAGA,EAAI06B,EAAY/7B,OAAQqB,IAAK,CAC5C,IAAI26B,EAAWD,EAAY16B,GACvB6K,EAAQ,IAAIb,EAChBa,EAAMJ,cAAckwB,EAAS9vB,OAC7ByrB,EAAS1L,SAASb,EAAYlvB,KAAK0+B,SAASoB,EAAU,OAAQ,GAAI9vB,EAAMZ,EAAGY,EAAMX,EAAGW,EAAMV,EAAGU,EAAMT,GACnGvP,KAAK27B,UAAUmE,EAAUrE,EAAUvM,GACnCA,GACD,CACAnB,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,QAAQ2L,EAASzM,gBAAkB,GAAKoC,GAAcjB,SAE9F,KAAO,IAAoB,YAAhByP,EAmBV,MAAM,IAAI/+B,MAAM,qCAAuC++B,EAAe,KAAOlT,EAAW,KAnBlD,CACtC,IAAI+O,EAAW,IAAI5J,GAAiBgO,EAAY/7B,QAChD23B,EAAS7P,UAAYA,EAErB,IAAIsD,EAAa,EACjB,IAAK,IAAI/pB,EAAI,EAAGA,EAAI06B,EAAY/7B,OAAQqB,IAAK,CAC5C,IAAI26B,EAAWD,EAAY16B,GACvBktB,EAAQ,IAAIljB,EACZmjB,EAAO,IAAInjB,EACfkjB,EAAMziB,cAAckwB,EAASzN,OAC7BC,EAAK1iB,cAAckwB,EAASxN,MAC5BmJ,EAAS1L,SAASb,EAAYlvB,KAAK0+B,SAASoB,EAAU,OAAQ,GAAIzN,EAAMjjB,EAAGijB,EAAMhjB,EAAGgjB,EAAM/iB,EAAG+iB,EAAM9iB,EAAG+iB,EAAKljB,EAAGkjB,EAAKjjB,EAAGijB,EAAKhjB,GAC3HtP,KAAK27B,UAAUmE,EAAUrE,EAAUvM,GACnCA,GACD,CACAnB,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,QAAQ2L,EAASzM,gBAAkB,GAAK6C,GAAiB1B,SAEjG,CAC6F,CAC9F,CACD,CAID,GAAIuP,EAAIrqB,MACP,IAAK,IAAImX,KAAYkT,EAAIrqB,MAAO,CAC/B,IAAImpB,EAAUkB,EAAIrqB,MAAMmX,GACpBJ,EAAYuM,EAAalM,cAAcD,GAC3C,IAAkB,GAAdJ,EAAiB,MAAM,IAAIvrB,MAAM,mBAAqB2rB,GAC1D,IAAK,IAAIoT,KAAgBpB,EAAS,CACjC,IAAIqB,EAAcrB,EAAQoB,GAC1B,GAAqB,WAAjBA,EAA2B,CAC9B,IAAInE,EAAW,IAAI5L,EAAegQ,EAAY/7B,QAC9C23B,EAASrP,UAAYA,EAErB,IAAI8C,EAAa,EACjB,IAAK,IAAI/pB,EAAI,EAAGA,EAAI06B,EAAY/7B,OAAQqB,IAAK,CAC5C,IAAI26B,EAAWD,EAAY16B,GAC3Bs2B,EAAS1L,SAASb,EAAYlvB,KAAK0+B,SAASoB,EAAU,OAAQ,GAAI9/B,KAAK0+B,SAASoB,EAAU,QAAS,IACnG9/B,KAAK27B,UAAUmE,EAAUrE,EAAUvM,GACnCA,GACD,CACAnB,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,QAAQ2L,EAASzM,gBAAkB,GAAKa,EAAeM,SAE/F,KAAO,IAAqB,cAAjByP,GAAiD,UAAjBA,GAA6C,UAAjBA,EA0BtE,MAAM,IAAI/+B,MAAM,qCAAuC++B,EAAe,KAAOpT,EAAW,KA1BQ,CAChG,IAAIiP,EAA8B,KAC9BQ,EAAgB,EAAG3pB,EAAe,EACjB,UAAjBstB,GACHnE,EAAW,IAAI1K,GAAc8O,EAAY/7B,QACzCwO,EAAe,GACY,UAAjBstB,EACVnE,EAAW,IAAIvK,GAAc2O,EAAY/7B,SAEzC23B,EAAW,IAAIhL,EAAkBoP,EAAY/7B,QAC7Cm4B,EAAgBtX,GAEjB8W,EAASrP,UAAYA,EAErB,IAAI8C,EAAa,EACjB,IAAK,IAAI/pB,EAAI,EAAGA,EAAI06B,EAAY/7B,OAAQqB,IAAK,CAC5C,IAAI26B,EAAWD,EAAY16B,GACvBX,EAAIxE,KAAK0+B,SAASoB,EAAU,IAAKxtB,GAAe5N,EAAI1E,KAAK0+B,SAASoB,EAAU,IAAKxtB,GACrFmpB,EAAS1L,SAASb,EAAYlvB,KAAK0+B,SAASoB,EAAU,OAAQ,GAAIt7B,EAAIy3B,EAAev3B,EAAIu3B,GACzFj8B,KAAK27B,UAAUmE,EAAUrE,EAAUvM,GACnCA,GACD,CACAnB,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,QAAQ2L,EAASzM,gBAAkB,GAAKyB,EAAkBN,SAElG,CAC6F,CAC9F,CACD,CAID,GAAIuP,EAAIZ,GACP,IAAK,IAAI1R,KAAkBsS,EAAIZ,GAAI,CAClC,IAAIC,EAAgBW,EAAIZ,GAAG1R,GACvBhC,EAAauN,EAAaxL,iBAAiBC,GAC3CqO,EAAW,IAAI1H,GAAqBgL,EAAcj7B,QACtD23B,EAASzH,kBAAoB2E,EAAavO,cAAc7kB,QAAQ6lB,GAChE,IAAI8D,EAAa,EACjB,IAAK,IAAI/pB,EAAI,EAAGA,EAAI45B,EAAcj7B,OAAQqB,IAAK,CAC9C,IAAI26B,EAAWf,EAAc55B,GAC7Bs2B,EAAS1L,SAASb,EAAYlvB,KAAK0+B,SAASoB,EAAU,OAAQ,GAAI9/B,KAAK0+B,SAASoB,EAAU,MAAO,GAAI9/B,KAAK0+B,SAASoB,EAAU,WAAY,GAAKnb,EAC7I3kB,KAAK0+B,SAASoB,EAAU,gBAAgB,GAAQ,GAAK,EAAG9/B,KAAK0+B,SAASoB,EAAU,YAAY,GAAQ9/B,KAAK0+B,SAASoB,EAAU,WAAW,IACxI9/B,KAAK27B,UAAUmE,EAAUrE,EAAUvM,GACnCA,GACD,CACAnB,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,QAAQ2L,EAASzM,gBAAkB,GAAK+E,GAAqB5D,SACrG,CAID,GAAIuP,EAAIT,UACP,IAAK,IAAI7R,KAAkBsS,EAAIT,UAAW,CACzC,IAAIF,EAAgBW,EAAIT,UAAU7R,GAC9BhC,EAAauN,EAAarL,wBAAwBF,GAClDqO,EAAW,IAAI7G,GAA4BmK,EAAcj7B,QAC7D23B,EAAS5G,yBAA2B8D,EAAatO,qBAAqB9kB,QAAQ6lB,GAC9E,IAAI8D,EAAa,EACjB,IAAK,IAAI/pB,EAAI,EAAGA,EAAI45B,EAAcj7B,OAAQqB,IAAK,CAC9C,IAAI26B,EAAWf,EAAc55B,GAC7Bs2B,EAAS1L,SAASb,EAAYlvB,KAAK0+B,SAASoB,EAAU,OAAQ,GAAI9/B,KAAK0+B,SAASoB,EAAU,YAAa,GACtG9/B,KAAK0+B,SAASoB,EAAU,eAAgB,GAAI9/B,KAAK0+B,SAASoB,EAAU,WAAY,GAAI9/B,KAAK0+B,SAASoB,EAAU,WAAY,IACzH9/B,KAAK27B,UAAUmE,EAAUrE,EAAUvM,GACnCA,GACD,CACAnB,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EACnBwN,EAAS3L,QAAQ2L,EAASzM,gBAAkB,GAAK4F,GAA4BzE,SAC/E,CAID,GAAIuP,EAAIv5B,KACP,IAAK,IAAIinB,KAAkBsS,EAAIv5B,KAAM,CACpC,IAAI44B,EAAgBW,EAAIv5B,KAAKinB,GACzBvoB,EAAQ8zB,EAAatB,wBAAwBjK,GACjD,IAAc,GAAVvoB,EAAa,MAAM,IAAIhE,MAAM,8BAAgCusB,GACjE,IAAIzmB,EAAOgyB,EAAarO,gBAAgBzlB,GACxC,IAAK,IAAI+6B,KAAgBb,EAAe,CACvC,IAAIc,EAAcd,EAAca,GAChC,GAAqB,aAAjBA,GAAgD,YAAjBA,EAA4B,CAC9D,IAAInE,EAA2C,KAC3CQ,EAAgB,EACC,YAAjB2D,GACHnE,EAAW,IAAI7F,GAA8BiK,EAAY/7B,QACrD6C,EAAK8c,aAAeniB,EAAY0jB,QAAUre,EAAK8c,aAAeniB,EAAYg3B,QAAO2D,EAAgBtX,KAErG8W,EAAW,IAAIlG,GAA+BsK,EAAY/7B,QACtD6C,EAAK6c,cAAgBniB,EAAai3B,QAAO2D,EAAgBtX,IAE9D8W,EAASjG,oBAAsB3wB,EAC/B,IAAIqqB,EAAa,EACjB,IAAK,IAAI/pB,EAAI,EAAGA,EAAI06B,EAAY/7B,OAAQqB,IAAK,CAC5C,IAAI26B,EAAWD,EAAY16B,GAC3Bs2B,EAAS1L,SAASb,EAAYlvB,KAAK0+B,SAASoB,EAAU,OAAQ,GAAI9/B,KAAK0+B,SAASoB,EAAUF,EAAc,GAAK3D,GAC7Gj8B,KAAK27B,UAAUmE,EAAUrE,EAAUvM,GACnCA,GACD,CACAnB,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EACnBwN,EAAS3L,QAAQ2L,EAASzM,gBAAkB,GAAKuG,GAA+BpF,SAClF,MAAO,GAAqB,QAAjByP,EAAwB,CAClC,IAAInE,EAAW,IAAI3F,GAA0B+J,EAAY/7B,QACzD23B,EAASjG,oBAAsB3wB,EAC/B,IAAIqqB,EAAa,EACjB,IAAK,IAAI/pB,EAAI,EAAGA,EAAI06B,EAAY/7B,OAAQqB,IAAK,CAC5C,IAAI26B,EAAWD,EAAY16B,GAC3Bs2B,EAAS1L,SAASb,EAAYlvB,KAAK0+B,SAASoB,EAAU,OAAQ,GAAI9/B,KAAK0+B,SAASoB,EAAU,YAAa,GACtG9/B,KAAK0+B,SAASoB,EAAU,eAAgB,IACzC9/B,KAAK27B,UAAUmE,EAAUrE,EAAUvM,GACnCA,GACD,CACAnB,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EACnBwN,EAAS3L,QAAQ2L,EAASzM,gBAAkB,GAAK8G,GAA0B3F,SAC7E,CACD,CACD,CAID,GAAIuP,EAAIxpB,OACP,IAAK,IAAI6pB,KAAcL,EAAIxpB,OAAQ,CAClC,IAAI8pB,EAAYN,EAAIxpB,OAAO6pB,GACvBllB,EAAO8d,EAAa7L,SAASiT,GACjC,GAAY,MAARllB,EAAc,MAAM,IAAIha,MAAM,mBAAqBk/B,GACvD,IAAK,IAAIrT,KAAYsT,EAAW,CAC/B,IAAIpB,EAAUoB,EAAUtT,GACpBd,EAAY+M,EAAahM,cAAcD,GAC3C,IAAkB,GAAdd,EAAiB,MAAM,IAAI/qB,MAAM,mBAAqB+9B,EAAQ36B,MAClE,IAAK,IAAI27B,KAAgBhB,EAAS,CACjC,IAAIiB,EAAcjB,EAAQgB,GACtB7oB,EAA+B8D,EAAKyJ,cAAcsH,EAAWgU,GACjE,GAAkB,MAAd7oB,EAAoB,MAAM,IAAIlW,MAAM,gCAAkCg/B,EAAY57B,MACtF,IAAIs4B,EAA+B,MAApBxlB,EAAW1B,MACtBC,EAAWyB,EAAWzB,SACtBknB,EAAeD,EAAWjnB,EAASxR,OAAS,EAAI,EAAIwR,EAASxR,OAE7D23B,EAAW,IAAI1I,GAAe8M,EAAY/7B,QAC9C23B,EAAS7P,UAAYA,EACrB6P,EAAS1kB,WAAaA,EAEtB,IAAImY,EAAa,EACjB,IAAK,IAAIld,EAAI,EAAGA,EAAI6tB,EAAY/7B,OAAQkO,IAAK,CAC5C,IACIkE,EADA4pB,EAAWD,EAAY7tB,GAEvBiuB,EAA+BjgC,KAAK0+B,SAASoB,EAAU,WAAY,MACvE,GAAqB,MAAjBG,EACH/pB,EAASqmB,EAAW9qB,EAAMc,cAAciqB,GAAgBlnB,MACpD,CACJY,EAASzE,EAAMc,cAAciqB,GAC7B,IAAI7mB,EAAgB3V,KAAK0+B,SAASoB,EAAU,SAAU,GAEtD,GADAruB,EAAMC,UAAUuuB,EAAe,EAAG/pB,EAAQP,EAAOsqB,EAAcn8B,QAClD,GAAT6gB,EACH,IAAK,IAAIxf,EAAIwQ,EAAOnK,EAAIrG,EAAI86B,EAAcn8B,OAAQqB,EAAIqG,EAAGrG,IACxD+Q,EAAO/Q,IAAMwf,EAEf,IAAK4X,EACJ,IAAK,IAAIp3B,EAAI,EAAGA,EAAIq3B,EAAcr3B,IACjC+Q,EAAO/Q,IAAMmQ,EAASnQ,EAEzB,CAEAs2B,EAAS1L,SAASb,EAAYlvB,KAAK0+B,SAASoB,EAAU,OAAQ,GAAI5pB,GAClElW,KAAK27B,UAAUmE,EAAUrE,EAAUvM,GACnCA,GACD,CACAnB,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,OAAO2L,EAASzM,gBAAkB,GAC1E,CACD,CACD,CAID,IAAIkR,EAAgBR,EAAIvV,UAExB,GADqB,MAAjB+V,IAAuBA,EAAgBR,EAAIS,WAC1B,MAAjBD,EAAuB,CAC1B,IAAIzE,EAAW,IAAI7H,GAAkBsM,EAAcp8B,QAC/Ck2B,EAAYrB,EAAazO,MAAMpmB,OAC/BorB,EAAa,EACjB,IAAK,IAAIld,EAAI,EAAGA,EAAIkuB,EAAcp8B,OAAQkO,IAAK,CAC9C,IAAIouB,EAAeF,EAAcluB,GAC7BmY,EAA2B,KAC3BkW,EAAUrgC,KAAK0+B,SAAS0B,EAAc,UAAW,MACrD,GAAe,MAAXC,EAAiB,CACpBlW,EAAY1Y,EAAMY,SAAiB2nB,GAAY,GAC/C,IAAI6C,EAAYprB,EAAMY,SAAiB2nB,EAAYqG,EAAQv8B,OAAQ,GAC/Dg5B,EAAgB,EAAGC,EAAiB,EACxC,IAAK,IAAI53B,EAAI,EAAGA,EAAIk7B,EAAQv8B,OAAQqB,IAAK,CACxC,IAAIm7B,EAAYD,EAAQl7B,GACpBymB,EAAY+M,EAAahM,cAAc2T,EAAU5qB,MACrD,IAAkB,GAAdkW,EAAiB,MAAM,IAAI/qB,MAAM,mBAAqBy/B,EAAU5qB,MAEpE,KAAOonB,GAAiBlR,GACvBiR,EAAUE,KAAoBD,IAE/B3S,EAAU2S,EAAgBwD,EAAUzqB,QAAUinB,GAC/C,CAEA,KAAOA,EAAgB9C,GACtB6C,EAAUE,KAAoBD,IAE/B,IAAK,IAAI33B,EAAI60B,EAAY,EAAG70B,GAAK,EAAGA,KACd,GAAjBglB,EAAUhlB,KAAUglB,EAAUhlB,GAAK03B,IAAYE,GACrD,CACAtB,EAAS1L,SAASb,IAAclvB,KAAK0+B,SAAS0B,EAAc,OAAQ,GAAIjW,EACzE,CACA4D,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,OAAO2L,EAASzM,gBAAkB,GAC1E,CAGA,GAAI0Q,EAAIrR,OAAQ,CACf,IAAIoN,EAAW,IAAIhI,GAAciM,EAAIrR,OAAOvqB,QACxCorB,EAAa,EACjB,IAAK,IAAI/pB,EAAI,EAAGA,EAAIu6B,EAAIrR,OAAOvqB,OAAQqB,IAAK,CAC3C,IAAIq6B,EAAWE,EAAIrR,OAAOlpB,GACtB83B,EAAYtE,EAAa3B,UAAUwI,EAASv7B,MAChD,GAAiB,MAAbg5B,EAAmB,MAAM,IAAIp8B,MAAM,oBAAsB2+B,EAASv7B,MACtE,IAAIyvB,EAAQ,IAAIuC,GAAMxkB,EAAMoB,kBAAkB7S,KAAK0+B,SAASc,EAAU,OAAQ,IAAKvC,GACnFvJ,EAAMwC,SAAWl2B,KAAK0+B,SAASc,EAAU,MAAOvC,EAAU/G,UAC1DxC,EAAMyC,WAAan2B,KAAK0+B,SAASc,EAAU,QAASvC,EAAU9G,YAC9DzC,EAAM0C,YAAcp2B,KAAK0+B,SAASc,EAAU,SAAUvC,EAAU7G,aACpC,MAAxB1C,EAAM/sB,KAAK6vB,YACd9C,EAAM2C,OAASr2B,KAAK0+B,SAASc,EAAU,SAAU,GACjD9L,EAAM4C,QAAUt2B,KAAK0+B,SAASc,EAAU,UAAW,IAEpD/D,EAAS1L,SAASb,IAAcwE,EACjC,CACA3F,EAAUhpB,KAAK02B,GACfxN,EAAWtpB,KAAK4L,IAAI0d,EAAUwN,EAAS3L,OAAO2L,EAASzM,gBAAkB,GAC1E,CAEA,GAAInH,MAAMoG,GACT,MAAM,IAAIptB,MAAM,kDAGjB83B,EAAahC,WAAW5xB,KAAK,IAAI+oB,EAAU7pB,EAAM8pB,EAAWE,GAC7D,CAEA,SAAA0N,CAAW+D,EAAUjE,EAAyBvM,GAC7C,GAAKwQ,EAAIa,eAAe,SACxB,GAAiB,WAAbb,EAAIzZ,MACPwV,EAAStM,WAAWD,OAChB,CACJ,IAAIjJ,EAAgByZ,EAAIzZ,MACxBwV,EAASjM,SAASN,EAAYjJ,EAAOjmB,KAAK0+B,SAASgB,EAAK,KAAM,GAAI1/B,KAAK0+B,SAASgB,EAAK,KAAM,GAAI1/B,KAAK0+B,SAASgB,EAAK,KAAM,GACzH,CACD,CAEA,QAAAhB,CAAUgB,EAAUc,EAAcluB,GACjC,YAAqBrD,IAAdywB,EAAIc,GAAsBd,EAAIc,GAAQluB,CAC9C,CAEA,0BAAOusB,CAAqB4B,GAE3B,GAAW,WADXA,EAAMA,EAAIrgC,eACW,OAAOe,EAAU+K,OACtC,GAAW,YAAPu0B,EAAmB,OAAOt/B,EAAUiL,SACxC,GAAW,YAAPq0B,EAAmB,OAAOt/B,EAAUmL,SACxC,GAAW,UAAPm0B,EAAiB,OAAOt/B,EAAUoL,OACtC,MAAM,IAAI1L,MAAM,uBAAuB4/B,IACxC,CAEA,6BAAOvB,CAAwBuB,GAE9B,GAAW,UADXA,EAAMA,EAAIrgC,eACU,OAAOiB,EAAai3B,MACxC,GAAW,WAAPmI,EAAkB,OAAOp/B,EAAamjB,QAC1C,MAAM,IAAI3jB,MAAM,0BAA0B4/B,IAC3C,CAEA,4BAAOtB,CAAuBsB,GAE7B,GAAW,WADXA,EAAMA,EAAIrgC,eACW,OAAOkB,EAAY0jB,OACxC,GAAW,SAAPyb,EAAgB,OAAOn/B,EAAYg3B,MACvC,GAAW,WAAPmI,EAAkB,OAAOn/B,EAAYkjB,QACzC,MAAM,IAAI3jB,MAAM,0BAA0B4/B,IAC3C,CAEA,2BAAOrB,CAAsBqB,GAE5B,GAAW,YADXA,EAAMA,EAAIrgC,eACY,OAAOmB,EAAWmjB,QACxC,GAAW,SAAP+b,EAAgB,OAAOl/B,EAAWgkB,MACtC,GAAW,cAAPkb,EAAqB,OAAOl/B,EAAWqjB,WAC3C,MAAM,IAAI/jB,MAAM,wBAAwB4/B,IACzC,CAEA,8BAAO9B,CAAwB8B,GAE9B,GAAW,WADXA,EAAMA,EAAIrgC,eACW,OAAOgB,EAAc8K,OAC1C,GAAW,mBAAPu0B,EAA0B,OAAOr/B,EAAc+b,gBACnD,GAAW,0BAAPsjB,EAAiC,OAAOr/B,EAAcgc,uBAC1D,GAAW,WAAPqjB,EAAkB,OAAOr/B,EAAcsc,QAC3C,GAAW,uBAAP+iB,EAA8B,OAAOr/B,EAAcuc,oBACvD,MAAM,IAAI9c,MAAM,2BAA2B4/B,IAC5C,EAGD,MAAM,GACLz3B,OAAgB6R,KAChB+Q,UACAgC,KACAkM,cAEA,WAAAh6B,CAAa8tB,EAAsB/S,EAAc+Q,EAAmB5iB,EAAgB8wB,GACnF95B,KAAK4tB,KAAOA,EACZ5tB,KAAK6a,KAAOA,EACZ7a,KAAK4rB,UAAYA,EACjB5rB,KAAKgJ,OAASA,EACdhJ,KAAK85B,cAAgBA,CACtB,ECz0BM,MAAM4G,GACZl8B,EAAI,EACJE,EAAI,EACJi8B,EAAI,EACJtqB,EAAI,EAEJ,WAAAvW,CAAa0E,EAAY,EAAGE,EAAY,EAAGi8B,EAAY,GACtD3gC,KAAKwE,EAAIA,EACTxE,KAAK0E,EAAIA,EACT1E,KAAK2gC,EAAIA,CACV,CAEA,OAAAC,CAAQ9+B,GAIP,OAHA9B,KAAKwE,EAAI1C,EAAE0C,EACXxE,KAAK0E,EAAI5C,EAAE4C,EACX1E,KAAK2gC,EAAI7+B,EAAE6+B,EACJ3gC,IACR,CAEA,GAAAwP,CAAKhL,EAAWE,EAAWi8B,GAI1B,OAHA3gC,KAAKwE,EAAIA,EACTxE,KAAK0E,EAAIA,EACT1E,KAAK2gC,EAAIA,EACF3gC,IACR,CAEA,GAAA8O,CAAKhN,GAIJ,OAHA9B,KAAKwE,GAAK1C,EAAE0C,EACZxE,KAAK0E,GAAK5C,EAAE4C,EACZ1E,KAAK2gC,GAAK7+B,EAAE6+B,EACL3gC,IACR,CAEA,GAAA6gC,CAAK/+B,GAIJ,OAHA9B,KAAKwE,GAAK1C,EAAE0C,EACZxE,KAAK0E,GAAK5C,EAAE4C,EACZ1E,KAAK2gC,GAAK7+B,EAAE6+B,EACL3gC,IACR,CAEA,KAAA2kB,CAAOtH,GAIN,OAHArd,KAAKwE,GAAK6Y,EACVrd,KAAK0E,GAAK2Y,EACVrd,KAAK2gC,GAAKtjB,EACHrd,IACR,CAEA,SAAA+T,GACC,IAAIC,EAAMhU,KAAK8D,SACf,OAAW,GAAPkQ,IACJA,EAAM,EAAIA,EACVhU,KAAKwE,GAAKwP,EACVhU,KAAK0E,GAAKsP,EACVhU,KAAK2gC,GAAK3sB,GAJWhU,IAMtB,CAEA,KAAA8gC,CAAOh/B,GACN,OAAO9B,KAAKwP,IAAIxP,KAAK0E,EAAI5C,EAAE6+B,EAAI3gC,KAAK2gC,EAAI7+B,EAAE4C,EAAG1E,KAAK2gC,EAAI7+B,EAAE0C,EAAIxE,KAAKwE,EAAI1C,EAAE6+B,EAAG3gC,KAAKwE,EAAI1C,EAAE4C,EAAI1E,KAAK0E,EAAI5C,EAAE0C,EACrG,CAEA,QAAAu8B,CAAUC,GACT,IAAIC,EAAQD,EAAOzS,OAEnB,OADAvuB,KAAKqW,EAAIrW,KAAKwE,EAAIy8B,EAAMC,IAAOlhC,KAAK0E,EAAIu8B,EAAME,IAAOnhC,KAAK2gC,EAAIM,EAAMG,IAAOH,EAAMI,IAC1ErhC,KAAKwP,IACXxP,KAAKwE,EAAIy8B,EAAMK,IAAOthC,KAAK0E,EAAIu8B,EAAMM,IAAOvhC,KAAK2gC,EAAIM,EAAMO,IAAOP,EAAMQ,IACxEzhC,KAAKwE,EAAIy8B,EAAMS,IAAO1hC,KAAK0E,EAAIu8B,EAAMU,IAAO3hC,KAAK2gC,EAAIM,EAAMW,IAAOX,EAAMY,IACxE7hC,KAAKwE,EAAIy8B,EAAMa,IAAO9hC,KAAK0E,EAAIu8B,EAAMc,IAAO/hC,KAAK2gC,EAAIM,EAAMe,IAAOf,EAAMgB,IAC1E,CAEA,OAAAC,CAASlB,GACR,IAAIC,EAAQD,EAAOzS,OACnBvuB,KAAKqW,EAAKrW,KAAKwE,EAAIy8B,EAAMC,IAAOlhC,KAAK0E,EAAIu8B,EAAME,IAAOnhC,KAAK2gC,EAAIM,EAAMG,IAAOH,EAAMI,IAClF,IAAIc,EAAM,EAAIniC,KAAKqW,EACnB,OAAOrW,KAAKwP,KACVxP,KAAKwE,EAAIy8B,EAAMK,IAAOthC,KAAK0E,EAAIu8B,EAAMM,IAAOvhC,KAAK2gC,EAAIM,EAAMO,IAAOP,EAAMQ,KAAQU,GAChFniC,KAAKwE,EAAIy8B,EAAMS,IAAO1hC,KAAK0E,EAAIu8B,EAAMU,IAAO3hC,KAAK2gC,EAAIM,EAAMW,IAAOX,EAAMY,KAAQM,GAChFniC,KAAKwE,EAAIy8B,EAAMa,IAAO9hC,KAAK0E,EAAIu8B,EAAMc,IAAO/hC,KAAK2gC,EAAIM,EAAMe,IAAOf,EAAMgB,KAAQE,EACnF,CAEA,GAAAhuB,CAAKrS,GACJ,OAAO9B,KAAKwE,EAAI1C,EAAE0C,EAAIxE,KAAK0E,EAAI5C,EAAE4C,EAAI1E,KAAK2gC,EAAI7+B,EAAE6+B,CACjD,CAEA,MAAA78B,GACC,OAAOa,KAAK6M,KAAKxR,KAAKwE,EAAIxE,KAAKwE,EAAIxE,KAAK0E,EAAI1E,KAAK0E,EAAI1E,KAAK2gC,EAAI3gC,KAAK2gC,EACpE,CAEA,QAAAyB,CAAUtgC,GACT,IAAIyN,EAAIzN,EAAE0C,EAAIxE,KAAKwE,EACf8K,EAAIxN,EAAE4C,EAAI1E,KAAK0E,EACfiL,EAAI7N,EAAE6+B,EAAI3gC,KAAK2gC,EACnB,OAAOh8B,KAAK6M,KAAKjC,EAAIA,EAAID,EAAIA,EAAIK,EAAIA,EACtC,CAEA,IAAAsH,GACC,OAAO,IAAIypB,GAAQ1gC,KAAKwE,EAAGxE,KAAK0E,EAAG1E,KAAK2gC,EACzC,ECjGM,MAAMW,GAAM,EACNC,GAAM,EACNC,GAAM,EACNC,GAAM,GACNC,GAAM,EACNC,GAAM,EACNC,GAAM,EACNC,GAAM,GACNC,GAAM,EACNC,GAAM,EACNC,GAAM,GACNC,GAAM,GACNf,GAAM,EACNC,GAAM,EACNC,GAAM,GACNC,GAAM,GAEZ,MAAMgB,GACZza,KAAqB,IAAInV,aAAa,IACtC8b,OAAuB,IAAI9b,aAAa,IAEhC1G,aAAwB,KACxBA,aAAwB,KACxBA,aAAwB,KACxBA,iBAAmB,IAAIs2B,GAE/B,WAAAviC,GACC,IAAIgC,EAAI9B,KAAKuuB,OACbvuB,KAAKkT,WACLpR,EAAEw/B,IAAO,EACTx/B,EAAE6/B,IAAO,EACT7/B,EAAEkgC,IAAO,EACTlgC,EAAEu/B,IAAO,CACV,CAEA,GAAA7xB,CAAK+e,GAEJ,OADAvuB,KAAKuuB,OAAO/e,IAAI+e,GACTvuB,IACR,CAEA,SAAAsiC,GACC,IAAIC,EAAIviC,KAAK4nB,KACT9lB,EAAI9B,KAAKuuB,OAiBb,OAhBAgU,EAAEjB,IAAOx/B,EAAEw/B,IACXiB,EAAEhB,IAAOz/B,EAAE4/B,IACXa,EAAEf,IAAO1/B,EAAEggC,IACXS,EAAEd,IAAO3/B,EAAEo/B,IACXqB,EAAEb,IAAO5/B,EAAEy/B,IACXgB,EAAEZ,IAAO7/B,EAAE6/B,IACXY,EAAEX,IAAO9/B,EAAEigC,IACXQ,EAAEV,IAAO//B,EAAEq/B,IACXoB,EAAET,IAAOhgC,EAAE0/B,IACXe,EAAER,IAAOjgC,EAAE8/B,IACXW,EAAEP,IAAOlgC,EAAEkgC,IACXO,EAAEN,IAAOngC,EAAEs/B,IACXmB,EAAErB,IAAOp/B,EAAE2/B,IACXc,EAAEpB,IAAOr/B,EAAE+/B,IACXU,EAAEnB,IAAOt/B,EAAEmgC,IACXM,EAAElB,IAAOv/B,EAAEu/B,IACJrhC,KAAKwP,IAAI+yB,EACjB,CAEA,QAAArvB,GACC,IAAIpR,EAAI9B,KAAKuuB,OAiBb,OAhBAzsB,EAAEw/B,IAAO,EACTx/B,EAAEy/B,IAAO,EACTz/B,EAAE0/B,IAAO,EACT1/B,EAAE2/B,IAAO,EACT3/B,EAAE4/B,IAAO,EACT5/B,EAAE6/B,IAAO,EACT7/B,EAAE8/B,IAAO,EACT9/B,EAAE+/B,IAAO,EACT//B,EAAEggC,IAAO,EACThgC,EAAEigC,IAAO,EACTjgC,EAAEkgC,IAAO,EACTlgC,EAAEmgC,IAAO,EACTngC,EAAEo/B,IAAO,EACTp/B,EAAEq/B,IAAO,EACTr/B,EAAEs/B,IAAO,EACTt/B,EAAEu/B,IAAO,EACFrhC,IACR,CAEA,MAAAwiC,GACC,IAAI1gC,EAAI9B,KAAKuuB,OACTgU,EAAIviC,KAAK4nB,KACT6a,EAAQ3gC,EAAEo/B,IAAOp/B,EAAEigC,IAAOjgC,EAAE8/B,IAAO9/B,EAAE2/B,IAAO3/B,EAAEggC,IAAOhgC,EAAEq/B,IAAOr/B,EAAE8/B,IAAO9/B,EAAE2/B,IAAO3/B,EAAEo/B,IAAOp/B,EAAE6/B,IAAO7/B,EAAEkgC,IAAOlgC,EAAE2/B,IAC9G3/B,EAAE4/B,IAAO5/B,EAAEq/B,IAAOr/B,EAAEkgC,IAAOlgC,EAAE2/B,IAAO3/B,EAAEggC,IAAOhgC,EAAE6/B,IAAO7/B,EAAEs/B,IAAOt/B,EAAE2/B,IAAO3/B,EAAE4/B,IAAO5/B,EAAEigC,IAAOjgC,EAAEs/B,IAAOt/B,EAAE2/B,IACrG3/B,EAAEo/B,IAAOp/B,EAAEigC,IAAOjgC,EAAE0/B,IAAO1/B,EAAE+/B,IAAO//B,EAAEggC,IAAOhgC,EAAEq/B,IAAOr/B,EAAE0/B,IAAO1/B,EAAE+/B,IAAO//B,EAAEo/B,IAAOp/B,EAAEy/B,IAAOz/B,EAAEkgC,IAAOlgC,EAAE+/B,IACrG//B,EAAEw/B,IAAOx/B,EAAEq/B,IAAOr/B,EAAEkgC,IAAOlgC,EAAE+/B,IAAO//B,EAAEggC,IAAOhgC,EAAEy/B,IAAOz/B,EAAEs/B,IAAOt/B,EAAE+/B,IAAO//B,EAAEw/B,IAAOx/B,EAAEigC,IAAOjgC,EAAEs/B,IAAOt/B,EAAE+/B,IACrG//B,EAAEo/B,IAAOp/B,EAAE6/B,IAAO7/B,EAAE0/B,IAAO1/B,EAAEmgC,IAAOngC,EAAE4/B,IAAO5/B,EAAEq/B,IAAOr/B,EAAE0/B,IAAO1/B,EAAEmgC,IAAOngC,EAAEo/B,IAAOp/B,EAAEy/B,IAAOz/B,EAAE8/B,IAAO9/B,EAAEmgC,IACrGngC,EAAEw/B,IAAOx/B,EAAEq/B,IAAOr/B,EAAE8/B,IAAO9/B,EAAEmgC,IAAOngC,EAAE4/B,IAAO5/B,EAAEy/B,IAAOz/B,EAAEs/B,IAAOt/B,EAAEmgC,IAAOngC,EAAEw/B,IAAOx/B,EAAE6/B,IAAO7/B,EAAEs/B,IAAOt/B,EAAEmgC,IACrGngC,EAAEggC,IAAOhgC,EAAE6/B,IAAO7/B,EAAE0/B,IAAO1/B,EAAEu/B,IAAOv/B,EAAE4/B,IAAO5/B,EAAEigC,IAAOjgC,EAAE0/B,IAAO1/B,EAAEu/B,IAAOv/B,EAAEggC,IAAOhgC,EAAEy/B,IAAOz/B,EAAE8/B,IAAO9/B,EAAEu/B,IACrGv/B,EAAEw/B,IAAOx/B,EAAEigC,IAAOjgC,EAAE8/B,IAAO9/B,EAAEu/B,IAAOv/B,EAAE4/B,IAAO5/B,EAAEy/B,IAAOz/B,EAAEkgC,IAAOlgC,EAAEu/B,IAAOv/B,EAAEw/B,IAAOx/B,EAAE6/B,IAAO7/B,EAAEkgC,IAAOlgC,EAAEu/B,IACxG,GAAa,GAAToB,EAAY,MAAM,IAAI5hC,MAAM,yBAChC,IAAI6hC,EAAU,EAAMD,EAiDpB,OAhDAF,EAAEjB,IAAOx/B,EAAE8/B,IAAO9/B,EAAEmgC,IAAOngC,EAAEq/B,IAAOr/B,EAAE+/B,IAAO//B,EAAEkgC,IAAOlgC,EAAEq/B,IAAOr/B,EAAE+/B,IAAO//B,EAAEigC,IAAOjgC,EAAEs/B,IAChFt/B,EAAE6/B,IAAO7/B,EAAEmgC,IAAOngC,EAAEs/B,IAAOt/B,EAAE8/B,IAAO9/B,EAAEigC,IAAOjgC,EAAEu/B,IAAOv/B,EAAE6/B,IAAO7/B,EAAEkgC,IAAOlgC,EAAEu/B,IAC7EkB,EAAEhB,IAAOz/B,EAAE2/B,IAAO3/B,EAAEkgC,IAAOlgC,EAAEq/B,IAAOr/B,EAAE0/B,IAAO1/B,EAAEmgC,IAAOngC,EAAEq/B,IAAOr/B,EAAE2/B,IAAO3/B,EAAEigC,IAAOjgC,EAAEs/B,IAChFt/B,EAAEy/B,IAAOz/B,EAAEmgC,IAAOngC,EAAEs/B,IAAOt/B,EAAE0/B,IAAO1/B,EAAEigC,IAAOjgC,EAAEu/B,IAAOv/B,EAAEy/B,IAAOz/B,EAAEkgC,IAAOlgC,EAAEu/B,IAC7EkB,EAAEf,IAAO1/B,EAAE0/B,IAAO1/B,EAAE+/B,IAAO//B,EAAEq/B,IAAOr/B,EAAE2/B,IAAO3/B,EAAE8/B,IAAO9/B,EAAEq/B,IAAOr/B,EAAE2/B,IAAO3/B,EAAE6/B,IAAO7/B,EAAEs/B,IAChFt/B,EAAEy/B,IAAOz/B,EAAE+/B,IAAO//B,EAAEs/B,IAAOt/B,EAAE0/B,IAAO1/B,EAAE6/B,IAAO7/B,EAAEu/B,IAAOv/B,EAAEy/B,IAAOz/B,EAAE8/B,IAAO9/B,EAAEu/B,IAC7EkB,EAAEd,IAAO3/B,EAAE2/B,IAAO3/B,EAAE8/B,IAAO9/B,EAAEigC,IAAOjgC,EAAE0/B,IAAO1/B,EAAE+/B,IAAO//B,EAAEigC,IAAOjgC,EAAE2/B,IAAO3/B,EAAE6/B,IAAO7/B,EAAEkgC,IAChFlgC,EAAEy/B,IAAOz/B,EAAE+/B,IAAO//B,EAAEkgC,IAAOlgC,EAAE0/B,IAAO1/B,EAAE6/B,IAAO7/B,EAAEmgC,IAAOngC,EAAEy/B,IAAOz/B,EAAE8/B,IAAO9/B,EAAEmgC,IAC7EM,EAAEb,IAAO5/B,EAAE+/B,IAAO//B,EAAEkgC,IAAOlgC,EAAEo/B,IAAOp/B,EAAE8/B,IAAO9/B,EAAEmgC,IAAOngC,EAAEo/B,IAAOp/B,EAAE+/B,IAAO//B,EAAEggC,IAAOhgC,EAAEs/B,IAChFt/B,EAAE4/B,IAAO5/B,EAAEmgC,IAAOngC,EAAEs/B,IAAOt/B,EAAE8/B,IAAO9/B,EAAEggC,IAAOhgC,EAAEu/B,IAAOv/B,EAAE4/B,IAAO5/B,EAAEkgC,IAAOlgC,EAAEu/B,IAC7EkB,EAAEZ,IAAO7/B,EAAE0/B,IAAO1/B,EAAEmgC,IAAOngC,EAAEo/B,IAAOp/B,EAAE2/B,IAAO3/B,EAAEkgC,IAAOlgC,EAAEo/B,IAAOp/B,EAAE2/B,IAAO3/B,EAAEggC,IAAOhgC,EAAEs/B,IAChFt/B,EAAEw/B,IAAOx/B,EAAEmgC,IAAOngC,EAAEs/B,IAAOt/B,EAAE0/B,IAAO1/B,EAAEggC,IAAOhgC,EAAEu/B,IAAOv/B,EAAEw/B,IAAOx/B,EAAEkgC,IAAOlgC,EAAEu/B,IAC7EkB,EAAEX,IAAO9/B,EAAE2/B,IAAO3/B,EAAE8/B,IAAO9/B,EAAEo/B,IAAOp/B,EAAE0/B,IAAO1/B,EAAE+/B,IAAO//B,EAAEo/B,IAAOp/B,EAAE2/B,IAAO3/B,EAAE4/B,IAAO5/B,EAAEs/B,IAChFt/B,EAAEw/B,IAAOx/B,EAAE+/B,IAAO//B,EAAEs/B,IAAOt/B,EAAE0/B,IAAO1/B,EAAE4/B,IAAO5/B,EAAEu/B,IAAOv/B,EAAEw/B,IAAOx/B,EAAE8/B,IAAO9/B,EAAEu/B,IAC7EkB,EAAEV,IAAO//B,EAAE0/B,IAAO1/B,EAAE+/B,IAAO//B,EAAEggC,IAAOhgC,EAAE2/B,IAAO3/B,EAAE8/B,IAAO9/B,EAAEggC,IAAOhgC,EAAE2/B,IAAO3/B,EAAE4/B,IAAO5/B,EAAEkgC,IAChFlgC,EAAEw/B,IAAOx/B,EAAE+/B,IAAO//B,EAAEkgC,IAAOlgC,EAAE0/B,IAAO1/B,EAAE4/B,IAAO5/B,EAAEmgC,IAAOngC,EAAEw/B,IAAOx/B,EAAE8/B,IAAO9/B,EAAEmgC,IAC7EM,EAAET,IAAOhgC,EAAE6/B,IAAO7/B,EAAEmgC,IAAOngC,EAAEo/B,IAAOp/B,EAAE+/B,IAAO//B,EAAEigC,IAAOjgC,EAAEo/B,IAAOp/B,EAAE+/B,IAAO//B,EAAEggC,IAAOhgC,EAAEq/B,IAChFr/B,EAAE4/B,IAAO5/B,EAAEmgC,IAAOngC,EAAEq/B,IAAOr/B,EAAE6/B,IAAO7/B,EAAEggC,IAAOhgC,EAAEu/B,IAAOv/B,EAAE4/B,IAAO5/B,EAAEigC,IAAOjgC,EAAEu/B,IAC7EkB,EAAER,IAAOjgC,EAAE2/B,IAAO3/B,EAAEigC,IAAOjgC,EAAEo/B,IAAOp/B,EAAEy/B,IAAOz/B,EAAEmgC,IAAOngC,EAAEo/B,IAAOp/B,EAAE2/B,IAAO3/B,EAAEggC,IAAOhgC,EAAEq/B,IAChFr/B,EAAEw/B,IAAOx/B,EAAEmgC,IAAOngC,EAAEq/B,IAAOr/B,EAAEy/B,IAAOz/B,EAAEggC,IAAOhgC,EAAEu/B,IAAOv/B,EAAEw/B,IAAOx/B,EAAEigC,IAAOjgC,EAAEu/B,IAC7EkB,EAAEP,IAAOlgC,EAAEy/B,IAAOz/B,EAAE+/B,IAAO//B,EAAEo/B,IAAOp/B,EAAE2/B,IAAO3/B,EAAE6/B,IAAO7/B,EAAEo/B,IAAOp/B,EAAE2/B,IAAO3/B,EAAE4/B,IAAO5/B,EAAEq/B,IAChFr/B,EAAEw/B,IAAOx/B,EAAE+/B,IAAO//B,EAAEq/B,IAAOr/B,EAAEy/B,IAAOz/B,EAAE4/B,IAAO5/B,EAAEu/B,IAAOv/B,EAAEw/B,IAAOx/B,EAAE6/B,IAAO7/B,EAAEu/B,IAC7EkB,EAAEN,IAAOngC,EAAE2/B,IAAO3/B,EAAE6/B,IAAO7/B,EAAEggC,IAAOhgC,EAAEy/B,IAAOz/B,EAAE+/B,IAAO//B,EAAEggC,IAAOhgC,EAAE2/B,IAAO3/B,EAAE4/B,IAAO5/B,EAAEigC,IAChFjgC,EAAEw/B,IAAOx/B,EAAE+/B,IAAO//B,EAAEigC,IAAOjgC,EAAEy/B,IAAOz/B,EAAE4/B,IAAO5/B,EAAEmgC,IAAOngC,EAAEw/B,IAAOx/B,EAAE6/B,IAAO7/B,EAAEmgC,IAC7EM,EAAErB,IAAOp/B,EAAE8/B,IAAO9/B,EAAEigC,IAAOjgC,EAAEo/B,IAAOp/B,EAAE6/B,IAAO7/B,EAAEkgC,IAAOlgC,EAAEo/B,IAAOp/B,EAAE8/B,IAAO9/B,EAAEggC,IAAOhgC,EAAEq/B,IAChFr/B,EAAE4/B,IAAO5/B,EAAEkgC,IAAOlgC,EAAEq/B,IAAOr/B,EAAE6/B,IAAO7/B,EAAEggC,IAAOhgC,EAAEs/B,IAAOt/B,EAAE4/B,IAAO5/B,EAAEigC,IAAOjgC,EAAEs/B,IAC7EmB,EAAEpB,IAAOr/B,EAAEy/B,IAAOz/B,EAAEkgC,IAAOlgC,EAAEo/B,IAAOp/B,EAAE0/B,IAAO1/B,EAAEigC,IAAOjgC,EAAEo/B,IAAOp/B,EAAE0/B,IAAO1/B,EAAEggC,IAAOhgC,EAAEq/B,IAChFr/B,EAAEw/B,IAAOx/B,EAAEkgC,IAAOlgC,EAAEq/B,IAAOr/B,EAAEy/B,IAAOz/B,EAAEggC,IAAOhgC,EAAEs/B,IAAOt/B,EAAEw/B,IAAOx/B,EAAEigC,IAAOjgC,EAAEs/B,IAC7EmB,EAAEnB,IAAOt/B,EAAE0/B,IAAO1/B,EAAE6/B,IAAO7/B,EAAEo/B,IAAOp/B,EAAEy/B,IAAOz/B,EAAE8/B,IAAO9/B,EAAEo/B,IAAOp/B,EAAE0/B,IAAO1/B,EAAE4/B,IAAO5/B,EAAEq/B,IAChFr/B,EAAEw/B,IAAOx/B,EAAE8/B,IAAO9/B,EAAEq/B,IAAOr/B,EAAEy/B,IAAOz/B,EAAE4/B,IAAO5/B,EAAEs/B,IAAOt/B,EAAEw/B,IAAOx/B,EAAE6/B,IAAO7/B,EAAEs/B,IAC7EmB,EAAElB,IAAOv/B,EAAEy/B,IAAOz/B,EAAE8/B,IAAO9/B,EAAEggC,IAAOhgC,EAAE0/B,IAAO1/B,EAAE6/B,IAAO7/B,EAAEggC,IAAOhgC,EAAE0/B,IAAO1/B,EAAE4/B,IAAO5/B,EAAEigC,IAChFjgC,EAAEw/B,IAAOx/B,EAAE8/B,IAAO9/B,EAAEigC,IAAOjgC,EAAEy/B,IAAOz/B,EAAE4/B,IAAO5/B,EAAEkgC,IAAOlgC,EAAEw/B,IAAOx/B,EAAE6/B,IAAO7/B,EAAEkgC,IAC7ElgC,EAAEw/B,IAAOiB,EAAEjB,IAAOoB,EAClB5gC,EAAEy/B,IAAOgB,EAAEhB,IAAOmB,EAClB5gC,EAAE0/B,IAAOe,EAAEf,IAAOkB,EAClB5gC,EAAE2/B,IAAOc,EAAEd,IAAOiB,EAClB5gC,EAAE4/B,IAAOa,EAAEb,IAAOgB,EAClB5gC,EAAE6/B,IAAOY,EAAEZ,IAAOe,EAClB5gC,EAAE8/B,IAAOW,EAAEX,IAAOc,EAClB5gC,EAAE+/B,IAAOU,EAAEV,IAAOa,EAClB5gC,EAAEggC,IAAOS,EAAET,IAAOY,EAClB5gC,EAAEigC,IAAOQ,EAAER,IAAOW,EAClB5gC,EAAEkgC,IAAOO,EAAEP,IAAOU,EAClB5gC,EAAEmgC,IAAOM,EAAEN,IAAOS,EAClB5gC,EAAEo/B,IAAOqB,EAAErB,IAAOwB,EAClB5gC,EAAEq/B,IAAOoB,EAAEpB,IAAOuB,EAClB5gC,EAAEs/B,IAAOmB,EAAEnB,IAAOsB,EAClB5gC,EAAEu/B,IAAOkB,EAAElB,IAAOqB,EACX1iC,IACR,CAEA,WAAA2iC,GACC,IAAI7gC,EAAI9B,KAAKuuB,OACb,OAAOzsB,EAAEo/B,IAAOp/B,EAAEigC,IAAOjgC,EAAE8/B,IAAO9/B,EAAE2/B,IAAO3/B,EAAEggC,IAAOhgC,EAAEq/B,IAAOr/B,EAAE8/B,IAAO9/B,EAAE2/B,IAAO3/B,EAAEo/B,IAAOp/B,EAAE6/B,IAAO7/B,EAAEkgC,IAAOlgC,EAAE2/B,IACzG3/B,EAAE4/B,IAAO5/B,EAAEq/B,IAAOr/B,EAAEkgC,IAAOlgC,EAAE2/B,IAAO3/B,EAAEggC,IAAOhgC,EAAE6/B,IAAO7/B,EAAEs/B,IAAOt/B,EAAE2/B,IAAO3/B,EAAE4/B,IAAO5/B,EAAEigC,IAAOjgC,EAAEs/B,IAAOt/B,EAAE2/B,IACrG3/B,EAAEo/B,IAAOp/B,EAAEigC,IAAOjgC,EAAE0/B,IAAO1/B,EAAE+/B,IAAO//B,EAAEggC,IAAOhgC,EAAEq/B,IAAOr/B,EAAE0/B,IAAO1/B,EAAE+/B,IAAO//B,EAAEo/B,IAAOp/B,EAAEy/B,IAAOz/B,EAAEkgC,IAAOlgC,EAAE+/B,IACrG//B,EAAEw/B,IAAOx/B,EAAEq/B,IAAOr/B,EAAEkgC,IAAOlgC,EAAE+/B,IAAO//B,EAAEggC,IAAOhgC,EAAEy/B,IAAOz/B,EAAEs/B,IAAOt/B,EAAE+/B,IAAO//B,EAAEw/B,IAAOx/B,EAAEigC,IAAOjgC,EAAEs/B,IAAOt/B,EAAE+/B,IACrG//B,EAAEo/B,IAAOp/B,EAAE6/B,IAAO7/B,EAAE0/B,IAAO1/B,EAAEmgC,IAAOngC,EAAE4/B,IAAO5/B,EAAEq/B,IAAOr/B,EAAE0/B,IAAO1/B,EAAEmgC,IAAOngC,EAAEo/B,IAAOp/B,EAAEy/B,IAAOz/B,EAAE8/B,IAAO9/B,EAAEmgC,IACrGngC,EAAEw/B,IAAOx/B,EAAEq/B,IAAOr/B,EAAE8/B,IAAO9/B,EAAEmgC,IAAOngC,EAAE4/B,IAAO5/B,EAAEy/B,IAAOz/B,EAAEs/B,IAAOt/B,EAAEmgC,IAAOngC,EAAEw/B,IAAOx/B,EAAE6/B,IAAO7/B,EAAEs/B,IAAOt/B,EAAEmgC,IACrGngC,EAAEggC,IAAOhgC,EAAE6/B,IAAO7/B,EAAE0/B,IAAO1/B,EAAEu/B,IAAOv/B,EAAE4/B,IAAO5/B,EAAEigC,IAAOjgC,EAAE0/B,IAAO1/B,EAAEu/B,IAAOv/B,EAAEggC,IAAOhgC,EAAEy/B,IAAOz/B,EAAE8/B,IAAO9/B,EAAEu/B,IACrGv/B,EAAEw/B,IAAOx/B,EAAEigC,IAAOjgC,EAAE8/B,IAAO9/B,EAAEu/B,IAAOv/B,EAAE4/B,IAAO5/B,EAAEy/B,IAAOz/B,EAAEkgC,IAAOlgC,EAAEu/B,IAAOv/B,EAAEw/B,IAAOx/B,EAAE6/B,IAAO7/B,EAAEkgC,IAAOlgC,EAAEu/B,GACzG,CAEA,SAAA3Q,CAAWlsB,EAAWE,EAAWi8B,GAChC,IAAI7+B,EAAI9B,KAAKuuB,OAIb,OAHAzsB,EAAE2/B,KAAQj9B,EACV1C,EAAE+/B,KAAQn9B,EACV5C,EAAEmgC,KAAQtB,EACH3gC,IACR,CAEA,IAAAiX,GACC,OAAO,IAAIorB,IAAU7yB,IAAIxP,KAAKuuB,OAC/B,CAEA,UAAAqU,CAAYC,EAAeC,EAAcC,EAAcC,GACtDhjC,KAAKkT,WACL,IAAI+vB,EAAWF,GAAQp+B,KAAKwL,GAAK,KAG7B+yB,EAAML,GADK,EADDl+B,KAAKw+B,IAAIF,EAAW,IAG9BG,EAAQF,EAAMF,EAEdlhC,EAAI9B,KAAKuuB,OAuCb,OAtCAzsB,EAAEw/B,IAAOuB,EAAQO,EACjBthC,EAAE4/B,IAAO,EACT5/B,EAAEggC,IAAO,EACThgC,EAAEo/B,IAAO,EACTp/B,EAAEy/B,IAAO,EACTz/B,EAAE6/B,IAAOkB,EAAQK,EACjBphC,EAAEigC,IAAO,EACTjgC,EAAEq/B,IAAO,EACTr/B,EAAE0/B,IAAO,EACT1/B,EAAE8/B,IAAO,EACT9/B,EAAEkgC,MAASc,EAAMD,IAAUC,EAAOD,GAClC/gC,EAAEs/B,KAAQ,EACVt/B,EAAE2/B,IAAO,EACT3/B,EAAE+/B,IAAO,EACT//B,EAAEmgC,KAAS,EAAEa,EAAKD,GAAUC,EAAOD,GACnC/gC,EAAEu/B,IAAO,EAuBFrhC,IACR,CAEA,OAAAqjC,CAAS7+B,EAAWE,EAAWzC,EAAeC,GAC7C,OAAOlC,KAAKsjC,MAAM9+B,EAAGA,EAAIvC,EAAOyC,EAAGA,EAAIxC,EAAQ,EAAG,EACnD,CAEA,KAAAohC,CAAOC,EAAcH,EAAeI,EAAgBN,EAAaO,EAAcC,GAC9E1jC,KAAKkT,WACL,IAAIywB,EAAS,GAAKP,EAAQG,GACtBK,EAAS,GAAKV,EAAMM,GACpBK,GAAU,GAAKH,EAAMD,GAErB/iB,IAAO0iB,EAAQG,IAASH,EAAQG,GAChC5iB,IAAOuiB,EAAMM,IAAWN,EAAMM,GAC9BM,IAAOJ,EAAMD,IAASC,EAAMD,GAE5B3hC,EAAI9B,KAAKuuB,OAiBb,OAhBAzsB,EAAEw/B,IAAOqC,EACT7hC,EAAE4/B,IAAO,EACT5/B,EAAEggC,IAAO,EACThgC,EAAEo/B,IAAO,EACTp/B,EAAEy/B,IAAO,EACTz/B,EAAE6/B,IAAOiC,EACT9hC,EAAEigC,IAAO,EACTjgC,EAAEq/B,IAAO,EACTr/B,EAAE0/B,IAAO,EACT1/B,EAAE8/B,IAAO,EACT9/B,EAAEkgC,IAAO6B,EACT/hC,EAAEs/B,IAAO,EACTt/B,EAAE2/B,IAAO/gB,EACT5e,EAAE+/B,IAAOlhB,EACT7e,EAAEmgC,IAAO6B,EACThiC,EAAEu/B,IAAO,EACFrhC,IACR,CAEA,QAAA+gC,CAAUC,GACT,IAAIuB,EAAIviC,KAAK4nB,KACT9lB,EAAI9B,KAAKuuB,OACTwV,EAAI/C,EAAOzS,OAiBf,OAhBAgU,EAAEjB,IAAOx/B,EAAEw/B,IAAOyC,EAAEzC,IAAOx/B,EAAEy/B,IAAOwC,EAAErC,IAAO5/B,EAAE0/B,IAAOuC,EAAEjC,IAAOhgC,EAAE2/B,IAAOsC,EAAE7C,IAC1EqB,EAAEhB,IAAOz/B,EAAEw/B,IAAOyC,EAAExC,IAAOz/B,EAAEy/B,IAAOwC,EAAEpC,IAAO7/B,EAAE0/B,IAAOuC,EAAEhC,IAAOjgC,EAAE2/B,IAAOsC,EAAE5C,IAC1EoB,EAAEf,IAAO1/B,EAAEw/B,IAAOyC,EAAEvC,IAAO1/B,EAAEy/B,IAAOwC,EAAEnC,IAAO9/B,EAAE0/B,IAAOuC,EAAE/B,IAAOlgC,EAAE2/B,IAAOsC,EAAE3C,IAC1EmB,EAAEd,IAAO3/B,EAAEw/B,IAAOyC,EAAEtC,IAAO3/B,EAAEy/B,IAAOwC,EAAElC,IAAO//B,EAAE0/B,IAAOuC,EAAE9B,IAAOngC,EAAE2/B,IAAOsC,EAAE1C,IAC1EkB,EAAEb,IAAO5/B,EAAE4/B,IAAOqC,EAAEzC,IAAOx/B,EAAE6/B,IAAOoC,EAAErC,IAAO5/B,EAAE8/B,IAAOmC,EAAEjC,IAAOhgC,EAAE+/B,IAAOkC,EAAE7C,IAC1EqB,EAAEZ,IAAO7/B,EAAE4/B,IAAOqC,EAAExC,IAAOz/B,EAAE6/B,IAAOoC,EAAEpC,IAAO7/B,EAAE8/B,IAAOmC,EAAEhC,IAAOjgC,EAAE+/B,IAAOkC,EAAE5C,IAC1EoB,EAAEX,IAAO9/B,EAAE4/B,IAAOqC,EAAEvC,IAAO1/B,EAAE6/B,IAAOoC,EAAEnC,IAAO9/B,EAAE8/B,IAAOmC,EAAE/B,IAAOlgC,EAAE+/B,IAAOkC,EAAE3C,IAC1EmB,EAAEV,IAAO//B,EAAE4/B,IAAOqC,EAAEtC,IAAO3/B,EAAE6/B,IAAOoC,EAAElC,IAAO//B,EAAE8/B,IAAOmC,EAAE9B,IAAOngC,EAAE+/B,IAAOkC,EAAE1C,IAC1EkB,EAAET,IAAOhgC,EAAEggC,IAAOiC,EAAEzC,IAAOx/B,EAAEigC,IAAOgC,EAAErC,IAAO5/B,EAAEkgC,IAAO+B,EAAEjC,IAAOhgC,EAAEmgC,IAAO8B,EAAE7C,IAC1EqB,EAAER,IAAOjgC,EAAEggC,IAAOiC,EAAExC,IAAOz/B,EAAEigC,IAAOgC,EAAEpC,IAAO7/B,EAAEkgC,IAAO+B,EAAEhC,IAAOjgC,EAAEmgC,IAAO8B,EAAE5C,IAC1EoB,EAAEP,IAAOlgC,EAAEggC,IAAOiC,EAAEvC,IAAO1/B,EAAEigC,IAAOgC,EAAEnC,IAAO9/B,EAAEkgC,IAAO+B,EAAE/B,IAAOlgC,EAAEmgC,IAAO8B,EAAE3C,IAC1EmB,EAAEN,IAAOngC,EAAEggC,IAAOiC,EAAEtC,IAAO3/B,EAAEigC,IAAOgC,EAAElC,IAAO//B,EAAEkgC,IAAO+B,EAAE9B,IAAOngC,EAAEmgC,IAAO8B,EAAE1C,IAC1EkB,EAAErB,IAAOp/B,EAAEo/B,IAAO6C,EAAEzC,IAAOx/B,EAAEq/B,IAAO4C,EAAErC,IAAO5/B,EAAEs/B,IAAO2C,EAAEjC,IAAOhgC,EAAEu/B,IAAO0C,EAAE7C,IAC1EqB,EAAEpB,IAAOr/B,EAAEo/B,IAAO6C,EAAExC,IAAOz/B,EAAEq/B,IAAO4C,EAAEpC,IAAO7/B,EAAEs/B,IAAO2C,EAAEhC,IAAOjgC,EAAEu/B,IAAO0C,EAAE5C,IAC1EoB,EAAEnB,IAAOt/B,EAAEo/B,IAAO6C,EAAEvC,IAAO1/B,EAAEq/B,IAAO4C,EAAEnC,IAAO9/B,EAAEs/B,IAAO2C,EAAE/B,IAAOlgC,EAAEu/B,IAAO0C,EAAE3C,IAC1EmB,EAAElB,IAAOv/B,EAAEo/B,IAAO6C,EAAEtC,IAAO3/B,EAAEq/B,IAAO4C,EAAElC,IAAO//B,EAAEs/B,IAAO2C,EAAE9B,IAAOngC,EAAEu/B,IAAO0C,EAAE1C,IACnErhC,KAAKwP,IAAIxP,KAAK4nB,KACtB,CAEA,YAAAoc,CAAchD,GACb,IAAIuB,EAAIviC,KAAK4nB,KACT9lB,EAAI9B,KAAKuuB,OACTwV,EAAI/C,EAAOzS,OAiBf,OAhBAgU,EAAEjB,IAAOyC,EAAEzC,IAAOx/B,EAAEw/B,IAAOyC,EAAExC,IAAOz/B,EAAE4/B,IAAOqC,EAAEvC,IAAO1/B,EAAEggC,IAAOiC,EAAEtC,IAAO3/B,EAAEo/B,IAC1EqB,EAAEhB,IAAOwC,EAAEzC,IAAOx/B,EAAEy/B,IAAOwC,EAAExC,IAAOz/B,EAAE6/B,IAAOoC,EAAEvC,IAAO1/B,EAAEigC,IAAOgC,EAAEtC,IAAO3/B,EAAEq/B,IAC1EoB,EAAEf,IAAOuC,EAAEzC,IAAOx/B,EAAE0/B,IAAOuC,EAAExC,IAAOz/B,EAAE8/B,IAAOmC,EAAEvC,IAAO1/B,EAAEkgC,IAAO+B,EAAEtC,IAAO3/B,EAAEs/B,IAC1EmB,EAAEd,IAAOsC,EAAEzC,IAAOx/B,EAAE2/B,IAAOsC,EAAExC,IAAOz/B,EAAE+/B,IAAOkC,EAAEvC,IAAO1/B,EAAEmgC,IAAO8B,EAAEtC,IAAO3/B,EAAEu/B,IAC1EkB,EAAEb,IAAOqC,EAAErC,IAAO5/B,EAAEw/B,IAAOyC,EAAEpC,IAAO7/B,EAAE4/B,IAAOqC,EAAEnC,IAAO9/B,EAAEggC,IAAOiC,EAAElC,IAAO//B,EAAEo/B,IAC1EqB,EAAEZ,IAAOoC,EAAErC,IAAO5/B,EAAEy/B,IAAOwC,EAAEpC,IAAO7/B,EAAE6/B,IAAOoC,EAAEnC,IAAO9/B,EAAEigC,IAAOgC,EAAElC,IAAO//B,EAAEq/B,IAC1EoB,EAAEX,IAAOmC,EAAErC,IAAO5/B,EAAE0/B,IAAOuC,EAAEpC,IAAO7/B,EAAE8/B,IAAOmC,EAAEnC,IAAO9/B,EAAEkgC,IAAO+B,EAAElC,IAAO//B,EAAEs/B,IAC1EmB,EAAEV,IAAOkC,EAAErC,IAAO5/B,EAAE2/B,IAAOsC,EAAEpC,IAAO7/B,EAAE+/B,IAAOkC,EAAEnC,IAAO9/B,EAAEmgC,IAAO8B,EAAElC,IAAO//B,EAAEu/B,IAC1EkB,EAAET,IAAOiC,EAAEjC,IAAOhgC,EAAEw/B,IAAOyC,EAAEhC,IAAOjgC,EAAE4/B,IAAOqC,EAAE/B,IAAOlgC,EAAEggC,IAAOiC,EAAE9B,IAAOngC,EAAEo/B,IAC1EqB,EAAER,IAAOgC,EAAEjC,IAAOhgC,EAAEy/B,IAAOwC,EAAEhC,IAAOjgC,EAAE6/B,IAAOoC,EAAE/B,IAAOlgC,EAAEigC,IAAOgC,EAAE9B,IAAOngC,EAAEq/B,IAC1EoB,EAAEP,IAAO+B,EAAEjC,IAAOhgC,EAAE0/B,IAAOuC,EAAEhC,IAAOjgC,EAAE8/B,IAAOmC,EAAE/B,IAAOlgC,EAAEkgC,IAAO+B,EAAE9B,IAAOngC,EAAEs/B,IAC1EmB,EAAEN,IAAO8B,EAAEjC,IAAOhgC,EAAE2/B,IAAOsC,EAAEhC,IAAOjgC,EAAE+/B,IAAOkC,EAAE/B,IAAOlgC,EAAEmgC,IAAO8B,EAAE9B,IAAOngC,EAAEu/B,IAC1EkB,EAAErB,IAAO6C,EAAE7C,IAAOp/B,EAAEw/B,IAAOyC,EAAE5C,IAAOr/B,EAAE4/B,IAAOqC,EAAE3C,IAAOt/B,EAAEggC,IAAOiC,EAAE1C,IAAOv/B,EAAEo/B,IAC1EqB,EAAEpB,IAAO4C,EAAE7C,IAAOp/B,EAAEy/B,IAAOwC,EAAE5C,IAAOr/B,EAAE6/B,IAAOoC,EAAE3C,IAAOt/B,EAAEigC,IAAOgC,EAAE1C,IAAOv/B,EAAEq/B,IAC1EoB,EAAEnB,IAAO2C,EAAE7C,IAAOp/B,EAAE0/B,IAAOuC,EAAE5C,IAAOr/B,EAAE8/B,IAAOmC,EAAE3C,IAAOt/B,EAAEkgC,IAAO+B,EAAE1C,IAAOv/B,EAAEs/B,IAC1EmB,EAAElB,IAAO0C,EAAE7C,IAAOp/B,EAAE2/B,IAAOsC,EAAE5C,IAAOr/B,EAAE+/B,IAAOkC,EAAE3C,IAAOt/B,EAAEmgC,IAAO8B,EAAE1C,IAAOv/B,EAAEu/B,IACnErhC,KAAKwP,IAAIxP,KAAK4nB,KACtB,CAEA,MAAAqc,CAAQrgB,EAAmB3e,EAAoBi/B,GAC9C7B,GAAQ8B,YACR,IAAIC,EAAQ/B,GAAQ+B,MAAOC,EAAQhC,GAAQgC,MAAOC,EAAQjC,GAAQiC,MAClEA,EAAM1D,QAAQ37B,GAAW8O,YACzBqwB,EAAMxD,QAAQ37B,GAAW8O,YACzBqwB,EAAMtD,MAAMoD,GAAInwB,YAChBswB,EAAMzD,QAAQwD,GAAOtD,MAAMwD,GAAOvwB,YAClC/T,KAAKkT,WACL,IAAIqxB,EAAMvkC,KAAKuuB,OAiBf,OAhBAgW,EAAIjD,IAAO8C,EAAM5/B,EACjB+/B,EAAIhD,IAAO6C,EAAM1/B,EACjB6/B,EAAI/C,IAAO4C,EAAMzD,EACjB4D,EAAI7C,IAAO2C,EAAM7/B,EACjB+/B,EAAI5C,IAAO0C,EAAM3/B,EACjB6/B,EAAI3C,IAAOyC,EAAM1D,EACjB4D,EAAIzC,KAAQwC,EAAM9/B,EAClB+/B,EAAIxC,KAAQuC,EAAM5/B,EAClB6/B,EAAIvC,KAAQsC,EAAM3D,EAElB0B,GAAQmC,UAAUtxB,WAClBmvB,GAAQmC,UAAUjW,OAAOkT,KAAQ7d,EAASpf,EAC1C69B,GAAQmC,UAAUjW,OAAOsT,KAAQje,EAASlf,EAC1C29B,GAAQmC,UAAUjW,OAAO0T,KAAQre,EAAS+c,EAC1C3gC,KAAK+gC,SAASsB,GAAQmC,WAEfxkC,IACR,CAEA,gBAAOmkC,GACgB,OAAlB9B,GAAQ+B,QAAgB/B,GAAQ+B,MAAQ,IAAI1D,IAC1B,OAAlB2B,GAAQgC,QAAgBhC,GAAQgC,MAAQ,IAAI3D,IAC1B,OAAlB2B,GAAQiC,QAAgBjC,GAAQiC,MAAQ,IAAI5D,GACjD,ECrTM,MAAM+D,GACZ7gB,SAAW,IAAI8c,GAAQ,EAAG,EAAG,GAC7Bz7B,UAAY,IAAIy7B,GAAQ,EAAG,GAAI,GAC/BwD,GAAK,IAAIxD,GAAQ,EAAG,EAAG,GACvB+C,KAAO,EACPC,IAAM,IACNgB,IAAM,EACNC,KAAO,EACPC,cAAgB,EAChBC,eAAiB,EACjBC,eAAiB,IAAIzC,GACrB0C,sBAAwB,IAAI1C,GAC5BO,WAAa,IAAIP,GACjB2C,KAAO,IAAI3C,GACX4C,gBAAiB,EAETC,IAAM,IAAIxE,GAElB,WAAA5gC,CAAa8kC,EAAuBC,GACnC7kC,KAAK4kC,cAAgBA,EACrB5kC,KAAK6kC,eAAiBA,EACtB7kC,KAAKyN,QACN,CAEA,MAAAA,GACC,IAAIm1B,EAAa5iC,KAAK4iC,WAClBoC,EAAOhlC,KAAKglC,KACZF,EAAiB9kC,KAAK8kC,eACtBC,EAAwB/kC,KAAK+kC,sBAC7BJ,EAAO3kC,KAAK2kC,KAAMC,EAAgB5kC,KAAK4kC,cAAeC,EAAiB7kC,KAAK6kC,eAChFjC,EAAWU,MAAMqB,IAASC,EAAgB,GAAID,GAAQC,EAAgB,GACjED,IAASE,EAAiB,GAAIF,GAAQE,EAAiB,GACvD7kC,KAAKyjC,KAAMzjC,KAAK0jC,KACrBsB,EAAKf,OAAOjkC,KAAK4jB,SAAU5jB,KAAKiF,UAAWjF,KAAKkkC,IAChDY,EAAet1B,IAAIozB,EAAWrU,QAC9BuW,EAAe/D,SAASiE,GACxBD,EAAsBv1B,IAAIs1B,EAAevW,QAAQiU,QAClD,CAEA,aAAA2C,CAAeC,EAAuBC,EAAqBC,GAC1D,IAAI9gC,EAAI4gC,EAAa5gC,EACjBE,EAAI0gC,EAAa1gC,EACjBi8B,EAAIyE,EAAazE,EACjBuE,EAAMllC,KAAKklC,IAOf,OANAA,EAAI1gC,EAAUA,EAAI6gC,EAAT,EAAyB,EAElCH,EAAIxgC,EAAUA,EAAI4gC,EAAT,EAA0B,EACnCJ,EAAIvE,EAAIA,EACRuE,EAAIhD,QAAQliC,KAAK+kC,uBACjBK,EAAa51B,IAAI01B,EAAI1gC,EAAG0gC,EAAIxgC,EAAGwgC,EAAIvE,GAC5ByE,CACR,CAEA,aAAAG,CAAcC,GACb,IAAIN,EAAM,IAAIxE,GACb8E,EAAYhhC,EACZghC,EAAY9gC,EACZ8gC,EAAY7E,GAMb,OAJAuE,EAAInE,SAAS/gC,KAAK8kC,gBAClBI,EAAI1gC,GAAM0gC,EAAI1gC,EAAI,GAAG,EAAMxE,KAAkB,cAE7CklC,EAAIxgC,GAAMwgC,EAAIxgC,EAAI,GAAG,EAAM1E,KAAmB,eACvC,IAAI0gC,GAAQwE,EAAI1gC,EAAG0gC,EAAIxgC,EAAG,EAClC,CAyBA,WAAA+gC,CAAYb,EAAuBC,GAClC7kC,KAAK4kC,cAAgBA,EACrB5kC,KAAK6kC,eAAiBA,CACvB,EAGM,MAAMa,GACZ9hB,SAAW,IAAI8c,GAAQ,EAAG,EAAG,GAC7Bz7B,UAAY,IAAIy7B,GAAQ,EAAG,GAAI,GAC/BwD,GAAK,IAAIxD,GAAQ,EAAG,EAAG,GACvB+C,KAAO,EACPC,IAAM,IACNiB,KAAO,EACPD,IAAM,GACNE,cAAgB,EAChBC,eAAiB,EACjBC,eAAiB,IAAIzC,GACrB0C,sBAAwB,IAAI1C,GAC5BO,WAAa,IAAIP,GACjB2C,KAAO,IAAI3C,GACX4C,gBAAiB,EAETC,IAAM,IAAIxE,GAElB,WAAA5gC,CAAa8kC,EAAuBC,GACnC7kC,KAAK4kC,cAAgBA,EACrB5kC,KAAK6kC,eAAiBA,EACtB7kC,KAAKyN,QACN,CAEA,MAAAA,CAAQk4B,GAAW,GAClB,IAAI/C,EAAa5iC,KAAK4iC,WAClBoC,EAAOhlC,KAAKglC,KACZF,EAAiB9kC,KAAK8kC,eACtBC,EAAwB/kC,KAAK+kC,sBAEjC,IACCnC,EAAWA,WACV5iC,KAAKyjC,KACLzjC,KAAK0jC,IACL1jC,KAAK0kC,IACL1kC,KAAK4kC,cAAgB5kC,KAAK6kC,gBAE3BG,EAAKf,OAAOjkC,KAAK4jB,SAAU5jB,KAAKiF,UAAWjF,KAAKkkC,IAChDY,EAAet1B,IAAIozB,EAAWrU,QAC9BuW,EAAe/D,SAASiE,GACxBD,EAAsBv1B,IAAIs1B,EAAevW,QAAQiU,QAClD,CAAE,MAAMh5B,GACP,GAAIm8B,EACH,MAAMn8B,CAER,CACD,CAEA,aAAA27B,CAAeC,EAAuBC,EAAqBC,GAC1D,IAAI9gC,EAAI4gC,EAAa5gC,EACjBE,EAAI0gC,EAAa1gC,EACjBi8B,EAAIyE,EAAazE,EACjBuE,EAAMllC,KAAKklC,IAOf,OANAA,EAAI1gC,EAAUA,EAAI6gC,EAAT,EAAyB,EAClCH,EAAIxgC,EAAUA,EAAI4gC,EAAT,EAA0B,EAEnCJ,EAAIvE,EAAIA,EACRuE,EAAIhD,QAAQliC,KAAK+kC,uBACjBK,EAAa51B,IAAI01B,EAAI1gC,EAAG0gC,EAAIxgC,EAAGwgC,EAAIvE,GAC5ByE,CACR,CAEA,aAAAG,CAAcC,GACb,IAAIN,EAAM,IAAIxE,GACb8E,EAAYhhC,EACZghC,EAAY9gC,EACZ8gC,EAAY7E,GAGbuE,EAAIhD,QAAQliC,KAAK8kC,gBACjBI,EAAI1gC,GAAM0gC,EAAI1gC,EAAI,GAAG,EAAMxE,KAAkB,cAC7CklC,EAAIxgC,GAAMwgC,EAAIxgC,EAAI,GAAG,EAAM1E,KAAmB,eAE9C,IAAI4lC,EAAO,IAAIlF,GAAQwE,EAAI1gC,EAAG0gC,EAAIxgC,EAAGwgC,EAAIvE,GAEzC,OADAiF,EAAIvvB,EAAI6uB,EAAI7uB,EACLuvB,CACR,CAEA,WAAAH,CAAYb,EAAuBC,GAClC7kC,KAAK4kC,cAAgBA,EACrB5kC,KAAK6kC,eAAiBA,CACvB,ECxMM,MAAMgB,GACZ5yB,QACA6yB,MAAQ,EACRC,MAAQ,EACRC,YAAa,EACbC,UAAmB,KACnBC,YAAc,IAAI/yB,GAAY,IACtB,IAAIgzB,GAAM,EAAG,EAAG,KAGhBC,UAAY,IAAIljC,MACxB,WAAApD,CAAamT,GACZjT,KAAKiT,QAAUA,EACfjT,KAAKqmC,eAAepzB,EACrB,CAEQ,cAAAozB,CAAepzB,GACtB,IAoBIqzB,EAAaz9B,IAChB,GAAIA,aAAc09B,WAAY,CAC7B,IAAIC,EAAOvzB,EAAQwzB,wBACfjiC,EAAIqE,EAAG69B,QAAUF,EAAKjD,KACtB7+B,EAAImE,EAAG89B,QAAUH,EAAKtD,IAEtBkD,EAAYpmC,KAAKomC,UACrB,IAAK,IAAIjhC,EAAI,EAAGA,EAAIihC,EAAUtiC,OAAQqB,IACjCnF,KAAKgmC,WACJI,EAAUjhC,GAAGyhC,SAASR,EAAUjhC,GAAGyhC,QAAQpiC,EAAGE,GAE9C0hC,EAAUjhC,GAAG0hC,OAAOT,EAAUjhC,GAAG0hC,MAAMriC,EAAGE,GAIhD1E,KAAK8lC,MAAQthC,EACbxE,KAAK+lC,MAAQrhC,CACd,GAGGoiC,EAAWj+B,IACd,GAAIA,aAAc09B,WAAY,CAC7B,IAAIC,EAAOvzB,EAAQwzB,wBACfjiC,EAAIqE,EAAG69B,QAAUF,EAAKjD,KACtB7+B,EAAImE,EAAG89B,QAAUH,EAAKtD,IAEtBkD,EAAYpmC,KAAKomC,UACrB,IAAK,IAAIjhC,EAAI,EAAGA,EAAIihC,EAAUtiC,OAAQqB,IACjCihC,EAAUjhC,GAAG++B,IAAIkC,EAAUjhC,GAAG++B,GAAG1/B,EAAGE,GAGzC1E,KAAK8lC,MAAQthC,EACbxE,KAAK+lC,MAAQrhC,EACb1E,KAAKgmC,YAAa,EAClB18B,SAASy9B,oBAAoB,YAAaT,GAC1Ch9B,SAASy9B,oBAAoB,UAAWD,EACzC,GAKD7zB,EAAQ3H,iBAAiB,aA7DRzC,IAChB,GAAIA,aAAc09B,WAAY,CAC7B,IAAIC,EAAOvzB,EAAQwzB,wBACfjiC,EAAIqE,EAAG69B,QAAUF,EAAKjD,KACtB7+B,EAAImE,EAAG89B,QAAUH,EAAKtD,IAEtBkD,EAAYpmC,KAAKomC,UACrB,IAAK,IAAIjhC,EAAI,EAAGA,EAAIihC,EAAUtiC,OAAQqB,IACjCihC,EAAUjhC,GAAG6hC,MAAMZ,EAAUjhC,GAAG6hC,KAAKxiC,EAAGE,GAG7C1E,KAAK8lC,MAAQthC,EACbxE,KAAK+lC,MAAQrhC,EACb1E,KAAKgmC,YAAa,EAElB18B,SAASgC,iBAAiB,YAAag7B,GACvCh9B,SAASgC,iBAAiB,UAAWw7B,EACtC,KA4CgD,GACjD7zB,EAAQ3H,iBAAiB,YAAag7B,GAAW,GACjDrzB,EAAQ3H,iBAAiB,UAAWw7B,GAAS,GAC7C7zB,EAAQ3H,iBAAiB,cAAezC,IACvC,GAAsB,MAAlB7I,KAAKimC,UAAmB,OAG5B,IADA,IAAIgB,EAAUp+B,EAAGq+B,eACR/hC,EAAI,EAAGA,EAAI8hC,EAAQnjC,OAAQqB,IAAK,CACxC,IAAIgiC,EAAQF,EAAQ9hC,GACpB,IAAIqhC,EAAOvzB,EAAQwzB,wBACfjiC,EAAI2iC,EAAMT,QAAUF,EAAKjD,KACzB7+B,EAAIyiC,EAAMR,QAAUH,EAAKtD,IAC7BljC,KAAKimC,UAAYjmC,KAAKkmC,YAAY5yB,SAClCtT,KAAKimC,UAAUmB,WAAaD,EAAMC,WAClCpnC,KAAKimC,UAAUzhC,EAAIA,EACnBxE,KAAKimC,UAAUvhC,EAAIA,EACnB,KACD,CAEA,IAAI0hC,EAAYpmC,KAAKomC,UACrB,IAAK,IAAIjhC,EAAI,EAAGA,EAAIihC,EAAUtiC,OAAQqB,IACjCihC,EAAUjhC,GAAG6hC,MAAMZ,EAAUjhC,GAAG6hC,KAAKhnC,KAAKimC,UAAUzhC,EAAGxE,KAAKimC,UAAUvhC,GAG3E1E,KAAK8lC,MAAQ9lC,KAAKimC,UAAUzhC,EAC5BxE,KAAK+lC,MAAQ/lC,KAAKimC,UAAUvhC,EAC5B1E,KAAKgmC,YAAa,EAClBn9B,EAAG0C,gBAAgB,IACjB,GACH0H,EAAQ3H,iBAAiB,YAAazC,IAErC,IADA,IAAIo+B,EAAUp+B,EAAGq+B,eACR/hC,EAAI,EAAGA,EAAI8hC,EAAQnjC,OAAQqB,IAAK,CACxC,IAAIgiC,EAAQF,EAAQ9hC,GACpB,GAAInF,KAAKimC,UAAUmB,aAAeD,EAAMC,WAAY,CACnD,IAAIZ,EAAOvzB,EAAQwzB,wBACfjiC,EAAIxE,KAAKimC,UAAUzhC,EAAI2iC,EAAMT,QAAUF,EAAKjD,KAC5C7+B,EAAI1E,KAAKimC,UAAUvhC,EAAIyiC,EAAMR,QAAUH,EAAKtD,IAChDljC,KAAKkmC,YAAY1yB,KAAKxT,KAAKimC,WAC3B,IAAIG,EAAYpmC,KAAKomC,UACrB,IAAK,IAAIjhC,EAAI,EAAGA,EAAIihC,EAAUtiC,OAAQqB,IACjCihC,EAAUjhC,GAAG++B,IAAIkC,EAAUjhC,GAAG++B,GAAG1/B,EAAGE,GAGzC1E,KAAK8lC,MAAQthC,EACbxE,KAAK+lC,MAAQrhC,EACb1E,KAAKgmC,YAAa,EAClBhmC,KAAKimC,UAAY,KACjB,KACD,CACD,CACAp9B,EAAG0C,gBAAgB,IACjB,GACH0H,EAAQ3H,iBAAiB,eAAgBzC,IAExC,IADA,IAAIo+B,EAAUp+B,EAAGq+B,eACR/hC,EAAI,EAAGA,EAAI8hC,EAAQnjC,OAAQqB,IAAK,CACxC,IAAIgiC,EAAQF,EAAQ9hC,GACpB,GAAInF,KAAKimC,UAAUmB,aAAeD,EAAMC,WAAY,CACnD,IAAIZ,EAAOvzB,EAAQwzB,wBACfjiC,EAAIxE,KAAKimC,UAAUzhC,EAAI2iC,EAAMT,QAAUF,EAAKjD,KAC5C7+B,EAAI1E,KAAKimC,UAAUvhC,EAAIyiC,EAAMR,QAAUH,EAAKtD,IAChDljC,KAAKkmC,YAAY1yB,KAAKxT,KAAKimC,WAC3B,IAAIG,EAAYpmC,KAAKomC,UACrB,IAAK,IAAIjhC,EAAI,EAAGA,EAAIihC,EAAUtiC,OAAQqB,IACjCihC,EAAUjhC,GAAG++B,IAAIkC,EAAUjhC,GAAG++B,GAAG1/B,EAAGE,GAGzC1E,KAAK8lC,MAAQthC,EACbxE,KAAK+lC,MAAQrhC,EACb1E,KAAKgmC,YAAa,EAClBhmC,KAAKimC,UAAY,KACjB,KACD,CACD,CACAp9B,EAAG0C,gBAAgB,IACjB,GACH0H,EAAQ3H,iBAAiB,aAAczC,IACtC,GAAsB,MAAlB7I,KAAKimC,UAAT,CAGA,IADA,IAAIgB,EAAUp+B,EAAGq+B,eACR/hC,EAAI,EAAGA,EAAI8hC,EAAQnjC,OAAQqB,IAAK,CACxC,IAAIgiC,EAAQF,EAAQ9hC,GACpB,GAAInF,KAAKimC,UAAUmB,aAAeD,EAAMC,WAAY,CACnD,IAAIZ,EAAOvzB,EAAQwzB,wBACfjiC,EAAI2iC,EAAMT,QAAUF,EAAKjD,KACzB7+B,EAAIyiC,EAAMR,QAAUH,EAAKtD,IAEzBkD,EAAYpmC,KAAKomC,UACrB,IAAK,IAAIjhC,EAAI,EAAGA,EAAIihC,EAAUtiC,OAAQqB,IACjCihC,EAAUjhC,GAAGyhC,SAASR,EAAUjhC,GAAGyhC,QAAQpiC,EAAGE,GAGnD1E,KAAK8lC,MAAQ9lC,KAAKimC,UAAUzhC,EAAIA,EAChCxE,KAAK+lC,MAAQ/lC,KAAKimC,UAAUvhC,EAAIA,EAChC,KACD,CACD,CACAmE,EAAG0C,gBApB+B,CAoBf,IACjB,EACJ,CAEA,WAAA87B,CAAYC,GACXtnC,KAAKomC,UAAUrhC,KAAKuiC,EACrB,CAEA,cAAAC,CAAeD,GACd,IAAIE,EAAMxnC,KAAKomC,UAAU7gC,QAAQ+hC,GAC7BE,GAAO,GACVxnC,KAAKomC,UAAUv6B,OAAO27B,EAAK,EAE7B,EAGM,MAAMrB,GACOiB,WAA2B5iC,EAAkBE,EAAhE,WAAA5E,CAAmBsnC,EAA2B5iC,EAAkBE,GAA7C,KAAA0iC,WAAAA,EAA2B,KAAA5iC,EAAAA,EAAkB,KAAAE,EAAAA,CAChE,EC/LM,MAAM+iC,GAwBwEC,aAA8BC,eAvB3G57B,kBAAoB,cACpBA,gBAAkB,aAClBA,aAAe,UACfA,cAAgB,WAChBA,iBAAmB,cACnBA,eAAiB,YAEhBc,QACA+6B,GAAkB,KAClBC,SACAC,GAAkB,KAClBC,SACAC,QAAwB,KACxBC,OAAuB,IAAIx1B,aAAa,GACxCy1B,OAAuB,IAAIz1B,aAAa,GACxC01B,OAAuB,IAAI11B,aAAa,IAEzC,UAAA21B,GAAgB,OAAOpoC,KAAKgoC,OAAS,CACrC,eAAAK,GAAqB,OAAOroC,KAAK0nC,YAAc,CAC/C,iBAAAY,GAAuB,OAAOtoC,KAAK2nC,cAAgB,CACnD,qBAAAY,GAA2B,OAAOvoC,KAAK6nC,QAAU,CACjD,iBAAAW,GAAuB,OAAOxoC,KAAK+nC,QAAU,CAEpD,WAAAjoC,CAAa+M,EAAuE66B,EAA8BC,GAA9B,KAAAD,aAAAA,EAA8B,KAAAC,eAAAA,EACjH3nC,KAAK6nC,SAAWH,EAChB1nC,KAAK+nC,SAAWJ,EAChB3nC,KAAK6M,QAAUA,aAAmBhC,EAA8BgC,EAAU,IAAIhC,EAA6BgC,GAC3G7M,KAAK6M,QAAQnB,cAAc1L,MAC3BA,KAAKyoC,SACN,CAEQ,OAAAA,GACP,IAAI19B,EAAK/K,KAAK6M,QAAQ9B,GACtB,IACC/K,KAAK4nC,GAAK5nC,KAAK0oC,cAAc39B,EAAG49B,cAAe3oC,KAAK0nC,cACpD1nC,KAAK8nC,GAAK9nC,KAAK0oC,cAAc39B,EAAG69B,gBAAiB5oC,KAAK2nC,gBACtD3nC,KAAKgoC,QAAUhoC,KAAK6oC,eAAe7oC,KAAK4nC,GAAI5nC,KAAK8nC,GAClD,CAAE,MAAOt+B,GAGR,MAFAxB,QAAQC,IAAI,2BAA4BuB,GACxCxJ,KAAK+C,UACCyG,CACP,CACD,CAEQ,aAAAk/B,CAAepZ,EAAc3d,GACpC,IAAI5G,EAAK/K,KAAK6M,QAAQ9B,GAClB+9B,EAAS/9B,EAAGg+B,aAAazZ,GAG7B,GAFAvkB,EAAGi+B,aAAaF,EAAQn3B,GACxB5G,EAAG29B,cAAcI,IACZ/9B,EAAGk+B,mBAAmBH,EAAQ/9B,EAAGm+B,gBAAiB,CACtD,IAAIxiC,EAAQ,4BAA8BqE,EAAGo+B,iBAAiBL,GAE9D,GADA/9B,EAAGq+B,aAAaN,IACX/9B,EAAGs+B,gBAAiB,MAAM,IAAIxoC,MAAM6F,EAC1C,CACA,OAAOoiC,CACR,CAEQ,cAAAD,CAAgBjB,EAAiBE,GACxC,IAAI/8B,EAAK/K,KAAK6M,QAAQ9B,GAClBi9B,EAAUj9B,EAAGu+B,gBAKjB,GAJAv+B,EAAGw+B,aAAavB,EAASJ,GACzB78B,EAAGw+B,aAAavB,EAASF,GACzB/8B,EAAGy+B,YAAYxB,IAEVj9B,EAAG0+B,oBAAoBzB,EAASj9B,EAAG2+B,aAAc,CACrD,IAAIhjC,EAAQ,oCAAsCqE,EAAG4+B,kBAAkB3B,GAEvE,GADAj9B,EAAG6+B,cAAc5B,IACZj9B,EAAGs+B,gBAAiB,MAAM,IAAIxoC,MAAM6F,EAC1C,CACA,OAAOshC,CACR,CAEA,OAAAv8B,GACCzL,KAAKyoC,SACN,CAEO,IAAAx7B,GACNjN,KAAK6M,QAAQ9B,GAAG8+B,WAAW7pC,KAAKgoC,QACjC,CAEO,MAAAv5B,GACNzO,KAAK6M,QAAQ9B,GAAG8+B,WAAW,KAC5B,CAEO,WAAAC,CAAa1pB,EAAiBrR,GACpC/O,KAAK6M,QAAQ9B,GAAGg/B,UAAU/pC,KAAKgqC,mBAAmB5pB,GAAUrR,EAC7D,CAEO,WAAAk7B,CAAa7pB,EAAiBrR,GACpC/O,KAAK6M,QAAQ9B,GAAGm/B,UAAUlqC,KAAKgqC,mBAAmB5pB,GAAUrR,EAC7D,CAEO,YAAAo7B,CAAc/pB,EAAiBrR,EAAeq7B,GACpDpqC,KAAK6M,QAAQ9B,GAAGs/B,UAAUrqC,KAAKgqC,mBAAmB5pB,GAAUrR,EAAOq7B,EACpE,CAEO,YAAAE,CAAclqB,EAAiBrR,EAAeq7B,EAAgBG,GACpEvqC,KAAK6M,QAAQ9B,GAAGy/B,UAAUxqC,KAAKgqC,mBAAmB5pB,GAAUrR,EAAOq7B,EAAQG,EAC5E,CAEO,YAAAE,CAAcrqB,EAAiBrR,EAAeq7B,EAAgBG,EAAgBG,GACpF1qC,KAAK6M,QAAQ9B,GAAG4/B,UAAU3qC,KAAKgqC,mBAAmB5pB,GAAUrR,EAAOq7B,EAAQG,EAAQG,EACpF,CAEO,cAAAE,CAAgBxqB,EAAiBrR,GACvC,IAAIhE,EAAK/K,KAAK6M,QAAQ9B,GACtB/K,KAAKioC,OAAOz4B,IAAIT,GAChBhE,EAAG8/B,iBAAiB7qC,KAAKgqC,mBAAmB5pB,IAAU,EAAOpgB,KAAKioC,OACnE,CAEO,cAAA6C,CAAgB1qB,EAAiBrR,GACvC,IAAIhE,EAAK/K,KAAK6M,QAAQ9B,GACtB/K,KAAKkoC,OAAO14B,IAAIT,GAChBhE,EAAGggC,iBAAiB/qC,KAAKgqC,mBAAmB5pB,IAAU,EAAOpgB,KAAKkoC,OACnE,CAEO,cAAA8C,CAAgB5qB,EAAiBrR,GACvC,IAAIhE,EAAK/K,KAAK6M,QAAQ9B,GACtB/K,KAAKmoC,OAAO34B,IAAIT,GAChBhE,EAAGkgC,iBAAiBjrC,KAAKgqC,mBAAmB5pB,IAAU,EAAOpgB,KAAKmoC,OACnE,CAEO,kBAAA6B,CAAoB5pB,GAC1B,IAAIrV,EAAK/K,KAAK6M,QAAQ9B,GAClBmgC,EAAWngC,EAAGi/B,mBAAmBhqC,KAAKgoC,QAAS5nB,GACnD,IAAK8qB,IAAangC,EAAGs+B,gBAAiB,MAAM,IAAIxoC,MAAM,sCAAsCuf,KAC5F,OAAO8qB,CACR,CAEO,oBAAAC,CAAsBC,GAC5B,IAAIrgC,EAAK/K,KAAK6M,QAAQ9B,GAClBmgC,EAAWngC,EAAGsgC,kBAAkBrrC,KAAKgoC,QAASoD,GAClD,IAAiB,GAAbF,IAAmBngC,EAAGs+B,gBAAiB,MAAM,IAAIxoC,MAAM,wCAAwCuqC,KACnG,OAAOF,CACR,CAEO,OAAAnoC,GACN/C,KAAK6M,QAAQjB,iBAAiB5L,MAE9B,IAAI+K,EAAK/K,KAAK6M,QAAQ9B,GAClB/K,KAAK4nC,KACR78B,EAAGq+B,aAAappC,KAAK4nC,IACrB5nC,KAAK4nC,GAAK,MAGP5nC,KAAK8nC,KACR/8B,EAAGq+B,aAAappC,KAAK8nC,IACrB9nC,KAAK8nC,GAAK,MAGP9nC,KAAKgoC,UACRj9B,EAAG6+B,cAAc5pC,KAAKgoC,SACtBhoC,KAAKgoC,QAAU,KAEjB,CAEO,yBAAOsD,CAAoBz+B,GACjC,IAAI+6B,EAAK,4BACSH,GAAO8D,qCACP9D,GAAO+D,kCACP/D,GAAOgE,oCACThE,GAAOiE,gIAKTjE,GAAO+D,mCACH/D,GAAOgE,uCACPhE,GAAOiE,gBAAgBjE,GAAO8D,+BAoBhD,OAAO,IAAI9D,GAAO56B,EAAS+6B,EAhBlB,kXAiBV,CAEO,4BAAO+D,CAAuB9+B,GACpC,IAAI+6B,EAAK,4BACSH,GAAO8D,qCACP9D,GAAO+D,kCACP/D,GAAOmE,mCACPnE,GAAOgE,oCACThE,GAAOiE,8JAMTjE,GAAO+D,8BACR/D,GAAOmE,oCACFnE,GAAOgE,uCACPhE,GAAOiE,gBAAgBjE,GAAO8D,+BAuBhD,OAAO,IAAI9D,GAAO56B,EAAS+6B,EAnBlB,8jBAoBV,CAEO,iBAAOiE,CAAYh/B,GACzB,IAAI+6B,EAAK,4BACSH,GAAO8D,qCACP9D,GAAO+D,gCACT/D,GAAOiE,6FAITjE,GAAO+D,mCACH/D,GAAOiE,gBAAgBjE,GAAO8D,+BAkBhD,OAAO,IAAI9D,GAAO56B,EAAS+6B,EAdlB,qQAeV,ECpQM,MAAMpN,GAuCwEsR,WAtC5Ej/B,QACAyI,SACAy2B,eACApmB,eAAiB,EACjBqmB,eAAgB,EAChBC,QACAC,cACAC,cAAgB,EAChBC,cAAe,EACfC,kBAAoB,EAE5B,aAAAC,GAAsC,OAAOtsC,KAAK8rC,UAAY,CAE9D,WAAAS,GAAyB,OAAOvsC,KAAKsV,SAASxR,OAAS9D,KAAKqsC,iBAAmB,CAC/E,WAAAG,GAAyB,OAAOxsC,KAAK2lB,eAAiB3lB,KAAKqsC,iBAAmB,CAC9E,iBAAAI,CAAmB3oC,GAClB9D,KAAKgsC,eAAgB,EACrBhsC,KAAK2lB,eAAiB7hB,CACvB,CACA,WAAA4oC,GAA+B,OAAO1sC,KAAKsV,QAAU,CAErD,UAAAq3B,GAAwB,OAAO3sC,KAAKisC,QAAQnoC,MAAQ,CACpD,UAAA8oC,GAAwB,OAAO5sC,KAAKmsC,aAAe,CACnD,gBAAAU,CAAkB/oC,GACjB9D,KAAKosC,cAAe,EACpBpsC,KAAKmsC,cAAgBroC,CACtB,CACA,UAAAgpC,GAA6B,OAAO9sC,KAAKisC,OAAQ,CAEjD,qBAAAc,GACC,IAAI76B,EAAO,EACX,IAAK,IAAI/M,EAAI,EAAGA,EAAInF,KAAK8rC,WAAWhoC,OAAQqB,IAE3C+M,GADgBlS,KAAK8rC,WAAW3mC,GACd4M,YAEnB,OAAOG,CACR,CAEA,WAAApS,CAAa+M,EAAuEi/B,EAA+BS,EAAqBI,GAApD,KAAAb,WAAAA,EACnF9rC,KAAK6M,QAAUA,aAAmBhC,EAA8BgC,EAAU,IAAIhC,EAA6BgC,GAC3G7M,KAAKqsC,kBAAoB,EACzB,IAAK,IAAIlnC,EAAI,EAAGA,EAAI2mC,EAAWhoC,OAAQqB,IACtCnF,KAAKqsC,mBAAqBP,EAAW3mC,GAAG4M,YAEzC/R,KAAKsV,SAAW,IAAI7C,aAAa85B,EAAcvsC,KAAKqsC,mBACpDrsC,KAAKisC,QAAU,IAAIe,YAAYL,GAC/B3sC,KAAK6M,QAAQnB,cAAc1L,KAC5B,CAEA,WAAAitC,CAAa33B,GAEZ,GADAtV,KAAKgsC,eAAgB,EACjB12B,EAASxR,OAAS9D,KAAKsV,SAASxR,OAAQ,MAAMjD,MAAM,8BAAgCb,KAAKusC,cAAgB,aAC7GvsC,KAAKsV,SAAS9F,IAAI8F,EAAU,GAC5BtV,KAAK2lB,eAAiBrQ,EAASxR,MAChC,CAEA,UAAAopC,CAAYjB,GAEX,GADAjsC,KAAKosC,cAAe,EAChBH,EAAQnoC,OAAS9D,KAAKisC,QAAQnoC,OAAQ,MAAMjD,MAAM,8BAAgCb,KAAK2sC,aAAe,YAC1G3sC,KAAKisC,QAAQz8B,IAAIy8B,EAAS,GAC1BjsC,KAAKmsC,cAAgBF,EAAQnoC,MAC9B,CAEA,IAAAqpC,CAAMrE,EAAgBsE,GACrBptC,KAAKqtC,eAAevE,EAAQsE,EAAe,EAAGptC,KAAKmsC,cAAgB,EAAGnsC,KAAKmsC,cAAensC,KAAK2lB,eAAiB3lB,KAAKqsC,kBACtH,CAEA,cAAAgB,CAAgBvE,EAAgBsE,EAAuBv3B,EAAgBzM,GACtE,IAAI2B,EAAK/K,KAAK6M,QAAQ9B,IAClB/K,KAAKgsC,eAAiBhsC,KAAKosC,eAAcpsC,KAAKyN,SAClDzN,KAAKiN,KAAK67B,GACN9oC,KAAKmsC,cAAgB,EACxBphC,EAAGuiC,aAAaF,EAAehkC,EAAO2B,EAAGwiC,eAAyB,EAAT13B,GAEzD9K,EAAGyiC,WAAWJ,EAAev3B,EAAQzM,GAEtCpJ,KAAKyO,OAAOq6B,EACb,CAEA,IAAA77B,CAAM67B,GACL,IAAI/9B,EAAK/K,KAAK6M,QAAQ9B,GACtBA,EAAG0iC,WAAW1iC,EAAG2iC,aAAc1tC,KAAK+rC,gBACpC,IAAIl2B,EAAS,EACb,IAAK,IAAI1Q,EAAI,EAAGA,EAAInF,KAAK8rC,WAAWhoC,OAAQqB,IAAK,CAChD,IAAIwoC,EAAS3tC,KAAK8rC,WAAW3mC,GACzB+lC,EAAWpC,EAAOqC,qBAAqBwC,EAAO1pC,MAClD8G,EAAG6iC,wBAAwB1C,GAC3BngC,EAAG8iC,oBAAoB3C,EAAUyC,EAAO57B,YAAahH,EAAG+iC,OAAO,EAAgC,EAAzB9tC,KAAKqsC,kBAAgC,EAATx2B,GAClGA,GAAU83B,EAAO57B,WAClB,CACI/R,KAAKmsC,cAAgB,GAAGphC,EAAG0iC,WAAW1iC,EAAGgjC,qBAAsB/tC,KAAKksC,cACzE,CAEA,MAAAz9B,CAAQq6B,GACP,IAAI/9B,EAAK/K,KAAK6M,QAAQ9B,GACtB,IAAK,IAAI5F,EAAI,EAAGA,EAAInF,KAAK8rC,WAAWhoC,OAAQqB,IAAK,CAChD,IAAIwoC,EAAS3tC,KAAK8rC,WAAW3mC,GACzB+lC,EAAWpC,EAAOqC,qBAAqBwC,EAAO1pC,MAClD8G,EAAGijC,yBAAyB9C,EAC7B,CACAngC,EAAG0iC,WAAW1iC,EAAG2iC,aAAc,MAC3B1tC,KAAKmsC,cAAgB,GAAGphC,EAAG0iC,WAAW1iC,EAAGgjC,qBAAsB,KACpE,CAEQ,MAAAtgC,GACP,IAAI1C,EAAK/K,KAAK6M,QAAQ9B,GAClB/K,KAAKgsC,gBACHhsC,KAAK+rC,iBACT/rC,KAAK+rC,eAAiBhhC,EAAGkjC,gBAE1BljC,EAAG0iC,WAAW1iC,EAAG2iC,aAAc1tC,KAAK+rC,gBACpChhC,EAAGmjC,WAAWnjC,EAAG2iC,aAAc1tC,KAAKsV,SAAS64B,SAAS,EAAGnuC,KAAK2lB,gBAAiB5a,EAAGqjC,cAClFpuC,KAAKgsC,eAAgB,GAGlBhsC,KAAKosC,eACHpsC,KAAKksC,gBACTlsC,KAAKksC,cAAgBnhC,EAAGkjC,gBAEzBljC,EAAG0iC,WAAW1iC,EAAGgjC,qBAAsB/tC,KAAKksC,eAC5CnhC,EAAGmjC,WAAWnjC,EAAGgjC,qBAAsB/tC,KAAKisC,QAAQkC,SAAS,EAAGnuC,KAAKmsC,eAAgBphC,EAAGqjC,cACxFpuC,KAAKosC,cAAe,EAEtB,CAEA,OAAA3gC,GACCzL,KAAK+rC,eAAiB,KACtB/rC,KAAKksC,cAAgB,KACrBlsC,KAAKyN,QACN,CAEA,OAAA1K,GACC/C,KAAK6M,QAAQjB,iBAAiB5L,MAC9B,IAAI+K,EAAK/K,KAAK6M,QAAQ9B,GACtBA,EAAGsjC,aAAaruC,KAAK+rC,gBACrBhhC,EAAGsjC,aAAaruC,KAAKksC,cACtB,EAGM,MAAMoC,GACQrqC,KAAqBqrB,KAAkCvd,YAA3E,WAAAjS,CAAoBmE,EAAqBqrB,EAAkCvd,GAAvD,KAAA9N,KAAAA,EAAqB,KAAAqrB,KAAAA,EAAkC,KAAAvd,YAAAA,CAAuB,EAG5F,MAAMw8B,WAA2BD,GACvC,WAAAxuC,GACCkN,MAAMy6B,GAAO8D,SAAUiD,GAAoBC,MAAO,EACnD,EASM,MAAMC,WAA0BJ,GACtC,WAAAxuC,CAAauO,EAAe,GAC3BrB,MAAMy6B,GAAOgE,WAAqB,GAARp9B,EAAW,GAAIA,GAAOmgC,GAAoBC,MAAO,EAC5E,EAGM,MAAME,WAAuBL,GACnC,WAAAxuC,GACCkN,MAAMy6B,GAAO+D,MAAOgD,GAAoBC,MAAO,EAChD,EAGM,MAAMG,WAAwBN,GACpC,WAAAxuC,GACCkN,MAAMy6B,GAAOmE,OAAQ4C,GAAoBC,MAAO,EACjD,EAGD,IAAYD,GCuIAK,GCoLAC,GC2lBAC,IHt5BZ,SAAYP,GACX,oBACA,CAFD,CAAYA,KAAAA,GAAmB,KI5KxB,MAAMQ,GACJniC,QACAoiC,UACAC,WAAY,EACZthB,KACAkb,OAAiB,KACjBqG,YAAyB,KACzBxpB,eAAiB,EACjBwmB,cAAgB,EAChBiD,SACAC,SAER,WAAAvvC,CAAa+M,EAA+DyiC,GAAwB,EAAM/C,EAAsB,OAC/H,GAAIA,EAAc,MAAO,MAAM,IAAI1rC,MAAM,mDAAqD0rC,GAC9FvsC,KAAK6M,QAAUA,aAAmBhC,EAA8BgC,EAAU,IAAIhC,EAA6BgC,GAC3G,IAAIi/B,EAAawD,EACf,CAAC,IAAIf,GAAsB,IAAII,GAAkB,IAAID,GAAqB,IAAIE,IAC9E,CAAC,IAAIL,GAAsB,IAAII,GAAkB,IAAID,IACvD1uC,KAAK4tB,KAAO,IAAI4M,GAAK3tB,EAASi/B,EAAYS,EAA2B,EAAdA,GACvDvsC,KAAKovC,SAAWpvC,KAAK6M,QAAQ9B,GAAG2B,UAChC1M,KAAKqvC,SAAWrvC,KAAK6M,QAAQ9B,GAAGoB,mBACjC,CAEA,KAAAojC,CAAOzG,GACN,IAAI/9B,EAAK/K,KAAK6M,QAAQ9B,GACtB,GAAI/K,KAAKkvC,UAAW,MAAM,IAAIruC,MAAM,gGACpCb,KAAKivC,UAAY,EACjBjvC,KAAK8oC,OAASA,EACd9oC,KAAKmvC,YAAc,KACnBnvC,KAAKkvC,WAAY,EAEjBnkC,EAAGykC,OAAOzkC,EAAG0kC,OACb1kC,EAAG2kC,UAAU1vC,KAAKovC,SAAUpvC,KAAKqvC,SAClC,CAEA,YAAAM,CAAcP,EAAkBC,GAC/B,IAAItkC,EAAK/K,KAAK6M,QAAQ9B,GACtB/K,KAAKovC,SAAWA,EAChBpvC,KAAKqvC,SAAWA,EACZrvC,KAAKkvC,YACRlvC,KAAK4vC,QACL7kC,EAAG2kC,UAAU1vC,KAAKovC,SAAUpvC,KAAKqvC,UAEnC,CAEA,IAAAlC,CAAMroC,EAAoBwQ,EAA6B22B,GAClDnnC,GAAW9E,KAAKmvC,aACnBnvC,KAAK4vC,QACL5vC,KAAKmvC,YAAcrqC,IACT9E,KAAK2lB,eAAiBrQ,EAASxR,OAAS9D,KAAK4tB,KAAK8e,cAAc5oC,QACzE9D,KAAKmsC,cAAgBF,EAAQnoC,OAAS9D,KAAK4tB,KAAKkf,aAAahpC,SAC9D9D,KAAK4vC,QAGN,IAAIC,EAAa7vC,KAAK4tB,KAAK4e,cAC3BxsC,KAAK4tB,KAAK8e,cAAcl9B,IAAI8F,EAAUtV,KAAK2lB,gBAC3C3lB,KAAK2lB,gBAAkBrQ,EAASxR,OAChC9D,KAAK4tB,KAAK6e,kBAAkBzsC,KAAK2lB,gBAEjC,IAAImqB,EAAe9vC,KAAK4tB,KAAKkf,aAC7B,IAAK,IAAI3nC,EAAInF,KAAKmsC,cAAen6B,EAAI,EAAGA,EAAIi6B,EAAQnoC,OAAQqB,IAAK6M,IAChE89B,EAAa3qC,GAAK8mC,EAAQj6B,GAAK69B,EAChC7vC,KAAKmsC,eAAiBF,EAAQnoC,OAC9B9D,KAAK4tB,KAAKif,iBAAiB7sC,KAAKmsC,cACjC,CAEQ,KAAAyD,GACP,IAAI7kC,EAAK/K,KAAK6M,QAAQ9B,GACK,GAAvB/K,KAAK2lB,iBAET3lB,KAAKmvC,YAAYliC,OACjBjN,KAAK4tB,KAAKuf,KAAKntC,KAAK8oC,OAAQ/9B,EAAGglC,WAE/B/vC,KAAK2lB,eAAiB,EACtB3lB,KAAKmsC,cAAgB,EACrBnsC,KAAK4tB,KAAK6e,kBAAkB,GAC5BzsC,KAAK4tB,KAAKif,iBAAiB,GAC3B7sC,KAAKivC,YACN,CAEA,GAAAxS,GACC,IAAI1xB,EAAK/K,KAAK6M,QAAQ9B,GACtB,IAAK/K,KAAKkvC,UAAW,MAAM,IAAIruC,MAAM,6FACjCb,KAAK2lB,eAAiB,GAAK3lB,KAAKmsC,cAAgB,IAAGnsC,KAAK4vC,QAC5D5vC,KAAK8oC,OAAS,KACd9oC,KAAKmvC,YAAc,KACnBnvC,KAAKkvC,WAAY,EAEjBnkC,EAAGilC,QAAQjlC,EAAG0kC,MACf,CAEA,YAAAQ,GAAkB,OAAOjwC,KAAKivC,SAAW,CAEzC,OAAAlsC,GACC/C,KAAK4tB,KAAK7qB,SACX,EHhGM,MAAMmtC,GACJrjC,QACAqiC,WAAY,EACZthB,KACAuiB,UAAYtB,GAAUuB,OACtBpgC,MAAQ,IAAIb,EAAM,EAAG,EAAG,EAAG,GAC3B25B,OACAuH,YAAc,EACdnL,IAAM,IAAItxB,EACVw7B,SACAC,SAER,WAAAvvC,CAAa+M,EAA+D0/B,EAAsB,OACjG,GAAIA,EAAc,MAAO,MAAM,IAAI1rC,MAAM,mDAAqD0rC,GAC9FvsC,KAAK6M,QAAUA,aAAmBhC,EAA8BgC,EAAU,IAAIhC,EAA6BgC,GAC3G7M,KAAK4tB,KAAO,IAAI4M,GAAK3tB,EAAS,CAAC,IAAI0hC,GAAsB,IAAII,IAAmBpC,EAAa,GAC7FvsC,KAAKovC,SAAWpvC,KAAK6M,QAAQ9B,GAAG2B,UAChC1M,KAAKqvC,SAAWrvC,KAAK6M,QAAQ9B,GAAGoB,mBACjC,CAEA,KAAAojC,CAAOzG,GACN,GAAI9oC,KAAKkvC,UAAW,MAAM,IAAIruC,MAAM,iDACpCb,KAAK8oC,OAASA,EACd9oC,KAAKqwC,YAAc,EACnBrwC,KAAKkvC,WAAY,EAEjB,IAAInkC,EAAK/K,KAAK6M,QAAQ9B,GACtBA,EAAGykC,OAAOzkC,EAAG0kC,OACb1kC,EAAG2kC,UAAU1vC,KAAKovC,SAAUpvC,KAAKqvC,SAClC,CAEA,YAAAM,CAAcP,EAAkBC,GAC/B,IAAItkC,EAAK/K,KAAK6M,QAAQ9B,GACtB/K,KAAKovC,SAAWA,EAChBpvC,KAAKqvC,SAAWA,EACZrvC,KAAKkvC,YACRlvC,KAAK4vC,QACL7kC,EAAG2kC,UAAU1vC,KAAKovC,SAAUpvC,KAAKqvC,UAEnC,CAEA,QAAAiB,CAAUtgC,GACThQ,KAAKgQ,MAAMN,aAAaM,EACzB,CAEA,YAAAugC,CAAcnhC,EAAWC,EAAWC,EAAWC,GAC9CvP,KAAKgQ,MAAMR,IAAIJ,EAAGC,EAAGC,EAAGC,EACzB,CAEA,KAAAkJ,CAAOjU,EAAWE,EAAWsL,EAAe,MAC3ChQ,KAAKwwC,MAAM3B,GAAUhU,MAAO,GACd,OAAV7qB,IAAgBA,EAAQhQ,KAAKgQ,OACjChQ,KAAKywC,OAAOjsC,EAAGE,EAAGsL,EACnB,CAEA,IAAArM,CAAMa,EAAWE,EAAWqiB,EAAYC,EAAYhX,EAAe,MAClEhQ,KAAKwwC,MAAM3B,GAAU6B,KAAM,GACZ1wC,KAAK4tB,KAAK8e,cACf1sC,KAAKqwC,YACD,OAAVrgC,IAAgBA,EAAQhQ,KAAKgQ,OACjChQ,KAAKywC,OAAOjsC,EAAGE,EAAGsL,GAClBhQ,KAAKywC,OAAO1pB,EAAIC,EAAIhX,EACrB,CAEA,QAAA2gC,CAAUC,EAAiBpsC,EAAWE,EAAWqiB,EAAYC,EAAY6pB,EAAYC,EAAY9gC,EAAe,KAAM+gC,EAAgB,KAAMC,EAAgB,MAC3JhxC,KAAKwwC,MAAMI,EAAS/B,GAAUuB,OAASvB,GAAU6B,KAAM,GACxC1wC,KAAK4tB,KAAK8e,cACf1sC,KAAKqwC,YACD,OAAVrgC,IAAgBA,EAAQhQ,KAAKgQ,OAClB,OAAX+gC,IAAiBA,EAAS/wC,KAAKgQ,OACpB,OAAXghC,IAAiBA,EAAShxC,KAAKgQ,OAC/B4gC,GACH5wC,KAAKywC,OAAOjsC,EAAGE,EAAGsL,GAClBhQ,KAAKywC,OAAO1pB,EAAIC,EAAI+pB,GACpB/wC,KAAKywC,OAAOI,EAAIC,EAAIE,KAEpBhxC,KAAKywC,OAAOjsC,EAAGE,EAAGsL,GAClBhQ,KAAKywC,OAAO1pB,EAAIC,EAAI+pB,GAEpB/wC,KAAKywC,OAAO1pB,EAAIC,EAAIhX,GACpBhQ,KAAKywC,OAAOI,EAAIC,EAAIC,GAEpB/wC,KAAKywC,OAAOI,EAAIC,EAAI9gC,GACpBhQ,KAAKywC,OAAOjsC,EAAGE,EAAGqsC,GAEpB,CAEA,IAAAE,CAAML,EAAiBpsC,EAAWE,EAAWqiB,EAAYC,EAAY6pB,EAAYC,EAAYI,EAAYC,EAAYnhC,EAAe,KAAM+gC,EAAgB,KAAMC,EAAgB,KAAMI,EAAgB,MACrMpxC,KAAKwwC,MAAMI,EAAS/B,GAAUuB,OAASvB,GAAU6B,KAAM,GACxC1wC,KAAK4tB,KAAK8e,cACf1sC,KAAKqwC,YACD,OAAVrgC,IAAgBA,EAAQhQ,KAAKgQ,OAClB,OAAX+gC,IAAiBA,EAAS/wC,KAAKgQ,OACpB,OAAXghC,IAAiBA,EAAShxC,KAAKgQ,OACpB,OAAXohC,IAAiBA,EAASpxC,KAAKgQ,OAC/B4gC,GACH5wC,KAAKywC,OAAOjsC,EAAGE,EAAGsL,GAAQhQ,KAAKywC,OAAO1pB,EAAIC,EAAI+pB,GAAS/wC,KAAKywC,OAAOI,EAAIC,EAAIE,GAC3EhxC,KAAKywC,OAAOI,EAAIC,EAAIE,GAAShxC,KAAKywC,OAAOS,EAAIC,EAAIC,GAASpxC,KAAKywC,OAAOjsC,EAAGE,EAAGsL,KAE5EhQ,KAAKywC,OAAOjsC,EAAGE,EAAGsL,GAAQhQ,KAAKywC,OAAO1pB,EAAIC,EAAI+pB,GAC9C/wC,KAAKywC,OAAO1pB,EAAIC,EAAI+pB,GAAS/wC,KAAKywC,OAAOI,EAAIC,EAAIE,GACjDhxC,KAAKywC,OAAOI,EAAIC,EAAIE,GAAShxC,KAAKywC,OAAOS,EAAIC,EAAIC,GACjDpxC,KAAKywC,OAAOS,EAAIC,EAAIC,GAASpxC,KAAKywC,OAAOjsC,EAAGE,EAAGsL,GAEjD,CAEA,IAAAw2B,CAAMoK,EAAiBpsC,EAAWE,EAAWzC,EAAeC,EAAgB8N,EAAe,MAC1FhQ,KAAKixC,KAAKL,EAAQpsC,EAAGE,EAAGF,EAAIvC,EAAOyC,EAAGF,EAAIvC,EAAOyC,EAAIxC,EAAQsC,EAAGE,EAAIxC,EAAQ8N,EAAOA,EAAOA,EAAOA,EAClG,CAEA,QAAAqhC,CAAUT,EAAiBnqB,EAAYC,EAAYK,EAAYC,EAAY/kB,EAAe+N,EAAe,MACxGhQ,KAAKwwC,MAAMI,EAAS/B,GAAUuB,OAASvB,GAAU6B,KAAM,GACzC,OAAV1gC,IAAgBA,EAAQhQ,KAAKgQ,OACjC,IAAIuyB,EAAIviC,KAAKklC,IAAI11B,IAAIwX,EAAKN,EAAID,EAAKM,GACnCwb,EAAExuB,YACF9R,GAAS,GACT,IAAIye,EAAK6hB,EAAE/9B,EAAIvC,EACX0e,EAAK4hB,EAAE79B,EAAIzC,EACV2uC,GAYJ5wC,KAAKywC,OAAOhqB,EAAK/F,EAAIgG,EAAK/F,EAAI3Q,GAC9BhQ,KAAKywC,OAAOhqB,EAAK/F,EAAIgG,EAAK/F,EAAI3Q,GAC9BhQ,KAAKywC,OAAO1pB,EAAKrG,EAAIsG,EAAKrG,EAAI3Q,GAE9BhQ,KAAKywC,OAAO1pB,EAAKrG,EAAIsG,EAAKrG,EAAI3Q,GAC9BhQ,KAAKywC,OAAO1pB,EAAKrG,EAAIsG,EAAKrG,EAAI3Q,GAC9BhQ,KAAKywC,OAAOhqB,EAAK/F,EAAIgG,EAAK/F,EAAI3Q,KAjB9BhQ,KAAKywC,OAAOhqB,EAAK/F,EAAIgG,EAAK/F,EAAI3Q,GAC9BhQ,KAAKywC,OAAOhqB,EAAK/F,EAAIgG,EAAK/F,EAAI3Q,GAC9BhQ,KAAKywC,OAAO1pB,EAAKrG,EAAIsG,EAAKrG,EAAI3Q,GAC9BhQ,KAAKywC,OAAO1pB,EAAKrG,EAAIsG,EAAKrG,EAAI3Q,GAE9BhQ,KAAKywC,OAAO1pB,EAAKrG,EAAIsG,EAAKrG,EAAI3Q,GAC9BhQ,KAAKywC,OAAOhqB,EAAK/F,EAAIgG,EAAK/F,EAAI3Q,GAE9BhQ,KAAKywC,OAAO1pB,EAAKrG,EAAIsG,EAAKrG,EAAI3Q,GAC9BhQ,KAAKywC,OAAOhqB,EAAK/F,EAAIgG,EAAK/F,EAAI3Q,GAUhC,CAEA,CAAAxL,CAAGA,EAAWE,EAAWwN,GACxBlS,KAAK2D,KAAKa,EAAI0N,EAAMxN,EAAIwN,EAAM1N,EAAI0N,EAAMxN,EAAIwN,GAC5ClS,KAAK2D,KAAKa,EAAI0N,EAAMxN,EAAIwN,EAAM1N,EAAI0N,EAAMxN,EAAIwN,EAC7C,CAEA,OAAAo/B,CAASC,EAAoC17B,EAAgBzM,EAAe4G,EAAe,MAC1F,GAAI5G,EAAQ,EAAG,MAAM,IAAIvI,MAAM,4CAC/Bb,KAAKwwC,MAAM3B,GAAU6B,KAAc,EAARtnC,GACb,OAAV4G,IAAgBA,EAAQhQ,KAAKgQ,OAClBhQ,KAAK4tB,KAAK8e,cACf1sC,KAAKqwC,YAGfjnC,IAAU,EAEV,IAAIooC,EAASD,EAHb17B,IAAW,GAIP47B,EAASF,EAAgB17B,EAAS,GAClCgZ,EAAOhZ,EAASzM,EAEpB,IAAK,IAAIjE,EAAI0Q,EAAQrK,EAAIqK,EAASzM,EAAQ,EAAGjE,EAAIqG,EAAGrG,GAAK,EAAG,CAC3D,IAAIshB,EAAK8qB,EAAgBpsC,GACrBuhB,EAAK6qB,EAAgBpsC,EAAE,GAEvB4hB,EAAK,EACLC,EAAK,EAEL7hB,EAAI,GAAK0pB,GACZ9H,EAAKyqB,EACLxqB,EAAKyqB,IAEL1qB,EAAKwqB,EAAgBpsC,EAAI,GACzB6hB,EAAKuqB,EAAgBpsC,EAAI,IAG1BnF,KAAKywC,OAAOhqB,EAAIC,EAAI1W,GACpBhQ,KAAKywC,OAAO1pB,EAAIC,EAAIhX,EACrB,CACD,CAEA,MAAA0hC,CAAQd,EAAiBpsC,EAAWE,EAAWitC,EAAgB3hC,EAAe,KAAMoU,EAAmB,GAEtG,GADiB,IAAbA,IAAgBA,EAAWzf,KAAK4L,IAAI,EAAI,EAAIL,EAAUe,KAAK0gC,GAAW,IACtEvtB,GAAY,EAAG,MAAM,IAAIvjB,MAAM,yBACrB,OAAVmP,IAAgBA,EAAQhQ,KAAKgQ,OACjC,IAAIkE,EAAQ,EAAIhE,EAAUC,GAAKiU,EAC3B3T,EAAM9L,KAAK8L,IAAIyD,GACftD,EAAMjM,KAAKiM,IAAIsD,GACfsN,EAAKmwB,EAAQlwB,EAAK,EACtB,GAAKmvB,EAWE,CACN5wC,KAAKwwC,MAAM3B,GAAUuB,OAAmB,EAAXhsB,EAAe,GAC5CA,IACA,IAAK,IAAIjf,EAAI,EAAGA,EAAIif,EAAUjf,IAAK,CAClCnF,KAAKywC,OAAOjsC,EAAGE,EAAGsL,GAClBhQ,KAAKywC,OAAOjsC,EAAIgd,EAAI9c,EAAI+c,EAAIzR,GAC5B,IAAI4X,EAAOpG,EACXA,EAAK/Q,EAAM+Q,EAAK5Q,EAAM6Q,EACtBA,EAAK7Q,EAAMgX,EAAOnX,EAAMgR,EACxBzhB,KAAKywC,OAAOjsC,EAAIgd,EAAI9c,EAAI+c,EAAIzR,EAC7B,CAEAhQ,KAAKywC,OAAOjsC,EAAGE,EAAGsL,GAClBhQ,KAAKywC,OAAOjsC,EAAIgd,EAAI9c,EAAI+c,EAAIzR,EAC7B,KAzBa,CACZhQ,KAAKwwC,MAAM3B,GAAU6B,KAAiB,EAAXtsB,EAAe,GAC1C,IAAK,IAAIjf,EAAI,EAAGA,EAAIif,EAAUjf,IAAK,CAClCnF,KAAKywC,OAAOjsC,EAAIgd,EAAI9c,EAAI+c,EAAIzR,GAC5B,IAAI4X,EAAOpG,EACXA,EAAK/Q,EAAM+Q,EAAK5Q,EAAM6Q,EACtBA,EAAK7Q,EAAMgX,EAAOnX,EAAMgR,EACxBzhB,KAAKywC,OAAOjsC,EAAIgd,EAAI9c,EAAI+c,EAAIzR,EAC7B,CAEAhQ,KAAKywC,OAAOjsC,EAAIgd,EAAI9c,EAAI+c,EAAIzR,EAC7B,CAiBAwR,EAAKmwB,EACLlwB,EAAK,EACLzhB,KAAKywC,OAAOjsC,EAAIgd,EAAI9c,EAAI+c,EAAIzR,EAC7B,CAEA,KAAAiW,CAAOQ,EAAYC,EAAYC,EAAaC,EAAaC,EAAaC,EAAaC,EAAYC,EAAY5C,EAAkBpU,EAAe,MAC3IhQ,KAAKwwC,MAAM3B,GAAU6B,KAAiB,EAAXtsB,EAAe,GAC5B,OAAVpU,IAAgBA,EAAQhQ,KAAKgQ,OAGjC,IAAI4hC,EAAc,EAAIxtB,EAClBytB,EAAeD,EAAcA,EAC7BE,EAAeF,EAAcA,EAAcA,EAE3CG,EAAO,EAAIH,EACXI,EAAO,EAAIH,EACXI,EAAO,EAAIJ,EACXK,EAAO,EAAIJ,EAEXK,EAAQ1rB,EAAW,EAANE,EAAUE,EACvBurB,EAAQ1rB,EAAW,EAANE,EAAUE,EAEvBurB,EAAsB,GAAb1rB,EAAME,GAAWJ,EAAKM,EAC/BurB,EAAsB,GAAb1rB,EAAME,GAAWJ,EAAKM,EAE/BurB,EAAK9rB,EACL+rB,EAAK9rB,EAELa,GAAOZ,EAAMF,GAAMsrB,EAAOI,EAAQH,EAAOK,EAAQP,EACjDtqB,GAAOZ,EAAMF,GAAMqrB,EAAOK,EAAQJ,EAAOM,EAAQR,EAEjDzqB,EAAO8qB,EAAQF,EAAOI,EAAQH,EAC9B5qB,EAAO8qB,EAAQH,EAAOK,EAAQJ,EAE9B/qB,EAAQkrB,EAAQH,EAChB9qB,EAAQkrB,EAAQJ,EAEpB,KAAO9tB,KAAa,GACnBpkB,KAAKywC,OAAO8B,EAAIC,EAAIxiC,GACpBuiC,GAAMhrB,EACNirB,GAAMhrB,EACND,GAAOF,EACPG,GAAOF,EACPD,GAAQF,EACRG,GAAQF,EACRpnB,KAAKywC,OAAO8B,EAAIC,EAAIxiC,GAErBhQ,KAAKywC,OAAO8B,EAAIC,EAAIxiC,GACpBhQ,KAAKywC,OAAO1pB,EAAIC,EAAIhX,EACrB,CAEQ,MAAAygC,CAAQjsC,EAAWE,EAAWsL,GACrC,IAAIw3B,EAAMxnC,KAAKqwC,YACX/6B,EAAWtV,KAAK4tB,KAAK8e,cACzBp3B,EAASkyB,KAAShjC,EAClB8Q,EAASkyB,KAAS9iC,EAClB4Q,EAASkyB,KAASx3B,EAAMZ,EACxBkG,EAASkyB,KAASx3B,EAAMX,EACxBiG,EAASkyB,KAASx3B,EAAMV,EACxBgG,EAASkyB,KAASx3B,EAAMT,EACxBvP,KAAKqwC,YAAc7I,CACpB,CAEA,GAAA/K,GACC,IAAKz8B,KAAKkvC,UAAW,MAAM,IAAIruC,MAAM,6CACrCb,KAAK4vC,QACL5vC,KAAK6M,QAAQ9B,GAAGilC,QAAQhwC,KAAK6M,QAAQ9B,GAAG0kC,OACxCzvC,KAAKkvC,WAAY,CAClB,CAEQ,KAAAU,GACiB,GAApB5vC,KAAKqwC,cACTrwC,KAAK4tB,KAAK6e,kBAAkBzsC,KAAKqwC,aACjCrwC,KAAK4tB,KAAKuf,KAAKntC,KAAK8oC,OAAQ9oC,KAAKmwC,WACjCnwC,KAAKqwC,YAAc,EACpB,CAEQ,KAAAG,CAAML,EAAsB3D,GACnC,IAAKxsC,KAAKkvC,UAAW,MAAM,IAAIruC,MAAM,6CACrC,GAAIb,KAAKmwC,WAAaA,EAAW,CAChC,KAAInwC,KAAK4tB,KAAK2e,cAAgBvsC,KAAK4tB,KAAK4e,cAAgBA,GACnD,OADgExsC,KAAK4vC,OAE3E,MACC5vC,KAAK4vC,QACL5vC,KAAKmwC,UAAYA,CAEnB,CAEA,OAAAptC,GACC/C,KAAK4tB,KAAK7qB,SACX,GAGD,SAAY8rC,GACX,qBACA,mBACA,sBACA,CAJD,CAAYA,KAAAA,GAAS,KInTd,MAAM4D,GAGZ5vB,KAAO,EAGPE,KAAO,EAGPE,KAAO,EAGPE,KAAO,EAGPuvB,cAAgB,IAAIxvC,MAGpByvC,SAAW,IAAIzvC,MAEP0vC,YAAc,IAAIz/B,GAAwB,IAC1C1B,EAAMc,cAAc,MAO5B,MAAA9E,CAAQsI,EAAoB88B,GAC3B,GAAgB,MAAZ98B,EAAkB,MAAM,IAAIlV,MAAM,4BACtC,IAAI6xC,EAAgB1yC,KAAK0yC,cACrBC,EAAW3yC,KAAK2yC,SAChBC,EAAc5yC,KAAK4yC,YACnB1oB,EAAQnU,EAASmU,MACjB8P,EAAY9P,EAAMpmB,OAEtB4uC,EAAc5uC,OAAS,EACvB8uC,EAAYj/B,QAAQg/B,GACpBA,EAAS7uC,OAAS,EAElB,IAAK,IAAIqB,EAAI,EAAGA,EAAI60B,EAAW70B,IAAK,CACnC,IAAIuQ,EAAOwU,EAAM/kB,GACjB,IAAKuQ,EAAKM,KAAKmG,OAAQ,SACvB,IAAIpF,EAAarB,EAAK4O,gBACtB,GAAIvN,aAAsBC,EAAuB,CAChD,IAAI87B,EAAc/7B,EAClB27B,EAAc3tC,KAAK+tC,GAEnB,IAAIxB,EAAUsB,EAAYt/B,SACtBg+B,EAAQxtC,QAAUgvC,EAAYv9B,sBACjC+7B,EAAU7/B,EAAMc,cAAcugC,EAAYv9B,sBAE3Co9B,EAAS5tC,KAAKusC,GACdwB,EAAYr9B,qBAAqBC,EAAM,EAAGo9B,EAAYv9B,oBAAqB+7B,EAAS,EAAG,EACxF,CACD,CAEIuB,EACH7yC,KAAK+yC,eAEL/yC,KAAK6iB,KAAO4K,OAAOC,kBACnB1tB,KAAK+iB,KAAO0K,OAAOC,kBACnB1tB,KAAKijB,KAAOwK,OAAOE,kBACnB3tB,KAAKmjB,KAAOsK,OAAOE,kBAErB,CAEA,WAAAolB,GACC,IAAIlwB,EAAO4K,OAAOC,kBAAmB3K,EAAO0K,OAAOC,kBAAmBzK,EAAOwK,OAAOE,kBAAmBxK,EAAOsK,OAAOE,kBACjHglB,EAAW3yC,KAAK2yC,SACpB,IAAK,IAAIxtC,EAAI,EAAGqG,EAAImnC,EAAS7uC,OAAQqB,EAAIqG,EAAGrG,IAAK,CAChD,IAAImsC,EAAUqB,EAASxtC,GACnBmQ,EAAWg8B,EACf,IAAK,IAAI3pB,EAAK,EAAGkG,EAAKyjB,EAAQxtC,OAAQ6jB,EAAKkG,EAAIlG,GAAM,EAAG,CACvD,IAAInjB,EAAI8Q,EAASqS,GACbjjB,EAAI4Q,EAASqS,EAAK,GACtB9E,EAAOle,KAAK2L,IAAIuS,EAAMre,GACtBue,EAAOpe,KAAK2L,IAAIyS,EAAMre,GACtBue,EAAOte,KAAK4L,IAAI0S,EAAMze,GACtB2e,EAAOxe,KAAK4L,IAAI4S,EAAMze,EACvB,CACD,CACA1E,KAAK6iB,KAAOA,EACZ7iB,KAAK+iB,KAAOA,EACZ/iB,KAAKijB,KAAOA,EACZjjB,KAAKmjB,KAAOA,CACb,CAGA,iBAAA6vB,CAAmBxuC,EAAWE,GAC7B,OAAOF,GAAKxE,KAAK6iB,MAAQre,GAAKxE,KAAKijB,MAAQve,GAAK1E,KAAK+iB,MAAQre,GAAK1E,KAAKmjB,IACxE,CAGA,qBAAA8vB,CAAuBxsB,EAAYC,EAAYK,EAAYC,GAC1D,IAAInE,EAAO7iB,KAAK6iB,KACZE,EAAO/iB,KAAK+iB,KACZE,EAAOjjB,KAAKijB,KACZE,EAAOnjB,KAAKmjB,KAChB,GAAKsD,GAAM5D,GAAQkE,GAAMlE,GAAU6D,GAAM3D,GAAQiE,GAAMjE,GAAU0D,GAAMxD,GAAQ8D,GAAM9D,GAAUyD,GAAMvD,GAAQ6D,GAAM7D,EAClH,OAAO,EACR,IAAI4gB,GAAK/c,EAAKN,IAAOK,EAAKN,GACtB/hB,EAAIq/B,GAAKlhB,EAAO4D,GAAMC,EAC1B,GAAIhiB,EAAIqe,GAAQre,EAAIye,EAAM,OAAO,EAEjC,GADAze,EAAIq/B,GAAK9gB,EAAOwD,GAAMC,EAClBhiB,EAAIqe,GAAQre,EAAIye,EAAM,OAAO,EACjC,IAAI3e,GAAKue,EAAO2D,GAAMqd,EAAItd,EAC1B,OAAIjiB,EAAIqe,GAAQre,EAAIye,IACpBze,GAAK2e,EAAOuD,GAAMqd,EAAItd,EAClBjiB,EAAIqe,GAAQre,EAAIye,EAErB,CAGA,sBAAAiwB,CAAwBC,GACvB,OAAOnzC,KAAK6iB,KAAOswB,EAAOlwB,MAAQjjB,KAAKijB,KAAOkwB,EAAOtwB,MAAQ7iB,KAAK+iB,KAAOowB,EAAOhwB,MAAQnjB,KAAKmjB,KAAOgwB,EAAOpwB,IAC5G,CAIA,aAAAqwB,CAAe5uC,EAAWE,GACzB,IAAIiuC,EAAW3yC,KAAK2yC,SACpB,IAAK,IAAIxtC,EAAI,EAAGqG,EAAImnC,EAAS7uC,OAAQqB,EAAIqG,EAAGrG,IAC3C,GAAInF,KAAKqzC,qBAAqBV,EAASxtC,GAAIX,EAAGE,GAAI,OAAO1E,KAAK0yC,cAAcvtC,GAC7E,OAAO,IACR,CAGA,oBAAAkuC,CAAsB/B,EAA4B9sC,EAAWE,GAC5D,IAAI4Q,EAAWg8B,EACXzjB,EAAKyjB,EAAQxtC,OAEbwvC,EAAYzlB,EAAK,EACjB0lB,GAAS,EACb,IAAK,IAAI5rB,EAAK,EAAGA,EAAKkG,EAAIlG,GAAM,EAAG,CAClC,IAAI6rB,EAAUl+B,EAASqS,EAAK,GACxBiI,EAAQta,EAASg+B,EAAY,GACjC,GAAKE,EAAU9uC,GAAKkrB,GAASlrB,GAAOkrB,EAAQlrB,GAAK8uC,GAAW9uC,EAAI,CAC/D,IAAI+uC,EAAUn+B,EAASqS,GACnB8rB,GAAW/uC,EAAI8uC,IAAY5jB,EAAQ4jB,IAAYl+B,EAASg+B,GAAaG,GAAWjvC,IAAG+uC,GAAUA,EAClG,CACAD,EAAY3rB,CACb,CACA,OAAO4rB,CACR,CAKA,iBAAAG,CAAmBjtB,EAAYC,EAAYK,EAAYC,GACtD,IAAI2rB,EAAW3yC,KAAK2yC,SACpB,IAAK,IAAIxtC,EAAI,EAAGqG,EAAImnC,EAAS7uC,OAAQqB,EAAIqG,EAAGrG,IAC3C,GAAInF,KAAK2zC,yBAAyBhB,EAASxtC,GAAIshB,EAAIC,EAAIK,EAAIC,GAAK,OAAOhnB,KAAK0yC,cAAcvtC,GAC3F,OAAO,IACR,CAGA,wBAAAwuC,CAA0BrC,EAA4B7qB,EAAYC,EAAYK,EAAYC,GACzF,IAAI1R,EAAWg8B,EACXzjB,EAAKyjB,EAAQxtC,OAEb8vC,EAAUntB,EAAKM,EAAI8sB,EAAWntB,EAAKM,EACnC8sB,EAAOrtB,EAAKO,EAAKN,EAAKK,EACtB8pB,EAAKv7B,EAASuY,EAAK,GAAIijB,EAAKx7B,EAASuY,EAAK,GAC9C,IAAK,IAAIlG,EAAK,EAAGA,EAAKkG,EAAIlG,GAAM,EAAG,CAClC,IAAIupB,EAAK57B,EAASqS,GAAKwpB,EAAK77B,EAASqS,EAAK,GACtCosB,EAAOlD,EAAKM,EAAKL,EAAKI,EACtB8C,EAAUnD,EAAKK,EAAI+C,EAAWnD,EAAKK,EACnC+C,EAAON,EAAUK,EAAWJ,EAAWG,EACvCxvC,GAAKsvC,EAAOE,EAAUJ,EAAUG,GAAQG,EAC5C,IAAM1vC,GAAKqsC,GAAMrsC,GAAK0sC,GAAQ1sC,GAAK0sC,GAAM1sC,GAAKqsC,KAAUrsC,GAAKiiB,GAAMjiB,GAAKuiB,GAAQviB,GAAKuiB,GAAMviB,GAAKiiB,GAAM,CACrG,IAAI/hB,GAAKovC,EAAOG,EAAWJ,EAAWE,GAAQG,EAC9C,IAAMxvC,GAAKosC,GAAMpsC,GAAKysC,GAAQzsC,GAAKysC,GAAMzsC,GAAKosC,KAAUpsC,GAAKgiB,GAAMhiB,GAAKsiB,GAAQtiB,GAAKsiB,GAAMtiB,GAAKgiB,GAAM,OAAO,CAC9G,CACAmqB,EAAKK,EACLJ,EAAKK,CACN,CACA,OAAO,CACR,CAGA,UAAAgD,CAAYrB,GACX,GAAmB,MAAfA,EAAqB,MAAM,IAAIjyC,MAAM,+BACzC,IAAIgE,EAAQ7E,KAAK0yC,cAAcntC,QAAQutC,GACvC,OAAiB,GAAVjuC,EAAc,KAAO7E,KAAK2yC,SAAS9tC,EAC3C,CAGA,QAAAuvC,GACC,OAAOp0C,KAAKijB,KAAOjjB,KAAK6iB,IACzB,CAGA,SAAAwxB,GACC,OAAOr0C,KAAKmjB,KAAOnjB,KAAK+iB,IACzB,EC/LM,MAAMuxB,GACZC,cAAgB,IAAIplC,EAAM,EAAG,EAAG,EAAG,GACnCqlC,gBAAkB,IAAIrlC,EAAM,EAAG,EAAG,EAAG,GACrCslC,oBAAsB,IAAItlC,EAAM,EAAG,EAAG,EAAG,IACzCulC,kBAAoB,IAAIvlC,EAAM,EAAG,IAAM,EAAG,IAC1CwlC,WAAY,IAAIxlC,GAAQS,cAAc,UACtCglC,UAAY,IAAIzlC,EAAM,GAAK,EAAG,EAAG,GACjC0lC,UAAY,IAAI1lC,EAAM,EAAG,EAAG,EAAG,IAC/B2lC,WAAY,EACZC,uBAAwB,EACxBC,mBAAoB,EACpBC,cAAe,EACfC,mBAAoB,EACpBC,WAAY,EACZC,gBAAiB,EACjBC,cAAe,EACf5oC,oBAAqB,EACrBkY,MAAQ,EACR2wB,UAAY,EAEJzoC,QACAsmC,OAAS,IAAIV,GACb7qB,KAAO,IAAI1kB,MACXoS,SAAW7D,EAAMc,cAAc,MAC/BxG,kBAAoB,IAAIoD,EAAM,IAAM,IAAK,IAAM,IAAK,IAAM,IAAK,GAC/DpD,aAAe,IAAIoD,EAAM,EAAG,EAAG,EAAG,GAE1C,WAAArP,CAAa+M,GACZ7M,KAAK6M,QAAUA,aAAmBhC,EAA8BgC,EAAU,IAAIhC,EAA6BgC,EAC5G,CAEA,IAAAsgC,CAAMoI,EAAuBx/B,EAAoBy/B,EAA8B,MAC9E,IAAIC,EAAY1/B,EAASvR,EACrBkxC,EAAY3/B,EAASrR,EACrBqG,EAAK/K,KAAK6M,QAAQ9B,GAClB4qC,EAAU31C,KAAKyM,mBAAqB1B,EAAGsB,IAAMtB,EAAG2B,UACpD6oC,EAAO5F,aAAagG,EAAS5qC,EAAGoB,qBAEhC,IAAIkJ,EAAQU,EAASV,MACrB,GAAIrV,KAAK80C,UAAW,CACnBS,EAAOjF,SAAStwC,KAAKu0C,eACrB,IAAK,IAAIpvC,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAI6Q,EAAOX,EAAMlQ,GACjB,GAAIqwC,GAAgBA,EAAajwC,QAAQyQ,EAAKrP,KAAK1C,OAAS,EAAG,SAC/D,GAAmB,MAAf+R,EAAKhN,OAAgB,SACzB,IAAIxE,EAAIixC,EAAYz/B,EAAKrP,KAAK7C,OAASkS,EAAKzG,EAAIyG,EAAKG,OACjDzR,EAAIgxC,EAAY1/B,EAAKrP,KAAK7C,OAASkS,EAAKrG,EAAIqG,EAAKI,OACrDm/B,EAAOlE,UAAS,EAAMoE,EAAYz/B,EAAKG,OAAQu/B,EAAY1/B,EAAKI,OAAQ5R,EAAGE,EAAG1E,KAAKs1C,UAAYt1C,KAAK2kB,MACrG,CACI3kB,KAAKo1C,gBAAgBG,EAAO/wC,EAAEixC,EAAWC,EAAW,EAAI11C,KAAK2kB,MAClE,CAEA,GAAI3kB,KAAK+0C,sBAAuB,CAC/BQ,EAAOjF,SAAStwC,KAAKy0C,qBACrB,IAAIvqB,EAAQnU,EAASmU,MACrB,IAAK,IAAI/kB,EAAI,EAAGqG,EAAI0e,EAAMpmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAIuQ,EAAOwU,EAAM/kB,GACb4R,EAAarB,EAAK4O,gBACtB,GAAIvN,aAAsB8B,EAAkB,CAC3C,IAAI+8B,EAAqC7+B,EACrCzB,EAAWtV,KAAKsV,SACpBsgC,EAAiBngC,qBAAqBC,EAAKM,KAAMV,EAAU,EAAG,GAC9DigC,EAAO5xC,KAAK2R,EAAS,GAAIA,EAAS,GAAIA,EAAS,GAAIA,EAAS,IAC5DigC,EAAO5xC,KAAK2R,EAAS,GAAIA,EAAS,GAAIA,EAAS,GAAIA,EAAS,IAC5DigC,EAAO5xC,KAAK2R,EAAS,GAAIA,EAAS,GAAIA,EAAS,GAAIA,EAAS,IAC5DigC,EAAO5xC,KAAK2R,EAAS,GAAIA,EAAS,GAAIA,EAAS,GAAIA,EAAS,GAC7D,CACD,CACD,CAEA,GAAItV,KAAKi1C,cAAgBj1C,KAAKk1C,kBAAmB,CAChD,IAAIhrB,EAAQnU,EAASmU,MACrB,IAAK,IAAI/kB,EAAI,EAAGqG,EAAI0e,EAAMpmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAIuQ,EAAOwU,EAAM/kB,GACjB,IAAKuQ,EAAKM,KAAKmG,OAAQ,SACvB,IAAIpF,EAAarB,EAAK4O,gBACtB,KAAMvN,aAAsBK,GAAiB,SAC7C,IAAIwW,EAAuB7W,EACvBzB,EAAWtV,KAAKsV,SACpBsY,EAAKnY,qBAAqBC,EAAM,EAAGkY,EAAKrY,oBAAqBD,EAAU,EAAG,GAC1E,IAAIiC,EAAYqW,EAAKrW,UACjBC,EAAaoW,EAAKpW,WACtB,GAAIxX,KAAKk1C,kBAAmB,CAC3BK,EAAOjF,SAAStwC,KAAK00C,mBACrB,IAAK,IAAI/sB,EAAK,EAAGkG,EAAKtW,EAAUzT,OAAQ6jB,EAAKkG,EAAIlG,GAAM,EAAG,CACzD,IAAIkuB,EAAqB,EAAhBt+B,EAAUoQ,GAAS3lB,EAAyB,EAApBuV,EAAUoQ,EAAK,GAAQmuB,EAAyB,EAApBv+B,EAAUoQ,EAAK,GAC5E4tB,EAAO5E,UAAS,EAAOr7B,EAASugC,GAAKvgC,EAASugC,EAAK,GAClDvgC,EAAStT,GAAKsT,EAAStT,EAAK,GAC5BsT,EAASwgC,GAAKxgC,EAASwgC,EAAK,GAE9B,CACD,CACA,GAAI91C,KAAKi1C,cAAgBz9B,EAAa,EAAG,CACxC+9B,EAAOjF,SAAStwC,KAAKy0C,qBACrBj9B,EAAiC,GAAnBA,GAAc,GAC5B,IAAIsuB,EAAQxwB,EAASkC,EAAa,GAAIuuB,EAAQzwB,EAASkC,EAAa,GACpE,IAAK,IAAImQ,EAAK,EAAGkG,EAAKrW,EAAYmQ,EAAKkG,EAAIlG,GAAM,EAAG,CACnD,IAAInjB,EAAI8Q,EAASqS,GAAKjjB,EAAI4Q,EAASqS,EAAK,GACxC4tB,EAAO5xC,KAAKa,EAAGE,EAAGohC,EAAOC,GACzBD,EAAQthC,EACRuhC,EAAQrhC,CACT,CACD,CACD,CACD,CAEA,GAAI1E,KAAKg1C,kBAAmB,CAC3B,IAAI7B,EAASnzC,KAAKmzC,OAClBA,EAAO1lC,OAAOsI,GAAU,GACxBw/B,EAAOjF,SAAStwC,KAAK60C,WACrBU,EAAO/O,MAAK,EAAO2M,EAAOtwB,KAAMswB,EAAOpwB,KAAMowB,EAAOiB,WAAYjB,EAAOkB,aACvE,IAAI1B,EAAWQ,EAAOR,SAClBoD,EAAQ5C,EAAOT,cACnB,IAAK,IAAIvtC,EAAI,EAAGqG,EAAImnC,EAAS7uC,OAAQqB,EAAIqG,EAAGrG,IAAK,CAChD,IAAImsC,EAAUqB,EAASxtC,GACvBowC,EAAOjF,SAASyF,EAAM5wC,GAAG6K,OACzBulC,EAAOjE,QAAQA,EAAS,EAAGA,EAAQxtC,OACpC,CACD,CAEA,GAAI9D,KAAKm1C,UAAW,CACnB,IAAIjrB,EAAQnU,EAASmU,MACrB,IAAK,IAAI/kB,EAAI,EAAGqG,EAAI0e,EAAMpmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAIuQ,EAAOwU,EAAM/kB,GACjB,IAAKuQ,EAAKM,KAAKmG,OAAQ,SACvB,IAAIpF,EAAarB,EAAK4O,gBACtB,KAAMvN,aAAsBmB,GAAiB,SAC7C,IAAI/R,EAAuB4Q,EACvB8W,EAAK1nB,EAAKoP,oBACV0J,EAAQjf,KAAK4nB,KAAOnW,EAAMQ,aAAajS,KAAK4nB,KAAMiG,EAAI,GAC1D1nB,EAAKsP,qBAAqBC,EAAM,EAAGmY,EAAI5O,EAAO,EAAG,GACjD,IAAIjP,EAAQhQ,KAAK20C,UACbluB,EAAKxH,EAAM,GAAIyH,EAAKzH,EAAM,GAAI8H,EAAK,EAAGC,EAAK,EAC/C,GAAI7gB,EAAKiS,OAAQ,CAChBm9B,EAAOjF,SAAStgC,GAChB,IAAI2W,EAAM1H,EAAM,GAAI2H,EAAM3H,EAAM,GAAI4H,EAAM5H,EAAM4O,EAAK,GAAI/G,EAAM7H,EAAM4O,EAAK,GAC1E9G,EAAK9H,EAAM4O,EAAK,GAChB7G,EAAK/H,EAAM4O,EAAK,GAChB0nB,EAAOtvB,MAAMQ,EAAIC,EAAIC,EAAKC,EAAKC,EAAKC,EAAKC,EAAIC,EAAI,IACjDuuB,EAAOjF,SAASgE,GAAsB0B,YACtCT,EAAO5xC,KAAK8iB,EAAIC,EAAIC,EAAKC,GACzB2uB,EAAO5xC,KAAKojB,EAAIC,EAAIH,EAAKC,EAC1B,CACA+G,GAAM,EACN,IAAK,IAAIlG,EAAK,EAAGA,EAAKkG,EAAIlG,GAAM,EAAG,CAClC,IAAIhB,EAAM1H,EAAM0I,GAAKf,EAAM3H,EAAM0I,EAAK,GAAId,EAAM5H,EAAM0I,EAAK,GAAIb,EAAM7H,EAAM0I,EAAK,GAChFZ,EAAK9H,EAAM0I,EAAK,GAChBX,EAAK/H,EAAM0I,EAAK,GAChB4tB,EAAOjF,SAAStgC,GAChBulC,EAAOtvB,MAAMQ,EAAIC,EAAIC,EAAKC,EAAKC,EAAKC,EAAKC,EAAIC,EAAI,IACjDuuB,EAAOjF,SAASgE,GAAsB0B,YACtCT,EAAO5xC,KAAK8iB,EAAIC,EAAIC,EAAKC,GACzB2uB,EAAO5xC,KAAKojB,EAAIC,EAAIH,EAAKC,GACzBL,EAAKM,EACLL,EAAKM,CACN,CACD,CACD,CAEA,GAAIhnB,KAAK80C,UAAW,CACnBS,EAAOjF,SAAStwC,KAAKw0C,iBACrB,IAAK,IAAIrvC,EAAI,EAAGqG,EAAI6J,EAAMvR,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAI6Q,EAAOX,EAAMlQ,GACbqwC,GAAgBA,EAAajwC,QAAQyQ,EAAKrP,KAAK1C,OAAS,GAC5DsxC,EAAO7D,QAAO,EAAM+D,EAAYz/B,EAAKG,OAAQu/B,EAAY1/B,EAAKI,OAAQ,EAAIpW,KAAK2kB,MAAO2vB,GAAsB2B,MAAO,EACpH,CACD,CAEA,GAAIj2C,KAAKq1C,aAAc,CACtB,IAAInrB,EAAQnU,EAASmU,MACrBqrB,EAAOjF,SAAStwC,KAAK40C,WACrB,IAAK,IAAIzvC,EAAI,EAAGqG,EAAI0e,EAAMpmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC7C,IAAIuQ,EAAOwU,EAAM/kB,GACjB,IAAKuQ,EAAKM,KAAKmG,OAAQ,SACvB,IAAIpF,EAAarB,EAAK4O,gBACtB,KAAMvN,aAAsBG,GAAqB,SACjD,IAAI8jB,EAA2BjkB,EAC3B8W,EAAKmN,EAAKzlB,oBACV0J,EAAQjf,KAAK4nB,KAAOnW,EAAMQ,aAAajS,KAAK4nB,KAAMiG,EAAI,GAC1DmN,EAAKvlB,qBAAqBC,EAAM,EAAGmY,EAAI5O,EAAO,EAAG,GACjD,IAAK,IAAI9Z,EAAI,EAAGqG,EAAIyT,EAAMnb,OAAQqB,EAAIqG,EAAGrG,GAAG,EAAG,CAC9C,IAAIX,EAAIya,EAAM9Z,GACVT,EAAIua,EAAM9Z,EAAI,GACd4hB,EAAK9H,GAAO9Z,EAAI,GAAK8Z,EAAMnb,QAC3BkjB,EAAK/H,GAAO9Z,EAAI,GAAK8Z,EAAMnb,QAC/ByxC,EAAO5xC,KAAKa,EAAGE,EAAGqiB,EAAIC,EACvB,CACD,CACD,CACD,CAEA,OAAAjkB,GACA,ECxMM,MAAMmzC,GACJC,eAAiB,IAAIjzC,MACrBkzC,sBAAwB,IAAIlzC,MAE5B4sC,aAAe,IAAI5sC,MACnBmzC,eAAiB,IAAInzC,MACrBqU,UAAY,IAAIrU,MAEhB0vC,YAAc,IAAIz/B,GAAoB,IACtC,IAAIjQ,QAGJozC,mBAAqB,IAAInjC,GAAoB,IAC7C,IAAIjQ,QAGL,WAAAqzC,CAAaC,GACnB,IAAIlhC,EAAWkhC,EACXrjB,EAAcqjB,EAAc1yC,QAAU,EAEtCmoC,EAAUjsC,KAAK8vC,aACnB7D,EAAQnoC,OAAS,EACjB,IAAK,IAAIqB,EAAI,EAAGA,EAAIguB,EAAahuB,IAChC8mC,EAAQ9mC,GAAKA,EAEd,IAAIsxC,EAAYz2C,KAAKq2C,eACrBI,EAAU3yC,OAAS,EACnB,IAAK,IAAIqB,EAAI,EAAGqG,EAAI2nB,EAAahuB,EAAIqG,IAAKrG,EACzCsxC,EAAUtxC,GAAK+wC,GAAaO,UAAUtxC,EAAGguB,EAAa7d,EAAU22B,GAEjE,IAAI10B,EAAYvX,KAAKuX,UAGrB,IAFAA,EAAUzT,OAAS,EAEZqvB,EAAc,GAAG,CAEvB,IAAIujB,EAAWvjB,EAAc,EAAGhuB,EAAI,EAAGwxC,EAAO,EAC9C,OAAa,CACZx0B,EACA,IAAKs0B,EAAUtxC,GAAI,CAClB,IAAIyxC,EAAK3K,EAAQyK,IAAa,EAAGG,EAAK5K,EAAQ9mC,IAAM,EAAG2xC,EAAK7K,EAAQ0K,IAAS,EACzEI,EAAMzhC,EAASshC,GAAKI,EAAM1hC,EAASshC,EAAK,GACxCK,EAAM3hC,EAASuhC,GAAKK,EAAM5hC,EAASuhC,EAAK,GACxCM,EAAM7hC,EAASwhC,GAAKM,EAAM9hC,EAASwhC,EAAK,GAC5C,IAAK,IAAInvB,GAAMgvB,EAAO,GAAKxjB,EAAaxL,GAAM+uB,EAAU/uB,GAAMA,EAAK,GAAKwL,EAAa,CACpF,IAAKsjB,EAAU9uB,GAAK,SACpB,IAAI7lB,EAAImqC,EAAQtkB,IAAO,EACnBrR,EAAKhB,EAASxT,GAAIyU,EAAKjB,EAASxT,EAAI,GACxC,GAAIo0C,GAAamB,aAAaF,EAAKC,EAAKL,EAAKC,EAAK1gC,EAAIC,IACjD2/B,GAAamB,aAAaN,EAAKC,EAAKC,EAAKC,EAAK5gC,EAAIC,IACjD2/B,GAAamB,aAAaJ,EAAKC,EAAKC,EAAKC,EAAK9gC,EAAIC,GAAK,MAAM4L,CAGpE,CACA,KACD,CAEA,GAAY,GAARw0B,EAAW,CACd,EAAG,CACF,IAAKF,EAAUtxC,GAAI,MACnBA,GACD,OAASA,EAAI,GACb,KACD,CAEAuxC,EAAWvxC,EACXA,EAAIwxC,EACJA,GAAQA,EAAO,GAAKxjB,CACrB,CAGA5b,EAAUxS,KAAKknC,GAAS9Y,EAAchuB,EAAI,GAAKguB,IAC/C5b,EAAUxS,KAAKknC,EAAQ9mC,IACvBoS,EAAUxS,KAAKknC,GAAS9mC,EAAI,GAAKguB,IACjC8Y,EAAQpgC,OAAO1G,EAAG,GAClBsxC,EAAU5qC,OAAO1G,EAAG,GACpBguB,IAEA,IAAImkB,GAAiBnkB,EAAchuB,EAAI,GAAKguB,EACxCokB,EAAYpyC,GAAKguB,EAAc,EAAIhuB,EACvCsxC,EAAUa,GAAiBpB,GAAaO,UAAUa,EAAenkB,EAAa7d,EAAU22B,GACxFwK,EAAUc,GAAarB,GAAaO,UAAUc,EAAWpkB,EAAa7d,EAAU22B,EACjF,CAQA,OANmB,GAAf9Y,IACH5b,EAAUxS,KAAKknC,EAAQ,IACvB10B,EAAUxS,KAAKknC,EAAQ,IACvB10B,EAAUxS,KAAKknC,EAAQ,KAGjB10B,CACR,CAEA,SAAAigC,CAAWhB,EAA8Bj/B,GACxC,IAAIjC,EAAWkhC,EACXL,EAAiBn2C,KAAKm2C,eAC1Bn2C,KAAK4yC,YAAYj/B,QAAQwiC,GACzBA,EAAeryC,OAAS,EAExB,IAAIsyC,EAAwBp2C,KAAKo2C,sBACjCp2C,KAAKs2C,mBAAmB3iC,QAAQyiC,GAChCA,EAAsBtyC,OAAS,EAE/B,IAAI2zC,EAAiBz3C,KAAKs2C,mBAAmBhjC,SAC7CmkC,EAAe3zC,OAAS,EAExB,IAAIwtC,EAAUtxC,KAAK4yC,YAAYt/B,SAC/Bg+B,EAAQxtC,OAAS,EAGjB,IAAI4zC,GAAgB,EAAGC,EAAc,EACrC,IAAK,IAAIxyC,EAAI,EAAGqG,EAAI+L,EAAUzT,OAAQqB,EAAIqG,EAAGrG,GAAK,EAAG,CACpD,IAAIyyC,EAAKrgC,EAAUpS,IAAM,EAAG0yC,EAAKtgC,EAAUpS,EAAI,IAAM,EAAG2yC,EAAKvgC,EAAUpS,EAAI,IAAM,EAC7EshB,EAAKnR,EAASsiC,GAAKlxB,EAAKpR,EAASsiC,EAAK,GACtC7wB,EAAKzR,EAASuiC,GAAK7wB,EAAK1R,EAASuiC,EAAK,GACtChH,EAAKv7B,EAASwiC,GAAKhH,EAAKx7B,EAASwiC,EAAK,GAGtCC,GAAS,EACb,GAAIL,GAAgBE,EAAI,CACvB,IAAI5xB,EAAIsrB,EAAQxtC,OAAS,EACrBk0C,EAAW9B,GAAa+B,QAAQ3G,EAAQtrB,GAAIsrB,EAAQtrB,EAAI,GAAIsrB,EAAQtrB,EAAI,GAAIsrB,EAAQtrB,EAAI,GAAI6qB,EAAIC,GAChGoH,EAAWhC,GAAa+B,QAAQpH,EAAIC,EAAIQ,EAAQ,GAAIA,EAAQ,GAAIA,EAAQ,GAAIA,EAAQ,IACpF0G,GAAYL,GAAeO,GAAYP,IAC1CrG,EAAQvsC,KAAK8rC,GACbS,EAAQvsC,KAAK+rC,GACb2G,EAAe1yC,KAAK+yC,GACpBC,GAAS,EAEX,CAGKA,IACAzG,EAAQxtC,OAAS,GACpBqyC,EAAepxC,KAAKusC,GACpB8E,EAAsBrxC,KAAK0yC,KAE3Bz3C,KAAK4yC,YAAYp/B,KAAK89B,GACtBtxC,KAAKs2C,mBAAmB9iC,KAAKikC,IAE9BnG,EAAUtxC,KAAK4yC,YAAYt/B,SAC3Bg+B,EAAQxtC,OAAS,EACjBwtC,EAAQvsC,KAAK0hB,GACb6qB,EAAQvsC,KAAK2hB,GACb4qB,EAAQvsC,KAAKgiB,GACbuqB,EAAQvsC,KAAKiiB,GACbsqB,EAAQvsC,KAAK8rC,GACbS,EAAQvsC,KAAK+rC,GACb2G,EAAiBz3C,KAAKs2C,mBAAmBhjC,SACzCmkC,EAAe3zC,OAAS,EACxB2zC,EAAe1yC,KAAK6yC,GACpBH,EAAe1yC,KAAK8yC,GACpBJ,EAAe1yC,KAAK+yC,GACpBH,EAAczB,GAAa+B,QAAQxxB,EAAIC,EAAIK,EAAIC,EAAI6pB,EAAIC,GACvD4G,EAAeE,EAEjB,CAEItG,EAAQxtC,OAAS,IACpBqyC,EAAepxC,KAAKusC,GACpB8E,EAAsBrxC,KAAK0yC,IAI5B,IAAK,IAAItyC,EAAI,EAAGqG,EAAI2qC,EAAeryC,OAAQqB,EAAIqG,EAAGrG,IAAK,CAEtD,GADAsyC,EAAiBrB,EAAsBjxC,GACV,GAAzBsyC,EAAe3zC,OAAa,SAChC,IAAIq0C,EAAaV,EAAe,GAC5BW,EAAYX,EAAeA,EAAe3zC,OAAS,GAEvDwtC,EAAU6E,EAAehxC,GACzB,IAAI6gB,EAAIsrB,EAAQxtC,OAAS,EACrBu0C,EAAY/G,EAAQtrB,GAAIsyB,EAAYhH,EAAQtrB,EAAI,GAChD2J,EAAQ2hB,EAAQtrB,EAAI,GAAI4J,EAAQ0hB,EAAQtrB,EAAI,GAC5CwrB,EAASF,EAAQ,GAAIG,EAASH,EAAQ,GACtCiH,EAAUjH,EAAQ,GAAIkH,EAAUlH,EAAQ,GACxC2G,EAAU/B,GAAa+B,QAAQI,EAAWC,EAAW3oB,EAAOC,EAAO4hB,EAAQC,GAE/E,IAAK,IAAI9pB,EAAK,EAAGA,EAAKnc,EAAGmc,IAAM,CAC9B,GAAIA,GAAMxiB,EAAG,SACb,IAAIszC,EAAerC,EAAsBzuB,GACzC,GAA2B,GAAvB8wB,EAAa30C,OAAa,SAC9B,IAAI40C,EAAkBD,EAAa,GAC/BE,EAAmBF,EAAa,GAChCG,EAAiBH,EAAa,GAE9BI,EAAY1C,EAAexuB,GAC3BkpB,EAAKgI,EAAUA,EAAU/0C,OAAS,GAAIgtC,EAAK+H,EAAUA,EAAU/0C,OAAS,GAE5E,GAAI40C,GAAmBP,GAAcQ,GAAoBP,EAAW,SACpE,IAAIJ,EAAW9B,GAAa+B,QAAQI,EAAWC,EAAW3oB,EAAOC,EAAOihB,EAAIC,GACxEoH,EAAWhC,GAAa+B,QAAQpH,EAAIC,EAAIU,EAAQC,EAAQ8G,EAASC,GACjER,GAAYC,GAAWC,GAAYD,IACtCY,EAAU/0C,OAAS,EACnB20C,EAAa30C,OAAS,EACtBwtC,EAAQvsC,KAAK8rC,GACbS,EAAQvsC,KAAK+rC,GACb2G,EAAe1yC,KAAK6zC,GACpBP,EAAY1oB,EACZ2oB,EAAY1oB,EACZD,EAAQkhB,EACRjhB,EAAQkhB,EACRnpB,EAAK,EAEP,CACD,CAGA,IAAK,IAAIxiB,EAAIgxC,EAAeryC,OAAS,EAAGqB,GAAK,EAAGA,IAC/CmsC,EAAU6E,EAAehxC,GACH,GAAlBmsC,EAAQxtC,SACXqyC,EAAetqC,OAAO1G,EAAG,GACzBnF,KAAK4yC,YAAYp/B,KAAK89B,GACtBmG,EAAiBrB,EAAsBjxC,GACvCixC,EAAsBvqC,OAAO1G,EAAG,GAChCnF,KAAKs2C,mBAAmB9iC,KAAKikC,IAI/B,OAAOtB,CACR,CAEQ,gBAAOM,CAAW5xC,EAAesuB,EAAqB7d,EAA6B22B,GAC1F,IAAIyK,EAAWzK,GAAS9Y,EAActuB,EAAQ,GAAKsuB,IAAgB,EAC/DxE,EAAUsd,EAAQpnC,IAAU,EAC5B8xC,EAAO1K,GAASpnC,EAAQ,GAAKsuB,IAAgB,EACjD,OAAQnzB,KAAKq3C,aAAa/hC,EAASohC,GAAWphC,EAASohC,EAAW,GAAIphC,EAASqZ,GAAUrZ,EAASqZ,EAAU,GAAIrZ,EAASqhC,GACxHrhC,EAASqhC,EAAO,GAClB,CAEQ,mBAAOU,CAAcN,EAAaC,EAAaC,EAAaC,EAAaC,EAAaC,GAC7F,OAAOL,GAAOK,EAAMF,GAAOD,GAAOD,EAAMI,GAAOD,GAAOD,EAAMF,IAAQ,CACrE,CAEQ,cAAOiB,CAASlB,EAAaC,EAAaC,EAAaC,EAAaC,EAAaC,GACxF,IAAIp2B,EAAKi2B,EAAMF,EAAK91B,EAAKi2B,EAAMF,EAC/B,OAAOG,EAAMl2B,EAAKm2B,EAAMp2B,EAAKA,EAAKg2B,EAAMD,EAAM91B,GAAM,EAAI,GAAK,CAC9D,ECzOM,MAAM63B,GACJC,aAAe,IAAI7C,GACnB8C,gBAAkB,IAAI91C,MACtB+1C,WAAa,IAAI/1C,MACzBg2C,gBAAkB,IAAIh2C,MACtBi2C,iBAAmB,IAAIj2C,MACfk2C,QAAU,IAAIl2C,MAEdm2C,eACAC,iBAER,SAAAC,CAAW7jC,EAAYslB,GACtB,GAA2B,MAAvBh7B,KAAKq5C,eAAwB,OAAO,EACxCr5C,KAAKq5C,eAAiBre,EAEtB,IAAIxvB,EAAIwvB,EAAKzlB,oBACTD,EAAW7D,EAAMQ,aAAajS,KAAKg5C,gBAAiBxtC,GACxDwvB,EAAKvlB,qBAAqBC,EAAM,EAAGlK,EAAG8J,EAAU,EAAG,GACnD,IAAI0jC,EAAkBh5C,KAAKg5C,gBAC3BF,GAAiBU,cAAcR,GAC/B,IAAIM,EAAmBt5C,KAAKs5C,iBAAmBt5C,KAAK+4C,aAAavB,UAAUwB,EAAiBh5C,KAAK+4C,aAAaxC,YAAYyC,IAC1H,IAAK,IAAI7zC,EAAI,EAAGqG,EAAI8tC,EAAiBx1C,OAAQqB,EAAIqG,EAAGrG,IAAK,CACxD,IAAImsC,EAAUgI,EAAiBn0C,GAC/B2zC,GAAiBU,cAAclI,GAC/BA,EAAQvsC,KAAKusC,EAAQ,IACrBA,EAAQvsC,KAAKusC,EAAQ,GACtB,CAEA,OAAOgI,EAAiBx1C,MACzB,CAEA,eAAA21C,CAAiB/jC,GACW,MAAvB1V,KAAKq5C,gBAA0Br5C,KAAKq5C,eAAeliC,SAAWzB,EAAK/O,MAAM3G,KAAK05C,SACnF,CAEA,OAAAA,GAC4B,MAAvB15C,KAAKq5C,iBACTr5C,KAAKq5C,eAAiB,KACtBr5C,KAAKs5C,iBAAmB,KACxBt5C,KAAKk5C,gBAAgBp1C,OAAS,EAC9B9D,KAAKm5C,iBAAiBr1C,OAAS,EAC/B9D,KAAKg5C,gBAAgBl1C,OAAS,EAC/B,CAEA,UAAA61C,GACC,OAA8B,MAAvB35C,KAAKq5C,cACb,CAEA,aAAAO,CAAetkC,EAA6BqQ,EAAwBpO,EAA8BsiC,EAAyBviC,EAC1H+a,EAAcC,EAAaR,GAE3B,IAAImnB,EAAaj5C,KAAKi5C,WAAYC,EAAkBl5C,KAAKk5C,gBACrDC,EAAmBn5C,KAAKm5C,iBACxBxG,EAAW3yC,KAAKs5C,iBAChBQ,EAAgB95C,KAAKs5C,iBAAiBx1C,OACtCi2C,EAAajoB,EAAW,GAAK,EAE7BjtB,EAAQ,EACZq0C,EAAgBp1C,OAAS,EACzBq1C,EAAiBr1C,OAAS,EAC1Bqe,EACA,IAAK,IAAIhd,EAAI,EAAGA,EAAI00C,EAAiB10C,GAAK,EAAG,CAC5C,IAAIuV,EAAenD,EAAUpS,IAAM,EAC/BshB,EAAKnR,EAASoF,GAAegM,EAAKpR,EAASoF,EAAe,GAC1Ds/B,EAAK1iC,EAAIoD,GAAem7B,EAAKv+B,EAAIoD,EAAe,GAEpDA,EAAenD,EAAUpS,EAAI,IAAM,EACnC,IAAI4hB,EAAKzR,EAASoF,GAAesM,EAAK1R,EAASoF,EAAe,GAC1D3Y,EAAKuV,EAAIoD,GAAe1Y,EAAKsV,EAAIoD,EAAe,GAEpDA,EAAenD,EAAUpS,EAAI,IAAM,EACnC,IAAI0rC,EAAKv7B,EAASoF,GAAeo2B,EAAKx7B,EAASoF,EAAe,GAC1Du/B,EAAK3iC,EAAIoD,GAAeo7B,EAAKx+B,EAAIoD,EAAe,GAEpD,IAAK,IAAI8F,EAAI,EAAGA,EAAIs5B,EAAet5B,IAAK,CACvC,IAAInD,EAAI67B,EAAgBp1C,OACxB,IAAI9D,KAAKg7B,KAAKvU,EAAIC,EAAIK,EAAIC,EAAI6pB,EAAIC,EAAI6B,EAASnyB,GAAIy4B,GA2C5C,CACN,IAAIiB,EAAuBzoC,EAAMQ,aAAainC,EAAiB77B,EAAI,EAAI08B,GACvEG,EAAqB78B,GAAKoJ,EAC1ByzB,EAAqB78B,EAAI,GAAKqJ,EAC9BwzB,EAAqB78B,EAAI,GAAKgV,EAAMjjB,EACpC8qC,EAAqB78B,EAAI,GAAKgV,EAAMhjB,EACpC6qC,EAAqB78B,EAAI,GAAKgV,EAAM/iB,EACpC4qC,EAAqB78B,EAAI,GAAKgV,EAAM9iB,EAC/BuiB,GAsBJooB,EAAqB78B,EAAI,GAAK28B,EAC9BE,EAAqB78B,EAAI,GAAKw4B,EAC9BqE,EAAqB78B,EAAI,GAAKiV,EAAKljB,EACnC8qC,EAAqB78B,EAAI,GAAKiV,EAAKjjB,EACnC6qC,EAAqB78B,EAAI,IAAMiV,EAAKhjB,EACpC4qC,EAAqB78B,EAAI,IAAMiV,EAAK/iB,EAEpC2qC,EAAqB78B,EAAI,IAAM0J,EAC/BmzB,EAAqB78B,EAAI,IAAM2J,EAC/BkzB,EAAqB78B,EAAI,IAAMgV,EAAMjjB,EACrC8qC,EAAqB78B,EAAI,IAAMgV,EAAMhjB,EACrC6qC,EAAqB78B,EAAI,IAAMgV,EAAM/iB,EACrC4qC,EAAqB78B,EAAI,IAAMgV,EAAM9iB,EACrC2qC,EAAqB78B,EAAI,IAAMtb,EAC/Bm4C,EAAqB78B,EAAI,IAAMrb,EAC/Bk4C,EAAqB78B,EAAI,IAAMiV,EAAKljB,EACpC8qC,EAAqB78B,EAAI,IAAMiV,EAAKjjB,EACpC6qC,EAAqB78B,EAAI,IAAMiV,EAAKhjB,EACpC4qC,EAAqB78B,EAAI,IAAMiV,EAAK/iB,EAEpC2qC,EAAqB78B,EAAI,IAAMwzB,EAC/BqJ,EAAqB78B,EAAI,IAAMyzB,EAC/BoJ,EAAqB78B,EAAI,IAAMgV,EAAMjjB,EACrC8qC,EAAqB78B,EAAI,IAAMgV,EAAMhjB,EACrC6qC,EAAqB78B,EAAI,IAAMgV,EAAM/iB,EACrC4qC,EAAqB78B,EAAI,IAAMgV,EAAM9iB,EACrC2qC,EAAqB78B,EAAI,IAAM48B,EAC/BC,EAAqB78B,EAAI,IAAMy4B,EAC/BoE,EAAqB78B,EAAI,IAAMiV,EAAKljB,EACpC8qC,EAAqB78B,EAAI,IAAMiV,EAAKjjB,EACpC6qC,EAAqB78B,EAAI,IAAMiV,EAAKhjB,EACpC4qC,EAAqB78B,EAAI,IAAMiV,EAAK/iB,IApDpC2qC,EAAqB78B,EAAI,GAAK28B,EAC9BE,EAAqB78B,EAAI,GAAKw4B,EAE9BqE,EAAqB78B,EAAI,GAAK0J,EAC9BmzB,EAAqB78B,EAAI,GAAK2J,EAC9BkzB,EAAqB78B,EAAI,IAAMgV,EAAMjjB,EACrC8qC,EAAqB78B,EAAI,IAAMgV,EAAMhjB,EACrC6qC,EAAqB78B,EAAI,IAAMgV,EAAM/iB,EACrC4qC,EAAqB78B,EAAI,IAAMgV,EAAM9iB,EACrC2qC,EAAqB78B,EAAI,IAAMtb,EAC/Bm4C,EAAqB78B,EAAI,IAAMrb,EAE/Bk4C,EAAqB78B,EAAI,IAAMwzB,EAC/BqJ,EAAqB78B,EAAI,IAAMyzB,EAC/BoJ,EAAqB78B,EAAI,IAAMgV,EAAMjjB,EACrC8qC,EAAqB78B,EAAI,IAAMgV,EAAMhjB,EACrC6qC,EAAqB78B,EAAI,IAAMgV,EAAM/iB,EACrC4qC,EAAqB78B,EAAI,IAAMgV,EAAM9iB,EACrC2qC,EAAqB78B,EAAI,IAAM48B,EAC/BC,EAAqB78B,EAAI,IAAMy4B,GAoChCz4B,EAAI87B,EAAiBr1C,OACrB,IAAIq2C,EAAwB1oC,EAAMQ,aAAaknC,EAAkB97B,EAAI,GACrE88B,EAAsB98B,GAAKxY,EAC3Bs1C,EAAsB98B,EAAI,GAAMxY,EAAQ,EACxCs1C,EAAsB98B,EAAI,GAAMxY,EAAQ,EACxCA,GAAS,EACT,SAASsd,CACV,CAlHgE,CAC/D,IAAIi4B,EAAmBnB,EAAWn1C,OAClC,GAAwB,GAApBs2C,EAAuB,SAC3B,IAAIC,EAAKrzB,EAAK8pB,EAAIwJ,EAAKzJ,EAAK9pB,EAAIwzB,EAAK9zB,EAAKoqB,EAAI2J,EAAK1J,EAAKpqB,EACpDnV,EAAI,GAAK8oC,EAAKE,EAAKD,GAAM5zB,EAAKoqB,IAE9B2J,EAAkBL,GAAoB,EACtCM,EAAkB16C,KAAKi5C,WACvBiB,EAAuBzoC,EAAMQ,aAAainC,EAAiB77B,EAAIo9B,EAAkBV,GACrF,IAAK,IAAIpyB,EAAK,EAAGA,EAAKyyB,EAAkBzyB,GAAM,EAAG,CAChD,IAAInjB,EAAIk2C,EAAgB/yB,GAAKjjB,EAAIg2C,EAAgB/yB,EAAK,GACtDuyB,EAAqB78B,GAAK7Y,EAC1B01C,EAAqB78B,EAAI,GAAK3Y,EAC9Bw1C,EAAqB78B,EAAI,GAAKgV,EAAMjjB,EACpC8qC,EAAqB78B,EAAI,GAAKgV,EAAMhjB,EACpC6qC,EAAqB78B,EAAI,GAAKgV,EAAM/iB,EACpC4qC,EAAqB78B,EAAI,GAAKgV,EAAM9iB,EACpC,IAAIorC,EAAKn2C,EAAIqsC,EAAItuB,EAAK7d,EAAIosC,EACtBvhC,GAAK8qC,EAAKM,EAAKL,EAAK/3B,GAAMhR,EAC1BjC,GAAKkrC,EAAKG,EAAKJ,EAAKh4B,GAAMhR,EAC1B5B,EAAI,EAAIJ,EAAID,EAChB4qC,EAAqB78B,EAAI,GAAK28B,EAAKzqC,EAAIxN,EAAKuN,EAAI2qC,EAAKtqC,EACrDuqC,EAAqB78B,EAAI,GAAKw4B,EAAKtmC,EAAIvN,EAAKsN,EAAIwmC,EAAKnmC,EACjDmiB,IACHooB,EAAqB78B,EAAI,GAAKiV,EAAKljB,EACnC8qC,EAAqB78B,EAAI,GAAKiV,EAAKjjB,EACnC6qC,EAAqB78B,EAAI,IAAMiV,EAAKhjB,EACpC4qC,EAAqB78B,EAAI,IAAMiV,EAAK/iB,GAErC8N,GAAK08B,CACN,CAEA18B,EAAI87B,EAAiBr1C,OACrB,IAAIq2C,EAAwB1oC,EAAMQ,aAAaknC,EAAkB97B,EAAI,GAAKo9B,EAAkB,IAC5FA,IACA,IAAK,IAAI9yB,EAAK,EAAGA,EAAK8yB,EAAiB9yB,IACtCwyB,EAAsB98B,GAAKxY,EAC3Bs1C,EAAsB98B,EAAI,GAAMxY,EAAQ8iB,EACxCwyB,EAAsB98B,EAAI,GAAMxY,EAAQ8iB,EAAK,EAC7CtK,GAAK,EAENxY,GAAS41C,EAAkB,CAE5B,CAwED,CACD,CACD,CAIA,IAAAzf,CAAMvU,EAAYC,EAAYK,EAAYC,EAAY6pB,EAAYC,EAAY8J,EAA6BC,GAC1G,IAAIC,EAAiBD,EACjBE,GAAU,EAGVniB,EAAuB,KACvBgiB,EAAa92C,OAAS,GAAK,GAC9B80B,EAAQiiB,EACRA,EAAS76C,KAAKo5C,SAEdxgB,EAAQ54B,KAAKo5C,QAEdxgB,EAAM90B,OAAS,EACf80B,EAAM7zB,KAAK0hB,GACXmS,EAAM7zB,KAAK2hB,GACXkS,EAAM7zB,KAAKgiB,GACX6R,EAAM7zB,KAAKiiB,GACX4R,EAAM7zB,KAAK8rC,GACXjY,EAAM7zB,KAAK+rC,GACXlY,EAAM7zB,KAAK0hB,GACXmS,EAAM7zB,KAAK2hB,GACXm0B,EAAO/2C,OAAS,EAEhB,IAAIk3C,EAAmBJ,EACnBK,EAAuBL,EAAa92C,OAAS,EACjD,IAAK,IAAIqB,EAAI,GAAIA,GAAK,EAAG,CACxB,IAAI+1C,EAAQF,EAAiB71C,GAAIg2C,EAAQH,EAAiB71C,EAAI,GAC1Di2C,EAASJ,EAAiB71C,EAAI,GAAIk2C,EAASL,EAAiB71C,EAAI,GAChEm2C,EAASJ,EAAQE,EAAQG,EAASJ,EAAQE,EAE1CG,EAAgB5iB,EAChB6iB,EAAsB7iB,EAAM90B,OAAS,EAAG43C,EAAcb,EAAO/2C,OACjE,IAAK,IAAI6jB,EAAK,EAAGA,EAAK8zB,EAAqB9zB,GAAM,EAAG,CACnD,IAAIg0B,EAASH,EAAc7zB,GAAKi0B,EAASJ,EAAc7zB,EAAK,GACxDk0B,EAAUL,EAAc7zB,EAAK,GAAIm0B,EAAUN,EAAc7zB,EAAK,GAC9Do0B,EAAQT,GAAUQ,EAAUT,GAAUE,GAAUM,EAAUT,GAAU,EACxE,GAAIE,GAAUM,EAASP,GAAUE,GAAUI,EAASP,GAAU,EAAG,CAChE,GAAIW,EAAO,CACVlB,EAAO91C,KAAK82C,GACZhB,EAAO91C,KAAK+2C,GACZ,QACD,CAEA,IAAInB,EAAKmB,EAAUF,EAAQp5B,EAAKq5B,EAAUF,EACtCt+B,EAAIs9B,GAAMS,EAASF,GAAS14B,GAAM64B,EAASF,GAC/C,GAAIx2C,KAAKC,IAAIyY,GAAK,KAAU,CAC3B,IAAI2+B,GAAMx5B,GAAM24B,EAAQS,GAAUjB,GAAMO,EAAQS,IAAWt+B,EAC3Dw9B,EAAO91C,KAAKm2C,GAASE,EAASF,GAASc,GACvCnB,EAAO91C,KAAKo2C,GAASE,EAASF,GAASa,EACxC,MACCnB,EAAO91C,KAAKm2C,GACZL,EAAO91C,KAAKo2C,EAEd,MAAO,GAAIY,EAAO,CACjB,IAAIpB,EAAKmB,EAAUF,EAAQp5B,EAAKq5B,EAAUF,EACtCt+B,EAAIs9B,GAAMS,EAASF,GAAS14B,GAAM64B,EAASF,GAC/C,GAAIx2C,KAAKC,IAAIyY,GAAK,KAAU,CAC3B,IAAI2+B,GAAMx5B,GAAM24B,EAAQS,GAAUjB,GAAMO,EAAQS,IAAWt+B,EAC3Dw9B,EAAO91C,KAAKm2C,GAASE,EAASF,GAASc,GACvCnB,EAAO91C,KAAKo2C,GAASE,EAASF,GAASa,EACxC,MACCnB,EAAO91C,KAAKm2C,GACZL,EAAO91C,KAAKo2C,GAEbN,EAAO91C,KAAK82C,GACZhB,EAAO91C,KAAK+2C,EACb,CACAf,GAAU,CACX,CAEA,GAAIW,GAAeb,EAAO/2C,OAEzB,OADAg3C,EAAeh3C,OAAS,GACjB,EAMR,GAHA+2C,EAAO91C,KAAK81C,EAAO,IACnBA,EAAO91C,KAAK81C,EAAO,IAEf11C,GAAK81C,EAAsB,MAC/B,IAAIrzB,EAAOizB,GACXA,EAASjiB,GACF90B,OAAS,EAChB80B,EAAQhR,CACT,CAEA,GAAIkzB,GAAkBD,EAAQ,CAC7BC,EAAeh3C,OAAS,EACxB,IAAK,IAAIqB,EAAI,EAAGqG,EAAIqvC,EAAO/2C,OAAS,EAAGqB,EAAIqG,EAAGrG,IAC7C21C,EAAe31C,GAAK01C,EAAO11C,EAC7B,MACC21C,EAAeh3C,OAASg3C,EAAeh3C,OAAS,EAEjD,OAAOi3C,CACR,CAEO,oBAAOvB,CAAelI,GAC5B,IAAIh8B,EAAWg8B,EACX2K,EAAiB3K,EAAQxtC,OAEzBo4C,EAAO5mC,EAAS2mC,EAAiB,GAAK3mC,EAAS,GAAKA,EAAS,GAAKA,EAAS2mC,EAAiB,GAAIlF,EAAM,EAAGC,EAAM,EAAGC,EAAM,EAAGC,EAAM,EACrI,IAAK,IAAI/xC,EAAI,EAAGqG,EAAIywC,EAAiB,EAAG92C,EAAIqG,EAAGrG,GAAK,EACnD4xC,EAAMzhC,EAASnQ,GACf6xC,EAAM1hC,EAASnQ,EAAI,GACnB8xC,EAAM3hC,EAASnQ,EAAI,GACnB+xC,EAAM5hC,EAASnQ,EAAI,GACnB+2C,GAAQnF,EAAMG,EAAMD,EAAMD,EAE3B,KAAIkF,EAAO,GAEX,IAAK,IAAI/2C,EAAI,EAAG2gC,EAAQmW,EAAiB,EAAGzwC,EAAIywC,GAAkB,EAAG92C,EAAIqG,EAAGrG,GAAK,EAAG,CACnF,IAAIX,EAAI8Q,EAASnQ,GAAIT,EAAI4Q,EAASnQ,EAAI,GAClC2O,EAAQgyB,EAAQ3gC,EACpBmQ,EAASnQ,GAAKmQ,EAASxB,GACvBwB,EAASnQ,EAAI,GAAKmQ,EAASxB,EAAQ,GACnCwB,EAASxB,GAAStP,EAClB8Q,EAASxB,EAAQ,GAAKpP,CACvB,CACD,EClTD,MAAMy3C,GACc7mC,SAAoCk3B,YAA4B4P,UAAnF,WAAAt8C,CAAmBwV,EAAoCk3B,EAA4B4P,GAAhE,KAAA9mC,SAAAA,EAAoC,KAAAk3B,YAAAA,EAA4B,KAAA4P,UAAAA,CAAoB,EAGjG,MAAMC,GACZtwC,sBAAwB,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAExCU,oBAAqB,EACrB6vC,aAA6B,KACrB3kC,UAAY,IAAIxI,EAChBmsB,WAAa,IAAInsB,EACjBmG,SACAykC,WAAa,EACbzK,cAAe,EACfiN,WAAyB,IAAIJ,GAAW,KAAM,EAAG,GACjDK,QAA4B,IAAI1D,GAChClxB,KAAO,IAAIhU,EACX6oC,MAAQ,IAAI7oC,EACZ8oC,MAAQ,IAAIvtC,EACZwtC,MAAQ,IAAIxtC,EAEpB,WAAArP,CAAa+M,EAAuCyiC,GAAwB,GAC3EtvC,KAAKsvC,aAAeA,EAChBA,IACHtvC,KAAK+5C,YAAc,GACpB/5C,KAAKsV,SAAW7D,EAAMc,cAAgC,KAAlBvS,KAAK+5C,WAC1C,CAEA,IAAA5M,CAAMyP,EAAyB7mC,EAAoB8mC,GAAyB,EAAIC,GAAuB,GACtG,IAAIN,EAAUx8C,KAAKw8C,QACf/vC,EAAqBzM,KAAKyM,mBAC1B6iC,EAAetvC,KAAKsvC,aACpBrjC,EAAuB,KAEvB8wC,EAAU/8C,KAAK4nB,KACfo1B,EAASh9C,KAAKy8C,MACdQ,EAAYj9C,KAAK08C,MACjBQ,EAAWl9C,KAAK28C,MAEhBJ,EAAyBv8C,KAAKu8C,WAC9BjlC,EAAyB,KACzBC,EAA2B,KAC3B4S,EAAYpU,EAASoU,UACrBgzB,EAAyB,KACzBC,EAAgBrnC,EAAS/F,MACzB+pC,EAAazK,EAAe,GAAK,EACjC+N,GAAU,GACS,GAAnBR,IAAsBQ,GAAU,GACpC,IAAK,IAAIl4C,EAAI,EAAGqG,EAAI2e,EAAUrmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CACjD,IAAIm4C,EAAoBd,EAAQ7C,aAAe,EAAII,EAC/CrkC,EAAOyU,EAAUhlB,GACrB,IAAKuQ,EAAKM,KAAKmG,OAAQ,CACtBqgC,EAAQ/C,gBAAgB/jC,GACxB,QACD,CAMA,GAJImnC,GAAkB,GAAKA,GAAkBnnC,EAAK/O,KAAK9B,QACtDw4C,GAAU,IAGNA,EAAS,CACbb,EAAQ/C,gBAAgB/jC,GACxB,QACD,CAEIonC,GAAgB,GAAKA,GAAgBpnC,EAAK/O,KAAK9B,QAClDw4C,GAAU,GAGX,IAAItmC,EAAarB,EAAK4O,gBAClBxf,EAAqB,KACzB,GAAIiS,aAAsB8B,EAAkB,CAC3C,IAAI9U,EAA2BgT,EAC/BwlC,EAAWjnC,SAAWtV,KAAKsV,SAC3BinC,EAAW/P,YAAc,EACzB+P,EAAWH,UAAYkB,GAAqB,EAC5Cv5C,EAAO0R,qBAAqBC,EAAKM,KAAMumC,EAAWjnC,SAAU,EAAGgoC,GAC/D/lC,EAAY8kC,GAAiBkB,eAC7BjmC,EAAMvT,EAAOuT,IACbxS,EAA0Cf,EAAOA,OAAOnC,aAAckD,QACtEq4C,EAAkBp5C,EAAOiM,KAC1B,KAAO,MAAI+G,aAAsBK,GAa1B,IAAIL,aAAsBG,EAAoB,CACpD,IAAI8jB,EAA2B,EAC/BwhB,EAAQjD,UAAU7jC,EAAMslB,GACxB,QACD,CACCwhB,EAAQ/C,gBAAgB/jC,GACxB,QACD,CApBiD,CAChD,IAAIkY,EAAuB7W,EAC3BwlC,EAAWjnC,SAAWtV,KAAKsV,SAC3BinC,EAAW/P,YAAe5e,EAAKrY,qBAAuB,EACtDgnC,EAAWH,UAAYG,EAAW/P,YAAc8Q,EAC5Cf,EAAWH,UAAYG,EAAWjnC,SAASxR,SAC9Cy4C,EAAWjnC,SAAWtV,KAAKsV,SAAW7D,EAAMc,cAAcgqC,EAAWH,YAEtExuB,EAAKnY,qBAAqBC,EAAM,EAAGkY,EAAKrY,oBAAqBgnC,EAAWjnC,SAAU,EAAGgoC,GACrF/lC,EAAYqW,EAAKrW,UACjBzS,EAA0C8oB,EAAK7pB,OAAOnC,aAAckD,QACpEwS,EAAMsW,EAAKtW,IACX6lC,EAAkBvvB,EAAK5d,KACxB,CAOA,CAEA,GAAe,MAAXlL,EAAiB,CACpB,IAAI04C,EAAY9nC,EAAK1F,MACjBytC,EAAaz9C,KAAK2X,UACtB8lC,EAAWruC,EAAIguC,EAAchuC,EAAIouC,EAAUpuC,EAAI+tC,EAAgB/tC,EAC/DquC,EAAWpuC,EAAI+tC,EAAc/tC,EAAImuC,EAAUnuC,EAAI8tC,EAAgB9tC,EAC/DouC,EAAWnuC,EAAI8tC,EAAc9tC,EAAIkuC,EAAUluC,EAAI6tC,EAAgB7tC,EAC/DmuC,EAAWluC,EAAI6tC,EAAc7tC,EAAIiuC,EAAUjuC,EAAI4tC,EAAgB5tC,EAC3D9C,IACHgxC,EAAWruC,GAAKquC,EAAWluC,EAC3BkuC,EAAWpuC,GAAKouC,EAAWluC,EAC3BkuC,EAAWnuC,GAAKmuC,EAAWluC,GAE5B,IAAIgZ,EAAYvoB,KAAKs7B,WACC,MAAlB5lB,EAAK6S,UACRA,EAAU/Y,IAAI,EAAG,EAAG,EAAG,IAEnB/C,GACH8b,EAAUnZ,EAAIsG,EAAK6S,UAAUnZ,EAAIquC,EAAWluC,EAC5CgZ,EAAUlZ,EAAIqG,EAAK6S,UAAUlZ,EAAIouC,EAAWluC,EAC5CgZ,EAAUjZ,EAAIoG,EAAK6S,UAAUjZ,EAAImuC,EAAWluC,GAE5CgZ,EAAU7Y,aAAagG,EAAK6S,WAE7BA,EAAUhZ,EAAI9C,EAAqB,EAAM,GAG1C,IAAIixC,EAAgBhoC,EAAK/O,KAAKsF,UAM9B,GALIyxC,GAAiBzxC,IACpBA,EAAYyxC,EACZd,EAAQjN,aAAa7jC,EAAwBU,qBAAqBP,EAAWQ,GAAqBX,EAAwBE,mBAAmBC,KAG1IuwC,EAAQ7C,aAAc,CACzB6C,EAAQ5C,cAAc2C,EAAWjnC,SAAUinC,EAAWH,UAAW7kC,EAAWA,EAAUzT,OAAQwT,EAAKmmC,EAAYl1B,EAAW+mB,GAC1H,IAAI4J,EAAkB,IAAIzmC,aAAa+pC,EAAQtD,iBAC3CC,EAAmBqD,EAAQrD,iBAC/B,GAAyB,MAArBn5C,KAAKs8C,aAAsB,CAC9B,IAAIA,EAAet8C,KAAKs8C,aACpBqB,EAAQzE,EACZ,GAAK5J,EAmBJ,IAAK,IAAIxtC,EAAI,EAAG0J,EAAI0tC,EAAgBp1C,OAAQhC,EAAI0J,EAAG1J,GAAKi4C,EACvDgD,EAAQv4C,EAAIm5C,EAAM77C,GAClBi7C,EAAQr4C,EAAIi5C,EAAM77C,EAAI,GACtBm7C,EAAUztC,IAAImuC,EAAM77C,EAAI,GAAI67C,EAAM77C,EAAI,GAAI67C,EAAM77C,EAAI,GAAI67C,EAAM77C,EAAI,IAClEk7C,EAAOx4C,EAAIm5C,EAAM77C,EAAI,GACrBk7C,EAAOt4C,EAAIi5C,EAAM77C,EAAI,GACrBo7C,EAAS1tC,IAAImuC,EAAM77C,EAAI,GAAI67C,EAAM77C,EAAI,GAAI67C,EAAM77C,EAAI,IAAK67C,EAAM77C,EAAI,KAClEw6C,EAAard,UAAU8d,EAASC,EAAQC,EAAWC,GACnDS,EAAM77C,GAAKi7C,EAAQv4C,EACnBm5C,EAAM77C,EAAI,GAAKi7C,EAAQr4C,EACvBi5C,EAAM77C,EAAI,GAAKm7C,EAAU7tC,EACzBuuC,EAAM77C,EAAI,GAAKm7C,EAAU5tC,EACzBsuC,EAAM77C,EAAI,GAAKm7C,EAAU3tC,EACzBquC,EAAM77C,EAAI,GAAKm7C,EAAU1tC,EACzBouC,EAAM77C,EAAI,GAAKk7C,EAAOx4C,EACtBm5C,EAAM77C,EAAI,GAAKk7C,EAAOt4C,EACtBi5C,EAAM77C,EAAI,GAAKo7C,EAAS9tC,EACxBuuC,EAAM77C,EAAI,GAAKo7C,EAAS7tC,EACxBsuC,EAAM77C,EAAI,IAAMo7C,EAAS5tC,EACzBquC,EAAM77C,EAAI,IAAMo7C,EAAS3tC,OArC1B,IAAK,IAAIzN,EAAI,EAAG0J,EAAI0tC,EAAgBp1C,OAAQhC,EAAI0J,EAAG1J,GAAKi4C,EACvDgD,EAAQv4C,EAAIm5C,EAAM77C,GAClBi7C,EAAQr4C,EAAIi5C,EAAM77C,EAAI,GACtBm7C,EAAUztC,IAAImuC,EAAM77C,EAAI,GAAI67C,EAAM77C,EAAI,GAAI67C,EAAM77C,EAAI,GAAI67C,EAAM77C,EAAI,IAClEk7C,EAAOx4C,EAAIm5C,EAAM77C,EAAI,GACrBk7C,EAAOt4C,EAAIi5C,EAAM77C,EAAI,GACrBo7C,EAAS1tC,IAAI,EAAG,EAAG,EAAG,GACtB8sC,EAAard,UAAU8d,EAASC,EAAQC,EAAWC,GACnDS,EAAM77C,GAAKi7C,EAAQv4C,EACnBm5C,EAAM77C,EAAI,GAAKi7C,EAAQr4C,EACvBi5C,EAAM77C,EAAI,GAAKm7C,EAAU7tC,EACzBuuC,EAAM77C,EAAI,GAAKm7C,EAAU5tC,EACzBsuC,EAAM77C,EAAI,GAAKm7C,EAAU3tC,EACzBquC,EAAM77C,EAAI,GAAKm7C,EAAU1tC,EACzBouC,EAAM77C,EAAI,GAAKk7C,EAAOx4C,EACtBm5C,EAAM77C,EAAI,GAAKk7C,EAAOt4C,CAyBzB,CACAk4C,EAAQzP,KAAKroC,EAASo0C,EAAiBC,EACxC,KAAO,CACN,IAAIwE,EAAQpB,EAAWjnC,SACvB,GAAyB,MAArBtV,KAAKs8C,aAAsB,CAC9B,IAAIA,EAAet8C,KAAKs8C,aACxB,GAAKhN,EAmBJ,IAAK,IAAIxtC,EAAI,EAAGD,EAAI,EAAG2J,EAAI+wC,EAAWH,UAAWt6C,EAAI0J,EAAG1J,GAAKi4C,EAAYl4C,GAAK,EAC7Ek7C,EAAQv4C,EAAIm5C,EAAM77C,GAClBi7C,EAAQr4C,EAAIi5C,EAAM77C,EAAI,GACtBk7C,EAAOx4C,EAAI8S,EAAIzV,GACfm7C,EAAOt4C,EAAI4S,EAAIzV,EAAI,GACnBo7C,EAAUvtC,aAAa+tC,GACvBP,EAASxtC,aAAa6Y,GACtB+zB,EAAard,UAAU8d,EAASC,EAAQC,EAAWC,GACnDS,EAAM77C,GAAKi7C,EAAQv4C,EACnBm5C,EAAM77C,EAAI,GAAKi7C,EAAQr4C,EACvBi5C,EAAM77C,EAAI,GAAKm7C,EAAU7tC,EACzBuuC,EAAM77C,EAAI,GAAKm7C,EAAU5tC,EACzBsuC,EAAM77C,EAAI,GAAKm7C,EAAU3tC,EACzBquC,EAAM77C,EAAI,GAAKm7C,EAAU1tC,EACzBouC,EAAM77C,EAAI,GAAKk7C,EAAOx4C,EACtBm5C,EAAM77C,EAAI,GAAKk7C,EAAOt4C,EACtBi5C,EAAM77C,EAAI,GAAKo7C,EAAS9tC,EACxBuuC,EAAM77C,EAAI,GAAKo7C,EAAS7tC,EACxBsuC,EAAM77C,EAAI,IAAMo7C,EAAS5tC,EACzBquC,EAAM77C,EAAI,IAAMo7C,EAAS3tC,OArC1B,IAAK,IAAIzN,EAAI,EAAGD,EAAI,EAAG2J,EAAI+wC,EAAWH,UAAWt6C,EAAI0J,EAAG1J,GAAKi4C,EAAYl4C,GAAK,EAC7Ek7C,EAAQv4C,EAAIm5C,EAAM77C,GAClBi7C,EAAQr4C,EAAIi5C,EAAM77C,EAAI,GACtBk7C,EAAOx4C,EAAI8S,EAAIzV,GACfm7C,EAAOt4C,EAAI4S,EAAIzV,EAAI,GACnBo7C,EAAUvtC,aAAa+tC,GACvBP,EAAS1tC,IAAI,EAAG,EAAG,EAAG,GACtB8sC,EAAard,UAAU8d,EAASC,EAAQC,EAAWC,GACnDS,EAAM77C,GAAKi7C,EAAQv4C,EACnBm5C,EAAM77C,EAAI,GAAKi7C,EAAQr4C,EACvBi5C,EAAM77C,EAAI,GAAKm7C,EAAU7tC,EACzBuuC,EAAM77C,EAAI,GAAKm7C,EAAU5tC,EACzBsuC,EAAM77C,EAAI,GAAKm7C,EAAU3tC,EACzBquC,EAAM77C,EAAI,GAAKm7C,EAAU1tC,EACzBouC,EAAM77C,EAAI,GAAKk7C,EAAOx4C,EACtBm5C,EAAM77C,EAAI,GAAKk7C,EAAOt4C,CAyBzB,MACC,GAAK4qC,EAUJ,IAAK,IAAIxtC,EAAI,EAAGD,EAAI,EAAG2J,EAAI+wC,EAAWH,UAAWt6C,EAAI0J,EAAG1J,GAAKi4C,EAAYl4C,GAAK,EAC7E87C,EAAM77C,GAAK27C,EAAWruC,EACtBuuC,EAAM77C,EAAI,GAAK27C,EAAWpuC,EAC1BsuC,EAAM77C,EAAI,GAAK27C,EAAWnuC,EAC1BquC,EAAM77C,EAAI,GAAK27C,EAAWluC,EAC1BouC,EAAM77C,EAAI,GAAKwV,EAAIzV,GACnB87C,EAAM77C,EAAI,GAAKwV,EAAIzV,EAAI,GACvB87C,EAAM77C,EAAI,GAAKymB,EAAUnZ,EACzBuuC,EAAM77C,EAAI,GAAKymB,EAAUlZ,EACzBsuC,EAAM77C,EAAI,GAAKymB,EAAUjZ,EACzBquC,EAAM77C,EAAI,GAAKymB,EAAUhZ,OAnB1B,IAAK,IAAIzN,EAAI,EAAGD,EAAI,EAAG2J,EAAI+wC,EAAWH,UAAWt6C,EAAI0J,EAAG1J,GAAKi4C,EAAYl4C,GAAK,EAC7E87C,EAAM77C,GAAK27C,EAAWruC,EACtBuuC,EAAM77C,EAAI,GAAK27C,EAAWpuC,EAC1BsuC,EAAM77C,EAAI,GAAK27C,EAAWnuC,EAC1BquC,EAAM77C,EAAI,GAAK27C,EAAWluC,EAC1BouC,EAAM77C,EAAI,GAAKwV,EAAIzV,GACnB87C,EAAM77C,EAAI,GAAKwV,EAAIzV,EAAI,GAiB1B,IAAImjC,EAAQuX,EAAWjnC,SAA0B64B,SAAS,EAAGoO,EAAWH,WACxEQ,EAAQzP,KAAKroC,EAASkgC,EAAMztB,EAC7B,CACD,CAEAilC,EAAQ/C,gBAAgB/jC,EACzB,CACA8mC,EAAQ9C,SACT,EPxQM,MAAMkE,GACZ/wC,QACA/B,OAEA+yC,YACAC,kBACAC,OACAnB,QACQtN,cAAe,EACf0O,cACAzI,OACA0I,aACAC,eAAyE,KACjFC,iBACAC,sBACQC,KAAO,CACd,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EACrB,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EACrB,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EACrB,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAEdd,eAAiB,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GACjCe,MAAQ,IAAInvC,EAAM,EAAG,EAAG,EAAG,GAEnC,WAAArP,CAAagL,EAA2B+B,EAA+DyiC,GAAwB,GAC9HtvC,KAAK8K,OAASA,EACd9K,KAAK6M,QAAUA,aAAmBhC,EAA8BgC,EAAU,IAAIhC,EAA6BgC,GAC3G7M,KAAKsvC,aAAeA,EAEpBtvC,KAAK69C,YAAc,IAAIpZ,GAAY35B,EAAO7I,MAAO6I,EAAO5I,QACxDlC,KAAK89C,kBAAoB,IAAIpY,GAAkB56B,EAAO7I,MAAO6I,EAAO5I,QACpElC,KAAK+9C,OAAS/9C,KAAK89C,kBAEnB99C,KAAKg+C,cAAgB1O,EAAe7H,GAAOkE,sBAAsB3rC,KAAK6M,SAAW46B,GAAO6D,mBAAmBtrC,KAAK6M,SAChH7M,KAAK48C,QAAU,IAAI5N,GAAehvC,KAAK6M,QAASyiC,GAChDtvC,KAAKi+C,aAAexW,GAAOoE,WAAW7rC,KAAK6M,SAC3C7M,KAAKu1C,OAAS,IAAIrF,GAAclwC,KAAK6M,SACrC7M,KAAKm+C,iBAAmB,IAAI9B,GAAiBr8C,KAAK6M,QAASyiC,GAC3DtvC,KAAKo+C,sBAAwB,IAAI9J,GAAsBt0C,KAAK6M,QAC7D,CAEA,KAAA0iC,GACCvvC,KAAK+9C,OAAOtwC,SACZzN,KAAKu+C,eAAev+C,KAAK48C,QAC1B,CAEA,YAAA4B,CAAczoC,EAAoBtJ,GAAqB,EAAOowC,GAAiB,EAAIC,GAAe,GACjG98C,KAAKu+C,eAAev+C,KAAK48C,SACzB58C,KAAKm+C,iBAAiB1xC,mBAAqBA,EAC3CzM,KAAKm+C,iBAAiBhR,KAAKntC,KAAK48C,QAAS7mC,EAAU8mC,EAAgBC,EACpE,CAEA,iBAAA2B,CAAkB1oC,EAAoBtJ,GAAqB,EAAO+oC,EAA8B,MAC/Fx1C,KAAKu+C,eAAev+C,KAAKu1C,QACzBv1C,KAAKo+C,sBAAsB3xC,mBAAqBA,EAChDzM,KAAKo+C,sBAAsBjR,KAAKntC,KAAKu1C,OAAQx/B,EAAUy/B,EACxD,CAEA,WAAAkJ,CAAa55C,EAAoBN,EAAWE,EAAWzC,EAAeC,EAAgB8N,EAAe,MACpGhQ,KAAKu+C,eAAev+C,KAAK48C,SACX,OAAV5sC,IAAgBA,EAAQhQ,KAAKs+C,OACjC,IAAIrN,EAAOjxC,KAAKq+C,KAChB,IAAIl5C,EAAI,EACR8rC,EAAK9rC,KAAOX,EACZysC,EAAK9rC,KAAOT,EACZusC,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACRnF,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEb8rC,EAAK9rC,KAAOX,EAAIvC,EAChBgvC,EAAK9rC,KAAOT,EACZusC,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACRnF,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEb8rC,EAAK9rC,KAAOX,EAAIvC,EAChBgvC,EAAK9rC,KAAOT,EAAIxC,EAChB+uC,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACRnF,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEb8rC,EAAK9rC,KAAOX,EACZysC,EAAK9rC,KAAOT,EAAIxC,EAChB+uC,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACRnF,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEbnF,KAAK48C,QAAQzP,KAAKroC,EAASmsC,EAAMjxC,KAAKu9C,eACvC,CAEA,aAAAoB,CAAe75C,EAAoBN,EAAWE,EAAWzC,EAAeC,EAAgBL,EAAWC,EAAWC,EAAYC,EAAYgO,EAAe,MACpJhQ,KAAKu+C,eAAev+C,KAAK48C,SACX,OAAV5sC,IAAgBA,EAAQhQ,KAAKs+C,OACjC,IAAIrN,EAAOjxC,KAAKq+C,KAChB,IAAIl5C,EAAI,EACR8rC,EAAK9rC,KAAOX,EACZysC,EAAK9rC,KAAOT,EACZusC,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAOtD,EACZovC,EAAK9rC,KAAOrD,EACR9B,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEb8rC,EAAK9rC,KAAOX,EAAIvC,EAChBgvC,EAAK9rC,KAAOT,EACZusC,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAOpD,EACZkvC,EAAK9rC,KAAOrD,EACR9B,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEb8rC,EAAK9rC,KAAOX,EAAIvC,EAChBgvC,EAAK9rC,KAAOT,EAAIxC,EAChB+uC,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAOpD,EACZkvC,EAAK9rC,KAAOnD,EACRhC,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEb8rC,EAAK9rC,KAAOX,EACZysC,EAAK9rC,KAAOT,EAAIxC,EAChB+uC,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAOtD,EACZovC,EAAK9rC,KAAOnD,EACRhC,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEbnF,KAAK48C,QAAQzP,KAAKroC,EAASmsC,EAAMjxC,KAAKu9C,eACvC,CAEA,kBAAAqB,CAAoB95C,EAAoBN,EAAWE,EAAWzC,EAAeC,EAAgB28C,EAAgBC,EAAgB5qC,EAAelE,EAAe,KAAMvD,GAA8B,GAC9LzM,KAAKu+C,eAAev+C,KAAK48C,SACX,OAAV5sC,IAAgBA,EAAQhQ,KAAKs+C,OACjC,IAAIrN,EAAOjxC,KAAKq+C,KAGZU,EAAev6C,EAAIq6C,EACnBG,EAAet6C,EAAIo6C,EACnBvM,GAAMsM,EACNrM,GAAMsM,EACNG,EAAMh9C,EAAQ48C,EACdK,EAAMh9C,EAAS48C,EAGf/H,EAAMxE,EACNyE,EAAMxE,EACNyE,EAAM1E,EACN2E,EAAMgI,EACN/H,EAAM8H,EACN7H,EAAM8H,EACNC,EAAMF,EACNG,EAAM5M,EAEN/rB,EAAK,EACLC,EAAK,EACLK,EAAK,EACLC,EAAK,EACL6pB,EAAK,EACLC,EAAK,EACLI,EAAK,EACLC,EAAK,EAGT,GAAa,GAATj9B,EAAY,CACf,IAAIzD,EAAMP,EAAUM,OAAO0D,GACvBtD,EAAMV,EAAUS,OAAOuD,GAE3BuS,EAAKhW,EAAMsmC,EAAMnmC,EAAMomC,EACvBtwB,EAAK9V,EAAMmmC,EAAMtmC,EAAMumC,EAEvB9F,EAAKzgC,EAAMwmC,EAAMrmC,EAAMsmC,EACvB/F,EAAKvgC,EAAMqmC,EAAMxmC,EAAMymC,EAEvBrG,EAAKpgC,EAAM0mC,EAAMvmC,EAAMwmC,EACvBtG,EAAKlgC,EAAMumC,EAAM1mC,EAAM2mC,EAEvBrwB,EAAK8pB,GAAMpqB,EAAKyqB,GAChBlqB,EAAK8pB,GAAMpqB,EAAKyqB,EACjB,MACC1qB,EAAKswB,EACLrwB,EAAKswB,EAEL9F,EAAK+F,EACL9F,EAAK+F,EAELrG,EAAKsG,EACLrG,EAAKsG,EAELrwB,EAAKo4B,EACLn4B,EAAKo4B,EAGN34B,GAAMs4B,EACNr4B,GAAMs4B,EACNj4B,GAAMg4B,EACN/3B,GAAMg4B,EACNnO,GAAMkO,EACNjO,GAAMkO,EACN9N,GAAM6N,EACN5N,GAAM6N,EAEN,IAAI75C,EAAI,EACR8rC,EAAK9rC,KAAOshB,EACZwqB,EAAK9rC,KAAOuhB,EACZuqB,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACRnF,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEb8rC,EAAK9rC,KAAO4hB,EACZkqB,EAAK9rC,KAAO6hB,EACZiqB,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACRnF,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEb8rC,EAAK9rC,KAAO0rC,EACZI,EAAK9rC,KAAO2rC,EACZG,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACRnF,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEb8rC,EAAK9rC,KAAO+rC,EACZD,EAAK9rC,KAAOgsC,EACZF,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACRnF,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEbnF,KAAK48C,QAAQzP,KAAKroC,EAASmsC,EAAMjxC,KAAKu9C,eACvC,CAEA,UAAA8B,CAAYt7C,EAA4BS,EAAWE,EAAWzC,EAAeC,EAAgB8N,EAAe,KAAMvD,GAA8B,GAC/IzM,KAAKu+C,eAAev+C,KAAK48C,SACX,OAAV5sC,IAAgBA,EAAQhQ,KAAKs+C,OACjC,IAAIrN,EAAOjxC,KAAKq+C,KAChB,IAAIl5C,EAAI,EACR8rC,EAAK9rC,KAAOX,EACZysC,EAAK9rC,KAAOT,EACZusC,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAOpB,EAAOlC,EACnBovC,EAAK9rC,KAAOpB,EAAO/B,GACfhC,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEb8rC,EAAK9rC,KAAOX,EAAIvC,EAChBgvC,EAAK9rC,KAAOT,EACZusC,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAOpB,EAAOhC,GACnBkvC,EAAK9rC,KAAOpB,EAAO/B,GACfhC,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEb8rC,EAAK9rC,KAAOX,EAAIvC,EAChBgvC,EAAK9rC,KAAOT,EAAIxC,EAChB+uC,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAOpB,EAAOhC,GACnBkvC,EAAK9rC,KAAOpB,EAAOjC,EACf9B,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEb8rC,EAAK9rC,KAAOX,EACZysC,EAAK9rC,KAAOT,EAAIxC,EAChB+uC,EAAK9rC,KAAO6K,EAAMZ,EAClB6hC,EAAK9rC,KAAO6K,EAAMX,EAClB4hC,EAAK9rC,KAAO6K,EAAMV,EAClB2hC,EAAK9rC,KAAO6K,EAAMT,EAClB0hC,EAAK9rC,KAAOpB,EAAOlC,EACnBovC,EAAK9rC,KAAOpB,EAAOjC,EACf9B,KAAKsvC,eACR2B,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,EACZ8rC,EAAK9rC,KAAO,GAEbnF,KAAK48C,QAAQzP,KAAgBppC,EAAOe,QAASmsC,EAAMjxC,KAAKu9C,eACzD,CAEA,IAAA55C,CAAMa,EAAWE,EAAWqiB,EAAYC,EAAYhX,EAAe,KAAM+gC,EAAgB,MACxF/wC,KAAKu+C,eAAev+C,KAAKu1C,QACzBv1C,KAAKu1C,OAAO5xC,KAAKa,EAAGE,EAAGqiB,EAAIC,EAAIhX,EAChC,CAEA,QAAA2gC,CAAUC,EAAiBpsC,EAAWE,EAAWqiB,EAAYC,EAAY6pB,EAAYC,EAAY9gC,EAAe,KAAM+gC,EAAgB,KAAMC,EAAgB,MAC3JhxC,KAAKu+C,eAAev+C,KAAKu1C,QACzBv1C,KAAKu1C,OAAO5E,SAASC,EAAQpsC,EAAGE,EAAGqiB,EAAIC,EAAI6pB,EAAIC,EAAI9gC,EAAO+gC,EAAQC,EACnE,CAEA,IAAAC,CAAML,EAAiBpsC,EAAWE,EAAWqiB,EAAYC,EAAY6pB,EAAYC,EAAYI,EAAYC,EAAYnhC,EAAe,KAAM+gC,EAAgB,KAAMC,EAAgB,KAAMI,EAAgB,MACrMpxC,KAAKu+C,eAAev+C,KAAKu1C,QACzBv1C,KAAKu1C,OAAOtE,KAAKL,EAAQpsC,EAAGE,EAAGqiB,EAAIC,EAAI6pB,EAAIC,EAAII,EAAIC,EAAInhC,EAAO+gC,EAAQC,EAAQI,EAC/E,CAEA,IAAA5K,CAAMoK,EAAiBpsC,EAAWE,EAAWzC,EAAeC,EAAgB8N,EAAe,MAC1FhQ,KAAKu+C,eAAev+C,KAAKu1C,QACzBv1C,KAAKu1C,OAAO/O,KAAKoK,EAAQpsC,EAAGE,EAAGzC,EAAOC,EAAQ8N,EAC/C,CAEA,QAAAqhC,CAAUT,EAAiBnqB,EAAYC,EAAYK,EAAYC,EAAY/kB,EAAe+N,EAAe,MACxGhQ,KAAKu+C,eAAev+C,KAAKu1C,QACzBv1C,KAAKu1C,OAAOlE,SAAST,EAAQnqB,EAAIC,EAAIK,EAAIC,EAAI/kB,EAAO+N,EACrD,CAEA,OAAAshC,CAASC,EAAoC17B,EAAgBzM,EAAe4G,EAAe,MAC1FhQ,KAAKu+C,eAAev+C,KAAKu1C,QACzBv1C,KAAKu1C,OAAOjE,QAAQC,EAAiB17B,EAAQzM,EAAO4G,EACrD,CAEA,MAAA0hC,CAAQd,EAAiBpsC,EAAWE,EAAWitC,EAAgB3hC,EAAe,KAAMoU,EAAmB,GACtGpkB,KAAKu+C,eAAev+C,KAAKu1C,QACzBv1C,KAAKu1C,OAAO7D,OAAOd,EAAQpsC,EAAGE,EAAGitC,EAAQ3hC,EAAOoU,EACjD,CAEA,KAAA6B,CAAOQ,EAAYC,EAAYC,EAAaC,EAAaC,EAAaC,EAAaC,EAAYC,EAAY5C,EAAkBpU,EAAe,MAC3IhQ,KAAKu+C,eAAev+C,KAAKu1C,QACzBv1C,KAAKu1C,OAAOtvB,MAAMQ,EAAIC,EAAIC,EAAKC,EAAKC,EAAKC,EAAKC,EAAIC,EAAI5C,EAAUpU,EACjE,CAEA,GAAAysB,GACKz8B,KAAKk+C,iBAAmBl+C,KAAK48C,QAAS58C,KAAK48C,QAAQngB,MAC9Cz8B,KAAKk+C,iBAAmBl+C,KAAKu1C,QAAQv1C,KAAKu1C,OAAO9Y,MAC1Dz8B,KAAKk+C,eAAiB,IACvB,CAEA,MAAAoB,CAAQC,GACP,IAAIz0C,EAAS9K,KAAK8K,OAClB,IAAIuL,EAAIvL,EAAO00C,YACXC,EAAI30C,EAAO40C,aAOf,GANI50C,EAAO7I,OAASoU,GAAKvL,EAAO5I,QAAUu9C,IACzC30C,EAAO7I,MAAQoU,EACfvL,EAAO5I,OAASu9C,GAEjBz/C,KAAK6M,QAAQ9B,GAAG40C,SAAS,EAAG,EAAG70C,EAAO7I,MAAO6I,EAAO5I,QAEhDq9C,IAAezQ,GAAW8Q,cAEvB,GAAIL,IAAezQ,GAAW+Q,OACpC7/C,KAAK+9C,OAAOtY,YAAYpvB,EAAGopC,QACrB,GAAIF,IAAezQ,GAAWgR,IAAK,CACzC,IAAIC,EAAcj1C,EAAO7I,MAAO+9C,EAAel1C,EAAO5I,OAClD+9C,EAAcjgD,KAAK+9C,OAAOnZ,cAAesb,EAAelgD,KAAK+9C,OAAOlZ,eAGpElgB,EAFcu7B,EAAeD,EACfD,EAAeD,EACOE,EAAcF,EAAcG,EAAeF,EACnFhgD,KAAK+9C,OAAOnZ,cAAgBmb,EAAcp7B,EAC1C3kB,KAAK+9C,OAAOlZ,eAAiBmb,EAAer7B,CAC7C,CACA3kB,KAAK+9C,OAAOtwC,QACb,CAEQ,cAAA8wC,CAAe4B,GAClBngD,KAAKk+C,iBAAmBiC,IAC5BngD,KAAKy8B,MACD0jB,aAAoBnR,IACvBhvC,KAAKg+C,cAAc/wC,OACnBjN,KAAKg+C,cAAchT,eAAevD,GAAOiE,WAAY1rC,KAAK+9C,OAAOjZ,eAAevW,QAChFvuB,KAAKg+C,cAAclU,YAAY,YAAa,GAC5C9pC,KAAK48C,QAAQrN,MAAMvvC,KAAKg+C,eACxBh+C,KAAKk+C,eAAiBl+C,KAAK48C,SACjBuD,aAAoBjQ,IAC9BlwC,KAAKi+C,aAAahxC,OAClBjN,KAAKi+C,aAAajT,eAAevD,GAAOiE,WAAY1rC,KAAK+9C,OAAOjZ,eAAevW,QAC/EvuB,KAAKu1C,OAAOhG,MAAMvvC,KAAKi+C,cACvBj+C,KAAKk+C,eAAiBl+C,KAAKu1C,QAE3Bv1C,KAAKk+C,eAAiBl+C,KAAKo+C,sBAE7B,CAEA,OAAAr7C,GACC/C,KAAK48C,QAAQ75C,UACb/C,KAAKg+C,cAAcj7C,UACnB/C,KAAKu1C,OAAOxyC,UACZ/C,KAAKi+C,aAAal7C,UAClB/C,KAAKo+C,sBAAsBr7C,SAC5B,GAGD,SAAY+rC,GACX,yBACA,uBACA,gBACA,CAJD,CAAYA,KAAAA,GAAU,KQzef,MAAMsR,GACZr0C,oBAAsB,EAEdA,cAAgB,EAChBA,kBAAsC,KACtCA,eAAmC,KAEnCo0C,SACAE,KAAkB,KAClBC,QAAqB,KACrBpsC,MAAQ,EACRqsC,QAAU,EACVC,WAAa,IAAIjsC,EACzBksC,gBAAkB,IAAItxC,EAAM,KAAO,KAAO,KAAO,GACzCwI,UAAY,IAAIxI,EAChBuxC,UAAY,EAEZ30C,oBAAsB,iyOAEtBA,uBAAyB,6xUAEjC,WAAAjM,CAAaqgD,GAKZ,GAJAngD,KAAKmgD,SAAWA,EAEhBngD,KAAKwgD,WAAWhsC,SAAW,EAEG,OAA1B4rC,GAAcO,QAAkB,CAEnC,IAAIC,EAAWC,UAAUC,UAAUv7C,QAAQ,WAAa,EAExD66C,GAAcO,QAAU,IAAIh4C,MAC5By3C,GAAcO,QAAQ73C,IAAMs3C,GAAcW,gBACrCH,IAAUR,GAAcO,QAAQ/3C,YAAc,aACnDw3C,GAAcO,QAAQz5C,OAAU2B,IAC/Bu3C,GAAcp6C,QAAQ,EAGvBo6C,GAAcY,WAAa,IAAIr4C,MAC/By3C,GAAcY,WAAWl4C,IAAMs3C,GAAca,aACxCL,IAAUR,GAAcY,WAAWp4C,YAAc,aACtDw3C,GAAcY,WAAW95C,OAAU2B,IAClCu3C,GAAcp6C,QAAQ,CAExB,CACD,CAEA,IAAAmnC,CAAM+T,GAAW,GAChB,GAAIA,GAAYlhD,KAAKugD,QAAUH,GAAce,aAAc,OAE3DnhD,KAAKwgD,WAAW/yC,SAChB,IAAI8B,EAAI5K,KAAKC,IAAID,KAAKiM,IAAI5Q,KAAKwgD,WAAW7rC,UAAY,MACtD3U,KAAKkU,OAASlU,KAAKwgD,WAAW9rC,MAAQ,IAAM,KAAO,EAAI,IAAM/P,KAAKuM,IAAI3B,EAAG,IAEzE,IAAI4wC,EAAWngD,KAAKmgD,SAChBr1C,EAASq1C,EAASr1C,OAClBC,EAAKo1C,EAAStzC,QAAQ9B,GAY1B,GAVAo1C,EAASb,OAAOxQ,GAAW8Q,SAEjBO,EAASpC,OAQdmD,EAIE,CAEN,GADAlhD,KAAKugD,SAAWvgD,KAAKwgD,WAAW9rC,OAAS1U,KAAKwgD,WAAW7rC,UAAY,EAAI,EAAI,GACzE3U,KAAKugD,QAAUH,GAAce,aAEhC,OAED5xC,EAAI,EAAIvP,KAAKugD,QAAUH,GAAce,aACrCnhD,KAAK2X,UAAUjI,aAAa1P,KAAKygD,iBACjCzgD,KAAK2X,UAAUpI,EAAI,GAAKA,EAAI,IAAMA,EAAI,GACtC4wC,EAAS5Q,QACT,IAAI/qC,EAAIsG,EAAO7I,MAAQ,EACvBk+C,EAASlP,MAAK,EACb,EAAEzsC,EAAG,EACLsG,EAAO7I,MAAMuC,EAAG,EAChBsG,EAAO7I,MAAMuC,EAAGsG,EAAO5I,OACvB,EAAEsC,EAAGsG,EAAO5I,OACZlC,KAAK2X,UAAW3X,KAAK2X,UAAW3X,KAAK2X,UAAW3X,KAAK2X,WAOtDwoC,EAAS1jB,KACV,MA3BC1xB,EAAGq2C,WAAWphD,KAAKygD,gBAAgBrxC,EAAGpP,KAAKygD,gBAAgBpxC,EAAGrP,KAAKygD,gBAAgBnxC,EAAGtP,KAAKygD,gBAAgBlxC,GAC3GxE,EAAGmE,MAAMnE,EAAGs2C,kBACZrhD,KAAK2X,UAAUpI,EAAI,EA4BpB,GAFAvP,KAAK2X,UAAUnI,IAAI,EAAG,EAAG,EAAGxP,KAAK2X,UAAUpI,GAEf,GAAxB6wC,GAAcp6C,OAAa,OACb,OAAdhG,KAAKqgD,OACRrgD,KAAKqgD,KAAO,IAAIzzC,EAAUuzC,EAAStzC,QAASuzC,GAAcO,SAC1D3gD,KAAKsgD,QAAU,IAAI1zC,EAAUuzC,EAAStzC,QAASuzC,GAAcY,aAE9DhhD,KAAKqgD,KAAK5yC,QAAO,GACjBzN,KAAKsgD,QAAQ7yC,QAAO,GAEpB,IAAI6zC,EAAYthD,KAAKqgD,KAAKpgD,WAAWgC,MACjCs/C,EAAavhD,KAAKqgD,KAAKpgD,WAAWiC,OAClCs/C,EAAexhD,KAAKsgD,QAAQrgD,WAAWgC,MACvCw/C,EAAgBzhD,KAAKsgD,QAAQrgD,WAAWiC,OAE5Ci+C,EAASvD,QAAQjN,aAAa5kC,EAAG2B,UAAW3B,EAAGoB,qBAC/Cg0C,EAAS5Q,QACT4Q,EAASzB,YAAY1+C,KAAKqgD,MAEvBiB,EAAa,GACdx2C,EAAO5I,OAASq/C,GAAc,EAC/BD,EAAWC,EACXvhD,KAAK2X,WAENwoC,EAASvB,mBACR5+C,KAAKsgD,SAEHkB,EAAgB,GACjB12C,EAAO5I,OAASu/C,GAAiB,EAClCD,EAAcC,EACdD,EAAe,EAAGC,EAAgB,EAClCzhD,KAAKkU,MACLlU,KAAK2X,WAENwoC,EAAS1jB,KAGV,EP7HM,MAAMilB,GACZ31C,sBAAwB,IAAI+hB,EAAU,UAAW,GAAI,GAKrD/hB,kBAAoB,EAKpBA,aAAe,EAOfA,YAAc,EAadA,gBAAkB,EAElBA,aAAe,EACfA,eAAiB,EAGjBpF,KAGAg7C,OAAS,IAAIz+C,MAMb0+C,UAAY,EACZC,aAAe,EAEfxzB,OAAS,IAAInrB,MACbkjC,UAAY,IAAIljC,MAChB4+C,MAAQ,IAAIC,GAAW/hD,MACvBgiD,YAAc,IAAIpzC,EAClBqzC,mBAAoB,EAEpBC,eAAiB,IAAI/uC,GAAiB,IAAM,IAAIgvC,KAEhD,WAAAriD,CAAa6G,GACZ3G,KAAK2G,KAAOA,CACb,CAGA,MAAA8G,CAAQiH,GACPA,GAAS1U,KAAK4hD,UACd,IAAID,EAAS3hD,KAAK2hD,OAClB,IAAK,IAAIx8C,EAAI,EAAGqG,EAAIm2C,EAAO79C,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC9C,IAAIwpB,EAAUgzB,EAAOx8C,GACrB,GAAe,MAAXwpB,EAAiB,SAErBA,EAAQyzB,cAAgBzzB,EAAQ0zB,kBAChC1zB,EAAQ2zB,UAAY3zB,EAAQ4zB,cAE5B,IAAIC,EAAe9tC,EAAQia,EAAQizB,UAEnC,GAAIjzB,EAAQ8zB,MAAQ,EAAG,CAEtB,GADA9zB,EAAQ8zB,OAASD,EACb7zB,EAAQ8zB,MAAQ,EAAG,SACvBD,GAAgB7zB,EAAQ8zB,MACxB9zB,EAAQ8zB,MAAQ,CACjB,CAEA,IAAI9L,EAAOhoB,EAAQgoB,KACnB,GAAY,MAARA,EAAc,CAEjB,IAAI+L,EAAW/zB,EAAQ2zB,UAAY3L,EAAK8L,MACxC,GAAIC,GAAY,EAAG,CAKlB,IAJA/L,EAAK8L,MAAQ,EACb9L,EAAKgM,WAAkC,GAArBh0B,EAAQizB,UAAiB,GAAKc,EAAW/zB,EAAQizB,UAAYltC,GAASiiC,EAAKiL,UAC7FjzB,EAAQg0B,WAAaH,EACrBxiD,KAAK4iD,WAAWz9C,EAAGwxC,GAAM,GACC,MAAnBA,EAAKkM,YACXlM,EAAKmM,SAAWpuC,EAChBiiC,EAAOA,EAAKkM,WAEb,QACD,CACD,MAAO,GAAIl0B,EAAQ2zB,WAAa3zB,EAAQo0B,UAAkC,MAAtBp0B,EAAQk0B,WAAoB,CAC/ElB,EAAOx8C,GAAK,KACZnF,KAAK8hD,MAAMrlB,IAAI9N,GACf3uB,KAAKgjD,YAAYr0B,GACjB,QACD,CACA,GAA0B,MAAtBA,EAAQk0B,YAAsB7iD,KAAKijD,iBAAiBt0B,EAASja,GAAQ,CAExE,IAAIwuC,EAAOv0B,EAAQk0B,WAGnB,IAFAl0B,EAAQk0B,WAAa,KACT,MAARK,IAAcA,EAAKC,SAAW,MACnB,MAARD,GACNljD,KAAK8hD,MAAMrlB,IAAIymB,GACfA,EAAOA,EAAKL,UAEd,CAEAl0B,EAAQg0B,WAAaH,CACtB,CAEAxiD,KAAK8hD,MAAMsB,OACZ,CAGA,gBAAAH,CAAkBI,EAAgB3uC,GACjC,IAAIwuC,EAAOG,EAAGR,WACd,GAAY,MAARK,EAAc,OAAO,EAEzB,IAAII,EAAWtjD,KAAKijD,iBAAiBC,EAAMxuC,GAM3C,OAJAwuC,EAAKd,cAAgBc,EAAKb,kBAC1Ba,EAAKZ,UAAYY,EAAKX,cAGlBc,EAAGP,QAAU,GAAKO,EAAGP,SAAWO,EAAGE,aAEf,GAAnBL,EAAKM,YAAqC,GAAlBH,EAAGE,cAC9BF,EAAGR,WAAaK,EAAKL,WACE,MAAnBK,EAAKL,aAAoBK,EAAKL,WAAWM,SAAWE,GACxDA,EAAGI,eAAiBP,EAAKO,eACzBzjD,KAAK8hD,MAAMrlB,IAAIymB,IAETI,IAGRJ,EAAKP,WAAajuC,EAAQwuC,EAAKtB,UAC/ByB,EAAGP,SAAWpuC,GACP,EACR,CAKA,KAAAwL,CAAOnK,GACN,GAAgB,MAAZA,EAAkB,MAAM,IAAIlV,MAAM,4BAClCb,KAAKiiD,mBAAmBjiD,KAAK0jD,qBAEjC,IAAIr1B,EAASruB,KAAKquB,OACdszB,EAAS3hD,KAAK2hD,OACdgC,GAAU,EAEd,IAAK,IAAIx+C,EAAI,EAAGqG,EAAIm2C,EAAO79C,OAAQqB,EAAIqG,EAAGrG,IAAK,CAC9C,IAAIwpB,EAAUgzB,EAAOx8C,GACrB,GAAe,MAAXwpB,GAAmBA,EAAQ8zB,MAAQ,EAAG,SAC1CkB,GAAU,EACV,IAAI3wC,EAAuB,GAAL7N,EAAS3D,EAAS0uB,MAAQvB,EAAQi1B,SAGpD7jC,EAAM4O,EAAQxjB,MACQ,MAAtBwjB,EAAQk0B,WACX9iC,GAAO/f,KAAK6jD,gBAAgBl1B,EAAS5Y,EAAU/C,GACvC2b,EAAQg0B,WAAah0B,EAAQo0B,UAA4B,MAAhBp0B,EAAQgoB,OACzD52B,EAAM,GAGP,IAAIqiC,EAAgBzzB,EAAQyzB,cAAe0B,EAAgBn1B,EAAQo1B,mBAC/DC,EAAgBr1B,EAAQyI,UAAUrJ,UAAUjqB,OAC5CiqB,EAAYY,EAAQyI,UAAUrJ,UAClC,GAAU,GAAL5oB,GAAiB,GAAP4a,GAAa/M,GAASxR,EAASsN,IAC7C,IAAK,IAAI6Y,EAAK,EAAGA,EAAKq8B,EAAer8B,IAAM,CAI1ClW,EAAMsB,sBAAsBgN,EAAK/M,GACjC,IAAIyoB,EAAW1N,EAAUpG,GACrB8T,aAAoB7I,GACvB5yB,KAAKikD,wBAAwBxoB,EAAU1lB,EAAU+tC,EAAe9wC,GAAO,GAEvEyoB,EAASvb,MAAMnK,EAAUqsC,EAAe0B,EAAez1B,EAAQtO,EAAK/M,EAAOvR,EAAakzB,MAC1F,KACM,CACN,IAAIuvB,EAAev1B,EAAQu1B,aAEvBC,EAAiD,GAApCx1B,EAAQy1B,kBAAkBtgD,OACvCqgD,GAAY1yC,EAAMQ,aAAa0c,EAAQy1B,kBAAmBJ,GAAiB,EAAG,MAClF,IAAII,EAAoBz1B,EAAQy1B,kBAEhC,IAAK,IAAIz8B,EAAK,EAAGA,EAAKq8B,EAAer8B,IAAM,CAC1C,IAAI8T,EAAW1N,EAAUpG,GACrB08B,EAAgBH,EAAav8B,IAAQ+5B,GAAe4C,WAAatxC,EAAQxR,EAASyuB,MAClFwL,aAAoB5L,EACvB7vB,KAAKukD,oBAAoB9oB,EAAU1lB,EAAU+tC,EAAe/jC,EAAKskC,EAAeD,EAAmBz8B,GAAM,EAAGw8B,GAClG1oB,aAAoB7I,GAC9B5yB,KAAKikD,wBAAwBxoB,EAAU1lB,EAAU+tC,EAAe9wC,GAAO,IAGvEvB,EAAMsB,sBAAsBgN,EAAK/M,GACjCyoB,EAASvb,MAAMnK,EAAUqsC,EAAe0B,EAAez1B,EAAQtO,EAAKskC,EAAe5iD,EAAakzB,OAElG,CACD,CACA30B,KAAKwkD,YAAY71B,EAASm1B,GAC1Bz1B,EAAOvqB,OAAS,EAChB6qB,EAAQ0zB,kBAAoByB,EAC5Bn1B,EAAQ4zB,cAAgB5zB,EAAQg0B,SACjC,CAOA,IAFA,IAAI8B,EAAazkD,KAAK6hD,aAAeH,GAAegD,MAChDx6B,EAAQnU,EAASmU,MACZ/kB,EAAI,EAAGqG,EAAIuK,EAASmU,MAAMpmB,OAAQqB,EAAIqG,EAAGrG,IAAK,CACtD,IAAIuQ,EAAOwU,EAAM/kB,GACjB,GAAIuQ,EAAK+S,iBAAmBg8B,EAAY,CACvC,IAAI17B,EAAiBrT,EAAK/O,KAAKoiB,eAC/BrT,EAAKqB,WAAgC,MAAlBgS,EAAyB,KAAOhT,EAASuO,cAAc5O,EAAK/O,KAAK9B,MAAOkkB,EAC5F,CACD,CAIA,OAHA/oB,KAAK6hD,cAAgB,EAErB7hD,KAAK8hD,MAAMsB,QACJO,CACR,CAEA,eAAAE,CAAiBR,EAAgBttC,EAAoB/C,GACpD,IAAIkwC,EAAOG,EAAGR,WACS,MAAnBK,EAAKL,YAAoB7iD,KAAK6jD,gBAAgBX,EAAMntC,EAAU/C,GAElE,IAAI+M,EAAM,EACY,GAAlBsjC,EAAGE,aACNxjC,EAAM,EACF/M,GAASxR,EAAS0uB,QAAOld,EAAQxR,EAASyuB,SAE9ClQ,EAAMsjC,EAAGP,QAAUO,EAAGE,YAClBxjC,EAAM,IAAGA,EAAM,GACf/M,GAASxR,EAAS0uB,QAAOld,EAAQkwC,EAAKU,WAG3C,IAAIv1B,EAAStO,EAAMmjC,EAAKyB,eAAiB3kD,KAAKquB,OAAS,KACnDnC,EAAcnM,EAAMmjC,EAAK0B,oBAAqBz6B,EAAYpK,EAAMmjC,EAAK2B,mBACrEzC,EAAgBc,EAAKd,cAAe0B,EAAgBZ,EAAKa,mBACzDC,EAAgBd,EAAK9rB,UAAUrJ,UAAUjqB,OACzCiqB,EAAYm1B,EAAK9rB,UAAUrJ,UAC3B+2B,EAAY5B,EAAK/3C,MAAQk4C,EAAGI,eAAgBsB,EAAWD,GAAa,EAAI/kC,GAC5E,GAAI/M,GAASxR,EAASsN,IACrB,IAAK,IAAI3J,EAAI,EAAGA,EAAI6+C,EAAe7+C,IAClC4oB,EAAU5oB,GAAG+a,MAAMnK,EAAUqsC,EAAe0B,EAAez1B,EAAQ02B,EAAU/xC,EAAOvR,EAAawvB,YAC5F,CACN,IAAIizB,EAAehB,EAAKgB,aACpBc,EAAkB9B,EAAK8B,gBAEvBb,EAA8C,GAAjCjB,EAAKkB,kBAAkBtgD,OACpCqgD,GAAY1yC,EAAMQ,aAAaixC,EAAKkB,kBAAmBJ,GAAiB,EAAG,MAC/E,IAAII,EAAoBlB,EAAKkB,kBAE7BlB,EAAKM,WAAa,EAClB,IAAK,IAAIr+C,EAAI,EAAGA,EAAI6+C,EAAe7+C,IAAK,CACvC,IAEIk/C,EAFA5oB,EAAW1N,EAAU5oB,GACrBF,EAAYxD,EAAawvB,OAEzB9lB,EAAQ,EACZ,OAAQ+4C,EAAa/+C,IACrB,KAAKu8C,GAAe4C,WACnB,IAAKn6B,GAAasR,aAAoB7H,GAAmB,SACzDywB,EAAgBrxC,EAChB7H,EAAQ45C,EACR,MACD,KAAKrD,GAAeuD,MACnBZ,EAAgB7iD,EAASyuB,MACzB9kB,EAAQ45C,EACR,MACD,KAAKrD,GAAewD,KACnBb,EAAgB7iD,EAASyuB,MACzB9kB,EAAQ25C,EACR,MACD,QACCT,EAAgB7iD,EAASyuB,MACzB,IAAIk1B,EAAUH,EAAgB7/C,GAC9BgG,EAAQ25C,EAAYngD,KAAK4L,IAAI,EAAG,EAAI40C,EAAQrC,QAAUqC,EAAQ5B,aAG/DL,EAAKM,YAAcr4C,EAEfswB,aAAoB5L,EACvB7vB,KAAKukD,oBAAoB9oB,EAAU1lB,EAAU+tC,EAAe34C,EAAOk5C,EAAeD,EAAmBj/C,GAAK,EAAGg/C,GACrG1oB,aAAoB7I,GAC5B5yB,KAAKikD,wBAAwBxoB,EAAU1lB,EAAU+tC,EAAeO,EAAen4B,IAG/Eza,EAAMsB,sBAAsB5H,EAAO6H,GAC/BmX,GAAasR,aAAoB7H,IAAqBywB,GAAiB7iD,EAASyuB,QACnFhrB,EAAYxD,EAAakzB,OAC1B8G,EAASvb,MAAMnK,EAAUqsC,EAAe0B,EAAez1B,EAAQljB,EAAOk5C,EAAep/C,GAEvF,CACD,CAOA,OALIo+C,EAAGE,YAAc,GAAGvjD,KAAKwkD,YAAYtB,EAAMY,GAC/C9jD,KAAKquB,OAAOvqB,OAAS,EACrBo/C,EAAKb,kBAAoByB,EACzBZ,EAAKX,cAAgBW,EAAKP,UAEnB5iC,CACR,CAEA,uBAAAkkC,CAAyBxoB,EAA8B1lB,EAAoB6S,EAAc5V,EAAiBkZ,GAEzG,IAAIxW,EAAOK,EAASmU,MAAMuR,EAAS7P,WACnC,GAAKlW,EAAKM,KAAKmG,OAAf,CAEA,IAMK+S,EANDY,EAAS2L,EAAS3L,OAClBlH,EAAOkH,EAAO,GACb9c,GAASxR,EAASyuB,OAASjd,GAASxR,EAAS0uB,OAChDlwB,KAAK2oB,cAAc5S,EAAUL,EAAMA,EAAK/O,KAAKoiB,eAAgBmD,IAK7DgD,EADGtG,GAAQkH,EAAOA,EAAOhsB,OAAS,GACrBgsB,EAAOhsB,OAAS,EAEhBgqB,EAAUQ,aAAawB,EAAQlH,GAAQ,EACrD5oB,KAAK2oB,cAAc5S,EAAUL,EAAM+lB,EAAS5I,gBAAgB3D,GAAahD,IAItExW,EAAK+S,iBAAmBzoB,KAAK6hD,eAAcnsC,EAAK+S,gBAAkBzoB,KAAK6hD,aAAeH,GAAegD,MAjB5E,CAkB9B,CAEA,aAAA/7B,CAAe5S,EAAoBL,EAAYqT,EAAwBmD,GACtExW,EAAKqB,WAA+B,MAAlBgS,EAAyB,KAAOhT,EAASuO,cAAc5O,EAAK/O,KAAK9B,MAAOkkB,GACtFmD,IAAaxW,EAAK+S,gBAAkBzoB,KAAK6hD,aAAeH,GAAe0D,QAC5E,CAGA,mBAAAb,CAAqB9oB,EAAoB1lB,EAAoB6S,EAAczd,EAAe6H,EACzFoxC,EAAkCj/C,EAAWg/C,GAI7C,GAFIA,IAAYC,EAAkBj/C,GAAK,GAE1B,GAATgG,EAEH,YADAswB,EAASvb,MAAMnK,EAAU,EAAG6S,EAAM,KAAM,EAAG5V,EAAOvR,EAAakzB,OAIhE,IAAI0wB,EAAiB5pB,EACjB3L,EAASu1B,EAAev1B,OACxB9Z,EAAOD,EAASV,MAAMgwC,EAAej5B,WACzC,IAAKpW,EAAKmG,OAAQ,OAClB,IAAIwG,EAAK,EAAGoP,EAAK,EACjB,GAAInJ,EAAOkH,EAAO,GACjB,OAAQ9c,GACP,KAAKxR,EAASyuB,MACbja,EAAKuC,SAAWvC,EAAKrP,KAAK4R,SAC3B,QACC,OACD,KAAK/W,EAAS0uB,MACbvN,EAAK3M,EAAKuC,SACVwZ,EAAK/b,EAAKrP,KAAK4R,cAIjB,GADAoK,EAAK3P,GAASxR,EAASyuB,MAAQja,EAAKrP,KAAK4R,SAAWvC,EAAKuC,SACrDqQ,GAAQkH,EAAOA,EAAOhsB,OAAS+rB,EAAeM,SACjD4B,EAAK/b,EAAKrP,KAAK4R,SAAWuX,EAAOA,EAAOhsB,OAAS+rB,EAAeO,mBAC5D,CAEJ,IAAIE,EAAQxC,EAAUQ,aAAawB,EAAQlH,EAAMiH,EAAeM,SAC5DI,EAAeT,EAAOQ,EAAQT,EAAeO,eAC7Cpb,EAAY8a,EAAOQ,GACnBZ,EAAU21B,EAAe51B,iBAAiBa,GAAS,GAAK,EAC3D,GAAK1H,EAAO5T,IAAc8a,EAAOQ,EAAQT,EAAeW,WAAaxb,IAEtE+c,EAAKjC,EAAOQ,EAAQT,EAAeG,UAAYO,EAC/CwB,GAAwD,KAAjD,OAAU,mBAAqBA,EAAK,IAAO,IAClDA,EAAKxB,EAAewB,EAAKrC,EAAU1Z,EAAKrP,KAAK4R,SAC7CwZ,GAAwD,KAAjD,OAAU,mBAAqBA,EAAK,IAAO,GACnD,CAID,IAAIuzB,EAAQ,EAAGC,EAAOxzB,EAAKpP,EAE3B,GADA4iC,GAA4D,KAAnD,OAAU,mBAAqBA,EAAO,IAAO,IAC1C,GAARA,EACHD,EAAQlB,EAAkBj/C,OACpB,CACN,IAAIqgD,EAAY,EAAGC,EAAW,EAC1BtB,GACHqB,EAAY,EACZC,EAAWF,IAEXC,EAAYpB,EAAkBj/C,GAC9BsgD,EAAWrB,EAAkBj/C,EAAI,IAElC,IAAIwpB,EAAU42B,EAAO,EAAGG,EAAMF,GAAa,EAEvCt1C,EAAUW,OAAO40C,IAAav1C,EAAUW,OAAO00C,IAAS5gD,KAAKC,IAAI6gD,IAAa,KAE7E9gD,KAAKC,IAAI4gD,GAAa,MAAKA,GAAa,IAAMt1C,EAAUW,OAAO20C,IACnEE,EAAM/2B,GAEP22B,EAAQC,EAAOC,EAAYA,EAAY,IACnCE,GAAO/2B,IAAS22B,GAAS,IAAMp1C,EAAUW,OAAO20C,IACpDpB,EAAkBj/C,GAAKmgD,CACxB,CACAlB,EAAkBj/C,EAAI,GAAKogD,EAC3B5iC,GAAM2iC,EAAQn6C,EACd6K,EAAKuC,SAAWoK,EAAuD,KAAjD,OAAU,mBAAqBA,EAAK,IAAO,GAClE,CAEA,WAAA6hC,CAAamB,EAAmB7B,GAC/B,IAAI8B,EAAiBD,EAAMC,eAAgBC,EAAeF,EAAME,aAC5D53B,EAAW43B,EAAeD,EAC1BE,EAAmBH,EAAMrD,UAAYr0B,EAGrCI,EAASruB,KAAKquB,OACdlpB,EAAI,EAAGqG,EAAI6iB,EAAOvqB,OACtB,KAAOqB,EAAIqG,EAAGrG,IAAK,CAClB,IAAIuuB,EAAQrF,EAAOlpB,GACnB,GAAIuuB,EAAM9K,KAAOk9B,EAAkB,MAC/BpyB,EAAM9K,KAAOi9B,GACjB7lD,KAAK8hD,MAAMpuB,MAAMiyB,EAAOjyB,EACzB,CAGA,IAAIwtB,GAAW,EAQf,IANCA,EADGyE,EAAMv3B,KACc,GAAZH,GAAiB63B,EAAmBH,EAAMhD,UAAY10B,EAEtD61B,GAAiB+B,GAAgBF,EAAMvD,cAAgByD,EAC/D3E,GAAUlhD,KAAK8hD,MAAMZ,SAASyE,GAG3BxgD,EAAIqG,EAAGrG,IACDkpB,EAAOlpB,GACTyjB,KAAOg9B,GACjB5lD,KAAK8hD,MAAMpuB,MAAMiyB,EAAOt3B,EAAOlpB,GAEjC,CAMA,WAAA4gD,GACC,IAAIC,EAAmBhmD,KAAK8hD,MAAMmE,cAClCjmD,KAAK8hD,MAAMmE,eAAgB,EAC3B,IAAK,IAAI9gD,EAAI,EAAGqG,EAAIxL,KAAK2hD,OAAO79C,OAAQqB,EAAIqG,EAAGrG,IAC9CnF,KAAKkmD,WAAW/gD,GACjBnF,KAAK2hD,OAAO79C,OAAS,EACrB9D,KAAK8hD,MAAMmE,cAAgBD,EAC3BhmD,KAAK8hD,MAAMsB,OACZ,CAMA,UAAA8C,CAAYC,GACX,GAAIA,GAAcnmD,KAAK2hD,OAAO79C,OAAQ,OACtC,IAAI6qB,EAAU3uB,KAAK2hD,OAAOwE,GAC1B,GAAe,MAAXx3B,EAAiB,OAErB3uB,KAAK8hD,MAAMrlB,IAAI9N,GAEf3uB,KAAKgjD,YAAYr0B,GAEjB,IAAIg3B,EAAQh3B,EACZ,OAAa,CACZ,IAAIu0B,EAAOyC,EAAM9C,WACjB,GAAY,MAARK,EAAc,MAClBljD,KAAK8hD,MAAMrlB,IAAIymB,GACfyC,EAAM9C,WAAa,KACnB8C,EAAMxC,SAAW,KACjBwC,EAAQzC,CACT,CAEAljD,KAAK2hD,OAAOhzB,EAAQw3B,YAAc,KAElCnmD,KAAK8hD,MAAMsB,OACZ,CAEA,UAAAR,CAAY/9C,EAAe8pB,EAAqBy3B,GAC/C,IAAIlD,EAAOljD,KAAKqmD,cAAcxhD,GAC9B7E,KAAK2hD,OAAO98C,GAAS8pB,EAET,MAARu0B,IACCkD,GAAWpmD,KAAK8hD,MAAMsE,UAAUlD,GACpCv0B,EAAQk0B,WAAaK,EACrBA,EAAKC,SAAWx0B,EAChBA,EAAQm0B,QAAU,EAGK,MAAnBI,EAAKL,YAAsBK,EAAKK,YAAc,IACjD50B,EAAQ80B,gBAAkB9+C,KAAK2L,IAAI,EAAG4yC,EAAKJ,QAAUI,EAAKK,cAE3DL,EAAKkB,kBAAkBtgD,OAAS,GAGjC9D,KAAK8hD,MAAMnsC,MAAMgZ,EAClB,CAKA,YAAA23B,CAAcH,EAAoBhvB,EAAuB/I,GACxD,IAAIgJ,EAAYp3B,KAAK2G,KAAKgyB,aAAazB,cAAcC,GACrD,GAAiB,MAAbC,EAAmB,MAAM,IAAIv2B,MAAM,wBAA0Bs2B,GACjE,OAAOn3B,KAAKumD,iBAAiBJ,EAAY/uB,EAAWhJ,EACrD,CAQA,gBAAAm4B,CAAkBJ,EAAoB/uB,EAAsBhJ,GAC3D,GAAiB,MAAbgJ,EAAmB,MAAM,IAAIv2B,MAAM,6BACvC,IAAIulD,GAAY,EACZz3B,EAAU3uB,KAAKqmD,cAAcF,GAClB,MAAXx3B,KAC2B,GAA1BA,EAAQ4zB,eAEXviD,KAAK2hD,OAAOwE,GAAcx3B,EAAQk0B,WAClC7iD,KAAK8hD,MAAMsE,UAAUz3B,GACrB3uB,KAAK8hD,MAAMrlB,IAAI9N,GACf3uB,KAAKgjD,YAAYr0B,GACjBA,EAAUA,EAAQk0B,WAClBuD,GAAY,GAEZpmD,KAAKgjD,YAAYr0B,IAEnB,IAAIg3B,EAAQ3lD,KAAKwmD,WAAWL,EAAY/uB,EAAWhJ,EAAMO,GAGzD,OAFA3uB,KAAK4iD,WAAWuD,EAAYR,EAAOS,GACnCpmD,KAAK8hD,MAAMsB,QACJuC,CACR,CAKA,YAAAc,CAAcN,EAAoBhvB,EAAuB/I,EAAeq0B,GACvE,IAAIrrB,EAAYp3B,KAAK2G,KAAKgyB,aAAazB,cAAcC,GACrD,GAAiB,MAAbC,EAAmB,MAAM,IAAIv2B,MAAM,wBAA0Bs2B,GACjE,OAAOn3B,KAAK0mD,iBAAiBP,EAAY/uB,EAAWhJ,EAAMq0B,EAC3D,CAUA,gBAAAiE,CAAkBP,EAAoB/uB,EAAsBhJ,EAAeq0B,GAC1E,GAAiB,MAAbrrB,EAAmB,MAAM,IAAIv2B,MAAM,6BAEvC,IAAIguB,EAAO7uB,KAAKqmD,cAAcF,GAC9B,GAAY,MAARt3B,EACH,KAAoB,MAAbA,EAAK8nB,MACX9nB,EAAOA,EAAK8nB,KAGd,IAAIgP,EAAQ3lD,KAAKwmD,WAAWL,EAAY/uB,EAAWhJ,EAAMS,GAEzD,GAAY,MAARA,EACH7uB,KAAK4iD,WAAWuD,EAAYR,GAAO,GACnC3lD,KAAK8hD,MAAMsB,aAGX,GADAv0B,EAAK8nB,KAAOgP,EACRlD,GAAS,EAAG,CACf,IAAIx0B,EAAWY,EAAKg3B,aAAeh3B,EAAK+2B,eACxB,GAAZ33B,GACCY,EAAKT,KACRq0B,GAASx0B,GAAY,GAAMY,EAAK8zB,UAAY10B,EAAY,IAExDw0B,GAAS99C,KAAK4L,IAAI0d,EAAUY,EAAK8zB,WAClCF,GAASziD,KAAK2G,KAAKggD,OAAO93B,EAAKuI,UAAWA,IAE1CqrB,EAAQ5zB,EAAK8zB,SACf,CAID,OADAgD,EAAMlD,MAAQA,EACPkD,CACR,CAgBA,iBAAAiB,CAAmBT,EAAoB5C,GACtC,IAAIoC,EAAQ3lD,KAAKumD,iBAAiBJ,EAAYzE,GAAemF,gBAAgB,GAG7E,OAFAlB,EAAMpC,YAAcA,EACpBoC,EAAM5C,SAAWQ,EACVoC,CACR,CAaA,iBAAAmB,CAAmBX,EAAoB5C,EAAqBd,GACvDA,GAAS,IAAGA,GAASc,GACzB,IAAIoC,EAAQ3lD,KAAK0mD,iBAAiBP,EAAYzE,GAAemF,gBAAgB,EAAOpE,GAGpF,OAFAkD,EAAMpC,YAAcA,EACpBoC,EAAM5C,SAAWQ,EACVoC,CACR,CAIA,kBAAAoB,CAAoBxD,GACnB,IAAIyC,EAAmBhmD,KAAK8hD,MAAMmE,cAClCjmD,KAAK8hD,MAAMmE,eAAgB,EAC3B,IAAK,IAAI9gD,EAAI,EAAGqG,EAAIxL,KAAK2hD,OAAO79C,OAAQqB,EAAIqG,EAAGrG,IAAK,CACnD,IAAIwpB,EAAU3uB,KAAK2hD,OAAOx8C,GACX,MAAXwpB,GAAiB3uB,KAAK4mD,kBAAkBj4B,EAAQw3B,WAAY5C,EACjE,CACAvjD,KAAK8hD,MAAMmE,cAAgBD,EAC3BhmD,KAAK8hD,MAAMsB,OACZ,CAEA,aAAAiD,CAAexhD,GACd,OAAIA,EAAQ7E,KAAK2hD,OAAO79C,OAAe9D,KAAK2hD,OAAO98C,IACnD4M,EAAMW,oBAAoBpS,KAAK2hD,OAAQ98C,EAAQ,EAAG,MAClD7E,KAAK2hD,OAAO79C,OAASe,EAAQ,EACtB,KACR,CAGA,UAAA2hD,CAAYL,EAAoB/uB,EAAsBhJ,EAAeS,GACpE,IAAI82B,EAAQ3lD,KAAKkiD,eAAe5uC,SA2BhC,OA1BAqyC,EAAMQ,WAAaA,EACnBR,EAAMvuB,UAAYA,EAClBuuB,EAAMv3B,KAAOA,EACbu3B,EAAMqB,cAAe,EAErBrB,EAAMhB,eAAiB,EACvBgB,EAAMf,oBAAsB,EAC5Be,EAAMd,mBAAqB,EAE3Bc,EAAMC,eAAiB,EACvBD,EAAME,aAAezuB,EAAUnJ,SAC/B03B,EAAMvD,eAAiB,EACvBuD,EAAMtD,mBAAqB,EAE3BsD,EAAMlD,MAAQ,EACdkD,EAAMhD,UAAY,EAClBgD,EAAMrD,WAAa,EACnBqD,EAAMpD,eAAiB,EACvBoD,EAAM5C,SAAWt1B,OAAOkG,UACxBgyB,EAAM/D,UAAY,EAElB+D,EAAMx6C,MAAQ,EACdw6C,EAAMlC,eAAiB,EACvBkC,EAAM7C,QAAU,EAChB6C,EAAMpC,YAAsB,MAAR10B,EAAe,EAAI7uB,KAAK2G,KAAKggD,OAAO93B,EAAKuI,UAAWA,GACxEuuB,EAAM/B,SAAWpiD,EAAS6uB,QACnBs1B,CACR,CAEA,WAAA3C,CAAa2C,GACZ,IAAIhP,EAAOgP,EAAMhP,KACjB,KAAe,MAARA,GACN32C,KAAK8hD,MAAM/+C,QAAQ4zC,GACnBA,EAAOA,EAAKA,KAEbgP,EAAMhP,KAAO,IACd,CAEA,kBAAA+M,GACC1jD,KAAKiiD,mBAAoB,EAEzBjiD,KAAKgiD,YAAY9yC,QAEjB,IAAK,IAAI/J,EAAI,EAAGqG,EAAIxL,KAAK2hD,OAAO79C,OAAQqB,EAAIqG,EAAGrG,IAAK,CACnD,IAAIwgD,EAAQ3lD,KAAK2hD,OAAOx8C,GACxB,GAAa,MAATwgD,EAAJ,CACA,KAA2B,MAApBA,EAAM9C,YACZ8C,EAAQA,EAAM9C,WAEf,GACyB,MAApB8C,EAAM9C,YAAsB8C,EAAM/B,UAAYpiD,EAASsN,KAAK9O,KAAKinD,YAAYtB,GACjFA,EAAQA,EAAMxC,eACG,MAATwC,EAPkB,CAQ5B,CACD,CAEA,WAAAsB,CAAatB,GACZ,IAAItC,EAAKsC,EAAMxC,SACXp1B,EAAY43B,EAAMvuB,UAAUrJ,UAC5Bm5B,EAAiBvB,EAAMvuB,UAAUrJ,UAAUjqB,OAC3CogD,EAAezyC,EAAMQ,aAAa0zC,EAAMzB,aAAcgD,GAC1DvB,EAAMX,gBAAgBlhD,OAAS,EAC/B,IAAIqjD,EAAiB11C,EAAMQ,aAAa0zC,EAAMX,gBAAiBkC,GAC3DlF,EAAchiD,KAAKgiD,YAEvB,GAAU,MAANqB,GAAcA,EAAG2D,aACpB,IAAK,IAAI7hD,EAAI,EAAGA,EAAI+hD,EAAgB/hD,IACnC68C,EAAYlzC,IAAIif,EAAU5oB,GAAG+oB,iBAC7Bg2B,EAAa/+C,GAAKu8C,GAAewD,UAKnC/iC,EACA,IAAK,IAAIhd,EAAI,EAAGA,EAAI+hD,EAAgB/hD,IAAK,CACxC,IAAIs2B,EAAW1N,EAAU5oB,GACrBgQ,EAAKsmB,EAASvN,gBAClB,GAAK8zB,EAAYlzC,IAAIqG,GAEhB,GAAU,MAANkuC,GAAc5nB,aAAoB7I,IAAsB6I,aAAoB7H,IACjF6H,aAAoBhI,KAAkB4vB,EAAGjsB,UAAUjJ,YAAYhZ,GAClE+uC,EAAa/+C,GAAKu8C,GAAeuD,UAC3B,CACN,IAAK,IAAItO,EAAO0M,EAAGF,SAAkB,MAARxM,EAAcA,EAAOA,EAAKwM,SACtD,IAAIxM,EAAKvf,UAAUjJ,YAAYhZ,GAA/B,CACA,GAAIwwC,EAAMpC,YAAc,EAAG,CAC1BW,EAAa/+C,GAAKu8C,GAAe0F,SACjCD,EAAehiD,GAAKwxC,EACpB,SAASx0B,CACV,CACA,KAN4C,CAQ7C+hC,EAAa/+C,GAAKu8C,GAAewD,IAClC,MAfChB,EAAa/+C,GAAKu8C,GAAe4C,UAgBnC,CACD,CAGA,UAAA+C,CAAYlB,GACX,OAAIA,GAAcnmD,KAAK2hD,OAAO79C,OAAe,KACtC9D,KAAK2hD,OAAOwE,EACpB,CAGA,WAAA9e,CAAaC,GACZ,GAAgB,MAAZA,EAAkB,MAAM,IAAIzmC,MAAM,4BACtCb,KAAKomC,UAAUrhC,KAAKuiC,EACrB,CAGA,cAAAC,CAAgBD,GACf,IAAIziC,EAAQ7E,KAAKomC,UAAU7gC,QAAQ+hC,GAC/BziC,GAAS,GAAG7E,KAAKomC,UAAUv6B,OAAOhH,EAAO,EAC9C,CAGA,cAAAyiD,GACCtnD,KAAKomC,UAAUtiC,OAAS,CACzB,CAKA,0BAAAyjD,GACCvnD,KAAK8hD,MAAM5yC,OACZ,EAMM,MAAMizC,GAEZ/qB,UAGAuf,KAIAkM,WAIAM,SAMA7b,SAKA6e,WAIA/3B,KAaA44B,aAKArC,eAKAC,oBAKAC,mBAMAe,eAIAC,aAOAzD,cAEAC,kBAQAI,MAKAE,UAEAL,UAAmBC,cASnBQ,SAaAnB,UAOAz2C,MAIA23C,QAeAS,YAAqBE,eAAwBD,WAQ7CI,SAAWpiD,EAAS6uB,QACpB6zB,aAAe,IAAIhhD,MACnB8hD,gBAAkB,IAAI9hD,MACtBkhD,kBAAoB,IAAIlhD,MAExB,KAAAwQ,GACC1T,KAAK22C,KAAO,KACZ32C,KAAK6iD,WAAa,KAClB7iD,KAAKmjD,SAAW,KAChBnjD,KAAKo3B,UAAY,KACjBp3B,KAAKsnC,SAAW,KAChBtnC,KAAKkkD,aAAapgD,OAAS,EAC3B9D,KAAKglD,gBAAgBlhD,OAAS,EAC9B9D,KAAKokD,kBAAkBtgD,OAAS,CACjC,CAKA,gBAAAigD,GACC,GAAI/jD,KAAKouB,KAAM,CACd,IAAIH,EAAWjuB,KAAK6lD,aAAe7lD,KAAK4lD,eACxC,OAAgB,GAAZ33B,EAAsBjuB,KAAK4lD,eACvB5lD,KAAK2iD,UAAY10B,EAAYjuB,KAAK4lD,cAC3C,CACA,OAAOjhD,KAAK2L,IAAItQ,KAAK2iD,UAAY3iD,KAAK4lD,eAAgB5lD,KAAK6lD,aAC5D,CAEA,gBAAA2B,CAAiBpF,GAChBpiD,KAAKoiD,cAAgBA,EACrBpiD,KAAKqiD,kBAAoBD,CAC1B,CAKA,UAAAqF,GACC,OAAOznD,KAAK2iD,WAAa3iD,KAAK6lD,aAAe7lD,KAAK4lD,cACnD,CASA,uBAAA8B,GACC1nD,KAAKokD,kBAAkBtgD,OAAS,CACjC,EAGM,MAAMi+C,GACZ4F,QAAsB,GACtB1B,eAAgB,EAChB2B,UAEA,WAAA9nD,CAAY8nD,GACX5nD,KAAK4nD,UAAYA,CAClB,CAEA,KAAAjyC,CAAOgwC,GACN3lD,KAAK2nD,QAAQ5iD,KAAKgqC,GAAUp5B,OAC5B3V,KAAK2nD,QAAQ5iD,KAAK4gD,GAClB3lD,KAAK4nD,UAAU3F,mBAAoB,CACpC,CAEA,SAAAmE,CAAWT,GACV3lD,KAAK2nD,QAAQ5iD,KAAKgqC,GAAUqX,WAC5BpmD,KAAK2nD,QAAQ5iD,KAAK4gD,EACnB,CAEA,GAAAlpB,CAAKkpB,GACJ3lD,KAAK2nD,QAAQ5iD,KAAKgqC,GAAUtS,KAC5Bz8B,KAAK2nD,QAAQ5iD,KAAK4gD,GAClB3lD,KAAK4nD,UAAU3F,mBAAoB,CACpC,CAEA,OAAAl/C,CAAS4iD,GACR3lD,KAAK2nD,QAAQ5iD,KAAKgqC,GAAUhsC,SAC5B/C,KAAK2nD,QAAQ5iD,KAAK4gD,EACnB,CAEA,QAAAzE,CAAUyE,GACT3lD,KAAK2nD,QAAQ5iD,KAAKgqC,GAAUmS,UAC5BlhD,KAAK2nD,QAAQ5iD,KAAK4gD,EACnB,CAEA,KAAAjyB,CAAOiyB,EAAmBjyB,GACzB1zB,KAAK2nD,QAAQ5iD,KAAKgqC,GAAUrb,OAC5B1zB,KAAK2nD,QAAQ5iD,KAAK4gD,GAClB3lD,KAAK2nD,QAAQ5iD,KAAK2uB,EACnB,CAEA,KAAA0vB,GACC,GAAIpjD,KAAKimD,cAAe,OACxBjmD,KAAKimD,eAAgB,EAErB,IAAI0B,EAAU3nD,KAAK2nD,QACfvhB,EAAYpmC,KAAK4nD,UAAUxhB,UAE/B,IAAK,IAAIjhC,EAAI,EAAGA,EAAIwiD,EAAQ7jD,OAAQqB,GAAK,EAAG,CAC3C,IAAImqB,EAAOq4B,EAAQxiD,GACfwgD,EAAQgC,EAAQxiD,EAAI,GACxB,OAAQmqB,GACR,KAAKyf,GAAUp5B,MACQ,MAAlBgwC,EAAMre,UAAoBqe,EAAMre,SAAS3xB,OAAOgwC,EAAMre,SAAS3xB,MAAMgwC,GACzE,IAAK,IAAIh+B,EAAK,EAAGA,EAAKye,EAAUtiC,OAAQ6jB,IACnCye,EAAUze,GAAIhS,OAAOywB,EAAUze,GAAIhS,MAAMgwC,GAC9C,MACD,KAAK5W,GAAUqX,UACQ,MAAlBT,EAAMre,UAAoBqe,EAAMre,SAAS8e,WAAWT,EAAMre,SAAS8e,UAAUT,GACjF,IAAK,IAAIh+B,EAAK,EAAGA,EAAKye,EAAUtiC,OAAQ6jB,IACnCye,EAAUze,GAAIy+B,WAAWhgB,EAAUze,GAAIy+B,UAAUT,GACtD,MACD,KAAK5W,GAAUtS,IACQ,MAAlBkpB,EAAMre,UAAoBqe,EAAMre,SAAS7K,KAAKkpB,EAAMre,SAAS7K,IAAIkpB,GACrE,IAAK,IAAIh+B,EAAK,EAAGA,EAAKye,EAAUtiC,OAAQ6jB,IACnCye,EAAUze,GAAI8U,KAAK2J,EAAUze,GAAI8U,IAAIkpB,GAE3C,KAAK5W,GAAUhsC,QACQ,MAAlB4iD,EAAMre,UAAoBqe,EAAMre,SAASvkC,SAAS4iD,EAAMre,SAASvkC,QAAQ4iD,GAC7E,IAAK,IAAIh+B,EAAK,EAAGA,EAAKye,EAAUtiC,OAAQ6jB,IACnCye,EAAUze,GAAI5kB,SAASqjC,EAAUze,GAAI5kB,QAAQ4iD,GAClD3lD,KAAK4nD,UAAU1F,eAAe1uC,KAAKmyC,GACnC,MACD,KAAK5W,GAAUmS,SACQ,MAAlByE,EAAMre,UAAoBqe,EAAMre,SAAS4Z,UAAUyE,EAAMre,SAAS4Z,SAASyE,GAC/E,IAAK,IAAIh+B,EAAK,EAAGA,EAAKye,EAAUtiC,OAAQ6jB,IACnCye,EAAUze,GAAIu5B,UAAU9a,EAAUze,GAAIu5B,SAASyE,GACpD,MACD,KAAK5W,GAAUrb,MACd,IAAIA,EAAQi0B,EAAc,EAANxiD,KACE,MAAlBwgD,EAAMre,UAAoBqe,EAAMre,SAAS5T,OAAOiyB,EAAMre,SAAS5T,MAAMiyB,EAAOjyB,GAChF,IAAK,IAAI/L,EAAK,EAAGA,EAAKye,EAAUtiC,OAAQ6jB,IACnCye,EAAUze,GAAI+L,OAAO0S,EAAUze,GAAI+L,MAAMiyB,EAAOjyB,GAGvD,CACA1zB,KAAKkP,QAELlP,KAAKimD,eAAgB,CACtB,CAEA,KAAA/2C,GACClP,KAAK2nD,QAAQ7jD,OAAS,CACvB,GAGD,SAAYirC,GACX,qBAAO,6BAAW,iBAAK,yBAAS,2BAAU,oBAC1C,CAFD,CAAYA,KAAAA,GAAS,KQlkCd,MAAM8Y,GAEZlvB,aAEAmvB,mBAAkC,CAAC,EAGnCC,WAAa,EAEb,WAAAjoD,CAAa64B,GACZ,GAAoB,MAAhBA,EAAsB,MAAM,IAAI93B,MAAM,gCAC1Cb,KAAK24B,aAAeA,CACrB,CAKA,MAAAqvB,CAAQC,EAAkBC,EAAgBj6B,GACzC,IAAIi1B,EAAOljD,KAAK24B,aAAazB,cAAc+wB,GAC3C,GAAY,MAAR/E,EAAc,MAAM,IAAIriD,MAAM,wBAA0BonD,GAC5D,IAAI5E,EAAKrjD,KAAK24B,aAAazB,cAAcgxB,GACzC,GAAU,MAAN7E,EAAY,MAAM,IAAIxiD,MAAM,wBAA0BqnD,GAC1DloD,KAAKmoD,WAAWjF,EAAMG,EAAIp1B,EAC3B,CAKA,UAAAk6B,CAAYjF,EAAiBG,EAAep1B,GAC3C,GAAY,MAARi1B,EAAc,MAAM,IAAIriD,MAAM,wBAClC,GAAU,MAANwiD,EAAY,MAAM,IAAIxiD,MAAM,sBAChC,IAAIuJ,EAAM84C,EAAKj/C,KAAO,IAAMo/C,EAAGp/C,KAC/BjE,KAAK8nD,mBAAmB19C,GAAO6jB,CAChC,CAIA,MAAA04B,CAAQzD,EAAiBG,GACxB,IAAIj5C,EAAM84C,EAAKj/C,KAAO,IAAMo/C,EAAGp/C,KAC3B8K,EAAQ/O,KAAK8nD,mBAAmB19C,GACpC,YAAiB6E,IAAVF,EAAsB/O,KAAK+nD,WAAah5C,CAChD,ECvES,MAAMq5C,GACfr8C,sBAAwB,iBACxBA,cAAgB,SAChBA,eAAiB,UACXA,mBAAqB,cA0BlB,MAAMs8C,GACFC,WACAC,cACAC,YACAC,iBAEP,WAAA3oD,CAAYwoD,GACRtoD,KAAKsoD,WAAaA,EAClBtoD,KAAKyoD,iBAAmB,KACxBzoD,KAAKwoD,YAAc,IACvB,CAEA,iBAAAE,CAAkBC,EAAqBhJ,GACnC,IAAIiJ,EAAOjJ,EAAS19C,MAAQ,EACxB4mD,EAAOlkD,KAAK2M,SACzB,OAAO,IAAIsC,EAAQi1C,EAAKlJ,EAAS19C,MAAQ2mD,EAAMD,EAAWjkD,EACrD,CAEA,YAAAokD,CAAaC,EAAa3xB,EAAkBuoB,GACxC,MAAMqJ,EAAkBD,EAAME,OAAOC,UAAYvJ,EAASj7C,EACzC,OAAb0yB,EACZ2xB,EAAMI,aAAaH,EAAkBrkD,KAAKC,IAAImkD,EAAMK,aAAa1kD,IAEjEqkD,EAAMI,aAAaH,GAEXhpD,KAAKyoD,iBAAmBrxB,EACpBp3B,KAAKyoD,iBAAiBY,SAAS,UAC/BrpD,KAAKuoD,cAAgB,KACrBvoD,KAAKwoD,YAAc,KAE3B,CAEA,aAAAc,GACI,OAAOtpD,KAAKsoD,WAAuB,UACvC,CAEA,aAAAiB,CAAcR,EAAcS,EAAmB7J,GAC3C,GAAK3/C,KAAKyoD,iBAAiBY,SAAS,QAE7B,CACqB,MAApBrpD,KAAKwoD,cACLxoD,KAAKuoD,cAAgBQ,EAAMU,cAC3BzpD,KAAKwoD,YAAcxoD,KAAK0oD,kBAAkBK,EAAMU,cAAe9J,IAGnE,IAAI+F,EAAM1lD,KAAKwoD,YAAY30C,SAASk1C,EAAMU,eACtC/D,EAAI5hD,SAAW,IAEfilD,EAAMW,YAAY1pD,KAAKwoD,YAAYhkD,EAAGxE,KAAKwoD,YAAY9jD,EAAG,GAC1D1E,KAAKuoD,cAAgBQ,EAAMU,cAC3BzpD,KAAKwoD,YAAcxoD,KAAK0oD,kBAAkBK,EAAMU,cAAe9J,IAEnE+F,EAAI3xC,YACJg1C,EAAMY,YACFjE,EAAIlhD,EAAIukD,EAAMa,oBAAsBJ,EACpC9D,EAAIhhD,EAAIqkD,EAAMc,oBAAsBL,EACpC,EAER,MApBIT,EAAMY,YAAY,EAAE,EAAE,EAqB9B,EAGG,MAAMG,GACFxB,WACAC,cAAyB,KACzBC,YAAuB,KAE9B,WAAA1oD,CAAYwoD,GACRtoD,KAAKsoD,WAAaA,EAClBtoD,KAAKuoD,cAAgB,KACrBvoD,KAAKwoD,YAAc,IACvB,CAEA,iBAAAE,CAAkBC,EAAqBhJ,GACnC,IAAIiJ,EAAOjJ,EAAS19C,MAAQ,EACrC,OAAO,IAAI2R,EAAQjP,KAAK2M,SAASquC,EAAS19C,MAAQ2mD,EAAMD,EAAWjkD,EAC9D,CAEA,YAAAokD,CAAaC,EAAa3xB,EAAkBuoB,GAGxCoJ,EAAMI,aAAaJ,EAAME,OAAOC,UAAYvJ,EAASj7C,EACzD,CAEA,aAAA4kD,GACI,MAAO,CAACtpD,KAAKsoD,WAA6B,iBAC9C,CAEA,aAAAiB,CAAcR,EAAcS,EAAmB7J,GACnB,MAApB3/C,KAAKwoD,cACLxoD,KAAKuoD,cAAgBQ,EAAMU,cAC3BzpD,KAAKwoD,YAAcxoD,KAAK0oD,kBAAkBK,EAAMU,cAAe9J,IAGnE,IAAI+F,EAAM1lD,KAAKwoD,YAAY30C,SAASk1C,EAAMU,eACtC/D,EAAI5hD,SAAW,IAEfilD,EAAMW,YAAY1pD,KAAKwoD,YAAYhkD,EAAGxE,KAAKwoD,YAAY9jD,EAAG,GAC1D1E,KAAKuoD,cAAgBQ,EAAMU,cAC3BzpD,KAAKwoD,YAAcxoD,KAAK0oD,kBAAkBK,EAAMU,cAAe9J,IAEnE+F,EAAI3xC,YACJg1C,EAAMY,YACFjE,EAAIlhD,EAAIukD,EAAMa,oBAAsBJ,EACpC9D,EAAIhhD,EAAIqkD,EAAMc,oBAAsBL,EACpC,EAER,EAIG,MAAMO,GACFzB,WACAC,cAAyB,KACzBC,YAAuB,KACvBwB,SAAoB,KACpBC,mBAEP,WAAAnqD,CAAYwoD,GACRtoD,KAAKsoD,WAAaA,EAClBtoD,KAAKuoD,cAAgB,KACrBvoD,KAAKwoD,YAAc,KACnBxoD,KAAKgqD,SAAW,KAChBhqD,KAAKiqD,oBAAqB,CAC9B,CAEA,YAAAnB,CAAaC,EAAa3xB,EAAkBuoB,GACxCoJ,EAAMI,aAAaJ,EAAME,OAAOC,UAAYvJ,EAASj7C,EACzD,CAEA,aAAA4kD,GACI,OAAItpD,KAAKiqD,mBACE,CAACjqD,KAAKsoD,WAAoC,yBAE1C,CAACtoD,KAAKsoD,WAA8B,kBAEnD,CAEA,aAAAiB,CAAcR,EAAcS,EAAmB7J,GAC3C,GAAI3/C,KAAKiqD,mBACL,OAGJ,GAAwB,MAApBjqD,KAAKwoD,YAAqB,CAC1BxoD,KAAKuoD,cAAgBQ,EAAMU,cAC3B,IAAI9pC,EAAS,IAAI/L,EACb5T,KAAKsoD,WAAuB,WAAK,EACjCtoD,KAAKsoD,WAAuB,WAAK,GAErCtoD,KAAKwoD,YAAc,IAAI50C,EACnB+L,EAAOnb,EAAIm7C,EAAS19C,MAAS09C,EAAS19C,MAAM,EAC5C,GAEJjC,KAAKgqD,SAAWhqD,KAAKwoD,YAAY30C,SAAS7T,KAAKuoD,eAC3CvoD,KAAKgqD,SAASlmD,SAAW,KACzB9D,KAAKiqD,oBAAqB,GAE9BjqD,KAAKgqD,SAAWhqD,KAAKgqD,SAASj2C,WAClC,CAEA,IAAI2xC,EAAM1lD,KAAKwoD,YAAY30C,SAASk1C,EAAMU,eAAe11C,YACrDG,EAAQlU,KAAKgqD,SAAS91C,MAAMwxC,GAClB/gD,KAAKC,IAAID,KAAKwL,GAAK+D,GAAS,MAC3BlU,KAAKiqD,oBAEhBlB,EAAMW,YAAY1pD,KAAKwoD,YAAYhkD,EAAGxE,KAAKwoD,YAAY9jD,EAAE,GACzD1E,KAAKuoD,cAAgBQ,EAAMU,cAC3BV,EAAMY,YAAY,EAAE,EAAE,GACtB3pD,KAAKiqD,oBAAqB,EAC1BlB,EAAMmB,sBAENnB,EAAMY,YACFjE,EAAIlhD,EAAIukD,EAAMa,oBAAsBJ,EACpC9D,EAAIhhD,EAAIqkD,EAAMc,oBAAsBL,EACpC,EAGZ,EAGG,MAAMW,GACF7B,WACAC,cAAyB,KACzBC,YAAuB,KACvByB,mBAEP,WAAAnqD,CAAYwoD,GACRtoD,KAAKsoD,WAAaA,EAClBtoD,KAAKuoD,cAAgB,KACrBvoD,KAAKwoD,YAAc,KACnBxoD,KAAKiqD,oBAAqB,CAC9B,CAEA,YAAAnB,CAAaC,EAAa3xB,EAAkBuoB,GACxCoJ,EAAMI,aAAaJ,EAAME,OAAOC,UAAYvJ,EAASj7C,EACzD,CAEA,aAAA4kD,GACI,MAAO,CAACtpD,KAAKsoD,WAAkC,sBACnD,CAEA,aAAAiB,CAAcR,EAAcS,EAAmB7J,GAC3C,GAAI3/C,KAAKiqD,mBAAoB,CACzBjqD,KAAKiqD,oBAAqB,EAG1B,IAAIG,EAAepqD,KAAKuoD,cAGxB,OAFAvoD,KAAKuoD,cAAgBvoD,KAAKwoD,iBAC1BxoD,KAAKwoD,YAAc4B,EAEvB,CAEA,GAAwB,MAApBpqD,KAAKwoD,YAAqB,CAE1B,IAAI6B,EAAmB,GAAd1lD,KAAK2M,SACVg5C,EAAmB,GAAd3lD,KAAK2M,SACVqE,EAAQ,IAAI+qB,GACZ1gC,KAAKsoD,WAA2B,eAAK,EACrCtoD,KAAKsoD,WAA2B,eAAK,EACrC+B,GAEA1qC,EAAS,IAAI+gB,GACb1gC,KAAKsoD,WAAyB,aAAK,EACnCtoD,KAAKsoD,WAAyB,aAAK,EACnCgC,GAEJtqD,KAAKuoD,cAAgB,IAAI7nB,GACrB/qB,EAAMnR,EAAIm7C,EAAS19C,MAAS09C,EAAS19C,MAAM,EAC3C0T,EAAMjR,EAAIi7C,EAASz9C,OACnByT,EAAMgrB,GAEV3gC,KAAKwoD,YAAc,IAAI9nB,GACnB/gB,EAAOnb,EAAIm7C,EAAS19C,MAAS09C,EAAS19C,MAAM,EAC5C0d,EAAOjb,EAAIi7C,EAASz9C,OACpByd,EAAOghB,GAEA3gC,KAAKwoD,YAAYvxC,OACnB4pB,IAAIkoB,EAAMwB,gBAAgBzmD,SAAW,KAC1C9D,KAAKiqD,oBAAqB,EAElC,CAEA,IAAIvE,EAAM1lD,KAAKwoD,YAAYvxC,OAAO4pB,IAAIkoB,EAAMwB,gBAAgBx2C,YAC9C/T,KAAKwoD,YAAYvxC,OAAO4pB,IAAIkoB,EAAMwB,gBAAgBzmD,SAClD,IAAM9D,KAAKiqD,oBAErBlB,EAAMW,YAAY1pD,KAAKwoD,YAAYhkD,EAAGxE,KAAKwoD,YAAY9jD,EAAG1E,KAAKwoD,YAAY7nB,GAC3EooB,EAAMY,YAAY,EAAE,EAAE,GACtB3pD,KAAKiqD,oBAAqB,GAE1BlB,EAAMY,YACFjE,EAAIlhD,EAAIukD,EAAMa,oBAAsBJ,EACpC9D,EAAIhhD,EAAIqkD,EAAMc,oBAAsBL,EACpC9D,EAAI/kB,EAAIooB,EAAMyB,oBAAsBhB,EAGhD,ECzJA,MAAMiB,GACLzkD,OACA+P,SACA20C,eACA9hC,KAAO,IAAIrU,EACXo2C,QAAS,EACTC,SAAW,EACXC,MAAQ,EACR5B,OACA6B,cAAwB,KAGxBnL,SAAwB,KACxByJ,aAA4B,KAC5B2B,iBAAgC,KAChCC,UAAyB,KAKxBC,cAAyB,IAAIvqB,GAK7B9c,SAAoB,IAAI8c,GACzB/b,MAAiB,IAAI/Q,EAAQ,EAAE,GAC9Bs3C,SAAoB,IAAIxqB,GAAQ,EAAG,EAAG,GACvC6nB,cAAyB,KACzB4C,cAA6B,KAG7BC,cAAwB,EACxBC,kBAA4B,GAC5BC,mBAA6B,EAI7BC,YAAqB,IAAI12C,MAAO22C,UAEvC,WAAA1rD,CAAYmpD,EAA0BtJ,GACrC3/C,KAAKurD,YAAa,IAAI12C,MAAO22C,UAC7BxrD,KAAK2/C,SAAWA,EAChB3/C,KAAKyrD,gBAAgBxC,GACrB,IAAIzkD,EAAIG,KAAK2M,SAASquC,EAAS19C,MAAS09C,EAAS19C,MAAM,EAEvDjC,KAAK4jB,SAAW,IAAI8c,GAAQl8B,EAAG,EADvB,IAGJykD,EAAOyC,WAAazC,EAAOC,aAC9BlpD,KAAK4jB,SAAW,IAAI8c,GAClBuoB,EAAOyC,UAAW/L,EAAS19C,MAAU09C,EAAS19C,MAAM,EACrDgnD,EAAOC,UAAYvJ,EAASz9C,OANtB,GAUT,CAEO,WAAAunD,GACN,OAAO,IAAI71C,EACV5T,KAAK4jB,SAASpf,EACdxE,KAAK4jB,SAASlf,EAEhB,CACO,YAAA6lD,GACN,OAAO,IAAI7pB,GACV1gC,KAAK4jB,SAASpf,EACdxE,KAAK4jB,SAASlf,EACd1E,KAAK4jB,SAAS+c,EAEhB,CACO,YAAAgrB,GACN,OAAO3rD,KAAK4jB,SAASpf,CACtB,CACO,YAAAonD,GACN,OAAO5rD,KAAK4jB,SAASlf,CACtB,CACO,YAAAmnD,GACN,OAAO7rD,KAAK4jB,SAAS+c,CACtB,CACO,YAAAmrB,CAAatnD,GACnBxE,KAAK4jB,SAASpf,EAAIA,CACnB,CACO,YAAA2kD,CAAazkD,GACnB1E,KAAK4jB,SAASlf,EAAIA,CACnB,CACO,YAAAqnD,CAAaprB,GACnB3gC,KAAK4jB,SAAS+c,EAAIA,CACnB,CACO,WAAA+oB,CAAYllD,EAAWE,EAAWi8B,GACxC3gC,KAAK4jB,SAASpf,EAAIA,EAClBxE,KAAK4jB,SAASlf,EAAIA,EAClB1E,KAAK4jB,SAAS+c,OAAU1xB,IAAN0xB,EAAkBA,EAAI,CACzC,CAEO,eAAAqrB,GACN,OAAO,IAAIp4C,EACV5T,KAAKirD,cAAczmD,EACnBxE,KAAKirD,cAAcvmD,EAErB,CACO,gBAAAunD,GACN,OAAO,IAAIvrB,GACV1gC,KAAKirD,cAAczmD,EACnBxE,KAAKirD,cAAcvmD,EACnB1E,KAAKirD,cAActqB,EAErB,CACO,iBAAAipB,GACN,OAAO5pD,KAAKirD,cAAczmD,CAC3B,CACO,iBAAAqlD,GACN,OAAO7pD,KAAKirD,cAAcvmD,CAC3B,CACO,iBAAA8lD,GACN,OAAOxqD,KAAKirD,cAActqB,CAC3B,CACO,iBAAAurB,CAAkB1nD,GACxBxE,KAAKirD,cAAczmD,EAAIA,CACxB,CACO,iBAAA2nD,CAAkBznD,GACxB1E,KAAKirD,cAAcvmD,EAAIA,CACxB,CACO,iBAAA0nD,CAAkBzrB,GACxB3gC,KAAKirD,cAActqB,EAAIA,CACxB,CACO,gBAAA0rB,CAAiB7nD,EAAWE,EAAWi8B,GAC7C3gC,KAAKirD,cAAczmD,EAAIA,EACvBxE,KAAKirD,cAAcvmD,EAAIA,EACvB1E,KAAKirD,cAActqB,OAAU1xB,IAAN0xB,EAAkBA,EAAI3gC,KAAKipD,OAAOqD,uBAC1D,CAEO,WAAAC,GACN,OAAO,IAAI34C,EACV5T,KAAKkrD,SAAS1mD,EACdxE,KAAKkrD,SAASxmD,EAEhB,CACO,YAAA8nD,GACN,OAAO,IAAI9rB,GACV1gC,KAAKkrD,SAAS1mD,EACdxE,KAAKkrD,SAASxmD,EACd1E,KAAKkrD,SAASvqB,EAEhB,CACO,WAAAgpB,CAAYnlD,EAAYE,EAAai8B,GAC3C3gC,KAAKkrD,SAAW,IAAIxqB,GACdzxB,MAALzK,EAAiBA,EAAIxE,KAAKkrD,SAAS1mD,EAC9ByK,MAALvK,EAAiBA,EAAI1E,KAAKkrD,SAASxmD,EAC9BuK,MAAL0xB,EAAiBA,EAAI3gC,KAAKkrD,SAASvqB,EAErC,CAEO,cAAA8rB,GACNzsD,KAAK0sD,uBAAuB1sD,KAAKmrD,cAAc7B,gBAChD,CAEO,aAAAA,GACN,OAAOtpD,KAAKmrD,cAAc7B,eAC3B,CAEO,eAAAmC,CAAgBxC,GACtBjpD,KAAKorD,cAAgB,EACrBprD,KAAKsrD,mBAAoB,EAEzBtrD,KAAKgG,QAAS,EACdhG,KAAK+V,SAAW,KAChB/V,KAAK0qD,eAAiB,KACtB1qD,KAAK4oB,KAAO,IAAIrU,EAChBvU,KAAK2qD,QAAS,EACd3qD,KAAK4qD,SAAW,EAChB5qD,KAAK6qD,MAAQ,EACb7qD,KAAKipD,OAASA,EAEdjpD,KAAKopD,aAAe,KACpBppD,KAAK+qD,iBAAmB,KACxB/qD,KAAKgrD,UAAY,KAGe,OAA5B/B,EAAO0D,kBACqB,OAA5B1D,EAAO2D,kBACqB,OAA5B3D,EAAO4D,iBACV7sD,KAAKirD,cAAgB,IAAIvqB,GACxBuoB,EAAO0D,iBACP1D,EAAO2D,iBACP3D,EAAO4D,kBAGR7sD,KAAKirD,cAAgB,IAAIvqB,GACxBuoB,EAAO6D,wBAA0BnoD,KAAK2M,SAAS23C,EAAO6D,wBAAwB,EAC9E7D,EAAO8D,wBACP9D,EAAOqD,yBAMTtsD,KAAK2kB,MAAMngB,EAAIG,KAAK8Y,KAAKzd,KAAK2kB,MAAMngB,GAAKykD,EAAOnwC,OAChD9Y,KAAK2kB,MAAMjgB,EAAIC,KAAK8Y,KAAKzd,KAAK2kB,MAAMjgB,GAAKukD,EAAOlwC,OAEhD/Y,KAAKmrD,cD/TG,SAAiC6B,EAAoB1E,GAExD,OAAQ0E,GACJ,KAAK5E,GAAW6E,eACZ,OAAO,IAAI5E,GAAoBC,GACnC,KAAKF,GAAW8E,OACZ,OAAO,IAAIpD,GAAaxB,GAC5B,KAAKF,GAAW+E,QACZ,OAAO,IAAIpD,GAAazB,GAC5B,KAAKF,GAAWgF,YACZ,OAAO,IAAIjD,GAAiB7B,GAChC,QAEI,OADAtgD,QAAQC,IAAI,uBAAwB+kD,GAC7B,KAEnB,CCgToBK,CACpBrtD,KAAKipD,OAAOqE,OACZttD,KAAKipD,OAAOsE,YAEd,CAEO,aAAAhE,CAAcC,EAAmB7J,GACvC3/C,KAAKmrD,cAAc5B,cAAcvpD,KAAMwpD,EAAW7J,GAClD3/C,KAAK4jB,SAASpf,GAAKxE,KAAKkrD,SAAS1mD,EACjCxE,KAAK4jB,SAASlf,GAAK1E,KAAKkrD,SAASxmD,EACjC1E,KAAK4jB,SAAS+c,GAAK3gC,KAAKkrD,SAASvqB,EAGV,GAAnB3gC,KAAKkrD,SAAS1mD,IACbxE,KAAKkrD,SAAS1mD,EAAI,EACrBxE,KAAK2kB,MAAMngB,EAAIxE,KAAKipD,OAAOnwC,OAE3B9Y,KAAK2kB,MAAMngB,GAAKxE,KAAKipD,OAAOnwC,QAG9B9Y,KAAKwtD,wBAAwB7N,EAC9B,CAEO,kBAAAuK,GACN,IAAIvxB,EAAe34B,KAAK+V,SAASpP,KAC7B8mD,EAAY,IAAI5F,GAAmBlvB,GACvC80B,EAAU1F,WAAa/nD,KAAKipD,OAAOlB,WACnC/nD,KAAK0qD,eAAiB,IAAIhJ,GAAe+L,GACrCztD,KAAKipD,OAAOyE,qBACf1tD,KAAK0qD,eAAepD,iBACpBtnD,KAAK0qD,eAAerjB,YAAYrnC,KAAKipD,OAAOyE,qBAE1C1tD,KAAKspD,iBAEHtpD,KAAK0qD,iBACH1qD,KAAK0qD,eAAerD,WAAW,IACnCrnD,KAAKysD,iBAIT,CAEO,uBAAAkB,GAGN,IAAIC,EAAc,EAClB,GAAI5tD,KAAKipD,OAAO4E,QAAQxE,SAAS,UAChCuE,EAAc5tD,KAAKgrD,UAAU9oD,WACvB,CAMN,IAAI4rD,EAAc,GAAO9tD,KAAKipD,OAAOlwC,OAAU,IAC3C7W,EAASlC,KAAKgrD,UAAU9oD,OAE3B0rD,EADG1rD,EAAS4rD,EACGA,EAEA5rD,CAEjB,CACA,OAAO0rD,EAAcjpD,KAAKC,IAAI5E,KAAKipD,OAAO8E,aAC3C,CAKQ,uBAAAP,CAAwB7N,GAC/B3/C,KAAK+V,SAASvR,EAAIxE,KAAK4jB,SAASpf,EAAIxE,KAAKipD,OAAO+E,aAChDhuD,KAAK+V,SAASrR,EAAI1E,KAAK4jB,SAASlf,EAAI1E,KAAKipD,OAAO8E,aAChD/tD,KAAK+V,SAAS+C,OAAS9Y,KAAK2kB,MAAMngB,EAClCxE,KAAK+V,SAASgD,OAAS/Y,KAAK2kB,MAAMjgB,CACnC,CAEQ,eAAAupD,CAAgB72B,GACvBp3B,KAAKmrD,cAAcrC,aAAa9oD,KAAMo3B,EAAWp3B,KAAK2/C,UACtD3/C,KAAK8qD,cAAgB1zB,CACtB,CAEQ,sBAAAs1B,CAAuB/1B,GAC9B32B,KAAKkuD,kBAAkBv3B,GACvB32B,KAAKiuD,gBAAgBt3B,EAAW,IAGhC,IAAI10B,EAAQjC,KAAKgrD,UAAU/oD,MACvBC,EAASlC,KAAKgrD,UAAU9oD,OAK5B,GAJcyC,KAAK6M,KAAKvP,EAAMA,EAAQC,EAAOA,GAI/BlC,KAAKipD,OAAOkF,WAAanuD,KAAKipD,OAAO4E,QAAQxE,SAAS,UAAW,CAC9ErhD,QAAQC,IAAI,qBAAuBjI,KAAKipD,OAAOkF,WAC/C,IAAIC,EAAQnsD,EAAQC,EAEhBmsD,EAAO,EACPC,EAAO,EACPpsD,EAASD,GACZosD,EAAOD,EAAQpuD,KAAKipD,OAAOkF,UAC3BG,EAAOtuD,KAAKipD,OAAOkF,YAEnBE,EAAOruD,KAAKipD,OAAOkF,UACnBG,EAAOtuD,KAAKipD,OAAOkF,UAAYC,GAEhC,IAAIG,EAAaF,EAAOruD,KAAKipD,OAAOnwC,OAAU7W,EAC1CusD,EAAaF,EAAOtuD,KAAKipD,OAAOlwC,OAAU7W,EAG9ClC,KAAKipD,OAAOwF,cAAgBzuD,KAAKipD,OAAOnwC,OACxC9Y,KAAKipD,OAAOyF,cAAgB1uD,KAAKipD,OAAOlwC,OACxC/Y,KAAKipD,OAAOnwC,OAASy1C,EACrBvuD,KAAKipD,OAAOlwC,OAASy1C,EACrBxuD,KAAK2kB,MAAMngB,EAAIG,KAAK8Y,KAAKzd,KAAK2kB,MAAMngB,GAAKxE,KAAKipD,OAAOnwC,OACrD9Y,KAAK2kB,MAAMjgB,EAAIC,KAAK8Y,KAAKzd,KAAK2kB,MAAMjgB,GAAK1E,KAAKipD,OAAOlwC,OAErD/Y,KAAKkuD,kBAAkBv3B,GACvB32B,KAAKiuD,gBAAgBt3B,EAAW,GAEjC,CACD,CAEQ,iBAAAu3B,CAAkBv3B,GACzB,IAAIS,EAAYT,EAAW,GAE3B32B,KAAKopD,aAAeppD,KAAK2uD,2BAA2Bv3B,GACpDp3B,KAAKgrD,UAAYhrD,KAAK4uD,wBACtB5uD,KAAK0qD,eAAe9I,UAAY5hD,KAAKipD,OAAO4F,mBAC5C7uD,KAAK0qD,eAAe3E,cACpB/lD,KAAK+V,SAASqG,iBAEdpc,KAAK0qD,eAAepE,aAAa,EAAGlvB,GAAW,GAC/C,IAAI03B,EAAiB,KACrB,IAAK,IAAI3pD,EAAI,EAAGA,EAAIwxB,EAAW7yB,OAAQqB,IACtC2pD,EAAiB9uD,KAAK0qD,eAAejE,aAAa,EAAG9vB,EAAWxxB,IAAI,EAAO,GAGxE2pD,GACH9uD,KAAK0qD,eAAerjB,YAAY,CAC/B1xB,OACE6wC,IACAxmD,KAAKiuD,gBAAgBzH,EAAWpvB,UAAUnzB,KAC1C,GACAgJ,KAAKjN,MACPomD,UAAW,SAAUI,GAAc,EACnC/pB,IAAK,SAAU+pB,GAAa,EAC5BtF,UACEsF,IAEA,GAAuB,MAAnBA,EAAW7P,KAAc,CAC5B32C,KAAK0qD,eAAepE,aAAa,EAAGlvB,GAAW,GAC/C,IAAK,IAAIjyB,EAAI,EAAGA,EAAIwxB,EAAW7yB,OAAQqB,IACtC2pD,EAAiB9uD,KAAK0qD,eAAejE,aAAa,EAAG9vB,EAAWxxB,IAAI,EAAO,EAE7E,CACA,GACA8H,KAAKjN,MACP+C,QAAS,SAAUyjD,GAAa,EAChC9yB,MAAO,SAAUiyB,EAAmBjyB,GAAqB,GAG5D,CAEQ,qBAAAk7B,GACP,IAAIj4B,EAAa32B,KAAK+V,SAASpP,KAAKgwB,WAEhCo4B,EAAY,IAAIn7C,EAChBo7C,EAAU,IAAIp7C,EACdq7C,EAAgB,EACpB,IAAK,IAAI9pD,EAAI,EAAGqG,EAAImrB,EAAW7yB,OAAQqB,EAAIqG,EAAGrG,IAAK,CAClD,IAAIgyB,EAAgBR,EAAWxxB,GAAGlB,KAI9BmzB,EAAYp3B,KAAK+V,SAASpP,KAAKuwB,cAAcC,GACjDn3B,KAAK0qD,eAAe3E,cACpB/lD,KAAK+V,SAASqG,iBACdpc,KAAK0qD,eAAenE,iBAAiB,EAAGnvB,GAAW,GAEnD,IAAI83B,EAASlvD,KAAK+V,SAASvR,EACvB2qD,EAASnvD,KAAK+V,SAASrR,EAC3B1E,KAAK+V,SAASvR,EAAI,EAClBxE,KAAK+V,SAASrR,EAAI,EAClB1E,KAAK+V,SAAS+C,OAASnU,KAAKC,IAAI5E,KAAKipD,OAAOnwC,QAC5C9Y,KAAK+V,SAASgD,OAASpU,KAAKC,IAAI5E,KAAKipD,OAAOlwC,QAC5C/Y,KAAK0qD,eAAej9C,OAAO,GAC3BzN,KAAK0qD,eAAexqC,MAAMlgB,KAAK+V,UAC/B/V,KAAK+V,SAASwG,uBACd,IAAI1G,EAAS,IAAIjC,EACb1B,EAAO,IAAI0B,EACf5T,KAAK+V,SAASyX,UAAU3X,EAAQ3D,GAEhClS,KAAK+V,SAASvR,EAAI0qD,EAClBlvD,KAAK+V,SAASrR,EAAIyqD,EAEd1hC,OAAO2hC,SAASv5C,EAAOrR,IAAMipB,OAAO2hC,SAASv5C,EAAOnR,IAAM+oB,OAAO2hC,SAASl9C,EAAK1N,IAAMipB,OAAO2hC,SAASl9C,EAAKxN,KAC7GuqD,GAAiB,EACjBF,EAAUvqD,GAAKqR,EAAOrR,EACtBuqD,EAAUrqD,GAAKmR,EAAOnR,EACtBsqD,EAAQxqD,GAAK0N,EAAK1N,EAClBwqD,EAAQtqD,GAAKwN,EAAKxN,EAEpB,CAEAqqD,EAAUvqD,GAAKyqD,EACfF,EAAUrqD,GAAKuqD,EACfD,EAAQxqD,GAAKyqD,EACbD,EAAQtqD,GAAKuqD,EAMb,IAAIrpB,EAAM,CACTphC,EAAGuqD,EAAUvqD,EACbE,EAAGqqD,EAAUrqD,EACbzC,MAAO+sD,EAAQxqD,EACftC,OAAQ8sD,EAAQtqD,GAWjB,OALI1E,KAAKipD,OAAO4E,QAAQxE,SAAS,WAC5BzjB,EAAIlhC,GAAK,KACZ1E,KAAKipD,OAAO8E,cAAgBnoB,EAAIlhC,GAG3BkhC,CACR,CAEQ,0BAAA+oB,CAA4Bx3B,GACnC,IAAIC,EAAYp3B,KAAK+V,SAASpP,KAAKuwB,cAAcC,GACjDn3B,KAAK0qD,eAAe3E,cACpB/lD,KAAK+V,SAASqG,iBACdpc,KAAK0qD,eAAenE,iBAAiB,EAAGnvB,GAAW,GAEnD,IACIi4B,EAAWj4B,EAAUnJ,SAAW,EAAImJ,EAAUnJ,SADtC,IACyD,EACjEpL,EAAO,IACPI,GAAQ,IACRF,EAAO,IACPI,GAAQ,IACRtN,EAAS,IAAIjC,EACb1B,EAAO,IAAI0B,EAEXs7C,EAASlvD,KAAK+V,SAASvR,EACvB2qD,EAASnvD,KAAK+V,SAASrR,EAC3B,IAAK,IAAIS,EAAI,EAAGA,EAXJ,IAWeA,IAC1BnF,KAAK0qD,eAAej9C,OAAO4hD,GAC3BrvD,KAAK0qD,eAAexqC,MAAMlgB,KAAK+V,UAI/B/V,KAAK+V,SAASvR,EAAI,EAClBxE,KAAK+V,SAASrR,EAAI,EAClB1E,KAAK+V,SAAS+C,OAASnU,KAAKC,IAAI5E,KAAKipD,OAAOnwC,QAC5C9Y,KAAK+V,SAASgD,OAASpU,KAAKC,IAAI5E,KAAKipD,OAAOlwC,QAC5C/Y,KAAK+V,SAASwG,uBACdvc,KAAK+V,SAASyX,UAAU3X,EAAQ3D,GAEhC2Q,EAAOle,KAAK2L,IAAIuF,EAAOrR,EAAGqe,GAC1BI,EAAOte,KAAK4L,IAAIsF,EAAOrR,EAAI0N,EAAK1N,EAAGye,GACnCF,EAAOpe,KAAK2L,IAAIuF,EAAOnR,EAAGqe,GAC1BI,EAAOxe,KAAK4L,IAAIsF,EAAOnR,EAAIwN,EAAKxN,EAAGye,GAWpC,OARAnjB,KAAK+V,SAASvR,EAAI0qD,EAClBlvD,KAAK+V,SAASrR,EAAIyqD,EAElBt5C,EAAOrR,EAAIqe,EACXhN,EAAOnR,EAAIqe,EACX7Q,EAAK1N,EAAIye,EAAOJ,EAChB3Q,EAAKxN,EAAIye,EAAOJ,EAET,CACNve,EAAGqR,EAAOrR,EACVE,EAAGmR,EAAOnR,EACVzC,MAAOiQ,EAAK1N,EACZtC,OAAQgQ,EAAKxN,EAEf,EC/fD,MAAM4qD,GAMcC,MAAkBC,eAA6BC,IAL1DC,OACA3gD,MACA4gD,KACDC,OAEP,WAAA9vD,CAAmByvD,EAAQ,EAAUC,EAAiB,GAAYC,GAAM,GAArD,KAAAF,MAAAA,EAAkB,KAAAC,eAAAA,EAA6B,KAAAC,IAAAA,CAAe,CAEjF,MAAAI,GACC7vD,KAAK0vD,OAASnmD,GAAsB,6CACDvJ,KAAKyvD,IAAM,MAAO,8JAKrDzvD,KAAK+O,MAAQ+gD,GAAc9vD,KAAK0vD,OAAQ,6BAA6B,GAErE1vD,KAAK+vD,SAAS,GAEd,IAAIn3B,EAAQ,IAAIiN,GAAM7lC,KAAK0vD,QAC3B,IAAIM,GAAW,EA+Bf,OA9BAp3B,EAAMyO,YAAY,CACjBL,KAAM,CAACxiC,EAAGE,KACTsrD,GAAW,EACXhwD,KAAK+O,MAAMkhD,UAAUnhD,IAAI,WAAW,EAErCo1B,GAAI,CAAC1/B,EAAGE,KACPsrD,GAAW,EACX,IAAIE,EAAa1rD,EAAIxE,KAAK0vD,OAAOlQ,YACjC0Q,EAAaA,EAAavrD,KAAK4L,IAAI,EAAG5L,KAAK2L,IAAI4/C,EAAY,IAC3DlwD,KAAK+vD,SAASvrD,EAAIxE,KAAK0vD,OAAOlQ,aAC1Bx/C,KAAK4vD,QAAQ5vD,KAAK4vD,OAAOM,GAC7BlwD,KAAK+O,MAAMkhD,UAAUhmD,OAAO,WAAW,EAExC48B,MAAO,CAACriC,EAAGE,KACV,GAAIsrD,EAAU,CACb,IAAIE,EAAa1rD,EAAIxE,KAAK0vD,OAAOlQ,YACjC0Q,EAAavrD,KAAK4L,IAAI,EAAG5L,KAAK2L,IAAI4/C,EAAY,IAC9CA,EAAalwD,KAAK+vD,SAASvrD,EAAIxE,KAAK0vD,OAAOlQ,aACvCx/C,KAAK4vD,QAAQ5vD,KAAK4vD,OAAOM,EAC9B,GAEDtpB,QAAS,CAACpiC,EAAGE,KACZ,IAAIwrD,EAAa1rD,EAAIxE,KAAK0vD,OAAOlQ,YACjC0Q,EAAavrD,KAAK4L,IAAI,EAAG5L,KAAK2L,IAAI4/C,EAAY,IAC9CA,EAAalwD,KAAK+vD,SAASvrD,EAAIxE,KAAK0vD,OAAOlQ,aACvCx/C,KAAK4vD,QAAQ5vD,KAAK4vD,OAAOM,EAAW,IAKnClwD,KAAK0vD,MACb,CAEA,QAAAK,CAASG,GAER,GADAA,EAAavrD,KAAK4L,IAAI,EAAG5L,KAAK2L,IAAI,EAAG4/C,IACjClwD,KAAKuvD,MAAQ,EAAG,CACnB,IAAIY,EAASD,GAAc,EAAIlwD,KAAKuvD,OAEhCY,EAAU,EAAInwD,KAAKuvD,MAASvvD,KAAKwvD,eACpCU,GAA0BC,EAChBA,EAAU,EAAInwD,KAAKuvD,MAAU,EAAIvvD,KAAKuvD,MAASvvD,KAAKwvD,iBAC9DU,EAAaA,EAAaC,EAAU,EAAInwD,KAAKuvD,OAE9CW,EAAavrD,KAAK4L,IAAI,EAAG5L,KAAK2L,IAAI,EAAG4/C,GACtC,CAGA,OAFAlwD,KAAK+O,MAAMqhD,MAAMnuD,MAA2B,IAAbiuD,EAAoB,IAE5CA,CACR,EAMM,MAAMG,GACZtkD,yBAA2B,IAAIoD,EAAM,KAAO,EAAG,EAAG,KAClDpD,yBAA2B,IAAIoD,EAAM,EAAG,EAAG,EAAG,GAC9CpD,6BAA+B,IAAIoD,EAAM,KAAO,EAAG,EAAG,IACtDpD,6BAA+B,IAAIoD,EAAM,EAAG,EAAG,EAAG,IAM1CmhD,cACAC,IACAC,eACA1lD,OACA2lD,WACAC,kBACAC,eACAC,WAEA/jD,QACAgkD,cACAC,aAEAnG,QAAS,EACToG,OAAS,IAAIC,IACbC,aAAkC,KAElCjoD,OAEAkoD,2BAA4B,EAC5BC,4BAA8B,EAC9BC,oBAA6B,EAC7BC,UAAuB,KACvBC,gBAAsC,GAE9C,WAAAxxD,CAAYkJ,EAA8BioD,GAExCjxD,KAAKgJ,OADgB,iBAAXA,EACIM,SAASioD,eAAevoD,GAExBA,EAGfhJ,KAAKixD,aAAejxD,KAAKwxD,qBAAqBP,GAC9CjxD,KAAKgJ,OAAOyoD,YAAYzxD,KAAK0xD,WAC9B,CAEA,YAAAC,CAAaN,GACZrxD,KAAKqxD,UAAYA,CAClB,CAEA,oBAAAG,CAAqBvI,GACpB,IAAKA,EAAQ,MAAM,IAAIpoD,MAAM,qDAW7B,OAVKooD,EAAO99C,QAAO89C,EAAO99C,OAAQ,GAC7B89C,EAAOxI,kBAAiBwI,EAAOxI,gBAAkB,WACjDwI,EAAO2I,4BAA2B3I,EAAO2I,0BAA4B3I,EAAOxI,sBAC9C,IAAxBwI,EAAO4I,eACjB5I,EAAO4I,cAAe,GAClB5I,EAAO6I,kCAAiC7I,EAAO6I,gCAAkC,IACjF7I,EAAO8I,WAAU9I,EAAO8I,SAAW,IACnC9I,EAAO+I,WAAU/I,EAAO+I,SAAW,QACnC/I,EAAOgJ,wBAAuBhJ,EAAOgJ,sBAAwB,GAC7DhJ,EAAOiJ,uBAAsBjJ,EAAOiJ,qBAAuB,KACzDjJ,CACR,CAEA,mBAAAkJ,CAAoBlJ,GACnB,IAAKA,EAAQ,MAAM,IAAIpoD,MAAM,qDAC7B,IAAKooD,EAAOmJ,UAAYnJ,EAAOoJ,QAAS,MAAM,IAAIxxD,MAAM,8DACxD,IAAKooD,EAAOqJ,SAAU,MAAM,IAAIzxD,MAAM,6CAkCtC,QA9ByC,IAA9BooD,EAAOx8C,qBAAoCw8C,EAAOx8C,oBAAqB,GAC7Ew8C,EAAOnwC,SAAQmwC,EAAOnwC,OAAS,GAC/BmwC,EAAOlwC,SAAQkwC,EAAOlwC,OAAS,GAC/BkwC,EAAO+E,eAAc/E,EAAO+E,aAAe,GAC3C/E,EAAO8E,eAAc9E,EAAO8E,aAAe,GAC3C9E,EAAOxiD,UAASwiD,EAAOxiD,QAAU,CAAC8rD,EAAQxJ,KAAT,GACjCE,EAAOviD,QAAOuiD,EAAOviD,MAAQ,CAAC6rD,EAAQxJ,EAAOyJ,KAAhB,GAC7BvJ,EAAOyE,qBACXzE,EAAOyE,mBAAqB,CAC3Bh6B,MAAO,SAASyyB,EAAYzyB,GAE5B,EACAwtB,SAAU,SAASiF,GAEnB,EACAxwC,MAAO,SAASwwC,GAEhB,EACA1pB,IAAK,SAAS0pB,GAEd,EACAC,UAAW,SAASD,GAEpB,EACApjD,QAAS,SAASojD,GAElB,IAIE8C,EAAOj9B,OAASi9B,EAAOpuC,MACtBouC,EAAOj9B,MAAMzmB,QAAQ0jD,EAAOpuC,MAAQ,EACvC,MAAM,IAAIha,MAAM,iBACfooD,EAAOpuC,KACP,sDACA43C,GAAWt0B,KAAKu0B,UAAUzJ,EAAOj9B,QACjC,KAyBH,QArBiC,IAAtBi9B,EAAOlB,aACjBkB,EAAOlB,WAAa,KAEM94C,MAAvBg6C,EAAO0J,eAA4B1J,EAAO0J,aAAe,GAClC1jD,MAAvBg6C,EAAO2J,eAA4B3J,EAAO2J,aAAe,GACxC3jD,MAAjBg6C,EAAOnwC,SAAsBmwC,EAAOnwC,OAAS,KAC5B7J,MAAjBg6C,EAAOlwC,SAAsBkwC,EAAOlwC,OAAS,KACzB9J,MAApBg6C,EAAOkF,YAAyBlF,EAAOkF,UAAY,KAC/Bl/C,MAApBg6C,EAAOyC,YAAyBzC,EAAOyC,UAAY,MAC/Bz8C,MAApBg6C,EAAOC,YAAyBD,EAAOC,UAAY,MAC5Bj6C,MAAvBg6C,EAAO+E,eAA4B/E,EAAO+E,aAAe,GAClC/+C,MAAvBg6C,EAAO8E,eAA4B9E,EAAO8E,aAAe,GACvB9+C,MAAlCg6C,EAAO6D,0BAAuC7D,EAAO6D,wBAA0B,IAC7C79C,MAAlCg6C,EAAO8D,0BAAuC9D,EAAO8D,wBAA0B,IAC7C99C,MAAlCg6C,EAAOqD,0BAAuCrD,EAAOqD,wBAA0B,IACpDr9C,MAA3Bg6C,EAAO0D,mBAAgC1D,EAAO0D,iBAAmB,MACtC19C,MAA3Bg6C,EAAO2D,mBAAgC3D,EAAO2D,iBAAmB,MACtC39C,MAA3Bg6C,EAAO4D,mBAAgC5D,EAAO4D,iBAAmB5D,EAAOqD,yBAEtDr9C,MAAlBg6C,EAAO4E,UAAuB5E,EAAO4E,QAAUgF,OAAOC,cAC5B7jD,MAA1Bg6C,EAAO8J,kBAA+B9J,EAAO8J,gBAAkBF,OAAOC,eACrEE,GAAe/J,EAAO4E,SAC1B,MAAMhtD,MAAM,wBAEb,IAAKmyD,GAAe/J,EAAO8J,iBAC1B,MAAMlyD,MAAM,gCAEb,GAAqBoO,MAAjBg6C,EAAOqE,OACV,MAAMzsD,MAAM,6BAGb,OAAOooD,CACR,CAEA,SAAAgK,CAAUlK,EAAcriD,GACvB,IAAIwsD,EAAWpD,GAAc9vD,KAAKuwD,IAAK,sBAAsB,GAC7D2C,EAASjD,UAAUhmD,OAAO,uBAC1BipD,EAASC,UAAY,sDAAsDzsD,QAG3EqiD,EAAME,OAAOviD,MAAM1G,KAAM+oD,EAAOriD,EACjC,CAEA,SAAA0sD,GACgBtD,GAAc9vD,KAAKuwD,IAAK,sBAAsB,GACpDN,UAAUnhD,IAAI,sBACxB,CAEA,QAAA4iD,GACC,IAAInB,EAAMvwD,KAAKuwD,IAAMhnD,GAAsB,8tBAgB3C,IAGCvJ,KAAK8K,OAASuoD,GAAW9C,EAAK,gBAAgB,GAC9CvwD,KAAKywD,WAAa4C,GAAW9C,EAAK,cAAc,GAChDvwD,KAAK0wD,kBAAoB1wD,KAAKywD,WAAWplD,WAAW,MAEpD,IAAIioD,EAAc,CAAEnoD,MAAOnL,KAAKixD,aAAa9lD,OAC7CnL,KAAK6M,QAAU,IAAIhC,EAA6B7K,KAAK8K,OAAQwoD,GAE7DtzD,KAAKswD,cAAgB,IAAI1S,GAAc59C,KAAK8K,OAAQ9K,KAAK6M,SAAS,GAClE7M,KAAK6wD,cAAgB,IAAIzQ,GAAcpgD,KAAKswD,cAC7C,CAAE,MAAO9mD,GAGR,OADAxB,QAAQC,IAAI,yHACLsoD,CACR,CAGAvwD,KAAKuzD,2BAA2BvzD,KAAKixD,aAAatR,UAGlD3/C,KAAK8wD,aAAe,IAAIniD,EAAa3O,KAAK6M,SAG1C7M,KAAKmxD,4BAA8BqC,uBAAsB,IAAMxzD,KAAKyzD,cAGpEC,YAAYC,KAAK,oBACjB3zD,KAAKoxD,oBAAsB,EACvBpxD,KAAKixD,aAAaa,gCAAkC,GACvD8B,aAAY,IAAM5zD,KAAK6zD,iCAAiC,IAAM7zD,KAAKixD,aAAaa,iCAIjF9xD,KAAKwwD,eAAiBV,GAAcS,EAAK,yBAAyB,GAClE,IAAI90B,EAAWq0B,GAAcS,EAAK,yBAAyB,GAkB3D,OAjBAvwD,KAAK2wD,eAAiB,IAAIrB,GAC1B7zB,EAASg2B,YAAYzxD,KAAK2wD,eAAed,UACzC7vD,KAAK4wD,WAAayC,GAAW9C,EAAK,kCAAkC,GAEpEvwD,KAAK4wD,WAAWkD,QAAU,KACrB9zD,KAAK2qD,OAAQ3qD,KAAK+zD,OACjB/zD,KAAKg0D,OAAO,EAIlBC,OAAOC,SAAW,KACjBl0D,KAAKyzD,WAAU,EAAM,EAItBzzD,KAAKm0D,aAEE5D,CACR,CAEA,6BAAAsD,GACCH,YAAYC,KAAK,kBACjB,MAAMh/C,EAAY++C,YAAYU,QAAQ,kBAAmB,mBAAoB,kBACvEC,EAAar0D,KAAKoxD,qBAAuBz8C,EAAUsZ,SAAY,KAErE,GAAsB,MAAlBjuB,KAAKqxD,UAAmB,CAC3B,MAAMiD,EAAUn2B,KAAKu0B,UACpB,CACC6B,UAAW,uBACXC,YAAaH,IAGfr0D,KAAKqxD,UAAU/pD,KAAKgtD,EACrB,CAEAZ,YAAYC,KAAK,oBACjB3zD,KAAKoxD,oBAAsB,CAC5B,CAEA,gBAAAqD,CAAiBC,EAAmBzL,GACnC,GAAIjpD,KAAK+wD,OAAO4D,IAAID,GAAY,CAC/B,IAAI3L,EAAQ/oD,KAAK+wD,OAAOhnD,IAAI2qD,GAC5B3L,EAAM0C,gBAAgBxC,GACtBjpD,KAAK40D,WAAW7L,EACjB,KAAO,CACN,IAAIA,EAAQ,IAAI0B,GAAMxB,EAAQjpD,KAAKixD,aAAatR,UAChD3/C,KAAK40D,WAAW7L,GAChB/oD,KAAK+wD,OAAOvhD,IAAIklD,EAAW3L,EAC5B,CACD,CAEO,QAAA8L,CAASH,GACf,OAAO10D,KAAK+wD,OAAOhnD,IAAI2qD,EACxB,CAEO,aAAAI,GACN,OAAO5xD,MAAMggD,KAAKljD,KAAK+wD,OAAOrmD,OAC/B,CAEA,WAAAqqD,CAAYL,GACX10D,KAAK+wD,OAAOiE,OAAON,EACpB,CAEA,UAAAE,CAAW7L,GACV,IAAIE,EAASF,EAAME,OAEnB,IAGCF,EAAME,OAASjpD,KAAKmyD,oBAAoBpJ,EAAME,OAC/C,CAAE,MAAOz/C,GAER,YADAxJ,KAAKizD,UAAUlK,EAAOv/C,EAEvB,CAGA,GAAIy/C,EAAOgM,YACV,IAAK,IAAI9uD,KAAQ8iD,EAAOgM,YAAa,CACpC,IAAItuD,EAAOsiD,EAAOgM,YAAY9uD,GAC9BnG,KAAK8wD,aAAa1oD,cAAcjC,EAAMQ,EACvC,CAEGsiD,EAAOmJ,QACVpyD,KAAK8wD,aAAavoD,SAAS0gD,EAAOmJ,SAElCpyD,KAAK8wD,aAAazoD,WAAW4gD,EAAOoJ,SAErCryD,KAAK8wD,aAAa/nD,iBAAiBkgD,EAAOqJ,UACtCrJ,EAAOiM,iBAAmBjM,EAAOiM,gBAAgB1uD,KACpDxG,KAAK8wD,aAAatoD,YAAYygD,EAAOiM,gBAAgB1uD,IAKvD,CAEA,QAAA2uD,CAASh1D,EAAci1D,EAAaC,GACnC,IAAI1V,EAAW3/C,KAAKixD,aAAatR,SAE7B73B,EAAK9nB,KAAKswD,cAAcvS,OAAOxY,cAClC,IAAI7E,GAAQ00B,EAAIC,EAAI,IAEjBC,EAAU,IAAI1hD,EAAQkU,EAAGtjB,EAAGsjB,EAAGpjB,GACnC4wD,EAAQ5wD,EAAIi7C,EAASz9C,OAASozD,EAAQ5wD,EACtC0wD,EAAME,EAAQ9wD,EACd6wD,EAAMC,EAAQ5wD,EAEd,IAAI6wD,EAAMv1D,KAAK0wD,kBACf6E,EAAIC,OACJD,EAAI7kC,UAAU0kC,EAAKC,GAEnBE,EAAIE,KAAOz1D,KAAKixD,aAAac,SAAW,MAAQ/xD,KAAKixD,aAAae,SAClEuD,EAAIG,aAAe,SACnB,IAAI/uD,EAAO4uD,EAAII,YAAYx1D,GACvB+B,EAASyE,EAAKivD,wBAA0BjvD,EAAKkvD,yBAC7C5zD,EAAQ0E,EAAK1E,MAEjBszD,EAAIO,YAEJP,EAAIQ,UAAY,QAChBR,EAAIS,UAAU/zD,EAAM,EAFV,IAEwBA,EAAQ,IAAQC,EAAS,IAC3DqzD,EAAIU,OAEJV,EAAIQ,UAAY,QAChBR,EAAIW,SAAS/1D,GAAO8B,EAAM,EAAG,GAC7BszD,EAAI9pD,SACL,CAEA,2BAAA0qD,CAA4BxW,EAAuBlc,EAAcC,EAAa0yB,GAC7E,IAAIn0D,EAAQ09C,EAAS19C,MACjBC,EAASy9C,EAASz9C,OAClBm0D,EAAM,IAAI3wB,GAAkBzjC,EAAOC,GAYvC,OAXAm0D,EAAI5yB,KAAOA,EACX4yB,EAAI3yB,IAAMA,EACV2yB,EAAI3xB,IAAM0xB,EACVC,EAAI1xB,KAAO,EACX0xB,EAAIzyC,SAASpf,EAAI,EACjB6xD,EAAIzyC,SAASlf,EAAI,EACjB2xD,EAAIzyC,SAAS+c,EAAI,EACjB01B,EAAI5oD,SAGUxL,EAAM,GADZo0D,EAAIvxB,eAAevW,OAAO+S,GAGnC,CAEA,0BAAAiyB,CAA2B5T,GAC1B,IAAI0W,EAAMr2D,KAAKswD,cAAcvS,OAC7BsY,EAAI5yB,KAAOzjC,KAAKixD,aAAagB,sBAC7BoE,EAAI3yB,IAAM1jC,KAAKixD,aAAaiB,qBAC5BmE,EAAI1xB,KAAO,EACX0xB,EAAIzyC,SAASpf,EAAI,EACjB6xD,EAAIzyC,SAASlf,EAAIi7C,EAASz9C,OAAO,EAEjCm0D,EAAIzyC,SAAS+c,GAAK3gC,KAAKm2D,4BACtBxW,EAAU0W,EAAI5yB,KAAM4yB,EAAI3yB,IAAK2yB,EAAI3xB,KAElC2xB,EAAIpxD,UAAY,IAAIy7B,GAAQ,EAAG,GAAI,GACnC21B,EAAI5oD,QACL,CAEA,oBAAA6oD,CAAqBvN,EAAcpJ,GAClC,IAAI0W,EAAMr2D,KAAKswD,cAAcvS,OAC7BsY,EAAIzyC,SAASpf,EAAI,EACjB6xD,EAAIzyC,SAASlf,EAAIi7C,EAASz9C,OAAO,EAEjCm0D,EAAIzyC,SAAS+c,GAAK3gC,KAAKm2D,4BAA4BxW,EAAU0W,EAAI5yB,KAAM4yB,EAAI3yB,IAAK2yB,EAAI3xB,KACpF2xB,EAAIzyC,SAAS+c,GAAKooB,EAAM8C,eACxBwK,EAAIpxD,UAAY,IAAIy7B,GAAQ,EAAG,GAAI,GAKnC21B,EAAI5oD,QACL,CAEA,SAAAgmD,CAAW8C,GAAmB,GACzBA,IAAqBv2D,KAAKkxD,4BAC7BlxD,KAAKmxD,4BAA8BqC,uBAAsB,IAAMxzD,KAAKyzD,eAErE,IACI1oD,EADM/K,KAAK6M,QACF9B,GAGb,IAAIyrD,EAAMltD,SACNmtD,EAAeD,EAAIE,mBAAqBF,EAAIG,yBAA2BH,EAAII,sBAAwBJ,EAAIK,oBAE3G,IAAIC,GAAK,IAAI3nD,GAAQS,cACpB6mD,EACAz2D,KAAKixD,aAAaW,0BAClB5xD,KAAKixD,aAAaxQ,iBAEnB11C,EAAGq2C,WAAW0V,EAAG1nD,EAAG0nD,EAAGznD,EAAGynD,EAAGxnD,EAAGwnD,EAAGvnD,GACnCxE,EAAGmE,MAAMnE,EAAGs2C,kBAGZrhD,KAAKywD,WAAWxuD,MAAQjC,KAAKywD,WAAWjR,YACxCx/C,KAAKywD,WAAWvuD,OAASlC,KAAKywD,WAAW/Q,aACzC1/C,KAAK0wD,kBAAkBqG,UAAU,EAAE,EAAG/2D,KAAKywD,WAAWxuD,MAAOjC,KAAKywD,WAAWvuD,QAO7ElC,KAAKswD,cAAchR,OAAOxQ,GAAW+Q,QAGrC,IAAImX,EAAe9zD,MAAMggD,KAAKljD,KAAK+wD,OAAOrmD,QAAQusD,MAAK,CAAC1nD,EAASD,KAChE,IAAIuS,EAAK7hB,KAAK+wD,OAAOhnD,IAAIwF,GACrBuS,EAAK9hB,KAAK+wD,OAAOhnD,IAAIuF,GACrBF,EAAI0S,EAAG+pC,eAAiBhqC,EAAGgqC,eAE/B,OAAS,GAALz8C,EAAgByS,EAAG0pC,WAAazpC,EAAGypC,WAChCn8C,CAAC,IAGL8nD,GAAoB,EACxB,IAAK,IAAI9sD,KAAO4sD,EAAc,CAC7B,IAAIjO,EAAQ/oD,KAAK+wD,OAAOhnD,IAAIK,GAC5B,GAAI2+C,EAAMuC,kBAET,SAaD,GARItrD,KAAK8wD,aAAazmD,qBAAyC,MAAlB0+C,EAAMhzC,UAClD/V,KAAKm3D,aAAapO,IAOdA,EAAM/iD,OAAQ,CAClBkxD,GAAoB,EACpB,QACD,CAEA,IAAIvX,EAAW3/C,KAAKixD,aAAatR,SAIjC,IAAKoJ,EAAM4B,QAAU5B,EAAMO,gBAAgBxlD,OAAS,EAAG,CACtDilD,EAAMngC,KAAKnb,SACX,IAAIiH,EAAQq0C,EAAMngC,KAAKlU,MAAQq0C,EAAM8B,MAEjCuM,EAAoBrO,EAAM2B,eAAerD,WAAW,GAAGjwB,UAAUnJ,SAErE,IADA86B,EAAM6B,UAAYl2C,EACXq0C,EAAM6B,UAAYwM,GAA0C,GAArBA,GAC7CrO,EAAM6B,UAAYwM,EAEnBrO,EAAM6B,SAAWjmD,KAAK4L,IAAI,EAAG5L,KAAK2L,IAAIy4C,EAAM6B,SAAUwM,IACtDp3D,KAAK2wD,eAAeZ,SAAShH,EAAM6B,SAAWwM,GAE9CrO,EAAMQ,cAAc70C,EAAOirC,GAC3BoJ,EAAMhzC,SAASqG,iBACf2sC,EAAM2B,eAAej9C,OAAOiH,GAC5Bq0C,EAAM2B,eAAexqC,MAAM6oC,EAAMhzC,SAClC,CAQA,GAPAgzC,EAAMhzC,SAASwG,uBAGfvc,KAAKs2D,qBAAqBvN,EAAOpJ,GAEjC3/C,KAAKswD,cAAc/gB,QAEfwZ,EAAME,OAAOiM,iBAAmBnM,EAAME,OAAOiM,gBAAgB1uD,IAAK,CACrE,IAAI6wD,EAAUr3D,KAAK8wD,aAAa/mD,IAAIg/C,EAAME,OAAOiM,gBAAgB1uD,KAC3DuiD,EAAME,OAAOiM,gBAAgB30B,eAAe,MAAQwoB,EAAME,OAAOiM,gBAAgB30B,eAAe,MAAQwoB,EAAME,OAAOiM,gBAAgB30B,eAAe,UAAYwoB,EAAME,OAAOiM,gBAAgB30B,eAAe,UAGjNvgC,KAAKswD,cAAc5R,YAAY2Y,EAAStO,EAAME,OAAOiM,gBAAgB1wD,EAAGukD,EAAME,OAAOiM,gBAAgBxwD,EAAGqkD,EAAME,OAAOiM,gBAAgBjzD,MAAO8mD,EAAME,OAAOiM,gBAAgBhzD,QAFzKlC,KAAKswD,cAAc5R,YAAY2Y,EAAS1X,EAASn7C,EAAGm7C,EAASj7C,EAAGi7C,EAAS19C,MAAO09C,EAASz9C,OAI3F,CAiBA,GAfAlC,KAAKswD,cAAc9R,aAAauK,EAAMhzC,SAAUgzC,EAAME,OAAOx8C,oBAO7DzM,KAAKm1D,SACJpM,EAAME,OAAO8J,gBACbhK,EAAM4C,eACN5C,EAAM6C,eAAiBjnD,KAAKC,IAAImkD,EAAMK,aAAa1kD,GAAKqkD,EAAM4E,2BAE/D3tD,KAAKswD,cAAc7zB,MAGfz8B,KAAKixD,aAAatR,SAAS2X,YAAa,CAC3Ct3D,KAAKswD,cAAc/gB,QAEnB,IAAIgoB,EAAYxO,EAAMU,cAClBV,EAAMpkC,MAAMngB,EAAI,EACnBxE,KAAKswD,cAAc9pB,MAClB,EACA+wB,EAAU/yD,EAAIukD,EAAMK,aAAa5kD,EACjC+yD,EAAU7yD,EAAIqkD,EAAMK,aAAa1kD,EACjCqkD,EAAMK,aAAannD,MACnB8mD,EAAMK,aAAalnD,OACnBiN,EAAMqoD,MAGPx3D,KAAKswD,cAAc9pB,MAClB,EACA+wB,EAAU/yD,GAAKukD,EAAMK,aAAannD,MAAQ8mD,EAAMK,aAAa5kD,GAC7D+yD,EAAU7yD,EAAIqkD,EAAMK,aAAa1kD,EACjCqkD,EAAMK,aAAannD,MACnB8mD,EAAMK,aAAalnD,OACnBiN,EAAM8mC,OAIRj2C,KAAKswD,cAAc9pB,MAClB,EACA+wB,EAAU/yD,EAAIukD,EAAMiC,UAAUxmD,EAC9B+yD,EAAU7yD,EAAIqkD,EAAMiC,UAAUtmD,EAC9BqkD,EAAMiC,UAAU/oD,MAChB8mD,EAAMiC,UAAU9oD,OAChBiN,EAAMsoD,QAGPz3D,KAAKswD,cAAc5e,QAAO,EAAM6lB,EAAU/yD,EAAG+yD,EAAU7yD,EAAG,GAAIyK,EAAMuoD,KACpE13D,KAAKswD,cAAc7zB,KACpB,CACD,CAEAz8B,KAAK23D,0BAEDT,IACHl3D,KAAK8wD,aAAalmD,cAClB5K,KAAKozD,aAENpzD,KAAKoxD,qBAAuB,CAC7B,CAGO,sBAAAwG,CAAuBC,GAE7B,OADA73D,KAAKsxD,gBAAgBvsD,KAAK8yD,GACnB,KACN73D,KAAKsxD,gBAAkBtxD,KAAKsxD,gBAAgBwG,QAAOnoD,GAAKA,IAAMkoD,GAAS,CAEzE,CAEA,uBAAAF,GACC,IAAK,IAAIxyD,EAAI,EAAGA,EAAInF,KAAKsxD,gBAAgBxtD,OAAQqB,IAChDnF,KAAKsxD,gBAAgBnsD,GAAGnF,KAAK6M,QAE/B,CAEA,KAAA8X,CAAMo7B,EAAqBC,EAAsBC,EAAqBC,GACrE,IAEIv7B,EAFcu7B,EAAeD,EACfD,EAAeD,EACOE,EAAcF,EAAcG,EAAeF,EAC/Ep4B,EAAO,IAAIhU,EAGf,OAFAgU,EAAKpjB,EAAIu7C,EAAcp7B,EACvBiD,EAAKljB,EAAIs7C,EAAer7B,EACjBiD,CACR,CAEA,YAAAuvC,CAAcpO,GACb,GAAIA,EAAM/iD,QAAU+iD,EAAMuC,kBAAmB,OAE7C,GAAItrD,KAAK8wD,aAAatmD,YAErB,YADAxK,KAAKizD,UAAUlK,EAAO,6CAA+C0J,GAAWt0B,KAAKu0B,UAAU1yD,KAAK8wD,aAAanmD,eAIlH,IACIguB,EADA7uB,EAAQ9J,KAAK8wD,aAAa/mD,IAAIg/C,EAAME,OAAOqJ,UAE/C,GAAIvJ,EAAME,OAAOmJ,QAAS,CACzB,IAAI2F,EAAW/3D,KAAK8wD,aAAa/mD,IAAIg/C,EAAME,OAAOmJ,SAC9Cn0B,EAAO,IAAID,GAAa,IAAIrjB,EAAsB7Q,IACtD,IACC6uB,EAAesF,EAAKxF,iBAAiBs/B,EACtC,CAAE,MAAOvuD,GAER,YADAxJ,KAAKizD,UAAUlK,EAAO,gDAAkD0J,GAAWt0B,KAAKu0B,UAAUlpD,IAEnG,CACD,KAAO,CACN,IAAIzB,EAAa/H,KAAK8wD,aAAa/mD,IAAIg/C,EAAME,OAAOoJ,SAChD35B,EAAS,IAAIL,GAAe,IAAI1d,EAAsB7Q,IAC1D,IACC6uB,EAAeD,EAAOD,iBAAiB1wB,EACxC,CAAE,MAAOyB,GAER,YADAxJ,KAAKizD,UAAUlK,EAAO,gDAAkD0J,GAAWt0B,KAAKu0B,UAAUlpD,IAEnG,CACD,CAmBA,GAlBAu/C,EAAMhzC,SAAW,IAAIkU,EAAS0O,GAGzBowB,EAAME,OAAOpuC,MACb8d,EAAa3M,MAAMloB,OAAS,IAC/BilD,EAAME,OAAOpuC,KAAO8d,EAAa3M,MAAM,GAAG/nB,MAIxC8kD,EAAME,OAAOj9B,OAAS+8B,EAAME,OAAOpuC,KAAK/W,OAAS,GACpDilD,EAAME,OAAOj9B,MAAMgsC,SAAQn9C,IACrBkuC,EAAMhzC,SAASpP,KAAKmmB,SAASjS,IACjC7a,KAAKizD,UAAUlK,EAAO,gBAAgBluC,yDAEvC,IAIEkuC,EAAME,OAAOpuC,KAAM,CACtB,IAAKkuC,EAAMhzC,SAASpP,KAAKmmB,SAASi8B,EAAME,OAAOpuC,MAE9C,YADA7a,KAAKizD,UAAUlK,EAAO,gBAAgBA,EAAME,OAAOpuC,qCAGpDkuC,EAAMhzC,SAAS6W,cAAcm8B,EAAME,OAAOpuC,MAC1CkuC,EAAMhzC,SAASuW,qBAChB,CACAy8B,EAAMmB,qBAENnB,EAAME,OAAOxiD,QAAQzG,KAAM+oD,GAC3BA,EAAM/iD,QAAS,CAChB,CAEQiyD,SAAgB,EAChB,UAAA9D,GACP,IAAIrpD,EAAS9K,KAAK8K,OACN,IAAI+6B,GAAM/6B,GAChBu8B,YAAY,CACjBL,KAAM,CAACxiC,EAAGE,KAAJ,EACNkiC,QAAS,CAACpiC,EAAGE,KAAJ,EACTmiC,MAAO,CAACriC,EAAGE,KAAJ,EACPw/B,GAAI,CAAC1/B,EAAGE,KACF1E,KAAKixD,aAAaY,eACnB7xD,KAAK2qD,OACR3qD,KAAK+zD,OAEL/zD,KAAKg0D,QACN,IAUF,IAAIkE,GAAoB,EACpBC,GAAkB,EACtB7uD,SAASgC,iBAAiB,aAAczC,IACnCA,aAAc09B,YACjB6xB,EAAYvvD,EAAG69B,QAAS79B,EAAG89B,QAC5B,IAEDr9B,SAASgC,iBAAiB,aAAczC,IACvC,GAAIA,aAAcwvD,WAAY,CAC7B,IAAIpxB,EAAUp+B,EAAGq+B,eACjB,GAAID,EAAQnjC,OAAS,EAAG,CACvB,IAAIqjC,EAAQF,EAAQ,GACpBmxB,EAAYjxB,EAAMT,QAASS,EAAMR,QAClC,CACD,KAGD,IAAIyxB,EAAc,CAACE,EAAgBC,KAElC,IAAKv4D,KAAKixD,aAAaY,aAAc,OAErC,IAAI2G,EAAQ1I,GAAc9vD,KAAKuwD,IAAK,sBAUpC,GATA2H,EAAoBO,EAAQH,EAAQC,EAAQv4D,KAAKwwD,eAAe/pB,yBAChE0xB,EAAkBM,EAAQH,EAAQC,EAAQv4D,KAAK8K,OAAO27B,yBACtDiyB,aAAa14D,KAAKi4D,UACS,GAAhBO,EAAM10D,QAAgBo0D,GAAsBC,GAAoBn4D,KAAK2qD,OAI/E3qD,KAAKwwD,eAAeP,UAAUhmD,OAAO,gCAFrCjK,KAAKwwD,eAAeP,UAAUnhD,IAAI,iCAI9BopD,GAAqC,GAAhBM,EAAM10D,SAAgB9D,KAAK2qD,OAAQ,CAC5D,IAAI1gD,EAAS,KACPjK,KAAK2qD,QAAQ3qD,KAAKwwD,eAAeP,UAAUnhD,IAAI,+BAA+B,EAEpF9O,KAAKi4D,SAAWU,WAAW1uD,EAAQ,IACpC,GAGGwuD,EAAU,CAACH,EAAgBC,EAAgB/xB,KAC9C,IAAIhiC,EAAI8zD,EAAS9xB,EAAKjD,KAClB7+B,EAAI6zD,EAAS/xB,EAAKtD,IACtB,OAAO1+B,GAAK,GAAKA,GAAKgiC,EAAKvkC,OAASyC,GAAK,GAAKA,GAAK8hC,EAAKtkC,MAAM,CAEhE,CAEQ,IAAA6xD,GACP/zD,KAAK2qD,QAAS,EAId3qD,KAAKi4D,SAAWU,YAHH,KACP34D,KAAK2qD,QAAQ3qD,KAAKwwD,eAAeP,UAAUnhD,IAAI,+BAA+B,GAEjD,KACnC9O,KAAK4wD,WAAWX,UAAUhmD,OAAO,iCACjCjK,KAAK4wD,WAAWX,UAAUnhD,IAAI,kCAE9B,IAAI,IAAK1E,EAAI2+C,KAAU/oD,KAAK+wD,OAC3BhI,EAAM4B,QAAS,EACX5B,EAAM2B,iBACJ3B,EAAM2B,eAAerD,WAAW,IACpC0B,EAAM0D,iBAKV,CAEQ,KAAAuH,GACPh0D,KAAK2qD,QAAS,EACd3qD,KAAKwwD,eAAeP,UAAUhmD,OAAO,gCACrCyuD,aAAa14D,KAAKi4D,UAElBj4D,KAAK4wD,WAAWX,UAAUhmD,OAAO,kCACjCjK,KAAK4wD,WAAWX,UAAUnhD,IAAI,iCAE9B,IAAI,IAAK1E,EAAK2+C,KAAU/oD,KAAK+wD,OAC5BhI,EAAM4B,QAAS,CAEjB,CAGO,gBAAAiO,GACN,OAAO54D,KAAKswD,aACb,EAgBD,SAAS+C,GAAW9C,EAAkBp7C,GACrC,IAAI0jD,EAAQ,IAAI31D,MACZ41D,EAAgB,CAACvI,EAAkBp7C,EAAY0jD,KAClD,IAAI,IAAI1zD,EAAI,EAAGA,EAAIorD,EAAI90C,SAAS3X,OAAQqB,IAAK,CAC5C,IAAI2b,EAAQyvC,EAAI90C,SAAStW,GACrB2b,EAAM3L,KAAOA,GAAI0jD,EAAM9zD,KAAK+b,GAChCg4C,EAAch4C,EAAO3L,EAAI0jD,EAC1B,GAGD,OADAC,EAAcvI,EAAKp7C,EAAI0jD,GAChBA,CACR,CAEA,SAAS/I,GAAcS,EAAkBwI,GACxC,IAAIF,EAAQ,IAAI31D,MACZ41D,EAAgB,CAACvI,EAAkBwI,EAAmBF,KACzD,IAAI,IAAI1zD,EAAI,EAAGA,EAAIorD,EAAI90C,SAAS3X,OAAQqB,IAAK,CAC5C,IAAI2b,EAAQyvC,EAAI90C,SAAStW,GACrB2b,EAAMmvC,UAAUjhD,SAAS+pD,IAAYF,EAAM9zD,KAAK+b,GACpDg4C,EAAch4C,EAAOi4C,EAAWF,EACjC,GAGD,OADAC,EAAcvI,EAAKwI,EAAWF,GACvBA,CACR,CAEA,SAAStvD,GAAcyvD,GACtB,IAAIzI,EAAMjnD,SAASC,cAAc,OAEjC,OADAgnD,EAAI4C,UAAY6F,EACTzI,EAAI90C,SAAS,EACrB,CAQA,SAASg3C,GAAWhyB,GACnB,OAAKA,EACEA,EACJpQ,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,SACdA,QAAQ,KAAM,SANA,EAOjB,CAED,SAAS2iC,GAAevyB,GACvB,MAAO,yBAAyBw4B,KAAKx4B,EACtC,CCr9BM,MAAMy4B,GACFC,OACAC,YACAC,kBACAC,YACAC,uBACAC,gBACAC,mBACAC,YACAC,cAEP,WAAA75D,CAAY45D,EAAqBzQ,GAC7BjpD,KAAK25D,cAAgB1Q,EACrB,MAAM,MAAEhnD,EAAK,OAAEC,EAAM,UAAE03D,EAAS,WAAEC,GAAe5Q,EAGjD,IAAIwM,EAAO,IAAIqE,SAAS,OAAQ,0CAChCrE,EAAKnyD,OAAOy2D,MAAK,KAAQzwD,SAAS0wD,MAAMlrD,IAAI2mD,EAAK,IAEjDz1D,KAAK05D,YAAcA,EACnB15D,KAAKm5D,OAAS,KACdn5D,KAAKo5D,YAAc,KACnBp5D,KAAKu5D,uBAAyB,KAC9Bv5D,KAAKw5D,gBAAkB,KACvBx5D,KAAKy5D,mBAAqB,IAC1Bz5D,KAAKi6D,cAAcj6D,KAAK05D,aAEA,MAApB15D,KAAKo5D,cACLp5D,KAAKq5D,kBAAoB,CACrB5Y,gBAAiB,YACjBt1C,OAAO,EACP0mD,cAAc,EACdlS,SAAU,CACNn7C,EAAG,EACHE,EAAG,EACHzC,MAAOA,EACPC,OAAQA,EACRg4D,QAAS,EACTC,SAAU,EACVC,OAAQ,EACRC,UAAW,EACX/C,YAAasC,GAEjBhI,0BAA2B,KAC3BsD,gBAAiB,KACjBnD,SAAU,GACVC,SAAU,OACVF,gCAAiC,GAEjCG,sBAAuB,EACvBC,qBAAsB,KAG1BlqD,QAAQC,IAAI,+BACZjI,KAAKo5D,YAAc,IAAI/I,GAAY,YAAarwD,KAAKq5D,mBAE7D,CAEA,aAAAY,CAAcP,GACV,MACMY,GAD+C,WAA7BrG,OAAO/oB,SAASqvB,SAAyB,OAAS,OACnC,KAAOrvB,SAASsvB,KAAO,oBAAoBd,IAElF1xD,QAAQC,IAAI,sBACZjI,KAAKm5D,OAAS,IAAIsB,UAAUH,GAC5Bt6D,KAAKm5D,OAAO7tD,iBAAiB,QAASooB,IAClC1rB,QAAQC,IAAI,iBACZjI,KAAKw5D,gBAAkBx5D,KAAKu5D,uBAC5Bv5D,KAAKo5D,YAAYzH,aAAa3xD,KAAKm5D,OAAO,IAE9Cn5D,KAAKm5D,OAAO7tD,iBAAiB,UACzBtL,KAAK06D,eAAeztD,KAAKjN,OAE7BA,KAAKm5D,OAAO7tD,iBAAiB,SAAUooB,IACnC1rB,QAAQC,IAAI,mBAAoByrB,GAChC1zB,KAAKo5D,YAAYzH,aAAa,MAK9B3xD,KAAKw5D,iBAAmB,EACpBx5D,KAAKw5D,gBAAkBx5D,KAAKy5D,qBAC5BzxD,QAAQC,IAAI,eAAiBjI,KAAKw5D,gBAAkB,MACpDb,YAAW,IAAM34D,KAAKi6D,cAAcj6D,KAAK05D,cAAc15D,KAAKw5D,iBAChE,IAEJx5D,KAAKm5D,OAAO7tD,iBAAiB,SAAUooB,IACnC1rB,QAAQC,IAAI,mBAAoByrB,EAAM,GAE9C,CAEA,cAAAgnC,CAAehnC,GACX,IAAIinC,EAAcx8B,KAAKC,MAAM1K,EAAM/sB,MACnCqB,QAAQC,IAAI,qBAAsB0yD,GAEF,gBAA5BA,EAAuB,UACvB36D,KAAK46D,cAAcD,GACgB,mBAA5BA,EAAuB,WAC9B36D,KAAK66D,gBAAgBF,EAE7B,CAEA,aAAAC,CAAcD,GACV,IAAIG,EAAWH,EAAuB,UAClCjP,EAAY,KACZxC,EAAY,KACgB,MAA5ByR,EAAuB,YACvBjP,EAAYiP,EAAuB,UAAK,EACxCzR,EAAYyR,EAAuB,UAAK,GAE5C,IAAIhI,EAAe,EACfC,EAAe,EACgB,MAA/B+H,EAA0B,eAC1BhI,EAAegI,EAA0B,aAAK,EAC9C/H,EAAe+H,EAA0B,aAAK,GAElD,IAAII,EAAqB,IACmB,MAAxCJ,EAAmC,wBACnCI,EAAqBJ,EAAmC,uBAG5D,IAAIK,EAA2B,GAE3BC,EAA2B,GACS,MAApCN,EAA+B,oBAC/BK,EAA2BL,EAA+B,mBAEtB,MAApCA,EAA+B,oBAC/BK,EAA2BL,EAA+B,mBAEtB,MAApCA,EAA+B,oBAC/BM,EAA2BN,EAA+B,mBAE9D,IAAIhO,EAAmB,KACnBC,EAAmB,KACnBC,EAAmBoO,EACc,MAAjCN,EAA4B,iBAC5BhO,EAAmBhoD,KAAKoM,MAAM4pD,EAA4B,eAAK,EAAIK,GACnEpO,EAAmBjoD,KAAKoM,MAhBG,GAgBG4pD,EAA4B,eAAK,IAGnE,IAAI7N,EAA0BkO,EAE1B1O,EAA0B2O,EAE9Bj7D,KAAKs5D,YAAc,CACfzL,QAAS8M,EAAyB,YAClC5H,gBAAiB4H,EAA+B,kBAChDtI,QAASsI,EAAuB,UAChCrI,SAAUqI,EAAwB,WAElCjP,UAAWA,EACXxC,UAAWA,EACX4D,wBAAyBA,EACzBC,wBAhC2B,GAiC3BT,wBAAyBA,EACzBK,iBAAkBA,EAClBC,iBAAkBA,EAClBC,iBAAkBA,EAElB8F,aAAcA,EACdC,aAAcA,EACd95C,OAAQ,IAAO9Y,KAAK25D,cAAcE,WAAalH,EAC/C55C,OAAQ,IAAO/Y,KAAK25D,cAAcE,WAAajH,EAC/CzE,UAAW4M,EACXtuD,oBAAoB,EACpBoiD,mBAAoB8L,EAA6B,gBAAIA,EAA6B,gBAAI,EACtF3M,aAAc,EACdD,aAAc,EAEdT,OAAQqN,EAAoB,OAC5BpN,YAAaoN,EAAyB,YAEtCl0D,QAAS,CAAC8rD,EAAQxJ,KAAT,EAGTriD,MAAO,CAAC6rD,EAAQxJ,EAAcriD,KAC1BqiD,EAAMqC,eAAiB,EACnBrC,EAAMqC,cAAgBrC,EAAMsC,oBAC5BtC,EAAMuC,mBAAoB,GAE9BtjD,QAAQC,IAAIjI,MACZgI,QAAQC,IAAIvB,EAAM,GAI1B1G,KAAKo5D,YAAY3E,iBAAiBqG,EAAU96D,KAAKs5D,YACrD,CAEA,eAAAuB,CAAgBF,GACR36D,KAAKo5D,aACLp5D,KAAKo5D,YAAYrE,YAAY4F,EAAuB,UAE5D,E,gBC9KG,SAASO,EAAgCC,GAC5C,MAAMvB,EAA0C,SAA9BuB,EAAapxD,IAAI,SAC7B4a,EAAQhgB,KAAK4L,IAAI5L,KAAK2L,IAAKhM,WAAW62D,EAAapxD,IAAI,WAAa,EAAI,GAAI,KAC3EqxD,EAAgBC,GA/BpB,SAAmCF,GACtC,IAAIC,EAAiBD,EAAaxG,IAAI,SAChClnC,OAAOhpB,SAAS02D,EAAapxD,IAAI,UACjC,KACFsxD,EAAkBF,EAAaxG,IAAI,UACjClnC,OAAOhpB,SAAS02D,EAAapxD,IAAI,WACjC,KACFuxD,EAAYhyD,SAASioD,eAAe,aAkBxC,OAjBK9jC,OAAO8tC,UAAUH,KAClBA,EAAiB,MAEhB3tC,OAAO8tC,UAAUF,KAClBA,EAAkB,MAEtBD,EAAiBz2D,KAAK4L,IAAI6qD,EAAgB,GAC1CC,EAAkB12D,KAAK4L,IAAI8qD,EAAiB,GAO5CrzD,QAAQC,IAAImzD,EAAgBC,GAC5BC,EAAUlL,MAAMnuD,MAAQ,GAAGm5D,MAC3BE,EAAUlL,MAAMluD,OAAS,GAAGm5D,MACrB,CAACD,EAAgBC,EAC5B,CAK8CG,CAA0BL,GACpE,MAAO,CACHl5D,MAAOm5D,EACPl5D,OAAQm5D,EACRzB,UAAWA,EACXC,WAAYl1C,EAEpB,C","sources":["webpack://spine/./src/core/Texture.ts","webpack://spine/./src/core/BlendMode.ts","webpack://spine/./src/core/BoneData.ts","webpack://spine/./src/core/PathConstraintData.ts","webpack://spine/./src/core/Animation.ts","webpack://spine/./src/core/TextureAtlas.ts","webpack://spine/./src/core/AssetManager.ts","webpack://spine/./src/webgl/WebGL.ts","webpack://spine/./src/webgl/GLTexture.ts","webpack://spine/./src/webgl/AssetManager.ts","webpack://spine/./src/core/Utils.ts","webpack://spine/./src/core/attachments/Attachment.ts","webpack://spine/./src/core/attachments/BoundingBoxAttachment.ts","webpack://spine/./src/core/attachments/ClippingAttachment.ts","webpack://spine/./src/core/attachments/MeshAttachment.ts","webpack://spine/./src/core/attachments/PathAttachment.ts","webpack://spine/./src/core/attachments/PointAttachment.ts","webpack://spine/./src/core/attachments/RegionAttachment.ts","webpack://spine/./src/core/AtlasAttachmentLoader.ts","webpack://spine/./src/core/Bone.ts","webpack://spine/./src/core/IkConstraint.ts","webpack://spine/./src/core/ConstraintData.ts","webpack://spine/./src/core/PathConstraint.ts","webpack://spine/./src/core/Slot.ts","webpack://spine/./src/core/TransformConstraint.ts","webpack://spine/./src/core/Skeleton.ts","webpack://spine/./src/core/attachments/AttachmentType.ts","webpack://spine/./src/core/Event.ts","webpack://spine/./src/core/EventData.ts","webpack://spine/./src/core/IkConstraintData.ts","webpack://spine/./src/core/SkeletonData.ts","webpack://spine/./src/core/Skin.ts","webpack://spine/./src/core/SlotData.ts","webpack://spine/./src/core/TransformConstraintData.ts","webpack://spine/./src/core/SkeletonBinary.ts","webpack://spine/./src/core/SkeletonJson.ts","webpack://spine/./src/webgl/Vector3.ts","webpack://spine/./src/webgl/Matrix4.ts","webpack://spine/./src/webgl/Camera.ts","webpack://spine/./src/webgl/Input.ts","webpack://spine/./src/webgl/Shader.ts","webpack://spine/./src/webgl/Mesh.ts","webpack://spine/./src/webgl/ShapeRenderer.ts","webpack://spine/./src/webgl/SceneRenderer.ts","webpack://spine/./src/core/AnimationState.ts","webpack://spine/./src/webgl/PolygonBatcher.ts","webpack://spine/./src/core/SkeletonBounds.ts","webpack://spine/./src/webgl/SkeletonDebugRenderer.ts","webpack://spine/./src/core/Triangulator.ts","webpack://spine/./src/core/SkeletonClipping.ts","webpack://spine/./src/webgl/SkeletonRenderer.ts","webpack://spine/./src/webgl/LoadingScreen.ts","webpack://spine/./src/core/AnimationStateData.ts","webpack://spine/./src/player/Action.ts","webpack://spine/./src/player/Actor.ts","webpack://spine/./src/player/Player.ts","webpack://spine/./src/stym/runtime.ts","webpack://spine/./src/stym/utils.ts"],"sourcesContent":["/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\n// module spine {\r\n\texport abstract class Texture {\r\n\t\tprotected _image: HTMLImageElement;\r\n\r\n\t\tconstructor (image: HTMLImageElement) {\r\n\t\t\tthis._image = image;\r\n\t\t}\r\n\r\n\t\tgetImage (): HTMLImageElement {\r\n\t\t\treturn this._image;\r\n\t\t}\r\n\r\n\t\tabstract setFilters (minFilter: TextureFilter, magFilter: TextureFilter): void;\r\n\t\tabstract setWraps (uWrap: TextureWrap, vWrap: TextureWrap): void;\r\n\t\tabstract dispose (): void;\r\n\r\n\t\tpublic static filterFromString (text: string): TextureFilter {\r\n\t\t\tswitch (text.toLowerCase()) {\r\n\t\t\t\tcase \"nearest\": return TextureFilter.Nearest;\r\n\t\t\t\tcase \"linear\": return TextureFilter.Linear;\r\n\t\t\t\tcase \"mipmap\": return TextureFilter.MipMap;\r\n\t\t\t\tcase \"mipmapnearestnearest\": return TextureFilter.MipMapNearestNearest;\r\n\t\t\t\tcase \"mipmaplinearnearest\": return TextureFilter.MipMapLinearNearest;\r\n\t\t\t\tcase \"mipmapnearestlinear\": return TextureFilter.MipMapNearestLinear;\r\n\t\t\t\tcase \"mipmaplinearlinear\": return TextureFilter.MipMapLinearLinear;\r\n\t\t\t\tdefault: throw new Error(`Unknown texture filter ${text}`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic static wrapFromString (text: string): TextureWrap {\r\n\t\t\tswitch (text.toLowerCase()) {\r\n\t\t\t\tcase \"mirroredtepeat\": return TextureWrap.MirroredRepeat;\r\n\t\t\t\tcase \"clamptoedge\": return TextureWrap.ClampToEdge;\r\n\t\t\t\tcase \"repeat\": return TextureWrap.Repeat;\r\n\t\t\t\tdefault: throw new Error(`Unknown texture wrap ${text}`);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport enum TextureFilter {\r\n\t\tNearest = 9728, // WebGLRenderingContext.NEAREST\r\n\t\tLinear = 9729, // WebGLRenderingContext.LINEAR\r\n\t\tMipMap = 9987, // WebGLRenderingContext.LINEAR_MIPMAP_LINEAR\r\n\t\tMipMapNearestNearest = 9984, // WebGLRenderingContext.NEAREST_MIPMAP_NEAREST\r\n\t\tMipMapLinearNearest = 9985, // WebGLRenderingContext.LINEAR_MIPMAP_NEAREST\r\n\t\tMipMapNearestLinear = 9986, // WebGLRenderingContext.NEAREST_MIPMAP_LINEAR\r\n\t\tMipMapLinearLinear = 9987 // WebGLRenderingContext.LINEAR_MIPMAP_LINEAR\r\n\t}\r\n\r\n\texport enum TextureWrap {\r\n\t\tMirroredRepeat = 33648, // WebGLRenderingContext.MIRRORED_REPEAT\r\n\t\tClampToEdge = 33071, // WebGLRenderingContext.CLAMP_TO_EDGE\r\n\t\tRepeat = 10497 // WebGLRenderingContext.REPEAT\r\n\t}\r\n\r\n\texport class TextureRegion {\r\n\t\trenderObject: any;\r\n\t\tu = 0; v = 0;\r\n\t\tu2 = 0; v2 = 0;\r\n\t\twidth = 0; height = 0;\r\n\t\trotate = false;\r\n\t\toffsetX = 0; offsetY = 0;\r\n\t\toriginalWidth = 0; originalHeight = 0;\r\n\t}\r\n\r\n\texport class FakeTexture extends Texture {\r\n\t\tsetFilters(minFilter: TextureFilter, magFilter: TextureFilter) { }\r\n\t\tsetWraps(uWrap: TextureWrap, vWrap: TextureWrap) { }\r\n\t\tdispose() { }\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\n// module spine {\r\n\r\n\t/** Determines how images are blended with existing pixels when drawn. */\r\n\texport enum BlendMode {\r\n\t\tNormal,\r\n\t\tAdditive,\r\n\t\tMultiply,\r\n\t\tScreen\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Color } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the setup pose for a {@link Bone}. */\r\n\texport class BoneData {\r\n\t\t/** The index of the bone in {@link Skeleton#getBones()}. */\r\n\t\tindex: number;\r\n\r\n\t\t/** The name of the bone, which is unique across all bones in the skeleton. */\r\n\t\tname: string;\r\n\r\n\t\t/** @returns May be null. */\r\n\t\tparent: BoneData;\r\n\r\n\t\t/** The bone's length. */\r\n\t\tlength: number;\r\n\r\n\t\t/** The local x translation. */\r\n\t\tx = 0;\r\n\r\n\t\t/** The local y translation. */\r\n\t\ty = 0;\r\n\r\n\t\t/** The local rotation. */\r\n\t\trotation = 0;\r\n\r\n\t\t/** The local scaleX. */\r\n\t\tscaleX = 1;\r\n\r\n\t\t/** The local scaleY. */\r\n\t\tscaleY = 1;\r\n\r\n\t\t/** The local shearX. */\r\n\t\tshearX = 0;\r\n\r\n\t\t/** The local shearX. */\r\n\t\tshearY = 0;\r\n\r\n\t\t/** The transform mode for how parent world transforms affect this bone. */\r\n\t\ttransformMode = TransformMode.Normal;\r\n\r\n\t\t/** When true, {@link Skeleton#updateWorldTransform()} only updates this bone if the {@link Skeleton#skin} contains this\r\n\t \t* bone.\r\n\t \t* @see Skin#bones */\r\n\t\tskinRequired = false;\r\n\r\n\t\t/** The color of the bone as it was in Spine. Available only when nonessential data was exported. Bones are not usually\r\n\t\t * rendered at runtime. */\r\n\t\tcolor = new Color();\r\n\r\n\t\tconstructor (index: number, name: string, parent: BoneData) {\r\n\t\t\tif (index < 0) throw new Error(\"index must be >= 0.\");\r\n\t\t\tif (name == null) throw new Error(\"name cannot be null.\");\r\n\t\t\tthis.index = index;\r\n\t\t\tthis.name = name;\r\n\t\t\tthis.parent = parent;\r\n\t\t}\r\n\t}\r\n\r\n\t/** Determines how a bone inherits world transforms from parent bones. */\r\n\texport enum TransformMode {\r\n\t\tNormal, OnlyTranslation, NoRotationOrReflection, NoScale, NoScaleOrReflection\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BoneData } from \"./BoneData\";\r\nimport { ConstraintData } from \"./ConstraintData\";\r\nimport { SlotData } from \"./SlotData\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the setup pose for a {@link PathConstraint}.\r\n\t *\r\n\t * See [Path constraints](http://esotericsoftware.com/spine-path-constraints) in the Spine User Guide. */\r\n\texport class PathConstraintData extends ConstraintData {\r\n\r\n\t\t/** The bones that will be modified by this path constraint. */\r\n\t\tbones = new Array<BoneData>();\r\n\r\n\t\t/** The slot whose path attachment will be used to constrained the bones. */\r\n\t\ttarget: SlotData;\r\n\r\n\t\t/** The mode for positioning the first bone on the path. */\r\n\t\tpositionMode: PositionMode;\r\n\r\n\t\t/** The mode for positioning the bones after the first bone on the path. */\r\n\t\tspacingMode: SpacingMode;\r\n\r\n\t\t/** The mode for adjusting the rotation of the bones. */\r\n\t\trotateMode: RotateMode;\r\n\r\n\t\t/** An offset added to the constrained bone rotation. */\r\n\t\toffsetRotation: number;\r\n\r\n\t\t/** The position along the path. */\r\n\t\tposition: number;\r\n\r\n\t\t/** The spacing between bones. */\r\n\t\tspacing: number;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained rotations. */\r\n\t\trotateMix: number;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained translations. */\r\n\t\ttranslateMix: number;\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name, 0, false);\r\n\t\t}\r\n\t}\r\n\r\n\t/** Controls how the first bone is positioned along the path.\r\n\t *\r\n\t * See [Position mode](http://esotericsoftware.com/spine-path-constraints#Position-mode) in the Spine User Guide. */\r\n\texport enum PositionMode {\r\n\t\tFixed, Percent\r\n\t}\r\n\r\n\t/** Controls how bones after the first bone are positioned along the path.\r\n\t *\r\n\t * [Spacing mode](http://esotericsoftware.com/spine-path-constraints#Spacing-mode) in the Spine User Guide. */\r\n\texport enum SpacingMode {\r\n\t\tLength, Fixed, Percent\r\n\t}\r\n\r\n\t/** Controls how bones are rotated, translated, and scaled to match the path.\r\n\t *\r\n\t * [Rotate mode](http://esotericsoftware.com/spine-path-constraints#Rotate-mod) in the Spine User Guide. */\r\n\texport enum RotateMode {\r\n\t\tTangent, Chain, ChainScale\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { VertexAttachment, Attachment } from \"./attachments/Attachment\";\r\nimport { IkConstraint } from \"./IkConstraint\";\r\nimport { PathConstraint } from \"./PathConstraint\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Slot } from \"./Slot\";\r\nimport { TransformConstraint } from \"./TransformConstraint\";\r\nimport { Utils, MathUtils, ArrayLike } from \"./Utils\";\r\nimport { Event } from \"./Event\";\r\n\r\n// module spine {\r\n\r\n\t/** A simple container for a list of timelines and a name. */\r\n\texport class Animation {\r\n\t\t/** The animation's name, which is unique across all animations in the skeleton. */\r\n\t\tname: string;\r\n\t\ttimelines: Array<Timeline>;\r\n\t\ttimelineIds: Array<boolean>;\r\n\r\n\t\t/** The duration of the animation in seconds, which is the highest time of all keys in the timeline. */\r\n\t\tduration: number;\r\n\r\n\t\tconstructor (name: string, timelines: Array<Timeline>, duration: number) {\r\n\t\t\tif (name == null) throw new Error(\"name cannot be null.\");\r\n\t\t\tif (timelines == null) throw new Error(\"timelines cannot be null.\");\r\n\t\t\tthis.name = name;\r\n\t\t\tthis.timelines = timelines;\r\n\t\t\tthis.timelineIds = [];\r\n\t\t\tfor (var i = 0; i < timelines.length; i++)\r\n\t\t\t\tthis.timelineIds[timelines[i].getPropertyId()] = true;\r\n\t\t\tthis.duration = duration;\r\n\t\t}\r\n\r\n\t\thasTimeline (id: number) {\r\n\t\t\treturn this.timelineIds[id] == true;\r\n\t\t}\r\n\r\n\t\t/** Applies all the animation's timelines to the specified skeleton.\r\n\t\t *\r\n\t\t * See Timeline {@link Timeline#apply(Skeleton, float, float, Array, float, MixBlend, MixDirection)}.\r\n\t\t * @param loop If true, the animation repeats after {@link #getDuration()}.\r\n\t\t * @param events May be null to ignore fired events. */\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, loop: boolean, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\r\n\t\t\tif (loop && this.duration != 0) {\r\n\t\t\t\ttime %= this.duration;\r\n\t\t\t\tif (lastTime > 0) lastTime %= this.duration;\r\n\t\t\t}\r\n\r\n\t\t\tlet timelines = this.timelines;\r\n\t\t\tfor (let i = 0, n = timelines.length; i < n; i++)\r\n\t\t\t\ttimelines[i].apply(skeleton, lastTime, time, events, alpha, blend, direction);\r\n\t\t}\r\n\r\n\t\t/** @param target After the first and before the last value.\r\n\t \t * @returns index of first value greater than the target. */\r\n\t\tstatic binarySearch (values: ArrayLike<number>, target: number, step: number = 1) {\r\n\t\t\tlet low = 0;\r\n\t\t\tlet high = values.length / step - 2;\r\n\t\t\tif (high == 0) return step;\r\n\t\t\tlet current = high >>> 1;\r\n\t\t\twhile (true) {\r\n\t\t\t\tif (values[(current + 1) * step] <= target)\r\n\t\t\t\t\tlow = current + 1;\r\n\t\t\t\telse\r\n\t\t\t\t\thigh = current;\r\n\t\t\t\tif (low == high) return (low + 1) * step;\r\n\t\t\t\tcurrent = (low + high) >>> 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic linearSearch (values: ArrayLike<number>, target: number, step: number) {\r\n\t\t\tfor (let i = 0, last = values.length - step; i <= last; i += step)\r\n\t\t\t\tif (values[i] > target) return i;\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\t/** The interface for all timelines. */\r\n\texport interface Timeline {\r\n\t\t/** Applies this timeline to the skeleton.\r\n\t\t * @param skeleton The skeleton the timeline is being applied to. This provides access to the bones, slots, and other\r\n\t\t *           skeleton components the timeline may change.\r\n\t\t * @param lastTime The time this timeline was last applied. Timelines such as {@link EventTimeline}} trigger only at specific\r\n\t\t *           times rather than every frame. In that case, the timeline triggers everything between `lastTime`\r\n\t\t *           (exclusive) and `time` (inclusive).\r\n\t\t * @param time The time within the animation. Most timelines find the key before and the key after this time so they can\r\n\t\t *           interpolate between the keys.\r\n\t\t * @param events If any events are fired, they are added to this list. Can be null to ignore fired events or if the timeline\r\n\t\t *           does not fire events.\r\n\t\t * @param alpha 0 applies the current or setup value (depending on `blend`). 1 applies the timeline value.\r\n\t\t *           Between 0 and 1 applies a value between the current or setup value and the timeline value. By adjusting\r\n\t\t *           `alpha` over time, an animation can be mixed in or out. `alpha` can also be useful to\r\n\t\t *           apply animations on top of each other (layering).\r\n\t\t * @param blend Controls how mixing is applied when `alpha` < 1.\r\n\t\t * @param direction Indicates whether the timeline is mixing in or out. Used by timelines which perform instant transitions,\r\n\t\t *           such as {@link DrawOrderTimeline} or {@link AttachmentTimeline}. */\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection): void;\r\n\r\n\t\t/** Uniquely encodes both the type of this timeline and the skeleton property that it affects. */\r\n\t\tgetPropertyId (): number;\r\n\t}\r\n\r\n\t/** Controls how a timeline value is mixed with the setup pose value or current pose value when a timeline's `alpha`\r\n\t * < 1.\r\n\t *\r\n\t * See Timeline {@link Timeline#apply(Skeleton, float, float, Array, float, MixBlend, MixDirection)}. */\r\n\texport enum MixBlend {\r\n\t\t/** Transitions from the setup value to the timeline value (the current value is not used). Before the first key, the setup\r\n\t\t * value is set. */\r\n\t\tsetup,\r\n\t\t/** Transitions from the current value to the timeline value. Before the first key, transitions from the current value to\r\n\t\t * the setup value. Timelines which perform instant transitions, such as {@link DrawOrderTimeline} or\r\n\t\t * {@link AttachmentTimeline}, use the setup value before the first key.\r\n\t\t *\r\n\t\t * `first` is intended for the first animations applied, not for animations layered on top of those. */\r\n\t\tfirst,\r\n\t\t/** Transitions from the current value to the timeline value. No change is made before the first key (the current value is\r\n\t\t * kept until the first key).\r\n\t\t *\r\n\t\t * `replace` is intended for animations layered on top of others, not for the first animations applied. */\r\n\t\treplace,\r\n\t\t/** Transitions from the current value to the current value plus the timeline value. No change is made before the first key\r\n\t\t * (the current value is kept until the first key).\r\n\t\t *\r\n\t\t * `add` is intended for animations layered on top of others, not for the first animations applied. Properties\r\n\t\t * keyed by additive animations must be set manually or by another animation before applying the additive animations, else\r\n\t\t * the property values will increase continually. */\r\n\t\tadd\r\n\t}\r\n\r\n\t/** Indicates whether a timeline's `alpha` is mixing out over time toward 0 (the setup or current pose value) or\r\n\t * mixing in toward 1 (the timeline's value).\r\n\t *\r\n\t * See Timeline {@link Timeline#apply(Skeleton, float, float, Array, float, MixBlend, MixDirection)}. */\r\n\texport enum MixDirection {\r\n\t\tmixIn, mixOut\r\n\t}\r\n\r\n\texport enum TimelineType {\r\n\t\trotate, translate, scale, shear,\r\n\t\tattachment, color, deform,\r\n\t\tevent, drawOrder,\r\n\t\tikConstraint, transformConstraint,\r\n\t\tpathConstraintPosition, pathConstraintSpacing, pathConstraintMix,\r\n\t\ttwoColor\r\n\t}\r\n\r\n\t/** The base class for timelines that use interpolation between key frame values. */\r\n\texport abstract class CurveTimeline implements Timeline {\r\n\t\tstatic LINEAR = 0; static STEPPED = 1; static BEZIER = 2;\r\n\t\tstatic BEZIER_SIZE = 10 * 2 - 1;\r\n\r\n\t\tprivate curves: ArrayLike<number>; // type, x, y, ...\r\n\r\n\t\tabstract getPropertyId(): number;\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tif (frameCount <= 0) throw new Error(\"frameCount must be > 0: \" + frameCount);\r\n\t\t\tthis.curves = Utils.newFloatArray((frameCount - 1) * CurveTimeline.BEZIER_SIZE);\r\n\t\t}\r\n\r\n\t\t/** The number of key frames for this timeline. */\r\n\t\tgetFrameCount () {\r\n\t\t\treturn this.curves.length / CurveTimeline.BEZIER_SIZE + 1;\r\n\t\t}\r\n\r\n\t\t/** Sets the specified key frame to linear interpolation. */\r\n\t\tsetLinear (frameIndex: number) {\r\n\t\t\tthis.curves[frameIndex * CurveTimeline.BEZIER_SIZE] = CurveTimeline.LINEAR;\r\n\t\t}\r\n\r\n\t\t/** Sets the specified key frame to stepped interpolation. */\r\n\t\tsetStepped (frameIndex: number) {\r\n\t\t\tthis.curves[frameIndex * CurveTimeline.BEZIER_SIZE] = CurveTimeline.STEPPED;\r\n\t\t}\r\n\r\n\t\t/** Returns the interpolation type for the specified key frame.\r\n\t\t * @returns Linear is 0, stepped is 1, Bezier is 2. */\r\n\t\tgetCurveType (frameIndex: number): number {\r\n\t\t\tlet index = frameIndex * CurveTimeline.BEZIER_SIZE;\r\n\t\t\tif (index == this.curves.length) return CurveTimeline.LINEAR;\r\n\t\t\tlet type = this.curves[index];\r\n\t\t\tif (type == CurveTimeline.LINEAR) return CurveTimeline.LINEAR;\r\n\t\t\tif (type == CurveTimeline.STEPPED) return CurveTimeline.STEPPED;\r\n\t\t\treturn CurveTimeline.BEZIER;\r\n\t\t}\r\n\r\n\t\t/** Sets the specified key frame to Bezier interpolation. `cx1` and `cx2` are from 0 to 1,\r\n\t\t * representing the percent of time between the two key frames. `cy1` and `cy2` are the percent of the\r\n\t\t * difference between the key frame's values. */\r\n\t\tsetCurve (frameIndex: number, cx1: number, cy1: number, cx2: number, cy2: number) {\r\n\t\t\tlet tmpx = (-cx1 * 2 + cx2) * 0.03, tmpy = (-cy1 * 2 + cy2) * 0.03;\r\n\t\t\tlet dddfx = ((cx1 - cx2) * 3 + 1) * 0.006, dddfy = ((cy1 - cy2) * 3 + 1) * 0.006;\r\n\t\t\tlet ddfx = tmpx * 2 + dddfx, ddfy = tmpy * 2 + dddfy;\r\n\t\t\tlet dfx = cx1 * 0.3 + tmpx + dddfx * 0.16666667, dfy = cy1 * 0.3 + tmpy + dddfy * 0.16666667;\r\n\r\n\t\t\tlet i = frameIndex * CurveTimeline.BEZIER_SIZE;\r\n\t\t\tlet curves = this.curves;\r\n\t\t\tcurves[i++] = CurveTimeline.BEZIER;\r\n\r\n\t\t\tlet x = dfx, y = dfy;\r\n\t\t\tfor (let n = i + CurveTimeline.BEZIER_SIZE - 1; i < n; i += 2) {\r\n\t\t\t\tcurves[i] = x;\r\n\t\t\t\tcurves[i + 1] = y;\r\n\t\t\t\tdfx += ddfx;\r\n\t\t\t\tdfy += ddfy;\r\n\t\t\t\tddfx += dddfx;\r\n\t\t\t\tddfy += dddfy;\r\n\t\t\t\tx += dfx;\r\n\t\t\t\ty += dfy;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Returns the interpolated percentage for the specified key frame and linear percentage. */\r\n\t\tgetCurvePercent (frameIndex: number, percent: number) {\r\n\t\t\tpercent = MathUtils.clamp(percent, 0, 1);\r\n\t\t\tlet curves = this.curves;\r\n\t\t\tlet i = frameIndex * CurveTimeline.BEZIER_SIZE;\r\n\t\t\tlet type = curves[i];\r\n\t\t\tif (type == CurveTimeline.LINEAR) return percent;\r\n\t\t\tif (type == CurveTimeline.STEPPED) return 0;\r\n\t\t\ti++;\r\n\t\t\tlet x = 0;\r\n\t\t\tfor (let start = i, n = i + CurveTimeline.BEZIER_SIZE - 1; i < n; i += 2) {\r\n\t\t\t\tx = curves[i];\r\n\t\t\t\tif (x >= percent) {\r\n\t\t\t\t\tlet prevX: number, prevY: number;\r\n\t\t\t\t\tif (i == start) {\r\n\t\t\t\t\t\tprevX = 0;\r\n\t\t\t\t\t\tprevY = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tprevX = curves[i - 2];\r\n\t\t\t\t\t\tprevY = curves[i - 1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn prevY + (curves[i + 1] - prevY) * (percent - prevX) / (x - prevX);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet y = curves[i - 1];\r\n\t\t\treturn y + (1 - y) * (percent - x) / (1 - x); // Last point is 1,1.\r\n\t\t}\r\n\r\n\t\tabstract apply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection): void;\r\n\t}\r\n\r\n\t/** Changes a bone's local {@link Bone#rotation}. */\r\n\texport class RotateTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 2;\r\n\t\tstatic PREV_TIME = -2; static PREV_ROTATION = -1;\r\n\t\tstatic ROTATION = 1;\r\n\r\n\t\t/** The index of the bone in {@link Skeleton#bones} that will be changed. */\r\n\t\tboneIndex: number;\r\n\r\n\t\t/** The time in seconds and rotation in degrees for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, degrees, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount << 1);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.rotate << 24) + this.boneIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time and angle of the specified keyframe. */\r\n\t\tsetFrame (frameIndex: number, time: number, degrees: number) {\r\n\t\t\tframeIndex <<= 1;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + RotateTimeline.ROTATION] = degrees;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\r\n\t\t\tlet bone = skeleton.bones[this.boneIndex];\r\n\t\t\tif (!bone.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tbone.rotation = bone.data.rotation;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tlet r = bone.data.rotation - bone.rotation;\r\n\t\t\t\t\tbone.rotation += (r - (16384 - ((16384.499999999996 - r / 360) | 0)) * 360) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (time >= frames[frames.length - RotateTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tlet r = frames[frames.length + RotateTimeline.PREV_ROTATION];\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tbone.rotation = bone.data.rotation + r * alpha;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\tcase MixBlend.replace:\r\n\t\t\t\t\tr += bone.data.rotation - bone.rotation;\r\n\t\t\t\t\tr -= (16384 - ((16384.499999999996 - r / 360) | 0)) * 360; // Wrap within -180 and 180.\r\n\t\t\t\tcase MixBlend.add:\r\n\t\t\t\t\tbone.rotation += r * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\tlet frame = Animation.binarySearch(frames, time, RotateTimeline.ENTRIES);\r\n\t\t\tlet prevRotation = frames[frame + RotateTimeline.PREV_ROTATION];\r\n\t\t\tlet frameTime = frames[frame];\r\n\t\t\tlet percent = this.getCurvePercent((frame >> 1) - 1,\r\n\t\t\t\t1 - (time - frameTime) / (frames[frame + RotateTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\tlet r = frames[frame + RotateTimeline.ROTATION] - prevRotation;\r\n\t\t\tr = prevRotation + (r - (16384 - ((16384.499999999996 - r / 360) | 0)) * 360) * percent;\r\n\t\t\tswitch (blend) {\r\n\t\t\tcase MixBlend.setup:\r\n\t\t\t\tbone.rotation = bone.data.rotation + (r - (16384 - ((16384.499999999996 - r / 360) | 0)) * 360) * alpha;\r\n\t\t\t\tbreak;\r\n\t\t\tcase MixBlend.first:\r\n\t\t\tcase MixBlend.replace:\r\n\t\t\t\tr += bone.data.rotation - bone.rotation;\r\n\t\t\tcase MixBlend.add:\r\n\t\t\t\tbone.rotation += (r - (16384 - ((16384.499999999996 - r / 360) | 0)) * 360) * alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a bone's local {@link Bone#x} and {@link Bone#y}. */\r\n\texport class TranslateTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 3;\r\n\t\tstatic PREV_TIME = -3; static PREV_X = -2; static PREV_Y = -1;\r\n\t\tstatic X = 1; static Y = 2;\r\n\r\n\t\t/** The index of the bone in {@link Skeleton#bones} that will be changed. */\r\n\t\tboneIndex: number;\r\n\r\n\t\t/** The time in seconds, x, and y values for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, x, y, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * TranslateTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.translate << 24) + this.boneIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds, x, and y values for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, x: number, y: number) {\r\n\t\t\tframeIndex *= TranslateTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + TranslateTimeline.X] = x;\r\n\t\t\tthis.frames[frameIndex + TranslateTimeline.Y] = y;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\r\n\t\t\tlet bone = skeleton.bones[this.boneIndex];\r\n\t\t\tif (!bone.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tbone.x = bone.data.x;\r\n\t\t\t\t\tbone.y = bone.data.y;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tbone.x += (bone.data.x - bone.x) * alpha;\r\n\t\t\t\t\tbone.y += (bone.data.y - bone.y) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet x = 0, y = 0;\r\n\t\t\tif (time >= frames[frames.length - TranslateTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tx = frames[frames.length + TranslateTimeline.PREV_X];\r\n\t\t\t\ty = frames[frames.length + TranslateTimeline.PREV_Y];\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, TranslateTimeline.ENTRIES);\r\n\t\t\t\tx = frames[frame + TranslateTimeline.PREV_X];\r\n\t\t\t\ty = frames[frame + TranslateTimeline.PREV_Y];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / TranslateTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + TranslateTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tx += (frames[frame + TranslateTimeline.X] - x) * percent;\r\n\t\t\t\ty += (frames[frame + TranslateTimeline.Y] - y) * percent;\r\n\t\t\t}\r\n\t\t\tswitch (blend) {\r\n\t\t\tcase MixBlend.setup:\r\n\t\t\t\tbone.x = bone.data.x + x * alpha;\r\n\t\t\t\tbone.y = bone.data.y + y * alpha;\r\n\t\t\t\tbreak;\r\n\t\t\tcase MixBlend.first:\r\n\t\t\tcase MixBlend.replace:\r\n\t\t\t\tbone.x += (bone.data.x + x - bone.x) * alpha;\r\n\t\t\t\tbone.y += (bone.data.y + y - bone.y) * alpha;\r\n\t\t\t\tbreak;\r\n\t\t\tcase MixBlend.add:\r\n\t\t\t\tbone.x += x * alpha;\r\n\t\t\t\tbone.y += y * alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a bone's local {@link Bone#scaleX)} and {@link Bone#scaleY}. */\r\n\texport class ScaleTimeline extends TranslateTimeline {\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.scale << 24) + this.boneIndex;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\r\n\t\t\tlet bone = skeleton.bones[this.boneIndex];\r\n\t\t\tif (!bone.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tbone.scaleX = bone.data.scaleX;\r\n\t\t\t\t\tbone.scaleY = bone.data.scaleY;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tbone.scaleX += (bone.data.scaleX - bone.scaleX) * alpha;\r\n\t\t\t\t\tbone.scaleY += (bone.data.scaleY - bone.scaleY) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet x = 0, y = 0;\r\n\t\t\tif (time >= frames[frames.length - ScaleTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tx = frames[frames.length + ScaleTimeline.PREV_X] * bone.data.scaleX;\r\n\t\t\t\ty = frames[frames.length + ScaleTimeline.PREV_Y] * bone.data.scaleY;\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, ScaleTimeline.ENTRIES);\r\n\t\t\t\tx = frames[frame + ScaleTimeline.PREV_X];\r\n\t\t\t\ty = frames[frame + ScaleTimeline.PREV_Y];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / ScaleTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + ScaleTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tx = (x + (frames[frame + ScaleTimeline.X] - x) * percent) * bone.data.scaleX;\r\n\t\t\t\ty = (y + (frames[frame + ScaleTimeline.Y] - y) * percent) * bone.data.scaleY;\r\n\t\t\t}\r\n\t\t\tif (alpha == 1) {\r\n\t\t\t\tif (blend == MixBlend.add) {\r\n\t\t\t\t\tbone.scaleX += x - bone.data.scaleX;\r\n\t\t\t\t\tbone.scaleY += y - bone.data.scaleY;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbone.scaleX = x;\r\n\t\t\t\t\tbone.scaleY = y;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet bx = 0, by = 0;\r\n\t\t\t\tif (direction == MixDirection.mixOut) {\r\n\t\t\t\t\tswitch (blend) {\r\n\t\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\t\tbx = bone.data.scaleX;\r\n\t\t\t\t\t\tby = bone.data.scaleY;\r\n\t\t\t\t\t\tbone.scaleX = bx + (Math.abs(x) * MathUtils.signum(bx) - bx) * alpha;\r\n\t\t\t\t\t\tbone.scaleY = by + (Math.abs(y) * MathUtils.signum(by) - by) * alpha;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tcase MixBlend.replace:\r\n\t\t\t\t\t\tbx = bone.scaleX;\r\n\t\t\t\t\t\tby = bone.scaleY;\r\n\t\t\t\t\t\tbone.scaleX = bx + (Math.abs(x) * MathUtils.signum(bx) - bx) * alpha;\r\n\t\t\t\t\t\tbone.scaleY = by + (Math.abs(y) * MathUtils.signum(by) - by) * alpha;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase MixBlend.add:\r\n\t\t\t\t\t\tbx = bone.scaleX;\r\n\t\t\t\t\t\tby = bone.scaleY;\r\n\t\t\t\t\t\tbone.scaleX = bx + (Math.abs(x) * MathUtils.signum(bx) - bone.data.scaleX) * alpha;\r\n\t\t\t\t\t\tbone.scaleY = by + (Math.abs(y) * MathUtils.signum(by) - bone.data.scaleY) * alpha;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tswitch (blend) {\r\n\t\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\t\tbx = Math.abs(bone.data.scaleX) * MathUtils.signum(x);\r\n\t\t\t\t\t\tby = Math.abs(bone.data.scaleY) * MathUtils.signum(y);\r\n\t\t\t\t\t\tbone.scaleX = bx + (x - bx) * alpha;\r\n\t\t\t\t\t\tbone.scaleY = by + (y - by) * alpha;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tcase MixBlend.replace:\r\n\t\t\t\t\t\tbx = Math.abs(bone.scaleX) * MathUtils.signum(x);\r\n\t\t\t\t\t\tby = Math.abs(bone.scaleY) * MathUtils.signum(y);\r\n\t\t\t\t\t\tbone.scaleX = bx + (x - bx) * alpha;\r\n\t\t\t\t\t\tbone.scaleY = by + (y - by) * alpha;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase MixBlend.add:\r\n\t\t\t\t\t\tbx = MathUtils.signum(x);\r\n\t\t\t\t\t\tby = MathUtils.signum(y);\r\n\t\t\t\t\t\tbone.scaleX = Math.abs(bone.scaleX) * bx + (x - Math.abs(bone.data.scaleX) * bx) * alpha;\r\n\t\t\t\t\t\tbone.scaleY = Math.abs(bone.scaleY) * by + (y - Math.abs(bone.data.scaleY) * by) * alpha;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a bone's local {@link Bone#shearX} and {@link Bone#shearY}. */\r\n\texport class ShearTimeline extends TranslateTimeline {\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.shear << 24) + this.boneIndex;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\r\n\t\t\tlet bone = skeleton.bones[this.boneIndex];\r\n\t\t\tif (!bone.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tbone.shearX = bone.data.shearX;\r\n\t\t\t\t\tbone.shearY = bone.data.shearY;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tbone.shearX += (bone.data.shearX - bone.shearX) * alpha;\r\n\t\t\t\t\tbone.shearY += (bone.data.shearY - bone.shearY) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet x = 0, y = 0;\r\n\t\t\tif (time >= frames[frames.length - ShearTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tx = frames[frames.length + ShearTimeline.PREV_X];\r\n\t\t\t\ty = frames[frames.length + ShearTimeline.PREV_Y];\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, ShearTimeline.ENTRIES);\r\n\t\t\t\tx = frames[frame + ShearTimeline.PREV_X];\r\n\t\t\t\ty = frames[frame + ShearTimeline.PREV_Y];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / ShearTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + ShearTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tx = x + (frames[frame + ShearTimeline.X] - x) * percent;\r\n\t\t\t\ty = y + (frames[frame + ShearTimeline.Y] - y) * percent;\r\n\t\t\t}\r\n\t\t\tswitch (blend) {\r\n\t\t\tcase MixBlend.setup:\r\n\t\t\t\tbone.shearX = bone.data.shearX + x * alpha;\r\n\t\t\t\tbone.shearY = bone.data.shearY + y * alpha;\r\n\t\t\t\tbreak;\r\n\t\t\tcase MixBlend.first:\r\n\t\t\tcase MixBlend.replace:\r\n\t\t\t\tbone.shearX += (bone.data.shearX + x - bone.shearX) * alpha;\r\n\t\t\t\tbone.shearY += (bone.data.shearY + y - bone.shearY) * alpha;\r\n\t\t\t\tbreak;\r\n\t\t\tcase MixBlend.add:\r\n\t\t\t\tbone.shearX += x * alpha;\r\n\t\t\t\tbone.shearY += y * alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a slot's {@link Slot#color}. */\r\n\texport class ColorTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 5;\r\n\t\tstatic PREV_TIME = -5; static PREV_R = -4; static PREV_G = -3; static PREV_B = -2; static PREV_A = -1;\r\n\t\tstatic R = 1; static G = 2; static B = 3; static A = 4;\r\n\r\n\t\t/** The index of the slot in {@link Skeleton#slots} that will be changed. */\r\n\t\tslotIndex: number;\r\n\r\n\t\t/** The time in seconds, red, green, blue, and alpha values for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, r, g, b, a, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * ColorTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.color << 24) + this.slotIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds, red, green, blue, and alpha for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, r: number, g: number, b: number, a: number) {\r\n\t\t\tframeIndex *= ColorTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + ColorTimeline.R] = r;\r\n\t\t\tthis.frames[frameIndex + ColorTimeline.G] = g;\r\n\t\t\tthis.frames[frameIndex + ColorTimeline.B] = b;\r\n\t\t\tthis.frames[frameIndex + ColorTimeline.A] = a;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet slot = skeleton.slots[this.slotIndex];\r\n\t\t\tif (!slot.bone.active) return;\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tslot.color.setFromColor(slot.data.color);\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tlet color = slot.color, setup = slot.data.color;\r\n\t\t\t\t\tcolor.add((setup.r - color.r) * alpha, (setup.g - color.g) * alpha, (setup.b - color.b) * alpha,\r\n\t\t\t\t\t\t(setup.a - color.a) * alpha);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet r = 0, g = 0, b = 0, a = 0;\r\n\t\t\tif (time >= frames[frames.length - ColorTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tlet i = frames.length;\r\n\t\t\t\tr = frames[i + ColorTimeline.PREV_R];\r\n\t\t\t\tg = frames[i + ColorTimeline.PREV_G];\r\n\t\t\t\tb = frames[i + ColorTimeline.PREV_B];\r\n\t\t\t\ta = frames[i + ColorTimeline.PREV_A];\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, ColorTimeline.ENTRIES);\r\n\t\t\t\tr = frames[frame + ColorTimeline.PREV_R];\r\n\t\t\t\tg = frames[frame + ColorTimeline.PREV_G];\r\n\t\t\t\tb = frames[frame + ColorTimeline.PREV_B];\r\n\t\t\t\ta = frames[frame + ColorTimeline.PREV_A];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / ColorTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + ColorTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tr += (frames[frame + ColorTimeline.R] - r) * percent;\r\n\t\t\t\tg += (frames[frame + ColorTimeline.G] - g) * percent;\r\n\t\t\t\tb += (frames[frame + ColorTimeline.B] - b) * percent;\r\n\t\t\t\ta += (frames[frame + ColorTimeline.A] - a) * percent;\r\n\t\t\t}\r\n\t\t\tif (alpha == 1)\r\n\t\t\t\tslot.color.set(r, g, b, a);\r\n\t\t\telse {\r\n\t\t\t\tlet color = slot.color;\r\n\t\t\t\tif (blend == MixBlend.setup) color.setFromColor(slot.data.color);\r\n\t\t\t\tcolor.add((r - color.r) * alpha, (g - color.g) * alpha, (b - color.b) * alpha, (a - color.a) * alpha);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a slot's {@link Slot#color} and {@link Slot#darkColor} for two color tinting. */\r\n\texport class TwoColorTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 8;\r\n\t\tstatic PREV_TIME = -8; static PREV_R = -7; static PREV_G = -6; static PREV_B = -5; static PREV_A = -4;\r\n\t\tstatic PREV_R2 = -3; static PREV_G2 = -2; static PREV_B2 = -1;\r\n\t\tstatic R = 1; static G = 2; static B = 3; static A = 4; static R2 = 5; static G2 = 6; static B2 = 7;\r\n\r\n\t\t/** The index of the slot in {@link Skeleton#slots()} that will be changed. The {@link Slot#darkColor()} must not be\r\n\t\t * null. */\r\n\t\tslotIndex: number;\r\n\r\n\t\t/** The time in seconds, red, green, blue, and alpha values of the color, red, green, blue of the dark color, for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, r, g, b, a, r2, g2, b2, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * TwoColorTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.twoColor << 24) + this.slotIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds, light, and dark colors for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, r: number, g: number, b: number, a: number, r2: number, g2: number, b2: number) {\r\n\t\t\tframeIndex *= TwoColorTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.R] = r;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.G] = g;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.B] = b;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.A] = a;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.R2] = r2;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.G2] = g2;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.B2] = b2;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet slot = skeleton.slots[this.slotIndex];\r\n\t\t\tif (!slot.bone.active) return;\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tslot.color.setFromColor(slot.data.color);\r\n\t\t\t\t\tslot.darkColor.setFromColor(slot.data.darkColor);\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tlet light = slot.color, dark = slot.darkColor, setupLight = slot.data.color, setupDark = slot.data.darkColor;\r\n\t\t\t\t\tlight.add((setupLight.r - light.r) * alpha, (setupLight.g - light.g) * alpha, (setupLight.b - light.b) * alpha,\r\n\t\t\t\t\t\t(setupLight.a - light.a) * alpha);\r\n\t\t\t\t\tdark.add((setupDark.r - dark.r) * alpha, (setupDark.g - dark.g) * alpha, (setupDark.b - dark.b) * alpha, 0);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet r = 0, g = 0, b = 0, a = 0, r2 = 0, g2 = 0, b2 = 0;\r\n\t\t\tif (time >= frames[frames.length - TwoColorTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tlet i = frames.length;\r\n\t\t\t\tr = frames[i + TwoColorTimeline.PREV_R];\r\n\t\t\t\tg = frames[i + TwoColorTimeline.PREV_G];\r\n\t\t\t\tb = frames[i + TwoColorTimeline.PREV_B];\r\n\t\t\t\ta = frames[i + TwoColorTimeline.PREV_A];\r\n\t\t\t\tr2 = frames[i + TwoColorTimeline.PREV_R2];\r\n\t\t\t\tg2 = frames[i + TwoColorTimeline.PREV_G2];\r\n\t\t\t\tb2 = frames[i + TwoColorTimeline.PREV_B2];\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, TwoColorTimeline.ENTRIES);\r\n\t\t\t\tr = frames[frame + TwoColorTimeline.PREV_R];\r\n\t\t\t\tg = frames[frame + TwoColorTimeline.PREV_G];\r\n\t\t\t\tb = frames[frame + TwoColorTimeline.PREV_B];\r\n\t\t\t\ta = frames[frame + TwoColorTimeline.PREV_A];\r\n\t\t\t\tr2 = frames[frame + TwoColorTimeline.PREV_R2];\r\n\t\t\t\tg2 = frames[frame + TwoColorTimeline.PREV_G2];\r\n\t\t\t\tb2 = frames[frame + TwoColorTimeline.PREV_B2];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / TwoColorTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + TwoColorTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tr += (frames[frame + TwoColorTimeline.R] - r) * percent;\r\n\t\t\t\tg += (frames[frame + TwoColorTimeline.G] - g) * percent;\r\n\t\t\t\tb += (frames[frame + TwoColorTimeline.B] - b) * percent;\r\n\t\t\t\ta += (frames[frame + TwoColorTimeline.A] - a) * percent;\r\n\t\t\t\tr2 += (frames[frame + TwoColorTimeline.R2] - r2) * percent;\r\n\t\t\t\tg2 += (frames[frame + TwoColorTimeline.G2] - g2) * percent;\r\n\t\t\t\tb2 += (frames[frame + TwoColorTimeline.B2] - b2) * percent;\r\n\t\t\t}\r\n\t\t\tif (alpha == 1) {\r\n\t\t\t\tslot.color.set(r, g, b, a);\r\n\t\t\t\tslot.darkColor.set(r2, g2, b2, 1);\r\n\t\t\t} else {\r\n\t\t\t\tlet light = slot.color, dark = slot.darkColor;\r\n\t\t\t\tif (blend == MixBlend.setup) {\r\n\t\t\t\t\tlight.setFromColor(slot.data.color);\r\n\t\t\t\t\tdark.setFromColor(slot.data.darkColor);\r\n\t\t\t\t}\r\n\t\t\t\tlight.add((r - light.r) * alpha, (g - light.g) * alpha, (b - light.b) * alpha, (a - light.a) * alpha);\r\n\t\t\t\tdark.add((r2 - dark.r) * alpha, (g2 - dark.g) * alpha, (b2 - dark.b) * alpha, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a slot's {@link Slot#attachment}. */\r\n\texport class AttachmentTimeline implements Timeline {\r\n\t\t/** The index of the slot in {@link Skeleton#slots} that will be changed. */\r\n\t\tslotIndex: number;\r\n\r\n\t\t/** The time in seconds for each key frame. */\r\n\t\tframes: ArrayLike<number> // time, ...\r\n\r\n\t\t/** The attachment name for each key frame. May contain null values to clear the attachment. */\r\n\t\tattachmentNames: Array<string>;\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount);\r\n\t\t\tthis.attachmentNames = new Array<string>(frameCount);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.attachment << 24) + this.slotIndex;\r\n\t\t}\r\n\r\n\t\t/** The number of key frames for this timeline. */\r\n\t\tgetFrameCount () {\r\n\t\t\treturn this.frames.length;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds and the attachment name for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, attachmentName: string) {\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.attachmentNames[frameIndex] = attachmentName;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet slot = skeleton.slots[this.slotIndex];\r\n\t\t\tif (!slot.bone.active) return;\r\n\t\t\tif (direction == MixDirection.mixOut) {\r\n\t\t\t\tif (blend == MixBlend.setup)\r\n\t\t\t\t\tthis.setAttachment(skeleton, slot, slot.data.attachmentName);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tif (blend == MixBlend.setup || blend == MixBlend.first) this.setAttachment(skeleton, slot, slot.data.attachmentName);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet frameIndex = 0;\r\n\t\t\tif (time >= frames[frames.length - 1]) // Time is after last frame.\r\n\t\t\t\tframeIndex = frames.length - 1;\r\n\t\t\telse\r\n\t\t\t\tframeIndex = Animation.binarySearch(frames, time, 1) - 1;\r\n\r\n\t\t\tlet attachmentName = this.attachmentNames[frameIndex];\r\n\t\t\tskeleton.slots[this.slotIndex]\r\n\t\t\t\t.setAttachment(attachmentName == null ? null : skeleton.getAttachment(this.slotIndex, attachmentName));\r\n\t\t}\r\n\r\n\t\tsetAttachment(skeleton: Skeleton, slot: Slot, attachmentName: string) {\r\n\t\t\tslot.attachment = attachmentName == null ? null : skeleton.getAttachment(this.slotIndex, attachmentName);\r\n\t\t}\r\n\t}\r\n\r\n\tlet zeros : ArrayLike<number> = null;\r\n\r\n\t/** Changes a slot's {@link Slot#deform} to deform a {@link VertexAttachment}. */\r\n\texport class DeformTimeline extends CurveTimeline {\r\n\t\t/** The index of the slot in {@link Skeleton#getSlots()} that will be changed. */\r\n\t\tslotIndex: number;\r\n\r\n\t\t/** The attachment that will be deformed. */\r\n\t\tattachment: VertexAttachment;\r\n\r\n\t\t/** The time in seconds for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, ...\r\n\r\n\t\t/** The vertices for each key frame. */\r\n\t\tframeVertices: Array<ArrayLike<number>>;\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount);\r\n\t\t\tthis.frameVertices = new Array<ArrayLike<number>>(frameCount);\r\n\t\t\tif (zeros == null) zeros = Utils.newFloatArray(64);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.deform << 27) + + this.attachment.id + this.slotIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds and the vertices for the specified key frame.\r\n\t\t * @param vertices Vertex positions for an unweighted VertexAttachment, or deform offsets if it has weights. */\r\n\t\tsetFrame (frameIndex: number, time: number, vertices: ArrayLike<number>) {\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frameVertices[frameIndex] = vertices;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet slot: Slot = skeleton.slots[this.slotIndex];\r\n\t\t\tif (!slot.bone.active) return;\r\n\t\t\tlet slotAttachment: Attachment = slot.getAttachment();\r\n\t\t\tif (!(slotAttachment instanceof VertexAttachment) || !((<VertexAttachment>slotAttachment).deformAttachment == this.attachment)) return;\r\n\r\n\t\t\tlet deformArray: Array<number> = slot.deform;\r\n\t\t\tif (deformArray.length == 0) blend = MixBlend.setup;\r\n\r\n\t\t\tlet frameVertices = this.frameVertices;\r\n\t\t\tlet vertexCount = frameVertices[0].length;\r\n\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tlet vertexAttachment = <VertexAttachment>slotAttachment;\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tdeformArray.length = 0;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tif (alpha == 1) {\r\n\t\t\t\t\t\tdeformArray.length = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet deform: Array<number> = Utils.setArraySize(deformArray, vertexCount);\r\n\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t// Unweighted vertex positions.\r\n\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\tfor (var i = 0; i < vertexCount; i++)\r\n\t\t\t\t\t\t\tdeform[i] += (setupVertices[i] - deform[i]) * alpha;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Weighted deform offsets.\r\n\t\t\t\t\t\talpha = 1 - alpha;\r\n\t\t\t\t\t\tfor (var i = 0; i < vertexCount; i++)\r\n\t\t\t\t\t\t\tdeform[i] *= alpha;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet deform: Array<number> = Utils.setArraySize(deformArray, vertexCount);\r\n\t\t\tif (time >= frames[frames.length - 1]) { // Time is after last frame.\r\n\t\t\t\tlet lastVertices = frameVertices[frames.length - 1];\r\n\t\t\t\tif (alpha == 1) {\r\n\t\t\t\t\tif (blend == MixBlend.add) {\r\n\t\t\t\t\t\tlet vertexAttachment = slotAttachment as VertexAttachment;\r\n\t\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t\t// Unweighted vertex positions, with alpha.\r\n\t\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\t\tdeform[i] += lastVertices[i] - setupVertices[i];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Weighted deform offsets, with alpha.\r\n\t\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++)\r\n\t\t\t\t\t\t\t\tdeform[i] += lastVertices[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tUtils.arrayCopy(lastVertices, 0, deform, 0, vertexCount);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\t\tswitch (blend) {\r\n\t\t\t\t\tcase MixBlend.setup: {\r\n\t\t\t\t\t\tlet vertexAttachment = slotAttachment as VertexAttachment;\r\n\t\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t\t// Unweighted vertex positions, with alpha.\r\n\t\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\t\tlet setup = setupVertices[i];\r\n\t\t\t\t\t\t\t\tdeform[i] = setup + (lastVertices[i] - setup) * alpha;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Weighted deform offsets, with alpha.\r\n\t\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++)\r\n\t\t\t\t\t\t\t\tdeform[i] = lastVertices[i] * alpha;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tcase MixBlend.replace:\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++)\r\n\t\t\t\t\t\t\tdeform[i] += (lastVertices[i] - deform[i]) * alpha;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase MixBlend.add:\r\n\t\t\t\t\t\tlet vertexAttachment = slotAttachment as VertexAttachment;\r\n\t\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t\t// Unweighted vertex positions, with alpha.\r\n\t\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\t\tdeform[i] += (lastVertices[i] - setupVertices[i]) * alpha;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Weighted deform offsets, with alpha.\r\n\t\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++)\r\n\t\t\t\t\t\t\t\tdeform[i] += lastVertices[i] * alpha;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\tlet frame = Animation.binarySearch(frames, time);\r\n\t\t\tlet prevVertices = frameVertices[frame - 1];\r\n\t\t\tlet nextVertices = frameVertices[frame];\r\n\t\t\tlet frameTime = frames[frame];\r\n\t\t\tlet percent = this.getCurvePercent(frame - 1, 1 - (time - frameTime) / (frames[frame - 1] - frameTime));\r\n\r\n\t\t\tif (alpha == 1) {\r\n\t\t\t\tif (blend == MixBlend.add) {\r\n\t\t\t\t\tlet vertexAttachment = slotAttachment as VertexAttachment;\r\n\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t// Unweighted vertex positions, with alpha.\r\n\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\t\tdeform[i] += prev + (nextVertices[i] - prev) * percent - setupVertices[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Weighted deform offsets, with alpha.\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\t\tdeform[i] += prev + (nextVertices[i] - prev) * percent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\tdeform[i] = prev + (nextVertices[i] - prev) * percent;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup: {\r\n\t\t\t\t\tlet vertexAttachment = slotAttachment as VertexAttachment;\r\n\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t// Unweighted vertex positions, with alpha.\r\n\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\tlet prev = prevVertices[i], setup = setupVertices[i];\r\n\t\t\t\t\t\t\tdeform[i] = setup + (prev + (nextVertices[i] - prev) * percent - setup) * alpha;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Weighted deform offsets, with alpha.\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\t\tdeform[i] = (prev + (nextVertices[i] - prev) * percent) * alpha;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\tcase MixBlend.replace:\r\n\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\tdeform[i] += (prev + (nextVertices[i] - prev) * percent - deform[i]) * alpha;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MixBlend.add:\r\n\t\t\t\t\tlet vertexAttachment = slotAttachment as VertexAttachment;\r\n\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t// Unweighted vertex positions, with alpha.\r\n\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\t\tdeform[i] += (prev + (nextVertices[i] - prev) * percent - setupVertices[i]) * alpha;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Weighted deform offsets, with alpha.\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\t\tdeform[i] += (prev + (nextVertices[i] - prev) * percent) * alpha;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Fires an {@link Event} when specific animation times are reached. */\r\n\texport class EventTimeline implements Timeline {\r\n\t\t/** The time in seconds for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, ...\r\n\r\n\t\t/** The event for each key frame. */\r\n\t\tevents: Array<Event>;\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount);\r\n\t\t\tthis.events = new Array<Event>(frameCount);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn TimelineType.event << 24;\r\n\t\t}\r\n\r\n\t\t/** The number of key frames for this timeline. */\r\n\t\tgetFrameCount () {\r\n\t\t\treturn this.frames.length;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds and the event for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, event: Event) {\r\n\t\t\tthis.frames[frameIndex] = event.time;\r\n\t\t\tthis.events[frameIndex] = event;\r\n\t\t}\r\n\r\n\t\t/** Fires events for frames > `lastTime` and <= `time`. */\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tif (firedEvents == null) return;\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tlet frameCount = this.frames.length;\r\n\r\n\t\t\tif (lastTime > time) { // Fire events after last time for looped animations.\r\n\t\t\t\tthis.apply(skeleton, lastTime, Number.MAX_VALUE, firedEvents, alpha, blend, direction);\r\n\t\t\t\tlastTime = -1;\r\n\t\t\t} else if (lastTime >= frames[frameCount - 1]) // Last time is after last frame.\r\n\t\t\t\treturn;\r\n\t\t\tif (time < frames[0]) return; // Time is before first frame.\r\n\r\n\t\t\tlet frame = 0;\r\n\t\t\tif (lastTime < frames[0])\r\n\t\t\t\tframe = 0;\r\n\t\t\telse {\r\n\t\t\t\tframe = Animation.binarySearch(frames, lastTime);\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\twhile (frame > 0) { // Fire multiple events with the same frame.\r\n\t\t\t\t\tif (frames[frame - 1] != frameTime) break;\r\n\t\t\t\t\tframe--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (; frame < frameCount && time >= frames[frame]; frame++)\r\n\t\t\t\tfiredEvents.push(this.events[frame]);\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a skeleton's {@link Skeleton#drawOrder}. */\r\n\texport class DrawOrderTimeline implements Timeline {\r\n\t\t/** The time in seconds for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, ...\r\n\r\n\t\t/** The draw order for each key frame. See {@link #setFrame(int, float, int[])}. */\r\n\t\tdrawOrders: Array<Array<number>>;\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount);\r\n\t\t\tthis.drawOrders = new Array<Array<number>>(frameCount);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn TimelineType.drawOrder << 24;\r\n\t\t}\r\n\r\n\t\t/** The number of key frames for this timeline. */\r\n\t\tgetFrameCount () {\r\n\t\t\treturn this.frames.length;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds and the draw order for the specified key frame.\r\n\t\t * @param drawOrder For each slot in {@link Skeleton#slots}, the index of the new draw order. May be null to use setup pose\r\n\t\t *           draw order. */\r\n\t\tsetFrame (frameIndex: number, time: number, drawOrder: Array<number>) {\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.drawOrders[frameIndex] = drawOrder;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet drawOrder: Array<Slot> = skeleton.drawOrder;\r\n\t\t\tlet slots: Array<Slot> = skeleton.slots;\r\n\t\t\tif (direction == MixDirection.mixOut) {\r\n\t\t\t\tif (blend == MixBlend.setup) Utils.arrayCopy(skeleton.slots, 0, skeleton.drawOrder, 0, skeleton.slots.length);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tif (blend == MixBlend.setup || blend == MixBlend.first) Utils.arrayCopy(skeleton.slots, 0, skeleton.drawOrder, 0, skeleton.slots.length);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet frame = 0;\r\n\t\t\tif (time >= frames[frames.length - 1]) // Time is after last frame.\r\n\t\t\t\tframe = frames.length - 1;\r\n\t\t\telse\r\n\t\t\t\tframe = Animation.binarySearch(frames, time) - 1;\r\n\r\n\t\t\tlet drawOrderToSetupIndex = this.drawOrders[frame];\r\n\t\t\tif (drawOrderToSetupIndex == null)\r\n\t\t\t\tUtils.arrayCopy(slots, 0, drawOrder, 0, slots.length);\r\n\t\t\telse {\r\n\t\t\t\tfor (let i = 0, n = drawOrderToSetupIndex.length; i < n; i++)\r\n\t\t\t\t\tdrawOrder[i] = slots[drawOrderToSetupIndex[i]];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes an IK constraint's {@link IkConstraint#mix}, {@link IkConstraint#softness},\r\n\t * {@link IkConstraint#bendDirection}, {@link IkConstraint#stretch}, and {@link IkConstraint#compress}. */\r\n\texport class IkConstraintTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 6;\r\n\t\tstatic PREV_TIME = -6; static PREV_MIX = -5; static PREV_SOFTNESS = -4; static PREV_BEND_DIRECTION = -3; static PREV_COMPRESS = -2; static PREV_STRETCH = -1;\r\n\t\tstatic MIX = 1; static SOFTNESS = 2; static BEND_DIRECTION = 3; static COMPRESS = 4; static STRETCH = 5;\r\n\r\n\t\t/** The index of the IK constraint slot in {@link Skeleton#ikConstraints} that will be changed. */\r\n\t\tikConstraintIndex: number;\r\n\r\n\t\t/** The time in seconds, mix, softness, bend direction, compress, and stretch for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, mix, softness, bendDirection, compress, stretch, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * IkConstraintTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.ikConstraint << 24) + this.ikConstraintIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds, mix, softness, bend direction, compress, and stretch for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, mix: number, softness: number, bendDirection: number, compress: boolean, stretch: boolean) {\r\n\t\t\tframeIndex *= IkConstraintTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + IkConstraintTimeline.MIX] = mix;\r\n\t\t\tthis.frames[frameIndex + IkConstraintTimeline.SOFTNESS] = softness;\r\n\t\t\tthis.frames[frameIndex + IkConstraintTimeline.BEND_DIRECTION] = bendDirection;\r\n\t\t\tthis.frames[frameIndex + IkConstraintTimeline.COMPRESS] = compress ? 1 : 0;\r\n\t\t\tthis.frames[frameIndex + IkConstraintTimeline.STRETCH] = stretch ? 1 : 0;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tlet constraint: IkConstraint = skeleton.ikConstraints[this.ikConstraintIndex];\r\n\t\t\tif (!constraint.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tconstraint.mix = constraint.data.mix;\r\n\t\t\t\t\tconstraint.softness = constraint.data.softness;\r\n\t\t\t\t\tconstraint.bendDirection = constraint.data.bendDirection;\r\n\t\t\t\t\tconstraint.compress = constraint.data.compress;\r\n\t\t\t\t\tconstraint.stretch = constraint.data.stretch;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tconstraint.mix += (constraint.data.mix - constraint.mix) * alpha;\r\n\t\t\t\t\tconstraint.softness += (constraint.data.softness - constraint.softness) * alpha;\r\n\t\t\t\t\tconstraint.bendDirection = constraint.data.bendDirection;\r\n\t\t\t\t\tconstraint.compress = constraint.data.compress;\r\n\t\t\t\t\tconstraint.stretch = constraint.data.stretch;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (time >= frames[frames.length - IkConstraintTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tif (blend == MixBlend.setup) {\r\n\t\t\t\t\tconstraint.mix = constraint.data.mix + (frames[frames.length + IkConstraintTimeline.PREV_MIX] - constraint.data.mix) * alpha;\r\n\t\t\t\t\tconstraint.softness = constraint.data.softness\r\n\t\t\t\t\t\t+ (frames[frames.length + IkConstraintTimeline.PREV_SOFTNESS] - constraint.data.softness) * alpha;\r\n\t\t\t\t\tif (direction == MixDirection.mixOut) {\r\n\t\t\t\t\t\tconstraint.bendDirection = constraint.data.bendDirection;\r\n\t\t\t\t\t\tconstraint.compress = constraint.data.compress;\r\n\t\t\t\t\t\tconstraint.stretch = constraint.data.stretch;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconstraint.bendDirection = frames[frames.length + IkConstraintTimeline.PREV_BEND_DIRECTION]\r\n\t\t\t\t\t\tconstraint.compress = frames[frames.length + IkConstraintTimeline.PREV_COMPRESS] != 0;\r\n\t\t\t\t\t\tconstraint.stretch = frames[frames.length + IkConstraintTimeline.PREV_STRETCH] != 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconstraint.mix += (frames[frames.length + IkConstraintTimeline.PREV_MIX] - constraint.mix) * alpha;\r\n\t\t\t\t\tconstraint.softness += (frames[frames.length + IkConstraintTimeline.PREV_SOFTNESS] - constraint.softness) * alpha;\r\n\t\t\t\t\tif (direction == MixDirection.mixIn) {\r\n\t\t\t\t\t\tconstraint.bendDirection = frames[frames.length + IkConstraintTimeline.PREV_BEND_DIRECTION];\r\n\t\t\t\t\t\tconstraint.compress = frames[frames.length + IkConstraintTimeline.PREV_COMPRESS] != 0;\r\n\t\t\t\t\t\tconstraint.stretch = frames[frames.length + IkConstraintTimeline.PREV_STRETCH] != 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\tlet frame = Animation.binarySearch(frames, time, IkConstraintTimeline.ENTRIES);\r\n\t\t\tlet mix = frames[frame + IkConstraintTimeline.PREV_MIX];\r\n\t\t\tlet softness = frames[frame + IkConstraintTimeline.PREV_SOFTNESS];\r\n\t\t\tlet frameTime = frames[frame];\r\n\t\t\tlet percent = this.getCurvePercent(frame / IkConstraintTimeline.ENTRIES - 1,\r\n\t\t\t\t1 - (time - frameTime) / (frames[frame + IkConstraintTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\tif (blend == MixBlend.setup) {\r\n\t\t\t\tconstraint.mix = constraint.data.mix + (mix + (frames[frame + IkConstraintTimeline.MIX] - mix) * percent - constraint.data.mix) * alpha;\r\n\t\t\t\tconstraint.softness = constraint.data.softness\r\n\t\t\t\t\t+ (softness + (frames[frame + IkConstraintTimeline.SOFTNESS] - softness) * percent - constraint.data.softness) * alpha;\r\n\t\t\t\tif (direction == MixDirection.mixOut) {\r\n\t\t\t\t\tconstraint.bendDirection = constraint.data.bendDirection;\r\n\t\t\t\t\tconstraint.compress = constraint.data.compress;\r\n\t\t\t\t\tconstraint.stretch = constraint.data.stretch;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconstraint.bendDirection = frames[frame + IkConstraintTimeline.PREV_BEND_DIRECTION];\r\n\t\t\t\t\tconstraint.compress = frames[frame + IkConstraintTimeline.PREV_COMPRESS] != 0;\r\n\t\t\t\t\tconstraint.stretch = frames[frame + IkConstraintTimeline.PREV_STRETCH] != 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconstraint.mix += (mix + (frames[frame + IkConstraintTimeline.MIX] - mix) * percent - constraint.mix) * alpha;\r\n\t\t\t\tconstraint.softness += (softness + (frames[frame + IkConstraintTimeline.SOFTNESS] - softness) * percent - constraint.softness) * alpha;\r\n\t\t\t\tif (direction == MixDirection.mixIn) {\r\n\t\t\t\t\tconstraint.bendDirection = frames[frame + IkConstraintTimeline.PREV_BEND_DIRECTION];\r\n\t\t\t\t\tconstraint.compress = frames[frame + IkConstraintTimeline.PREV_COMPRESS] != 0;\r\n\t\t\t\t\tconstraint.stretch = frames[frame + IkConstraintTimeline.PREV_STRETCH] != 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a transform constraint's {@link TransformConstraint#rotateMix}, {@link TransformConstraint#translateMix},\r\n\t * {@link TransformConstraint#scaleMix}, and {@link TransformConstraint#shearMix}. */\r\n\texport class TransformConstraintTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 5;\r\n\t\tstatic PREV_TIME = -5; static PREV_ROTATE = -4; static PREV_TRANSLATE = -3; static PREV_SCALE = -2; static PREV_SHEAR = -1;\r\n\t\tstatic ROTATE = 1; static TRANSLATE = 2; static SCALE = 3; static SHEAR = 4;\r\n\r\n\t\t/** The index of the transform constraint slot in {@link Skeleton#transformConstraints} that will be changed. */\r\n\t\ttransformConstraintIndex: number;\r\n\r\n\t\t/** The time in seconds, rotate mix, translate mix, scale mix, and shear mix for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, rotate mix, translate mix, scale mix, shear mix, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * TransformConstraintTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.transformConstraint << 24) + this.transformConstraintIndex;\r\n\t\t}\r\n\r\n\t\t/** The time in seconds, rotate mix, translate mix, scale mix, and shear mix for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, rotateMix: number, translateMix: number, scaleMix: number, shearMix: number) {\r\n\t\t\tframeIndex *= TransformConstraintTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + TransformConstraintTimeline.ROTATE] = rotateMix;\r\n\t\t\tthis.frames[frameIndex + TransformConstraintTimeline.TRANSLATE] = translateMix;\r\n\t\t\tthis.frames[frameIndex + TransformConstraintTimeline.SCALE] = scaleMix;\r\n\t\t\tthis.frames[frameIndex + TransformConstraintTimeline.SHEAR] = shearMix;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\r\n\t\t\tlet constraint: TransformConstraint = skeleton.transformConstraints[this.transformConstraintIndex];\r\n\t\t\tif (!constraint.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tlet data = constraint.data;\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tconstraint.rotateMix = data.rotateMix;\r\n\t\t\t\t\tconstraint.translateMix = data.translateMix;\r\n\t\t\t\t\tconstraint.scaleMix = data.scaleMix;\r\n\t\t\t\t\tconstraint.shearMix = data.shearMix;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tconstraint.rotateMix += (data.rotateMix - constraint.rotateMix) * alpha;\r\n\t\t\t\t\tconstraint.translateMix += (data.translateMix - constraint.translateMix) * alpha;\r\n\t\t\t\t\tconstraint.scaleMix += (data.scaleMix - constraint.scaleMix) * alpha;\r\n\t\t\t\t\tconstraint.shearMix += (data.shearMix - constraint.shearMix) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet rotate = 0, translate = 0, scale = 0, shear = 0;\r\n\t\t\tif (time >= frames[frames.length - TransformConstraintTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tlet i = frames.length;\r\n\t\t\t\trotate = frames[i + TransformConstraintTimeline.PREV_ROTATE];\r\n\t\t\t\ttranslate = frames[i + TransformConstraintTimeline.PREV_TRANSLATE];\r\n\t\t\t\tscale = frames[i + TransformConstraintTimeline.PREV_SCALE];\r\n\t\t\t\tshear = frames[i + TransformConstraintTimeline.PREV_SHEAR];\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, TransformConstraintTimeline.ENTRIES);\r\n\t\t\t\trotate = frames[frame + TransformConstraintTimeline.PREV_ROTATE];\r\n\t\t\t\ttranslate = frames[frame + TransformConstraintTimeline.PREV_TRANSLATE];\r\n\t\t\t\tscale = frames[frame + TransformConstraintTimeline.PREV_SCALE];\r\n\t\t\t\tshear = frames[frame + TransformConstraintTimeline.PREV_SHEAR];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / TransformConstraintTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + TransformConstraintTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\trotate += (frames[frame + TransformConstraintTimeline.ROTATE] - rotate) * percent;\r\n\t\t\t\ttranslate += (frames[frame + TransformConstraintTimeline.TRANSLATE] - translate) * percent;\r\n\t\t\t\tscale += (frames[frame + TransformConstraintTimeline.SCALE] - scale) * percent;\r\n\t\t\t\tshear += (frames[frame + TransformConstraintTimeline.SHEAR] - shear) * percent;\r\n\t\t\t}\r\n\t\t\tif (blend == MixBlend.setup) {\r\n\t\t\t\tlet data = constraint.data;\r\n\t\t\t\tconstraint.rotateMix = data.rotateMix + (rotate - data.rotateMix) * alpha;\r\n\t\t\t\tconstraint.translateMix = data.translateMix + (translate - data.translateMix) * alpha;\r\n\t\t\t\tconstraint.scaleMix = data.scaleMix + (scale - data.scaleMix) * alpha;\r\n\t\t\t\tconstraint.shearMix = data.shearMix + (shear - data.shearMix) * alpha;\r\n\t\t\t} else {\r\n\t\t\t\tconstraint.rotateMix += (rotate - constraint.rotateMix) * alpha;\r\n\t\t\t\tconstraint.translateMix += (translate - constraint.translateMix) * alpha;\r\n\t\t\t\tconstraint.scaleMix += (scale - constraint.scaleMix) * alpha;\r\n\t\t\t\tconstraint.shearMix += (shear - constraint.shearMix) * alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a path constraint's {@link PathConstraint#position}. */\r\n\texport class PathConstraintPositionTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 2;\r\n\t\tstatic PREV_TIME = -2; static PREV_VALUE = -1;\r\n\t\tstatic VALUE = 1;\r\n\r\n\t\t/** The index of the path constraint slot in {@link Skeleton#pathConstraints} that will be changed. */\r\n\t\tpathConstraintIndex: number;\r\n\r\n\t\t/** The time in seconds and path constraint position for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, position, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * PathConstraintPositionTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.pathConstraintPosition << 24) + this.pathConstraintIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds and path constraint position for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, value: number) {\r\n\t\t\tframeIndex *= PathConstraintPositionTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + PathConstraintPositionTimeline.VALUE] = value;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tlet constraint: PathConstraint = skeleton.pathConstraints[this.pathConstraintIndex];\r\n\t\t\tif (!constraint.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tconstraint.position = constraint.data.position;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tconstraint.position += (constraint.data.position - constraint.position) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet position = 0;\r\n\t\t\tif (time >= frames[frames.length - PathConstraintPositionTimeline.ENTRIES]) // Time is after last frame.\r\n\t\t\t\tposition = frames[frames.length + PathConstraintPositionTimeline.PREV_VALUE];\r\n\t\t\telse {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, PathConstraintPositionTimeline.ENTRIES);\r\n\t\t\t\tposition = frames[frame + PathConstraintPositionTimeline.PREV_VALUE];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / PathConstraintPositionTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + PathConstraintPositionTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tposition += (frames[frame + PathConstraintPositionTimeline.VALUE] - position) * percent;\r\n\t\t\t}\r\n\t\t\tif (blend == MixBlend.setup)\r\n\t\t\t\tconstraint.position = constraint.data.position + (position - constraint.data.position) * alpha;\r\n\t\t\telse\r\n\t\t\t\tconstraint.position += (position - constraint.position) * alpha;\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a path constraint's {@link PathConstraint#spacing}. */\r\n\texport class PathConstraintSpacingTimeline extends PathConstraintPositionTimeline {\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.pathConstraintSpacing << 24) + this.pathConstraintIndex;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tlet constraint: PathConstraint = skeleton.pathConstraints[this.pathConstraintIndex];\r\n\t\t\tif (!constraint.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tconstraint.spacing = constraint.data.spacing;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tconstraint.spacing += (constraint.data.spacing - constraint.spacing) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet spacing = 0;\r\n\t\t\tif (time >= frames[frames.length - PathConstraintSpacingTimeline.ENTRIES]) // Time is after last frame.\r\n\t\t\t\tspacing = frames[frames.length + PathConstraintSpacingTimeline.PREV_VALUE];\r\n\t\t\telse {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, PathConstraintSpacingTimeline.ENTRIES);\r\n\t\t\t\tspacing = frames[frame + PathConstraintSpacingTimeline.PREV_VALUE];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / PathConstraintSpacingTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + PathConstraintSpacingTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tspacing += (frames[frame + PathConstraintSpacingTimeline.VALUE] - spacing) * percent;\r\n\t\t\t}\r\n\r\n\t\t\tif (blend == MixBlend.setup)\r\n\t\t\t\tconstraint.spacing = constraint.data.spacing + (spacing - constraint.data.spacing) * alpha;\r\n\t\t\telse\r\n\t\t\t\tconstraint.spacing += (spacing - constraint.spacing) * alpha;\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a transform constraint's {@link PathConstraint#rotateMix} and\r\n\t * {@link TransformConstraint#translateMix}. */\r\n\texport class PathConstraintMixTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 3;\r\n\t\tstatic PREV_TIME = -3; static PREV_ROTATE = -2; static PREV_TRANSLATE = -1;\r\n\t\tstatic ROTATE = 1; static TRANSLATE = 2;\r\n\r\n\t\t/** The index of the path constraint slot in {@link Skeleton#getPathConstraints()} that will be changed. */\r\n\t\tpathConstraintIndex: number;\r\n\r\n\t\t/** The time in seconds, rotate mix, and translate mix for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, rotate mix, translate mix, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * PathConstraintMixTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.pathConstraintMix << 24) + this.pathConstraintIndex;\r\n\t\t}\r\n\r\n\t\t/** The time in seconds, rotate mix, and translate mix for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, rotateMix: number, translateMix: number) {\r\n\t\t\tframeIndex *= PathConstraintMixTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + PathConstraintMixTimeline.ROTATE] = rotateMix;\r\n\t\t\tthis.frames[frameIndex + PathConstraintMixTimeline.TRANSLATE] = translateMix;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tlet constraint: PathConstraint = skeleton.pathConstraints[this.pathConstraintIndex];\r\n\t\t\tif (!constraint.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tconstraint.rotateMix = constraint.data.rotateMix;\r\n\t\t\t\t\tconstraint.translateMix = constraint.data.translateMix;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tconstraint.rotateMix += (constraint.data.rotateMix - constraint.rotateMix) * alpha;\r\n\t\t\t\t\tconstraint.translateMix += (constraint.data.translateMix - constraint.translateMix) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet rotate = 0, translate = 0;\r\n\t\t\tif (time >= frames[frames.length - PathConstraintMixTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\trotate = frames[frames.length + PathConstraintMixTimeline.PREV_ROTATE];\r\n\t\t\t\ttranslate = frames[frames.length + PathConstraintMixTimeline.PREV_TRANSLATE];\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, PathConstraintMixTimeline.ENTRIES);\r\n\t\t\t\trotate = frames[frame + PathConstraintMixTimeline.PREV_ROTATE];\r\n\t\t\t\ttranslate = frames[frame + PathConstraintMixTimeline.PREV_TRANSLATE];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / PathConstraintMixTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + PathConstraintMixTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\trotate += (frames[frame + PathConstraintMixTimeline.ROTATE] - rotate) * percent;\r\n\t\t\t\ttranslate += (frames[frame + PathConstraintMixTimeline.TRANSLATE] - translate) * percent;\r\n\t\t\t}\r\n\r\n\t\t\tif (blend == MixBlend.setup) {\r\n\t\t\t\tconstraint.rotateMix = constraint.data.rotateMix + (rotate - constraint.data.rotateMix) * alpha;\r\n\t\t\t\tconstraint.translateMix = constraint.data.translateMix + (translate - constraint.data.translateMix) * alpha;\r\n\t\t\t} else {\r\n\t\t\t\tconstraint.rotateMix += (rotate - constraint.rotateMix) * alpha;\r\n\t\t\t\tconstraint.translateMix += (translate - constraint.translateMix) * alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Texture, TextureWrap, TextureFilter, TextureRegion } from \"./Texture\";\r\nimport { Disposable} from \"./Utils\";\r\n\r\n// module spine {\r\n\texport class TextureAtlas implements Disposable {\r\n\t\tpages = new Array<TextureAtlasPage>();\r\n\t\tregions = new Array<TextureAtlasRegion>();\r\n\r\n\t\tconstructor (atlasText: string, textureLoader: (path: string) => any) {\r\n\t\t\tthis.load(atlasText, textureLoader);\r\n\t\t}\r\n\r\n\t\tprivate load (atlasText: string, textureLoader: (path: string) => any) {\r\n\t\t\tif (textureLoader == null)\r\n\t\t\t\tthrow new Error(\"textureLoader cannot be null.\");\r\n\r\n\t\t\tlet reader = new TextureAtlasReader(atlasText);\r\n\t\t\tlet tuple = new Array<string>(4);\r\n\t\t\tlet page:TextureAtlasPage = null;\r\n\t\t\twhile (true) {\r\n\t\t\t\tlet line = reader.readLine();\r\n\t\t\t\tif (line == null)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tline = line.trim();\r\n\t\t\t\tif (line.length == 0)\r\n\t\t\t\t\tpage = null;\r\n\t\t\t\telse if (!page) {\r\n\t\t\t\t\tpage = new TextureAtlasPage();\r\n\t\t\t\t\tpage.name = line;\r\n\r\n\t\t\t\t\tif (reader.readTuple(tuple) == 2) { // size is only optional for an atlas packed with an old TexturePacker.\r\n\t\t\t\t\t\tpage.width = parseInt(tuple[0]);\r\n\t\t\t\t\t\tpage.height = parseInt(tuple[1]);\r\n\t\t\t\t\t\treader.readTuple(tuple);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// page.format = Format[tuple[0]]; we don't need format in WebGL\r\n\r\n\t\t\t\t\treader.readTuple(tuple);\r\n\t\t\t\t\tpage.minFilter = Texture.filterFromString(tuple[0]);\r\n\t\t\t\t\tpage.magFilter = Texture.filterFromString(tuple[1]);\r\n\r\n\t\t\t\t\tlet direction= reader.readValue();\r\n\t\t\t\t\tpage.uWrap = TextureWrap.ClampToEdge;\r\n\t\t\t\t\tpage.vWrap = TextureWrap.ClampToEdge;\r\n\t\t\t\t\tif (direction == \"x\")\r\n\t\t\t\t\t\tpage.uWrap = TextureWrap.Repeat;\r\n\t\t\t\t\telse if (direction == \"y\")\r\n\t\t\t\t\t\tpage.vWrap = TextureWrap.Repeat;\r\n\t\t\t\t\telse if (direction == \"xy\")\r\n\t\t\t\t\t\tpage.uWrap = page.vWrap = TextureWrap.Repeat;\r\n\r\n\t\t\t\t\tpage.texture = textureLoader(line);\r\n\t\t\t\t\tpage.texture.setFilters(page.minFilter, page.magFilter);\r\n\t\t\t\t\tpage.texture.setWraps(page.uWrap, page.vWrap);\r\n\t\t\t\t\tpage.width = page.texture.getImage().width;\r\n\t\t\t\t\tpage.height = page.texture.getImage().height;\r\n\t\t\t\t\tthis.pages.push(page);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet region:TextureAtlasRegion = new TextureAtlasRegion();\r\n\t\t\t\t\tregion.name = line;\r\n\t\t\t\t\tregion.page = page;\r\n\r\n\t\t\t\t\tlet rotateValue = reader.readValue();\r\n\t\t\t\t\tif (rotateValue.toLocaleLowerCase() == \"true\") {\r\n\t\t\t\t\t\tregion.degrees = 90;\r\n\t\t\t\t\t} else if (rotateValue.toLocaleLowerCase() == \"false\") {\r\n\t\t\t\t\t\tregion.degrees = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tregion.degrees = parseFloat(rotateValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tregion.rotate = region.degrees == 90;\r\n\r\n\t\t\t\t\treader.readTuple(tuple);\r\n\t\t\t\t\tlet x = parseInt(tuple[0]);\r\n\t\t\t\t\tlet y = parseInt(tuple[1]);\r\n\r\n\t\t\t\t\treader.readTuple(tuple);\r\n\t\t\t\t\tlet width = parseInt(tuple[0]);\r\n\t\t\t\t\tlet height = parseInt(tuple[1]);\r\n\r\n\t\t\t\t\tregion.u = x / page.width;\r\n\t\t\t\t\tregion.v = y / page.height;\r\n\t\t\t\t\tif (region.rotate) {\r\n\t\t\t\t\t\tregion.u2 = (x + height) / page.width;\r\n\t\t\t\t\t\tregion.v2 = (y + width) / page.height;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tregion.u2 = (x + width) / page.width;\r\n\t\t\t\t\t\tregion.v2 = (y + height) / page.height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tregion.x = x;\r\n\t\t\t\t\tregion.y = y;\r\n\t\t\t\t\tregion.width = Math.abs(width);\r\n\t\t\t\t\tregion.height = Math.abs(height);\r\n\r\n\t\t\t\t\tif (reader.readTuple(tuple) == 4) { // split is optional\r\n\t\t\t\t\t\t// region.splits = new Vector.<int>(parseInt(tuple[0]), parseInt(tuple[1]), parseInt(tuple[2]), parseInt(tuple[3]));\r\n\t\t\t\t\t\tif (reader.readTuple(tuple) == 4) { // pad is optional, but only present with splits\r\n\t\t\t\t\t\t\t//region.pads = Vector.<int>(parseInt(tuple[0]), parseInt(tuple[1]), parseInt(tuple[2]), parseInt(tuple[3]));\r\n\t\t\t\t\t\t\treader.readTuple(tuple);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tregion.originalWidth = parseInt(tuple[0]);\r\n\t\t\t\t\tregion.originalHeight = parseInt(tuple[1]);\r\n\r\n\t\t\t\t\treader.readTuple(tuple);\r\n\t\t\t\t\tregion.offsetX = parseInt(tuple[0]);\r\n\t\t\t\t\tregion.offsetY = parseInt(tuple[1]);\r\n\r\n\t\t\t\t\tregion.index = parseInt(reader.readValue());\r\n\r\n\t\t\t\t\tregion.texture = page.texture;\r\n\t\t\t\t\tthis.regions.push(region);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfindRegion (name: string): TextureAtlasRegion {\r\n\t\t\tfor (let i = 0; i < this.regions.length; i++) {\r\n\t\t\t\tif (this.regions[i].name == name) {\r\n\t\t\t\t\treturn this.regions[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t\tfor (let i = 0; i < this.pages.length; i++) {\r\n\t\t\t\tthis.pages[i].texture.dispose();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tclass TextureAtlasReader {\r\n\t\tlines: Array<string>;\r\n\t\tindex: number = 0;\r\n\r\n\t\tconstructor (text: string) {\r\n\t\t\tthis.lines = text.split(/\\r\\n|\\r|\\n/);\r\n\t\t}\r\n\r\n\t\treadLine (): string {\r\n\t\t\tif (this.index >= this.lines.length)\r\n\t\t\t\treturn null;\r\n\t\t\treturn this.lines[this.index++];\r\n\t\t}\r\n\r\n\t\treadValue (): string {\r\n\t\t\tlet line = this.readLine();\r\n\t\t\tlet colon= line.indexOf(\":\");\r\n\t\t\tif (colon == -1)\r\n\t\t\t\tthrow new Error(\"Invalid line: \" + line);\r\n\t\t\treturn line.substring(colon + 1).trim();\r\n\t\t}\r\n\r\n\t\treadTuple (tuple: Array<string>): number {\r\n\t\t\tlet line = this.readLine();\r\n\t\t\tlet colon = line.indexOf(\":\");\r\n\t\t\tif (colon == -1)\r\n\t\t\t\tthrow new Error(\"Invalid line: \" + line);\r\n\t\t\tlet i = 0, lastMatch = colon + 1;\r\n\t\t\tfor (; i < 3; i++) {\r\n\t\t\t\tlet comma = line.indexOf(\",\", lastMatch);\r\n\t\t\t\tif (comma == -1) break;\r\n\t\t\t\ttuple[i] = line.substr(lastMatch, comma - lastMatch).trim();\r\n\t\t\t\tlastMatch = comma + 1;\r\n\t\t\t}\r\n\t\t\ttuple[i] = line.substring(lastMatch).trim();\r\n\t\t\treturn i + 1;\r\n\t\t}\r\n\t}\r\n\r\n\texport class TextureAtlasPage {\r\n\t\tname: string;\r\n\t\tminFilter: TextureFilter;\r\n\t\tmagFilter: TextureFilter;\r\n\t\tuWrap: TextureWrap;\r\n\t\tvWrap: TextureWrap;\r\n\t\ttexture: Texture;\r\n\t\twidth: number;\r\n\t\theight: number;\r\n\t}\r\n\r\n\texport class TextureAtlasRegion extends TextureRegion {\r\n\t\tpage: TextureAtlasPage;\r\n\t\tname: string;\r\n\t\tx: number;\r\n\t\ty: number;\r\n\t\tindex: number;\r\n\t\t// rotate: boolean;\r\n\t\tdegrees: number;\r\n\t\ttexture: Texture;\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { FakeTexture } from \"./Texture\";\r\nimport { TextureAtlas } from \"./TextureAtlas\";\r\nimport {Map, Disposable} from \"./Utils\";\r\n\r\n// module spine {\r\n\texport class AssetManager implements Disposable {\r\n\t\tprivate pathPrefix: string;\r\n\t\tprivate textureLoader: (image: HTMLImageElement) => any;\r\n\t\tprivate assets: Map<any> = {};\r\n\t\tprivate errors: Map<string> = {};\r\n\t\tprivate toLoad = 0;\r\n\t\tprivate loaded = 0;\r\n\t\tprivate rawDataUris: Map<string> = {};\r\n\r\n\t\tconstructor (textureLoader: (image: HTMLImageElement) => any, pathPrefix: string = \"\") {\r\n\t\t\tthis.textureLoader = textureLoader;\r\n\t\t\tthis.pathPrefix = pathPrefix;\r\n\t\t}\r\n\t\t\r\n\t\tprivate encodePath(path: string) {\r\n\t\t\tlet parts = path.split(\"/\");\r\n\t\t\tfor (let i = 0; i < parts.length; i++) {\r\n\t\t\t\tparts[i] = encodeURIComponent(parts[i]);\r\n\t\t\t}\r\n\t\t\tpath = parts.join(\"/\");\r\n\t\t\treturn path\r\n\t\t}\r\n\r\n\t\tprivate downloadText (url: string, success: (data: string) => void, error: (status: number, responseText: string) => void) {\r\n\t\t\tif (this.rawDataUris[url]) {\r\n\t\t\t\tlet data = this.rawDataUris[url];\r\n\t\t\t\tlet textData = atob(data);\r\n\t\t\t\tsuccess(textData);\r\n\t\t\t\treturn;\r\n\t\t\t} \r\n\r\n\t\t\tlet request = new XMLHttpRequest();\r\n\t\t\trequest.overrideMimeType(\"text/html\");\r\n\t\t\t// if (this.rawDataUris[url]) {\r\n\t\t\t// \turl = this.rawDataUris[url];\r\n\t\t\t// } \r\n\t\t\t// request.open(\"GET\", url, true);\r\n\t\t\trequest.open(\"GET\", this.encodePath(url), true);\r\n\t\t\trequest.onload = () => {\r\n\t\t\t\tif (request.status == 200) {\r\n\t\t\t\t\t// success(request.responseText);\r\n\r\n\t\t\t\t\t// HACK: Add logic to handle empty resopnse\r\n\t\t\t\t\tif (request.responseText.length == 0) {\r\n\t\t\t\t\t\terror(request.status, request.responseText);\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsuccess(request.responseText);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\terror(request.status, request.responseText);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\trequest.onerror = () => {\r\n\t\t\t\terror(request.status, request.responseText);\r\n\t\t\t}\r\n\t\t\trequest.send();\r\n\t\t}\r\n\r\n\t\tprivate base64ToArrayBuffer(base64: string): Uint8Array {\r\n\t\t\tvar binaryString = atob(base64);\r\n\t\t\tvar bytes = new Uint8Array(binaryString.length);\r\n\t\t\tfor (var i = 0; i < binaryString.length; i++) {\r\n\t\t\t\tbytes[i] = binaryString.charCodeAt(i);\r\n\t\t\t}\r\n\t\t\treturn bytes;\r\n\t\t}\r\n\r\n\t\tprivate downloadBinary (url: string, success: (data: Uint8Array) => void, error: (status: number, responseText: string) => void) {\r\n\t\t\tif (this.rawDataUris[url]) {\r\n\t\t\t\tlet data64 = this.rawDataUris[url];\r\n\t\t\t\tlet binaryData = this.base64ToArrayBuffer(data64);\r\n\t\t\t\tconsole.log(url, data64);\r\n\t\t\t\tsuccess(binaryData);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet request = new XMLHttpRequest();\r\n\t\t\t// request.open(\"GET\", url, true);\r\n\t\t\trequest.open(\"GET\", this.encodePath(url), true);\r\n\t\t\trequest.responseType = \"arraybuffer\";\r\n\t\t\trequest.onload = () => {\r\n\t\t\t\tif (request.status == 200) {\r\n\t\t\t\t\t// success(new Uint8Array(request.response as ArrayBuffer));\r\n\t\t\t\t\t// HACK: Add logic to handle empty response\r\n\t\t\t\t\tif (request.response == null) {\r\n\t\t\t\t\t\terror(request.status, request.responseText);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsuccess(new Uint8Array(request.response as ArrayBuffer));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// error(request.status, request.responseText);\r\n\t\t\t\t\terror(request.status, request.response);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\trequest.onerror = () => {\r\n\t\t\t\terror(request.status, request.response);\r\n\t\t\t\t// error(request.status, request.responseText);\r\n\t\t\t}\r\n\t\t\trequest.send();\r\n\t\t}\r\n\r\n\t\tsetRawDataURI(path: string, data: string) {\r\n\t\t\tthis.rawDataUris[this.pathPrefix + path] = data;\r\n\t\t}\r\n\r\n\t\tloadBinary(path: string,\r\n\t\t\tsuccess: (path: string, binary: Uint8Array) => void = null,\r\n\t\t\terror: (path: string, error: string) => void = null) {\r\n\t\t\tpath = this.pathPrefix + path;\r\n\t\t\tthis.toLoad++;\r\n\r\n\t\t\tthis.downloadBinary(path, (data: Uint8Array): void => {\r\n\t\t\t\tthis.assets[path] = data;\r\n\t\t\t\tif (success) success(path, data);\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t}, (state: number, responseText: string): void => {\r\n\t\t\t\tthis.errors[path] = `Couldn't load binary ${path}: status ${status}, ${responseText}`;\r\n\t\t\t\tif (error) error(path, `Couldn't load binary ${path}: status ${status}, ${responseText}`);\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tloadText(path: string,\r\n\t\t\tsuccess: (path: string, text: string) => void = null,\r\n\t\t\terror: (path: string, error: string) => void = null) {\r\n\t\t\tpath = this.pathPrefix + path;\r\n\t\t\tthis.toLoad++;\r\n\r\n\t\t\tthis.downloadText(path, (data: string): void => {\r\n\t\t\t\tthis.assets[path] = data;\r\n\t\t\t\tif (success) success(path, data);\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t}, (state: number, responseText: string): void => {\r\n\t\t\t\tthis.errors[path] = `Couldn't load text ${path}: status ${status}, ${responseText}`;\r\n\t\t\t\tif (error) error(path, `Couldn't load text ${path}: status ${status}, ${responseText}`);\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tloadTexture (path: string,\r\n\t\t\tsuccess: (path: string, image: HTMLImageElement) => void = null,\r\n\t\t\terror: (path: string, error: string) => void = null) {\r\n\t\t\tpath = this.pathPrefix + path;\r\n\t\t\tlet storagePath = path;\r\n\t\t\tthis.toLoad++;\r\n\t\t\tlet img = new Image();\r\n\t\t\timg.crossOrigin = \"anonymous\";\r\n\t\t\timg.onload = (ev) => {\r\n\t\t\t\tlet texture = this.textureLoader(img);\r\n\t\t\t\tthis.assets[storagePath] = texture;\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t\tif (success) success(path, img);\r\n\t\t\t}\r\n\t\t\timg.onerror = (ev) => {\r\n\t\t\t\tthis.errors[path] = `Couldn't load image ${path}`;\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t\tif (error) error(path, `Couldn't load image ${path}`);\r\n\t\t\t}\r\n\t\t\r\n\t\t\tif (this.rawDataUris[path]) {\r\n\t\t\t\tlet data = this.rawDataUris[path];\r\n\t\t\t\timg.src = \"data:image/png;base64,\" + data;\r\n\t\t\t} else {\r\n\t\t\t\timg.src = this.encodePath(path);\t\r\n\t\t\t}\r\n\t\t\t// if (this.rawDataUris[path]) {\r\n\t\t\t// \tpath = this.rawDataUris[path];\r\n\t\t\t// }\r\n\t\t\t// img.src = path;\r\n\t\t}\r\n\r\n\t\tloadTextureAtlas (path: string,\r\n\t\t\tsuccess: (path: string, atlas: TextureAtlas) => void = null,\r\n\t\t\terror: (path: string, error: string) => void = null\r\n\t\t) {\r\n\t\t\tlet parent = path.lastIndexOf(\"/\") >= 0 ? path.substring(0, path.lastIndexOf(\"/\")) : \"\";\r\n\t\t\tpath = this.pathPrefix + path;\r\n\t\t\tthis.toLoad++;\r\n\r\n\t\t\tthis.downloadText(path, (atlasData: string): void => {\r\n\t\t\t\tlet pagesLoaded: any = { count: 0 };\r\n\t\t\t\tlet atlasPages = new Array<string>();\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet atlas = new TextureAtlas(atlasData, (path: string) => {\r\n\t\t\t\t\t\tatlasPages.push(parent == \"\" ? path : parent + \"/\" + path);\r\n\t\t\t\t\t\tlet image = document.createElement(\"img\") as HTMLImageElement;\r\n\t\t\t\t\t\timage.width = 16;\r\n\t\t\t\t\t\timage.height = 16;\r\n\t\t\t\t\t\treturn new FakeTexture(image);\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tlet ex = e as Error;\r\n\t\t\t\t\tthis.errors[path] = `Couldn't load texture atlas ${path}: ${ex.message}`;\r\n\t\t\t\t\tif (error) error(path, `Couldn't load texture atlas ${path}: ${ex.message}`);\r\n\t\t\t\t\tthis.toLoad--;\r\n\t\t\t\t\tthis.loaded++;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let atlasPage of atlasPages) {\r\n\t\t\t\t\tlet pageLoadError = false;\r\n\t\t\t\t\tthis.loadTexture(atlasPage, (imagePath: string, image: HTMLImageElement) => {\r\n\t\t\t\t\t\tpagesLoaded.count++;\r\n\r\n\t\t\t\t\t\tif (pagesLoaded.count == atlasPages.length) {\r\n\t\t\t\t\t\t\tif (!pageLoadError) {\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tlet atlas = new TextureAtlas(atlasData, (path: string) => {\r\n\t\t\t\t\t\t\t\t\t\treturn this.get(parent == \"\" ? path : parent + \"/\" + path);\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tthis.assets[path] = atlas;\r\n\t\t\t\t\t\t\t\t\tif (success) success(path, atlas);\r\n\t\t\t\t\t\t\t\t\tthis.toLoad--;\r\n\t\t\t\t\t\t\t\t\tthis.loaded++;\r\n\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\tlet ex = e as Error;\r\n\t\t\t\t\t\t\t\t\tthis.errors[path] = `Couldn't load texture atlas ${path}: ${ex.message}`;\r\n\t\t\t\t\t\t\t\t\tif (error) error(path, `Couldn't load texture atlas ${path}: ${ex.message}`);\r\n\t\t\t\t\t\t\t\t\tthis.toLoad--;\r\n\t\t\t\t\t\t\t\t\tthis.loaded++;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.errors[path] = `Couldn't load texture atlas page ${imagePath}} of atlas ${path}`;\r\n\t\t\t\t\t\t\t\tif (error) error(path, `Couldn't load texture atlas page ${imagePath} of atlas ${path}`);\r\n\t\t\t\t\t\t\t\tthis.toLoad--;\r\n\t\t\t\t\t\t\t\tthis.loaded++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, (imagePath: string, errorMessage: string) => {\r\n\t\t\t\t\t\tpageLoadError = true;\r\n\t\t\t\t\t\tpagesLoaded.count++;\r\n\r\n\t\t\t\t\t\tif (pagesLoaded.count == atlasPages.length) {\r\n\t\t\t\t\t\t\tthis.errors[path] = `Couldn't load texture atlas page ${imagePath}} of atlas ${path}`;\r\n\t\t\t\t\t\t\tif (error) error(path, `Couldn't load texture atlas page ${imagePath} of atlas ${path}`);\r\n\t\t\t\t\t\t\tthis.toLoad--;\r\n\t\t\t\t\t\t\tthis.loaded++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, (state: number, responseText: string): void => {\r\n\t\t\t\tthis.errors[path] = `Couldn't load texture atlas ${path}: status ${status}, ${responseText}`;\r\n\t\t\t\tif (error) error(path, `Couldn't load texture atlas ${path}: status ${status}, ${responseText}`);\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tget (path: string) {\r\n\t\t\tpath = this.pathPrefix + path;\r\n\t\t\treturn this.assets[path];\r\n\t\t}\r\n\r\n\t\tremove (path: string) {\r\n\t\t\tpath = this.pathPrefix + path;\r\n\t\t\tlet asset = this.assets[path];\r\n\t\t\tif ((<any>asset).dispose) (<any>asset).dispose();\r\n\t\t\tthis.assets[path] = null;\r\n\t\t}\r\n\r\n\t\tremoveAll () {\r\n\t\t\tfor (let key in this.assets) {\r\n\t\t\t\tlet asset = this.assets[key];\r\n\t\t\t\tif ((<any>asset).dispose) (<any>asset).dispose();\r\n\t\t\t}\r\n\t\t\tthis.assets = {};\r\n\t\t}\r\n\r\n\t\tisLoadingComplete (): boolean {\r\n\t\t\treturn this.toLoad == 0;\r\n\t\t}\r\n\r\n\t\tgetToLoad (): number {\r\n\t\t\treturn this.toLoad;\r\n\t\t}\r\n\r\n\t\tgetLoaded (): number {\r\n\t\t\treturn this.loaded;\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t\tthis.removeAll();\r\n\t\t}\r\n\r\n\t\thasErrors() {\r\n\t\t\treturn Object.keys(this.errors).length > 0;\r\n\t\t}\r\n\r\n\t\tgetErrors() {\r\n\t\t\treturn this.errors;\r\n\t\t}\r\n\r\n\t\tclearErrors() {\r\n\t\t\tthis.errors = {};\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BlendMode } from \"../core/BlendMode\";\r\nimport { Restorable } from \"../core/Utils\";\r\n\r\n// module spine.webgl {\r\n\texport class ManagedWebGLRenderingContext {\r\n\t\tpublic canvas: HTMLCanvasElement | OffscreenCanvas;\r\n\t\tpublic gl: WebGLRenderingContext;\r\n\t\tprivate restorables = new Array<Restorable>();\r\n\r\n\t\tconstructor(canvasOrContext: HTMLCanvasElement | WebGLRenderingContext, contextConfig: any = { alpha: \"true\" }) {\r\n\t\t\tif (canvasOrContext instanceof HTMLCanvasElement) {\r\n\t\t\t\tlet canvas = canvasOrContext;\r\n\t\t\t\tthis.gl = <WebGLRenderingContext> (canvas.getContext(\"webgl2\", contextConfig) || canvas.getContext(\"webgl\", contextConfig));\r\n\t\t\t\tthis.canvas = canvas;\r\n\t\t\t\tcanvas.addEventListener(\"webglcontextlost\", (e: any) => {\r\n\t\t\t\t\tlet event = <WebGLContextEvent>e;\r\n\t\t\t\t\tif (e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcanvas.addEventListener(\"webglcontextrestored\", (e: any) => {\r\n\t\t\t\t\tfor (let i = 0, n = this.restorables.length; i < n; i++) {\r\n\t\t\t\t\t\tthis.restorables[i].restore();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tthis.gl = canvasOrContext;\r\n\t\t\t\tthis.canvas = this.gl.canvas;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\taddRestorable(restorable: Restorable) {\r\n\t\t\tthis.restorables.push(restorable);\r\n\t\t}\r\n\r\n\t\tremoveRestorable(restorable: Restorable) {\r\n\t\t\tlet index = this.restorables.indexOf(restorable);\r\n\t\t\tif (index > -1) this.restorables.splice(index, 1);\r\n\t\t}\r\n\t}\r\n\r\n\texport class WebGLBlendModeConverter {\r\n\t\tstatic ZERO = 0;\r\n\t\tstatic ONE = 1;\r\n\t\tstatic SRC_COLOR = 0x0300;\r\n\t\tstatic ONE_MINUS_SRC_COLOR = 0x0301;\r\n\t\tstatic SRC_ALPHA = 0x0302;\r\n\t\tstatic ONE_MINUS_SRC_ALPHA = 0x0303;\r\n\t\tstatic DST_ALPHA = 0x0304;\r\n\t\tstatic ONE_MINUS_DST_ALPHA = 0x0305;\r\n\t\tstatic DST_COLOR = 0x0306\r\n\r\n\t\tstatic getDestGLBlendMode (blendMode: BlendMode) {\r\n\t\t\tswitch(blendMode) {\r\n\t\t\t\tcase BlendMode.Normal: return WebGLBlendModeConverter.ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tcase BlendMode.Additive: return WebGLBlendModeConverter.ONE;\r\n\t\t\t\tcase BlendMode.Multiply: return WebGLBlendModeConverter.ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tcase BlendMode.Screen: return WebGLBlendModeConverter.ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tdefault: throw new Error(\"Unknown blend mode: \" + blendMode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic getSourceGLBlendMode (blendMode: BlendMode, premultipliedAlpha: boolean = false) {\r\n\t\t\tswitch(blendMode) {\r\n\t\t\t\tcase BlendMode.Normal: return premultipliedAlpha? WebGLBlendModeConverter.ONE : WebGLBlendModeConverter.SRC_ALPHA;\r\n\t\t\t\tcase BlendMode.Additive: return premultipliedAlpha? WebGLBlendModeConverter.ONE : WebGLBlendModeConverter.SRC_ALPHA;\r\n\t\t\t\tcase BlendMode.Multiply: return WebGLBlendModeConverter.DST_COLOR;\r\n\t\t\t\tcase BlendMode.Screen: return WebGLBlendModeConverter.ONE;\r\n\t\t\t\tdefault: throw new Error(\"Unknown blend mode: \" + blendMode);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Texture, TextureFilter, TextureWrap } from \"../core/Texture\";\r\nimport { Restorable, Disposable } from \"../core/Utils\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\texport class GLTexture extends Texture implements Disposable, Restorable {\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate texture: WebGLTexture = null;\r\n\t\tprivate boundUnit = 0;\r\n\t\tprivate useMipMaps = false;\r\n\r\n\t\tpublic static DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL = false;\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext | WebGLRenderingContext, image: HTMLImageElement, useMipMaps: boolean = false) {\r\n\t\t\tsuper(image);\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t\tthis.useMipMaps = useMipMaps;\r\n\t\t\tthis.restore();\r\n\t\t\tthis.context.addRestorable(this);\r\n\t\t}\r\n\r\n\t\tsetFilters (minFilter: TextureFilter, magFilter: TextureFilter) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.bind();\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, minFilter);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, GLTexture.validateMagFilter(magFilter));\r\n\t\t}\r\n\r\n\t\tstatic validateMagFilter (magFilter: TextureFilter) {\r\n\t\t\tswitch(magFilter) {\r\n\t\t\t\tcase TextureFilter.MipMap:\r\n\t\t\t\tcase TextureFilter.MipMapLinearLinear:\r\n\t\t\t\tcase TextureFilter.MipMapLinearNearest:\r\n\t\t\t\tcase TextureFilter.MipMapNearestLinear:\r\n\t\t\t\tcase TextureFilter.MipMapNearestNearest:\r\n\t\t\t\t\treturn TextureFilter.Linear;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn magFilter;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsetWraps (uWrap: TextureWrap, vWrap: TextureWrap) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.bind();\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, uWrap);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, vWrap);\r\n\t\t}\r\n\r\n\t\tupdate (useMipMaps: boolean) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (!this.texture) {\r\n\t\t\t\tthis.texture = this.context.gl.createTexture();\r\n\t\t\t}\r\n\t\t\tthis.bind();\r\n\t\t\tif (GLTexture.DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL) gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);\r\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this._image);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, useMipMaps ? gl.LINEAR_MIPMAP_LINEAR : gl.LINEAR);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\t\t\tif (useMipMaps) gl.generateMipmap(gl.TEXTURE_2D);\r\n\t\t}\r\n\r\n\t\trestore () {\r\n\t\t\tthis.texture = null;\r\n\t\t\tthis.update(this.useMipMaps);\r\n\t\t}\r\n\r\n\t\tbind (unit: number = 0) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.boundUnit = unit;\r\n\t\t\tgl.activeTexture(gl.TEXTURE0 + unit);\r\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n\t\t}\r\n\r\n\t\tunbind () {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tgl.activeTexture(gl.TEXTURE0 + this.boundUnit);\r\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, null);\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t\tthis.context.removeRestorable(this);\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tgl.deleteTexture(this.texture);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { AssetManager as spineAssetManager } from \"../core/AssetManager\";\r\nimport { GLTexture } from \"./GLTexture\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\n// module spine.webgl {\r\n\texport class AssetManager extends spineAssetManager {\r\n\t\tconstructor (context: ManagedWebGLRenderingContext | WebGLRenderingContext, pathPrefix: string = \"\") {\r\n\t\t\tsuper((image: HTMLImageElement) => {\r\n\t\t\t\treturn new GLTexture(context, image);\r\n\t\t\t}, pathPrefix);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { MixBlend } from \"./Animation\";\r\nimport { Skeleton } from \"./Skeleton\";\r\n\r\n// module spine {\r\n\texport interface Map<T> {\r\n\t\t[key: string]: T;\r\n\t}\r\n\r\n\texport class IntSet {\r\n\t\tarray = new Array<number>();\r\n\r\n\t\tadd (value: number): boolean {\r\n\t\t\tlet contains = this.contains(value);\r\n\t\t\tthis.array[value | 0] = value | 0;\r\n\t\t\treturn !contains;\r\n\t\t}\r\n\r\n\t\tcontains (value: number) {\r\n\t\t\treturn this.array[value | 0] != undefined;\r\n\t\t}\r\n\r\n\t\tremove (value: number) {\r\n\t\t\tthis.array[value | 0] = undefined;\r\n\t\t}\r\n\r\n\t\tclear () {\r\n\t\t\tthis.array.length = 0;\r\n\t\t}\r\n\t}\r\n\r\n\texport interface Disposable {\r\n\t\tdispose (): void;\r\n\t}\r\n\r\n\texport interface Restorable {\r\n\t\trestore (): void;\r\n\t}\r\n\r\n\texport class Color {\r\n\t\tpublic static WHITE = new Color(1, 1, 1, 1);\r\n\t\tpublic static RED = new Color(1, 0, 0, 1);\r\n\t\tpublic static GREEN = new Color(0, 1, 0, 1);\r\n\t\tpublic static BLUE = new Color(0, 0, 1, 1);\r\n\t\tpublic static MAGENTA = new Color(1, 0, 1, 1);\r\n\t\tpublic static ORANGE = new Color(1, 0.5, 0.1, 1.0);\r\n\r\n\t\tconstructor (public r: number = 0, public g: number = 0, public b: number = 0, public a: number = 0) {\r\n\t\t}\r\n\r\n\t\tset (r: number, g: number, b: number, a: number) {\r\n\t\t\tthis.r = r;\r\n\t\t\tthis.g = g;\r\n\t\t\tthis.b = b;\r\n\t\t\tthis.a = a;\r\n\t\t\tthis.clamp();\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tsetFromColor (c: Color) {\r\n\t\t\tthis.r = c.r;\r\n\t\t\tthis.g = c.g;\r\n\t\t\tthis.b = c.b;\r\n\t\t\tthis.a = c.a;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tsetFromString (hex: string) {\r\n\t\t\thex = hex.charAt(0) == '#' ? hex.substr(1) : hex;\r\n\t\t\tthis.r = parseInt(hex.substr(0, 2), 16) / 255.0;\r\n\t\t\tthis.g = parseInt(hex.substr(2, 2), 16) / 255.0;\r\n\t\t\tthis.b = parseInt(hex.substr(4, 2), 16) / 255.0;\r\n\t\t\tthis.a = (hex.length != 8 ? 255 : parseInt(hex.substr(6, 2), 16)) / 255.0;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tadd (r: number, g: number, b: number, a: number) {\r\n\t\t\tthis.r += r;\r\n\t\t\tthis.g += g;\r\n\t\t\tthis.b += b;\r\n\t\t\tthis.a += a;\r\n\t\t\tthis.clamp();\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tclamp () {\r\n\t\t\tif (this.r < 0) this.r = 0;\r\n\t\t\telse if (this.r > 1) this.r = 1;\r\n\r\n\t\t\tif (this.g < 0) this.g = 0;\r\n\t\t\telse if (this.g > 1) this.g = 1;\r\n\r\n\t\t\tif (this.b < 0) this.b = 0;\r\n\t\t\telse if (this.b > 1) this.b = 1;\r\n\r\n\t\t\tif (this.a < 0) this.a = 0;\r\n\t\t\telse if (this.a > 1) this.a = 1;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tstatic rgba8888ToColor(color: Color, value: number) {\r\n\t\t\tcolor.r = ((value & 0xff000000) >>> 24) / 255;\r\n\t\t\tcolor.g = ((value & 0x00ff0000) >>> 16) / 255;\r\n\t\t\tcolor.b = ((value & 0x0000ff00) >>> 8) / 255;\r\n\t\t\tcolor.a = ((value & 0x000000ff)) / 255;\r\n\t\t}\r\n\r\n\t\tstatic rgb888ToColor (color: Color, value: number) {\r\n\t\t\tcolor.r = ((value & 0x00ff0000) >>> 16) / 255;\r\n\t\t\tcolor.g = ((value & 0x0000ff00) >>> 8) / 255;\r\n\t\t\tcolor.b = ((value & 0x000000ff)) / 255;\r\n\t\t}\r\n\t}\r\n\r\n\texport class MathUtils {\r\n\t\tstatic PI = 3.1415927;\r\n\t\tstatic PI2 = MathUtils.PI * 2;\r\n\t\tstatic radiansToDegrees = 180 / MathUtils.PI;\r\n\t\tstatic radDeg = MathUtils.radiansToDegrees;\r\n\t\tstatic degreesToRadians = MathUtils.PI / 180;\r\n\t\tstatic degRad = MathUtils.degreesToRadians;\r\n\r\n\t\tstatic clamp (value: number, min: number, max: number) {\r\n\t\t\tif (value < min) return min;\r\n\t\t\tif (value > max) return max;\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tstatic cosDeg (degrees: number) {\r\n\t\t\treturn Math.cos(degrees * MathUtils.degRad);\r\n\t\t}\r\n\r\n\t\tstatic sinDeg (degrees: number) {\r\n\t\t\treturn Math.sin(degrees * MathUtils.degRad);\r\n\t\t}\r\n\r\n\t\tstatic signum (value: number): number {\r\n\t\t\treturn value > 0 ? 1 : value < 0 ? -1 : 0;\r\n\t\t}\r\n\r\n\t\tstatic toInt (x: number) {\r\n\t\t\treturn x > 0 ? Math.floor(x) : Math.ceil(x);\r\n\t\t}\r\n\r\n\t\tstatic cbrt (x: number) {\r\n\t\t\tlet y = Math.pow(Math.abs(x), 1/3);\r\n\t\t\treturn x < 0 ? -y : y;\r\n\t\t}\r\n\r\n\t\tstatic randomTriangular (min: number, max: number): number {\r\n\t\t\treturn MathUtils.randomTriangularWith(min, max, (min + max) * 0.5);\r\n\t\t}\r\n\r\n\t\tstatic randomTriangularWith (min: number, max: number, mode: number): number {\r\n\t\t\tlet u = Math.random();\r\n\t\t\tlet d = max - min;\r\n\t\t\tif (u <= (mode - min) / d) return min + Math.sqrt(u * d * (mode - min));\r\n\t\t\treturn max - Math.sqrt((1 - u) * d * (max - mode));\r\n\t\t}\r\n\t}\r\n\r\n\texport abstract class Interpolation {\r\n\t\tprotected abstract applyInternal (a: number): number;\r\n\t\tapply(start: number, end: number, a: number): number {\r\n\t\t\treturn start + (end - start) * this.applyInternal(a);\r\n\t\t}\r\n\t}\r\n\r\n\texport class Pow extends Interpolation {\r\n\t\tprotected power = 2;\r\n\r\n\t\tconstructor (power: number) {\r\n\t\t\tsuper();\r\n\t\t\tthis.power = power;\r\n\t\t}\r\n\r\n\t\tapplyInternal (a: number): number {\r\n\t\t\tif (a <= 0.5) return Math.pow(a * 2, this.power) / 2;\r\n\t\t\treturn Math.pow((a - 1) * 2, this.power) / (this.power % 2 == 0 ? -2 : 2) + 1;\r\n\t\t}\r\n\t}\r\n\r\n\texport class PowOut extends Pow {\r\n\t\tconstructor (power: number) {\r\n\t\t\tsuper(power);\r\n\t\t}\r\n\r\n\t\tapplyInternal (a: number) : number {\r\n\t\t\treturn Math.pow(a - 1, this.power) * (this.power % 2 == 0 ? -1 : 1) + 1;\r\n\t\t}\r\n\t}\r\n\r\n\texport class Utils {\r\n\t\tstatic SUPPORTS_TYPED_ARRAYS = typeof(Float32Array) !== \"undefined\";\r\n\r\n\t\tstatic arrayCopy<T> (source: ArrayLike<T>, sourceStart: number, dest: ArrayLike<T>, destStart: number, numElements: number) {\r\n\t\t\tfor (let i = sourceStart, j = destStart; i < sourceStart + numElements; i++, j++) {\r\n\t\t\t\tdest[j] = source[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic setArraySize<T> (array: Array<T>, size: number, value: any = 0): Array<T> {\r\n\t\t\tlet oldSize = array.length;\r\n\t\t\tif (oldSize == size) return array;\r\n\t\t\tarray.length = size;\r\n\t\t\tif (oldSize < size) {\r\n\t\t\t\tfor (let i = oldSize; i < size; i++) array[i] = value;\r\n\t\t\t}\r\n\t\t\treturn array;\r\n\t\t}\r\n\r\n\t\tstatic ensureArrayCapacity<T> (array: Array<T>, size: number, value: any = 0): Array<T> {\r\n\t\t\tif (array.length >= size) return array;\r\n\t\t\treturn Utils.setArraySize(array, size, value);\r\n\t\t}\r\n\r\n\t\tstatic newArray<T> (size: number, defaultValue: T): Array<T> {\r\n\t\t\tlet array = new Array<T>(size);\r\n\t\t\tfor (let i = 0; i < size; i++) array[i] = defaultValue;\r\n\t\t\treturn array;\r\n\t\t}\r\n\r\n\t\tstatic newFloatArray (size: number): ArrayLike<number> {\r\n\t\t\tif (Utils.SUPPORTS_TYPED_ARRAYS) {\r\n\t\t\t\treturn new Float32Array(size)\r\n\t\t\t} else {\r\n\t\t\t\t let array = new Array<number>(size);\r\n\t\t\t\t for (let i = 0; i < array.length; i++) array[i] = 0;\r\n\t\t\t\t return array;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic newShortArray (size: number): ArrayLike<number> {\r\n\t\t\tif (Utils.SUPPORTS_TYPED_ARRAYS) {\r\n\t\t\t\treturn new Int16Array(size)\r\n\t\t\t} else {\r\n\t\t\t\t let array = new Array<number>(size);\r\n\t\t\t\t for (let i = 0; i < array.length; i++) array[i] = 0;\r\n\t\t\t\t return array;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic toFloatArray (array: Array<number>) {\r\n\t\t\treturn Utils.SUPPORTS_TYPED_ARRAYS ? new Float32Array(array) : array;\r\n\t\t}\r\n\r\n\t\tstatic toSinglePrecision (value: number) {\r\n\t\t\treturn Utils.SUPPORTS_TYPED_ARRAYS ? Math.fround(value) : value;\r\n\t\t}\r\n\r\n\t\t// This function is used to fix WebKit 602 specific issue described at http://esotericsoftware.com/forum/iOS-10-disappearing-graphics-10109\r\n\t\tstatic webkit602BugfixHelper (alpha: number, blend: MixBlend) {\r\n\r\n\t\t}\r\n\r\n\t\tstatic contains<T> (array: Array<T>, element: T, identity = true) {\r\n\t\t\tfor (var i = 0; i < array.length; i++) {\r\n\t\t\t\tif (array[i] == element) return true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\texport class DebugUtils {\r\n\t\tstatic logBones(skeleton: Skeleton) {\r\n\t\t\tfor (let i = 0; i < skeleton.bones.length; i++) {\r\n\t\t\t\tlet bone = skeleton.bones[i];\r\n\t\t\t\tconsole.log(bone.data.name + \", \" + bone.a + \", \" + bone.b + \", \" + bone.c + \", \" + bone.d + \", \" + bone.worldX + \", \" + bone.worldY);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport class Pool<T> {\r\n\t\tprivate items = new Array<T>();\r\n\t\tprivate instantiator: () => T;\r\n\r\n\t\tconstructor (instantiator: () => T) {\r\n\t\t\tthis.instantiator = instantiator;\r\n\t\t}\r\n\r\n\t\tobtain () {\r\n\t\t\treturn this.items.length > 0 ? this.items.pop() : this.instantiator();\r\n\t\t}\r\n\r\n\t\tfree (item: T) {\r\n\t\t\tif ((item as any).reset) (item as any).reset();\r\n\t\t\tthis.items.push(item);\r\n\t\t}\r\n\r\n\t\tfreeAll (items: ArrayLike<T>) {\r\n\t\t\tfor (let i = 0; i < items.length; i++) {\r\n\t\t\t\tif ((items[i] as any).reset) (items[i] as any).reset();\r\n\t\t\t\tthis.items[i] = items[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tclear () {\r\n\t\t\tthis.items.length = 0;\r\n\t\t}\r\n\t}\r\n\r\n\texport class Vector2 {\r\n\t\tconstructor (public x = 0, public y = 0) {\r\n\t\t}\r\n\r\n\t\tset (x: number, y: number): Vector2 {\r\n\t\t\tthis.x = x;\r\n\t\t\tthis.y = y;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tlength () {\r\n\t\t\tlet x = this.x;\r\n\t\t\tlet y = this.y;\r\n\t\t\treturn Math.sqrt(x * x + y * y);\r\n\t\t}\r\n\r\n\t\tsubtract(other: Vector2): Vector2 {\r\n\t\t\treturn new Vector2(this.x - other.x, this.y - other.y);\r\n\t\t}\r\n\r\n\t\tnormalize () {\r\n\t\t\tlet len = this.length();\r\n\t\t\tif (len != 0) {\r\n\t\t\t\tthis.x /= len;\r\n\t\t\t\tthis.y /= len;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tnormalize_new() {\r\n\t\t\tlet len = this.length();\r\n\t\t\treturn new Vector2(\r\n\t\t\t\tthis.x / len,\r\n\t\t\t\tthis.y / len\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tangle(other: Vector2) {\r\n\t\t\tlet dot = this.x * other.x + this.y * other.y;\r\n\t\t\tlet len_a = Math.sqrt(this.x*this.x + this.y*this.y);\r\n\t\t\tlet len_b = Math.sqrt(other.x*other.x + other.y*other.y);\r\n\t\t\treturn Math.acos(dot / (len_a*len_b));\r\n\t\t}\r\n\t}\r\n\r\n\texport class TimeKeeper {\r\n\t\tmaxDelta = 0.064;\r\n\t\tframesPerSecond = 0;\r\n\t\tdelta = 0;\r\n\t\ttotalTime = 0;\r\n\r\n\t\tprivate lastTime = Date.now() / 1000;\r\n\t\tprivate frameCount = 0;\r\n\t\tprivate frameTime = 0;\r\n\r\n\t\tupdate () {\r\n\t\t\tlet now = Date.now() / 1000;\r\n\t\t\tthis.delta = now - this.lastTime;\r\n\t\t\tthis.frameTime += this.delta;\r\n\t\t\tthis.totalTime += this.delta;\r\n\t\t\tif (this.delta > this.maxDelta) this.delta = this.maxDelta;\r\n\t\t\tthis.lastTime = now;\r\n\r\n\t\t\tthis.frameCount++;\r\n\t\t\tif (this.frameTime > 1) {\r\n\t\t\t\tthis.framesPerSecond = this.frameCount / this.frameTime;\r\n\t\t\t\tthis.frameTime = 0;\r\n\t\t\t\tthis.frameCount = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport interface ArrayLike<T> {\r\n\t\tlength: number;\r\n\t\t[n: number]: T;\r\n\t}\r\n\r\n\texport class WindowedMean {\r\n\t\tvalues: Array<number>;\r\n\t\taddedValues = 0;\r\n\t\tlastValue = 0;\r\n\t\tmean = 0;\r\n\t\tdirty = true;\r\n\r\n\t\tconstructor (windowSize: number = 32) {\r\n\t\t\tthis.values = new Array<number>(windowSize);\r\n\t\t}\r\n\r\n\t\thasEnoughData () {\r\n\t\t\treturn this.addedValues >= this.values.length;\r\n\t\t}\r\n\r\n\t\taddValue (value: number) {\r\n\t\t\tif (this.addedValues < this.values.length)\r\n\t\t\t\tthis.addedValues++;\r\n\t\t\tthis.values[this.lastValue++] = value;\r\n\t\t\tif (this.lastValue > this.values.length - 1) this.lastValue = 0;\r\n\t\t\tthis.dirty = true;\r\n\t\t}\r\n\r\n\t\tgetMean () {\r\n\t\t\tif (this.hasEnoughData()) {\r\n\t\t\t\tif (this.dirty) {\r\n\t\t\t\t\tlet mean = 0;\r\n\t\t\t\t\tfor (let i = 0; i < this.values.length; i++) {\r\n\t\t\t\t\t\tmean += this.values[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.mean = mean / this.values.length;\r\n\t\t\t\t\tthis.dirty = false;\r\n\t\t\t\t}\r\n\t\t\t\treturn this.mean;\r\n\t\t\t} else {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Slot } from \"../Slot\";\r\nimport { Utils, ArrayLike } from \"../Utils\";\r\n\r\n// module spine {\r\n\t/** The base class for all attachments. */\r\n\texport abstract class Attachment {\r\n\t\tname: string;\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tif (name == null) throw new Error(\"name cannot be null.\");\r\n\t\t\tthis.name = name;\r\n\t\t}\r\n\r\n\t\tabstract copy (): Attachment;\r\n\t}\r\n\r\n\t/** Base class for an attachment with vertices that are transformed by one or more bones and can be deformed by a slot's\r\n\t * {@link Slot#deform}. */\r\n\texport abstract class VertexAttachment extends Attachment {\r\n\t\tprivate static nextID = 0;\r\n\r\n\t\t/** The unique ID for this attachment. */\r\n\t\tid = (VertexAttachment.nextID++ & 65535) << 11;\r\n\r\n\t\t/** The bones which affect the {@link #getVertices()}. The array entries are, for each vertex, the number of bones affecting\r\n\t\t * the vertex followed by that many bone indices, which is the index of the bone in {@link Skeleton#bones}. Will be null\r\n\t\t * if this attachment has no weights. */\r\n\t\tbones: Array<number>;\r\n\r\n\t\t/** The vertex positions in the bone's coordinate system. For a non-weighted attachment, the values are `x,y`\r\n\t\t * entries for each vertex. For a weighted attachment, the values are `x,y,weight` entries for each bone affecting\r\n\t\t * each vertex. */\r\n\t\tvertices: ArrayLike<number>;\r\n\r\n\t\t/** The maximum number of world vertex values that can be output by\r\n\t\t * {@link #computeWorldVertices()} using the `count` parameter. */\r\n\t\tworldVerticesLength = 0;\r\n\r\n\t\t/** Deform keys for the deform attachment are also applied to this attachment. May be null if no deform keys should be applied. */\r\n\t\tdeformAttachment: VertexAttachment = this;\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\t/** Transforms the attachment's local {@link vertices} to world coordinates. If the slot's {@link Slot#deform} is\r\n\t\t * not empty, it is used to deform the vertices.\r\n\t\t *\r\n\t\t * See [World transforms](http://esotericsoftware.com/spine-runtime-skeletons#World-transforms) in the Spine\r\n\t\t * Runtimes Guide.\r\n\t\t * @param start The index of the first {@link #vertices} value to transform. Each vertex has 2 values, x and y.\r\n\t\t * @param count The number of world vertex values to output. Must be <= {@link #worldVerticesLength} - `start`.\r\n\t\t * @param worldVertices The output world vertices. Must have a length >= `offset` + `count` *\r\n\t\t *           `stride` / 2.\r\n\t\t * @param offset The `worldVertices` index to begin writing values.\r\n\t\t * @param stride The number of `worldVertices` entries between the value pairs written. */\r\n\t\tcomputeWorldVertices (slot: Slot, start: number, count: number, worldVertices: ArrayLike<number>, offset: number, stride: number) {\r\n\t\t\tcount = offset + (count >> 1) * stride;\r\n\t\t\tlet skeleton = slot.bone.skeleton;\r\n\t\t\tlet deformArray = slot.deform;\r\n\t\t\tlet vertices = this.vertices;\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tif (bones == null) {\r\n\t\t\t\tif (deformArray.length > 0) vertices = deformArray;\r\n\t\t\t\tlet bone = slot.bone;\r\n\t\t\t\tlet x = bone.worldX;\r\n\t\t\t\tlet y = bone.worldY;\r\n\t\t\t\tlet a = bone.a, b = bone.b, c = bone.c, d = bone.d;\r\n\t\t\t\tfor (let v = start, w = offset; w < count; v += 2, w += stride) {\r\n\t\t\t\t\tlet vx = vertices[v], vy = vertices[v + 1];\r\n\t\t\t\t\tworldVertices[w] = vx * a + vy * b + x;\r\n\t\t\t\t\tworldVertices[w + 1] = vx * c + vy * d + y;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet v = 0, skip = 0;\r\n\t\t\tfor (let i = 0; i < start; i += 2) {\r\n\t\t\t\tlet n = bones[v];\r\n\t\t\t\tv += n + 1;\r\n\t\t\t\tskip += n;\r\n\t\t\t}\r\n\t\t\tlet skeletonBones = skeleton.bones;\r\n\t\t\tif (deformArray.length == 0) {\r\n\t\t\t\tfor (let w = offset, b = skip * 3; w < count; w += stride) {\r\n\t\t\t\t\tlet wx = 0, wy = 0;\r\n\t\t\t\t\tlet n = bones[v++];\r\n\t\t\t\t\tn += v;\r\n\t\t\t\t\tfor (; v < n; v++, b += 3) {\r\n\t\t\t\t\t\tlet bone = skeletonBones[bones[v]];\r\n\t\t\t\t\t\tlet vx = vertices[b], vy = vertices[b + 1], weight = vertices[b + 2];\r\n\t\t\t\t\t\twx += (vx * bone.a + vy * bone.b + bone.worldX) * weight;\r\n\t\t\t\t\t\twy += (vx * bone.c + vy * bone.d + bone.worldY) * weight;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tworldVertices[w] = wx;\r\n\t\t\t\t\tworldVertices[w + 1] = wy;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet deform = deformArray;\r\n\t\t\t\tfor (let w = offset, b = skip * 3, f = skip << 1; w < count; w += stride) {\r\n\t\t\t\t\tlet wx = 0, wy = 0;\r\n\t\t\t\t\tlet n = bones[v++];\r\n\t\t\t\t\tn += v;\r\n\t\t\t\t\tfor (; v < n; v++, b += 3, f += 2) {\r\n\t\t\t\t\t\tlet bone = skeletonBones[bones[v]];\r\n\t\t\t\t\t\tlet vx = vertices[b] + deform[f], vy = vertices[b + 1] + deform[f + 1], weight = vertices[b + 2];\r\n\t\t\t\t\t\twx += (vx * bone.a + vy * bone.b + bone.worldX) * weight;\r\n\t\t\t\t\t\twy += (vx * bone.c + vy * bone.d + bone.worldY) * weight;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tworldVertices[w] = wx;\r\n\t\t\t\t\tworldVertices[w + 1] = wy;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Does not copy id (generated) or name (set on construction). **/\r\n\t\tcopyTo (attachment: VertexAttachment) {\r\n\t\t\tif (this.bones != null) {\r\n\t\t\t\tattachment.bones = new Array<number>(this.bones.length);\r\n\t\t\t\tUtils.arrayCopy(this.bones, 0, attachment.bones, 0, this.bones.length);\r\n\t\t\t} else\r\n\t\t\t\tattachment.bones = null;\r\n\r\n\t\t\tif (this.vertices != null) {\r\n\t\t\t\tattachment.vertices = Utils.newFloatArray(this.vertices.length);\r\n\t\t\t\tUtils.arrayCopy(this.vertices, 0, attachment.vertices, 0, this.vertices.length);\r\n\t\t\t} else\r\n\t\t\t\tattachment.vertices = null;\r\n\r\n\t\t\tattachment.worldVerticesLength = this.worldVerticesLength;\r\n\t\t\tattachment.deformAttachment = this.deformAttachment;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Color } from \"../Utils\";\r\nimport { VertexAttachment, Attachment } from \"./Attachment\";\r\n\r\n// module spine {\r\n\r\n\t/** An attachment with vertices that make up a polygon. Can be used for hit detection, creating physics bodies, spawning particle\r\n\t * effects, and more.\r\n\t *\r\n\t * See {@link SkeletonBounds} and [Bounding Boxes](http://esotericsoftware.com/spine-bounding-boxes) in the Spine User\r\n\t * Guide. */\r\n\texport class BoundingBoxAttachment extends VertexAttachment {\r\n\t\tcolor = new Color(1, 1, 1, 1);\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\tcopy (): Attachment {\r\n\t\t\tlet copy = new BoundingBoxAttachment(this.name);\r\n\t\t\tthis.copyTo(copy);\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\t\t\treturn copy;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { SlotData } from \"../SlotData\";\r\nimport { Color } from \"../Utils\";\r\nimport { Attachment, VertexAttachment } from \"./Attachment\";\r\n\r\n// module spine {\r\n\t/** An attachment with vertices that make up a polygon used for clipping the rendering of other attachments. */\r\n\texport class ClippingAttachment extends VertexAttachment {\r\n\t\t/** Clipping is performed between the clipping polygon's slot and the end slot. Returns null if clipping is done until the end of\r\n\t\t * the skeleton's rendering. */\r\n\t\tendSlot: SlotData;\r\n\r\n\t\t// Nonessential.\r\n\t\t/** The color of the clipping polygon as it was in Spine. Available only when nonessential data was exported. Clipping polygons\r\n\t\t * are not usually rendered at runtime. */\r\n\t\tcolor = new Color(0.2275, 0.2275, 0.8078, 1); // ce3a3aff\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\tcopy (): Attachment {\r\n\t\t\tlet copy = new ClippingAttachment(this.name);\r\n\t\t\tthis.copyTo(copy);\r\n\t\t\tcopy.endSlot = this.endSlot;\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\t\t\treturn copy;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { TextureRegion } from \"../Texture\";\r\nimport { TextureAtlasRegion } from \"../TextureAtlas\";\r\nimport { Color, Utils, ArrayLike } from \"../Utils\";\r\nimport { VertexAttachment, Attachment } from \"./Attachment\";\r\n\r\n// module spine {\r\n\t/** An attachment that displays a textured mesh. A mesh has hull vertices and internal vertices within the hull. Holes are not\r\n\t * supported. Each vertex has UVs (texture coordinates) and triangles are used to map an image on to the mesh.\r\n\t *\r\n\t * See [Mesh attachments](http://esotericsoftware.com/spine-meshes) in the Spine User Guide. */\r\n\texport class MeshAttachment extends VertexAttachment {\r\n\t\tregion: TextureRegion;\r\n\r\n\t\t/** The name of the texture region for this attachment. */\r\n\t\tpath: string;\r\n\r\n\t\t/** The UV pair for each vertex, normalized within the texture region. */\r\n\t\tregionUVs: ArrayLike<number>;\r\n\r\n\t\t/** The UV pair for each vertex, normalized within the entire texture.\r\n\t\t *\r\n\t\t * See {@link #updateUVs}. */\r\n\t\tuvs: ArrayLike<number>;\r\n\r\n\t\t/** Triplets of vertex indices which describe the mesh's triangulation. */\r\n\t\ttriangles: Array<number>;\r\n\r\n\t\t/** The color to tint the mesh. */\r\n\t\tcolor = new Color(1, 1, 1, 1);\r\n\r\n\t\t/** The width of the mesh's image. Available only when nonessential data was exported. */\r\n\t\twidth: number;\r\n\r\n\t\t/** The height of the mesh's image. Available only when nonessential data was exported. */\r\n\t\theight: number;\r\n\r\n\t\t/** The number of entries at the beginning of {@link #vertices} that make up the mesh hull. */\r\n\t\thullLength: number;\r\n\r\n\t\t/** Vertex index pairs describing edges for controling triangulation. Mesh triangles will never cross edges. Only available if\r\n\t\t * nonessential data was exported. Triangulation is not performed at runtime. */\r\n\t\tedges: Array<number>;\r\n\r\n\t\tprivate parentMesh: MeshAttachment;\r\n\t\ttempColor = new Color(0, 0, 0, 0);\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\t/** Calculates {@link #uvs} using {@link #regionUVs} and the {@link #region}. Must be called after changing the region UVs or\r\n\t\t * region. */\r\n\t\tupdateUVs () {\r\n\t\t\tlet regionUVs = this.regionUVs;\r\n\t\t\tif (this.uvs == null || this.uvs.length != regionUVs.length) this.uvs = Utils.newFloatArray(regionUVs.length);\r\n\t\t\tlet uvs = this.uvs;\r\n\t\t\tlet n = this.uvs.length;\r\n\t\t\tlet u = this.region.u, v = this.region.v, width = 0, height = 0;\r\n\t\t\tif (this.region instanceof TextureAtlasRegion) {\r\n\t\t\t\tlet region = this.region;\r\n\t\t\t\tlet textureWidth = region.texture.getImage().width, textureHeight = region.texture.getImage().height;\r\n\t\t\t\tswitch(region.degrees) {\r\n\t\t\t\tcase 90:\r\n\t\t\t\t\tu -= (region.originalHeight - region.offsetY - region.height) / textureWidth;\r\n\t\t\t\t\tv -= (region.originalWidth - region.offsetX - region.width) / textureHeight;\r\n\t\t\t\t\twidth = region.originalHeight / textureWidth;\r\n\t\t\t\t\theight = region.originalWidth / textureHeight;\r\n\t\t\t\t\tfor (let i = 0; i < n; i += 2) {\r\n\t\t\t\t\t\tuvs[i] = u + regionUVs[i + 1] * width;\r\n\t\t\t\t\t\tuvs[i + 1] = v + (1 - regionUVs[i]) * height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase 180:\r\n\t\t\t\t\tu -= (region.originalWidth - region.offsetX - region.width) / textureWidth;\r\n\t\t\t\t\tv -= region.offsetY / textureHeight;\r\n\t\t\t\t\twidth = region.originalWidth / textureWidth;\r\n\t\t\t\t\theight = region.originalHeight / textureHeight;\r\n\t\t\t\t\tfor (let i = 0; i < n; i += 2) {\r\n\t\t\t\t\t\tuvs[i] = u + (1 - regionUVs[i]) * width;\r\n\t\t\t\t\t\tuvs[i + 1] = v + (1 - regionUVs[i + 1]) * height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase 270:\r\n\t\t\t\t\tu -= region.offsetY / textureWidth;\r\n\t\t\t\t\tv -= region.offsetX / textureHeight;\r\n\t\t\t\t\twidth = region.originalHeight / textureWidth;\r\n\t\t\t\t\theight = region.originalWidth / textureHeight;\r\n\t\t\t\t\tfor (let i = 0; i < n; i += 2) {\r\n\t\t\t\t\t\tuvs[i] = u + (1 - regionUVs[i + 1]) * width;\r\n\t\t\t\t\t\tuvs[i + 1] = v + regionUVs[i] * height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tu -= region.offsetX / textureWidth;\r\n\t\t\t\tv -= (region.originalHeight - region.offsetY - region.height) / textureHeight;\r\n\t\t\t\twidth = region.originalWidth / textureWidth;\r\n\t\t\t\theight = region.originalHeight / textureHeight;\r\n\t\t\t} else if (this.region == null) {\r\n\t\t\t\tu = v = 0;\r\n\t\t\t\twidth = height = 1;\r\n\t\t\t} else {\r\n\t\t\t\twidth = this.region.u2 - u;\r\n\t\t\t\theight = this.region.v2 - v;\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = 0; i < n; i += 2) {\r\n\t\t\t\tuvs[i] = u + regionUVs[i] * width;\r\n\t\t\t\tuvs[i + 1] = v + regionUVs[i + 1] * height;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** The parent mesh if this is a linked mesh, else null. A linked mesh shares the {@link #bones}, {@link #vertices},\r\n\t\t * {@link #regionUVs}, {@link #triangles}, {@link #hullLength}, {@link #edges}, {@link #width}, and {@link #height} with the\r\n\t\t * parent mesh, but may have a different {@link #name} or {@link #path} (and therefore a different texture). */\r\n\t\tgetParentMesh () {\r\n\t\t\treturn this.parentMesh;\r\n\t\t}\r\n\r\n\t\t/** @param parentMesh May be null. */\r\n\t\tsetParentMesh (parentMesh: MeshAttachment) {\r\n\t\t\tthis.parentMesh = parentMesh;\r\n\t\t\tif (parentMesh != null) {\r\n\t\t\t\tthis.bones = parentMesh.bones;\r\n\t\t\t\tthis.vertices = parentMesh.vertices;\r\n\t\t\t\tthis.worldVerticesLength = parentMesh.worldVerticesLength;\r\n\t\t\t\tthis.regionUVs = parentMesh.regionUVs;\r\n\t\t\t\tthis.triangles = parentMesh.triangles;\r\n\t\t\t\tthis.hullLength = parentMesh.hullLength;\r\n\t\t\t\tthis.worldVerticesLength = parentMesh.worldVerticesLength\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcopy (): Attachment {\r\n\t\t\tif (this.parentMesh != null) return this.newLinkedMesh();\r\n\r\n\t\t\tlet copy = new MeshAttachment(this.name);\r\n\t\t\tcopy.region = this.region;\r\n\t\t\tcopy.path = this.path;\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\r\n\t\t\tthis.copyTo(copy);\r\n\t\t\tcopy.regionUVs = new Array<number>(this.regionUVs.length);\r\n\t\t\tUtils.arrayCopy(this.regionUVs, 0, copy.regionUVs, 0, this.regionUVs.length);\r\n\t\t\tcopy.uvs = new Array<number>(this.uvs.length);\r\n\t\t\tUtils.arrayCopy(this.uvs, 0, copy.uvs, 0, this.uvs.length);\r\n\t\t\tcopy.triangles = new Array<number>(this.triangles.length);\r\n\t\t\tUtils.arrayCopy(this.triangles, 0, copy.triangles, 0, this.triangles.length);\r\n\t\t\tcopy.hullLength = this.hullLength;\r\n\r\n\t\t\t// Nonessential.\r\n\t\t\tif (this.edges != null) {\r\n\t\t\t\tcopy.edges = new Array<number>(this.edges.length);\r\n\t\t\t\tUtils.arrayCopy(this.edges, 0, copy.edges, 0, this.edges.length);\r\n\t\t\t}\r\n\t\t\tcopy.width = this.width;\r\n\t\t\tcopy.height = this.height;\r\n\r\n\t\t\treturn copy;\r\n\t\t}\r\n\r\n\t\t/** Returns a new mesh with the {@link #parentMesh} set to this mesh's parent mesh, if any, else to this mesh. **/\r\n\t\tnewLinkedMesh (): MeshAttachment {\r\n\t\t\tlet copy = new MeshAttachment(this.name);\r\n\t\t\tcopy.region = this.region;\r\n\t\t\tcopy.path = this.path;\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\t\t\tcopy.deformAttachment = this.deformAttachment;\r\n\t\t\tcopy.setParentMesh(this.parentMesh != null ? this.parentMesh : this);\r\n\t\t\tcopy.updateUVs();\r\n\t\t\treturn copy;\r\n\t\t}\r\n\t}\r\n\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Color, Utils } from \"../Utils\";\r\nimport { VertexAttachment, Attachment } from \"./Attachment\";\r\n\r\n// module spine {\r\n\r\n\t/** An attachment whose vertices make up a composite Bezier curve.\r\n\t *\r\n\t * See {@link PathConstraint} and [Paths](http://esotericsoftware.com/spine-paths) in the Spine User Guide. */\r\n\texport class PathAttachment extends VertexAttachment {\r\n\r\n\t\t/** The lengths along the path in the setup pose from the start of the path to the end of each Bezier curve. */\r\n\t\tlengths: Array<number>;\r\n\r\n\t\t/** If true, the start and end knots are connected. */\r\n\t\tclosed = false;\r\n\r\n\t\t/** If true, additional calculations are performed to make calculating positions along the path more accurate. If false, fewer\r\n\t\t * calculations are performed but calculating positions along the path is less accurate. */\r\n\t\tconstantSpeed = false;\r\n\r\n\t\t/** The color of the path as it was in Spine. Available only when nonessential data was exported. Paths are not usually\r\n\t\t * rendered at runtime. */\r\n\t\tcolor = new Color(1, 1, 1, 1);\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\tcopy (): Attachment {\r\n\t\t\tlet copy = new PathAttachment(this.name);\r\n\t\t\tthis.copyTo(copy);\r\n\t\t\tcopy.lengths = new Array<number>(this.lengths.length);\r\n\t\t\tUtils.arrayCopy(this.lengths, 0, copy.lengths, 0, this.lengths.length);\r\n\t\t\tcopy.closed = closed;\r\n\t\t\tcopy.constantSpeed = this.constantSpeed;\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\t\t\treturn copy;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Bone } from \"../Bone\";\r\nimport { Color, Vector2, MathUtils } from \"../Utils\";\r\nimport { VertexAttachment, Attachment } from \"./Attachment\";\r\n\r\n// module spine {\r\n\t/** An attachment which is a single point and a rotation. This can be used to spawn projectiles, particles, etc. A bone can be\r\n\t * used in similar ways, but a PointAttachment is slightly less expensive to compute and can be hidden, shown, and placed in a\r\n\t * skin.\r\n\t *\r\n\t * See [Point Attachments](http://esotericsoftware.com/spine-point-attachments) in the Spine User Guide. */\r\n\texport class PointAttachment extends VertexAttachment {\r\n\t\tx: number; y: number; rotation: number;\r\n\r\n\t\t/** The color of the point attachment as it was in Spine. Available only when nonessential data was exported. Point attachments\r\n\t\t * are not usually rendered at runtime. */\r\n\t\tcolor = new Color(0.38, 0.94, 0, 1);\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\tcomputeWorldPosition (bone: Bone, point: Vector2) {\r\n\t\t\tpoint.x = this.x * bone.a + this.y * bone.b + bone.worldX;\r\n\t\t\tpoint.y = this.x * bone.c + this.y * bone.d + bone.worldY;\r\n\t\t\treturn point;\r\n\t\t}\r\n\r\n\t\tcomputeWorldRotation (bone: Bone) {\r\n\t\t\tlet cos = MathUtils.cosDeg(this.rotation), sin = MathUtils.sinDeg(this.rotation);\r\n\t\t\tlet x = cos * bone.a + sin * bone.b;\r\n\t\t\tlet y = cos * bone.c + sin * bone.d;\r\n\t\t\treturn Math.atan2(y, x) * MathUtils.radDeg;\r\n\t\t}\r\n\r\n\t\tcopy (): Attachment {\r\n\t\t\tlet copy = new PointAttachment(this.name);\r\n\t\t\tcopy.x = this.x;\r\n\t\t\tcopy.y = this.y;\r\n\t\t\tcopy.rotation = this.rotation;\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\t\t\treturn copy;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Bone } from \"../Bone\";\r\nimport { TextureRegion } from \"../Texture\";\r\nimport { Color, Utils, ArrayLike } from \"../Utils\";\r\nimport { Attachment } from \"./Attachment\";\r\n\r\n// module spine {\r\n\r\n\t/** An attachment that displays a textured quadrilateral.\r\n\t *\r\n\t * See [Region attachments](http://esotericsoftware.com/spine-regions) in the Spine User Guide. */\r\n\texport class RegionAttachment extends Attachment {\r\n\t\tstatic OX1 = 0;\r\n\t\tstatic OY1 = 1;\r\n\t\tstatic OX2 = 2;\r\n\t\tstatic OY2 = 3;\r\n\t\tstatic OX3 = 4;\r\n\t\tstatic OY3 = 5;\r\n\t\tstatic OX4 = 6;\r\n\t\tstatic OY4 = 7;\r\n\r\n\t\tstatic X1 = 0;\r\n\t\tstatic Y1 = 1;\r\n\t\tstatic C1R = 2;\r\n\t\tstatic C1G = 3;\r\n\t\tstatic C1B = 4;\r\n\t\tstatic C1A = 5;\r\n\t\tstatic U1 = 6;\r\n\t\tstatic V1 = 7;\r\n\r\n\t\tstatic X2 = 8;\r\n\t\tstatic Y2 = 9;\r\n\t\tstatic C2R = 10;\r\n\t\tstatic C2G = 11;\r\n\t\tstatic C2B = 12;\r\n\t\tstatic C2A = 13;\r\n\t\tstatic U2 = 14;\r\n\t\tstatic V2 = 15;\r\n\r\n\t\tstatic X3 = 16;\r\n\t\tstatic Y3 = 17;\r\n\t\tstatic C3R = 18;\r\n\t\tstatic C3G = 19;\r\n\t\tstatic C3B = 20;\r\n\t\tstatic C3A = 21;\r\n\t\tstatic U3 = 22;\r\n\t\tstatic V3 = 23;\r\n\r\n\t\tstatic X4 = 24;\r\n\t\tstatic Y4 = 25;\r\n\t\tstatic C4R = 26;\r\n\t\tstatic C4G = 27;\r\n\t\tstatic C4B = 28;\r\n\t\tstatic C4A = 29;\r\n\t\tstatic U4 = 30;\r\n\t\tstatic V4 = 31;\r\n\r\n\t\t/** The local x translation. */\r\n\t\tx = 0;\r\n\r\n\t\t/** The local y translation. */\r\n\t\ty = 0;\r\n\r\n\t\t/** The local scaleX. */\r\n\t\tscaleX = 1;\r\n\r\n\t\t/** The local scaleY. */\r\n\t\tscaleY = 1;\r\n\r\n\t\t/** The local rotation. */\r\n\t\trotation = 0;\r\n\r\n\t\t/** The width of the region attachment in Spine. */\r\n\t\twidth = 0;\r\n\r\n\t\t/** The height of the region attachment in Spine. */\r\n\t\theight = 0;\r\n\r\n\t\t/** The color to tint the region attachment. */\r\n\t\tcolor = new Color(1, 1, 1, 1);\r\n\r\n\t\t/** The name of the texture region for this attachment. */\r\n\t\tpath: string;\r\n\r\n\t\trendererObject: any;\r\n\t\tregion: TextureRegion;\r\n\r\n\t\t/** For each of the 4 vertices, a pair of <code>x,y</code> values that is the local position of the vertex.\r\n\t\t *\r\n\t\t * See {@link #updateOffset()}. */\r\n\t\toffset = Utils.newFloatArray(8);\r\n\r\n\r\n\t\tuvs = Utils.newFloatArray(8);\r\n\r\n\t\ttempColor = new Color(1, 1, 1, 1);\r\n\r\n\t\tconstructor (name:string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\t/** Calculates the {@link #offset} using the region settings. Must be called after changing region settings. */\r\n\t\tupdateOffset () : void {\r\n\t\t\tlet regionScaleX = this.width / this.region.originalWidth * this.scaleX;\r\n\t\t\tlet regionScaleY = this.height / this.region.originalHeight * this.scaleY;\r\n\t\t\tlet localX = -this.width / 2 * this.scaleX + this.region.offsetX * regionScaleX;\r\n\t\t\tlet localY = -this.height / 2 * this.scaleY + this.region.offsetY * regionScaleY;\r\n\t\t\tlet localX2 = localX + this.region.width * regionScaleX;\r\n\t\t\tlet localY2 = localY + this.region.height * regionScaleY;\r\n\t\t\tlet radians = this.rotation * Math.PI / 180;\r\n\t\t\tlet cos = Math.cos(radians);\r\n\t\t\tlet sin = Math.sin(radians);\r\n\t\t\tlet localXCos = localX * cos + this.x;\r\n\t\t\tlet localXSin = localX * sin;\r\n\t\t\tlet localYCos = localY * cos + this.y;\r\n\t\t\tlet localYSin = localY * sin;\r\n\t\t\tlet localX2Cos = localX2 * cos + this.x;\r\n\t\t\tlet localX2Sin = localX2 * sin;\r\n\t\t\tlet localY2Cos = localY2 * cos + this.y;\r\n\t\t\tlet localY2Sin = localY2 * sin;\r\n\t\t\tlet offset = this.offset;\r\n\t\t\toffset[RegionAttachment.OX1] = localXCos - localYSin;\r\n\t\t\toffset[RegionAttachment.OY1] = localYCos + localXSin;\r\n\t\t\toffset[RegionAttachment.OX2] = localXCos - localY2Sin;\r\n\t\t\toffset[RegionAttachment.OY2] = localY2Cos + localXSin;\r\n\t\t\toffset[RegionAttachment.OX3] = localX2Cos - localY2Sin;\r\n\t\t\toffset[RegionAttachment.OY3] = localY2Cos + localX2Sin;\r\n\t\t\toffset[RegionAttachment.OX4] = localX2Cos - localYSin;\r\n\t\t\toffset[RegionAttachment.OY4] = localYCos + localX2Sin;\r\n\t\t}\r\n\r\n\t\tsetRegion (region: TextureRegion) : void {\r\n\t\t\tthis.region = region;\r\n\t\t\tlet uvs = this.uvs;\r\n\t\t\tif (region.rotate) {\r\n\t\t\t\tuvs[2] = region.u;\r\n\t\t\t\tuvs[3] = region.v2;\r\n\t\t\t\tuvs[4] = region.u;\r\n\t\t\t\tuvs[5] = region.v;\r\n\t\t\t\tuvs[6] = region.u2;\r\n\t\t\t\tuvs[7] = region.v;\r\n\t\t\t\tuvs[0] = region.u2;\r\n\t\t\t\tuvs[1] = region.v2;\r\n\t\t\t} else {\r\n\t\t\t\tuvs[0] = region.u;\r\n\t\t\t\tuvs[1] = region.v2;\r\n\t\t\t\tuvs[2] = region.u;\r\n\t\t\t\tuvs[3] = region.v;\r\n\t\t\t\tuvs[4] = region.u2;\r\n\t\t\t\tuvs[5] = region.v;\r\n\t\t\t\tuvs[6] = region.u2;\r\n\t\t\t\tuvs[7] = region.v2;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Transforms the attachment's four vertices to world coordinates.\r\n\t\t *\r\n\t\t * See [World transforms](http://esotericsoftware.com/spine-runtime-skeletons#World-transforms) in the Spine\r\n\t\t * Runtimes Guide.\r\n\t\t * @param worldVertices The output world vertices. Must have a length >= `offset` + 8.\r\n\t\t * @param offset The `worldVertices` index to begin writing values.\r\n\t\t * @param stride The number of `worldVertices` entries between the value pairs written. */\r\n\t\tcomputeWorldVertices (bone: Bone, worldVertices: ArrayLike<number>, offset: number, stride: number) {\r\n\t\t\tlet vertexOffset = this.offset;\r\n\t\t\tlet x = bone.worldX, y = bone.worldY;\r\n\t\t\tlet a = bone.a, b = bone.b, c = bone.c, d = bone.d;\r\n\t\t\tlet offsetX = 0, offsetY = 0;\r\n\r\n\t\t\toffsetX = vertexOffset[RegionAttachment.OX1];\r\n\t\t\toffsetY = vertexOffset[RegionAttachment.OY1];\r\n\t\t\tworldVertices[offset] = offsetX * a + offsetY * b + x; // br\r\n\t\t\tworldVertices[offset + 1] = offsetX * c + offsetY * d + y;\r\n\t\t\toffset += stride;\r\n\r\n\t\t\toffsetX = vertexOffset[RegionAttachment.OX2];\r\n\t\t\toffsetY = vertexOffset[RegionAttachment.OY2];\r\n\t\t\tworldVertices[offset] = offsetX * a + offsetY * b + x; // bl\r\n\t\t\tworldVertices[offset + 1] = offsetX * c + offsetY * d + y;\r\n\t\t\toffset += stride;\r\n\r\n\t\t\toffsetX = vertexOffset[RegionAttachment.OX3];\r\n\t\t\toffsetY = vertexOffset[RegionAttachment.OY3];\r\n\t\t\tworldVertices[offset] = offsetX * a + offsetY * b + x; // ul\r\n\t\t\tworldVertices[offset + 1] = offsetX * c + offsetY * d + y;\r\n\t\t\toffset += stride;\r\n\r\n\t\t\toffsetX = vertexOffset[RegionAttachment.OX4];\r\n\t\t\toffsetY = vertexOffset[RegionAttachment.OY4];\r\n\t\t\tworldVertices[offset] = offsetX * a + offsetY * b + x; // ur\r\n\t\t\tworldVertices[offset + 1] = offsetX * c + offsetY * d + y;\r\n\t\t}\r\n\r\n\t\tcopy (): Attachment {\r\n\t\t\tlet copy = new RegionAttachment(this.name);\r\n\t\t\tcopy.region = this.region;\r\n\t\t\tcopy.rendererObject = this.rendererObject;\r\n\t\t\tcopy.path = this.path;\r\n\t\t\tcopy.x = this.x;\r\n\t\t\tcopy.y = this.y;\r\n\t\t\tcopy.scaleX = this.scaleX;\r\n\t\t\tcopy.scaleY = this.scaleY;\r\n\t\t\tcopy.rotation = this.rotation;\r\n\t\t\tcopy.width = this.width;\r\n\t\t\tcopy.height = this.height;\r\n\t\t\tUtils.arrayCopy(this.uvs, 0, copy.uvs, 0, 8);\r\n\t\t\tUtils.arrayCopy(this.offset, 0, copy.offset, 0, 8);\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\t\t\treturn copy;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { AttachmentLoader } from \"./attachments/AttachmentLoader\";\r\nimport { BoundingBoxAttachment } from \"./attachments/BoundingBoxAttachment\";\r\nimport { ClippingAttachment } from \"./attachments/ClippingAttachment\";\r\nimport { MeshAttachment } from \"./attachments/MeshAttachment\";\r\nimport { PathAttachment } from \"./attachments/PathAttachment\";\r\nimport { PointAttachment } from \"./attachments/PointAttachment\";\r\nimport { RegionAttachment } from \"./attachments/RegionAttachment\";\r\nimport { Skin } from \"./Skin\";\r\nimport { TextureAtlas } from \"./TextureAtlas\";\r\n\r\n// module spine {\r\n\t/** An {@link AttachmentLoader} that configures attachments using texture regions from an {@link TextureAtlas}.\r\n\t *\r\n\t * See [Loading skeleton data](http://esotericsoftware.com/spine-loading-skeleton-data#JSON-and-binary-data) in the\r\n\t * Spine Runtimes Guide. */\r\n\texport class AtlasAttachmentLoader implements AttachmentLoader {\r\n\t\tatlas: TextureAtlas;\r\n\r\n\t\tconstructor (atlas: TextureAtlas) {\r\n\t\t\tthis.atlas = atlas;\r\n\t\t}\r\n\r\n\t\tnewRegionAttachment (skin: Skin, name: string, path: string): RegionAttachment {\r\n\t\t\tlet region = this.atlas.findRegion(path);\r\n\t\t\tif (region == null) throw new Error(\"Region not found in atlas: \" + path + \" (region attachment: \" + name + \")\");\r\n\t\t\tregion.renderObject = region;\r\n\t\t\tlet attachment = new RegionAttachment(name);\r\n\t\t\tattachment.setRegion(region);\r\n\t\t\treturn attachment;\r\n\t\t}\r\n\r\n\t\tnewMeshAttachment (skin: Skin, name: string, path: string) : MeshAttachment {\r\n\t\t\tlet region = this.atlas.findRegion(path);\r\n\t\t\tif (region == null) throw new Error(\"Region not found in atlas: \" + path + \" (mesh attachment: \" + name + \")\");\r\n\t\t\tregion.renderObject = region;\r\n\t\t\tlet attachment = new MeshAttachment(name);\r\n\t\t\tattachment.region = region;\r\n\t\t\treturn attachment;\r\n\t\t}\r\n\r\n\t\tnewBoundingBoxAttachment (skin: Skin, name: string) : BoundingBoxAttachment {\r\n\t\t\treturn new BoundingBoxAttachment(name);\r\n\t\t}\r\n\r\n\t\tnewPathAttachment (skin: Skin, name: string): PathAttachment {\r\n\t\t\treturn new PathAttachment(name);\r\n\t\t}\r\n\r\n\t\tnewPointAttachment(skin: Skin, name: string): PointAttachment {\r\n\t\t\treturn new PointAttachment(name);\r\n\t\t}\r\n\r\n\t\tnewClippingAttachment(skin: Skin, name: string): ClippingAttachment {\r\n\t\t\treturn new ClippingAttachment(name);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BoneData, TransformMode } from \"./BoneData\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Updatable } from \"./Updatable\";\r\nimport { MathUtils, Vector2 } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores a bone's current pose.\r\n\t *\r\n\t * A bone has a local transform which is used to compute its world transform. A bone also has an applied transform, which is a\r\n\t * local transform that can be applied to compute the world transform. The local transform and applied transform may differ if a\r\n\t * constraint or application code modifies the world transform after it was computed from the local transform. */\r\n\texport class Bone implements Updatable {\r\n\t\t/** The bone's setup pose data. */\r\n\t\tdata: BoneData;\r\n\r\n\t\t/** The skeleton this bone belongs to. */\r\n\t\tskeleton: Skeleton;\r\n\r\n\t\t/** The parent bone, or null if this is the root bone. */\r\n\t\tparent: Bone;\r\n\r\n\t\t/** The immediate children of this bone. */\r\n\t\tchildren = new Array<Bone>();\r\n\r\n\t\t/** The local x translation. */\r\n\t\tx = 0;\r\n\r\n\t\t/** The local y translation. */\r\n\t\ty = 0;\r\n\r\n\t\t/** The local rotation in degrees, counter clockwise. */\r\n\t\trotation = 0;\r\n\r\n\t\t/** The local scaleX. */\r\n\t\tscaleX = 0;\r\n\r\n\t\t/** The local scaleY. */\r\n\t\tscaleY = 0;\r\n\r\n\t\t/** The local shearX. */\r\n\t\tshearX = 0;\r\n\r\n\t\t/** The local shearY. */\r\n\t\tshearY = 0;\r\n\r\n\t\t/** The applied local x translation. */\r\n\t\tax = 0;\r\n\r\n\t\t/** The applied local y translation. */\r\n\t\tay = 0;\r\n\r\n\t\t/** The applied local rotation in degrees, counter clockwise. */\r\n\t\tarotation = 0;\r\n\r\n\t\t/** The applied local scaleX. */\r\n\t\tascaleX = 0;\r\n\r\n\t\t/** The applied local scaleY. */\r\n\t\tascaleY = 0;\r\n\r\n\t\t/** The applied local shearX. */\r\n\t\tashearX = 0;\r\n\r\n\t\t/** The applied local shearY. */\r\n\t\tashearY = 0;\r\n\r\n\t\t/** If true, the applied transform matches the world transform. If false, the world transform has been modified since it was\r\n\t \t* computed and {@link #updateAppliedTransform()} must be called before accessing the applied transform. */\r\n\t\tappliedValid = false;\r\n\r\n\t\t/** Part of the world transform matrix for the X axis. If changed, {@link #appliedValid} should be set to false. */\r\n\t\ta = 0;\r\n\r\n\t\t/** Part of the world transform matrix for the Y axis. If changed, {@link #appliedValid} should be set to false. */\r\n\t\tb = 0;\r\n\r\n\t\t/** Part of the world transform matrix for the X axis. If changed, {@link #appliedValid} should be set to false. */\r\n\t\tc = 0;\r\n\r\n\t\t/** Part of the world transform matrix for the Y axis. If changed, {@link #appliedValid} should be set to false. */\r\n\t\td = 0;\r\n\r\n\t\t/** The world X position. If changed, {@link #appliedValid} should be set to false. */\r\n\t\tworldY = 0;\r\n\r\n\t\t/** The world Y position. If changed, {@link #appliedValid} should be set to false. */\r\n\t\tworldX = 0;\r\n\r\n\t\tsorted = false;\r\n\t\tactive = false;\r\n\r\n\t\t/** @param parent May be null. */\r\n\t\tconstructor (data: BoneData, skeleton: Skeleton, parent: Bone) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\t\t\tthis.data = data;\r\n\t\t\tthis.skeleton = skeleton;\r\n\t\t\tthis.parent = parent;\r\n\t\t\tthis.setToSetupPose();\r\n\t\t}\r\n\r\n\t\t/** Returns false when the bone has not been computed because {@link BoneData#skinRequired} is true and the\r\n\t \t* {@link Skeleton#skin active skin} does not {@link Skin#bones contain} this bone. */\r\n\t\tisActive () {\r\n\t\t\treturn this.active;\r\n\t\t}\r\n\r\n\t\t/** Same as {@link #updateWorldTransform()}. This method exists for Bone to implement {@link Updatable}. */\r\n\t\tupdate () {\r\n\t\t\tthis.updateWorldTransformWith(this.x, this.y, this.rotation, this.scaleX, this.scaleY, this.shearX, this.shearY);\r\n\t\t}\r\n\r\n\t\t/** Computes the world transform using the parent bone and this bone's local transform.\r\n\t\t *\r\n\t\t * See {@link #updateWorldTransformWith()}. */\r\n\t\tupdateWorldTransform () {\r\n\t\t\tthis.updateWorldTransformWith(this.x, this.y, this.rotation, this.scaleX, this.scaleY, this.shearX, this.shearY);\r\n\t\t}\r\n\r\n\t\t/** Computes the world transform using the parent bone and the specified local transform. Child bones are not updated.\r\n\t\t *\r\n\t\t * See [World transforms](http://esotericsoftware.com/spine-runtime-skeletons#World-transforms) in the Spine\r\n\t\t * Runtimes Guide. */\r\n\t\tupdateWorldTransformWith (x: number, y: number, rotation: number, scaleX: number, scaleY: number, shearX: number, shearY: number) {\r\n\t\t\tthis.ax = x;\r\n\t\t\tthis.ay = y;\r\n\t\t\tthis.arotation = rotation;\r\n\t\t\tthis.ascaleX = scaleX;\r\n\t\t\tthis.ascaleY = scaleY;\r\n\t\t\tthis.ashearX = shearX;\r\n\t\t\tthis.ashearY = shearY;\r\n\t\t\tthis.appliedValid = true;\r\n\r\n\t\t\tlet parent = this.parent;\r\n\t\t\tif (parent == null) { // Root bone.\r\n\t\t\t\tlet skeleton = this.skeleton;\r\n\t\t\t\tlet rotationY = rotation + 90 + shearY;\r\n\t\t\t\tlet sx = skeleton.scaleX;\r\n\t\t\t\tlet sy = skeleton.scaleY;\r\n\t\t\t\tthis.a = MathUtils.cosDeg(rotation + shearX) * scaleX * sx;\r\n\t\t\t\tthis.b = MathUtils.cosDeg(rotationY) * scaleY * sx;\r\n\t\t\t\tthis.c = MathUtils.sinDeg(rotation + shearX) * scaleX * sy;\r\n\t\t\t\tthis.d = MathUtils.sinDeg(rotationY) * scaleY * sy;\r\n\t\t\t\tthis.worldX = x * sx + skeleton.x;\r\n\t\t\t\tthis.worldY = y * sy + skeleton.y;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet pa = parent.a, pb = parent.b, pc = parent.c, pd = parent.d;\r\n\t\t\tthis.worldX = pa * x + pb * y + parent.worldX;\r\n\t\t\tthis.worldY = pc * x + pd * y + parent.worldY;\r\n\r\n\t\t\tswitch (this.data.transformMode) {\r\n\t\t\tcase TransformMode.Normal: {\r\n\t\t\t\tlet rotationY = rotation + 90 + shearY;\r\n\t\t\t\tlet la = MathUtils.cosDeg(rotation + shearX) * scaleX;\r\n\t\t\t\tlet lb = MathUtils.cosDeg(rotationY) * scaleY;\r\n\t\t\t\tlet lc = MathUtils.sinDeg(rotation + shearX) * scaleX;\r\n\t\t\t\tlet ld = MathUtils.sinDeg(rotationY) * scaleY;\r\n\t\t\t\tthis.a = pa * la + pb * lc;\r\n\t\t\t\tthis.b = pa * lb + pb * ld;\r\n\t\t\t\tthis.c = pc * la + pd * lc;\r\n\t\t\t\tthis.d = pc * lb + pd * ld;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcase TransformMode.OnlyTranslation: {\r\n\t\t\t\tlet rotationY = rotation + 90 + shearY;\r\n\t\t\t\tthis.a = MathUtils.cosDeg(rotation + shearX) * scaleX;\r\n\t\t\t\tthis.b = MathUtils.cosDeg(rotationY) * scaleY;\r\n\t\t\t\tthis.c = MathUtils.sinDeg(rotation + shearX) * scaleX;\r\n\t\t\t\tthis.d = MathUtils.sinDeg(rotationY) * scaleY;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase TransformMode.NoRotationOrReflection: {\r\n\t\t\t\tlet s = pa * pa + pc * pc;\r\n\t\t\t\tlet prx = 0;\r\n\t\t\t\tif (s > 0.0001) {\r\n\t\t\t\t\ts = Math.abs(pa * pd - pb * pc) / s;\r\n\t\t\t\t\tpb = pc * s;\r\n\t\t\t\t\tpd = pa * s;\r\n\t\t\t\t\tprx = Math.atan2(pc, pa) * MathUtils.radDeg;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpa = 0;\r\n\t\t\t\t\tpc = 0;\r\n\t\t\t\t\tprx = 90 - Math.atan2(pd, pb) * MathUtils.radDeg;\r\n\t\t\t\t}\r\n\t\t\t\tlet rx = rotation + shearX - prx;\r\n\t\t\t\tlet ry = rotation + shearY - prx + 90;\r\n\t\t\t\tlet la = MathUtils.cosDeg(rx) * scaleX;\r\n\t\t\t\tlet lb = MathUtils.cosDeg(ry) * scaleY;\r\n\t\t\t\tlet lc = MathUtils.sinDeg(rx) * scaleX;\r\n\t\t\t\tlet ld = MathUtils.sinDeg(ry) * scaleY;\r\n\t\t\t\tthis.a = pa * la - pb * lc;\r\n\t\t\t\tthis.b = pa * lb - pb * ld;\r\n\t\t\t\tthis.c = pc * la + pd * lc;\r\n\t\t\t\tthis.d = pc * lb + pd * ld;\r\n\r\n\t\t\t\t// HACK!!!\r\n\t\t\t\t// The transform mode specicially says no reflections\r\n\t\t\t\t// But this is the only way for it to look good?\r\n\t\t\t\tthis.a *= Math.sign(this.skeleton.scaleX);\r\n\t\t\t\tthis.b *= Math.sign(this.skeleton.scaleX);\r\n\t\t\t\tthis.c *= Math.sign(this.skeleton.scaleY);\r\n\t\t\t\tthis.d *= Math.sign(this.skeleton.scaleY);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcase TransformMode.NoScale:\r\n\t\t\tcase TransformMode.NoScaleOrReflection: {\r\n\t\t\t\tlet cos = MathUtils.cosDeg(rotation);\r\n\t\t\t\tlet sin = MathUtils.sinDeg(rotation);\r\n\t\t\t\tlet za = (pa * cos + pb * sin) / this.skeleton.scaleX;\r\n\t\t\t\tlet zc = (pc * cos + pd * sin) / this.skeleton.scaleY;\r\n\t\t\t\tlet s = Math.sqrt(za * za + zc * zc);\r\n\t\t\t\tif (s > 0.00001) s = 1 / s;\r\n\t\t\t\tza *= s;\r\n\t\t\t\tzc *= s;\r\n\t\t\t\ts = Math.sqrt(za * za + zc * zc);\r\n\t\t\t\tif (this.data.transformMode == TransformMode.NoScale\r\n\t\t\t\t\t&& (pa * pd - pb * pc < 0) != (this.skeleton.scaleX < 0 != this.skeleton.scaleY < 0)) s = -s;\r\n\t\t\t\tlet r = Math.PI / 2 + Math.atan2(zc, za);\r\n\t\t\t\tlet zb = Math.cos(r) * s;\r\n\t\t\t\tlet zd = Math.sin(r) * s;\r\n\t\t\t\tlet la = MathUtils.cosDeg(shearX) * scaleX;\r\n\t\t\t\tlet lb = MathUtils.cosDeg(90 + shearY) * scaleY;\r\n\t\t\t\tlet lc = MathUtils.sinDeg(shearX) * scaleX;\r\n\t\t\t\tlet ld = MathUtils.sinDeg(90 + shearY) * scaleY;\r\n\t\t\t\tthis.a = za * la + zb * lc;\r\n\t\t\t\tthis.b = za * lb + zb * ld;\r\n\t\t\t\tthis.c = zc * la + zd * lc;\r\n\t\t\t\tthis.d = zc * lb + zd * ld;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.a *= this.skeleton.scaleX;\r\n\t\t\tthis.b *= this.skeleton.scaleX;\r\n\t\t\tthis.c *= this.skeleton.scaleY;\r\n\t\t\tthis.d *= this.skeleton.scaleY;\r\n\t\t}\r\n\r\n\t\t/** Sets this bone's local transform to the setup pose. */\r\n\t\tsetToSetupPose () {\r\n\t\t\tlet data = this.data;\r\n\t\t\tthis.x = data.x;\r\n\t\t\tthis.y = data.y;\r\n\t\t\tthis.rotation = data.rotation;\r\n\t\t\tthis.scaleX = data.scaleX;\r\n\t\t\tthis.scaleY = data.scaleY;\r\n\t\t\tthis.shearX = data.shearX;\r\n\t\t\tthis.shearY = data.shearY;\r\n\t\t}\r\n\r\n\t\t/** The world rotation for the X axis, calculated using {@link #a} and {@link #c}. */\r\n\t\tgetWorldRotationX () {\r\n\t\t\treturn Math.atan2(this.c, this.a) * MathUtils.radDeg;\r\n\t\t}\r\n\r\n\t\t/** The world rotation for the Y axis, calculated using {@link #b} and {@link #d}. */\r\n\t\tgetWorldRotationY () {\r\n\t\t\treturn Math.atan2(this.d, this.b) * MathUtils.radDeg;\r\n\t\t}\r\n\r\n\t\t/** The magnitude (always positive) of the world scale X, calculated using {@link #a} and {@link #c}. */\r\n\t\tgetWorldScaleX () {\r\n\t\t\treturn Math.sqrt(this.a * this.a + this.c * this.c);\r\n\t\t}\r\n\r\n\t\t/** The magnitude (always positive) of the world scale Y, calculated using {@link #b} and {@link #d}. */\r\n\t\tgetWorldScaleY () {\r\n\t\t\treturn Math.sqrt(this.b * this.b + this.d * this.d);\r\n\t\t}\r\n\r\n\t\t/** Computes the applied transform values from the world transform. This allows the applied transform to be accessed after the\r\n\t\t * world transform has been modified (by a constraint, {@link #rotateWorld()}, etc).\r\n\t\t *\r\n\t\t * If {@link #updateWorldTransform()} has been called for a bone and {@link #appliedValid} is false, then\r\n\t\t * {@link #updateAppliedTransform()} must be called before accessing the applied transform.\r\n\t\t *\r\n\t\t * Some information is ambiguous in the world transform, such as -1,-1 scale versus 180 rotation. The applied transform after\r\n\t\t * calling this method is equivalent to the local tranform used to compute the world transform, but may not be identical. */\r\n\t\tupdateAppliedTransform () {\r\n\t\t\tthis.appliedValid = true;\r\n\t\t\tlet parent = this.parent;\r\n\t\t\tif (parent == null) {\r\n\t\t\t\tthis.ax = this.worldX;\r\n\t\t\t\tthis.ay = this.worldY;\r\n\t\t\t\tthis.arotation = Math.atan2(this.c, this.a) * MathUtils.radDeg;\r\n\t\t\t\tthis.ascaleX = Math.sqrt(this.a * this.a + this.c * this.c);\r\n\t\t\t\tthis.ascaleY = Math.sqrt(this.b * this.b + this.d * this.d);\r\n\t\t\t\tthis.ashearX = 0;\r\n\t\t\t\tthis.ashearY = Math.atan2(this.a * this.b + this.c * this.d, this.a * this.d - this.b * this.c) * MathUtils.radDeg;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet pa = parent.a, pb = parent.b, pc = parent.c, pd = parent.d;\r\n\t\t\tlet pid = 1 / (pa * pd - pb * pc);\r\n\t\t\tlet dx = this.worldX - parent.worldX, dy = this.worldY - parent.worldY;\r\n\t\t\tthis.ax = (dx * pd * pid - dy * pb * pid);\r\n\t\t\tthis.ay = (dy * pa * pid - dx * pc * pid);\r\n\t\t\tlet ia = pid * pd;\r\n\t\t\tlet id = pid * pa;\r\n\t\t\tlet ib = pid * pb;\r\n\t\t\tlet ic = pid * pc;\r\n\t\t\tlet ra = ia * this.a - ib * this.c;\r\n\t\t\tlet rb = ia * this.b - ib * this.d;\r\n\t\t\tlet rc = id * this.c - ic * this.a;\r\n\t\t\tlet rd = id * this.d - ic * this.b;\r\n\t\t\tthis.ashearX = 0;\r\n\t\t\tthis.ascaleX = Math.sqrt(ra * ra + rc * rc);\r\n\t\t\tif (this.ascaleX > 0.0001) {\r\n\t\t\t\tlet det = ra * rd - rb * rc;\r\n\t\t\t\tthis.ascaleY = det / this.ascaleX;\r\n\t\t\t\tthis.ashearY = Math.atan2(ra * rb + rc * rd, det) * MathUtils.radDeg;\r\n\t\t\t\tthis.arotation = Math.atan2(rc, ra) * MathUtils.radDeg;\r\n\t\t\t} else {\r\n\t\t\t\tthis.ascaleX = 0;\r\n\t\t\t\tthis.ascaleY = Math.sqrt(rb * rb + rd * rd);\r\n\t\t\t\tthis.ashearY = 0;\r\n\t\t\t\tthis.arotation = 90 - Math.atan2(rd, rb) * MathUtils.radDeg;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Transforms a point from world coordinates to the bone's local coordinates. */\r\n\t\tworldToLocal (world: Vector2) {\r\n\t\t\tlet a = this.a, b = this.b, c = this.c, d = this.d;\r\n\t\t\tlet invDet = 1 / (a * d - b * c);\r\n\t\t\tlet x = world.x - this.worldX, y = world.y - this.worldY;\r\n\t\t\tworld.x = (x * d * invDet - y * b * invDet);\r\n\t\t\tworld.y = (y * a * invDet - x * c * invDet);\r\n\t\t\treturn world;\r\n\t\t}\r\n\r\n\t\t/** Transforms a point from the bone's local coordinates to world coordinates. */\r\n\t\tlocalToWorld (local: Vector2) {\r\n\t\t\tlet x = local.x, y = local.y;\r\n\t\t\tlocal.x = x * this.a + y * this.b + this.worldX;\r\n\t\t\tlocal.y = x * this.c + y * this.d + this.worldY;\r\n\t\t\treturn local;\r\n\t\t}\r\n\r\n\t\t/** Transforms a world rotation to a local rotation. */\r\n\t\tworldToLocalRotation (worldRotation: number) {\r\n\t\t\tlet sin = MathUtils.sinDeg(worldRotation), cos = MathUtils.cosDeg(worldRotation);\r\n\t\t\treturn Math.atan2(this.a * sin - this.c * cos, this.d * cos - this.b * sin) * MathUtils.radDeg + this.rotation - this.shearX;\r\n\t\t}\r\n\r\n\t\t/** Transforms a local rotation to a world rotation. */\r\n\t\tlocalToWorldRotation (localRotation: number) {\r\n\t\t\tlocalRotation -= this.rotation - this.shearX;\r\n\t\t\tlet sin = MathUtils.sinDeg(localRotation), cos = MathUtils.cosDeg(localRotation);\r\n\t\t\treturn Math.atan2(cos * this.c + sin * this.d, cos * this.a + sin * this.b) * MathUtils.radDeg;\r\n\t\t}\r\n\r\n\t\t/** Rotates the world transform the specified amount and sets {@link #appliedValid} to false.\r\n\t\t * {@link #updateWorldTransform()} will need to be called on any child bones, recursively, and any constraints reapplied. */\r\n\t\trotateWorld (degrees: number) {\r\n\t\t\tlet a = this.a, b = this.b, c = this.c, d = this.d;\r\n\t\t\tlet cos = MathUtils.cosDeg(degrees), sin = MathUtils.sinDeg(degrees);\r\n\t\t\tthis.a = cos * a - sin * c;\r\n\t\t\tthis.b = cos * b - sin * d;\r\n\t\t\tthis.c = sin * a + cos * c;\r\n\t\t\tthis.d = sin * b + cos * d;\r\n\t\t\tthis.appliedValid = false;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Bone } from \"./Bone\";\r\nimport { TransformMode } from \"./BoneData\";\r\nimport { IkConstraintData } from \"./IkConstraintData\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Updatable } from \"./Updatable\";\r\nimport { MathUtils } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the current pose for an IK constraint. An IK constraint adjusts the rotation of 1 or 2 constrained bones so the tip of\r\n\t * the last bone is as close to the target bone as possible.\r\n\t *\r\n\t * See [IK constraints](http://esotericsoftware.com/spine-ik-constraints) in the Spine User Guide. */\r\n\texport class IkConstraint implements Updatable {\r\n\t\t/** The IK constraint's setup pose data. */\r\n\t\tdata: IkConstraintData;\r\n\r\n\t\t/** The bones that will be modified by this IK constraint. */\r\n\t\tbones: Array<Bone>;\r\n\r\n\t\t/** The bone that is the IK target. */\r\n\t\ttarget: Bone;\r\n\r\n\t\t/** Controls the bend direction of the IK bones, either 1 or -1. */\r\n\t\tbendDirection = 0;\r\n\r\n\t\t/** When true and only a single bone is being constrained, if the target is too close, the bone is scaled to reach it. */\r\n\t\tcompress = false;\r\n\r\n\t\t/** When true, if the target is out of range, the parent bone is scaled to reach it. If more than one bone is being constrained\r\n\t\t * and the parent bone has local nonuniform scale, stretch is not applied. */\r\n\t\tstretch = false;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained rotations. */\r\n\t\tmix = 1;\r\n\r\n\t\t/** For two bone IK, the distance from the maximum reach of the bones that rotation will slow. */\r\n\t\tsoftness = 0;\r\n\t\tactive = false;\r\n\r\n\t\tconstructor (data: IkConstraintData, skeleton: Skeleton) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\t\t\tthis.data = data;\r\n\t\t\tthis.mix = data.mix;\r\n\t\t\tthis.softness = data.softness;\r\n\t\t\tthis.bendDirection = data.bendDirection;\r\n\t\t\tthis.compress = data.compress;\r\n\t\t\tthis.stretch = data.stretch;\r\n\r\n\t\t\tthis.bones = new Array<Bone>();\r\n\t\t\tfor (let i = 0; i < data.bones.length; i++)\r\n\t\t\t\tthis.bones.push(skeleton.findBone(data.bones[i].name));\r\n\t\t\tthis.target = skeleton.findBone(data.target.name);\r\n\t\t}\r\n\r\n\t\tisActive () {\r\n\t\t\treturn this.active;\r\n\t\t}\r\n\r\n\t\t/** Applies the constraint to the constrained bones. */\r\n\t\tapply () {\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tupdate () {\r\n\t\t\tlet target = this.target;\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tswitch (bones.length) {\r\n\t\t\tcase 1:\r\n\t\t\t\tthis.apply1(bones[0], target.worldX, target.worldY, this.compress, this.stretch, this.data.uniform, this.mix);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tthis.apply2(bones[0], bones[1], target.worldX, target.worldY, this.bendDirection, this.stretch, this.softness, this.mix);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Applies 1 bone IK. The target is specified in the world coordinate system. */\r\n\t\tapply1 (bone: Bone, targetX: number, targetY: number, compress: boolean, stretch: boolean, uniform: boolean, alpha: number) {\r\n\t\t\tif (!bone.appliedValid) bone.updateAppliedTransform();\r\n\t\t\tlet p = bone.parent;\r\n\r\n\t\t\tlet pa = p.a, pb = p.b, pc = p.c, pd = p.d;\r\n\t\t\tlet rotationIK = -bone.ashearX - bone.arotation, tx = 0, ty = 0;\r\n\r\n\t\t\tswitch(bone.data.transformMode) {\r\n\t\t\t\tcase TransformMode.OnlyTranslation:\r\n\t\t\t\t\ttx = targetX - bone.worldX;\r\n\t\t\t\t\tty = targetY - bone.worldY;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TransformMode.NoRotationOrReflection:\r\n\t\t\t\t\trotationIK += Math.atan2(pc, pa) * MathUtils.radDeg;\r\n\t\t\t\t\tlet ps = Math.abs(pa * pd - pb * pc) / (pa * pa + pc * pc);\r\n\t\t\t\t\tpb = -pc * ps;\r\n\t\t\t\t\tpd = pa * ps;\r\n\t\t\t\t\t// Fall through\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tlet x = targetX - p.worldX, y = targetY - p.worldY;\r\n\t\t\t\t\tlet d = pa * pd - pb * pc;\r\n\t\t\t\t\ttx = (x * pd - y * pb) / d - bone.ax;\r\n\t\t\t\t\tty = (y * pa - x * pc) / d - bone.ay;\r\n\t\t\t}\r\n\t\t\trotationIK += Math.atan2(ty, tx) * MathUtils.radDeg;\r\n\t\t\tif (bone.ascaleX < 0) rotationIK += 180;\r\n\t\t\tif (rotationIK > 180)\r\n\t\t\t\trotationIK -= 360;\r\n\t\t\telse if (rotationIK < -180) rotationIK += 360;\r\n\t\t\tlet sx = bone.ascaleX, sy = bone.ascaleY;\r\n\t\t\tif (compress || stretch) {\r\n\t\t\t\tswitch (bone.data.transformMode) {\r\n\t\t\t\t\tcase TransformMode.NoScale:\r\n\t\t\t\t\tcase TransformMode.NoScaleOrReflection:\r\n\t\t\t\t\t\ttx = targetX - bone.worldX;\r\n\t\t\t\t\t\tty = targetY - bone.worldY;\r\n\t\t\t\t}\r\n\t\t\t\tlet b = bone.data.length * sx, dd = Math.sqrt(tx * tx + ty * ty);\r\n\t\t\t\tif ((compress && dd < b) || (stretch && dd > b) && b > 0.0001) {\r\n\t\t\t\t\tlet s = (dd / b - 1) * alpha + 1;\r\n\t\t\t\t\tsx *= s;\r\n\t\t\t\t\tif (uniform) sy *= s;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbone.updateWorldTransformWith(bone.ax, bone.ay, bone.arotation + rotationIK * alpha, sx, sy, bone.ashearX,\r\n\t\t\t\tbone.ashearY);\r\n\t\t}\r\n\r\n\t\t/** Applies 2 bone IK. The target is specified in the world coordinate system.\r\n\t\t * @param child A direct descendant of the parent bone. */\r\n\t\tapply2 (parent: Bone, child: Bone, targetX: number, targetY: number, bendDir: number, stretch: boolean, softness: number, alpha: number) {\r\n\t\t\tif (alpha == 0) {\r\n\t\t\t\tchild.updateWorldTransform();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!parent.appliedValid) parent.updateAppliedTransform();\r\n\t\t\tif (!child.appliedValid) child.updateAppliedTransform();\r\n\t\t\tlet px = parent.ax, py = parent.ay, psx = parent.ascaleX, sx = psx, psy = parent.ascaleY, csx = child.ascaleX;\r\n\t\t\tlet os1 = 0, os2 = 0, s2 = 0;\r\n\t\t\tif (psx < 0) {\r\n\t\t\t\tpsx = -psx;\r\n\t\t\t\tos1 = 180;\r\n\t\t\t\ts2 = -1;\r\n\t\t\t} else {\r\n\t\t\t\tos1 = 0;\r\n\t\t\t\ts2 = 1;\r\n\t\t\t}\r\n\t\t\tif (psy < 0) {\r\n\t\t\t\tpsy = -psy;\r\n\t\t\t\ts2 = -s2;\r\n\t\t\t}\r\n\t\t\tif (csx < 0) {\r\n\t\t\t\tcsx = -csx;\r\n\t\t\t\tos2 = 180;\r\n\t\t\t} else\r\n\t\t\t\tos2 = 0;\r\n\t\t\tlet cx = child.ax, cy = 0, cwx = 0, cwy = 0, a = parent.a, b = parent.b, c = parent.c, d = parent.d;\r\n\t\t\tlet u = Math.abs(psx - psy) <= 0.0001;\r\n\t\t\tif (!u) {\r\n\t\t\t\tcy = 0;\r\n\t\t\t\tcwx = a * cx + parent.worldX;\r\n\t\t\t\tcwy = c * cx + parent.worldY;\r\n\t\t\t} else {\r\n\t\t\t\tcy = child.ay;\r\n\t\t\t\tcwx = a * cx + b * cy + parent.worldX;\r\n\t\t\t\tcwy = c * cx + d * cy + parent.worldY;\r\n\t\t\t}\r\n\t\t\tlet pp = parent.parent;\r\n\t\t\ta = pp.a;\r\n\t\t\tb = pp.b;\r\n\t\t\tc = pp.c;\r\n\t\t\td = pp.d;\r\n\t\t\tlet id = 1 / (a * d - b * c), x = cwx - pp.worldX, y = cwy - pp.worldY;\r\n\t\t\tlet dx = (x * d - y * b) * id - px, dy = (y * a - x * c) * id - py;\r\n\t\t\tlet l1 = Math.sqrt(dx * dx + dy * dy), l2 = child.data.length * csx, a1, a2;\r\n\t\t\tif (l1 < 0.0001) {\r\n\t\t\t\tthis.apply1(parent, targetX, targetY, false, stretch, false, alpha);\r\n\t\t\t\tchild.updateWorldTransformWith(cx, cy, 0, child.ascaleX, child.ascaleY, child.ashearX, child.ashearY);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tx = targetX - pp.worldX;\r\n\t\t\ty = targetY - pp.worldY;\r\n\t\t\tlet tx = (x * d - y * b) * id - px, ty = (y * a - x * c) * id - py;\r\n\t\t\tlet dd = tx * tx + ty * ty;\r\n\t\t\tif (softness != 0) {\r\n\t\t\t\tsoftness *= psx * (csx + 1) / 2;\r\n\t\t\t\tlet td = Math.sqrt(dd), sd = td - l1 - l2 * psx + softness;\r\n\t\t\t\tif (sd > 0) {\r\n\t\t\t\t\tlet p = Math.min(1, sd / (softness * 2)) - 1;\r\n\t\t\t\t\tp = (sd - softness * (1 - p * p)) / td;\r\n\t\t\t\t\ttx -= p * tx;\r\n\t\t\t\t\tty -= p * ty;\r\n\t\t\t\t\tdd = tx * tx + ty * ty;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\touter:\r\n\t\t\tif (u) {\r\n\t\t\t\tl2 *= psx;\r\n\t\t\t\tlet cos = (dd - l1 * l1 - l2 * l2) / (2 * l1 * l2);\r\n\t\t\t\tif (cos < -1)\r\n\t\t\t\t\tcos = -1;\r\n\t\t\t\telse if (cos > 1) {\r\n\t\t\t\t\tcos = 1;\r\n\t\t\t\t\tif (stretch) sx *= (Math.sqrt(dd) / (l1 + l2) - 1) * alpha + 1;\r\n\t\t\t\t}\r\n\t\t\t\ta2 = Math.acos(cos) * bendDir;\r\n\t\t\t\ta = l1 + l2 * cos;\r\n\t\t\t\tb = l2 * Math.sin(a2);\r\n\t\t\t\ta1 = Math.atan2(ty * a - tx * b, tx * a + ty * b);\r\n\t\t\t} else {\r\n\t\t\t\ta = psx * l2;\r\n\t\t\t\tb = psy * l2;\r\n\t\t\t\tlet aa = a * a, bb = b * b, ta = Math.atan2(ty, tx);\r\n\t\t\t\tc = bb * l1 * l1 + aa * dd - aa * bb;\r\n\t\t\t\tlet c1 = -2 * bb * l1, c2 = bb - aa;\r\n\t\t\t\td = c1 * c1 - 4 * c2 * c;\r\n\t\t\t\tif (d >= 0) {\r\n\t\t\t\t\tlet q = Math.sqrt(d);\r\n\t\t\t\t\tif (c1 < 0) q = -q;\r\n\t\t\t\t\tq = -(c1 + q) / 2;\r\n\t\t\t\t\tlet r0 = q / c2, r1 = c / q;\r\n\t\t\t\t\tlet r = Math.abs(r0) < Math.abs(r1) ? r0 : r1;\r\n\t\t\t\t\tif (r * r <= dd) {\r\n\t\t\t\t\t\ty = Math.sqrt(dd - r * r) * bendDir;\r\n\t\t\t\t\t\ta1 = ta - Math.atan2(y, r);\r\n\t\t\t\t\t\ta2 = Math.atan2(y / psy, (r - l1) / psx);\r\n\t\t\t\t\t\tbreak outer;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet minAngle = MathUtils.PI, minX = l1 - a, minDist = minX * minX, minY = 0;\r\n\t\t\t\tlet maxAngle = 0, maxX = l1 + a, maxDist = maxX * maxX, maxY = 0;\r\n\t\t\t\tc = -a * l1 / (aa - bb);\r\n\t\t\t\tif (c >= -1 && c <= 1) {\r\n\t\t\t\t\tc = Math.acos(c);\r\n\t\t\t\t\tx = a * Math.cos(c) + l1;\r\n\t\t\t\t\ty = b * Math.sin(c);\r\n\t\t\t\t\td = x * x + y * y;\r\n\t\t\t\t\tif (d < minDist) {\r\n\t\t\t\t\t\tminAngle = c;\r\n\t\t\t\t\t\tminDist = d;\r\n\t\t\t\t\t\tminX = x;\r\n\t\t\t\t\t\tminY = y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (d > maxDist) {\r\n\t\t\t\t\t\tmaxAngle = c;\r\n\t\t\t\t\t\tmaxDist = d;\r\n\t\t\t\t\t\tmaxX = x;\r\n\t\t\t\t\t\tmaxY = y;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (dd <= (minDist + maxDist) / 2) {\r\n\t\t\t\t\ta1 = ta - Math.atan2(minY * bendDir, minX);\r\n\t\t\t\t\ta2 = minAngle * bendDir;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ta1 = ta - Math.atan2(maxY * bendDir, maxX);\r\n\t\t\t\t\ta2 = maxAngle * bendDir;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet os = Math.atan2(cy, cx) * s2;\r\n\t\t\tlet rotation = parent.arotation;\r\n\t\t\ta1 = (a1 - os) * MathUtils.radDeg + os1 - rotation;\r\n\t\t\tif (a1 > 180)\r\n\t\t\t\ta1 -= 360;\r\n\t\t\telse if (a1 < -180) a1 += 360;\r\n\t\t\tparent.updateWorldTransformWith(px, py, rotation + a1 * alpha, sx, parent.ascaleY, 0, 0);\r\n\t\t\trotation = child.arotation;\r\n\t\t\ta2 = ((a2 + os) * MathUtils.radDeg - child.ashearX) * s2 + os2 - rotation;\r\n\t\t\tif (a2 > 180)\r\n\t\t\t\ta2 -= 360;\r\n\t\t\telse if (a2 < -180) a2 += 360;\r\n\t\t\tchild.updateWorldTransformWith(cx, cy, rotation + a2 * alpha, child.ascaleX, child.ascaleY, child.ashearX, child.ashearY);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\n// module spine {\r\n\t/** The base class for all constraint datas. */\r\n\texport abstract class ConstraintData {\r\n\t\tconstructor(public name: string, public order: number, public skinRequired: boolean) { }\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { PathAttachment } from \"./attachments/PathAttachment\";\r\nimport { Bone } from \"./Bone\";\r\nimport { PathConstraintData, SpacingMode, RotateMode, PositionMode } from \"./PathConstraintData\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Slot } from \"./Slot\";\r\nimport { Updatable } from \"./Updatable\";\r\nimport { Utils, MathUtils } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the current pose for a path constraint. A path constraint adjusts the rotation, translation, and scale of the\r\n\t * constrained bones so they follow a {@link PathAttachment}.\r\n\t *\r\n\t * See [Path constraints](http://esotericsoftware.com/spine-path-constraints) in the Spine User Guide. */\r\n\texport class PathConstraint implements Updatable {\r\n\t\tstatic NONE = -1; static BEFORE = -2; static AFTER = -3;\r\n\t\tstatic epsilon = 0.00001;\r\n\r\n\t\t/** The path constraint's setup pose data. */\r\n\t\tdata: PathConstraintData;\r\n\r\n\t\t/** The bones that will be modified by this path constraint. */\r\n\t\tbones: Array<Bone>;\r\n\r\n\t\t/** The slot whose path attachment will be used to constrained the bones. */\r\n\t\ttarget: Slot;\r\n\r\n\t\t/** The position along the path. */\r\n\t\tposition = 0;\r\n\r\n\t\t/** The spacing between bones. */\r\n\t\tspacing = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained rotations. */\r\n\t\trotateMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained translations. */\r\n\t\ttranslateMix = 0;\r\n\r\n\t\tspaces = new Array<number>(); positions = new Array<number>();\r\n\t\tworld = new Array<number>(); curves = new Array<number>(); lengths = new Array<number>();\r\n\t\tsegments = new Array<number>();\r\n\r\n\t\tactive = false;\r\n\r\n\t\tconstructor (data: PathConstraintData, skeleton: Skeleton) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\t\t\tthis.data = data;\r\n\t\t\tthis.bones = new Array<Bone>();\r\n\t\t\tfor (let i = 0, n = data.bones.length; i < n; i++)\r\n\t\t\t\tthis.bones.push(skeleton.findBone(data.bones[i].name));\r\n\t\t\tthis.target = skeleton.findSlot(data.target.name);\r\n\t\t\tthis.position = data.position;\r\n\t\t\tthis.spacing = data.spacing;\r\n\t\t\tthis.rotateMix = data.rotateMix;\r\n\t\t\tthis.translateMix = data.translateMix;\r\n\t\t}\r\n\r\n\t\tisActive () {\r\n\t\t\treturn this.active;\r\n\t\t}\r\n\r\n\t\t/** Applies the constraint to the constrained bones. */\r\n\t\tapply () {\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tupdate () {\r\n\t\t\tlet attachment = this.target.getAttachment();\r\n\t\t\tif (!(attachment instanceof PathAttachment)) return;\r\n\r\n\t\t\tlet rotateMix = this.rotateMix, translateMix = this.translateMix;\r\n\t\t\tlet translate = translateMix > 0, rotate = rotateMix > 0;\r\n\t\t\tif (!translate && !rotate) return;\r\n\r\n\t\t\tlet data = this.data;\r\n\t\t\tlet percentSpacing = data.spacingMode == SpacingMode.Percent;\r\n\t\t\tlet rotateMode = data.rotateMode;\r\n\t\t\tlet tangents = rotateMode == RotateMode.Tangent, scale = rotateMode == RotateMode.ChainScale;\r\n\t\t\tlet boneCount = this.bones.length, spacesCount = tangents ? boneCount : boneCount + 1;\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tlet spaces = Utils.setArraySize(this.spaces, spacesCount), lengths: Array<number> = null;\r\n\t\t\tlet spacing = this.spacing;\r\n\t\t\tif (scale || !percentSpacing) {\r\n\t\t\t\tif (scale) lengths = Utils.setArraySize(this.lengths, boneCount);\r\n\t\t\t\tlet lengthSpacing = data.spacingMode == SpacingMode.Length;\r\n\t\t\t\tfor (let i = 0, n = spacesCount - 1; i < n;) {\r\n\t\t\t\t\tlet bone = bones[i];\r\n\t\t\t\t\tlet setupLength = bone.data.length;\r\n\t\t\t\t\tif (setupLength < PathConstraint.epsilon) {\r\n\t\t\t\t\t\tif (scale) lengths[i] = 0;\r\n\t\t\t\t\t\tspaces[++i] = 0;\r\n\t\t\t\t\t} else if (percentSpacing) {\r\n\t\t\t\t\t\tif (scale) {\r\n\t\t\t\t\t\t\tlet x = setupLength * bone.a, y = setupLength * bone.c;\r\n\t\t\t\t\t\t\tlet length = Math.sqrt(x * x + y * y);\r\n\t\t\t\t\t\t\tlengths[i] = length;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tspaces[++i] = spacing;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet x = setupLength * bone.a, y = setupLength * bone.c;\r\n\t\t\t\t\t\tlet length = Math.sqrt(x * x + y * y);\r\n\t\t\t\t\t\tif (scale) lengths[i] = length;\r\n\t\t\t\t\t\tspaces[++i] = (lengthSpacing ? setupLength + spacing : spacing) * length / setupLength;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (let i = 1; i < spacesCount; i++)\r\n\t\t\t\t\tspaces[i] = spacing;\r\n\t\t\t}\r\n\r\n\t\t\tlet positions = this.computeWorldPositions(<PathAttachment>attachment, spacesCount, tangents,\r\n\t\t\t\tdata.positionMode == PositionMode.Percent, percentSpacing);\r\n\t\t\tlet boneX = positions[0], boneY = positions[1], offsetRotation = data.offsetRotation;\r\n\t\t\tlet tip = false;\r\n\t\t\tif (offsetRotation == 0)\r\n\t\t\t\ttip = rotateMode == RotateMode.Chain;\r\n\t\t\telse {\r\n\t\t\t\ttip = false;\r\n\t\t\t\tlet p = this.target.bone;\r\n\t\t\t\toffsetRotation *= p.a * p.d - p.b * p.c > 0 ? MathUtils.degRad : -MathUtils.degRad;\r\n\t\t\t}\r\n\t\t\tfor (let i = 0, p = 3; i < boneCount; i++, p += 3) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tbone.worldX += (boneX - bone.worldX) * translateMix;\r\n\t\t\t\tbone.worldY += (boneY - bone.worldY) * translateMix;\r\n\t\t\t\tlet x = positions[p], y = positions[p + 1], dx = x - boneX, dy = y - boneY;\r\n\t\t\t\tif (scale) {\r\n\t\t\t\t\tlet length = lengths[i];\r\n\t\t\t\t\tif (length != 0) {\r\n\t\t\t\t\t\tlet s = (Math.sqrt(dx * dx + dy * dy) / length - 1) * rotateMix + 1;\r\n\t\t\t\t\t\tbone.a *= s;\r\n\t\t\t\t\t\tbone.c *= s;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tboneX = x;\r\n\t\t\t\tboneY = y;\r\n\t\t\t\tif (rotate) {\r\n\t\t\t\t\tlet a = bone.a, b = bone.b, c = bone.c, d = bone.d, r = 0, cos = 0, sin = 0;\r\n\t\t\t\t\tif (tangents)\r\n\t\t\t\t\t\tr = positions[p - 1];\r\n\t\t\t\t\telse if (spaces[i + 1] == 0)\r\n\t\t\t\t\t\tr = positions[p + 2];\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tr = Math.atan2(dy, dx);\r\n\t\t\t\t\tr -= Math.atan2(c, a);\r\n\t\t\t\t\tif (tip) {\r\n\t\t\t\t\t\tcos = Math.cos(r);\r\n\t\t\t\t\t\tsin = Math.sin(r);\r\n\t\t\t\t\t\tlet length = bone.data.length;\r\n\t\t\t\t\t\tboneX += (length * (cos * a - sin * c) - dx) * rotateMix;\r\n\t\t\t\t\t\tboneY += (length * (sin * a + cos * c) - dy) * rotateMix;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tr += offsetRotation;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (r > MathUtils.PI)\r\n\t\t\t\t\t\tr -= MathUtils.PI2;\r\n\t\t\t\t\telse if (r < -MathUtils.PI) //\r\n\t\t\t\t\t\tr += MathUtils.PI2;\r\n\t\t\t\t\tr *= rotateMix;\r\n\t\t\t\t\tcos = Math.cos(r);\r\n\t\t\t\t\tsin = Math.sin(r);\r\n\t\t\t\t\tbone.a = cos * a - sin * c;\r\n\t\t\t\t\tbone.b = cos * b - sin * d;\r\n\t\t\t\t\tbone.c = sin * a + cos * c;\r\n\t\t\t\t\tbone.d = sin * b + cos * d;\r\n\t\t\t\t}\r\n\t\t\t\tbone.appliedValid = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcomputeWorldPositions (path: PathAttachment, spacesCount: number, tangents: boolean, percentPosition: boolean,\r\n\t\t\tpercentSpacing: boolean) {\r\n\t\t\tlet target = this.target;\r\n\t\t\tlet position = this.position;\r\n\t\t\tlet spaces = this.spaces, out = Utils.setArraySize(this.positions, spacesCount * 3 + 2), world: Array<number> = null;\r\n\t\t\tlet closed = path.closed;\r\n\t\t\tlet verticesLength = path.worldVerticesLength, curveCount = verticesLength / 6, prevCurve = PathConstraint.NONE;\r\n\r\n\t\t\tif (!path.constantSpeed) {\r\n\t\t\t\tlet lengths = path.lengths;\r\n\t\t\t\tcurveCount -= closed ? 1 : 2;\r\n\t\t\t\tlet pathLength = lengths[curveCount];\r\n\t\t\t\tif (percentPosition) position *= pathLength;\r\n\t\t\t\tif (percentSpacing) {\r\n\t\t\t\t\tfor (let i = 1; i < spacesCount; i++)\r\n\t\t\t\t\t\tspaces[i] *= pathLength;\r\n\t\t\t\t}\r\n\t\t\t\tworld = Utils.setArraySize(this.world, 8);\r\n\t\t\t\tfor (let i = 0, o = 0, curve = 0; i < spacesCount; i++, o += 3) {\r\n\t\t\t\t\tlet space = spaces[i];\r\n\t\t\t\t\tposition += space;\r\n\t\t\t\t\tlet p = position;\r\n\r\n\t\t\t\t\tif (closed) {\r\n\t\t\t\t\t\tp %= pathLength;\r\n\t\t\t\t\t\tif (p < 0) p += pathLength;\r\n\t\t\t\t\t\tcurve = 0;\r\n\t\t\t\t\t} else if (p < 0) {\r\n\t\t\t\t\t\tif (prevCurve != PathConstraint.BEFORE) {\r\n\t\t\t\t\t\t\tprevCurve = PathConstraint.BEFORE;\r\n\t\t\t\t\t\t\tpath.computeWorldVertices(target, 2, 4, world, 0, 2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.addBeforePosition(p, world, 0, out, o);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else if (p > pathLength) {\r\n\t\t\t\t\t\tif (prevCurve != PathConstraint.AFTER) {\r\n\t\t\t\t\t\t\tprevCurve = PathConstraint.AFTER;\r\n\t\t\t\t\t\t\tpath.computeWorldVertices(target, verticesLength - 6, 4, world, 0, 2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.addAfterPosition(p - pathLength, world, 0, out, o);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Determine curve containing position.\r\n\t\t\t\t\tfor (;; curve++) {\r\n\t\t\t\t\t\tlet length = lengths[curve];\r\n\t\t\t\t\t\tif (p > length) continue;\r\n\t\t\t\t\t\tif (curve == 0)\r\n\t\t\t\t\t\t\tp /= length;\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tlet prev = lengths[curve - 1];\r\n\t\t\t\t\t\t\tp = (p - prev) / (length - prev);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (curve != prevCurve) {\r\n\t\t\t\t\t\tprevCurve = curve;\r\n\t\t\t\t\t\tif (closed && curve == curveCount) {\r\n\t\t\t\t\t\t\tpath.computeWorldVertices(target, verticesLength - 4, 4, world, 0, 2);\r\n\t\t\t\t\t\t\tpath.computeWorldVertices(target, 0, 4, world, 4, 2);\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tpath.computeWorldVertices(target, curve * 6 + 2, 8, world, 0, 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.addCurvePosition(p, world[0], world[1], world[2], world[3], world[4], world[5], world[6], world[7], out, o,\r\n\t\t\t\t\t\ttangents || (i > 0 && space == 0));\r\n\t\t\t\t}\r\n\t\t\t\treturn out;\r\n\t\t\t}\r\n\r\n\t\t\t// World vertices.\r\n\t\t\tif (closed) {\r\n\t\t\t\tverticesLength += 2;\r\n\t\t\t\tworld = Utils.setArraySize(this.world, verticesLength);\r\n\t\t\t\tpath.computeWorldVertices(target, 2, verticesLength - 4, world, 0, 2);\r\n\t\t\t\tpath.computeWorldVertices(target, 0, 2, world, verticesLength - 4, 2);\r\n\t\t\t\tworld[verticesLength - 2] = world[0];\r\n\t\t\t\tworld[verticesLength - 1] = world[1];\r\n\t\t\t} else {\r\n\t\t\t\tcurveCount--;\r\n\t\t\t\tverticesLength -= 4;\r\n\t\t\t\tworld = Utils.setArraySize(this.world, verticesLength);\r\n\t\t\t\tpath.computeWorldVertices(target, 2, verticesLength, world, 0, 2);\r\n\t\t\t}\r\n\r\n\t\t\t// Curve lengths.\r\n\t\t\tlet curves = Utils.setArraySize(this.curves, curveCount);\r\n\t\t\tlet pathLength = 0;\r\n\t\t\tlet x1 = world[0], y1 = world[1], cx1 = 0, cy1 = 0, cx2 = 0, cy2 = 0, x2 = 0, y2 = 0;\r\n\t\t\tlet tmpx = 0, tmpy = 0, dddfx = 0, dddfy = 0, ddfx = 0, ddfy = 0, dfx = 0, dfy = 0;\r\n\t\t\tfor (let i = 0, w = 2; i < curveCount; i++, w += 6) {\r\n\t\t\t\tcx1 = world[w];\r\n\t\t\t\tcy1 = world[w + 1];\r\n\t\t\t\tcx2 = world[w + 2];\r\n\t\t\t\tcy2 = world[w + 3];\r\n\t\t\t\tx2 = world[w + 4];\r\n\t\t\t\ty2 = world[w + 5];\r\n\t\t\t\ttmpx = (x1 - cx1 * 2 + cx2) * 0.1875;\r\n\t\t\t\ttmpy = (y1 - cy1 * 2 + cy2) * 0.1875;\r\n\t\t\t\tdddfx = ((cx1 - cx2) * 3 - x1 + x2) * 0.09375;\r\n\t\t\t\tdddfy = ((cy1 - cy2) * 3 - y1 + y2) * 0.09375;\r\n\t\t\t\tddfx = tmpx * 2 + dddfx;\r\n\t\t\t\tddfy = tmpy * 2 + dddfy;\r\n\t\t\t\tdfx = (cx1 - x1) * 0.75 + tmpx + dddfx * 0.16666667;\r\n\t\t\t\tdfy = (cy1 - y1) * 0.75 + tmpy + dddfy * 0.16666667;\r\n\t\t\t\tpathLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\tdfx += ddfx;\r\n\t\t\t\tdfy += ddfy;\r\n\t\t\t\tddfx += dddfx;\r\n\t\t\t\tddfy += dddfy;\r\n\t\t\t\tpathLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\tdfx += ddfx;\r\n\t\t\t\tdfy += ddfy;\r\n\t\t\t\tpathLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\tdfx += ddfx + dddfx;\r\n\t\t\t\tdfy += ddfy + dddfy;\r\n\t\t\t\tpathLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\tcurves[i] = pathLength;\r\n\t\t\t\tx1 = x2;\r\n\t\t\t\ty1 = y2;\r\n\t\t\t}\r\n\t\t\tif (percentPosition)\r\n\t\t\t\tposition *= pathLength;\r\n\t\t\telse\r\n\t\t\t\tposition *= pathLength / path.lengths[curveCount - 1];\r\n\t\t\tif (percentSpacing) {\r\n\t\t\t\tfor (let i = 1; i < spacesCount; i++)\r\n\t\t\t\t\tspaces[i] *= pathLength;\r\n\t\t\t}\r\n\r\n\t\t\tlet segments = this.segments;\r\n\t\t\tlet curveLength = 0;\r\n\t\t\tfor (let i = 0, o = 0, curve = 0, segment = 0; i < spacesCount; i++, o += 3) {\r\n\t\t\t\tlet space = spaces[i];\r\n\t\t\t\tposition += space;\r\n\t\t\t\tlet p = position;\r\n\r\n\t\t\t\tif (closed) {\r\n\t\t\t\t\tp %= pathLength;\r\n\t\t\t\t\tif (p < 0) p += pathLength;\r\n\t\t\t\t\tcurve = 0;\r\n\t\t\t\t} else if (p < 0) {\r\n\t\t\t\t\tthis.addBeforePosition(p, world, 0, out, o);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else if (p > pathLength) {\r\n\t\t\t\t\tthis.addAfterPosition(p - pathLength, world, verticesLength - 4, out, o);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Determine curve containing position.\r\n\t\t\t\tfor (;; curve++) {\r\n\t\t\t\t\tlet length = curves[curve];\r\n\t\t\t\t\tif (p > length) continue;\r\n\t\t\t\t\tif (curve == 0)\r\n\t\t\t\t\t\tp /= length;\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlet prev = curves[curve - 1];\r\n\t\t\t\t\t\tp = (p - prev) / (length - prev);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Curve segment lengths.\r\n\t\t\t\tif (curve != prevCurve) {\r\n\t\t\t\t\tprevCurve = curve;\r\n\t\t\t\t\tlet ii = curve * 6;\r\n\t\t\t\t\tx1 = world[ii];\r\n\t\t\t\t\ty1 = world[ii + 1];\r\n\t\t\t\t\tcx1 = world[ii + 2];\r\n\t\t\t\t\tcy1 = world[ii + 3];\r\n\t\t\t\t\tcx2 = world[ii + 4];\r\n\t\t\t\t\tcy2 = world[ii + 5];\r\n\t\t\t\t\tx2 = world[ii + 6];\r\n\t\t\t\t\ty2 = world[ii + 7];\r\n\t\t\t\t\ttmpx = (x1 - cx1 * 2 + cx2) * 0.03;\r\n\t\t\t\t\ttmpy = (y1 - cy1 * 2 + cy2) * 0.03;\r\n\t\t\t\t\tdddfx = ((cx1 - cx2) * 3 - x1 + x2) * 0.006;\r\n\t\t\t\t\tdddfy = ((cy1 - cy2) * 3 - y1 + y2) * 0.006;\r\n\t\t\t\t\tddfx = tmpx * 2 + dddfx;\r\n\t\t\t\t\tddfy = tmpy * 2 + dddfy;\r\n\t\t\t\t\tdfx = (cx1 - x1) * 0.3 + tmpx + dddfx * 0.16666667;\r\n\t\t\t\t\tdfy = (cy1 - y1) * 0.3 + tmpy + dddfy * 0.16666667;\r\n\t\t\t\t\tcurveLength = Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\t\tsegments[0] = curveLength;\r\n\t\t\t\t\tfor (ii = 1; ii < 8; ii++) {\r\n\t\t\t\t\t\tdfx += ddfx;\r\n\t\t\t\t\t\tdfy += ddfy;\r\n\t\t\t\t\t\tddfx += dddfx;\r\n\t\t\t\t\t\tddfy += dddfy;\r\n\t\t\t\t\t\tcurveLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\t\t\tsegments[ii] = curveLength;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdfx += ddfx;\r\n\t\t\t\t\tdfy += ddfy;\r\n\t\t\t\t\tcurveLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\t\tsegments[8] = curveLength;\r\n\t\t\t\t\tdfx += ddfx + dddfx;\r\n\t\t\t\t\tdfy += ddfy + dddfy;\r\n\t\t\t\t\tcurveLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\t\tsegments[9] = curveLength;\r\n\t\t\t\t\tsegment = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Weight by segment length.\r\n\t\t\t\tp *= curveLength;\r\n\t\t\t\tfor (;; segment++) {\r\n\t\t\t\t\tlet length = segments[segment];\r\n\t\t\t\t\tif (p > length) continue;\r\n\t\t\t\t\tif (segment == 0)\r\n\t\t\t\t\t\tp /= length;\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlet prev = segments[segment - 1];\r\n\t\t\t\t\t\tp = segment + (p - prev) / (length - prev);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis.addCurvePosition(p * 0.1, x1, y1, cx1, cy1, cx2, cy2, x2, y2, out, o, tangents || (i > 0 && space == 0));\r\n\t\t\t}\r\n\t\t\treturn out;\r\n\t\t}\r\n\r\n\t\taddBeforePosition (p: number, temp: Array<number>, i: number, out: Array<number>, o: number) {\r\n\t\t\tlet x1 = temp[i], y1 = temp[i + 1], dx = temp[i + 2] - x1, dy = temp[i + 3] - y1, r = Math.atan2(dy, dx);\r\n\t\t\tout[o] = x1 + p * Math.cos(r);\r\n\t\t\tout[o + 1] = y1 + p * Math.sin(r);\r\n\t\t\tout[o + 2] = r;\r\n\t\t}\r\n\r\n\t\taddAfterPosition (p: number, temp: Array<number>, i: number, out: Array<number>, o: number) {\r\n\t\t\tlet x1 = temp[i + 2], y1 = temp[i + 3], dx = x1 - temp[i], dy = y1 - temp[i + 1], r = Math.atan2(dy, dx);\r\n\t\t\tout[o] = x1 + p * Math.cos(r);\r\n\t\t\tout[o + 1] = y1 + p * Math.sin(r);\r\n\t\t\tout[o + 2] = r;\r\n\t\t}\r\n\r\n\t\taddCurvePosition (p: number, x1: number, y1: number, cx1: number, cy1: number, cx2: number, cy2: number, x2: number, y2: number,\r\n\t\t\tout: Array<number>, o: number, tangents: boolean) {\r\n\t\t\tif (p == 0 || isNaN(p)) {\r\n\t\t\t\tout[o] = x1;\r\n\t\t\t\tout[o + 1] = y1;\r\n\t\t\t\tout[o + 2] = Math.atan2(cy1 - y1, cx1 - x1);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet tt = p * p, ttt = tt * p, u = 1 - p, uu = u * u, uuu = uu * u;\r\n\t\t\tlet ut = u * p, ut3 = ut * 3, uut3 = u * ut3, utt3 = ut3 * p;\r\n\t\t\tlet x = x1 * uuu + cx1 * uut3 + cx2 * utt3 + x2 * ttt, y = y1 * uuu + cy1 * uut3 + cy2 * utt3 + y2 * ttt;\r\n\t\t\tout[o] = x;\r\n\t\t\tout[o + 1] = y;\r\n\t\t\tif (tangents) {\r\n\t\t\t\tif (p < 0.001)\r\n\t\t\t\t\tout[o + 2] = Math.atan2(cy1 - y1, cx1 - x1);\r\n\t\t\t\telse\r\n\t\t\t\t\tout[o + 2] = Math.atan2(y - (y1 * uu + cy1 * ut * 2 + cy2 * tt), x - (x1 * uu + cx1 * ut * 2 + cx2 * tt));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Attachment } from \"./attachments/Attachment\";\r\nimport { Bone } from \"./Bone\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { SlotData } from \"./SlotData\";\r\nimport { Color } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores a slot's current pose. Slots organize attachments for {@link Skeleton#drawOrder} purposes and provide a place to store\r\n\t * state for an attachment. State cannot be stored in an attachment itself because attachments are stateless and may be shared\r\n\t * across multiple skeletons. */\r\n\texport class Slot {\r\n\t\t/** The slot's setup pose data. */\r\n\t\tdata: SlotData;\r\n\r\n\t\t/** The bone this slot belongs to. */\r\n\t\tbone: Bone;\r\n\r\n\t\t/** The color used to tint the slot's attachment. If {@link #getDarkColor()} is set, this is used as the light color for two\r\n\t\t * color tinting. */\r\n\t\tcolor: Color;\r\n\r\n\t\t/** The dark color used to tint the slot's attachment for two color tinting, or null if two color tinting is not used. The dark\r\n\t\t * color's alpha is not used. */\r\n\t\tdarkColor: Color;\r\n\r\n\t\tattachment: Attachment;\r\n\r\n\t\tprivate attachmentTime: number;\r\n\r\n\t\tattachmentState: number;\r\n\r\n\t\t/** Values to deform the slot's attachment. For an unweighted mesh, the entries are local positions for each vertex. For a\r\n\t\t * weighted mesh, the entries are an offset for each vertex which will be added to the mesh's local vertex positions.\r\n\t\t *\r\n\t\t * See {@link VertexAttachment#computeWorldVertices()} and {@link DeformTimeline}. */\r\n\t\tdeform = new Array<number>();\r\n\r\n\t\tconstructor (data: SlotData, bone: Bone) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tif (bone == null) throw new Error(\"bone cannot be null.\");\r\n\t\t\tthis.data = data;\r\n\t\t\tthis.bone = bone;\r\n\t\t\tthis.color = new Color();\r\n\t\t\tthis.darkColor = data.darkColor == null ? null : new Color();\r\n\t\t\tthis.setToSetupPose();\r\n\t\t}\r\n\r\n\t\t/** The skeleton this slot belongs to. */\r\n\t\tgetSkeleton (): Skeleton {\r\n\t\t\treturn this.bone.skeleton;\r\n\t\t}\r\n\r\n\t\t/** The current attachment for the slot, or null if the slot has no attachment. */\r\n\t\tgetAttachment (): Attachment {\r\n\t\t\treturn this.attachment;\r\n\t\t}\r\n\r\n\t\t/** Sets the slot's attachment and, if the attachment changed, resets {@link #attachmentTime} and clears {@link #deform}.\r\n\t\t * @param attachment May be null. */\r\n\t\tsetAttachment (attachment: Attachment) {\r\n\t\t\tif (this.attachment == attachment) return;\r\n\t\t\tthis.attachment = attachment;\r\n\t\t\tthis.attachmentTime = this.bone.skeleton.time;\r\n\t\t\tthis.deform.length = 0;\r\n\t\t}\r\n\r\n\t\tsetAttachmentTime (time: number) {\r\n\t\t\tthis.attachmentTime = this.bone.skeleton.time - time;\r\n\t\t}\r\n\r\n\t\t/** The time that has elapsed since the last time the attachment was set or cleared. Relies on Skeleton\r\n\t\t * {@link Skeleton#time}. */\r\n\t\tgetAttachmentTime (): number {\r\n\t\t\treturn this.bone.skeleton.time - this.attachmentTime;\r\n\t\t}\r\n\r\n\t\t/** Sets this slot to the setup pose. */\r\n\t\tsetToSetupPose () {\r\n\t\t\tthis.color.setFromColor(this.data.color);\r\n\t\t\tif (this.darkColor != null) this.darkColor.setFromColor(this.data.darkColor);\r\n\t\t\tif (this.data.attachmentName == null)\r\n\t\t\t\tthis.attachment = null;\r\n\t\t\telse {\r\n\t\t\t\tthis.attachment = null;\r\n\t\t\t\tthis.setAttachment(this.bone.skeleton.getAttachment(this.data.index, this.data.attachmentName));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Bone } from \"./Bone\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { TransformConstraintData } from \"./TransformConstraintData\";\r\nimport { Updatable } from \"./Updatable\";\r\nimport { Vector2, MathUtils } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the current pose for a transform constraint. A transform constraint adjusts the world transform of the constrained\r\n\t * bones to match that of the target bone.\r\n\t *\r\n\t * See [Transform constraints](http://esotericsoftware.com/spine-transform-constraints) in the Spine User Guide. */\r\n\texport class TransformConstraint implements Updatable {\r\n\r\n\t\t/** The transform constraint's setup pose data. */\r\n\t\tdata: TransformConstraintData;\r\n\r\n\t\t/** The bones that will be modified by this transform constraint. */\r\n\t\tbones: Array<Bone>;\r\n\r\n\t\t/** The target bone whose world transform will be copied to the constrained bones. */\r\n\t\ttarget: Bone;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained rotations. */\r\n\t\trotateMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained translations. */\r\n\t\ttranslateMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained scales. */\r\n\t\tscaleMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained scales. */\r\n\t\tshearMix = 0;\r\n\r\n\t\ttemp = new Vector2();\r\n\t\tactive = false;\r\n\r\n\t\tconstructor (data: TransformConstraintData, skeleton: Skeleton) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\t\t\tthis.data = data;\r\n\t\t\tthis.rotateMix = data.rotateMix;\r\n\t\t\tthis.translateMix = data.translateMix;\r\n\t\t\tthis.scaleMix = data.scaleMix;\r\n\t\t\tthis.shearMix = data.shearMix;\r\n\t\t\tthis.bones = new Array<Bone>();\r\n\t\t\tfor (let i = 0; i < data.bones.length; i++)\r\n\t\t\t\tthis.bones.push(skeleton.findBone(data.bones[i].name));\r\n\t\t\tthis.target = skeleton.findBone(data.target.name);\r\n\t\t}\r\n\r\n\t\tisActive () {\r\n\t\t\treturn this.active;\r\n\t\t}\r\n\r\n\t\t/** Applies the constraint to the constrained bones. */\r\n\t\tapply () {\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tupdate () {\r\n\t\t\tif (this.data.local) {\r\n\t\t\t\tif (this.data.relative)\r\n\t\t\t\t\tthis.applyRelativeLocal();\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.applyAbsoluteLocal();\r\n\r\n\t\t\t} else {\r\n\t\t\t\tif (this.data.relative)\r\n\t\t\t\t\tthis.applyRelativeWorld();\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.applyAbsoluteWorld();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tapplyAbsoluteWorld () {\r\n\t\t\tlet rotateMix = this.rotateMix, translateMix = this.translateMix, scaleMix = this.scaleMix, shearMix = this.shearMix;\r\n\t\t\tlet target = this.target;\r\n\t\t\tlet ta = target.a, tb = target.b, tc = target.c, td = target.d;\r\n\t\t\tlet degRadReflect = ta * td - tb * tc > 0 ? MathUtils.degRad : -MathUtils.degRad;\r\n\t\t\tlet offsetRotation = this.data.offsetRotation * degRadReflect;\r\n\t\t\tlet offsetShearY = this.data.offsetShearY * degRadReflect;\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tlet modified = false;\r\n\r\n\t\t\t\tif (rotateMix != 0) {\r\n\t\t\t\t\tlet a = bone.a, b = bone.b, c = bone.c, d = bone.d;\r\n\t\t\t\t\tlet r = Math.atan2(tc, ta) - Math.atan2(c, a) + offsetRotation;\r\n\t\t\t\t\tif (r > MathUtils.PI)\r\n\t\t\t\t\t\tr -= MathUtils.PI2;\r\n\t\t\t\t\telse if (r < -MathUtils.PI)\r\n\t\t\t\t\t\tr += MathUtils.PI2;\r\n\t\t\t\t\tr *= rotateMix;\r\n\t\t\t\t\tlet cos = Math.cos(r), sin = Math.sin(r);\r\n\t\t\t\t\tbone.a = cos * a - sin * c;\r\n\t\t\t\t\tbone.b = cos * b - sin * d;\r\n\t\t\t\t\tbone.c = sin * a + cos * c;\r\n\t\t\t\t\tbone.d = sin * b + cos * d;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (translateMix != 0) {\r\n\t\t\t\t\tlet temp = this.temp;\r\n\t\t\t\t\ttarget.localToWorld(temp.set(this.data.offsetX, this.data.offsetY));\r\n\t\t\t\t\tbone.worldX += (temp.x - bone.worldX) * translateMix;\r\n\t\t\t\t\tbone.worldY += (temp.y - bone.worldY) * translateMix;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (scaleMix > 0) {\r\n\t\t\t\t\tlet s = Math.sqrt(bone.a * bone.a + bone.c * bone.c);\r\n\t\t\t\t\tlet ts = Math.sqrt(ta * ta + tc * tc);\r\n\t\t\t\t\tif (s > 0.00001) s = (s + (ts - s + this.data.offsetScaleX) * scaleMix) / s;\r\n\t\t\t\t\tbone.a *= s;\r\n\t\t\t\t\tbone.c *= s;\r\n\t\t\t\t\ts = Math.sqrt(bone.b * bone.b + bone.d * bone.d);\r\n\t\t\t\t\tts = Math.sqrt(tb * tb + td * td);\r\n\t\t\t\t\tif (s > 0.00001) s = (s + (ts - s + this.data.offsetScaleY) * scaleMix) / s;\r\n\t\t\t\t\tbone.b *= s;\r\n\t\t\t\t\tbone.d *= s;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (shearMix > 0) {\r\n\t\t\t\t\tlet b = bone.b, d = bone.d;\r\n\t\t\t\t\tlet by = Math.atan2(d, b);\r\n\t\t\t\t\tlet r = Math.atan2(td, tb) - Math.atan2(tc, ta) - (by - Math.atan2(bone.c, bone.a));\r\n\t\t\t\t\tif (r > MathUtils.PI)\r\n\t\t\t\t\t\tr -= MathUtils.PI2;\r\n\t\t\t\t\telse if (r < -MathUtils.PI)\r\n\t\t\t\t\t\tr += MathUtils.PI2;\r\n\t\t\t\t\tr = by + (r + offsetShearY) * shearMix;\r\n\t\t\t\t\tlet s = Math.sqrt(b * b + d * d);\r\n\t\t\t\t\tbone.b = Math.cos(r) * s;\r\n\t\t\t\t\tbone.d = Math.sin(r) * s;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (modified) bone.appliedValid = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tapplyRelativeWorld () {\r\n\t\t\tlet rotateMix = this.rotateMix, translateMix = this.translateMix, scaleMix = this.scaleMix, shearMix = this.shearMix;\r\n\t\t\tlet target = this.target;\r\n\t\t\tlet ta = target.a, tb = target.b, tc = target.c, td = target.d;\r\n\t\t\tlet degRadReflect = ta * td - tb * tc > 0 ? MathUtils.degRad : -MathUtils.degRad;\r\n\t\t\tlet offsetRotation = this.data.offsetRotation * degRadReflect, offsetShearY = this.data.offsetShearY * degRadReflect;\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tlet modified = false;\r\n\r\n\t\t\t\tif (rotateMix != 0) {\r\n\t\t\t\t\tlet a = bone.a, b = bone.b, c = bone.c, d = bone.d;\r\n\t\t\t\t\tlet r = Math.atan2(tc, ta) + offsetRotation;\r\n\t\t\t\t\tif (r > MathUtils.PI)\r\n\t\t\t\t\t\tr -= MathUtils.PI2;\r\n\t\t\t\t\telse if (r < -MathUtils.PI) r += MathUtils.PI2;\r\n\t\t\t\t\tr *= rotateMix;\r\n\t\t\t\t\tlet cos = Math.cos(r), sin = Math.sin(r);\r\n\t\t\t\t\tbone.a = cos * a - sin * c;\r\n\t\t\t\t\tbone.b = cos * b - sin * d;\r\n\t\t\t\t\tbone.c = sin * a + cos * c;\r\n\t\t\t\t\tbone.d = sin * b + cos * d;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (translateMix != 0) {\r\n\t\t\t\t\tlet temp = this.temp;\r\n\t\t\t\t\ttarget.localToWorld(temp.set(this.data.offsetX, this.data.offsetY));\r\n\t\t\t\t\tbone.worldX += temp.x * translateMix;\r\n\t\t\t\t\tbone.worldY += temp.y * translateMix;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (scaleMix > 0) {\r\n\t\t\t\t\tlet s = (Math.sqrt(ta * ta + tc * tc) - 1 + this.data.offsetScaleX) * scaleMix + 1;\r\n\t\t\t\t\tbone.a *= s;\r\n\t\t\t\t\tbone.c *= s;\r\n\t\t\t\t\ts = (Math.sqrt(tb * tb + td * td) - 1 + this.data.offsetScaleY) * scaleMix + 1;\r\n\t\t\t\t\tbone.b *= s;\r\n\t\t\t\t\tbone.d *= s;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (shearMix > 0) {\r\n\t\t\t\t\tlet r = Math.atan2(td, tb) - Math.atan2(tc, ta);\r\n\t\t\t\t\tif (r > MathUtils.PI)\r\n\t\t\t\t\t\tr -= MathUtils.PI2;\r\n\t\t\t\t\telse if (r < -MathUtils.PI) r += MathUtils.PI2;\r\n\t\t\t\t\tlet b = bone.b, d = bone.d;\r\n\t\t\t\t\tr = Math.atan2(d, b) + (r - MathUtils.PI / 2 + offsetShearY) * shearMix;\r\n\t\t\t\t\tlet s = Math.sqrt(b * b + d * d);\r\n\t\t\t\t\tbone.b = Math.cos(r) * s;\r\n\t\t\t\t\tbone.d = Math.sin(r) * s;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (modified) bone.appliedValid = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tapplyAbsoluteLocal () {\r\n\t\t\tlet rotateMix = this.rotateMix, translateMix = this.translateMix, scaleMix = this.scaleMix, shearMix = this.shearMix;\r\n\t\t\tlet target = this.target;\r\n\t\t\tif (!target.appliedValid) target.updateAppliedTransform();\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tif (!bone.appliedValid) bone.updateAppliedTransform();\r\n\r\n\t\t\t\tlet rotation = bone.arotation;\r\n\t\t\t\tif (rotateMix != 0) {\r\n\t\t\t\t\tlet r = target.arotation - rotation + this.data.offsetRotation;\r\n\t\t\t\t\tr -= (16384 - ((16384.499999999996 - r / 360) | 0)) * 360;\r\n\t\t\t\t\trotation += r * rotateMix;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet x = bone.ax, y = bone.ay;\r\n\t\t\t\tif (translateMix != 0) {\r\n\t\t\t\t\tx += (target.ax - x + this.data.offsetX) * translateMix;\r\n\t\t\t\t\ty += (target.ay - y + this.data.offsetY) * translateMix;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet scaleX = bone.ascaleX, scaleY = bone.ascaleY;\r\n\t\t\t\tif (scaleMix != 0) {\r\n\t\t\t\t\tif (scaleX > 0.00001) scaleX = (scaleX + (target.ascaleX - scaleX + this.data.offsetScaleX) * scaleMix) / scaleX;\r\n\t\t\t\t\tif (scaleY > 0.00001) scaleY = (scaleY + (target.ascaleY - scaleY + this.data.offsetScaleY) * scaleMix) / scaleY;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet shearY = bone.ashearY;\r\n\t\t\t\tif (shearMix != 0) {\r\n\t\t\t\t\tlet r = target.ashearY - shearY + this.data.offsetShearY;\r\n\t\t\t\t\tr -= (16384 - ((16384.499999999996 - r / 360) | 0)) * 360;\r\n\t\t\t\t\tbone.shearY += r * shearMix;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbone.updateWorldTransformWith(x, y, rotation, scaleX, scaleY, bone.ashearX, shearY);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tapplyRelativeLocal () {\r\n\t\t\tlet rotateMix = this.rotateMix, translateMix = this.translateMix, scaleMix = this.scaleMix, shearMix = this.shearMix;\r\n\t\t\tlet target = this.target;\r\n\t\t\tif (!target.appliedValid) target.updateAppliedTransform();\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tif (!bone.appliedValid) bone.updateAppliedTransform();\r\n\r\n\t\t\t\tlet rotation = bone.arotation;\r\n\t\t\t\tif (rotateMix != 0) rotation += (target.arotation + this.data.offsetRotation) * rotateMix;\r\n\r\n\t\t\t\tlet x = bone.ax, y = bone.ay;\r\n\t\t\t\tif (translateMix != 0) {\r\n\t\t\t\t\tx += (target.ax + this.data.offsetX) * translateMix;\r\n\t\t\t\t\ty += (target.ay + this.data.offsetY) * translateMix;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet scaleX = bone.ascaleX, scaleY = bone.ascaleY;\r\n\t\t\t\tif (scaleMix != 0) {\r\n\t\t\t\t\tif (scaleX > 0.00001) scaleX *= ((target.ascaleX - 1 + this.data.offsetScaleX) * scaleMix) + 1;\r\n\t\t\t\t\tif (scaleY > 0.00001) scaleY *= ((target.ascaleY - 1 + this.data.offsetScaleY) * scaleMix) + 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet shearY = bone.ashearY;\r\n\t\t\t\tif (shearMix != 0) shearY += (target.ashearY + this.data.offsetShearY) * shearMix;\r\n\r\n\t\t\t\tbone.updateWorldTransformWith(x, y, rotation, scaleX, scaleY, bone.ashearX, shearY);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Attachment } from \"./attachments/Attachment\";\r\nimport { MeshAttachment } from \"./attachments/MeshAttachment\";\r\nimport { PathAttachment } from \"./attachments/PathAttachment\";\r\nimport { RegionAttachment } from \"./attachments/RegionAttachment\";\r\nimport { Bone } from \"./Bone\";\r\nimport { IkConstraint } from \"./IkConstraint\";\r\nimport { PathConstraint } from \"./PathConstraint\";\r\nimport { SkeletonData } from \"./SkeletonData\";\r\nimport { Skin } from \"./Skin\";\r\nimport { Slot } from \"./Slot\";\r\nimport { TransformConstraint } from \"./TransformConstraint\";\r\nimport { Updatable } from \"./Updatable\";\r\nimport { Color, Utils, Vector2 } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the current pose for a skeleton.\r\n\t *\r\n\t * See [Instance objects](http://esotericsoftware.com/spine-runtime-architecture#Instance-objects) in the Spine Runtimes Guide. */\r\n\texport class Skeleton {\r\n\t\t/** The skeleton's setup pose data. */\r\n\t\tdata: SkeletonData;\r\n\r\n\t\t/** The skeleton's bones, sorted parent first. The root bone is always the first bone. */\r\n\t\tbones: Array<Bone>;\r\n\r\n\t\t/** The skeleton's slots. */\r\n\t\tslots: Array<Slot>;\r\n\r\n\t\t/** The skeleton's slots in the order they should be drawn. The returned array may be modified to change the draw order. */\r\n\t\tdrawOrder: Array<Slot>;\r\n\r\n\t\t/** The skeleton's IK constraints. */\r\n\t\tikConstraints: Array<IkConstraint>;\r\n\r\n\t\t/** The skeleton's transform constraints. */\r\n\t\ttransformConstraints: Array<TransformConstraint>;\r\n\r\n\t\t/** The skeleton's path constraints. */\r\n\t\tpathConstraints: Array<PathConstraint>;\r\n\r\n\t\t/** The list of bones and constraints, sorted in the order they should be updated, as computed by {@link #updateCache()}. */\r\n\t\t_updateCache = new Array<Updatable>();\r\n\t\tupdateCacheReset = new Array<Updatable>();\r\n\r\n\t\t/** The skeleton's current skin. May be null. */\r\n\t\tskin: Skin;\r\n\r\n\t\t/** The color to tint all the skeleton's attachments. */\r\n\t\tcolor: Color;\r\n\r\n\t\t/** Returns the skeleton's time. This can be used for tracking, such as with Slot {@link Slot#attachmentTime}.\r\n\t\t * <p>\r\n\t\t * See {@link #update()}. */\r\n\t\ttime = 0;\r\n\r\n\t\t/** Scales the entire skeleton on the X axis. This affects all bones, even if the bone's transform mode disallows scale\r\n\t \t* inheritance. */\r\n\t\tscaleX = 1;\r\n\r\n\t\t/** Scales the entire skeleton on the Y axis. This affects all bones, even if the bone's transform mode disallows scale\r\n\t \t* inheritance. */\r\n\t\tscaleY = 1;\r\n\r\n\t\t/** Sets the skeleton X position, which is added to the root bone worldX position. */\r\n\t\tx = 0;\r\n\r\n\t\t/** Sets the skeleton Y position, which is added to the root bone worldY position. */\r\n\t\ty = 0;\r\n\r\n\t\tconstructor (data: SkeletonData) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tthis.data = data;\r\n\r\n\t\t\tthis.bones = new Array<Bone>();\r\n\t\t\tfor (let i = 0; i < data.bones.length; i++) {\r\n\t\t\t\tlet boneData = data.bones[i];\r\n\t\t\t\tlet bone: Bone;\r\n\t\t\t\tif (boneData.parent == null)\r\n\t\t\t\t\tbone = new Bone(boneData, this, null);\r\n\t\t\t\telse {\r\n\t\t\t\t\tlet parent = this.bones[boneData.parent.index];\r\n\t\t\t\t\tbone = new Bone(boneData, this, parent);\r\n\t\t\t\t\tparent.children.push(bone);\r\n\t\t\t\t}\r\n\t\t\t\tthis.bones.push(bone);\r\n\t\t\t}\r\n\r\n\t\t\tthis.slots = new Array<Slot>();\r\n\t\t\tthis.drawOrder = new Array<Slot>();\r\n\t\t\tfor (let i = 0; i < data.slots.length; i++) {\r\n\t\t\t\tlet slotData = data.slots[i];\r\n\t\t\t\tlet bone = this.bones[slotData.boneData.index];\r\n\t\t\t\tlet slot = new Slot(slotData, bone);\r\n\t\t\t\tthis.slots.push(slot);\r\n\t\t\t\tthis.drawOrder.push(slot);\r\n\t\t\t}\r\n\r\n\t\t\tthis.ikConstraints = new Array<IkConstraint>();\r\n\t\t\tfor (let i = 0; i < data.ikConstraints.length; i++) {\r\n\t\t\t\tlet ikConstraintData = data.ikConstraints[i];\r\n\t\t\t\tthis.ikConstraints.push(new IkConstraint(ikConstraintData, this));\r\n\t\t\t}\r\n\r\n\t\t\tthis.transformConstraints = new Array<TransformConstraint>();\r\n\t\t\tfor (let i = 0; i < data.transformConstraints.length; i++) {\r\n\t\t\t\tlet transformConstraintData = data.transformConstraints[i];\r\n\t\t\t\tthis.transformConstraints.push(new TransformConstraint(transformConstraintData, this));\r\n\t\t\t}\r\n\r\n\t\t\tthis.pathConstraints = new Array<PathConstraint>();\r\n\t\t\tfor (let i = 0; i < data.pathConstraints.length; i++) {\r\n\t\t\t\tlet pathConstraintData = data.pathConstraints[i];\r\n\t\t\t\tthis.pathConstraints.push(new PathConstraint(pathConstraintData, this));\r\n\t\t\t}\r\n\r\n\t\t\tthis.color = new Color(1, 1, 1, 1);\r\n\t\t\tthis.updateCache();\r\n\t\t}\r\n\r\n\t\t/** Caches information about bones and constraints. Must be called if the {@link #getSkin()} is modified or if bones,\r\n\t\t * constraints, or weighted path attachments are added or removed. */\r\n\t\tupdateCache () {\r\n\t\t\tlet updateCache = this._updateCache;\r\n\t\t\tupdateCache.length = 0;\r\n\t\t\tthis.updateCacheReset.length = 0;\r\n\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tbone.sorted = bone.data.skinRequired;\r\n\t\t\t\tbone.active = !bone.sorted;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.skin != null) {\r\n\t\t\t\tlet skinBones = this.skin.bones;\r\n\t\t\t\tfor (let i = 0, n = this.skin.bones.length; i < n; i++) {\r\n\t\t\t\t\tlet bone = this.bones[skinBones[i].index];\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tbone.sorted = false;\r\n\t\t\t\t\t\tbone.active = true;\r\n\t\t\t\t\t\tbone = bone.parent;\r\n\t\t\t\t\t} while (bone != null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// IK first, lowest hierarchy depth first.\r\n\t\t\tlet ikConstraints = this.ikConstraints;\r\n\t\t\tlet transformConstraints = this.transformConstraints;\r\n\t\t\tlet pathConstraints = this.pathConstraints;\r\n\t\t\tlet ikCount = ikConstraints.length, transformCount = transformConstraints.length, pathCount = pathConstraints.length;\r\n\t\t\tlet constraintCount = ikCount + transformCount + pathCount;\r\n\r\n\t\t\touter:\r\n\t\t\tfor (let i = 0; i < constraintCount; i++) {\r\n\t\t\t\tfor (let ii = 0; ii < ikCount; ii++) {\r\n\t\t\t\t\tlet constraint = ikConstraints[ii];\r\n\t\t\t\t\tif (constraint.data.order == i) {\r\n\t\t\t\t\t\tthis.sortIkConstraint(constraint);\r\n\t\t\t\t\t\tcontinue outer;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor (let ii = 0; ii < transformCount; ii++) {\r\n\t\t\t\t\tlet constraint = transformConstraints[ii];\r\n\t\t\t\t\tif (constraint.data.order == i) {\r\n\t\t\t\t\t\tthis.sortTransformConstraint(constraint);\r\n\t\t\t\t\t\tcontinue outer;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor (let ii = 0; ii < pathCount; ii++) {\r\n\t\t\t\t\tlet constraint = pathConstraints[ii];\r\n\t\t\t\t\tif (constraint.data.order == i) {\r\n\t\t\t\t\t\tthis.sortPathConstraint(constraint);\r\n\t\t\t\t\t\tcontinue outer;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++)\r\n\t\t\t\tthis.sortBone(bones[i]);\r\n\t\t}\r\n\r\n\t\tsortIkConstraint (constraint: IkConstraint) {\r\n\t\t\tconstraint.active = constraint.target.isActive() && (!constraint.data.skinRequired || (this.skin != null && Utils.contains(this.skin.constraints, constraint.data, true)));\r\n\t\t\tif (!constraint.active) return;\r\n\r\n\t\t\tlet target = constraint.target;\r\n\t\t\tthis.sortBone(target);\r\n\r\n\t\t\tlet constrained = constraint.bones;\r\n\t\t\tlet parent = constrained[0];\r\n\t\t\tthis.sortBone(parent);\r\n\r\n\t\t\tif (constrained.length > 1) {\r\n\t\t\t\tlet child = constrained[constrained.length - 1];\r\n\t\t\t\tif (!(this._updateCache.indexOf(child) > -1)) this.updateCacheReset.push(child);\r\n\t\t\t}\r\n\r\n\t\t\tthis._updateCache.push(constraint);\r\n\r\n\t\t\tthis.sortReset(parent.children);\r\n\t\t\tconstrained[constrained.length - 1].sorted = true;\r\n\t\t}\r\n\r\n\t\tsortPathConstraint (constraint: PathConstraint) {\r\n\t\t\tconstraint.active = constraint.target.bone.isActive() && (!constraint.data.skinRequired || (this.skin != null && Utils.contains(this.skin.constraints, constraint.data, true)));\r\n\t\t\tif (!constraint.active) return;\r\n\r\n\t\t\tlet slot = constraint.target;\r\n\t\t\tlet slotIndex = slot.data.index;\r\n\t\t\tlet slotBone = slot.bone;\r\n\t\t\tif (this.skin != null) this.sortPathConstraintAttachment(this.skin, slotIndex, slotBone);\r\n\t\t\tif (this.data.defaultSkin != null && this.data.defaultSkin != this.skin)\r\n\t\t\t\tthis.sortPathConstraintAttachment(this.data.defaultSkin, slotIndex, slotBone);\r\n\t\t\tfor (let i = 0, n = this.data.skins.length; i < n; i++)\r\n\t\t\t\tthis.sortPathConstraintAttachment(this.data.skins[i], slotIndex, slotBone);\r\n\r\n\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\tif (attachment instanceof PathAttachment) this.sortPathConstraintAttachmentWith(attachment, slotBone);\r\n\r\n\t\t\tlet constrained = constraint.bones;\r\n\t\t\tlet boneCount = constrained.length;\r\n\t\t\tfor (let i = 0; i < boneCount; i++)\r\n\t\t\t\tthis.sortBone(constrained[i]);\r\n\r\n\t\t\tthis._updateCache.push(constraint);\r\n\r\n\t\t\tfor (let i = 0; i < boneCount; i++)\r\n\t\t\t\tthis.sortReset(constrained[i].children);\r\n\t\t\tfor (let i = 0; i < boneCount; i++)\r\n\t\t\t\tconstrained[i].sorted = true;\r\n\t\t}\r\n\r\n\t\tsortTransformConstraint (constraint: TransformConstraint) {\r\n\t\t\tconstraint.active = constraint.target.isActive() && (!constraint.data.skinRequired || (this.skin != null && Utils.contains(this.skin.constraints, constraint.data, true)));\r\n\t\t\tif (!constraint.active) return;\r\n\r\n\t\t\tthis.sortBone(constraint.target);\r\n\r\n\t\t\tlet constrained = constraint.bones;\r\n\t\t\tlet boneCount = constrained.length;\r\n\t\t\tif (constraint.data.local) {\r\n\t\t\t\tfor (let i = 0; i < boneCount; i++) {\r\n\t\t\t\t\tlet child = constrained[i];\r\n\t\t\t\t\tthis.sortBone(child.parent);\r\n\t\t\t\t\tif (!(this._updateCache.indexOf(child) > -1)) this.updateCacheReset.push(child);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (let i = 0; i < boneCount; i++) {\r\n\t\t\t\t\tthis.sortBone(constrained[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._updateCache.push(constraint);\r\n\r\n\t\t\tfor (let ii = 0; ii < boneCount; ii++)\r\n\t\t\t\tthis.sortReset(constrained[ii].children);\r\n\t\t\tfor (let ii = 0; ii < boneCount; ii++)\r\n\t\t\t\tconstrained[ii].sorted = true;\r\n\t\t}\r\n\r\n\t\tsortPathConstraintAttachment (skin: Skin, slotIndex: number, slotBone: Bone) {\r\n\t\t\tlet attachments = skin.attachments[slotIndex];\r\n\t\t\tif (!attachments) return;\r\n\t\t\tfor (let key in attachments) {\r\n\t\t\t\tthis.sortPathConstraintAttachmentWith(attachments[key], slotBone);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsortPathConstraintAttachmentWith (attachment: Attachment, slotBone: Bone) {\r\n\t\t\tif (!(attachment instanceof PathAttachment)) return;\r\n\t\t\tlet pathBones = (<PathAttachment>attachment).bones;\r\n\t\t\tif (pathBones == null)\r\n\t\t\t\tthis.sortBone(slotBone);\r\n\t\t\telse {\r\n\t\t\t\tlet bones = this.bones;\r\n\t\t\t\tlet i = 0;\r\n\t\t\t\twhile (i < pathBones.length) {\r\n\t\t\t\t\tlet boneCount = pathBones[i++];\r\n\t\t\t\t\tfor (let n = i + boneCount; i < n; i++) {\r\n\t\t\t\t\t\tlet boneIndex = pathBones[i];\r\n\t\t\t\t\t\tthis.sortBone(bones[boneIndex]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsortBone (bone: Bone) {\r\n\t\t\tif (bone.sorted) return;\r\n\t\t\tlet parent = bone.parent;\r\n\t\t\tif (parent != null) this.sortBone(parent);\r\n\t\t\tbone.sorted = true;\r\n\t\t\tthis._updateCache.push(bone);\r\n\t\t}\r\n\r\n\t\tsortReset (bones: Array<Bone>) {\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tif (!bone.active) continue;\r\n\t\t\t\tif (bone.sorted) this.sortReset(bone.children);\r\n\t\t\t\tbone.sorted = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Updates the world transform for each bone and applies all constraints.\r\n\t\t *\r\n\t\t * See [World transforms](http://esotericsoftware.com/spine-runtime-skeletons#World-transforms) in the Spine\r\n\t\t * Runtimes Guide. */\r\n\t\tupdateWorldTransform () {\r\n\t\t\tlet updateCacheReset = this.updateCacheReset;\r\n\t\t\tfor (let i = 0, n = updateCacheReset.length; i < n; i++) {\r\n\t\t\t\tlet bone = updateCacheReset[i] as Bone;\r\n\t\t\t\tbone.ax = bone.x;\r\n\t\t\t\tbone.ay = bone.y;\r\n\t\t\t\tbone.arotation = bone.rotation;\r\n\t\t\t\tbone.ascaleX = bone.scaleX;\r\n\t\t\t\tbone.ascaleY = bone.scaleY;\r\n\t\t\t\tbone.ashearX = bone.shearX;\r\n\t\t\t\tbone.ashearY = bone.shearY;\r\n\t\t\t\tbone.appliedValid = true;\r\n\t\t\t}\r\n\t\t\tlet updateCache = this._updateCache;\r\n\t\t\tfor (let i = 0, n = updateCache.length; i < n; i++)\r\n\t\t\t\tupdateCache[i].update();\r\n\t\t}\r\n\r\n\t\t/** Sets the bones, constraints, and slots to their setup pose values. */\r\n\t\tsetToSetupPose () {\r\n\t\t\tthis.setBonesToSetupPose();\r\n\t\t\tthis.setSlotsToSetupPose();\r\n\t\t}\r\n\r\n\t\t/** Sets the bones and constraints to their setup pose values. */\r\n\t\tsetBonesToSetupPose () {\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++)\r\n\t\t\t\tbones[i].setToSetupPose();\r\n\r\n\t\t\tlet ikConstraints = this.ikConstraints;\r\n\t\t\tfor (let i = 0, n = ikConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = ikConstraints[i];\r\n\t\t\t\tconstraint.mix = constraint.data.mix;\r\n\t\t\t\tconstraint.softness = constraint.data.softness;\r\n\t\t\t\tconstraint.bendDirection = constraint.data.bendDirection;\r\n\t\t\t\tconstraint.compress = constraint.data.compress;\r\n\t\t\t\tconstraint.stretch = constraint.data.stretch;\r\n\t\t\t}\r\n\r\n\t\t\tlet transformConstraints = this.transformConstraints;\r\n\t\t\tfor (let i = 0, n = transformConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = transformConstraints[i];\r\n\t\t\t\tlet data = constraint.data;\r\n\t\t\t\tconstraint.rotateMix = data.rotateMix;\r\n\t\t\t\tconstraint.translateMix = data.translateMix;\r\n\t\t\t\tconstraint.scaleMix = data.scaleMix;\r\n\t\t\t\tconstraint.shearMix = data.shearMix;\r\n\t\t\t}\r\n\r\n\t\t\tlet pathConstraints = this.pathConstraints;\r\n\t\t\tfor (let i = 0, n = pathConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = pathConstraints[i];\r\n\t\t\t\tlet data = constraint.data;\r\n\t\t\t\tconstraint.position = data.position;\r\n\t\t\t\tconstraint.spacing = data.spacing;\r\n\t\t\t\tconstraint.rotateMix = data.rotateMix;\r\n\t\t\t\tconstraint.translateMix = data.translateMix;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Sets the slots and draw order to their setup pose values. */\r\n\t\tsetSlotsToSetupPose () {\r\n\t\t\tlet slots = this.slots;\r\n\t\t\tUtils.arrayCopy(slots, 0, this.drawOrder, 0, slots.length);\r\n\t\t\tfor (let i = 0, n = slots.length; i < n; i++)\r\n\t\t\t\tslots[i].setToSetupPose();\r\n\t\t}\r\n\r\n\t\t/** @returns May return null. */\r\n\t\tgetRootBone () {\r\n\t\t\tif (this.bones.length == 0) return null;\r\n\t\t\treturn this.bones[0];\r\n\t\t}\r\n\r\n\t\t/** @returns May be null. */\r\n\t\tfindBone (boneName: string) {\r\n\t\t\tif (boneName == null) throw new Error(\"boneName cannot be null.\");\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tif (bone.data.name == boneName) return bone;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** @returns -1 if the bone was not found. */\r\n\t\tfindBoneIndex (boneName: string) {\r\n\t\t\tif (boneName == null) throw new Error(\"boneName cannot be null.\");\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++)\r\n\t\t\t\tif (bones[i].data.name == boneName) return i;\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\t/** Finds a slot by comparing each slot's name. It is more efficient to cache the results of this method than to call it\r\n\t\t * repeatedly.\r\n\t\t * @returns May be null. */\r\n\t\tfindSlot (slotName: string) {\r\n\t\t\tif (slotName == null) throw new Error(\"slotName cannot be null.\");\r\n\t\t\tlet slots = this.slots;\r\n\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\tlet slot = slots[i];\r\n\t\t\t\tif (slot.data.name == slotName) return slot;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** @returns -1 if the bone was not found. */\r\n\t\tfindSlotIndex (slotName: string) {\r\n\t\t\tif (slotName == null) throw new Error(\"slotName cannot be null.\");\r\n\t\t\tlet slots = this.slots;\r\n\t\t\tfor (let i = 0, n = slots.length; i < n; i++)\r\n\t\t\t\tif (slots[i].data.name == slotName) return i;\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\t/** Sets a skin by name.\r\n\t\t *\r\n\t\t * See {@link #setSkin()}. */\r\n\t\tsetSkinByName (skinName: string) {\r\n\t\t\tlet skin = this.data.findSkin(skinName);\r\n\t\t\tif (skin == null) throw new Error(\"Skin not found: \" + skinName);\r\n\t\t\tthis.setSkin(skin);\r\n\t\t}\r\n\r\n\t\t/** Sets the skin used to look up attachments before looking in the {@link SkeletonData#defaultSkin default skin}. If the\r\n\t\t * skin is changed, {@link #updateCache()} is called.\r\n\t\t *\r\n\t\t * Attachments from the new skin are attached if the corresponding attachment from the old skin was attached. If there was no\r\n\t\t * old skin, each slot's setup mode attachment is attached from the new skin.\r\n\t\t *\r\n\t\t * After changing the skin, the visible attachments can be reset to those attached in the setup pose by calling\r\n\t\t * {@link #setSlotsToSetupPose()}. Also, often {@link AnimationState#apply()} is called before the next time the\r\n\t\t * skeleton is rendered to allow any attachment keys in the current animation(s) to hide or show attachments from the new skin.\r\n\t\t * @param newSkin May be null. */\r\n\t\tsetSkin (newSkin: Skin) {\r\n\t\t\tif (newSkin == this.skin) return;\r\n\t\t\tif (newSkin != null) {\r\n\t\t\t\tif (this.skin != null)\r\n\t\t\t\t\tnewSkin.attachAll(this, this.skin);\r\n\t\t\t\telse {\r\n\t\t\t\t\tlet slots = this.slots;\r\n\t\t\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\t\t\tlet slot = slots[i];\r\n\t\t\t\t\t\tlet name = slot.data.attachmentName;\r\n\t\t\t\t\t\tif (name != null) {\r\n\t\t\t\t\t\t\tlet attachment: Attachment = newSkin.getAttachment(i, name);\r\n\t\t\t\t\t\t\tif (attachment != null) slot.setAttachment(attachment);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.skin = newSkin;\r\n\t\t\tthis.updateCache();\r\n\t\t}\r\n\r\n\r\n\t\t/** Finds an attachment by looking in the {@link #skin} and {@link SkeletonData#defaultSkin} using the slot name and attachment\r\n\t\t * name.\r\n\t\t *\r\n\t\t * See {@link #getAttachment()}.\r\n\t\t * @returns May be null. */\r\n\t\tgetAttachmentByName (slotName: string, attachmentName: string): Attachment {\r\n\t\t\treturn this.getAttachment(this.data.findSlotIndex(slotName), attachmentName);\r\n\t\t}\r\n\r\n\t\t/** Finds an attachment by looking in the {@link #skin} and {@link SkeletonData#defaultSkin} using the slot index and\r\n\t\t * attachment name. First the skin is checked and if the attachment was not found, the default skin is checked.\r\n\t\t *\r\n\t\t * See [Runtime skins](http://esotericsoftware.com/spine-runtime-skins) in the Spine Runtimes Guide.\r\n\t\t * @returns May be null. */\r\n\t\tgetAttachment (slotIndex: number, attachmentName: string): Attachment {\r\n\t\t\tif (attachmentName == null) throw new Error(\"attachmentName cannot be null.\");\r\n\t\t\tif (this.skin != null) {\r\n\t\t\t\tlet attachment: Attachment = this.skin.getAttachment(slotIndex, attachmentName);\r\n\t\t\t\tif (attachment != null) return attachment;\r\n\t\t\t}\r\n\t\t\tif (this.data.defaultSkin != null) return this.data.defaultSkin.getAttachment(slotIndex, attachmentName);\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** A convenience method to set an attachment by finding the slot with {@link #findSlot()}, finding the attachment with\r\n\t\t * {@link #getAttachment()}, then setting the slot's {@link Slot#attachment}.\r\n\t\t * @param attachmentName May be null to clear the slot's attachment. */\r\n\t\tsetAttachment (slotName: string, attachmentName: string) {\r\n\t\t\tif (slotName == null) throw new Error(\"slotName cannot be null.\");\r\n\t\t\tlet slots = this.slots;\r\n\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\tlet slot = slots[i];\r\n\t\t\t\tif (slot.data.name == slotName) {\r\n\t\t\t\t\tlet attachment: Attachment = null;\r\n\t\t\t\t\tif (attachmentName != null) {\r\n\t\t\t\t\t\tattachment = this.getAttachment(i, attachmentName);\r\n\t\t\t\t\t\tif (attachment == null)\r\n\t\t\t\t\t\t\tthrow new Error(\"Attachment not found: \" + attachmentName + \", for slot: \" + slotName);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tslot.setAttachment(attachment);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthrow new Error(\"Slot not found: \" + slotName);\r\n\t\t}\r\n\r\n\r\n\t\t/** Finds an IK constraint by comparing each IK constraint's name. It is more efficient to cache the results of this method\r\n\t\t * than to call it repeatedly.\r\n\t\t * @return May be null. */\r\n\t\tfindIkConstraint (constraintName: string) {\r\n\t\t\tif (constraintName == null) throw new Error(\"constraintName cannot be null.\");\r\n\t\t\tlet ikConstraints = this.ikConstraints;\r\n\t\t\tfor (let i = 0, n = ikConstraints.length; i < n; i++) {\r\n\t\t\t\tlet ikConstraint = ikConstraints[i];\r\n\t\t\t\tif (ikConstraint.data.name == constraintName) return ikConstraint;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds a transform constraint by comparing each transform constraint's name. It is more efficient to cache the results of\r\n\t\t * this method than to call it repeatedly.\r\n\t\t * @return May be null. */\r\n\t\tfindTransformConstraint (constraintName: string) {\r\n\t\t\tif (constraintName == null) throw new Error(\"constraintName cannot be null.\");\r\n\t\t\tlet transformConstraints = this.transformConstraints;\r\n\t\t\tfor (let i = 0, n = transformConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = transformConstraints[i];\r\n\t\t\t\tif (constraint.data.name == constraintName) return constraint;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds a path constraint by comparing each path constraint's name. It is more efficient to cache the results of this method\r\n\t\t * than to call it repeatedly.\r\n\t\t * @return May be null. */\r\n\t\tfindPathConstraint (constraintName: string) {\r\n\t\t\tif (constraintName == null) throw new Error(\"constraintName cannot be null.\");\r\n\t\t\tlet pathConstraints = this.pathConstraints;\r\n\t\t\tfor (let i = 0, n = pathConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = pathConstraints[i];\r\n\t\t\t\tif (constraint.data.name == constraintName) return constraint;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Returns the axis aligned bounding box (AABB) of the region and mesh attachments for the current pose.\r\n\t\t * @param offset An output value, the distance from the skeleton origin to the bottom left corner of the AABB.\r\n\t\t * @param size An output value, the width and height of the AABB.\r\n\t\t * @param temp Working memory to temporarily store attachments' computed world vertices. */\r\n\t\tgetBounds (offset: Vector2, size: Vector2, temp: Array<number> = new Array<number>(2)) {\r\n\t\t\tif (offset == null) throw new Error(\"offset cannot be null.\");\r\n\t\t\tif (size == null) throw new Error(\"size cannot be null.\");\r\n\t\t\tlet drawOrder = this.drawOrder;\r\n\t\t\tlet minX = Number.POSITIVE_INFINITY, minY = Number.POSITIVE_INFINITY, maxX = Number.NEGATIVE_INFINITY, maxY = Number.NEGATIVE_INFINITY;\r\n\t\t\tfor (let i = 0, n = drawOrder.length; i < n; i++) {\r\n\t\t\t\tlet slot = drawOrder[i];\r\n\t\t\t\tif (!slot.bone.active) continue;\r\n\t\t\t\tlet verticesLength = 0;\r\n\t\t\t\tlet vertices: ArrayLike<number> = null;\r\n\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\tif (attachment instanceof RegionAttachment) {\r\n\t\t\t\t\tverticesLength = 8;\r\n\t\t\t\t\tvertices = Utils.setArraySize(temp, verticesLength, 0);\r\n\t\t\t\t\t(<RegionAttachment>attachment).computeWorldVertices(slot.bone, vertices, 0, 2);\r\n\t\t\t\t}else if (attachment instanceof MeshAttachment) {\r\n\t\t\t\t\tlet mesh = (<MeshAttachment>attachment);\r\n\t\t\t\t\tverticesLength = mesh.worldVerticesLength;\r\n\t\t\t\t\tvertices = Utils.setArraySize(temp, verticesLength, 0);\r\n\t\t\t\t\tmesh.computeWorldVertices(slot, 0, verticesLength, vertices, 0, 2);\r\n\t\t\t\t}\r\n\t\t\t\tif (vertices != null) {\r\n\t\t\t\t\tfor (let ii = 0, nn = vertices.length; ii < nn; ii += 2) {\r\n\t\t\t\t\t\tlet x = vertices[ii], y = vertices[ii + 1];\r\n\t\t\t\t\t\tminX = Math.min(minX, x);\r\n\t\t\t\t\t\tminY = Math.min(minY, y);\r\n\t\t\t\t\t\tmaxX = Math.max(maxX, x);\r\n\t\t\t\t\t\tmaxY = Math.max(maxY, y);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\toffset.set(minX, minY);\r\n\t\t\tsize.set(maxX - minX, maxY - minY);\r\n\t\t}\r\n\r\n\t\t/** Increments the skeleton's {@link #time}. */\r\n\t\tupdate (delta: number) {\r\n\t\t\tthis.time += delta;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\n// module spine {\r\n\texport enum AttachmentType {\r\n\t\tRegion, BoundingBox, Mesh, LinkedMesh, Path, Point, Clipping\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { EventData } from \"./EventData\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the current pose values for an {@link Event}.\r\n\t *\r\n\t * See Timeline {@link Timeline#apply()},\r\n\t * AnimationStateListener {@link AnimationStateListener#event()}, and\r\n\t * [Events](http://esotericsoftware.com/spine-events) in the Spine User Guide. */\r\n\texport class Event {\r\n\t\tdata: EventData;\r\n\t\tintValue: number;\r\n\t\tfloatValue: number;\r\n\t\tstringValue: string;\r\n\t\ttime: number;\r\n\t\tvolume: number;\r\n\t\tbalance: number;\r\n\r\n\t\tconstructor (time: number, data: EventData) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tthis.time = time;\r\n\t\t\tthis.data = data;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\n// module spine {\r\n\t/** Stores the setup pose values for an {@link Event}.\r\n\t *\r\n\t * See [Events](http://esotericsoftware.com/spine-events) in the Spine User Guide. */\r\n\texport class EventData {\r\n\t\tname: string;\r\n\t\tintValue: number;\r\n\t\tfloatValue: number;\r\n\t\tstringValue: string;\r\n\t\taudioPath: string;\r\n\t\tvolume: number;\r\n\t\tbalance: number;\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tthis.name = name;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BoneData } from \"./BoneData\";\r\nimport { ConstraintData } from \"./ConstraintData\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the setup pose for an {@link IkConstraint}.\r\n\t * <p>\r\n\t * See [IK constraints](http://esotericsoftware.com/spine-ik-constraints) in the Spine User Guide. */\r\n\texport class IkConstraintData extends ConstraintData {\r\n\t\t/** The bones that are constrained by this IK constraint. */\r\n\t\tbones = new Array<BoneData>();\r\n\r\n\t\t/** The bone that is the IK target. */\r\n\t\ttarget: BoneData;\r\n\r\n\t\t/** Controls the bend direction of the IK bones, either 1 or -1. */\r\n\t\tbendDirection = 1;\r\n\r\n\t\t/** When true and only a single bone is being constrained, if the target is too close, the bone is scaled to reach it. */\r\n\t\tcompress = false;\r\n\r\n\t\t/** When true, if the target is out of range, the parent bone is scaled to reach it. If more than one bone is being constrained\r\n\t\t * and the parent bone has local nonuniform scale, stretch is not applied. */\r\n\t\tstretch = false;\r\n\r\n\t\t/** When true, only a single bone is being constrained, and {@link #getCompress()} or {@link #getStretch()} is used, the bone\r\n\t\t * is scaled on both the X and Y axes. */\r\n\t\tuniform = false;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained rotations. */\r\n\t\tmix = 1;\r\n\r\n\t\t/** For two bone IK, the distance from the maximum reach of the bones that rotation will slow. */\r\n\t\tsoftness = 0;\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name, 0, false);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BoneData } from \"./BoneData\";\r\nimport { EventData } from \"./EventData\";\r\nimport { IkConstraintData } from \"./IkConstraintData\";\r\nimport { PathConstraintData } from \"./PathConstraintData\";\r\nimport { Skin } from \"./Skin\";\r\nimport { SlotData } from \"./SlotData\";\r\nimport {Animation } from \"./Animation\";\r\nimport { TransformConstraintData } from \"./TransformConstraintData\";\r\n\r\n// module spine {\r\n\t/** Stores the setup pose and all of the stateless data for a skeleton.\r\n\t *\r\n\t * See [Data objects](http://esotericsoftware.com/spine-runtime-architecture#Data-objects) in the Spine Runtimes\r\n\t * Guide. */\r\n\texport class SkeletonData {\r\n\r\n\t\t/** The skeleton's name, which by default is the name of the skeleton data file, if possible. May be null. */\r\n\t\tname: string;\r\n\r\n\t\t/** The skeleton's bones, sorted parent first. The root bone is always the first bone. */\r\n\t\tbones = new Array<BoneData>(); // Ordered parents first.\r\n\r\n\t\t/** The skeleton's slots. */\r\n\t\tslots = new Array<SlotData>(); // Setup pose draw order.\r\n\t\tskins = new Array<Skin>();\r\n\r\n\t\t/** The skeleton's default skin. By default this skin contains all attachments that were not in a skin in Spine.\r\n\t\t *\r\n\t\t * See {@link Skeleton#getAttachmentByName()}.\r\n\t\t * May be null. */\r\n\t\tdefaultSkin: Skin;\r\n\r\n\t\t/** The skeleton's events. */\r\n\t\tevents = new Array<EventData>();\r\n\r\n\t\t/** The skeleton's animations. */\r\n\t\tanimations = new Array<Animation>();\r\n\r\n\t\t/** The skeleton's IK constraints. */\r\n\t\tikConstraints = new Array<IkConstraintData>();\r\n\r\n\t\t/** The skeleton's transform constraints. */\r\n\t\ttransformConstraints = new Array<TransformConstraintData>();\r\n\r\n\t\t/** The skeleton's path constraints. */\r\n\t\tpathConstraints = new Array<PathConstraintData>();\r\n\r\n\t\t/** The X coordinate of the skeleton's axis aligned bounding box in the setup pose. */\r\n\t\tx: number;\r\n\r\n\t\t/** The Y coordinate of the skeleton's axis aligned bounding box in the setup pose. */\r\n\t\ty: number;\r\n\r\n\t\t/** The width of the skeleton's axis aligned bounding box in the setup pose. */\r\n\t\twidth: number;\r\n\r\n\t\t/** The height of the skeleton's axis aligned bounding box in the setup pose. */\r\n\t\theight: number;\r\n\r\n\t\t/** The Spine version used to export the skeleton data, or null. */\r\n\t\tversion: string;\r\n\r\n\t\t/** The skeleton data hash. This value will change if any of the skeleton data has changed. May be null. */\r\n\t\thash: string;\r\n\r\n\t\t// Nonessential\r\n\t\t/** The dopesheet FPS in Spine. Available only when nonessential data was exported. */\r\n\t\tfps = 0;\r\n\r\n\t\t/** The path to the images directory as defined in Spine. Available only when nonessential data was exported. May be null. */\r\n\t\timagesPath: string;\r\n\r\n\t\t/** The path to the audio directory as defined in Spine. Available only when nonessential data was exported. May be null. */\r\n\t\taudioPath: string;\r\n\r\n\t\t/** Finds a bone by comparing each bone's name. It is more efficient to cache the results of this method than to call it\r\n\t\t * multiple times.\r\n\t\t * @returns May be null. */\r\n\t\tfindBone (boneName: string) {\r\n\t\t\tif (boneName == null) throw new Error(\"boneName cannot be null.\");\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tif (bone.name == boneName) return bone;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfindBoneIndex (boneName: string) {\r\n\t\t\tif (boneName == null) throw new Error(\"boneName cannot be null.\");\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++)\r\n\t\t\t\tif (bones[i].name == boneName) return i;\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\t/** Finds a slot by comparing each slot's name. It is more efficient to cache the results of this method than to call it\r\n\t\t * multiple times.\r\n\t\t * @returns May be null. */\r\n\t\tfindSlot (slotName: string) {\r\n\t\t\tif (slotName == null) throw new Error(\"slotName cannot be null.\");\r\n\t\t\tlet slots = this.slots;\r\n\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\tlet slot = slots[i];\r\n\t\t\t\tif (slot.name == slotName) return slot;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfindSlotIndex (slotName: string) {\r\n\t\t\tif (slotName == null) throw new Error(\"slotName cannot be null.\");\r\n\t\t\tlet slots = this.slots;\r\n\t\t\tfor (let i = 0, n = slots.length; i < n; i++)\r\n\t\t\t\tif (slots[i].name == slotName) return i;\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\t/** Finds a skin by comparing each skin's name. It is more efficient to cache the results of this method than to call it\r\n\t\t * multiple times.\r\n\t\t * @returns May be null. */\r\n\t\tfindSkin (skinName: string) {\r\n\t\t\tif (skinName == null) throw new Error(\"skinName cannot be null.\");\r\n\t\t\tlet skins = this.skins;\r\n\t\t\tfor (let i = 0, n = skins.length; i < n; i++) {\r\n\t\t\t\tlet skin = skins[i];\r\n\t\t\t\tif (skin.name == skinName) return skin;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds an event by comparing each events's name. It is more efficient to cache the results of this method than to call it\r\n\t\t * multiple times.\r\n\t\t * @returns May be null. */\r\n\t\tfindEvent (eventDataName: string) {\r\n\t\t\tif (eventDataName == null) throw new Error(\"eventDataName cannot be null.\");\r\n\t\t\tlet events = this.events;\r\n\t\t\tfor (let i = 0, n = events.length; i < n; i++) {\r\n\t\t\t\tlet event = events[i];\r\n\t\t\t\tif (event.name == eventDataName) return event;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds an animation by comparing each animation's name. It is more efficient to cache the results of this method than to\r\n\t\t * call it multiple times.\r\n\t\t * @returns May be null. */\r\n\t\tfindAnimation (animationName: string) {\r\n\t\t\tif (animationName == null) throw new Error(\"animationName cannot be null.\");\r\n\t\t\tlet animations = this.animations;\r\n\t\t\tfor (let i = 0, n = animations.length; i < n; i++) {\r\n\t\t\t\tlet animation = animations[i];\r\n\t\t\t\tif (animation.name == animationName) return animation;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds an IK constraint by comparing each IK constraint's name. It is more efficient to cache the results of this method\r\n\t\t * than to call it multiple times.\r\n\t\t * @return May be null. */\r\n\t\tfindIkConstraint (constraintName: string) {\r\n\t\t\tif (constraintName == null) throw new Error(\"constraintName cannot be null.\");\r\n\t\t\tlet ikConstraints = this.ikConstraints;\r\n\t\t\tfor (let i = 0, n = ikConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = ikConstraints[i];\r\n\t\t\t\tif (constraint.name == constraintName) return constraint;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds a transform constraint by comparing each transform constraint's name. It is more efficient to cache the results of\r\n\t\t * this method than to call it multiple times.\r\n\t\t * @return May be null. */\r\n\t\tfindTransformConstraint (constraintName: string) {\r\n\t\t\tif (constraintName == null) throw new Error(\"constraintName cannot be null.\");\r\n\t\t\tlet transformConstraints = this.transformConstraints;\r\n\t\t\tfor (let i = 0, n = transformConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = transformConstraints[i];\r\n\t\t\t\tif (constraint.name == constraintName) return constraint;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds a path constraint by comparing each path constraint's name. It is more efficient to cache the results of this method\r\n\t\t * than to call it multiple times.\r\n\t\t * @return May be null. */\r\n\t\tfindPathConstraint (constraintName: string) {\r\n\t\t\tif (constraintName == null) throw new Error(\"constraintName cannot be null.\");\r\n\t\t\tlet pathConstraints = this.pathConstraints;\r\n\t\t\tfor (let i = 0, n = pathConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = pathConstraints[i];\r\n\t\t\t\tif (constraint.name == constraintName) return constraint;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfindPathConstraintIndex (pathConstraintName: string) {\r\n\t\t\tif (pathConstraintName == null) throw new Error(\"pathConstraintName cannot be null.\");\r\n\t\t\tlet pathConstraints = this.pathConstraints;\r\n\t\t\tfor (let i = 0, n = pathConstraints.length; i < n; i++)\r\n\t\t\t\tif (pathConstraints[i].name == pathConstraintName) return i;\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Attachment } from \"./attachments/Attachment\";\r\nimport { MeshAttachment } from \"./attachments/MeshAttachment\";\r\nimport { BoneData } from \"./BoneData\";\r\nimport { ConstraintData } from \"./ConstraintData\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Map } from \"./Utils\";\r\n\r\n// module spine {\r\n\t/** Stores an entry in the skin consisting of the slot index, name, and attachment **/\r\n\texport class SkinEntry {\r\n\t\tconstructor(public slotIndex: number, public name: string, public attachment: Attachment) { }\r\n\t}\r\n\r\n\t/** Stores attachments by slot index and attachment name.\r\n\t *\r\n\t * See SkeletonData {@link SkeletonData#defaultSkin}, Skeleton {@link Skeleton#skin}, and\r\n\t * [Runtime skins](http://esotericsoftware.com/spine-runtime-skins) in the Spine Runtimes Guide. */\r\n\texport class Skin {\r\n\t\t/** The skin's name, which is unique across all skins in the skeleton. */\r\n\t\tname: string;\r\n\r\n\t\tattachments = new Array<Map<Attachment>>();\r\n\t\tbones = Array<BoneData>();\r\n\t\tconstraints = new Array<ConstraintData>();\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tif (name == null) throw new Error(\"name cannot be null.\");\r\n\t\t\tthis.name = name;\r\n\t\t}\r\n\r\n\t\t/** Adds an attachment to the skin for the specified slot index and name. */\r\n\t\tsetAttachment (slotIndex: number, name: string, attachment: Attachment) {\r\n\t\t\tif (attachment == null) throw new Error(\"attachment cannot be null.\");\r\n\t\t\tlet attachments = this.attachments;\r\n\t\t\tif (slotIndex >= attachments.length) attachments.length = slotIndex + 1;\r\n\t\t\tif (!attachments[slotIndex]) attachments[slotIndex] = { };\r\n\t\t\tattachments[slotIndex][name] = attachment;\r\n\t\t}\r\n\r\n\t\t/** Adds all attachments, bones, and constraints from the specified skin to this skin. */\r\n\t\taddSkin (skin: Skin) {\r\n\t\t\tfor(let i = 0; i < skin.bones.length; i++) {\r\n\t\t\t\tlet bone = skin.bones[i];\r\n\t\t\t\tlet contained = false;\r\n\t\t\t\tfor (let j = 0; j < this.bones.length; j++) {\r\n\t\t\t\t\tif (this.bones[j] == bone) {\r\n\t\t\t\t\t\tcontained = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!contained) this.bones.push(bone);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < skin.constraints.length; i++) {\r\n\t\t\t\tlet constraint = skin.constraints[i];\r\n\t\t\t\tlet contained = false;\r\n\t\t\t\tfor (let j = 0; j < this.constraints.length; j++) {\r\n\t\t\t\t\tif (this.constraints[j] == constraint) {\r\n\t\t\t\t\t\tcontained = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!contained) this.constraints.push(constraint);\r\n\t\t\t}\r\n\r\n\t\t\tlet attachments = skin.getAttachments();\r\n\t\t\tfor (let i = 0; i < attachments.length; i++) {\r\n\t\t\t\tvar attachment = attachments[i];\r\n\t\t\t\tthis.setAttachment(attachment.slotIndex, attachment.name, attachment.attachment);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Adds all bones and constraints and copies of all attachments from the specified skin to this skin. Mesh attachments are not\r\n\t\t * copied, instead a new linked mesh is created. The attachment copies can be modified without affecting the originals. */\r\n\t\tcopySkin (skin: Skin) {\r\n\t\t\tfor(let i = 0; i < skin.bones.length; i++) {\r\n\t\t\t\tlet bone = skin.bones[i];\r\n\t\t\t\tlet contained = false;\r\n\t\t\t\tfor (let j = 0; j < this.bones.length; j++) {\r\n\t\t\t\t\tif (this.bones[j] == bone) {\r\n\t\t\t\t\t\tcontained = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!contained) this.bones.push(bone);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < skin.constraints.length; i++) {\r\n\t\t\t\tlet constraint = skin.constraints[i];\r\n\t\t\t\tlet contained = false;\r\n\t\t\t\tfor (let j = 0; j < this.constraints.length; j++) {\r\n\t\t\t\t\tif (this.constraints[j] == constraint) {\r\n\t\t\t\t\t\tcontained = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!contained) this.constraints.push(constraint);\r\n\t\t\t}\r\n\r\n\t\t\tlet attachments = skin.getAttachments();\r\n\t\t\tfor (let i = 0; i < attachments.length; i++) {\r\n\t\t\t\tvar attachment = attachments[i];\r\n\t\t\t\tif (attachment.attachment == null) continue;\r\n\t\t\t\tif (attachment.attachment instanceof MeshAttachment) {\r\n\t\t\t\t\tattachment.attachment = attachment.attachment.newLinkedMesh();\r\n\t\t\t\t\tthis.setAttachment(attachment.slotIndex, attachment.name, attachment.attachment);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tattachment.attachment = attachment.attachment.copy();\r\n\t\t\t\t\tthis.setAttachment(attachment.slotIndex, attachment.name, attachment.attachment);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Returns the attachment for the specified slot index and name, or null. */\r\n\t\tgetAttachment (slotIndex: number, name: string): Attachment {\r\n\t\t\tlet dictionary = this.attachments[slotIndex];\r\n\t\t\treturn dictionary ? dictionary[name] : null;\r\n\t\t}\r\n\r\n\t\t/** Removes the attachment in the skin for the specified slot index and name, if any. */\r\n\t\tremoveAttachment (slotIndex: number, name: string) {\r\n\t\t\tlet dictionary = this.attachments[slotIndex];\r\n\t\t\tif (dictionary) dictionary[name] = null;\r\n\t\t}\r\n\r\n\t\t/** Returns all attachments in this skin. */\r\n\t\tgetAttachments (): Array<SkinEntry> {\r\n\t\t\tlet entries = new Array<SkinEntry>();\r\n\t\t\tfor (var i = 0; i < this.attachments.length; i++) {\r\n\t\t\t\tlet slotAttachments = this.attachments[i];\r\n\t\t\t\tif (slotAttachments) {\r\n\t\t\t\t\tfor (let name in slotAttachments) {\r\n\t\t\t\t\t\tlet attachment = slotAttachments[name];\r\n\t\t\t\t\t\tif (attachment) entries.push(new SkinEntry(i, name, attachment));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn entries;\r\n\t\t}\r\n\r\n\t\t/** Returns all attachments in this skin for the specified slot index. */\r\n\t\tgetAttachmentsForSlot (slotIndex: number, attachments: Array<SkinEntry>) {\r\n\t\t\tlet slotAttachments = this.attachments[slotIndex];\r\n\t\t\tif (slotAttachments) {\r\n\t\t\t\tfor (let name in slotAttachments) {\r\n\t\t\t\t\tlet attachment = slotAttachments[name];\r\n\t\t\t\t\tif (attachment) attachments.push(new SkinEntry(slotIndex, name, attachment));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Clears all attachments, bones, and constraints. */\r\n\t\tclear () {\r\n\t\t\tthis.attachments.length = 0;\r\n\t\t\tthis.bones.length = 0;\r\n\t\t\tthis.constraints.length = 0;\r\n\t\t}\r\n\r\n\t\t/** Attach each attachment in this skin if the corresponding attachment in the old skin is currently attached. */\r\n\t\tattachAll (skeleton: Skeleton, oldSkin: Skin) {\r\n\t\t\tlet slotIndex = 0;\r\n\t\t\tfor (let i = 0; i < skeleton.slots.length; i++) {\r\n\t\t\t\tlet slot = skeleton.slots[i];\r\n\t\t\t\tlet slotAttachment = slot.getAttachment();\r\n\t\t\t\tif (slotAttachment && slotIndex < oldSkin.attachments.length) {\r\n\t\t\t\t\tlet dictionary = oldSkin.attachments[slotIndex];\r\n\t\t\t\t\tfor (let key in dictionary) {\r\n\t\t\t\t\t\tlet skinAttachment:Attachment = dictionary[key];\r\n\t\t\t\t\t\tif (slotAttachment == skinAttachment) {\r\n\t\t\t\t\t\t\tlet attachment = this.getAttachment(slotIndex, key);\r\n\t\t\t\t\t\t\tif (attachment != null) slot.setAttachment(attachment);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tslotIndex++;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BlendMode } from \"./BlendMode\";\r\nimport { BoneData } from \"./BoneData\";\r\nimport { Color } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the setup pose for a {@link Slot}. */\r\n\texport class SlotData {\r\n\r\n\t\t/** The index of the slot in {@link Skeleton#getSlots()}. */\r\n\t\tindex: number;\r\n\r\n\t\t/** The name of the slot, which is unique across all slots in the skeleton. */\r\n\t\tname: string;\r\n\r\n\t\t/** The bone this slot belongs to. */\r\n\t\tboneData: BoneData;\r\n\r\n\t\t/** The color used to tint the slot's attachment. If {@link #getDarkColor()} is set, this is used as the light color for two\r\n\t\t * color tinting. */\r\n\t\tcolor = new Color(1, 1, 1, 1);\r\n\r\n\t\t/** The dark color used to tint the slot's attachment for two color tinting, or null if two color tinting is not used. The dark\r\n\t\t * color's alpha is not used. */\r\n\t\tdarkColor: Color;\r\n\r\n\t\t/** The name of the attachment that is visible for this slot in the setup pose, or null if no attachment is visible. */\r\n\t\tattachmentName: string;\r\n\r\n\t\t/** The blend mode for drawing the slot's attachment. */\r\n\t\tblendMode: BlendMode;\r\n\r\n\t\tconstructor (index: number, name: string, boneData: BoneData) {\r\n\t\t\tif (index < 0) throw new Error(\"index must be >= 0.\");\r\n\t\t\tif (name == null) throw new Error(\"name cannot be null.\");\r\n\t\t\tif (boneData == null) throw new Error(\"boneData cannot be null.\");\r\n\t\t\tthis.index = index;\r\n\t\t\tthis.name = name;\r\n\t\t\tthis.boneData = boneData;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BoneData } from \"./BoneData\";\r\nimport { ConstraintData } from \"./ConstraintData\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the setup pose for a {@link TransformConstraint}.\r\n\t *\r\n\t * See [Transform constraints](http://esotericsoftware.com/spine-transform-constraints) in the Spine User Guide. */\r\n\texport class TransformConstraintData extends ConstraintData {\r\n\r\n\t\t/** The bones that will be modified by this transform constraint. */\r\n\t\tbones = new Array<BoneData>();\r\n\r\n\t\t/** The target bone whose world transform will be copied to the constrained bones. */\r\n\t\ttarget: BoneData;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained rotations. */\r\n\t\trotateMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained translations. */\r\n\t\ttranslateMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained scales. */\r\n\t\tscaleMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained shears. */\r\n\t\tshearMix = 0;\r\n\r\n\t\t/** An offset added to the constrained bone rotation. */\r\n\t\toffsetRotation = 0;\r\n\r\n\t\t/** An offset added to the constrained bone X translation. */\r\n\t\toffsetX = 0;\r\n\r\n\t\t/** An offset added to the constrained bone Y translation. */\r\n\t\toffsetY = 0;\r\n\r\n\t\t/** An offset added to the constrained bone scaleX. */\r\n\t\toffsetScaleX = 0;\r\n\r\n\t\t/** An offset added to the constrained bone scaleY. */\r\n\t\toffsetScaleY = 0;\r\n\r\n\t\t/** An offset added to the constrained bone shearY. */\r\n\t\toffsetShearY = 0;\r\n\r\n\t\trelative = false;\r\n\t\tlocal = false;\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name, 0, false);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Timeline, AttachmentTimeline, ColorTimeline, TwoColorTimeline, RotateTimeline, ScaleTimeline, ShearTimeline, TranslateTimeline, IkConstraintTimeline, TransformConstraintTimeline, PathConstraintSpacingTimeline, PathConstraintPositionTimeline, PathConstraintMixTimeline, DeformTimeline, DrawOrderTimeline, EventTimeline, CurveTimeline } from \"./Animation\";\r\nimport { VertexAttachment, Attachment } from \"./attachments/Attachment\";\r\nimport { AttachmentLoader } from \"./attachments/AttachmentLoader\";\r\nimport { AttachmentType } from \"./attachments/AttachmentType\";\r\nimport { MeshAttachment } from \"./attachments/MeshAttachment\";\r\nimport {Animation} from \"./Animation\";\r\nimport { BlendMode } from \"./BlendMode\";\r\nimport { TransformMode, BoneData } from \"./BoneData\";\r\nimport {Event } from \"./Event\";\r\nimport { EventData } from \"./EventData\";\r\nimport { IkConstraintData } from \"./IkConstraintData\";\r\nimport { PositionMode, SpacingMode, RotateMode, PathConstraintData } from \"./PathConstraintData\";\r\nimport { SkeletonData } from \"./SkeletonData\";\r\nimport { Skin } from \"./Skin\";\r\nimport { SlotData } from \"./SlotData\";\r\nimport { TransformConstraintData } from \"./TransformConstraintData\";\r\nimport { Color, Utils } from \"./Utils\";\r\n\r\n// module spine {\r\n\t/** Loads skeleton data in the Spine binary format.\r\n\t *\r\n\t * See [Spine binary format](http://esotericsoftware.com/spine-binary-format) and\r\n\t * [JSON and binary data](http://esotericsoftware.com/spine-loading-skeleton-data#JSON-and-binary-data) in the Spine\r\n\t * Runtimes Guide. */\r\n\texport class SkeletonBinary {\r\n\t\tstatic AttachmentTypeValues = [ 0 /*AttachmentType.Region*/, 1/*AttachmentType.BoundingBox*/, 2/*AttachmentType.Mesh*/, 3/*AttachmentType.LinkedMesh*/, 4/*AttachmentType.Path*/, 5/*AttachmentType.Point*/, 6/*AttachmentType.Clipping*/ ];\r\n\t\tstatic TransformModeValues = [TransformMode.Normal, TransformMode.OnlyTranslation, TransformMode.NoRotationOrReflection, TransformMode.NoScale, TransformMode.NoScaleOrReflection];\r\n\t\tstatic PositionModeValues = [ PositionMode.Fixed, PositionMode.Percent ];\r\n\t\tstatic SpacingModeValues = [ SpacingMode.Length, SpacingMode.Fixed, SpacingMode.Percent];\r\n\t\tstatic RotateModeValues = [ RotateMode.Tangent, RotateMode.Chain, RotateMode.ChainScale ];\r\n\t\tstatic BlendModeValues = [ BlendMode.Normal, BlendMode.Additive, BlendMode.Multiply, BlendMode.Screen];\r\n\r\n\t\tstatic BONE_ROTATE = 0;\r\n\t\tstatic BONE_TRANSLATE = 1;\r\n\t\tstatic BONE_SCALE = 2;\r\n\t\tstatic BONE_SHEAR = 3;\r\n\r\n\t\tstatic SLOT_ATTACHMENT = 0;\r\n\t\tstatic SLOT_COLOR = 1;\r\n\t\tstatic SLOT_TWO_COLOR = 2;\r\n\r\n\t\tstatic PATH_POSITION = 0;\r\n\t\tstatic PATH_SPACING = 1;\r\n\t\tstatic PATH_MIX = 2;\r\n\r\n\t\tstatic CURVE_LINEAR = 0;\r\n\t\tstatic CURVE_STEPPED = 1;\r\n\t\tstatic CURVE_BEZIER = 2;\r\n\r\n\t\t/** Scales bone positions, image sizes, and translations as they are loaded. This allows different size images to be used at\r\n\t\t * runtime than were used in Spine.\r\n\t\t *\r\n\t\t * See [Scaling](http://esotericsoftware.com/spine-loading-skeleton-data#Scaling) in the Spine Runtimes Guide. */\r\n\t\tscale = 1;\r\n\r\n\t\tattachmentLoader: AttachmentLoader;\r\n\t\tprivate linkedMeshes = new Array<LinkedMesh>();\r\n\r\n\t\tconstructor (attachmentLoader: AttachmentLoader) {\r\n\t\t\tthis.attachmentLoader = attachmentLoader;\r\n\t\t}\r\n\r\n\t\treadSkeletonData (binary: Uint8Array): SkeletonData {\r\n\t\t\tlet scale = this.scale;\r\n\r\n\t\t\tlet skeletonData = new SkeletonData();\r\n\t\t\tskeletonData.name = \"\"; // BOZO\r\n\r\n\t\t\tlet input = new BinaryInput(binary);\r\n\r\n\t\t\tskeletonData.hash = input.readString();\r\n\t\t\tskeletonData.version = input.readString();\r\n\t\t\tif (\"3.8.75\" == skeletonData.version)\r\n\t\t\t\t\tthrow new Error(\"Unsupported skeleton data, please export with a newer version of Spine.\");\r\n\t\t\tskeletonData.x = input.readFloat();\r\n\t\t\tskeletonData.y = input.readFloat();\r\n\t\t\tskeletonData.width = input.readFloat();\r\n\t\t\tskeletonData.height = input.readFloat();\r\n\r\n\t\t\tlet nonessential = input.readBoolean();\r\n\t\t\tif (nonessential) {\r\n\t\t\t\tskeletonData.fps = input.readFloat();\r\n\r\n\t\t\t\tskeletonData.imagesPath = input.readString();\r\n\t\t\t\tskeletonData.audioPath = input.readString();\r\n\t\t\t}\r\n\r\n\t\t\tlet n = 0;\r\n\t\t\t// Strings.\r\n\t\t\tn = input.readInt(true)\r\n\t\t\tfor (let i = 0; i < n; i++)\r\n\t\t\t\tinput.strings.push(input.readString());\r\n\r\n\t\t\t// Bones.\r\n\t\t\tn = input.readInt(true)\r\n\t\t\tfor (let i = 0; i < n; i++) {\r\n\t\t\t\tlet name = input.readString();\r\n\t\t\t\tlet parent = i == 0 ? null : skeletonData.bones[input.readInt(true)];\r\n\t\t\t\tlet data = new BoneData(i, name, parent);\r\n\t\t\t\tdata.rotation = input.readFloat();\r\n\t\t\t\tdata.x = input.readFloat() * scale;\r\n\t\t\t\tdata.y = input.readFloat() * scale;\r\n\t\t\t\tdata.scaleX = input.readFloat();\r\n\t\t\t\tdata.scaleY = input.readFloat();\r\n\t\t\t\tdata.shearX = input.readFloat();\r\n\t\t\t\tdata.shearY = input.readFloat();\r\n\t\t\t\tdata.length = input.readFloat() * scale;\r\n\t\t\t\tdata.transformMode = SkeletonBinary.TransformModeValues[input.readInt(true)];\r\n\t\t\t\tdata.skinRequired = input.readBoolean();\r\n\t\t\t\tif (nonessential) Color.rgba8888ToColor(data.color, input.readInt32());\r\n\t\t\t\tskeletonData.bones.push(data);\r\n\t\t\t}\r\n\r\n\t\t\t// Slots.\r\n\t\t\tn = input.readInt(true);\r\n\t\t\tfor (let i = 0; i < n; i++) {\r\n\t\t\t\tlet slotName = input.readString();\r\n\t\t\t\tlet boneData = skeletonData.bones[input.readInt(true)];\r\n\t\t\t\tlet data = new SlotData(i, slotName, boneData);\r\n\t\t\t\tColor.rgba8888ToColor(data.color, input.readInt32());\r\n\r\n\t\t\t\tlet darkColor = input.readInt32();\r\n\t\t\t\tif (darkColor != -1) Color.rgb888ToColor(data.darkColor = new Color(), darkColor);\r\n\r\n\t\t\t\tdata.attachmentName = input.readStringRef();\r\n\t\t\t\tdata.blendMode = SkeletonBinary.BlendModeValues[input.readInt(true)];\r\n\t\t\t\tskeletonData.slots.push(data);\r\n\t\t\t}\r\n\r\n\t\t\t// IK constraints.\r\n\t\t\tn = input.readInt(true);\r\n\t\t\tfor (let i = 0, nn; i < n; i++) {\r\n\t\t\t\tlet data = new IkConstraintData(input.readString());\r\n\t\t\t\tdata.order = input.readInt(true);\r\n\t\t\t\tdata.skinRequired = input.readBoolean();\r\n\t\t\t\tnn = input.readInt(true);\r\n\t\t\t\tfor (let ii = 0; ii < nn; ii++)\r\n\t\t\t\t\tdata.bones.push(skeletonData.bones[input.readInt(true)]);\r\n\t\t\t\tdata.target = skeletonData.bones[input.readInt(true)];\r\n\t\t\t\tdata.mix = input.readFloat();\r\n\t\t\t\tdata.softness = input.readFloat() * scale;\r\n\t\t\t\tdata.bendDirection = input.readByte();\r\n\t\t\t\tdata.compress = input.readBoolean();\r\n\t\t\t\tdata.stretch = input.readBoolean();\r\n\t\t\t\tdata.uniform = input.readBoolean();\r\n\t\t\t\tskeletonData.ikConstraints.push(data);\r\n\t\t\t}\r\n\r\n\t\t\t// Transform constraints.\r\n\t\t\tn = input.readInt(true);\r\n\t\t\tfor (let i = 0, nn; i < n; i++) {\r\n\t\t\t\tlet data = new TransformConstraintData(input.readString());\r\n\t\t\t\tdata.order = input.readInt(true);\r\n\t\t\t\tdata.skinRequired = input.readBoolean();\r\n\t\t\t\tnn = input.readInt(true);\r\n\t\t\t\tfor (let ii = 0; ii < nn; ii++)\r\n\t\t\t\t\tdata.bones.push(skeletonData.bones[input.readInt(true)]);\r\n\t\t\t\tdata.target = skeletonData.bones[input.readInt(true)];\r\n\t\t\t\tdata.local = input.readBoolean();\r\n\t\t\t\tdata.relative = input.readBoolean();\r\n\t\t\t\tdata.offsetRotation = input.readFloat();\r\n\t\t\t\tdata.offsetX = input.readFloat() * scale;\r\n\t\t\t\tdata.offsetY = input.readFloat() * scale;\r\n\t\t\t\tdata.offsetScaleX = input.readFloat();\r\n\t\t\t\tdata.offsetScaleY = input.readFloat();\r\n\t\t\t\tdata.offsetShearY = input.readFloat();\r\n\t\t\t\tdata.rotateMix = input.readFloat();\r\n\t\t\t\tdata.translateMix = input.readFloat();\r\n\t\t\t\tdata.scaleMix = input.readFloat();\r\n\t\t\t\tdata.shearMix = input.readFloat();\r\n\t\t\t\tskeletonData.transformConstraints.push(data);\r\n\t\t\t}\r\n\r\n\t\t\t// Path constraints.\r\n\t\t\tn = input.readInt(true);\r\n\t\t\tfor (let i = 0, nn; i < n; i++) {\r\n\t\t\t\tlet data = new PathConstraintData(input.readString());\r\n\t\t\t\tdata.order = input.readInt(true);\r\n\t\t\t\tdata.skinRequired = input.readBoolean();\r\n\t\t\t\tnn = input.readInt(true);\r\n\t\t\t\tfor (let ii = 0; ii < nn; ii++)\r\n\t\t\t\t\tdata.bones.push(skeletonData.bones[input.readInt(true)]);\r\n\t\t\t\tdata.target = skeletonData.slots[input.readInt(true)];\r\n\t\t\t\tdata.positionMode = SkeletonBinary.PositionModeValues[input.readInt(true)];\r\n\t\t\t\tdata.spacingMode = SkeletonBinary.SpacingModeValues[input.readInt(true)];\r\n\t\t\t\tdata.rotateMode = SkeletonBinary.RotateModeValues[input.readInt(true)];\r\n\t\t\t\tdata.offsetRotation = input.readFloat();\r\n\t\t\t\tdata.position = input.readFloat();\r\n\t\t\t\tif (data.positionMode == PositionMode.Fixed) data.position *= scale;\r\n\t\t\t\tdata.spacing = input.readFloat();\r\n\t\t\t\tif (data.spacingMode == SpacingMode.Length || data.spacingMode == SpacingMode.Fixed) data.spacing *= scale;\r\n\t\t\t\tdata.rotateMix = input.readFloat();\r\n\t\t\t\tdata.translateMix = input.readFloat();\r\n\t\t\t\tskeletonData.pathConstraints.push(data);\r\n\t\t\t}\r\n\r\n\t\t\t// Default skin.\r\n\t\t\tlet defaultSkin = this.readSkin(input, skeletonData, true, nonessential);\r\n\t\t\tif (defaultSkin != null) {\r\n\t\t\t\tskeletonData.defaultSkin = defaultSkin;\r\n\t\t\t\tskeletonData.skins.push(defaultSkin);\r\n\t\t\t}\r\n\r\n\t\t\t// Skins.\r\n\t\t\t{\r\n\t\t\t\tlet i = skeletonData.skins.length;\r\n\t\t\t\tUtils.setArraySize(skeletonData.skins, n = i + input.readInt(true));\r\n\t\t\t\tfor (; i < n; i++)\r\n\t\t\t\t\tskeletonData.skins[i] = this.readSkin(input, skeletonData, false, nonessential);\r\n\t\t\t}\r\n\r\n\t\t\t// Linked meshes.\r\n\t\t\tn = this.linkedMeshes.length;\r\n\t\t\tfor (let i = 0; i < n; i++) {\r\n\t\t\t\tlet linkedMesh = this.linkedMeshes[i];\r\n\t\t\t\tlet skin = linkedMesh.skin == null ? skeletonData.defaultSkin : skeletonData.findSkin(linkedMesh.skin);\r\n\t\t\t\tif (skin == null) throw new Error(\"Skin not found: \" + linkedMesh.skin);\r\n\t\t\t\tlet parent = skin.getAttachment(linkedMesh.slotIndex, linkedMesh.parent);\r\n\t\t\t\tif (parent == null) throw new Error(\"Parent mesh not found: \" + linkedMesh.parent);\r\n\t\t\t\tlinkedMesh.mesh.deformAttachment = linkedMesh.inheritDeform ? parent as VertexAttachment : linkedMesh.mesh;\r\n\t\t\t\tlinkedMesh.mesh.setParentMesh(parent as MeshAttachment);\r\n\t\t\t\tlinkedMesh.mesh.updateUVs();\r\n\t\t\t}\r\n\t\t\tthis.linkedMeshes.length = 0;\r\n\r\n\t\t\t// Events.\r\n\t\t\tn = input.readInt(true);\r\n\t\t\tfor (let i = 0; i < n; i++) {\r\n\t\t\t\tlet data = new EventData(input.readStringRef());\r\n\t\t\t\tdata.intValue = input.readInt(false);\r\n\t\t\t\tdata.floatValue = input.readFloat();\r\n\t\t\t\tdata.stringValue = input.readString();\r\n\t\t\t\tdata.audioPath = input.readString();\r\n\t\t\t\tif (data.audioPath != null) {\r\n\t\t\t\t\tdata.volume = input.readFloat();\r\n\t\t\t\t\tdata.balance = input.readFloat();\r\n\t\t\t\t}\r\n\t\t\t\tskeletonData.events.push(data);\r\n\t\t\t}\r\n\r\n\t\t\t// Animations.\r\n\t\t\tn = input.readInt(true);\r\n\t\t\tfor (let i = 0; i < n; i++)\r\n\t\t\t\tskeletonData.animations.push(this.readAnimation(input, input.readString(), skeletonData));\r\n\t\t\treturn skeletonData;\r\n\t\t}\r\n\r\n\t\tprivate readSkin (input: BinaryInput, skeletonData: SkeletonData, defaultSkin: boolean, nonessential: boolean): Skin {\r\n\t\t\tlet skin = null;\r\n\t\t\tlet slotCount = 0;\r\n\r\n\t\t\tif (defaultSkin) {\r\n\t\t\t\tslotCount = input.readInt(true)\r\n\t\t\t\tif (slotCount == 0) return null;\r\n\t\t\t\tskin = new Skin(\"default\");\r\n\t\t\t} else {\r\n\t\t\t\tskin = new Skin(input.readStringRef());\r\n\t\t\t\tskin.bones.length = input.readInt(true);\r\n\t\t\t\tfor (let i = 0, n = skin.bones.length; i < n; i++)\r\n\t\t\t\t\tskin.bones[i] = skeletonData.bones[input.readInt(true)];\r\n\r\n\t\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++)\r\n\t\t\t\t\tskin.constraints.push(skeletonData.ikConstraints[input.readInt(true)]);\r\n\t\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++)\r\n\t\t\t\t\tskin.constraints.push(skeletonData.transformConstraints[input.readInt(true)]);\r\n\t\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++)\r\n\t\t\t\t\tskin.constraints.push(skeletonData.pathConstraints[input.readInt(true)]);\r\n\r\n\t\t\t\tslotCount = input.readInt(true);\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = 0; i < slotCount; i++) {\r\n\t\t\t\tlet slotIndex = input.readInt(true);\r\n\t\t\t\tfor (let ii = 0, nn = input.readInt(true); ii < nn; ii++) {\r\n\t\t\t\t\tlet name = input.readStringRef();\r\n\t\t\t\t\tlet attachment = this.readAttachment(input, skeletonData, skin, slotIndex, name, nonessential);\r\n\t\t\t\t\tif (attachment != null) skin.setAttachment(slotIndex, name, attachment);\r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t\treturn skin;\r\n\t\t}\r\n\r\n\t\tprivate readAttachment(input: BinaryInput, skeletonData: SkeletonData, skin: Skin, slotIndex: number, attachmentName: string, nonessential: boolean): Attachment {\r\n\t\t\tlet scale = this.scale;\r\n\r\n\t\t\tlet name = input.readStringRef();\r\n\t\t\tif (name == null) name = attachmentName;\r\n\r\n\t\t\tlet typeIndex = input.readByte();\r\n\t\t\tlet type = SkeletonBinary.AttachmentTypeValues[typeIndex];\r\n\t\t\tswitch (type) {\r\n\t\t\tcase AttachmentType.Region: {\r\n\t\t\t\tlet path = input.readStringRef();\r\n\t\t\t\tlet rotation = input.readFloat();\r\n\t\t\t\tlet x = input.readFloat();\r\n\t\t\t\tlet y = input.readFloat();\r\n\t\t\t\tlet scaleX = input.readFloat();\r\n\t\t\t\tlet scaleY = input.readFloat();\r\n\t\t\t\tlet width = input.readFloat();\r\n\t\t\t\tlet height = input.readFloat();\r\n\t\t\t\tlet color = input.readInt32();\r\n\r\n\t\t\t\tif (path == null) path = name;\r\n\t\t\t\tlet region = this.attachmentLoader.newRegionAttachment(skin, name, path);\r\n\t\t\t\tif (region == null) return null;\r\n\t\t\t\tregion.path = path;\r\n\t\t\t\tregion.x = x * scale;\r\n\t\t\t\tregion.y = y * scale;\r\n\t\t\t\tregion.scaleX = scaleX;\r\n\t\t\t\tregion.scaleY = scaleY;\r\n\t\t\t\tregion.rotation = rotation;\r\n\t\t\t\tregion.width = width * scale;\r\n\t\t\t\tregion.height = height * scale;\r\n\t\t\t\tColor.rgba8888ToColor(region.color, color);\r\n\t\t\t\tregion.updateOffset();\r\n\t\t\t\treturn region;\r\n\t\t\t}\r\n\t\t\tcase AttachmentType.BoundingBox: {\r\n\t\t\t\tlet vertexCount = input.readInt(true);\r\n\t\t\t\tlet vertices = this.readVertices(input, vertexCount);\r\n\t\t\t\tlet color = nonessential ? input.readInt32() : 0;\r\n\r\n\t\t\t\tlet box = this.attachmentLoader.newBoundingBoxAttachment(skin, name);\r\n\t\t\t\tif (box == null) return null;\r\n\t\t\t\tbox.worldVerticesLength = vertexCount << 1;\r\n\t\t\t\tbox.vertices = vertices.vertices;\r\n\t\t\t\tbox.bones = vertices.bones;\r\n\t\t\t\tif (nonessential) Color.rgba8888ToColor(box.color, color);\r\n\t\t\t\treturn box;\r\n\t\t\t}\r\n\t\t\tcase AttachmentType.Mesh: {\r\n\t\t\t\tlet path = input.readStringRef();\r\n\t\t\t\tlet color = input.readInt32();\r\n\t\t\t\tlet vertexCount = input.readInt(true);\r\n\t\t\t\tlet uvs = this.readFloatArray(input, vertexCount << 1, 1);\r\n\t\t\t\tlet triangles = this.readShortArray(input);\r\n\t\t\t\tlet vertices = this.readVertices(input, vertexCount);\r\n\t\t\t\tlet hullLength = input.readInt(true);\r\n\t\t\t\tlet edges = null;\r\n\t\t\t\tlet width = 0, height = 0;\r\n\t\t\t\tif (nonessential) {\r\n\t\t\t\t\tedges = this.readShortArray(input);\r\n\t\t\t\t\twidth = input.readFloat();\r\n\t\t\t\t\theight = input.readFloat();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (path == null) path = name;\r\n\t\t\t\tlet mesh = this.attachmentLoader.newMeshAttachment(skin, name, path);\r\n\t\t\t\tif (mesh == null) return null;\r\n\t\t\t\tmesh.path = path;\r\n\t\t\t\tColor.rgba8888ToColor(mesh.color, color);\r\n\t\t\t\tmesh.bones = vertices.bones;\r\n\t\t\t\tmesh.vertices = vertices.vertices;\r\n\t\t\t\tmesh.worldVerticesLength = vertexCount << 1;\r\n\t\t\t\tmesh.triangles = triangles;\r\n\t\t\t\tmesh.regionUVs = uvs;\r\n\t\t\t\tmesh.updateUVs();\r\n\t\t\t\tmesh.hullLength = hullLength << 1;\r\n\t\t\t\tif (nonessential) {\r\n\t\t\t\t\tmesh.edges = edges;\r\n\t\t\t\t\tmesh.width = width * scale;\r\n\t\t\t\t\tmesh.height = height * scale;\r\n\t\t\t\t}\r\n\t\t\t\treturn mesh;\r\n\t\t\t}\r\n\t\t\tcase AttachmentType.LinkedMesh: {\r\n\t\t\t\tlet path = input.readStringRef();\r\n\t\t\t\tlet color = input.readInt32();\r\n\t\t\t\tlet skinName = input.readStringRef();\r\n\t\t\t\tlet parent = input.readStringRef();\r\n\t\t\t\tlet inheritDeform = input.readBoolean();\r\n\t\t\t\tlet width = 0, height = 0;\r\n\t\t\t\tif (nonessential) {\r\n\t\t\t\t\twidth = input.readFloat();\r\n\t\t\t\t\theight = input.readFloat();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (path == null) path = name;\r\n\t\t\t\tlet mesh = this.attachmentLoader.newMeshAttachment(skin, name, path);\r\n\t\t\t\tif (mesh == null) return null;\r\n\t\t\t\tmesh.path = path;\r\n\t\t\t\tColor.rgba8888ToColor(mesh.color, color);\r\n\t\t\t\tif (nonessential) {\r\n\t\t\t\t\tmesh.width = width * scale;\r\n\t\t\t\t\tmesh.height = height * scale;\r\n\t\t\t\t}\r\n\t\t\t\tthis.linkedMeshes.push(new LinkedMesh(mesh, skinName, slotIndex, parent, inheritDeform));\r\n\t\t\t\treturn mesh;\r\n\t\t\t}\r\n\t\t\tcase AttachmentType.Path: {\r\n\t\t\t\tlet closed = input.readBoolean();\r\n\t\t\t\tlet constantSpeed = input.readBoolean();\r\n\t\t\t\tlet vertexCount = input.readInt(true);\r\n\t\t\t\tlet vertices = this.readVertices(input, vertexCount);\r\n\t\t\t\tlet lengths = Utils.newArray(vertexCount / 3, 0);\r\n\t\t\t\tfor (let i = 0, n = lengths.length; i < n; i++)\r\n\t\t\t\t\tlengths[i] = input.readFloat() * scale;\r\n\t\t\t\tlet color = nonessential ? input.readInt32() : 0;\r\n\r\n\t\t\t\tlet path = this.attachmentLoader.newPathAttachment(skin, name);\r\n\t\t\t\tif (path == null) return null;\r\n\t\t\t\tpath.closed = closed;\r\n\t\t\t\tpath.constantSpeed = constantSpeed;\r\n\t\t\t\tpath.worldVerticesLength = vertexCount << 1;\r\n\t\t\t\tpath.vertices = vertices.vertices;\r\n\t\t\t\tpath.bones = vertices.bones;\r\n\t\t\t\tpath.lengths = lengths;\r\n\t\t\t\tif (nonessential) Color.rgba8888ToColor(path.color, color);\r\n\t\t\t\treturn path;\r\n\t\t\t}\r\n\t\t\tcase AttachmentType.Point: {\r\n\t\t\t\tlet rotation = input.readFloat();\r\n\t\t\t\tlet x = input.readFloat();\r\n\t\t\t\tlet y = input.readFloat();\r\n\t\t\t\tlet color = nonessential ? input.readInt32() : 0;\r\n\r\n\t\t\t\tlet point = this.attachmentLoader.newPointAttachment(skin, name);\r\n\t\t\t\tif (point == null) return null;\r\n\t\t\t\tpoint.x = x * scale;\r\n\t\t\t\tpoint.y = y * scale;\r\n\t\t\t\tpoint.rotation = rotation;\r\n\t\t\t\tif (nonessential) Color.rgba8888ToColor(point.color, color);\r\n\t\t\t\treturn point;\r\n\t\t\t}\r\n\t\t\tcase AttachmentType.Clipping: {\r\n\t\t\t\tlet endSlotIndex = input.readInt(true);\r\n\t\t\t\tlet vertexCount = input.readInt(true);\r\n\t\t\t\tlet vertices = this.readVertices(input, vertexCount);\r\n\t\t\t\tlet color = nonessential ? input.readInt32() : 0;\r\n\r\n\t\t\t\tlet clip = this.attachmentLoader.newClippingAttachment(skin, name);\r\n\t\t\t\tif (clip == null) return null;\r\n\t\t\t\tclip.endSlot = skeletonData.slots[endSlotIndex];\r\n\t\t\t\tclip.worldVerticesLength = vertexCount << 1;\r\n\t\t\t\tclip.vertices = vertices.vertices;\r\n\t\t\t\tclip.bones = vertices.bones;\r\n\t\t\t\tif (nonessential) Color.rgba8888ToColor(clip.color, color);\r\n\t\t\t\treturn clip;\r\n\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tprivate readVertices (input: BinaryInput, vertexCount: number): Vertices {\r\n\t\t\tlet verticesLength = vertexCount << 1;\r\n\t\t\tlet vertices = new Vertices();\r\n\t\t\tlet scale = this.scale;\r\n\t\t\tif (!input.readBoolean()) {\r\n\t\t\t\tvertices.vertices = this.readFloatArray(input, verticesLength, scale);\r\n\t\t\t\treturn vertices;\r\n\t\t\t}\r\n\t\t\tlet weights = new Array<number>();\r\n\t\t\tlet bonesArray = new Array<number>();\r\n\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\tlet boneCount = input.readInt(true);\r\n\t\t\t\tbonesArray.push(boneCount);\r\n\t\t\t\tfor (let ii = 0; ii < boneCount; ii++) {\r\n\t\t\t\t\tbonesArray.push(input.readInt(true));\r\n\t\t\t\t\tweights.push(input.readFloat() * scale);\r\n\t\t\t\t\tweights.push(input.readFloat() * scale);\r\n\t\t\t\t\tweights.push(input.readFloat());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvertices.vertices = Utils.toFloatArray(weights);\r\n\t\t\tvertices.bones = bonesArray;\r\n\t\t\treturn vertices;\r\n\t\t}\r\n\r\n\t\tprivate readFloatArray (input: BinaryInput, n: number, scale: number): number[] {\r\n\t\t\tlet array = new Array<number>(n);\r\n\t\t\tif (scale == 1) {\r\n\t\t\t\tfor (let i = 0; i < n; i++)\r\n\t\t\t\t\tarray[i] = input.readFloat();\r\n\t\t\t} else {\r\n\t\t\t\tfor (let i = 0; i < n; i++)\r\n\t\t\t\t\tarray[i] = input.readFloat() * scale;\r\n\t\t\t}\r\n\t\t\treturn array;\r\n\t\t}\r\n\r\n\t\tprivate readShortArray (input: BinaryInput): number[] {\r\n\t\t\tlet n = input.readInt(true);\r\n\t\t\tlet array = new Array<number>(n);\r\n\t\t\tfor (let i = 0; i < n; i++)\r\n\t\t\t\tarray[i] = input.readShort();\r\n\t\t\treturn array;\r\n\t\t}\r\n\r\n\t\tprivate readAnimation (input: BinaryInput, name: string, skeletonData: SkeletonData): Animation {\r\n\t\t\tlet timelines = new Array<Timeline>();\r\n\t\t\tlet scale = this.scale;\r\n\t\t\tlet duration = 0;\r\n\t\t\tlet tempColor1 = new Color();\r\n\t\t\tlet tempColor2 = new Color();\r\n\r\n\t\t\t// Slot timelines.\r\n\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++) {\r\n\t\t\t\tlet slotIndex = input.readInt(true);\r\n\t\t\t\tfor (let ii = 0, nn = input.readInt(true); ii < nn; ii++) {\r\n\t\t\t\t\tlet timelineType = input.readByte();\r\n\t\t\t\t\tlet frameCount = input.readInt(true);\r\n\t\t\t\t\tswitch (timelineType) {\r\n\t\t\t\t\tcase SkeletonBinary.SLOT_ATTACHMENT: {\r\n\t\t\t\t\t\tlet timeline = new AttachmentTimeline(frameCount);\r\n\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++)\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readStringRef());\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[frameCount - 1]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcase SkeletonBinary.SLOT_COLOR: {\r\n\t\t\t\t\t\tlet timeline = new ColorTimeline(frameCount);\r\n\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\tlet time = input.readFloat();\r\n\t\t\t\t\t\t\tColor.rgba8888ToColor(tempColor1, input.readInt32());\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, time, tempColor1.r, tempColor1.g, tempColor1.b, tempColor1.a);\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * ColorTimeline.ENTRIES]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcase SkeletonBinary.SLOT_TWO_COLOR: {\r\n\t\t\t\t\t\tlet timeline = new TwoColorTimeline(frameCount);\r\n\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\tlet time = input.readFloat();\r\n\t\t\t\t\t\t\tColor.rgba8888ToColor(tempColor1, input.readInt32());\r\n\t\t\t\t\t\t\tColor.rgb888ToColor(tempColor2, input.readInt32());\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, time, tempColor1.r, tempColor1.g, tempColor1.b, tempColor1.a, tempColor2.r,\r\n\t\t\t\t\t\t\t\ttempColor2.g, tempColor2.b);\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * TwoColorTimeline.ENTRIES]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Bone timelines.\r\n\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++) {\r\n\t\t\t\tlet boneIndex = input.readInt(true);\r\n\t\t\t\tfor (let ii = 0, nn = input.readInt(true); ii < nn; ii++) {\r\n\t\t\t\t\tlet timelineType = input.readByte();\r\n\t\t\t\t\tlet frameCount = input.readInt(true);\r\n\t\t\t\t\tswitch (timelineType) {\r\n\t\t\t\t\tcase SkeletonBinary.BONE_ROTATE: {\r\n\t\t\t\t\t\tlet timeline = new RotateTimeline(frameCount);\r\n\t\t\t\t\t\ttimeline.boneIndex = boneIndex;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readFloat());\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * RotateTimeline.ENTRIES]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcase SkeletonBinary.BONE_TRANSLATE:\r\n\t\t\t\t\tcase SkeletonBinary.BONE_SCALE:\r\n\t\t\t\t\tcase SkeletonBinary.BONE_SHEAR: {\r\n\t\t\t\t\t\tlet timeline;\r\n\t\t\t\t\t\tlet timelineScale = 1;\r\n\t\t\t\t\t\tif (timelineType == SkeletonBinary.BONE_SCALE)\r\n\t\t\t\t\t\t\ttimeline = new ScaleTimeline(frameCount);\r\n\t\t\t\t\t\telse if (timelineType == SkeletonBinary.BONE_SHEAR)\r\n\t\t\t\t\t\t\ttimeline = new ShearTimeline(frameCount);\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\ttimeline = new TranslateTimeline(frameCount);\r\n\t\t\t\t\t\t\ttimelineScale = scale;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimeline.boneIndex = boneIndex;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readFloat() * timelineScale,\r\n\t\t\t\t\t\t\t\tinput.readFloat() * timelineScale);\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * TranslateTimeline.ENTRIES]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// IK constraint timelines.\r\n\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++) {\r\n\t\t\t\tlet index = input.readInt(true);\r\n\t\t\t\tlet frameCount = input.readInt(true);\r\n\t\t\t\tlet timeline = new IkConstraintTimeline(frameCount);\r\n\t\t\t\ttimeline.ikConstraintIndex = index;\r\n\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readFloat(), input.readFloat() * scale, input.readByte(), input.readBoolean(),\r\n\t\t\t\t\t\tinput.readBoolean());\r\n\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t}\r\n\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * IkConstraintTimeline.ENTRIES]);\r\n\t\t\t}\r\n\r\n\t\t\t// Transform constraint timelines.\r\n\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++) {\r\n\t\t\t\tlet index = input.readInt(true);\r\n\t\t\t\tlet frameCount = input.readInt(true);\r\n\t\t\t\tlet timeline = new TransformConstraintTimeline(frameCount);\r\n\t\t\t\ttimeline.transformConstraintIndex = index;\r\n\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readFloat(), input.readFloat(), input.readFloat(),\r\n\t\t\t\t\t\tinput.readFloat());\r\n\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t}\r\n\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * TransformConstraintTimeline.ENTRIES]);\r\n\t\t\t}\r\n\r\n\t\t\t// Path constraint timelines.\r\n\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++) {\r\n\t\t\t\tlet index = input.readInt(true);\r\n\t\t\t\tlet data = skeletonData.pathConstraints[index];\r\n\t\t\t\tfor (let ii = 0, nn = input.readInt(true); ii < nn; ii++) {\r\n\t\t\t\t\tlet timelineType = input.readByte();\r\n\t\t\t\t\tlet frameCount = input.readInt(true);\r\n\t\t\t\t\tswitch (timelineType) {\r\n\t\t\t\t\tcase SkeletonBinary.PATH_POSITION:\r\n\t\t\t\t\tcase SkeletonBinary.PATH_SPACING: {\r\n\t\t\t\t\t\tlet timeline;\r\n\t\t\t\t\t\tlet timelineScale = 1;\r\n\t\t\t\t\t\tif (timelineType == SkeletonBinary.PATH_SPACING) {\r\n\t\t\t\t\t\t\ttimeline = new PathConstraintSpacingTimeline(frameCount);\r\n\t\t\t\t\t\t\tif (data.spacingMode == SpacingMode.Length || data.spacingMode == SpacingMode.Fixed) timelineScale = scale;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttimeline = new PathConstraintPositionTimeline(frameCount);\r\n\t\t\t\t\t\t\tif (data.positionMode == PositionMode.Fixed) timelineScale = scale;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimeline.pathConstraintIndex = index;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readFloat() * timelineScale);\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * PathConstraintPositionTimeline.ENTRIES]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcase SkeletonBinary.PATH_MIX: {\r\n\t\t\t\t\t\tlet timeline = new PathConstraintMixTimeline(frameCount);\r\n\t\t\t\t\t\ttimeline.pathConstraintIndex = index;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readFloat(), input.readFloat());\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * PathConstraintMixTimeline.ENTRIES]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Deform timelines.\r\n\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++) {\r\n\t\t\t\tlet skin = skeletonData.skins[input.readInt(true)];\r\n\t\t\t\tfor (let ii = 0, nn = input.readInt(true); ii < nn; ii++) {\r\n\t\t\t\t\tlet slotIndex = input.readInt(true);\r\n\t\t\t\t\tfor (let iii = 0, nnn = input.readInt(true); iii < nnn; iii++) {\r\n\t\t\t\t\t\tlet attachment = skin.getAttachment(slotIndex, input.readStringRef()) as VertexAttachment;\r\n\t\t\t\t\t\tlet weighted = attachment.bones != null;\r\n\t\t\t\t\t\tlet vertices = attachment.vertices;\r\n\t\t\t\t\t\tlet deformLength = weighted ? vertices.length / 3 * 2 : vertices.length;\r\n\r\n\t\t\t\t\t\tlet frameCount = input.readInt(true);\r\n\t\t\t\t\t\tlet timeline = new DeformTimeline(frameCount);\r\n\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\t\t\t\t\t\ttimeline.attachment = attachment;\r\n\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\tlet time = input.readFloat();\r\n\t\t\t\t\t\t\tlet deform;\r\n\t\t\t\t\t\t\tlet end = input.readInt(true);\r\n\t\t\t\t\t\t\tif (end == 0)\r\n\t\t\t\t\t\t\t\tdeform = weighted ? Utils.newFloatArray(deformLength) : vertices;\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tdeform = Utils.newFloatArray(deformLength);\r\n\t\t\t\t\t\t\t\tlet start = input.readInt(true);\r\n\t\t\t\t\t\t\t\tend += start;\r\n\t\t\t\t\t\t\t\tif (scale == 1) {\r\n\t\t\t\t\t\t\t\t\tfor (let v = start; v < end; v++)\r\n\t\t\t\t\t\t\t\t\t\tdeform[v] = input.readFloat();\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfor (let v = start; v < end; v++)\r\n\t\t\t\t\t\t\t\t\t\tdeform[v] = input.readFloat() * scale;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (!weighted) {\r\n\t\t\t\t\t\t\t\t\tfor (let v = 0, vn = deform.length; v < vn; v++)\r\n\t\t\t\t\t\t\t\t\t\tdeform[v] += vertices[v];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, time, deform);\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[frameCount - 1]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Draw order timeline.\r\n\t\t\tlet drawOrderCount = input.readInt(true);\r\n\t\t\tif (drawOrderCount > 0) {\r\n\t\t\t\tlet timeline = new DrawOrderTimeline(drawOrderCount);\r\n\t\t\t\tlet slotCount = skeletonData.slots.length;\r\n\t\t\t\tfor (let i = 0; i < drawOrderCount; i++) {\r\n\t\t\t\t\tlet time = input.readFloat();\r\n\t\t\t\t\tlet offsetCount = input.readInt(true);\r\n\t\t\t\t\tlet drawOrder = Utils.newArray(slotCount, 0);\r\n\t\t\t\t\tfor (let ii = slotCount - 1; ii >= 0; ii--)\r\n\t\t\t\t\t\tdrawOrder[ii] = -1;\r\n\t\t\t\t\tlet unchanged = Utils.newArray(slotCount - offsetCount, 0);\r\n\t\t\t\t\tlet originalIndex = 0, unchangedIndex = 0;\r\n\t\t\t\t\tfor (let ii = 0; ii < offsetCount; ii++) {\r\n\t\t\t\t\t\tlet slotIndex = input.readInt(true);\r\n\t\t\t\t\t\t// Collect unchanged items.\r\n\t\t\t\t\t\twhile (originalIndex != slotIndex)\r\n\t\t\t\t\t\t\tunchanged[unchangedIndex++] = originalIndex++;\r\n\t\t\t\t\t\t// Set changed items.\r\n\t\t\t\t\t\tdrawOrder[originalIndex + input.readInt(true)] = originalIndex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Collect remaining unchanged items.\r\n\t\t\t\t\twhile (originalIndex < slotCount)\r\n\t\t\t\t\t\tunchanged[unchangedIndex++] = originalIndex++;\r\n\t\t\t\t\t// Fill in unchanged items.\r\n\t\t\t\t\tfor (let ii = slotCount - 1; ii >= 0; ii--)\r\n\t\t\t\t\t\tif (drawOrder[ii] == -1) drawOrder[ii] = unchanged[--unchangedIndex];\r\n\t\t\t\t\ttimeline.setFrame(i, time, drawOrder);\r\n\t\t\t\t}\r\n\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\tduration = Math.max(duration, timeline.frames[drawOrderCount - 1]);\r\n\t\t\t}\r\n\r\n\t\t\t// Event timeline.\r\n\t\t\tlet eventCount = input.readInt(true);\r\n\t\t\tif (eventCount > 0) {\r\n\t\t\t\tlet timeline = new EventTimeline(eventCount);\r\n\t\t\t\tfor (let i = 0; i < eventCount; i++) {\r\n\t\t\t\t\tlet time = input.readFloat();\r\n\t\t\t\t\tlet eventData = skeletonData.events[input.readInt(true)];\r\n\t\t\t\t\tlet event = new Event(time, eventData);\r\n\t\t\t\t\tevent.intValue = input.readInt(false);\r\n\t\t\t\t\tevent.floatValue = input.readFloat();\r\n\t\t\t\t\tevent.stringValue = input.readBoolean() ? input.readString() : eventData.stringValue;\r\n\t\t\t\t\tif (event.data.audioPath != null) {\r\n\t\t\t\t\t\tevent.volume = input.readFloat();\r\n\t\t\t\t\t\tevent.balance = input.readFloat();\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimeline.setFrame(i, event);\r\n\t\t\t\t}\r\n\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\tduration = Math.max(duration, timeline.frames[eventCount - 1]);\r\n\t\t\t}\r\n\r\n\t\t\treturn new Animation(name, timelines, duration);\r\n\t\t}\r\n\r\n\t\tprivate readCurve (input: BinaryInput, frameIndex: number, timeline: CurveTimeline) {\r\n\t\t\tswitch (input.readByte()) {\r\n\t\t\tcase SkeletonBinary.CURVE_STEPPED:\r\n\t\t\t\ttimeline.setStepped(frameIndex);\r\n\t\t\t\tbreak;\r\n\t\t\tcase SkeletonBinary.CURVE_BEZIER:\r\n\t\t\t\tthis.setCurve(timeline, frameIndex, input.readFloat(), input.readFloat(), input.readFloat(), input.readFloat());\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsetCurve (timeline: CurveTimeline, frameIndex: number, cx1: number, cy1: number, cx2: number, cy2: number) {\r\n\t\t\ttimeline.setCurve(frameIndex, cx1, cy1, cx2, cy2);\r\n\t\t}\r\n\t}\r\n\r\n\tclass BinaryInput {\r\n\t\tconstructor(data: Uint8Array, public strings = new Array<string>(), private index: number = 0, private buffer = new DataView(data.buffer)) {\r\n\r\n\t\t}\r\n\r\n\t\treadByte(): number {\r\n\t\t\treturn this.buffer.getInt8(this.index++);\r\n\t\t}\r\n\r\n\t\treadShort(): number {\r\n\t\t\tlet value = this.buffer.getInt16(this.index);\r\n\t\t\tthis.index += 2;\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\treadInt32(): number {\r\n\t\t\t let value = this.buffer.getInt32(this.index)\r\n\t\t\t this.index += 4;\r\n\t\t\t return value;\r\n\t\t}\r\n\r\n\t\treadInt(optimizePositive: boolean) {\r\n\t\t\tlet b = this.readByte();\r\n\t\t\tlet result = b & 0x7F;\r\n\t\t\tif ((b & 0x80) != 0) {\r\n\t\t\t\tb = this.readByte();\r\n\t\t\t\tresult |= (b & 0x7F) << 7;\r\n\t\t\t\tif ((b & 0x80) != 0) {\r\n\t\t\t\t\tb = this.readByte();\r\n\t\t\t\t\tresult |= (b & 0x7F) << 14;\r\n\t\t\t\t\tif ((b & 0x80) != 0) {\r\n\t\t\t\t\t\tb = this.readByte();\r\n\t\t\t\t\t\tresult |= (b & 0x7F) << 21;\r\n\t\t\t\t\t\tif ((b & 0x80) != 0) {\r\n\t\t\t\t\t\t\tb = this.readByte();\r\n\t\t\t\t\t\t\tresult |= (b & 0x7F) << 28;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn optimizePositive ? result : ((result >>> 1) ^ -(result & 1));\r\n\t\t}\r\n\r\n\t\treadStringRef (): string {\r\n\t\t\tlet index = this.readInt(true);\r\n\t\t\treturn index == 0 ? null : this.strings[index - 1];\r\n\t\t}\r\n\r\n\t\treadString (): string {\r\n\t\t\tlet byteCount = this.readInt(true);\r\n\t\t\tswitch (byteCount) {\r\n\t\t\tcase 0:\r\n\t\t\t\treturn null;\r\n\t\t\tcase 1:\r\n\t\t\t\treturn \"\";\r\n\t\t\t}\r\n\t\t\tbyteCount--;\r\n\t\t\tlet chars = \"\";\r\n\t\t\tlet charCount = 0;\r\n\t\t\tfor (let i = 0; i < byteCount;) {\r\n\t\t\t\tlet b = this.readByte();\r\n\t\t\t\tswitch (b >> 4) {\r\n\t\t\t\tcase 12:\r\n\t\t\t\tcase 13:\r\n\t\t\t\t\tchars += String.fromCharCode(((b & 0x1F) << 6 | this.readByte() & 0x3F));\r\n\t\t\t\t\ti += 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 14:\r\n\t\t\t\t\tchars += String.fromCharCode(((b & 0x0F) << 12 | (this.readByte() & 0x3F) << 6 | this.readByte() & 0x3F));\r\n\t\t\t\t\ti += 3;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tchars += String.fromCharCode(b);\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn chars;\r\n\t\t}\r\n\r\n\t\treadFloat (): number {\r\n\t\t\tlet value = this.buffer.getFloat32(this.index);\r\n\t\t\tthis.index += 4;\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\treadBoolean (): boolean {\r\n\t\t\treturn this.readByte() != 0;\r\n\t\t}\r\n\t}\r\n\r\n\tclass LinkedMesh {\r\n\t\tparent: string; skin: string;\r\n\t\tslotIndex: number;\r\n\t\tmesh: MeshAttachment;\r\n\t\tinheritDeform: boolean;\r\n\r\n\t\tconstructor (mesh: MeshAttachment, skin: string, slotIndex: number, parent: string, inheritDeform: boolean) {\r\n\t\t\tthis.mesh = mesh;\r\n\t\t\tthis.skin = skin;\r\n\t\t\tthis.slotIndex = slotIndex;\r\n\t\t\tthis.parent = parent;\r\n\t\t\tthis.inheritDeform = inheritDeform;\r\n\t\t}\r\n\t}\r\n\r\n\tclass Vertices {\r\n\t\tconstructor(public bones: Array<number> = null, public vertices: Array<number> | Float32Array = null) { }\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Timeline, AttachmentTimeline, ColorTimeline, TwoColorTimeline, RotateTimeline, TranslateTimeline, ScaleTimeline, ShearTimeline, IkConstraintTimeline, TransformConstraintTimeline, PathConstraintPositionTimeline, PathConstraintSpacingTimeline, PathConstraintMixTimeline, DeformTimeline, DrawOrderTimeline, EventTimeline, CurveTimeline } from \"./Animation\";\r\nimport { VertexAttachment, Attachment } from \"./attachments/Attachment\";\r\nimport { AttachmentLoader } from \"./attachments/AttachmentLoader\";\r\nimport { MeshAttachment } from \"./attachments/MeshAttachment\";\r\nimport { Event } from \"./Event\";\r\nimport { BlendMode } from \"./BlendMode\";\r\nimport { BoneData, TransformMode } from \"./BoneData\";\r\nimport { EventData } from \"./EventData\";\r\nimport { IkConstraintData } from \"./IkConstraintData\";\r\nimport { PathConstraintData, PositionMode, SpacingMode, RotateMode } from \"./PathConstraintData\";\r\nimport { SkeletonData } from \"./SkeletonData\";\r\nimport { Skin } from \"./Skin\";\r\nimport { SlotData } from \"./SlotData\";\r\nimport { TransformConstraintData } from \"./TransformConstraintData\";\r\nimport { Color, Utils, ArrayLike } from \"./Utils\";\r\nimport { Animation } from \"./Animation\";\r\n\r\n// module spine {\r\n\r\n\t/** Loads skeleton data in the Spine JSON format.\r\n\t *\r\n\t * See [Spine JSON format](http://esotericsoftware.com/spine-json-format) and\r\n\t * [JSON and binary data](http://esotericsoftware.com/spine-loading-skeleton-data#JSON-and-binary-data) in the Spine\r\n\t * Runtimes Guide. */\r\n\texport class SkeletonJson {\r\n\t\tattachmentLoader: AttachmentLoader;\r\n\r\n\t\t/** Scales bone positions, image sizes, and translations as they are loaded. This allows different size images to be used at\r\n\t\t * runtime than were used in Spine.\r\n\t\t *\r\n\t\t * See [Scaling](http://esotericsoftware.com/spine-loading-skeleton-data#Scaling) in the Spine Runtimes Guide. */\r\n\t\tscale = 1;\r\n\t\tprivate linkedMeshes = new Array<LinkedMesh>();\r\n\r\n\t\tconstructor (attachmentLoader: AttachmentLoader) {\r\n\t\t\tthis.attachmentLoader = attachmentLoader;\r\n\t\t}\r\n\r\n\t\treadSkeletonData (json: string | any): SkeletonData {\r\n\t\t\tlet scale = this.scale;\r\n\t\t\tlet skeletonData = new SkeletonData();\r\n\t\t\tlet root = typeof(json) === \"string\" ? JSON.parse(json) : json;\r\n\r\n\t\t\t// Skeleton\r\n\t\t\tlet skeletonMap = root.skeleton;\r\n\t\t\tif (skeletonMap != null) {\r\n\t\t\t\tskeletonData.hash = skeletonMap.hash;\r\n\t\t\t\tskeletonData.version = skeletonMap.spine;\r\n\t\t\t\tif (\"3.8.75\" == skeletonData.version)\r\n\t\t\t\t\tthrow new Error(\"Unsupported skeleton data, please export with a newer version of Spine.\");\r\n\t\t\t\tskeletonData.x = skeletonMap.x;\r\n\t\t\t\tskeletonData.y = skeletonMap.y;\r\n\t\t\t\tskeletonData.width = skeletonMap.width;\r\n\t\t\t\tskeletonData.height = skeletonMap.height;\r\n\t\t\t\tskeletonData.fps = skeletonMap.fps;\r\n\t\t\t\tskeletonData.imagesPath = skeletonMap.images;\r\n\t\t\t}\r\n\r\n\t\t\t// Bones\r\n\t\t\tif (root.bones) {\r\n\t\t\t\tfor (let i = 0; i < root.bones.length; i++) {\r\n\t\t\t\t\tlet boneMap = root.bones[i];\r\n\r\n\t\t\t\t\tlet parent: BoneData = null;\r\n\t\t\t\t\tlet parentName: string = this.getValue(boneMap, \"parent\", null);\r\n\t\t\t\t\tif (parentName != null) {\r\n\t\t\t\t\t\tparent = skeletonData.findBone(parentName);\r\n\t\t\t\t\t\tif (parent == null) throw new Error(\"Parent bone not found: \" + parentName);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet data = new BoneData(skeletonData.bones.length, boneMap.name, parent);\r\n\t\t\t\t\tdata.length = this.getValue(boneMap, \"length\", 0) * scale;\r\n\t\t\t\t\tdata.x = this.getValue(boneMap, \"x\", 0) * scale;\r\n\t\t\t\t\tdata.y = this.getValue(boneMap, \"y\", 0) * scale;\r\n\t\t\t\t\tdata.rotation = this.getValue(boneMap, \"rotation\", 0);\r\n\t\t\t\t\tdata.scaleX = this.getValue(boneMap, \"scaleX\", 1);\r\n\t\t\t\t\tdata.scaleY = this.getValue(boneMap, \"scaleY\", 1);\r\n\t\t\t\t\tdata.shearX = this.getValue(boneMap, \"shearX\", 0);\r\n\t\t\t\t\tdata.shearY = this.getValue(boneMap, \"shearY\", 0);\r\n\t\t\t\t\tdata.transformMode = SkeletonJson.transformModeFromString(this.getValue(boneMap, \"transform\", \"normal\"));\r\n\t\t\t\t\tdata.skinRequired = this.getValue(boneMap, \"skin\", false);\r\n\r\n\t\t\t\t\tskeletonData.bones.push(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Slots.\r\n\t\t\tif (root.slots) {\r\n\t\t\t\tfor (let i = 0; i < root.slots.length; i++) {\r\n\t\t\t\t\tlet slotMap = root.slots[i];\r\n\t\t\t\t\tlet slotName: string = slotMap.name;\r\n\t\t\t\t\tlet boneName: string = slotMap.bone;\r\n\t\t\t\t\tlet boneData = skeletonData.findBone(boneName);\r\n\t\t\t\t\tif (boneData == null) throw new Error(\"Slot bone not found: \" + boneName);\r\n\t\t\t\t\tlet data = new SlotData(skeletonData.slots.length, slotName, boneData);\r\n\r\n\t\t\t\t\tlet color: string = this.getValue(slotMap, \"color\", null);\r\n\t\t\t\t\tif (color != null) data.color.setFromString(color);\r\n\r\n\t\t\t\t\tlet dark: string = this.getValue(slotMap, \"dark\", null);\r\n\t\t\t\t\tif (dark != null) {\r\n\t\t\t\t\t\tdata.darkColor = new Color(1, 1, 1, 1);\r\n\t\t\t\t\t\tdata.darkColor.setFromString(dark);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdata.attachmentName = this.getValue(slotMap, \"attachment\", null);\r\n\t\t\t\t\tdata.blendMode = SkeletonJson.blendModeFromString(this.getValue(slotMap, \"blend\", \"normal\"));\r\n\t\t\t\t\tskeletonData.slots.push(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// IK constraints\r\n\t\t\tif (root.ik) {\r\n\t\t\t\tfor (let i = 0; i < root.ik.length; i++) {\r\n\t\t\t\t\tlet constraintMap = root.ik[i];\r\n\t\t\t\t\tlet data = new IkConstraintData(constraintMap.name);\r\n\t\t\t\t\tdata.order = this.getValue(constraintMap, \"order\", 0);\r\n\t\t\t\t\tdata.skinRequired = this.getValue(constraintMap, \"skin\", false);\r\n\r\n\t\t\t\t\tfor (let j = 0; j < constraintMap.bones.length; j++) {\r\n\t\t\t\t\t\tlet boneName = constraintMap.bones[j];\r\n\t\t\t\t\t\tlet bone = skeletonData.findBone(boneName);\r\n\t\t\t\t\t\tif (bone == null) throw new Error(\"IK bone not found: \" + boneName);\r\n\t\t\t\t\t\tdata.bones.push(bone);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet targetName: string = constraintMap.target;\r\n\t\t\t\t\tdata.target = skeletonData.findBone(targetName);\r\n\t\t\t\t\tif (data.target == null) throw new Error(\"IK target bone not found: \" + targetName);\r\n\r\n\t\t\t\t\tdata.mix = this.getValue(constraintMap, \"mix\", 1);\r\n\t\t\t\t\tdata.softness = this.getValue(constraintMap, \"softness\", 0) * scale;\r\n\t\t\t\t\tdata.bendDirection = this.getValue(constraintMap, \"bendPositive\", true) ? 1 : -1;\r\n\t\t\t\t\tdata.compress = this.getValue(constraintMap, \"compress\", false);\r\n\t\t\t\t\tdata.stretch = this.getValue(constraintMap, \"stretch\", false);\r\n\t\t\t\t\tdata.uniform = this.getValue(constraintMap, \"uniform\", false);\r\n\r\n\t\t\t\t\tskeletonData.ikConstraints.push(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Transform constraints.\r\n\t\t\tif (root.transform) {\r\n\t\t\t\tfor (let i = 0; i < root.transform.length; i++) {\r\n\t\t\t\t\tlet constraintMap = root.transform[i];\r\n\t\t\t\t\tlet data = new TransformConstraintData(constraintMap.name);\r\n\t\t\t\t\tdata.order = this.getValue(constraintMap, \"order\", 0);\r\n\t\t\t\t\tdata.skinRequired = this.getValue(constraintMap, \"skin\", false);\r\n\r\n\t\t\t\t\tfor (let j = 0; j < constraintMap.bones.length; j++) {\r\n\t\t\t\t\t\tlet boneName = constraintMap.bones[j];\r\n\t\t\t\t\t\tlet bone = skeletonData.findBone(boneName);\r\n\t\t\t\t\t\tif (bone == null) throw new Error(\"Transform constraint bone not found: \" + boneName);\r\n\t\t\t\t\t\tdata.bones.push(bone);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet targetName: string = constraintMap.target;\r\n\t\t\t\t\tdata.target = skeletonData.findBone(targetName);\r\n\t\t\t\t\tif (data.target == null) throw new Error(\"Transform constraint target bone not found: \" + targetName);\r\n\r\n\t\t\t\t\tdata.local = this.getValue(constraintMap, \"local\", false);\r\n\t\t\t\t\tdata.relative = this.getValue(constraintMap, \"relative\", false);\r\n\t\t\t\t\tdata.offsetRotation = this.getValue(constraintMap, \"rotation\", 0);\r\n\t\t\t\t\tdata.offsetX = this.getValue(constraintMap, \"x\", 0) * scale;\r\n\t\t\t\t\tdata.offsetY = this.getValue(constraintMap, \"y\", 0) * scale;\r\n\t\t\t\t\tdata.offsetScaleX = this.getValue(constraintMap, \"scaleX\", 0);\r\n\t\t\t\t\tdata.offsetScaleY = this.getValue(constraintMap, \"scaleY\", 0);\r\n\t\t\t\t\tdata.offsetShearY = this.getValue(constraintMap, \"shearY\", 0);\r\n\r\n\t\t\t\t\tdata.rotateMix = this.getValue(constraintMap, \"rotateMix\", 1);\r\n\t\t\t\t\tdata.translateMix = this.getValue(constraintMap, \"translateMix\", 1);\r\n\t\t\t\t\tdata.scaleMix = this.getValue(constraintMap, \"scaleMix\", 1);\r\n\t\t\t\t\tdata.shearMix = this.getValue(constraintMap, \"shearMix\", 1);\r\n\r\n\t\t\t\t\tskeletonData.transformConstraints.push(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Path constraints.\r\n\t\t\tif (root.path) {\r\n\t\t\t\tfor (let i = 0; i < root.path.length; i++) {\r\n\t\t\t\t\tlet constraintMap = root.path[i];\r\n\t\t\t\t\tlet data = new PathConstraintData(constraintMap.name);\r\n\t\t\t\t\tdata.order = this.getValue(constraintMap, \"order\", 0);\r\n\t\t\t\t\tdata.skinRequired = this.getValue(constraintMap, \"skin\", false);\r\n\r\n\t\t\t\t\tfor (let j = 0; j < constraintMap.bones.length; j++) {\r\n\t\t\t\t\t\tlet boneName = constraintMap.bones[j];\r\n\t\t\t\t\t\tlet bone = skeletonData.findBone(boneName);\r\n\t\t\t\t\t\tif (bone == null) throw new Error(\"Transform constraint bone not found: \" + boneName);\r\n\t\t\t\t\t\tdata.bones.push(bone);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet targetName: string = constraintMap.target;\r\n\t\t\t\t\tdata.target = skeletonData.findSlot(targetName);\r\n\t\t\t\t\tif (data.target == null) throw new Error(\"Path target slot not found: \" + targetName);\r\n\r\n\t\t\t\t\tdata.positionMode = SkeletonJson.positionModeFromString(this.getValue(constraintMap, \"positionMode\", \"percent\"));\r\n\t\t\t\t\tdata.spacingMode = SkeletonJson.spacingModeFromString(this.getValue(constraintMap, \"spacingMode\", \"length\"));\r\n\t\t\t\t\tdata.rotateMode = SkeletonJson.rotateModeFromString(this.getValue(constraintMap, \"rotateMode\", \"tangent\"));\r\n\t\t\t\t\tdata.offsetRotation = this.getValue(constraintMap, \"rotation\", 0);\r\n\t\t\t\t\tdata.position = this.getValue(constraintMap, \"position\", 0);\r\n\t\t\t\t\tif (data.positionMode == PositionMode.Fixed) data.position *= scale;\r\n\t\t\t\t\tdata.spacing = this.getValue(constraintMap, \"spacing\", 0);\r\n\t\t\t\t\tif (data.spacingMode == SpacingMode.Length || data.spacingMode == SpacingMode.Fixed) data.spacing *= scale;\r\n\t\t\t\t\tdata.rotateMix = this.getValue(constraintMap, \"rotateMix\", 1);\r\n\t\t\t\t\tdata.translateMix = this.getValue(constraintMap, \"translateMix\", 1);\r\n\r\n\t\t\t\t\tskeletonData.pathConstraints.push(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Skins.\r\n\t\t\tif (root.skins) {\r\n\t\t\t\tfor (let i = 0; i < root.skins.length; i++) {\r\n\t\t\t\t\tlet skinMap = root.skins[i]\r\n\t\t\t\t\tlet skin = new Skin(skinMap.name);\r\n\r\n\t\t\t\t\tif (skinMap.bones) {\r\n\t\t\t\t\t\tfor (let ii = 0; ii < skinMap.bones.length; ii++) {\r\n\t\t\t\t\t\t\tlet bone = skeletonData.findBone(skinMap.bones[ii]);\r\n\t\t\t\t\t\t\tif (bone == null) throw new Error(\"Skin bone not found: \" + skinMap.bones[i]);\r\n\t\t\t\t\t\t\tskin.bones.push(bone);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (skinMap.ik) {\r\n\t\t\t\t\t\tfor (let ii = 0; ii < skinMap.ik.length; ii++) {\r\n\t\t\t\t\t\t\tlet constraint = skeletonData.findIkConstraint(skinMap.ik[ii]);\r\n\t\t\t\t\t\t\tif (constraint == null) throw new Error(\"Skin IK constraint not found: \" + skinMap.ik[i]);\r\n\t\t\t\t\t\t\tskin.constraints.push(constraint);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (skinMap.transform) {\r\n\t\t\t\t\t\tfor (let ii = 0; ii < skinMap.transform.length; ii++) {\r\n\t\t\t\t\t\t\tlet constraint = skeletonData.findTransformConstraint(skinMap.transform[ii]);\r\n\t\t\t\t\t\t\tif (constraint == null) throw new Error(\"Skin transform constraint not found: \" + skinMap.transform[i]);\r\n\t\t\t\t\t\t\tskin.constraints.push(constraint);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (skinMap.path) {\r\n\t\t\t\t\t\tfor (let ii = 0; ii < skinMap.path.length; ii++) {\r\n\t\t\t\t\t\t\tlet constraint = skeletonData.findPathConstraint(skinMap.path[ii]);\r\n\t\t\t\t\t\t\tif (constraint == null) throw new Error(\"Skin path constraint not found: \" + skinMap.path[i]);\r\n\t\t\t\t\t\t\tskin.constraints.push(constraint);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (let slotName in skinMap.attachments) {\r\n\t\t\t\t\t\tlet slot = skeletonData.findSlot(slotName);\r\n\t\t\t\t\t\tif (slot == null) throw new Error(\"Slot not found: \" + slotName);\r\n\t\t\t\t\t\tlet slotMap = skinMap.attachments[slotName];\r\n\t\t\t\t\t\tfor (let entryName in slotMap) {\r\n\t\t\t\t\t\t\tlet attachment = this.readAttachment(slotMap[entryName], skin, slot.index, entryName, skeletonData);\r\n\t\t\t\t\t\t\tif (attachment != null) skin.setAttachment(slot.index, entryName, attachment);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tskeletonData.skins.push(skin);\r\n\t\t\t\t\tif (skin.name == \"default\") skeletonData.defaultSkin = skin;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Linked meshes.\r\n\t\t\tfor (let i = 0, n = this.linkedMeshes.length; i < n; i++) {\r\n\t\t\t\tlet linkedMesh = this.linkedMeshes[i];\r\n\t\t\t\tlet skin = linkedMesh.skin == null ? skeletonData.defaultSkin : skeletonData.findSkin(linkedMesh.skin);\r\n\t\t\t\tif (skin == null) throw new Error(\"Skin not found: \" + linkedMesh.skin);\r\n\t\t\t\tlet parent = skin.getAttachment(linkedMesh.slotIndex, linkedMesh.parent);\r\n\t\t\t\tif (parent == null) throw new Error(\"Parent mesh not found: \" + linkedMesh.parent);\r\n\t\t\t\tlinkedMesh.mesh.deformAttachment = linkedMesh.inheritDeform ? <VertexAttachment>parent : <VertexAttachment>linkedMesh.mesh;\r\n\t\t\t\tlinkedMesh.mesh.setParentMesh(<MeshAttachment> parent);\r\n\t\t\t\tlinkedMesh.mesh.updateUVs();\r\n\t\t\t}\r\n\t\t\tthis.linkedMeshes.length = 0;\r\n\r\n\t\t\t// Events.\r\n\t\t\tif (root.events) {\r\n\t\t\t\tfor (let eventName in root.events) {\r\n\t\t\t\t\tlet eventMap = root.events[eventName];\r\n\t\t\t\t\tlet data = new EventData(eventName);\r\n\t\t\t\t\tdata.intValue = this.getValue(eventMap, \"int\", 0);\r\n\t\t\t\t\tdata.floatValue = this.getValue(eventMap, \"float\", 0);\r\n\t\t\t\t\tdata.stringValue = this.getValue(eventMap, \"string\", \"\");\r\n\t\t\t\t\tdata.audioPath = this.getValue(eventMap, \"audio\", null);\r\n\t\t\t\t\tif (data.audioPath != null) {\r\n\t\t\t\t\t\tdata.volume = this.getValue(eventMap, \"volume\", 1);\r\n\t\t\t\t\t\tdata.balance = this.getValue(eventMap, \"balance\", 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tskeletonData.events.push(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Animations.\r\n\t\t\tif (root.animations) {\r\n\t\t\t\tfor (let animationName in root.animations) {\r\n\t\t\t\t\tlet animationMap = root.animations[animationName];\r\n\t\t\t\t\tthis.readAnimation(animationMap, animationName, skeletonData);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn skeletonData;\r\n\t\t}\r\n\r\n\t\treadAttachment (map: any, skin: Skin, slotIndex: number, name: string, skeletonData: SkeletonData): Attachment {\r\n\t\t\tlet scale = this.scale;\r\n\t\t\tname = this.getValue(map, \"name\", name);\r\n\r\n\t\t\tlet type = this.getValue(map, \"type\", \"region\");\r\n\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase \"region\": {\r\n\t\t\t\t\tlet path = this.getValue(map, \"path\", name);\r\n\t\t\t\t\tlet region = this.attachmentLoader.newRegionAttachment(skin, name, path);\r\n\t\t\t\t\tif (region == null) return null;\r\n\t\t\t\t\tregion.path = path;\r\n\t\t\t\t\tregion.x = this.getValue(map, \"x\", 0) * scale;\r\n\t\t\t\t\tregion.y = this.getValue(map, \"y\", 0) * scale;\r\n\t\t\t\t\tregion.scaleX = this.getValue(map, \"scaleX\", 1);\r\n\t\t\t\t\tregion.scaleY = this.getValue(map, \"scaleY\", 1);\r\n\t\t\t\t\tregion.rotation = this.getValue(map, \"rotation\", 0);\r\n\t\t\t\t\tregion.width = map.width * scale;\r\n\t\t\t\t\tregion.height = map.height * scale;\r\n\r\n\t\t\t\t\tlet color: string = this.getValue(map, \"color\", null);\r\n\t\t\t\t\tif (color != null) region.color.setFromString(color);\r\n\r\n\t\t\t\t\tregion.updateOffset();\r\n\t\t\t\t\treturn region;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"boundingbox\": {\r\n\t\t\t\t\tlet box = this.attachmentLoader.newBoundingBoxAttachment(skin, name);\r\n\t\t\t\t\tif (box == null) return null;\r\n\t\t\t\t\tthis.readVertices(map, box, map.vertexCount << 1);\r\n\t\t\t\t\tlet color: string = this.getValue(map, \"color\", null);\r\n\t\t\t\t\tif (color != null) box.color.setFromString(color);\r\n\t\t\t\t\treturn box;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"mesh\":\r\n\t\t\t\tcase \"linkedmesh\": {\r\n\t\t\t\t\tlet path = this.getValue(map, \"path\", name);\r\n\t\t\t\t\tlet mesh = this.attachmentLoader.newMeshAttachment(skin, name, path);\r\n\t\t\t\t\tif (mesh == null) return null;\r\n\t\t\t\t\tmesh.path = path;\r\n\r\n\t\t\t\t\tlet color = this.getValue(map, \"color\", null);\r\n\t\t\t\t\tif (color != null) mesh.color.setFromString(color);\r\n\r\n\t\t\t\t\tmesh.width = this.getValue(map, \"width\", 0) * scale;\r\n\t\t\t\t\tmesh.height = this.getValue(map, \"height\", 0) * scale;\r\n\r\n\t\t\t\t\tlet parent: string = this.getValue(map, \"parent\", null);\r\n\t\t\t\t\tif (parent != null) {\r\n\t\t\t\t\t\tthis.linkedMeshes.push(new LinkedMesh(mesh, <string> this.getValue(map, \"skin\", null), slotIndex, parent, this.getValue(map, \"deform\", true)));\r\n\t\t\t\t\t\treturn mesh;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet uvs: Array<number> = map.uvs;\r\n\t\t\t\t\tthis.readVertices(map, mesh, uvs.length);\r\n\t\t\t\t\tmesh.triangles = map.triangles;\r\n\t\t\t\t\tmesh.regionUVs = uvs;\r\n\t\t\t\t\tmesh.updateUVs();\r\n\r\n\t\t\t\t\tmesh.edges = this.getValue(map, \"edges\", null);\r\n\t\t\t\t\tmesh.hullLength = this.getValue(map, \"hull\", 0) * 2;\r\n\t\t\t\t\treturn mesh;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"path\": {\r\n\t\t\t\t\tlet path = this.attachmentLoader.newPathAttachment(skin, name);\r\n\t\t\t\t\tif (path == null) return null;\r\n\t\t\t\t\tpath.closed = this.getValue(map, \"closed\", false);\r\n\t\t\t\t\tpath.constantSpeed = this.getValue(map, \"constantSpeed\", true);\r\n\r\n\t\t\t\t\tlet vertexCount = map.vertexCount;\r\n\t\t\t\t\tthis.readVertices(map, path, vertexCount << 1);\r\n\r\n\t\t\t\t\tlet lengths: Array<number> = Utils.newArray(vertexCount / 3, 0);\r\n\t\t\t\t\tfor (let i = 0; i < map.lengths.length; i++)\r\n\t\t\t\t\t\tlengths[i] = map.lengths[i] * scale;\r\n\t\t\t\t\tpath.lengths = lengths;\r\n\r\n\t\t\t\t\tlet color: string = this.getValue(map, \"color\", null);\r\n\t\t\t\t\tif (color != null) path.color.setFromString(color);\r\n\t\t\t\t\treturn path;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"point\": {\r\n\t\t\t\t\tlet point = this.attachmentLoader.newPointAttachment(skin, name);\r\n\t\t\t\t\tif (point == null) return null;\r\n\t\t\t\t\tpoint.x = this.getValue(map, \"x\", 0) * scale;\r\n\t\t\t\t\tpoint.y = this.getValue(map, \"y\", 0) * scale;\r\n\t\t\t\t\tpoint.rotation = this.getValue(map, \"rotation\", 0);\r\n\r\n\t\t\t\t\tlet color = this.getValue(map, \"color\", null);\r\n\t\t\t\t\tif (color != null) point.color.setFromString(color);\r\n\t\t\t\t\treturn point;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"clipping\": {\r\n\t\t\t\t\tlet clip = this.attachmentLoader.newClippingAttachment(skin, name);\r\n\t\t\t\t\tif (clip == null) return null;\r\n\r\n\t\t\t\t\tlet end = this.getValue(map, \"end\", null);\r\n\t\t\t\t\tif (end != null) {\r\n\t\t\t\t\t\tlet slot = skeletonData.findSlot(end);\r\n\t\t\t\t\t\tif (slot == null) throw new Error(\"Clipping end slot not found: \" + end);\r\n\t\t\t\t\t\tclip.endSlot = slot;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet vertexCount = map.vertexCount;\r\n\t\t\t\t\tthis.readVertices(map, clip, vertexCount << 1);\r\n\r\n\t\t\t\t\tlet color: string = this.getValue(map, \"color\", null);\r\n\t\t\t\t\tif (color != null) clip.color.setFromString(color);\r\n\t\t\t\t\treturn clip;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treadVertices (map: any, attachment: VertexAttachment, verticesLength: number) {\r\n\t\t\tlet scale = this.scale;\r\n\t\t\tattachment.worldVerticesLength = verticesLength;\r\n\t\t\tlet vertices: Array<number> = map.vertices;\r\n\t\t\tif (verticesLength == vertices.length) {\r\n\t\t\t\tlet scaledVertices = Utils.toFloatArray(vertices);\r\n\t\t\t\tif (scale != 1) {\r\n\t\t\t\t\tfor (let i = 0, n = vertices.length; i < n; i++)\r\n\t\t\t\t\t\tscaledVertices[i] *= scale;\r\n\t\t\t\t}\r\n\t\t\t\tattachment.vertices = scaledVertices;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet weights = new Array<number>();\r\n\t\t\tlet bones = new Array<number>();\r\n\t\t\tfor (let i = 0, n = vertices.length; i < n;) {\r\n\t\t\t\tlet boneCount = vertices[i++];\r\n\t\t\t\tbones.push(boneCount);\r\n\t\t\t\tfor (let nn = i + boneCount * 4; i < nn; i += 4) {\r\n\t\t\t\t\tbones.push(vertices[i]);\r\n\t\t\t\t\tweights.push(vertices[i + 1] * scale);\r\n\t\t\t\t\tweights.push(vertices[i + 2] * scale);\r\n\t\t\t\t\tweights.push(vertices[i + 3]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tattachment.bones = bones;\r\n\t\t\tattachment.vertices = Utils.toFloatArray(weights);\r\n\t\t}\r\n\r\n\t\treadAnimation (map: any, name: string, skeletonData: SkeletonData) {\r\n\t\t\tlet scale = this.scale;\r\n\t\t\tlet timelines = new Array<Timeline>();\r\n\t\t\tlet duration = 0;\r\n\r\n\t\t\t// Slot timelines.\r\n\t\t\tif (map.slots) {\r\n\t\t\t\tfor (let slotName in map.slots) {\r\n\t\t\t\t\tlet slotMap = map.slots[slotName];\r\n\t\t\t\t\tlet slotIndex = skeletonData.findSlotIndex(slotName);\r\n\t\t\t\t\tif (slotIndex == -1) throw new Error(\"Slot not found: \" + slotName);\r\n\t\t\t\t\tfor (let timelineName in slotMap) {\r\n\t\t\t\t\t\tlet timelineMap = slotMap[timelineName];\r\n\t\t\t\t\t\tif (timelineName == \"attachment\") {\r\n\t\t\t\t\t\t\tlet timeline = new AttachmentTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex++, this.getValue(valueMap, \"time\", 0), valueMap.name);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[timeline.getFrameCount() - 1]);\r\n\t\t\t\t\t\t} else if (timelineName == \"color\") {\r\n\t\t\t\t\t\t\tlet timeline = new ColorTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\tlet color = new Color();\r\n\t\t\t\t\t\t\t\tcolor.setFromString(valueMap.color);\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), color.r, color.g, color.b, color.a);\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * ColorTimeline.ENTRIES]);\r\n\r\n\t\t\t\t\t\t} else if (timelineName == \"twoColor\") {\r\n\t\t\t\t\t\t\tlet timeline = new TwoColorTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\tlet light = new Color();\r\n\t\t\t\t\t\t\t\tlet dark = new Color();\r\n\t\t\t\t\t\t\t\tlight.setFromString(valueMap.light);\r\n\t\t\t\t\t\t\t\tdark.setFromString(valueMap.dark);\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), light.r, light.g, light.b, light.a, dark.r, dark.g, dark.b);\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * TwoColorTimeline.ENTRIES]);\r\n\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tthrow new Error(\"Invalid timeline type for a slot: \" + timelineName + \" (\" + slotName + \")\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Bone timelines.\r\n\t\t\tif (map.bones) {\r\n\t\t\t\tfor (let boneName in map.bones) {\r\n\t\t\t\t\tlet boneMap = map.bones[boneName];\r\n\t\t\t\t\tlet boneIndex = skeletonData.findBoneIndex(boneName);\r\n\t\t\t\t\tif (boneIndex == -1) throw new Error(\"Bone not found: \" + boneName);\r\n\t\t\t\t\tfor (let timelineName in boneMap) {\r\n\t\t\t\t\t\tlet timelineMap = boneMap[timelineName];\r\n\t\t\t\t\t\tif (timelineName === \"rotate\") {\r\n\t\t\t\t\t\t\tlet timeline = new RotateTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\ttimeline.boneIndex = boneIndex;\r\n\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), this.getValue(valueMap, \"angle\", 0));\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * RotateTimeline.ENTRIES]);\r\n\r\n\t\t\t\t\t\t} else if (timelineName === \"translate\" || timelineName === \"scale\" || timelineName === \"shear\") {\r\n\t\t\t\t\t\t\tlet timeline: TranslateTimeline = null;\r\n\t\t\t\t\t\t\tlet timelineScale = 1, defaultValue = 0;\r\n\t\t\t\t\t\t\tif (timelineName === \"scale\") {\r\n\t\t\t\t\t\t\t\ttimeline = new ScaleTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\t\tdefaultValue = 1;\r\n\t\t\t\t\t\t\t} else if (timelineName === \"shear\")\r\n\t\t\t\t\t\t\t\ttimeline = new ShearTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\ttimeline = new TranslateTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\t\ttimelineScale = scale;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimeline.boneIndex = boneIndex;\r\n\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\tlet x = this.getValue(valueMap, \"x\", defaultValue), y = this.getValue(valueMap, \"y\", defaultValue);\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), x * timelineScale, y * timelineScale);\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * TranslateTimeline.ENTRIES]);\r\n\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tthrow new Error(\"Invalid timeline type for a bone: \" + timelineName + \" (\" + boneName + \")\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// IK constraint timelines.\r\n\t\t\tif (map.ik) {\r\n\t\t\t\tfor (let constraintName in map.ik) {\r\n\t\t\t\t\tlet constraintMap = map.ik[constraintName];\r\n\t\t\t\t\tlet constraint = skeletonData.findIkConstraint(constraintName);\r\n\t\t\t\t\tlet timeline = new IkConstraintTimeline(constraintMap.length);\r\n\t\t\t\t\ttimeline.ikConstraintIndex = skeletonData.ikConstraints.indexOf(constraint);\r\n\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\tfor (let i = 0; i < constraintMap.length; i++) {\r\n\t\t\t\t\t\tlet valueMap = constraintMap[i];\r\n\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), this.getValue(valueMap, \"mix\", 1), this.getValue(valueMap, \"softness\", 0) * scale,\r\n\t\t\t\t\t\t\tthis.getValue(valueMap, \"bendPositive\", true) ? 1 : -1, this.getValue(valueMap, \"compress\", false), this.getValue(valueMap, \"stretch\", false));\r\n\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\tduration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * IkConstraintTimeline.ENTRIES]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Transform constraint timelines.\r\n\t\t\tif (map.transform) {\r\n\t\t\t\tfor (let constraintName in map.transform) {\r\n\t\t\t\t\tlet constraintMap = map.transform[constraintName];\r\n\t\t\t\t\tlet constraint = skeletonData.findTransformConstraint(constraintName);\r\n\t\t\t\t\tlet timeline = new TransformConstraintTimeline(constraintMap.length);\r\n\t\t\t\t\ttimeline.transformConstraintIndex = skeletonData.transformConstraints.indexOf(constraint);\r\n\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\tfor (let i = 0; i < constraintMap.length; i++) {\r\n\t\t\t\t\t\tlet valueMap = constraintMap[i];\r\n\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), this.getValue(valueMap, \"rotateMix\", 1),\r\n\t\t\t\t\t\t\tthis.getValue(valueMap, \"translateMix\", 1), this.getValue(valueMap, \"scaleMix\", 1), this.getValue(valueMap, \"shearMix\", 1));\r\n\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\tduration = Math.max(duration,\r\n\t\t\t\t\t\ttimeline.frames[(timeline.getFrameCount() - 1) * TransformConstraintTimeline.ENTRIES]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Path constraint timelines.\r\n\t\t\tif (map.path) {\r\n\t\t\t\tfor (let constraintName in map.path) {\r\n\t\t\t\t\tlet constraintMap = map.path[constraintName];\r\n\t\t\t\t\tlet index = skeletonData.findPathConstraintIndex(constraintName);\r\n\t\t\t\t\tif (index == -1) throw new Error(\"Path constraint not found: \" + constraintName);\r\n\t\t\t\t\tlet data = skeletonData.pathConstraints[index];\r\n\t\t\t\t\tfor (let timelineName in constraintMap) {\r\n\t\t\t\t\t\tlet timelineMap = constraintMap[timelineName];\r\n\t\t\t\t\t\tif (timelineName === \"position\" || timelineName === \"spacing\") {\r\n\t\t\t\t\t\t\tlet timeline: PathConstraintPositionTimeline = null;\r\n\t\t\t\t\t\t\tlet timelineScale = 1;\r\n\t\t\t\t\t\t\tif (timelineName === \"spacing\") {\r\n\t\t\t\t\t\t\t\ttimeline = new PathConstraintSpacingTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\t\tif (data.spacingMode == SpacingMode.Length || data.spacingMode == SpacingMode.Fixed) timelineScale = scale;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttimeline = new PathConstraintPositionTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\t\tif (data.positionMode == PositionMode.Fixed) timelineScale = scale;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimeline.pathConstraintIndex = index;\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), this.getValue(valueMap, timelineName, 0) * timelineScale);\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration,\r\n\t\t\t\t\t\t\t\ttimeline.frames[(timeline.getFrameCount() - 1) * PathConstraintPositionTimeline.ENTRIES]);\r\n\t\t\t\t\t\t} else if (timelineName === \"mix\") {\r\n\t\t\t\t\t\t\tlet timeline = new PathConstraintMixTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\ttimeline.pathConstraintIndex = index;\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), this.getValue(valueMap, \"rotateMix\", 1),\r\n\t\t\t\t\t\t\t\t\tthis.getValue(valueMap, \"translateMix\", 1));\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration,\r\n\t\t\t\t\t\t\t\ttimeline.frames[(timeline.getFrameCount() - 1) * PathConstraintMixTimeline.ENTRIES]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Deform timelines.\r\n\t\t\tif (map.deform) {\r\n\t\t\t\tfor (let deformName in map.deform) {\r\n\t\t\t\t\tlet deformMap = map.deform[deformName];\r\n\t\t\t\t\tlet skin = skeletonData.findSkin(deformName);\r\n\t\t\t\t\tif (skin == null) throw new Error(\"Skin not found: \" + deformName);\r\n\t\t\t\t\tfor (let slotName in deformMap) {\r\n\t\t\t\t\t\tlet slotMap = deformMap[slotName];\r\n\t\t\t\t\t\tlet slotIndex = skeletonData.findSlotIndex(slotName);\r\n\t\t\t\t\t\tif (slotIndex == -1) throw new Error(\"Slot not found: \" + slotMap.name);\r\n\t\t\t\t\t\tfor (let timelineName in slotMap) {\r\n\t\t\t\t\t\t\tlet timelineMap = slotMap[timelineName];\r\n\t\t\t\t\t\t\tlet attachment = <VertexAttachment>skin.getAttachment(slotIndex, timelineName);\r\n\t\t\t\t\t\t\tif (attachment == null) throw new Error(\"Deform attachment not found: \" + timelineMap.name);\r\n\t\t\t\t\t\t\tlet weighted = attachment.bones != null;\r\n\t\t\t\t\t\t\tlet vertices = attachment.vertices;\r\n\t\t\t\t\t\t\tlet deformLength = weighted ? vertices.length / 3 * 2 : vertices.length;\r\n\r\n\t\t\t\t\t\t\tlet timeline = new DeformTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\t\t\t\t\t\t\ttimeline.attachment = attachment;\r\n\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let j = 0; j < timelineMap.length; j++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[j];\r\n\t\t\t\t\t\t\t\tlet deform: ArrayLike<number>;\r\n\t\t\t\t\t\t\t\tlet verticesValue: Array<Number> = this.getValue(valueMap, \"vertices\", null);\r\n\t\t\t\t\t\t\t\tif (verticesValue == null)\r\n\t\t\t\t\t\t\t\t\tdeform = weighted ? Utils.newFloatArray(deformLength) : vertices;\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tdeform = Utils.newFloatArray(deformLength);\r\n\t\t\t\t\t\t\t\t\tlet start = <number>this.getValue(valueMap, \"offset\", 0);\r\n\t\t\t\t\t\t\t\t\tUtils.arrayCopy(verticesValue, 0, deform, start, verticesValue.length);\r\n\t\t\t\t\t\t\t\t\tif (scale != 1) {\r\n\t\t\t\t\t\t\t\t\t\tfor (let i = start, n = i + verticesValue.length; i < n; i++)\r\n\t\t\t\t\t\t\t\t\t\t\tdeform[i] *= scale;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif (!weighted) {\r\n\t\t\t\t\t\t\t\t\t\tfor (let i = 0; i < deformLength; i++)\r\n\t\t\t\t\t\t\t\t\t\t\tdeform[i] += vertices[i];\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), deform);\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[timeline.getFrameCount() - 1]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Draw order timeline.\r\n\t\t\tlet drawOrderNode = map.drawOrder;\r\n\t\t\tif (drawOrderNode == null) drawOrderNode = map.draworder;\r\n\t\t\tif (drawOrderNode != null) {\r\n\t\t\t\tlet timeline = new DrawOrderTimeline(drawOrderNode.length);\r\n\t\t\t\tlet slotCount = skeletonData.slots.length;\r\n\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\tfor (let j = 0; j < drawOrderNode.length; j++) {\r\n\t\t\t\t\tlet drawOrderMap = drawOrderNode[j];\r\n\t\t\t\t\tlet drawOrder: Array<number> = null;\r\n\t\t\t\t\tlet offsets = this.getValue(drawOrderMap, \"offsets\", null);\r\n\t\t\t\t\tif (offsets != null) {\r\n\t\t\t\t\t\tdrawOrder = Utils.newArray<number>(slotCount, -1);\r\n\t\t\t\t\t\tlet unchanged = Utils.newArray<number>(slotCount - offsets.length, 0);\r\n\t\t\t\t\t\tlet originalIndex = 0, unchangedIndex = 0;\r\n\t\t\t\t\t\tfor (let i = 0; i < offsets.length; i++) {\r\n\t\t\t\t\t\t\tlet offsetMap = offsets[i];\r\n\t\t\t\t\t\t\tlet slotIndex = skeletonData.findSlotIndex(offsetMap.slot);\r\n\t\t\t\t\t\t\tif (slotIndex == -1) throw new Error(\"Slot not found: \" + offsetMap.slot);\r\n\t\t\t\t\t\t\t// Collect unchanged items.\r\n\t\t\t\t\t\t\twhile (originalIndex != slotIndex)\r\n\t\t\t\t\t\t\t\tunchanged[unchangedIndex++] = originalIndex++;\r\n\t\t\t\t\t\t\t// Set changed items.\r\n\t\t\t\t\t\t\tdrawOrder[originalIndex + offsetMap.offset] = originalIndex++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Collect remaining unchanged items.\r\n\t\t\t\t\t\twhile (originalIndex < slotCount)\r\n\t\t\t\t\t\t\tunchanged[unchangedIndex++] = originalIndex++;\r\n\t\t\t\t\t\t// Fill in unchanged items.\r\n\t\t\t\t\t\tfor (let i = slotCount - 1; i >= 0; i--)\r\n\t\t\t\t\t\t\tif (drawOrder[i] == -1) drawOrder[i] = unchanged[--unchangedIndex];\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimeline.setFrame(frameIndex++, this.getValue(drawOrderMap, \"time\", 0), drawOrder);\r\n\t\t\t\t}\r\n\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\tduration = Math.max(duration, timeline.frames[timeline.getFrameCount() - 1]);\r\n\t\t\t}\r\n\r\n\t\t\t// Event timeline.\r\n\t\t\tif (map.events) {\r\n\t\t\t\tlet timeline = new EventTimeline(map.events.length);\r\n\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\tfor (let i = 0; i < map.events.length; i++) {\r\n\t\t\t\t\tlet eventMap = map.events[i];\r\n\t\t\t\t\tlet eventData = skeletonData.findEvent(eventMap.name);\r\n\t\t\t\t\tif (eventData == null) throw new Error(\"Event not found: \" + eventMap.name);\r\n\t\t\t\t\tlet event = new Event(Utils.toSinglePrecision(this.getValue(eventMap, \"time\", 0)), eventData);\r\n\t\t\t\t\tevent.intValue = this.getValue(eventMap, \"int\", eventData.intValue);\r\n\t\t\t\t\tevent.floatValue = this.getValue(eventMap, \"float\", eventData.floatValue);\r\n\t\t\t\t\tevent.stringValue = this.getValue(eventMap, \"string\", eventData.stringValue);\r\n\t\t\t\t\tif (event.data.audioPath != null) {\r\n\t\t\t\t\t\tevent.volume = this.getValue(eventMap, \"volume\", 1);\r\n\t\t\t\t\t\tevent.balance = this.getValue(eventMap, \"balance\", 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimeline.setFrame(frameIndex++, event);\r\n\t\t\t\t}\r\n\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\tduration = Math.max(duration, timeline.frames[timeline.getFrameCount() - 1]);\r\n\t\t\t}\r\n\r\n\t\t\tif (isNaN(duration)) {\r\n\t\t\t\tthrow new Error(\"Error while parsing animation, duration is NaN\");\r\n\t\t\t}\r\n\r\n\t\t\tskeletonData.animations.push(new Animation(name, timelines, duration));\r\n\t\t}\r\n\r\n\t\treadCurve (map: any, timeline: CurveTimeline, frameIndex: number) {\r\n\t\t\tif (!map.hasOwnProperty(\"curve\")) return;\r\n\t\t\tif (map.curve == \"stepped\")\r\n\t\t\t\ttimeline.setStepped(frameIndex);\r\n\t\t\telse {\r\n\t\t\t\tlet curve: number = map.curve;\r\n\t\t\t\ttimeline.setCurve(frameIndex, curve, this.getValue(map, \"c2\", 0), this.getValue(map, \"c3\", 1), this.getValue(map, \"c4\", 1));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tgetValue (map: any, prop: string, defaultValue: any) {\r\n\t\t\treturn map[prop] !== undefined ? map[prop] : defaultValue;\r\n\t\t}\r\n\r\n\t\tstatic blendModeFromString (str: string) {\r\n\t\t\tstr = str.toLowerCase();\r\n\t\t\tif (str == \"normal\") return BlendMode.Normal;\r\n\t\t\tif (str == \"additive\") return BlendMode.Additive;\r\n\t\t\tif (str == \"multiply\") return BlendMode.Multiply;\r\n\t\t\tif (str == \"screen\") return BlendMode.Screen;\r\n\t\t\tthrow new Error(`Unknown blend mode: ${str}`);\r\n\t\t}\r\n\r\n\t\tstatic positionModeFromString (str: string) {\r\n\t\t\tstr = str.toLowerCase();\r\n\t\t\tif (str == \"fixed\") return PositionMode.Fixed;\r\n\t\t\tif (str == \"percent\") return PositionMode.Percent;\r\n\t\t\tthrow new Error(`Unknown position mode: ${str}`);\r\n\t\t}\r\n\r\n\t\tstatic spacingModeFromString (str: string) {\r\n\t\t\tstr = str.toLowerCase();\r\n\t\t\tif (str == \"length\") return SpacingMode.Length;\r\n\t\t\tif (str == \"fixed\") return SpacingMode.Fixed;\r\n\t\t\tif (str == \"percent\") return SpacingMode.Percent;\r\n\t\t\tthrow new Error(`Unknown position mode: ${str}`);\r\n\t\t}\r\n\r\n\t\tstatic rotateModeFromString (str: string) {\r\n\t\t\tstr = str.toLowerCase();\r\n\t\t\tif (str == \"tangent\") return RotateMode.Tangent;\r\n\t\t\tif (str == \"chain\") return RotateMode.Chain;\r\n\t\t\tif (str == \"chainscale\") return RotateMode.ChainScale;\r\n\t\t\tthrow new Error(`Unknown rotate mode: ${str}`);\r\n\t\t}\r\n\r\n\t\tstatic transformModeFromString(str: string) {\r\n\t\t\tstr = str.toLowerCase();\r\n\t\t\tif (str == \"normal\") return TransformMode.Normal;\r\n\t\t\tif (str == \"onlytranslation\") return TransformMode.OnlyTranslation;\r\n\t\t\tif (str == \"norotationorreflection\") return TransformMode.NoRotationOrReflection;\r\n\t\t\tif (str == \"noscale\") return TransformMode.NoScale;\r\n\t\t\tif (str == \"noscaleorreflection\") return TransformMode.NoScaleOrReflection;\r\n\t\t\tthrow new Error(`Unknown transform mode: ${str}`);\r\n\t\t}\r\n\t}\r\n\r\n\tclass LinkedMesh {\r\n\t\tparent: string; skin: string;\r\n\t\tslotIndex: number;\r\n\t\tmesh: MeshAttachment;\r\n\t\tinheritDeform: boolean;\r\n\r\n\t\tconstructor (mesh: MeshAttachment, skin: string, slotIndex: number, parent: string, inheritDeform: boolean) {\r\n\t\t\tthis.mesh = mesh;\r\n\t\t\tthis.skin = skin;\r\n\t\t\tthis.slotIndex = slotIndex;\r\n\t\t\tthis.parent = parent;\r\n\t\t\tthis.inheritDeform = inheritDeform;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Matrix4, M30, M31, M32, M33, M00, M01, M02, M03, M10, M11, M12, M13, M20, M21, M22, M23 } from \"./Matrix4\";\r\n\r\n// module spine.webgl {\r\n\texport class Vector3 {\r\n\t\tx = 0;\r\n\t\ty = 0;\r\n\t\tz = 0;\r\n\t\tw = 0;\r\n\r\n\t\tconstructor (x: number = 0, y: number = 0, z: number = 0) {\r\n\t\t\tthis.x = x;\r\n\t\t\tthis.y = y;\r\n\t\t\tthis.z = z;\r\n\t\t}\r\n\r\n\t\tsetFrom(v: Vector3): Vector3 {\r\n\t\t\tthis.x = v.x;\r\n\t\t\tthis.y = v.y;\r\n\t\t\tthis.z = v.z;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tset (x: number, y: number, z: number): Vector3 {\r\n\t\t\tthis.x = x;\r\n\t\t\tthis.y = y;\r\n\t\t\tthis.z = z;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tadd (v: Vector3): Vector3 {\r\n\t\t\tthis.x += v.x;\r\n\t\t\tthis.y += v.y;\r\n\t\t\tthis.z += v.z;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tsub (v: Vector3): Vector3 {\r\n\t\t\tthis.x -= v.x;\r\n\t\t\tthis.y -= v.y;\r\n\t\t\tthis.z -= v.z;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tscale (s: number): Vector3 {\r\n\t\t\tthis.x *= s;\r\n\t\t\tthis.y *= s;\r\n\t\t\tthis.z *= s;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tnormalize (): Vector3 {\r\n\t\t\tlet len = this.length();\r\n\t\t\tif (len == 0) return this;\r\n\t\t\tlen = 1 / len;\r\n\t\t\tthis.x *= len;\r\n\t\t\tthis.y *= len;\r\n\t\t\tthis.z *= len;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tcross (v: Vector3): Vector3 {\r\n\t\t\treturn this.set(this.y * v.z - this.z * v.y, this.z * v.x - this.x * v.z, this.x * v.y - this.y * v.x)\r\n\t\t}\r\n\r\n\t\tmultiply (matrix: Matrix4): Vector3 {\r\n\t\t\tlet l_mat = matrix.values;\r\n\t\t\tthis.w = this.x * l_mat[M30] + this.y * l_mat[M31] + this.z * l_mat[M32] + l_mat[M33];\r\n\t\t\treturn this.set(\r\n\t\t\t\tthis.x * l_mat[M00] + this.y * l_mat[M01] + this.z * l_mat[M02] + l_mat[M03],\r\n\t\t\t\tthis.x * l_mat[M10] + this.y * l_mat[M11] + this.z * l_mat[M12] + l_mat[M13],\r\n\t\t\t\tthis.x * l_mat[M20] + this.y * l_mat[M21] + this.z * l_mat[M22] + l_mat[M23]);\r\n\t\t}\r\n\r\n\t\tproject (matrix: Matrix4): Vector3 {\r\n\t\t\tlet l_mat = matrix.values;\r\n\t\t\tthis.w = (this.x * l_mat[M30] + this.y * l_mat[M31] + this.z * l_mat[M32] + l_mat[M33]);\r\n\t\t\tlet l_w = 1 / this.w;\r\n\t\t\treturn this.set(\r\n\t\t\t\t(this.x * l_mat[M00] + this.y * l_mat[M01] + this.z * l_mat[M02] + l_mat[M03]) * l_w,\r\n\t\t\t\t(this.x * l_mat[M10] + this.y * l_mat[M11] + this.z * l_mat[M12] + l_mat[M13]) * l_w,\r\n\t\t\t\t(this.x * l_mat[M20] + this.y * l_mat[M21] + this.z * l_mat[M22] + l_mat[M23]) * l_w);\r\n\t\t}\r\n\r\n\t\tdot (v: Vector3): number {\r\n\t\t\treturn this.x * v.x + this.y * v.y + this.z * v.z;\r\n\t\t}\r\n\r\n\t\tlength (): number {\r\n\t\t\treturn Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\r\n\t\t}\r\n\r\n\t\tdistance (v: Vector3): number {\r\n\t\t\tlet a = v.x - this.x;\r\n\t\t\tlet b = v.y - this.y;\r\n\t\t\tlet c = v.z - this.z;\r\n\t\t\treturn Math.sqrt(a * a + b * b + c * c);\r\n\t\t}\r\n\r\n\t\tcopy(): Vector3 {\r\n\t\t\treturn new Vector3(this.x, this.y, this.z);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Vector3 } from \"./Vector3\";\r\n\r\n// module spine.webgl {\r\n\texport const M00 = 0;\r\n\texport const M01 = 4;\r\n\texport const M02 = 8;\r\n\texport const M03 = 12;\r\n\texport const M10 = 1;\r\n\texport const M11 = 5;\r\n\texport const M12 = 9;\r\n\texport const M13 = 13;\r\n\texport const M20 = 2;\r\n\texport const M21 = 6;\r\n\texport const M22 = 10;\r\n\texport const M23 = 14;\r\n\texport const M30 = 3;\r\n\texport const M31 = 7;\r\n\texport const M32 = 11;\r\n\texport const M33 = 15;\r\n\r\n\texport class Matrix4 {\r\n\t\ttemp: Float32Array = new Float32Array(16);\r\n\t\tvalues: Float32Array = new Float32Array(16);\r\n\r\n\t\tprivate static xAxis: Vector3 = null;\r\n\t\tprivate static yAxis: Vector3 = null;\r\n\t\tprivate static zAxis: Vector3 = null;\r\n\t\tprivate static tmpMatrix = new Matrix4();\r\n\r\n\t\tconstructor () {\r\n\t\t\tlet v = this.values;\r\n\t\t\tthis.identity();\r\n\t\t\tv[M00] = 1;\r\n\t\t\tv[M11] = 1;\r\n\t\t\tv[M22] = 1;\r\n\t\t\tv[M33] = 1;\r\n\t\t}\r\n\r\n\t\tset (values: ArrayLike<number>): Matrix4 {\r\n\t\t\tthis.values.set(values);\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\ttranspose (): Matrix4 {\r\n\t\t\tlet t = this.temp;\r\n\t\t\tlet v = this.values;\r\n\t\t\tt[M00] = v[M00];\r\n\t\t\tt[M01] = v[M10];\r\n\t\t\tt[M02] = v[M20];\r\n\t\t\tt[M03] = v[M30];\r\n\t\t\tt[M10] = v[M01];\r\n\t\t\tt[M11] = v[M11];\r\n\t\t\tt[M12] = v[M21];\r\n\t\t\tt[M13] = v[M31];\r\n\t\t\tt[M20] = v[M02];\r\n\t\t\tt[M21] = v[M12];\r\n\t\t\tt[M22] = v[M22];\r\n\t\t\tt[M23] = v[M32];\r\n\t\t\tt[M30] = v[M03];\r\n\t\t\tt[M31] = v[M13];\r\n\t\t\tt[M32] = v[M23];\r\n\t\t\tt[M33] = v[M33];\r\n\t\t\treturn this.set(t);\r\n\t\t}\r\n\r\n\t\tidentity (): Matrix4 {\r\n\t\t\tlet v = this.values;\r\n\t\t\tv[M00] = 1;\r\n\t\t\tv[M01] = 0;\r\n\t\t\tv[M02] = 0;\r\n\t\t\tv[M03] = 0;\r\n\t\t\tv[M10] = 0;\r\n\t\t\tv[M11] = 1;\r\n\t\t\tv[M12] = 0;\r\n\t\t\tv[M13] = 0;\r\n\t\t\tv[M20] = 0;\r\n\t\t\tv[M21] = 0;\r\n\t\t\tv[M22] = 1;\r\n\t\t\tv[M23] = 0;\r\n\t\t\tv[M30] = 0;\r\n\t\t\tv[M31] = 0;\r\n\t\t\tv[M32] = 0;\r\n\t\t\tv[M33] = 1;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tinvert (): Matrix4 {\r\n\t\t\tlet v = this.values;\r\n\t\t\tlet t = this.temp;\r\n\t\t\tlet l_det = v[M30] * v[M21] * v[M12] * v[M03] - v[M20] * v[M31] * v[M12] * v[M03] - v[M30] * v[M11] * v[M22] * v[M03]\r\n\t\t\t\t+ v[M10] * v[M31] * v[M22] * v[M03] + v[M20] * v[M11] * v[M32] * v[M03] - v[M10] * v[M21] * v[M32] * v[M03]\r\n\t\t\t\t- v[M30] * v[M21] * v[M02] * v[M13] + v[M20] * v[M31] * v[M02] * v[M13] + v[M30] * v[M01] * v[M22] * v[M13]\r\n\t\t\t\t- v[M00] * v[M31] * v[M22] * v[M13] - v[M20] * v[M01] * v[M32] * v[M13] + v[M00] * v[M21] * v[M32] * v[M13]\r\n\t\t\t\t+ v[M30] * v[M11] * v[M02] * v[M23] - v[M10] * v[M31] * v[M02] * v[M23] - v[M30] * v[M01] * v[M12] * v[M23]\r\n\t\t\t\t+ v[M00] * v[M31] * v[M12] * v[M23] + v[M10] * v[M01] * v[M32] * v[M23] - v[M00] * v[M11] * v[M32] * v[M23]\r\n\t\t\t\t- v[M20] * v[M11] * v[M02] * v[M33] + v[M10] * v[M21] * v[M02] * v[M33] + v[M20] * v[M01] * v[M12] * v[M33]\r\n\t\t\t\t- v[M00] * v[M21] * v[M12] * v[M33] - v[M10] * v[M01] * v[M22] * v[M33] + v[M00] * v[M11] * v[M22] * v[M33];\r\n\t\t\tif (l_det == 0) throw new Error(\"non-invertible matrix\");\r\n\t\t\tlet inv_det = 1.0 / l_det;\r\n\t\t\tt[M00] = v[M12] * v[M23] * v[M31] - v[M13] * v[M22] * v[M31] + v[M13] * v[M21] * v[M32]\r\n\t\t\t\t- v[M11] * v[M23] * v[M32] - v[M12] * v[M21] * v[M33] + v[M11] * v[M22] * v[M33];\r\n\t\t\tt[M01] = v[M03] * v[M22] * v[M31] - v[M02] * v[M23] * v[M31] - v[M03] * v[M21] * v[M32]\r\n\t\t\t\t+ v[M01] * v[M23] * v[M32] + v[M02] * v[M21] * v[M33] - v[M01] * v[M22] * v[M33];\r\n\t\t\tt[M02] = v[M02] * v[M13] * v[M31] - v[M03] * v[M12] * v[M31] + v[M03] * v[M11] * v[M32]\r\n\t\t\t\t- v[M01] * v[M13] * v[M32] - v[M02] * v[M11] * v[M33] + v[M01] * v[M12] * v[M33];\r\n\t\t\tt[M03] = v[M03] * v[M12] * v[M21] - v[M02] * v[M13] * v[M21] - v[M03] * v[M11] * v[M22]\r\n\t\t\t\t+ v[M01] * v[M13] * v[M22] + v[M02] * v[M11] * v[M23] - v[M01] * v[M12] * v[M23];\r\n\t\t\tt[M10] = v[M13] * v[M22] * v[M30] - v[M12] * v[M23] * v[M30] - v[M13] * v[M20] * v[M32]\r\n\t\t\t\t+ v[M10] * v[M23] * v[M32] + v[M12] * v[M20] * v[M33] - v[M10] * v[M22] * v[M33];\r\n\t\t\tt[M11] = v[M02] * v[M23] * v[M30] - v[M03] * v[M22] * v[M30] + v[M03] * v[M20] * v[M32]\r\n\t\t\t\t- v[M00] * v[M23] * v[M32] - v[M02] * v[M20] * v[M33] + v[M00] * v[M22] * v[M33];\r\n\t\t\tt[M12] = v[M03] * v[M12] * v[M30] - v[M02] * v[M13] * v[M30] - v[M03] * v[M10] * v[M32]\r\n\t\t\t\t+ v[M00] * v[M13] * v[M32] + v[M02] * v[M10] * v[M33] - v[M00] * v[M12] * v[M33];\r\n\t\t\tt[M13] = v[M02] * v[M13] * v[M20] - v[M03] * v[M12] * v[M20] + v[M03] * v[M10] * v[M22]\r\n\t\t\t\t- v[M00] * v[M13] * v[M22] - v[M02] * v[M10] * v[M23] + v[M00] * v[M12] * v[M23];\r\n\t\t\tt[M20] = v[M11] * v[M23] * v[M30] - v[M13] * v[M21] * v[M30] + v[M13] * v[M20] * v[M31]\r\n\t\t\t\t- v[M10] * v[M23] * v[M31] - v[M11] * v[M20] * v[M33] + v[M10] * v[M21] * v[M33];\r\n\t\t\tt[M21] = v[M03] * v[M21] * v[M30] - v[M01] * v[M23] * v[M30] - v[M03] * v[M20] * v[M31]\r\n\t\t\t\t+ v[M00] * v[M23] * v[M31] + v[M01] * v[M20] * v[M33] - v[M00] * v[M21] * v[M33];\r\n\t\t\tt[M22] = v[M01] * v[M13] * v[M30] - v[M03] * v[M11] * v[M30] + v[M03] * v[M10] * v[M31]\r\n\t\t\t\t- v[M00] * v[M13] * v[M31] - v[M01] * v[M10] * v[M33] + v[M00] * v[M11] * v[M33];\r\n\t\t\tt[M23] = v[M03] * v[M11] * v[M20] - v[M01] * v[M13] * v[M20] - v[M03] * v[M10] * v[M21]\r\n\t\t\t\t+ v[M00] * v[M13] * v[M21] + v[M01] * v[M10] * v[M23] - v[M00] * v[M11] * v[M23];\r\n\t\t\tt[M30] = v[M12] * v[M21] * v[M30] - v[M11] * v[M22] * v[M30] - v[M12] * v[M20] * v[M31]\r\n\t\t\t\t+ v[M10] * v[M22] * v[M31] + v[M11] * v[M20] * v[M32] - v[M10] * v[M21] * v[M32];\r\n\t\t\tt[M31] = v[M01] * v[M22] * v[M30] - v[M02] * v[M21] * v[M30] + v[M02] * v[M20] * v[M31]\r\n\t\t\t\t- v[M00] * v[M22] * v[M31] - v[M01] * v[M20] * v[M32] + v[M00] * v[M21] * v[M32];\r\n\t\t\tt[M32] = v[M02] * v[M11] * v[M30] - v[M01] * v[M12] * v[M30] - v[M02] * v[M10] * v[M31]\r\n\t\t\t\t+ v[M00] * v[M12] * v[M31] + v[M01] * v[M10] * v[M32] - v[M00] * v[M11] * v[M32];\r\n\t\t\tt[M33] = v[M01] * v[M12] * v[M20] - v[M02] * v[M11] * v[M20] + v[M02] * v[M10] * v[M21]\r\n\t\t\t\t- v[M00] * v[M12] * v[M21] - v[M01] * v[M10] * v[M22] + v[M00] * v[M11] * v[M22];\r\n\t\t\tv[M00] = t[M00] * inv_det;\r\n\t\t\tv[M01] = t[M01] * inv_det;\r\n\t\t\tv[M02] = t[M02] * inv_det;\r\n\t\t\tv[M03] = t[M03] * inv_det;\r\n\t\t\tv[M10] = t[M10] * inv_det;\r\n\t\t\tv[M11] = t[M11] * inv_det;\r\n\t\t\tv[M12] = t[M12] * inv_det;\r\n\t\t\tv[M13] = t[M13] * inv_det;\r\n\t\t\tv[M20] = t[M20] * inv_det;\r\n\t\t\tv[M21] = t[M21] * inv_det;\r\n\t\t\tv[M22] = t[M22] * inv_det;\r\n\t\t\tv[M23] = t[M23] * inv_det;\r\n\t\t\tv[M30] = t[M30] * inv_det;\r\n\t\t\tv[M31] = t[M31] * inv_det;\r\n\t\t\tv[M32] = t[M32] * inv_det;\r\n\t\t\tv[M33] = t[M33] * inv_det;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tdeterminant (): number {\r\n\t\t\tlet v = this.values;\r\n\t\t\treturn v[M30] * v[M21] * v[M12] * v[M03] - v[M20] * v[M31] * v[M12] * v[M03] - v[M30] * v[M11] * v[M22] * v[M03]\r\n\t\t\t\t+ v[M10] * v[M31] * v[M22] * v[M03] + v[M20] * v[M11] * v[M32] * v[M03] - v[M10] * v[M21] * v[M32] * v[M03]\r\n\t\t\t\t- v[M30] * v[M21] * v[M02] * v[M13] + v[M20] * v[M31] * v[M02] * v[M13] + v[M30] * v[M01] * v[M22] * v[M13]\r\n\t\t\t\t- v[M00] * v[M31] * v[M22] * v[M13] - v[M20] * v[M01] * v[M32] * v[M13] + v[M00] * v[M21] * v[M32] * v[M13]\r\n\t\t\t\t+ v[M30] * v[M11] * v[M02] * v[M23] - v[M10] * v[M31] * v[M02] * v[M23] - v[M30] * v[M01] * v[M12] * v[M23]\r\n\t\t\t\t+ v[M00] * v[M31] * v[M12] * v[M23] + v[M10] * v[M01] * v[M32] * v[M23] - v[M00] * v[M11] * v[M32] * v[M23]\r\n\t\t\t\t- v[M20] * v[M11] * v[M02] * v[M33] + v[M10] * v[M21] * v[M02] * v[M33] + v[M20] * v[M01] * v[M12] * v[M33]\r\n\t\t\t\t- v[M00] * v[M21] * v[M12] * v[M33] - v[M10] * v[M01] * v[M22] * v[M33] + v[M00] * v[M11] * v[M22] * v[M33];\r\n\t\t}\r\n\r\n\t\ttranslate (x: number, y: number, z: number): Matrix4 {\r\n\t\t\tlet v = this.values;\r\n\t\t\tv[M03] += x;\r\n\t\t\tv[M13] += y;\r\n\t\t\tv[M23] += z;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tcopy (): Matrix4 {\r\n\t\t\treturn new Matrix4().set(this.values);\r\n\t\t}\r\n\r\n\t\tprojection (front: number, back: number, fovy: number, aspectRatio: number): Matrix4 {\r\n\t\t\tthis.identity();\r\n\t\t\tlet fovy_rad = fovy * (Math.PI / 180);\r\n\t\t\tlet tangent = Math.tan(fovy_rad / 2.0);\r\n\t\t\tlet itangent = 1.0 / tangent;\r\n\t\t\tlet top = front * itangent;\r\n\t\t\tlet right = top * aspectRatio;\r\n\t\t\t\r\n\t\t\tlet v = this.values;\r\n\t\t\tv[M00] = front / right\r\n\t\t\tv[M10] = 0;\r\n\t\t\tv[M20] = 0;\r\n\t\t\tv[M30] = 0;\r\n\t\t\tv[M01] = 0;\r\n\t\t\tv[M11] = front / top;\r\n\t\t\tv[M21] = 0;\r\n\t\t\tv[M31] = 0;\r\n\t\t\tv[M02] = 0;\r\n\t\t\tv[M12] = 0;\r\n\t\t\tv[M22] = -(back +front) / (back - front);\r\n\t\t\tv[M32] = -1;\r\n\t\t\tv[M03] = 0;\r\n\t\t\tv[M13] = 0;\r\n\t\t\tv[M23] = -(2*back*front) / (back - front);\r\n\t\t\tv[M33] = 0;\r\n\r\n\t\t\t// let fovy_rad = fovy * (Math.PI / 180);\r\n\t\t\t// let l_fd = (1.0 / Math.tan(fovy_rad / 2.0));\r\n\t\t\t// let l_a1 = (far + near) / (near - far);\r\n\t\t\t// let l_a2 = (2 * far * near) / (near - far);\r\n\t\t\t// let v = this.values;\r\n\t\t\t// v[M00] = l_fd / aspectRatio;\r\n\t\t\t// v[M10] = 0;\r\n\t\t\t// v[M20] = 0;\r\n\t\t\t// v[M30] = 0;\r\n\t\t\t// v[M01] = 0;\r\n\t\t\t// v[M11] = l_fd;\r\n\t\t\t// v[M21] = 0;\r\n\t\t\t// v[M31] = 0;\r\n\t\t\t// v[M02] = 0;\r\n\t\t\t// v[M12] = 0;\r\n\t\t\t// v[M22] = l_a1;\r\n\t\t\t// v[M32] = -1;\r\n\t\t\t// v[M03] = 0;\r\n\t\t\t// v[M13] = 0;\r\n\t\t\t// v[M23] = l_a2;\r\n\t\t\t// v[M33] = 0;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tortho2d (x: number, y: number, width: number, height: number): Matrix4 {\r\n\t\t\treturn this.ortho(x, x + width, y, y + height, 0, 1);\r\n\t\t}\r\n\r\n\t\tortho (left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix4 {\r\n\t\t\tthis.identity();\r\n\t\t\tlet x_orth = 2 / (right - left);\r\n\t\t\tlet y_orth = 2 / (top - bottom);\r\n\t\t\tlet z_orth = -2 / (far - near);\r\n\r\n\t\t\tlet tx = -(right + left) / (right - left);\r\n\t\t\tlet ty = -(top + bottom) / (top - bottom);\r\n\t\t\tlet tz = -(far + near) / (far - near);\r\n\r\n\t\t\tlet v = this.values;\r\n\t\t\tv[M00] = x_orth;\r\n\t\t\tv[M10] = 0;\r\n\t\t\tv[M20] = 0;\r\n\t\t\tv[M30] = 0;\r\n\t\t\tv[M01] = 0;\r\n\t\t\tv[M11] = y_orth;\r\n\t\t\tv[M21] = 0;\r\n\t\t\tv[M31] = 0;\r\n\t\t\tv[M02] = 0;\r\n\t\t\tv[M12] = 0;\r\n\t\t\tv[M22] = z_orth;\r\n\t\t\tv[M32] = 0;\r\n\t\t\tv[M03] = tx;\r\n\t\t\tv[M13] = ty;\r\n\t\t\tv[M23] = tz;\r\n\t\t\tv[M33] = 1;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tmultiply (matrix: Matrix4): Matrix4 {\r\n\t\t\tlet t = this.temp;\r\n\t\t\tlet v = this.values;\r\n\t\t\tlet m = matrix.values;\r\n\t\t\tt[M00] = v[M00] * m[M00] + v[M01] * m[M10] + v[M02] * m[M20] + v[M03] * m[M30];\r\n\t\t\tt[M01] = v[M00] * m[M01] + v[M01] * m[M11] + v[M02] * m[M21] + v[M03] * m[M31];\r\n\t\t\tt[M02] = v[M00] * m[M02] + v[M01] * m[M12] + v[M02] * m[M22] + v[M03] * m[M32];\r\n\t\t\tt[M03] = v[M00] * m[M03] + v[M01] * m[M13] + v[M02] * m[M23] + v[M03] * m[M33];\r\n\t\t\tt[M10] = v[M10] * m[M00] + v[M11] * m[M10] + v[M12] * m[M20] + v[M13] * m[M30];\r\n\t\t\tt[M11] = v[M10] * m[M01] + v[M11] * m[M11] + v[M12] * m[M21] + v[M13] * m[M31];\r\n\t\t\tt[M12] = v[M10] * m[M02] + v[M11] * m[M12] + v[M12] * m[M22] + v[M13] * m[M32];\r\n\t\t\tt[M13] = v[M10] * m[M03] + v[M11] * m[M13] + v[M12] * m[M23] + v[M13] * m[M33];\r\n\t\t\tt[M20] = v[M20] * m[M00] + v[M21] * m[M10] + v[M22] * m[M20] + v[M23] * m[M30];\r\n\t\t\tt[M21] = v[M20] * m[M01] + v[M21] * m[M11] + v[M22] * m[M21] + v[M23] * m[M31];\r\n\t\t\tt[M22] = v[M20] * m[M02] + v[M21] * m[M12] + v[M22] * m[M22] + v[M23] * m[M32];\r\n\t\t\tt[M23] = v[M20] * m[M03] + v[M21] * m[M13] + v[M22] * m[M23] + v[M23] * m[M33];\r\n\t\t\tt[M30] = v[M30] * m[M00] + v[M31] * m[M10] + v[M32] * m[M20] + v[M33] * m[M30];\r\n\t\t\tt[M31] = v[M30] * m[M01] + v[M31] * m[M11] + v[M32] * m[M21] + v[M33] * m[M31];\r\n\t\t\tt[M32] = v[M30] * m[M02] + v[M31] * m[M12] + v[M32] * m[M22] + v[M33] * m[M32];\r\n\t\t\tt[M33] = v[M30] * m[M03] + v[M31] * m[M13] + v[M32] * m[M23] + v[M33] * m[M33];\r\n\t\t\treturn this.set(this.temp);\r\n\t\t}\r\n\r\n\t\tmultiplyLeft (matrix: Matrix4): Matrix4 {\r\n\t\t\tlet t = this.temp;\r\n\t\t\tlet v = this.values;\r\n\t\t\tlet m = matrix.values;\r\n\t\t\tt[M00] = m[M00] * v[M00] + m[M01] * v[M10] + m[M02] * v[M20] + m[M03] * v[M30];\r\n\t\t\tt[M01] = m[M00] * v[M01] + m[M01] * v[M11] + m[M02] * v[M21] + m[M03] * v[M31];\r\n\t\t\tt[M02] = m[M00] * v[M02] + m[M01] * v[M12] + m[M02] * v[M22] + m[M03] * v[M32];\r\n\t\t\tt[M03] = m[M00] * v[M03] + m[M01] * v[M13] + m[M02] * v[M23] + m[M03] * v[M33];\r\n\t\t\tt[M10] = m[M10] * v[M00] + m[M11] * v[M10] + m[M12] * v[M20] + m[M13] * v[M30];\r\n\t\t\tt[M11] = m[M10] * v[M01] + m[M11] * v[M11] + m[M12] * v[M21] + m[M13] * v[M31];\r\n\t\t\tt[M12] = m[M10] * v[M02] + m[M11] * v[M12] + m[M12] * v[M22] + m[M13] * v[M32];\r\n\t\t\tt[M13] = m[M10] * v[M03] + m[M11] * v[M13] + m[M12] * v[M23] + m[M13] * v[M33];\r\n\t\t\tt[M20] = m[M20] * v[M00] + m[M21] * v[M10] + m[M22] * v[M20] + m[M23] * v[M30];\r\n\t\t\tt[M21] = m[M20] * v[M01] + m[M21] * v[M11] + m[M22] * v[M21] + m[M23] * v[M31];\r\n\t\t\tt[M22] = m[M20] * v[M02] + m[M21] * v[M12] + m[M22] * v[M22] + m[M23] * v[M32];\r\n\t\t\tt[M23] = m[M20] * v[M03] + m[M21] * v[M13] + m[M22] * v[M23] + m[M23] * v[M33];\r\n\t\t\tt[M30] = m[M30] * v[M00] + m[M31] * v[M10] + m[M32] * v[M20] + m[M33] * v[M30];\r\n\t\t\tt[M31] = m[M30] * v[M01] + m[M31] * v[M11] + m[M32] * v[M21] + m[M33] * v[M31];\r\n\t\t\tt[M32] = m[M30] * v[M02] + m[M31] * v[M12] + m[M32] * v[M22] + m[M33] * v[M32];\r\n\t\t\tt[M33] = m[M30] * v[M03] + m[M31] * v[M13] + m[M32] * v[M23] + m[M33] * v[M33];\r\n\t\t\treturn this.set(this.temp);\r\n\t\t}\r\n\r\n\t\tlookAt (position: Vector3, direction: Vector3, up: Vector3) {\r\n\t\t\tMatrix4.initTemps();\r\n\t\t\tlet xAxis = Matrix4.xAxis, yAxis = Matrix4.yAxis, zAxis = Matrix4.zAxis;\r\n\t\t\tzAxis.setFrom(direction).normalize();\r\n\t\t\txAxis.setFrom(direction).normalize();\r\n\t\t\txAxis.cross(up).normalize();\r\n\t\t\tyAxis.setFrom(xAxis).cross(zAxis).normalize();\r\n\t\t\tthis.identity();\r\n\t\t\tlet val = this.values;\r\n\t\t\tval[M00] = xAxis.x;\r\n\t\t\tval[M01] = xAxis.y;\r\n\t\t\tval[M02] = xAxis.z;\r\n\t\t\tval[M10] = yAxis.x;\r\n\t\t\tval[M11] = yAxis.y;\r\n\t\t\tval[M12] = yAxis.z;\r\n\t\t\tval[M20] = -zAxis.x;\r\n\t\t\tval[M21] = -zAxis.y;\r\n\t\t\tval[M22] = -zAxis.z;\r\n\r\n\t\t\tMatrix4.tmpMatrix.identity();\r\n\t\t\tMatrix4.tmpMatrix.values[M03] = -position.x;\r\n\t\t\tMatrix4.tmpMatrix.values[M13] = -position.y;\r\n\t\t\tMatrix4.tmpMatrix.values[M23] = -position.z;\r\n\t\t\tthis.multiply(Matrix4.tmpMatrix)\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tstatic initTemps() {\r\n\t\t\tif (Matrix4.xAxis === null) Matrix4.xAxis = new Vector3();\r\n\t\t\tif (Matrix4.yAxis === null) Matrix4.yAxis = new Vector3();\r\n\t\t\tif (Matrix4.zAxis === null) Matrix4.zAxis = new Vector3();\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Matrix4 } from \"./Matrix4\";\r\nimport { Vector3 } from \"./Vector3\";\r\n\r\n// module spine.webgl {\r\n\r\n\texport interface Camera {\r\n\t\tposition: Vector3;\r\n\t\tdirection: Vector3;\r\n\t\tup: Vector3;\r\n\t\tnear: number\r\n\t\tfar: number\r\n\t\tfov: number\r\n\t\tzoom: number\r\n\t\tviewportWidth: number\r\n\t\tviewportHeight: number\r\n\t\tprojectionView: Matrix4;\r\n\t\tinverseProjectionView: Matrix4;\r\n\t\tprojection: Matrix4;\r\n\t\tview: Matrix4;\r\n\t\tis_perspective: boolean;\r\n\r\n\t\tupdate() : void;\r\n\t\tscreenToWorld (screenCoords: Vector3, screenWidth: number, screenHeight: number) : Vector3;\r\n\t\tworldToScreen(worldCoords: Vector3): Vector3;\r\n\t\tsetViewport(viewportWidth: number, viewportHeight: number): void;\r\n\t}\r\n\r\n\texport class OrthoCamera {\r\n\t\tposition = new Vector3(0, 0, 0);\r\n\t\tdirection = new Vector3(0, 0, -1);\r\n\t\tup = new Vector3(0, 1, 0);\r\n\t\tnear = 0;\r\n\t\tfar = 100;\r\n\t\tfov = 0.0; // unused\r\n\t\tzoom = 1;\r\n\t\tviewportWidth = 0;\r\n\t\tviewportHeight = 0;\r\n\t\tprojectionView = new Matrix4();\r\n\t\tinverseProjectionView = new Matrix4();\r\n\t\tprojection = new Matrix4();\r\n\t\tview = new Matrix4();\r\n\t\tis_perspective = false;\r\n\r\n\t\tprivate tmp = new Vector3();\r\n\r\n\t\tconstructor (viewportWidth: number, viewportHeight: number) {\r\n\t\t\tthis.viewportWidth = viewportWidth;\r\n\t\t\tthis.viewportHeight = viewportHeight;\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tupdate () {\r\n\t\t\tlet projection = this.projection;\r\n\t\t\tlet view = this.view;\r\n\t\t\tlet projectionView = this.projectionView;\r\n\t\t\tlet inverseProjectionView = this.inverseProjectionView;\r\n\t\t\tlet zoom = this.zoom, viewportWidth = this.viewportWidth, viewportHeight = this.viewportHeight;\r\n\t\t\tprojection.ortho(zoom * (-viewportWidth / 2), zoom * (viewportWidth / 2),\r\n\t\t\t\t\t\t\t zoom * (-viewportHeight / 2), zoom * (viewportHeight / 2),\r\n\t\t\t\t\t\t\t this.near, this.far);\r\n\t\t\tview.lookAt(this.position, this.direction, this.up);\r\n\t\t\tprojectionView.set(projection.values);\r\n\t\t\tprojectionView.multiply(view);\r\n\t\t\tinverseProjectionView.set(projectionView.values).invert();\r\n\t\t}\r\n\r\n\t\tscreenToWorld (screenCoords: Vector3, screenWidth: number, screenHeight: number) {\r\n\t\t\tlet x = screenCoords.x;\r\n\t\t\tlet y = screenCoords.y;\r\n\t\t\tlet z = screenCoords.z;\r\n\t\t\tlet tmp = this.tmp;\r\n\t\t\ttmp.x = (2 * (x / screenWidth)) - 1;\r\n\t\t\t// tmp.y = 1 - (2 * (y / screenHeight));\r\n\t\t\ttmp.y = (2 * (y / screenHeight)) - 1;\r\n\t\t\ttmp.z = z;\r\n\t\t\ttmp.project(this.inverseProjectionView);\r\n\t\t\tscreenCoords.set(tmp.x, tmp.y, tmp.z);\r\n\t\t\treturn screenCoords;\r\n\t\t}\r\n\r\n\t\tworldToScreen(worldCoords: Vector3): Vector3 {\r\n\t\t\tlet tmp = new Vector3(\r\n\t\t\t\tworldCoords.x,\r\n\t\t\t\tworldCoords.y,\r\n\t\t\t\tworldCoords.z,\r\n\t\t\t)\r\n\t\t\ttmp.multiply(this.projectionView);\r\n\t\t\ttmp.x = ((tmp.x + 1)/2) * (this.viewportWidth);\r\n\t\t\t// tmp.y = (1.0 - (tmp.y + 1)/2) * (this.viewportHeight);\r\n\t\t\ttmp.y = ((tmp.y + 1)/2) * (this.viewportHeight);\r\n\t\t\treturn new Vector3(tmp.x, tmp.y, 0);\r\n\t\t}\r\n\r\n\t\t// screenToWorld (screenCoords: Vector3, screenWidth: number, screenHeight: number) {\r\n\t\t// \tlet x = screenCoords.x;y = screenHeight - screenCoords.y - 1;\r\n\t\t// \tlet tmp = this.tmp;\r\n\t\t// \ttmp.x = (2 * x) / screenWidth - 1;\r\n\t\t// \ttmp.y = (2 * y) / screenHeight - 1;\r\n\t\t// \ttmp.z = (2 * screenCoords.z) - 1;\r\n\t\t// \ttmp.project(this.inverseProjectionView);\r\n\t\t// \tscreenCoords.set(tmp.x, tmp.y, tmp.z);\r\n\t\t// \treturn screenCoords;\r\n\t\t// }\r\n\r\n\t\t// worldToScreen(worldCoords: Vector2): spine.Vector2 {\r\n\t\t// \tlet tmp = new Vector3(\r\n\t\t// \t\tworldCoords.x,\r\n\t\t// \t\tworldCoords.y,\r\n\t\t// \t\t0,\r\n\t\t// \t)\r\n\t\t// \ttmp.multiply(this.projectionView);\r\n\t\t// \ttmp.x = ((tmp.x + 1)/2) * (this.viewportWidth);\r\n\t\t// \ttmp.y = ((tmp.y + 1)/2) * (this.viewportHeight);\r\n\t\t// \treturn new spine.Vector2(tmp.x, tmp.y);\r\n\t\t// }\r\n\r\n\t\tsetViewport(viewportWidth: number, viewportHeight: number) {\r\n\t\t\tthis.viewportWidth = viewportWidth;\r\n\t\t\tthis.viewportHeight = viewportHeight;\r\n\t\t}\r\n\t}\r\n\r\n\texport class PerspectiveCamera {\r\n\t\tposition = new Vector3(0, 0, 0);\r\n\t\tdirection = new Vector3(0, 0, -1);\r\n\t\tup = new Vector3(0, 1, 0);\r\n\t\tnear = 1;\r\n\t\tfar = 1000;\r\n\t\tzoom = 1;\r\n\t\tfov = 45;\r\n\t\tviewportWidth = 0;\r\n\t\tviewportHeight = 0;\r\n\t\tprojectionView = new Matrix4();\r\n\t\tinverseProjectionView = new Matrix4();\r\n\t\tprojection = new Matrix4();\r\n\t\tview = new Matrix4();\r\n\t\tis_perspective = true;\r\n\r\n\t\tprivate tmp = new Vector3();\r\n\r\n\t\tconstructor (viewportWidth: number, viewportHeight: number) {\r\n\t\t\tthis.viewportWidth = viewportWidth;\r\n\t\t\tthis.viewportHeight = viewportHeight;\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tupdate (if_throw = false) {\r\n\t\t\tlet projection = this.projection;\r\n\t\t\tlet view = this.view;\r\n\t\t\tlet projectionView = this.projectionView;\r\n\t\t\tlet inverseProjectionView = this.inverseProjectionView;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tprojection.projection(\r\n\t\t\t\t\tthis.near,\r\n\t\t\t\t\tthis.far,\r\n\t\t\t\t\tthis.fov,\r\n\t\t\t\t\tthis.viewportWidth / this.viewportHeight\r\n\t\t\t\t)\r\n\t\t\t\tview.lookAt(this.position, this.direction, this.up);\r\n\t\t\t\tprojectionView.set(projection.values);\r\n\t\t\t\tprojectionView.multiply(view);\r\n\t\t\t\tinverseProjectionView.set(projectionView.values).invert();\r\n\t\t\t} catch(e) {\r\n\t\t\t\tif (if_throw) {\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tscreenToWorld (screenCoords: Vector3, screenWidth: number, screenHeight: number) {\r\n\t\t\tlet x = screenCoords.x;\r\n\t\t\tlet y = screenCoords.y;\r\n\t\t\tlet z = screenCoords.z;\r\n\t\t\tlet tmp = this.tmp;\r\n\t\t\ttmp.x = (2 * (x / screenWidth)) - 1;\r\n\t\t\ttmp.y = (2 * (y / screenHeight)) - 1;\r\n\t\t\t// tmp.y = 1 - (2 * (y / screenHeight));  old\r\n\t\t\ttmp.z = z;\r\n\t\t\ttmp.project(this.inverseProjectionView);\r\n\t\t\tscreenCoords.set(tmp.x, tmp.y, tmp.z);\r\n\t\t\treturn screenCoords;\r\n\t\t}\r\n\r\n\t\tworldToScreen(worldCoords: Vector3): Vector3 {\r\n\t\t\tlet tmp = new Vector3(\r\n\t\t\t\tworldCoords.x,\r\n\t\t\t\tworldCoords.y,\r\n\t\t\t\tworldCoords.z,\r\n\t\t\t)\r\n\r\n\t\t\ttmp.project(this.projectionView);\r\n\t\t\ttmp.x = ((tmp.x + 1)/2) * (this.viewportWidth);\r\n\t\t\ttmp.y = ((tmp.y + 1)/2) * (this.viewportHeight);\r\n\t\t\t// tmp.y = (1.0 - ((tmp.y + 1)/2)) * (this.viewportHeight); old\r\n\t\t\tlet ret =  new Vector3(tmp.x, tmp.y, tmp.z);\r\n\t\t\tret.w = tmp.w;\r\n\t\t\treturn ret;\r\n\t\t}\r\n\r\n\t\tsetViewport(viewportWidth: number, viewportHeight: number) {\r\n\t\t\tthis.viewportWidth = viewportWidth;\r\n\t\t\tthis.viewportHeight = viewportHeight;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Pool } from \"../core/Utils\";\r\n\r\n// module spine.webgl {\r\n\texport class Input {\r\n\t\telement: HTMLElement;\r\n\t\tlastX = 0;\r\n\t\tlastY = 0;\r\n\t\tbuttonDown = false;\r\n\t\tcurrTouch: Touch = null;\r\n\t\ttouchesPool = new Pool<Touch>(() => {\r\n\t\t\treturn new Touch(0, 0, 0);\r\n\t\t});\r\n\r\n\t\tprivate listeners = new Array<InputListener>();\r\n\t\tconstructor (element: HTMLElement) {\r\n\t\t\tthis.element = element;\r\n\t\t\tthis.setupCallbacks(element);\r\n\t\t}\r\n\r\n\t\tprivate setupCallbacks(element: HTMLElement) {\r\n\t\t\tlet mouseDown = (ev: UIEvent) => {\r\n\t\t\t\tif (ev instanceof MouseEvent) {\r\n\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\tlet x = ev.clientX - rect.left;\r\n\t\t\t\t\tlet y = ev.clientY - rect.top;\r\n\r\n\t\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\t\tif (listeners[i].down) listeners[i].down(x, y);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.lastX = x;\r\n\t\t\t\t\tthis.lastY = y;\r\n\t\t\t\t\tthis.buttonDown = true;\r\n\r\n\t\t\t\t\tdocument.addEventListener(\"mousemove\", mouseMove);\r\n\t\t\t\t\tdocument.addEventListener(\"mouseup\", mouseUp);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet mouseMove = (ev: UIEvent) => {\r\n\t\t\t\tif (ev instanceof MouseEvent) {\r\n\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\tlet x = ev.clientX - rect.left;\r\n\t\t\t\t\tlet y = ev.clientY - rect.top;\r\n\r\n\t\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\t\tif (this.buttonDown) {\r\n\t\t\t\t\t\t\tif (listeners[i].dragged) listeners[i].dragged(x, y);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (listeners[i].moved) listeners[i].moved(x, y);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.lastX = x;\r\n\t\t\t\t\tthis.lastY = y;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tlet mouseUp = (ev: UIEvent) => {\r\n\t\t\t\tif (ev instanceof MouseEvent) {\r\n\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\tlet x = ev.clientX - rect.left;\r\n\t\t\t\t\tlet y = ev.clientY - rect.top;\r\n\r\n\t\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\t\tif (listeners[i].up) listeners[i].up(x, y);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.lastX = x;\r\n\t\t\t\t\tthis.lastY = y;\r\n\t\t\t\t\tthis.buttonDown = false;\r\n\t\t\t\t\tdocument.removeEventListener(\"mousemove\", mouseMove);\r\n\t\t\t\t\tdocument.removeEventListener(\"mouseup\", mouseUp);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\r\n\t\t\telement.addEventListener(\"mousedown\", mouseDown, true);\r\n\t\t\telement.addEventListener(\"mousemove\", mouseMove, true);\r\n\t\t\telement.addEventListener(\"mouseup\", mouseUp, true);\r\n\t\t\telement.addEventListener(\"touchstart\", (ev: TouchEvent) => {\r\n\t\t\t\tif (this.currTouch != null) return;\r\n\r\n\t\t\t\tvar touches = ev.changedTouches;\r\n\t\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\t\tvar touch = touches[i];\r\n\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\tlet x = touch.clientX - rect.left;\r\n\t\t\t\t\tlet y = touch.clientY - rect.top;\r\n\t\t\t\t\tthis.currTouch = this.touchesPool.obtain();\r\n\t\t\t\t\tthis.currTouch.identifier = touch.identifier;\r\n\t\t\t\t\tthis.currTouch.x = x;\r\n\t\t\t\t\tthis.currTouch.y = y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\tif (listeners[i].down) listeners[i].down(this.currTouch.x, this.currTouch.y);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.lastX = this.currTouch.x;\r\n\t\t\t\tthis.lastY = this.currTouch.y;\r\n\t\t\t\tthis.buttonDown = true;\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}, false);\r\n\t\t\telement.addEventListener(\"touchend\", (ev: TouchEvent) => {\r\n\t\t\t\tvar touches = ev.changedTouches;\r\n\t\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\t\tvar touch = touches[i];\r\n\t\t\t\t\tif (this.currTouch.identifier === touch.identifier) {\r\n\t\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\t\tlet x = this.currTouch.x = touch.clientX - rect.left;\r\n\t\t\t\t\t\tlet y = this.currTouch.y = touch.clientY - rect.top;\r\n\t\t\t\t\t\tthis.touchesPool.free(this.currTouch);\r\n\t\t\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\t\t\tif (listeners[i].up) listeners[i].up(x, y);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.lastX = x;\r\n\t\t\t\t\t\tthis.lastY = y;\r\n\t\t\t\t\t\tthis.buttonDown = false;\r\n\t\t\t\t\t\tthis.currTouch = null;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}, false);\r\n\t\t\telement.addEventListener(\"touchcancel\", (ev: TouchEvent) => {\r\n\t\t\t\tvar touches = ev.changedTouches;\r\n\t\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\t\tvar touch = touches[i];\r\n\t\t\t\t\tif (this.currTouch.identifier === touch.identifier) {\r\n\t\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\t\tlet x = this.currTouch.x = touch.clientX - rect.left;\r\n\t\t\t\t\t\tlet y = this.currTouch.y = touch.clientY - rect.top;\r\n\t\t\t\t\t\tthis.touchesPool.free(this.currTouch);\r\n\t\t\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\t\t\tif (listeners[i].up) listeners[i].up(x, y);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.lastX = x;\r\n\t\t\t\t\t\tthis.lastY = y;\r\n\t\t\t\t\t\tthis.buttonDown = false;\r\n\t\t\t\t\t\tthis.currTouch = null;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}, false);\r\n\t\t\telement.addEventListener(\"touchmove\", (ev: TouchEvent) => {\r\n\t\t\t\tif (this.currTouch == null) return;\r\n\r\n\t\t\t\tvar touches = ev.changedTouches;\r\n\t\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\t\tvar touch = touches[i];\r\n\t\t\t\t\tif (this.currTouch.identifier === touch.identifier) {\r\n\t\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\t\tlet x = touch.clientX - rect.left;\r\n\t\t\t\t\t\tlet y = touch.clientY - rect.top;\r\n\r\n\t\t\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\t\t\tif (listeners[i].dragged) listeners[i].dragged(x, y);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.lastX = this.currTouch.x = x;\r\n\t\t\t\t\t\tthis.lastY = this.currTouch.y = y;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}, false);\r\n\t\t}\r\n\r\n\t\taddListener(listener: InputListener) {\r\n\t\t\tthis.listeners.push(listener);\r\n\t\t}\r\n\r\n\t\tremoveListener(listener: InputListener) {\r\n\t\t\tlet idx = this.listeners.indexOf(listener);\r\n\t\t\tif (idx > -1) {\r\n\t\t\t\tthis.listeners.splice(idx, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport class Touch {\r\n\t\tconstructor(public identifier: number, public x: number, public y: number) {\r\n\t\t}\r\n\t}\r\n\r\n\texport interface InputListener {\r\n\t\tdown(x: number, y: number): void;\r\n\t\tup(x: number, y: number): void;\r\n\t\tmoved(x: number, y: number): void;\r\n\t\tdragged(x: number, y: number): void;\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Restorable, Disposable } from \"../core/Utils\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\texport class Shader implements Disposable, Restorable {\r\n\t\tpublic static MVP_MATRIX = \"u_projTrans\";\r\n\t\tpublic static POSITION = \"a_position\";\r\n\t\tpublic static COLOR = \"a_color\";\r\n\t\tpublic static COLOR2 = \"a_color2\";\r\n\t\tpublic static TEXCOORDS = \"a_texCoords\";\r\n\t\tpublic static SAMPLER = \"u_texture\";\r\n\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate vs: WebGLShader = null;\r\n\t\tprivate vsSource: string;\r\n\t\tprivate fs: WebGLShader = null;\r\n\t\tprivate fsSource: string;\r\n\t\tprivate program: WebGLProgram = null;\r\n\t\tprivate tmp2x2: Float32Array = new Float32Array(2 * 2);\r\n\t\tprivate tmp3x3: Float32Array = new Float32Array(3 * 3);\r\n\t\tprivate tmp4x4: Float32Array = new Float32Array(4 * 4);\r\n\r\n\t\tpublic getProgram () { return this.program; }\r\n\t\tpublic getVertexShader () { return this.vertexShader; }\r\n\t\tpublic getFragmentShader () { return this.fragmentShader; }\r\n\t\tpublic getVertexShaderSource () { return this.vsSource; }\r\n\t\tpublic getFragmentSource () { return this.fsSource; }\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext | WebGLRenderingContext, private vertexShader: string, private fragmentShader: string) {\r\n\t\t\tthis.vsSource = vertexShader;\r\n\t\t\tthis.fsSource = fragmentShader;\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t\tthis.context.addRestorable(this);\r\n\t\t\tthis.compile();\r\n\t\t}\r\n\r\n\t\tprivate compile () {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\ttry {\r\n\t\t\t\tthis.vs = this.compileShader(gl.VERTEX_SHADER, this.vertexShader);\r\n\t\t\t\tthis.fs = this.compileShader(gl.FRAGMENT_SHADER, this.fragmentShader);\r\n\t\t\t\tthis.program = this.compileProgram(this.vs, this.fs);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.log(\"Shader compilation error\", e);\r\n\t\t\t\tthis.dispose();\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate compileShader (type: number, source: string) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tlet shader = gl.createShader(type);\r\n\t\t\tgl.shaderSource(shader, source);\r\n\t\t\tgl.compileShader(shader);\r\n\t\t\tif (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n\t\t\t\tlet error = \"Couldn't compile shader: \" + gl.getShaderInfoLog(shader);\r\n\t\t\t\tgl.deleteShader(shader);\r\n\t\t\t\tif (!gl.isContextLost()) throw new Error(error);\r\n\t\t\t}\r\n\t\t\treturn shader;\r\n\t\t}\r\n\r\n\t\tprivate compileProgram (vs: WebGLShader, fs: WebGLShader) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tlet program = gl.createProgram();\r\n\t\t\tgl.attachShader(program, vs);\r\n\t\t\tgl.attachShader(program, fs);\r\n\t\t\tgl.linkProgram(program);\r\n\r\n\t\t\tif (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n\t\t\t\tlet error = \"Couldn't compile shader program: \" + gl.getProgramInfoLog(program);\r\n\t\t\t\tgl.deleteProgram(program);\r\n\t\t\t\tif (!gl.isContextLost()) throw new Error(error);\r\n\t\t\t}\r\n\t\t\treturn program;\r\n\t\t}\r\n\r\n\t\trestore () {\r\n\t\t\tthis.compile();\r\n\t\t}\r\n\r\n\t\tpublic bind () {\r\n\t\t\tthis.context.gl.useProgram(this.program);\r\n\t\t}\r\n\r\n\t\tpublic unbind () {\r\n\t\t\tthis.context.gl.useProgram(null);\r\n\t\t}\r\n\r\n\t\tpublic setUniformi (uniform: string, value: number) {\r\n\t\t\tthis.context.gl.uniform1i(this.getUniformLocation(uniform), value);\r\n\t\t}\r\n\r\n\t\tpublic setUniformf (uniform: string, value: number) {\r\n\t\t\tthis.context.gl.uniform1f(this.getUniformLocation(uniform), value);\r\n\t\t}\r\n\r\n\t\tpublic setUniform2f (uniform: string, value: number, value2: number) {\r\n\t\t\tthis.context.gl.uniform2f(this.getUniformLocation(uniform), value, value2);\r\n\t\t}\r\n\r\n\t\tpublic setUniform3f (uniform: string, value: number, value2: number, value3: number) {\r\n\t\t\tthis.context.gl.uniform3f(this.getUniformLocation(uniform), value, value2, value3);\r\n\t\t}\r\n\r\n\t\tpublic setUniform4f (uniform: string, value: number, value2: number, value3: number, value4: number) {\r\n\t\t\tthis.context.gl.uniform4f(this.getUniformLocation(uniform), value, value2, value3, value4);\r\n\t\t}\r\n\r\n\t\tpublic setUniform2x2f (uniform: string, value: ArrayLike<number>) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.tmp2x2.set(value);\r\n\t\t\tgl.uniformMatrix2fv(this.getUniformLocation(uniform), false, this.tmp2x2);\r\n\t\t}\r\n\r\n\t\tpublic setUniform3x3f (uniform: string, value: ArrayLike<number>) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.tmp3x3.set(value);\r\n\t\t\tgl.uniformMatrix3fv(this.getUniformLocation(uniform), false, this.tmp3x3);\r\n\t\t}\r\n\r\n\t\tpublic setUniform4x4f (uniform: string, value: ArrayLike<number>) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.tmp4x4.set(value);\r\n\t\t\tgl.uniformMatrix4fv(this.getUniformLocation(uniform), false, this.tmp4x4);\r\n\t\t}\r\n\r\n\t\tpublic getUniformLocation (uniform: string): WebGLUniformLocation {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tlet location = gl.getUniformLocation(this.program, uniform);\r\n\t\t\tif (!location && !gl.isContextLost()) throw new Error(`Couldn't find location for uniform ${uniform}`);\r\n\t\t\treturn location;\r\n\t\t}\r\n\r\n\t\tpublic getAttributeLocation (attribute: string): number {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tlet location = gl.getAttribLocation(this.program, attribute);\r\n\t\t\tif (location == -1 && !gl.isContextLost()) throw new Error(`Couldn't find location for attribute ${attribute}`);\r\n\t\t\treturn location;\r\n\t\t}\r\n\r\n\t\tpublic dispose () {\r\n\t\t\tthis.context.removeRestorable(this);\r\n\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (this.vs) {\r\n\t\t\t\tgl.deleteShader(this.vs);\r\n\t\t\t\tthis.vs = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.fs) {\r\n\t\t\t\tgl.deleteShader(this.fs);\r\n\t\t\t\tthis.fs = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.program) {\r\n\t\t\t\tgl.deleteProgram(this.program);\r\n\t\t\t\tthis.program = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic static newColoredTextured (context: ManagedWebGLRenderingContext | WebGLRenderingContext): Shader {\r\n\t\t\tlet vs = `\r\n\t\t\t\tattribute vec4 ${Shader.POSITION};\r\n\t\t\t\tattribute vec4 ${Shader.COLOR};\r\n\t\t\t\tattribute vec2 ${Shader.TEXCOORDS};\r\n\t\t\t\tuniform mat4 ${Shader.MVP_MATRIX};\r\n\t\t\t\tvarying vec4 v_color;\r\n\t\t\t\tvarying vec2 v_texCoords;\r\n\r\n\t\t\t\tvoid main () {\r\n\t\t\t\t\tv_color = ${Shader.COLOR};\r\n\t\t\t\t\tv_texCoords = ${Shader.TEXCOORDS};\r\n\t\t\t\t\tgl_Position = ${Shader.MVP_MATRIX} * ${Shader.POSITION};\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\r\n\t\t\tlet fs = `\r\n\t\t\t\t#ifdef GL_ES\r\n\t\t\t\t\t#define LOWP lowp\r\n\t\t\t\t\tprecision mediump float;\r\n\t\t\t\t#else\r\n\t\t\t\t\t#define LOWP\r\n\t\t\t\t#endif\r\n\t\t\t\tvarying LOWP vec4 v_color;\r\n\t\t\t\tvarying vec2 v_texCoords;\r\n\t\t\t\tuniform sampler2D u_texture;\r\n\r\n\t\t\t\tvoid main () {\r\n\t\t\t\t\tgl_FragColor = v_color * texture2D(u_texture, v_texCoords);\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\r\n\t\t\treturn new Shader(context, vs, fs);\r\n\t\t}\r\n\r\n\t\tpublic static newTwoColoredTextured (context: ManagedWebGLRenderingContext | WebGLRenderingContext): Shader {\r\n\t\t\tlet vs = `\r\n\t\t\t\tattribute vec4 ${Shader.POSITION};\r\n\t\t\t\tattribute vec4 ${Shader.COLOR};\r\n\t\t\t\tattribute vec4 ${Shader.COLOR2};\r\n\t\t\t\tattribute vec2 ${Shader.TEXCOORDS};\r\n\t\t\t\tuniform mat4 ${Shader.MVP_MATRIX};\r\n\t\t\t\tvarying vec4 v_light;\r\n\t\t\t\tvarying vec4 v_dark;\r\n\t\t\t\tvarying vec2 v_texCoords;\r\n\r\n\t\t\t\tvoid main () {\r\n\t\t\t\t\tv_light = ${Shader.COLOR};\r\n\t\t\t\t\tv_dark = ${Shader.COLOR2};\r\n\t\t\t\t\tv_texCoords = ${Shader.TEXCOORDS};\r\n\t\t\t\t\tgl_Position = ${Shader.MVP_MATRIX} * ${Shader.POSITION};\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\r\n\t\t\tlet fs = `\r\n\t\t\t\t#ifdef GL_ES\r\n\t\t\t\t\t#define LOWP lowp\r\n\t\t\t\t\tprecision mediump float;\r\n\t\t\t\t#else\r\n\t\t\t\t\t#define LOWP\r\n\t\t\t\t#endif\r\n\t\t\t\tvarying LOWP vec4 v_light;\r\n\t\t\t\tvarying LOWP vec4 v_dark;\r\n\t\t\t\tvarying vec2 v_texCoords;\r\n\t\t\t\tuniform sampler2D u_texture;\r\n\r\n\t\t\t\tvoid main () {\r\n\t\t\t\t\tvec4 texColor = texture2D(u_texture, v_texCoords);\r\n\t\t\t\t\tgl_FragColor.a = texColor.a * v_light.a;\r\n\t\t\t\t\tgl_FragColor.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\r\n\t\t\treturn new Shader(context, vs, fs);\r\n\t\t}\r\n\r\n\t\tpublic static newColored (context: ManagedWebGLRenderingContext | WebGLRenderingContext): Shader {\r\n\t\t\tlet vs = `\r\n\t\t\t\tattribute vec4 ${Shader.POSITION};\r\n\t\t\t\tattribute vec4 ${Shader.COLOR};\r\n\t\t\t\tuniform mat4 ${Shader.MVP_MATRIX};\r\n\t\t\t\tvarying vec4 v_color;\r\n\r\n\t\t\t\tvoid main () {\r\n\t\t\t\t\tv_color = ${Shader.COLOR};\r\n\t\t\t\t\tgl_Position = ${Shader.MVP_MATRIX} * ${Shader.POSITION};\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\r\n\t\t\tlet fs = `\r\n\t\t\t\t#ifdef GL_ES\r\n\t\t\t\t\t#define LOWP lowp\r\n\t\t\t\t\tprecision mediump float;\r\n\t\t\t\t#else\r\n\t\t\t\t\t#define LOWP\r\n\t\t\t\t#endif\r\n\t\t\t\tvarying LOWP vec4 v_color;\r\n\r\n\t\t\t\tvoid main () {\r\n\t\t\t\t\tgl_FragColor = v_color;\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\r\n\t\t\treturn new Shader(context, vs, fs);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Restorable, Disposable } from \"../core/Utils\";\r\nimport { Shader } from \"./Shader\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\texport class Mesh implements Disposable, Restorable {\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate vertices:Float32Array;\r\n\t\tprivate verticesBuffer: WebGLBuffer;\r\n\t\tprivate verticesLength = 0;\r\n\t\tprivate dirtyVertices = false;\r\n\t\tprivate indices:Uint16Array;\r\n\t\tprivate indicesBuffer: WebGLBuffer;\r\n\t\tprivate indicesLength = 0;\r\n\t\tprivate dirtyIndices = false;\r\n\t\tprivate elementsPerVertex = 0;\r\n\r\n\t\tgetAttributes (): VertexAttribute[] { return this.attributes; }\r\n\r\n\t\tmaxVertices (): number { return this.vertices.length / this.elementsPerVertex; }\r\n\t\tnumVertices (): number { return this.verticesLength / this.elementsPerVertex; }\r\n\t\tsetVerticesLength (length: number) {\r\n\t\t\tthis.dirtyVertices = true;\r\n\t\t\tthis.verticesLength = length;\r\n\t\t}\r\n\t\tgetVertices (): Float32Array { return this.vertices; }\r\n\r\n\t\tmaxIndices (): number { return this.indices.length; }\r\n\t\tnumIndices (): number { return this.indicesLength; }\r\n\t\tsetIndicesLength (length: number) {\r\n\t\t\tthis.dirtyIndices = true;\r\n\t\t\tthis.indicesLength = length;\r\n\t\t}\r\n\t\tgetIndices (): Uint16Array { return this.indices };\r\n\r\n\t\tgetVertexSizeInFloats (): number {\r\n\t\t\tlet size = 0;\r\n\t\t\tfor (var i = 0; i < this.attributes.length; i++) {\r\n\t\t\t\tlet attribute = this.attributes[i];\r\n\t\t\t\tsize += attribute.numElements;\r\n\t\t\t}\r\n\t\t\treturn size;\r\n\t\t}\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext | WebGLRenderingContext, private attributes: VertexAttribute[], maxVertices: number, maxIndices: number) {\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t\tthis.elementsPerVertex = 0;\r\n\t\t\tfor (let i = 0; i < attributes.length; i++) {\r\n\t\t\t\tthis.elementsPerVertex += attributes[i].numElements;\r\n\t\t\t}\r\n\t\t\tthis.vertices = new Float32Array(maxVertices * this.elementsPerVertex);\r\n\t\t\tthis.indices = new Uint16Array(maxIndices);\r\n\t\t\tthis.context.addRestorable(this);\r\n\t\t}\r\n\r\n\t\tsetVertices (vertices: Array<number>) {\r\n\t\t\tthis.dirtyVertices = true;\r\n\t\t\tif (vertices.length > this.vertices.length) throw Error(\"Mesh can't store more than \" + this.maxVertices() + \" vertices\");\r\n\t\t\tthis.vertices.set(vertices, 0);\r\n\t\t\tthis.verticesLength = vertices.length;\r\n\t\t}\r\n\r\n\t\tsetIndices (indices: Array<number>) {\r\n\t\t\tthis.dirtyIndices = true;\r\n\t\t\tif (indices.length > this.indices.length) throw Error(\"Mesh can't store more than \" + this.maxIndices() + \" indices\");\r\n\t\t\tthis.indices.set(indices, 0);\r\n\t\t\tthis.indicesLength = indices.length;\r\n\t\t}\r\n\r\n\t\tdraw (shader: Shader, primitiveType: number) {\r\n\t\t\tthis.drawWithOffset(shader, primitiveType, 0, this.indicesLength > 0? this.indicesLength: this.verticesLength / this.elementsPerVertex);\r\n\t\t}\r\n\r\n\t\tdrawWithOffset (shader: Shader, primitiveType: number, offset: number, count: number) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (this.dirtyVertices || this.dirtyIndices) this.update();\r\n\t\t\tthis.bind(shader);\r\n\t\t\tif (this.indicesLength > 0) {\r\n\t\t\t\tgl.drawElements(primitiveType, count, gl.UNSIGNED_SHORT, offset * 2);\r\n\t\t\t} else {\r\n\t\t\t\tgl.drawArrays(primitiveType, offset, count);\r\n\t\t\t}\r\n\t\t\tthis.unbind(shader);\r\n\t\t}\r\n\r\n\t\tbind (shader: Shader) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.verticesBuffer);\r\n\t\t\tlet offset = 0;\r\n\t\t\tfor (let i = 0; i < this.attributes.length; i++) {\r\n\t\t\t\tlet attrib = this.attributes[i];\r\n\t\t\t\tlet location = shader.getAttributeLocation(attrib.name);\r\n\t\t\t\tgl.enableVertexAttribArray(location);\r\n\t\t\t\tgl.vertexAttribPointer(location, attrib.numElements, gl.FLOAT, false, this.elementsPerVertex * 4, offset * 4);\r\n\t\t\t\toffset += attrib.numElements;\r\n\t\t\t}\r\n\t\t\tif (this.indicesLength > 0) gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\r\n\t\t}\r\n\r\n\t\tunbind (shader: Shader) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tfor (let i = 0; i < this.attributes.length; i++) {\r\n\t\t\t\tlet attrib = this.attributes[i];\r\n\t\t\t\tlet location = shader.getAttributeLocation(attrib.name);\r\n\t\t\t\tgl.disableVertexAttribArray(location);\r\n\t\t\t}\r\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\t\t\tif (this.indicesLength > 0) gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\r\n\t\t}\r\n\r\n\t\tprivate update () {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (this.dirtyVertices) {\r\n\t\t\t\tif (!this.verticesBuffer) {\r\n\t\t\t\t\tthis.verticesBuffer = gl.createBuffer();\r\n\t\t\t\t}\r\n\t\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.verticesBuffer);\r\n\t\t\t\tgl.bufferData(gl.ARRAY_BUFFER, this.vertices.subarray(0, this.verticesLength), gl.DYNAMIC_DRAW);\r\n\t\t\t\tthis.dirtyVertices = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.dirtyIndices) {\r\n\t\t\t\tif (!this.indicesBuffer) {\r\n\t\t\t\t\tthis.indicesBuffer = gl.createBuffer();\r\n\t\t\t\t}\r\n\t\t\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\r\n\t\t\t\tgl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.indices.subarray(0, this.indicesLength), gl.DYNAMIC_DRAW);\r\n\t\t\t\tthis.dirtyIndices = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trestore () {\r\n\t\t\tthis.verticesBuffer = null;\r\n\t\t\tthis.indicesBuffer = null;\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t\tthis.context.removeRestorable(this);\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tgl.deleteBuffer(this.verticesBuffer);\r\n\t\t\tgl.deleteBuffer(this.indicesBuffer);\r\n\t\t}\r\n\t}\r\n\r\n\texport class VertexAttribute {\r\n\t\tconstructor (public name: string, public type: VertexAttributeType, public numElements: number) { }\r\n\t}\r\n\r\n\texport class Position2Attribute extends VertexAttribute {\r\n\t\tconstructor () {\r\n\t\t\tsuper(Shader.POSITION, VertexAttributeType.Float, 2);\r\n\t\t}\r\n\t}\r\n\r\n\texport class Position3Attribute extends VertexAttribute {\r\n\t\tconstructor () {\r\n\t\t\tsuper(Shader.POSITION, VertexAttributeType.Float, 3);\r\n\t\t}\r\n\t}\r\n\r\n\texport class TexCoordAttribute extends VertexAttribute {\r\n\t\tconstructor (unit: number = 0) {\r\n\t\t\tsuper(Shader.TEXCOORDS + (unit == 0? \"\": unit), VertexAttributeType.Float, 2);\r\n\t\t}\r\n\t}\r\n\r\n\texport class ColorAttribute extends VertexAttribute {\r\n\t\tconstructor () {\r\n\t\t\tsuper(Shader.COLOR, VertexAttributeType.Float, 4);\r\n\t\t}\r\n\t}\r\n\r\n\texport class Color2Attribute extends VertexAttribute {\r\n\t\tconstructor () {\r\n\t\t\tsuper(Shader.COLOR2, VertexAttributeType.Float, 4);\r\n\t\t}\r\n\t}\r\n\r\n\texport enum VertexAttributeType {\r\n\t\tFloat\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Color, Vector2, MathUtils, Disposable } from \"../core/Utils\";\r\nimport { Mesh, Position2Attribute, ColorAttribute } from \"./Mesh\";\r\nimport { Shader } from \"./Shader\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\texport class ShapeRenderer implements Disposable {\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate isDrawing = false;\r\n\t\tprivate mesh: Mesh;\r\n\t\tprivate shapeType = ShapeType.Filled;\r\n\t\tprivate color = new Color(1, 1, 1, 1);\r\n\t\tprivate shader: Shader;\r\n\t\tprivate vertexIndex = 0;\r\n\t\tprivate tmp = new Vector2();\r\n\t\tprivate srcBlend: number;\r\n\t\tprivate dstBlend: number;\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext | WebGLRenderingContext, maxVertices: number = 10920) {\r\n\t\t\tif (maxVertices > 10920) throw new Error(\"Can't have more than 10920 triangles per batch: \" + maxVertices);\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t\tthis.mesh = new Mesh(context, [new Position2Attribute(), new ColorAttribute()], maxVertices, 0);\r\n\t\t\tthis.srcBlend = this.context.gl.SRC_ALPHA;\r\n\t\t\tthis.dstBlend = this.context.gl.ONE_MINUS_SRC_ALPHA;\r\n\t\t}\r\n\r\n\t\tbegin (shader: Shader) {\r\n\t\t\tif (this.isDrawing) throw new Error(\"ShapeRenderer.begin() has already been called\");\r\n\t\t\tthis.shader = shader;\r\n\t\t\tthis.vertexIndex = 0;\r\n\t\t\tthis.isDrawing = true;\r\n\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tgl.enable(gl.BLEND);\r\n\t\t\tgl.blendFunc(this.srcBlend, this.dstBlend);\r\n\t\t}\r\n\r\n\t\tsetBlendMode (srcBlend: number, dstBlend: number) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.srcBlend = srcBlend;\r\n\t\t\tthis.dstBlend = dstBlend;\r\n\t\t\tif (this.isDrawing) {\r\n\t\t\t\tthis.flush();\r\n\t\t\t\tgl.blendFunc(this.srcBlend, this.dstBlend);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsetColor (color: Color) {\r\n\t\t\tthis.color.setFromColor(color);\r\n\t\t}\r\n\r\n\t\tsetColorWith (r: number, g: number, b: number, a: number) {\r\n\t\t\tthis.color.set(r, g, b, a);\r\n\t\t}\r\n\r\n\t\tpoint (x: number, y: number, color: Color = null) {\r\n\t\t\tthis.check(ShapeType.Point, 1);\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tthis.vertex(x, y, color);\r\n\t\t}\r\n\r\n\t\tline (x: number, y: number, x2: number, y2: number, color: Color = null) {\r\n\t\t\tthis.check(ShapeType.Line, 2);\r\n\t\t\tlet vertices = this.mesh.getVertices();\r\n\t\t\tlet idx = this.vertexIndex;\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tthis.vertex(x, y, color);\r\n\t\t\tthis.vertex(x2, y2, color);\r\n\t\t}\r\n\r\n\t\ttriangle (filled: boolean, x: number, y: number, x2: number, y2: number, x3: number, y3: number, color: Color = null, color2: Color = null, color3: Color = null) {\r\n\t\t\tthis.check(filled ? ShapeType.Filled : ShapeType.Line, 3);\r\n\t\t\tlet vertices = this.mesh.getVertices();\r\n\t\t\tlet idx = this.vertexIndex;\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tif (color2 === null) color2 = this.color;\r\n\t\t\tif (color3 === null) color3 = this.color;\r\n\t\t\tif (filled) {\r\n\t\t\t\tthis.vertex(x, y, color);\r\n\t\t\t\tthis.vertex(x2, y2, color2);\r\n\t\t\t\tthis.vertex(x3, y3, color3);\r\n\t\t\t} else {\r\n\t\t\t\tthis.vertex(x, y, color);\r\n\t\t\t\tthis.vertex(x2, y2, color2);\r\n\r\n\t\t\t\tthis.vertex(x2, y2, color);\r\n\t\t\t\tthis.vertex(x3, y3, color2);\r\n\r\n\t\t\t\tthis.vertex(x3, y3, color);\r\n\t\t\t\tthis.vertex(x, y, color2);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tquad (filled: boolean, x: number, y: number, x2: number, y2: number, x3: number, y3: number, x4: number, y4: number, color: Color = null, color2: Color = null, color3: Color = null, color4: Color = null) {\r\n\t\t\tthis.check(filled ? ShapeType.Filled : ShapeType.Line, 3);\r\n\t\t\tlet vertices = this.mesh.getVertices();\r\n\t\t\tlet idx = this.vertexIndex;\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tif (color2 === null) color2 = this.color;\r\n\t\t\tif (color3 === null) color3 = this.color;\r\n\t\t\tif (color4 === null) color4 = this.color;\r\n\t\t\tif (filled) {\r\n\t\t\t\tthis.vertex(x, y, color); this.vertex(x2, y2, color2); this.vertex(x3, y3, color3);\r\n\t\t\t\tthis.vertex(x3, y3, color3); this.vertex(x4, y4, color4); this.vertex(x, y, color);\r\n\t\t\t} else {\r\n\t\t\t\tthis.vertex(x, y, color); this.vertex(x2, y2, color2);\r\n\t\t\t\tthis.vertex(x2, y2, color2); this.vertex(x3, y3, color3);\r\n\t\t\t\tthis.vertex(x3, y3, color3); this.vertex(x4, y4, color4);\r\n\t\t\t\tthis.vertex(x4, y4, color4); this.vertex(x, y, color);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trect (filled: boolean, x: number, y: number, width: number, height: number, color: Color = null) {\r\n\t\t\tthis.quad(filled, x, y, x + width, y, x + width, y + height, x, y + height, color, color, color, color);\r\n\t\t}\r\n\r\n\t\trectLine (filled: boolean, x1: number, y1: number, x2: number, y2: number, width: number, color: Color = null) {\r\n\t\t\tthis.check(filled ? ShapeType.Filled : ShapeType.Line, 8);\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tlet t = this.tmp.set(y2 - y1, x1 - x2);\r\n\t\t\tt.normalize();\r\n\t\t\twidth *= 0.5;\r\n\t\t\tlet tx = t.x * width;\r\n\t\t\tlet ty = t.y * width;\r\n\t\t\tif (!filled) {\r\n\t\t\t\tthis.vertex(x1 + tx, y1 + ty, color);\r\n\t\t\t\tthis.vertex(x1 - tx, y1 - ty, color);\r\n\t\t\t\tthis.vertex(x2 + tx, y2 + ty, color);\r\n\t\t\t\tthis.vertex(x2 - tx, y2 - ty, color);\r\n\r\n\t\t\t\tthis.vertex(x2 + tx, y2 + ty, color);\r\n\t\t\t\tthis.vertex(x1 + tx, y1 + ty, color);\r\n\r\n\t\t\t\tthis.vertex(x2 - tx, y2 - ty, color);\r\n\t\t\t\tthis.vertex(x1 - tx, y1 - ty, color);\r\n\t\t\t} else {\r\n\t\t\t\tthis.vertex(x1 + tx, y1 + ty, color);\r\n\t\t\t\tthis.vertex(x1 - tx, y1 - ty, color);\r\n\t\t\t\tthis.vertex(x2 + tx, y2 + ty, color);\r\n\r\n\t\t\t\tthis.vertex(x2 - tx, y2 - ty, color);\r\n\t\t\t\tthis.vertex(x2 + tx, y2 + ty, color);\r\n\t\t\t\tthis.vertex(x1 - tx, y1 - ty, color);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tx (x: number, y: number, size: number) {\r\n\t\t\tthis.line(x - size, y - size, x + size, y + size);\r\n\t\t\tthis.line(x - size, y + size, x + size, y - size);\r\n\t\t}\r\n\r\n\t\tpolygon (polygonVertices: ArrayLike<number>, offset: number, count: number, color: Color = null) {\r\n\t\t\tif (count < 3) throw new Error(\"Polygon must contain at least 3 vertices\");\r\n\t\t\tthis.check(ShapeType.Line, count * 2);\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tlet vertices = this.mesh.getVertices();\r\n\t\t\tlet idx = this.vertexIndex;\r\n\r\n\t\t\toffset <<= 1;\r\n\t\t\tcount <<= 1;\r\n\r\n\t\t\tlet firstX = polygonVertices[offset];\r\n\t\t\tlet firstY = polygonVertices[offset + 1];\r\n\t\t\tlet last = offset + count;\r\n\r\n\t\t\tfor (let i = offset, n = offset + count - 2; i < n; i += 2) {\r\n\t\t\t\tlet x1 = polygonVertices[i];\r\n\t\t\t\tlet y1 = polygonVertices[i+1];\r\n\r\n\t\t\t\tlet x2 = 0;\r\n\t\t\t\tlet y2 = 0;\r\n\r\n\t\t\t\tif (i + 2 >= last) {\r\n\t\t\t\t\tx2 = firstX;\r\n\t\t\t\t\ty2 = firstY;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tx2 = polygonVertices[i + 2];\r\n\t\t\t\t\ty2 = polygonVertices[i + 3];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.vertex(x1, y1, color);\r\n\t\t\t\tthis.vertex(x2, y2, color);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcircle (filled: boolean, x: number, y: number, radius: number, color: Color = null, segments: number = 0) {\r\n\t\t\tif (segments === 0) segments = Math.max(1, (6 * MathUtils.cbrt(radius)) | 0);\r\n\t\t\tif (segments <= 0) throw new Error(\"segments must be > 0.\");\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tlet angle = 2 * MathUtils.PI / segments;\r\n\t\t\tlet cos = Math.cos(angle);\r\n\t\t\tlet sin = Math.sin(angle);\r\n\t\t\tlet cx = radius, cy = 0;\r\n\t\t\tif (!filled) {\r\n\t\t\t\tthis.check(ShapeType.Line, segments * 2 + 2);\r\n\t\t\t\tfor (let i = 0; i < segments; i++) {\r\n\t\t\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t\t\t\tlet temp = cx;\r\n\t\t\t\t\tcx = cos * cx - sin * cy;\r\n\t\t\t\t\tcy = sin * temp + cos * cy;\r\n\t\t\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t\t\t}\r\n\t\t\t\t// Ensure the last segment is identical to the first.\r\n\t\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t\t} else {\r\n\t\t\t\tthis.check(ShapeType.Filled, segments * 3 + 3);\r\n\t\t\t\tsegments--;\r\n\t\t\t\tfor (let i = 0; i < segments; i++) {\r\n\t\t\t\t\tthis.vertex(x, y, color);\r\n\t\t\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t\t\t\tlet temp = cx;\r\n\t\t\t\t\tcx = cos * cx - sin * cy;\r\n\t\t\t\t\tcy = sin * temp + cos * cy;\r\n\t\t\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t\t\t}\r\n\t\t\t\t// Ensure the last segment is identical to the first.\r\n\t\t\t\tthis.vertex(x, y, color);\r\n\t\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t\t}\r\n\r\n\t\t\tlet temp = cx;\r\n\t\t\tcx = radius;\r\n\t\t\tcy = 0;\r\n\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t}\r\n\r\n\t\tcurve (x1: number, y1: number, cx1: number, cy1: number, cx2: number, cy2: number, x2: number, y2: number, segments: number, color: Color = null) {\r\n\t\t\tthis.check(ShapeType.Line, segments * 2 + 2);\r\n\t\t\tif (color === null) color = this.color;\r\n\r\n\t\t\t// Algorithm from: http://www.antigrain.com/research/bezier_interpolation/index.html#PAGE_BEZIER_INTERPOLATION\r\n\t\t\tlet subdiv_step = 1 / segments;\r\n\t\t\tlet subdiv_step2 = subdiv_step * subdiv_step;\r\n\t\t\tlet subdiv_step3 = subdiv_step * subdiv_step * subdiv_step;\r\n\r\n\t\t\tlet pre1 = 3 * subdiv_step;\r\n\t\t\tlet pre2 = 3 * subdiv_step2;\r\n\t\t\tlet pre4 = 6 * subdiv_step2;\r\n\t\t\tlet pre5 = 6 * subdiv_step3;\r\n\r\n\t\t\tlet tmp1x = x1 - cx1 * 2 + cx2;\r\n\t\t\tlet tmp1y = y1 - cy1 * 2 + cy2;\r\n\r\n\t\t\tlet tmp2x = (cx1 - cx2) * 3 - x1 + x2;\r\n\t\t\tlet tmp2y = (cy1 - cy2) * 3 - y1 + y2;\r\n\r\n\t\t\tlet fx = x1;\r\n\t\t\tlet fy = y1;\r\n\r\n\t\t\tlet dfx = (cx1 - x1) * pre1 + tmp1x * pre2 + tmp2x * subdiv_step3;\r\n\t\t\tlet dfy = (cy1 - y1) * pre1 + tmp1y * pre2 + tmp2y * subdiv_step3;\r\n\r\n\t\t\tlet ddfx = tmp1x * pre4 + tmp2x * pre5;\r\n\t\t\tlet ddfy = tmp1y * pre4 + tmp2y * pre5;\r\n\r\n\t\t\tlet dddfx = tmp2x * pre5;\r\n\t\t\tlet dddfy = tmp2y * pre5;\r\n\r\n\t\t\twhile (segments-- > 0) {\r\n\t\t\t\tthis.vertex(fx, fy, color);\r\n\t\t\t\tfx += dfx;\r\n\t\t\t\tfy += dfy;\r\n\t\t\t\tdfx += ddfx;\r\n\t\t\t\tdfy += ddfy;\r\n\t\t\t\tddfx += dddfx;\r\n\t\t\t\tddfy += dddfy;\r\n\t\t\t\tthis.vertex(fx, fy, color);\r\n\t\t\t}\r\n\t\t\tthis.vertex(fx, fy, color);\r\n\t\t\tthis.vertex(x2, y2, color);\r\n\t\t}\r\n\r\n\t\tprivate vertex (x: number, y: number, color: Color) {\r\n\t\t\tlet idx = this.vertexIndex;\r\n\t\t\tlet vertices = this.mesh.getVertices();\r\n\t\t\tvertices[idx++] = x;\r\n\t\t\tvertices[idx++] = y;\r\n\t\t\tvertices[idx++] = color.r;\r\n\t\t\tvertices[idx++] = color.g;\r\n\t\t\tvertices[idx++] = color.b;\r\n\t\t\tvertices[idx++] = color.a;\r\n\t\t\tthis.vertexIndex = idx;\r\n\t\t}\r\n\r\n\t\tend () {\r\n\t\t\tif (!this.isDrawing) throw new Error(\"ShapeRenderer.begin() has not been called\");\r\n\t\t\tthis.flush();\r\n\t\t\tthis.context.gl.disable(this.context.gl.BLEND);\r\n\t\t\tthis.isDrawing = false;\r\n\t\t}\r\n\r\n\t\tprivate flush () {\r\n\t\t\tif (this.vertexIndex == 0) return;\r\n\t\t\tthis.mesh.setVerticesLength(this.vertexIndex);\r\n\t\t\tthis.mesh.draw(this.shader, this.shapeType);\r\n\t\t\tthis.vertexIndex = 0;\r\n\t\t}\r\n\r\n\t\tprivate check(shapeType: ShapeType, numVertices: number) {\r\n\t\t\tif (!this.isDrawing) throw new Error(\"ShapeRenderer.begin() has not been called\");\r\n\t\t\tif (this.shapeType == shapeType) {\r\n\t\t\t\tif (this.mesh.maxVertices() - this.mesh.numVertices() < numVertices) this.flush();\r\n\t\t\t\telse return;\r\n\t\t\t} else {\r\n\t\t\t\tthis.flush();\r\n\t\t\t\tthis.shapeType = shapeType;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t\tthis.mesh.dispose();\r\n\t\t}\r\n\t}\r\n\r\n\texport enum ShapeType {\r\n\t\tPoint = 0x0000,\r\n\t\tLine = 0x0001,\r\n\t\tFilled = 0x0004\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Skeleton } from \"../core/Skeleton\";\r\nimport { TextureAtlasRegion } from \"../core/TextureAtlas\";\r\nimport { Color, MathUtils, Disposable } from \"../core/Utils\";\r\nimport { OrthoCamera, PerspectiveCamera, Camera } from \"./Camera\";\r\nimport { GLTexture } from \"./GLTexture\";\r\nimport { PolygonBatcher } from \"./PolygonBatcher\";\r\nimport { Shader } from \"./Shader\";\r\nimport { ShapeRenderer } from \"./ShapeRenderer\";\r\nimport { SkeletonDebugRenderer } from \"./SkeletonDebugRenderer\";\r\nimport { SkeletonRenderer } from \"./SkeletonRenderer\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\texport class SceneRenderer implements Disposable {\r\n\t\tcontext: ManagedWebGLRenderingContext;\r\n\t\tcanvas: HTMLCanvasElement;\r\n\t\t// camera: OrthoCamera;\r\n\t\torthoCamera: OrthoCamera;\r\n\t\tperspectiveCamera: PerspectiveCamera;\r\n\t\tcamera: Camera;\r\n\t\tbatcher: PolygonBatcher;\r\n\t\tprivate twoColorTint = false;\r\n\t\tprivate batcherShader: Shader;\r\n\t\tprivate shapes: ShapeRenderer;\r\n\t\tprivate shapesShader: Shader;\r\n\t\tprivate activeRenderer: PolygonBatcher | ShapeRenderer | SkeletonDebugRenderer = null;\r\n\t\tskeletonRenderer: SkeletonRenderer;\r\n\t\tskeletonDebugRenderer: SkeletonDebugRenderer;\r\n\t\tprivate QUAD = [\r\n\t\t\t0, 0, 1, 1, 1, 1, 0, 0,\r\n\t\t\t0, 0, 1, 1, 1, 1, 0, 0,\r\n\t\t\t0, 0, 1, 1, 1, 1, 0, 0,\r\n\t\t\t0, 0, 1, 1, 1, 1, 0, 0,\r\n\t\t];\r\n\t\tprivate QUAD_TRIANGLES = [0, 1, 2, 2, 3, 0];\r\n\t\tprivate WHITE = new Color(1, 1, 1, 1);\r\n\r\n\t\tconstructor (canvas: HTMLCanvasElement, context: ManagedWebGLRenderingContext | WebGLRenderingContext, twoColorTint: boolean = true) {\r\n\t\t\tthis.canvas = canvas;\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t\tthis.twoColorTint = twoColorTint;\r\n\t\t\t// this.camera = new OrthoCamera(canvas.width, canvas.height);\r\n\t\t\tthis.orthoCamera = new OrthoCamera(canvas.width, canvas.height);\r\n\t\t\tthis.perspectiveCamera = new PerspectiveCamera(canvas.width, canvas.height);\r\n\t\t\tthis.camera = this.perspectiveCamera;\r\n\r\n\t\t\tthis.batcherShader = twoColorTint ? Shader.newTwoColoredTextured(this.context) : Shader.newColoredTextured(this.context);\r\n\t\t\tthis.batcher = new PolygonBatcher(this.context, twoColorTint);\r\n\t\t\tthis.shapesShader = Shader.newColored(this.context);\r\n\t\t\tthis.shapes = new ShapeRenderer(this.context);\r\n\t\t\tthis.skeletonRenderer = new SkeletonRenderer(this.context, twoColorTint);\r\n\t\t\tthis.skeletonDebugRenderer = new SkeletonDebugRenderer(this.context);\r\n\t\t}\r\n\r\n\t\tbegin () {\r\n\t\t\tthis.camera.update();\r\n\t\t\tthis.enableRenderer(this.batcher);\r\n\t\t}\r\n\r\n\t\tdrawSkeleton (skeleton: Skeleton, premultipliedAlpha = false, slotRangeStart = -1, slotRangeEnd = -1) {\r\n\t\t\tthis.enableRenderer(this.batcher);\r\n\t\t\tthis.skeletonRenderer.premultipliedAlpha = premultipliedAlpha;\r\n\t\t\tthis.skeletonRenderer.draw(this.batcher, skeleton, slotRangeStart, slotRangeEnd);\r\n\t\t}\r\n\r\n\t\tdrawSkeletonDebug(skeleton: Skeleton, premultipliedAlpha = false, ignoredBones: Array<string> = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.skeletonDebugRenderer.premultipliedAlpha = premultipliedAlpha;\r\n\t\t\tthis.skeletonDebugRenderer.draw(this.shapes, skeleton, ignoredBones);\r\n\t\t}\r\n\r\n\t\tdrawTexture (texture: GLTexture, x: number, y: number, width: number, height: number, color: Color = null) {\r\n\t\t\tthis.enableRenderer(this.batcher);\r\n\t\t\tif (color === null) color = this.WHITE;\r\n\t\t\tlet quad = this.QUAD;\r\n\t\t\tvar i = 0;\r\n\t\t\tquad[i++] = x;\r\n\t\t\tquad[i++] = y;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x + width;\r\n\t\t\tquad[i++] = y;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x + width;\r\n\t\t\tquad[i++] = y + height;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x;\r\n\t\t\tquad[i++] = y + height;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tthis.batcher.draw(texture, quad, this.QUAD_TRIANGLES);\r\n\t\t}\r\n\r\n\t\tdrawTextureUV (texture: GLTexture, x: number, y: number, width: number, height: number, u: number, v: number, u2: number, v2: number, color: Color = null) {\r\n\t\t\tthis.enableRenderer(this.batcher);\r\n\t\t\tif (color === null) color = this.WHITE;\r\n\t\t\tlet quad = this.QUAD;\r\n\t\t\tvar i = 0;\r\n\t\t\tquad[i++] = x;\r\n\t\t\tquad[i++] = y;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = u;\r\n\t\t\tquad[i++] = v;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x + width;\r\n\t\t\tquad[i++] = y;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = u2;\r\n\t\t\tquad[i++] = v;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x + width;\r\n\t\t\tquad[i++] = y + height;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = u2;\r\n\t\t\tquad[i++] = v2;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x;\r\n\t\t\tquad[i++] = y + height;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = u;\r\n\t\t\tquad[i++] = v2;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tthis.batcher.draw(texture, quad, this.QUAD_TRIANGLES);\r\n\t\t}\r\n\r\n\t\tdrawTextureRotated (texture: GLTexture, x: number, y: number, width: number, height: number, pivotX: number, pivotY: number, angle: number, color: Color = null, premultipliedAlpha: boolean = false) {\r\n\t\t\tthis.enableRenderer(this.batcher);\r\n\t\t\tif (color === null) color = this.WHITE;\r\n\t\t\tlet quad = this.QUAD;\r\n\r\n\t\t\t// bottom left and top right corner points relative to origin\r\n\t\t\tlet worldOriginX = x + pivotX;\r\n\t\t\tlet worldOriginY = y + pivotY;\r\n\t\t\tlet fx = -pivotX;\r\n\t\t\tlet fy = -pivotY;\r\n\t\t\tlet fx2 = width - pivotX;\r\n\t\t\tlet fy2 = height - pivotY;\r\n\r\n\t\t\t// construct corner points, start from top left and go counter clockwise\r\n\t\t\tlet p1x = fx;\r\n\t\t\tlet p1y = fy;\r\n\t\t\tlet p2x = fx;\r\n\t\t\tlet p2y = fy2;\r\n\t\t\tlet p3x = fx2;\r\n\t\t\tlet p3y = fy2;\r\n\t\t\tlet p4x = fx2;\r\n\t\t\tlet p4y = fy;\r\n\r\n\t\t\tlet x1 = 0;\r\n\t\t\tlet y1 = 0;\r\n\t\t\tlet x2 = 0;\r\n\t\t\tlet y2 = 0;\r\n\t\t\tlet x3 = 0;\r\n\t\t\tlet y3 = 0;\r\n\t\t\tlet x4 = 0;\r\n\t\t\tlet y4 = 0;\r\n\r\n\t\t\t// rotate\r\n\t\t\tif (angle != 0) {\r\n\t\t\t\tlet cos = MathUtils.cosDeg(angle);\r\n\t\t\t\tlet sin = MathUtils.sinDeg(angle);\r\n\r\n\t\t\t\tx1 = cos * p1x - sin * p1y;\r\n\t\t\t\ty1 = sin * p1x + cos * p1y;\r\n\r\n\t\t\t\tx4 = cos * p2x - sin * p2y;\r\n\t\t\t\ty4 = sin * p2x + cos * p2y;\r\n\r\n\t\t\t\tx3 = cos * p3x - sin * p3y;\r\n\t\t\t\ty3 = sin * p3x + cos * p3y;\r\n\r\n\t\t\t\tx2 = x3 + (x1 - x4);\r\n\t\t\t\ty2 = y3 + (y1 - y4);\r\n\t\t\t} else {\r\n\t\t\t\tx1 = p1x;\r\n\t\t\t\ty1 = p1y;\r\n\r\n\t\t\t\tx4 = p2x;\r\n\t\t\t\ty4 = p2y;\r\n\r\n\t\t\t\tx3 = p3x;\r\n\t\t\t\ty3 = p3y;\r\n\r\n\t\t\t\tx2 = p4x;\r\n\t\t\t\ty2 = p4y;\r\n\t\t\t}\r\n\r\n\t\t\tx1 += worldOriginX;\r\n\t\t\ty1 += worldOriginY;\r\n\t\t\tx2 += worldOriginX;\r\n\t\t\ty2 += worldOriginY;\r\n\t\t\tx3 += worldOriginX;\r\n\t\t\ty3 += worldOriginY;\r\n\t\t\tx4 += worldOriginX;\r\n\t\t\ty4 += worldOriginY;\r\n\r\n\t\t\tvar i = 0;\r\n\t\t\tquad[i++] = x1;\r\n\t\t\tquad[i++] = y1;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x2;\r\n\t\t\tquad[i++] = y2;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x3;\r\n\t\t\tquad[i++] = y3;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x4;\r\n\t\t\tquad[i++] = y4;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tthis.batcher.draw(texture, quad, this.QUAD_TRIANGLES);\r\n\t\t}\r\n\r\n\t\tdrawRegion (region: TextureAtlasRegion, x: number, y: number, width: number, height: number, color: Color = null, premultipliedAlpha: boolean = false) {\r\n\t\t\tthis.enableRenderer(this.batcher);\r\n\t\t\tif (color === null) color = this.WHITE;\r\n\t\t\tlet quad = this.QUAD;\r\n\t\t\tvar i = 0;\r\n\t\t\tquad[i++] = x;\r\n\t\t\tquad[i++] = y;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = region.u;\r\n\t\t\tquad[i++] = region.v2;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x + width;\r\n\t\t\tquad[i++] = y;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = region.u2;\r\n\t\t\tquad[i++] = region.v2;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x + width;\r\n\t\t\tquad[i++] = y + height;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = region.u2;\r\n\t\t\tquad[i++] = region.v;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x;\r\n\t\t\tquad[i++] = y + height;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = region.u;\r\n\t\t\tquad[i++] = region.v;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tthis.batcher.draw(<GLTexture>region.texture, quad, this.QUAD_TRIANGLES);\r\n\t\t}\r\n\r\n\t\tline (x: number, y: number, x2: number, y2: number, color: Color = null, color2: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.line(x, y, x2, y2, color);\r\n\t\t}\r\n\r\n\t\ttriangle (filled: boolean, x: number, y: number, x2: number, y2: number, x3: number, y3: number, color: Color = null, color2: Color = null, color3: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.triangle(filled, x, y, x2, y2, x3, y3, color, color2, color3);\r\n\t\t}\r\n\r\n\t\tquad (filled: boolean, x: number, y: number, x2: number, y2: number, x3: number, y3: number, x4: number, y4: number, color: Color = null, color2: Color = null, color3: Color = null, color4: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.quad(filled, x, y, x2, y2, x3, y3, x4, y4, color, color2, color3, color4);\r\n\t\t}\r\n\r\n\t\trect (filled: boolean, x: number, y: number, width: number, height: number, color: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.rect(filled, x, y, width, height, color);\r\n\t\t}\r\n\r\n\t\trectLine (filled: boolean, x1: number, y1: number, x2: number, y2: number, width: number, color: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.rectLine(filled, x1, y1, x2, y2, width, color);\r\n\t\t}\r\n\r\n\t\tpolygon (polygonVertices: ArrayLike<number>, offset: number, count: number, color: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.polygon(polygonVertices, offset, count, color);\r\n\t\t}\r\n\r\n\t\tcircle (filled: boolean, x: number, y: number, radius: number, color: Color = null, segments: number = 0) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.circle(filled, x, y, radius, color, segments);\r\n\t\t}\r\n\r\n\t\tcurve (x1: number, y1: number, cx1: number, cy1: number, cx2: number, cy2: number, x2: number, y2: number, segments: number, color: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.curve(x1, y1, cx1, cy1, cx2, cy2, x2, y2, segments, color);\r\n\t\t}\r\n\r\n\t\tend () {\r\n\t\t\tif (this.activeRenderer === this.batcher) this.batcher.end();\r\n\t\t\telse if (this.activeRenderer === this.shapes) this.shapes.end();\r\n\t\t\tthis.activeRenderer = null;\r\n\t\t}\r\n\r\n\t\tresize (resizeMode: ResizeMode) {\r\n\t\t\tlet canvas = this.canvas;\r\n\t\t\tvar w = canvas.clientWidth;\r\n\t\t\tvar h = canvas.clientHeight;\r\n\t\t\tif (canvas.width != w || canvas.height != h) {\r\n\t\t\t\tcanvas.width = w;\r\n\t\t\t\tcanvas.height = h;\r\n\t\t\t}\r\n\t\t\tthis.context.gl.viewport(0, 0, canvas.width, canvas.height);\r\n\r\n\t\t\tif (resizeMode === ResizeMode.Stretch) {\r\n\t\t\t\t// nothing to do, we simply apply the viewport size of the camera\r\n\t\t\t} else if (resizeMode === ResizeMode.Expand) {\r\n\t\t\t\tthis.camera.setViewport(w, h);\r\n\t\t\t} else if (resizeMode === ResizeMode.Fit) {\r\n\t\t\t\tlet sourceWidth = canvas.width, sourceHeight = canvas.height;\r\n\t\t\t\tlet targetWidth = this.camera.viewportWidth, targetHeight = this.camera.viewportHeight;\r\n\t\t\t\tlet targetRatio = targetHeight / targetWidth;\r\n\t\t\t\tlet sourceRatio = sourceHeight / sourceWidth;\r\n\t\t\t\tlet scale = targetRatio < sourceRatio ? targetWidth / sourceWidth : targetHeight / sourceHeight;\r\n\t\t\t\tthis.camera.viewportWidth = sourceWidth * scale;\r\n\t\t\t\tthis.camera.viewportHeight = sourceHeight * scale;\r\n\t\t\t}\r\n\t\t\tthis.camera.update();\r\n\t\t}\r\n\r\n\t\tprivate enableRenderer(renderer: PolygonBatcher | ShapeRenderer | SkeletonDebugRenderer) {\r\n\t\t\tif (this.activeRenderer === renderer) return;\r\n\t\t\tthis.end();\r\n\t\t\tif (renderer instanceof PolygonBatcher) {\r\n\t\t\t\tthis.batcherShader.bind();\r\n\t\t\t\tthis.batcherShader.setUniform4x4f(Shader.MVP_MATRIX, this.camera.projectionView.values);\r\n\t\t\t\tthis.batcherShader.setUniformi(\"u_texture\", 0);\r\n\t\t\t\tthis.batcher.begin(this.batcherShader);\r\n\t\t\t\tthis.activeRenderer = this.batcher;\r\n\t\t\t} else if (renderer instanceof ShapeRenderer) {\r\n\t\t\t\tthis.shapesShader.bind();\r\n\t\t\t\tthis.shapesShader.setUniform4x4f(Shader.MVP_MATRIX, this.camera.projectionView.values);\r\n\t\t\t\tthis.shapes.begin(this.shapesShader);\r\n\t\t\t\tthis.activeRenderer = this.shapes;\r\n\t\t\t} else {\r\n\t\t\t\tthis.activeRenderer = this.skeletonDebugRenderer;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t\tthis.batcher.dispose();\r\n\t\t\tthis.batcherShader.dispose();\r\n\t\t\tthis.shapes.dispose();\r\n\t\t\tthis.shapesShader.dispose();\r\n\t\t\tthis.skeletonDebugRenderer.dispose();\r\n\t\t}\r\n\t}\r\n\r\n\texport enum ResizeMode {\r\n\t\tStretch,\r\n\t\tExpand,\r\n\t\tFit\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { MixBlend, AttachmentTimeline, MixDirection, RotateTimeline, DrawOrderTimeline, Timeline, EventTimeline, Animation } from \"./Animation\";\r\nimport { AnimationStateData } from \"./AnimationStateData\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Slot } from \"./Slot\";\r\nimport { IntSet, Pool, Utils, MathUtils } from \"./Utils\";\r\nimport {Event } from \"./Event\";\r\n\r\n// module spine {\r\n\r\n\t/** Applies animations over time, queues animations for later playback, mixes (crossfading) between animations, and applies\r\n\t * multiple animations on top of each other (layering).\r\n\t *\r\n\t * See [Applying Animations](http://esotericsoftware.com/spine-applying-animations/) in the Spine Runtimes Guide. */\r\n\texport class AnimationState {\r\n\t\tstatic emptyAnimation = new Animation(\"<empty>\", [], 0);\r\n\r\n\t\t/** 1. A previously applied timeline has set this property.\r\n\t\t *\r\n\t \t * Result: Mix from the current pose to the timeline pose. */\r\n\t\tstatic SUBSEQUENT = 0;\r\n\t\t/** 1. This is the first timeline to set this property.\r\n\t\t * 2. The next track entry applied after this one does not have a timeline to set this property.\r\n\t\t *\r\n\t\t * Result: Mix from the setup pose to the timeline pose. */\r\n\t\tstatic FIRST = 1;\r\n\t\t/** 1. This is the first timeline to set this property.\r\n\t\t * 2. The next track entry to be applied does have a timeline to set this property.\r\n\t\t * 3. The next track entry after that one does not have a timeline to set this property.\r\n\t\t *\r\n\t\t * Result: Mix from the setup pose to the timeline pose, but do not mix out. This avoids \"dipping\" when crossfading animations\r\n\t\t * that key the same property. A subsequent timeline will set this property using a mix. */\r\n\t\tstatic HOLD = 2;\r\n\t\t/** 1. This is the first timeline to set this property.\r\n\t\t * 2. The next track entry to be applied does have a timeline to set this property.\r\n\t\t * 3. The next track entry after that one does have a timeline to set this property.\r\n\t\t * 4. timelineHoldMix stores the first subsequent track entry that does not have a timeline to set this property.\r\n\t\t *\r\n\t\t * Result: The same as HOLD except the mix percentage from the timelineHoldMix track entry is used. This handles when more than\r\n\t\t * 2 track entries in a row have a timeline that sets the same property.\r\n\t\t *\r\n\t\t * Eg, A -> B -> C -> D where A, B, and C have a timeline setting same property, but D does not. When A is applied, to avoid\r\n\t\t * \"dipping\" A is not mixed out, however D (the first entry that doesn't set the property) mixing in is used to mix out A\r\n\t\t * (which affects B and C). Without using D to mix out, A would be applied fully until mixing completes, then snap into\r\n\t\t * place. */\r\n\t\tstatic HOLD_MIX = 3;\r\n\r\n\t\tstatic SETUP = 1;\r\n\t\tstatic CURRENT = 2;\r\n\r\n\t\t/** The AnimationStateData to look up mix durations. */\r\n\t\tdata: AnimationStateData;\r\n\r\n\t\t/** The list of tracks that currently have animations, which may contain null entries. */\r\n\t\ttracks = new Array<TrackEntry>();\r\n\r\n\t\t/** Multiplier for the delta time when the animation state is updated, causing time for all animations and mixes to play slower\r\n\t\t * or faster. Defaults to 1.\r\n\t\t *\r\n\t\t * See TrackEntry {@link TrackEntry#timeScale} for affecting a single animation. */\r\n\t\ttimeScale = 1;\r\n\t\tunkeyedState = 0;\r\n\r\n\t\tevents = new Array<Event>();\r\n\t\tlisteners = new Array<AnimationStateListener>();\r\n\t\tqueue = new EventQueue(this);\r\n\t\tpropertyIDs = new IntSet();\r\n\t\tanimationsChanged = false;\r\n\r\n\t\ttrackEntryPool = new Pool<TrackEntry>(() => new TrackEntry());\r\n\r\n\t\tconstructor (data: AnimationStateData) {\r\n\t\t\tthis.data = data;\r\n\t\t}\r\n\r\n\t\t/** Increments each track entry {@link TrackEntry#trackTime()}, setting queued animations as current if needed. */\r\n\t\tupdate (delta: number) {\r\n\t\t\tdelta *= this.timeScale;\r\n\t\t\tlet tracks = this.tracks;\r\n\t\t\tfor (let i = 0, n = tracks.length; i < n; i++) {\r\n\t\t\t\tlet current = tracks[i];\r\n\t\t\t\tif (current == null) continue;\r\n\r\n\t\t\t\tcurrent.animationLast = current.nextAnimationLast;\r\n\t\t\t\tcurrent.trackLast = current.nextTrackLast;\r\n\r\n\t\t\t\tlet currentDelta = delta * current.timeScale;\r\n\r\n\t\t\t\tif (current.delay > 0) {\r\n\t\t\t\t\tcurrent.delay -= currentDelta;\r\n\t\t\t\t\tif (current.delay > 0) continue;\r\n\t\t\t\t\tcurrentDelta = -current.delay;\r\n\t\t\t\t\tcurrent.delay = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet next = current.next;\r\n\t\t\t\tif (next != null) {\r\n\t\t\t\t\t// When the next entry's delay is passed, change to the next entry, preserving leftover time.\r\n\t\t\t\t\tlet nextTime = current.trackLast - next.delay;\r\n\t\t\t\t\tif (nextTime >= 0) {\r\n\t\t\t\t\t\tnext.delay = 0;\r\n\t\t\t\t\t\tnext.trackTime += current.timeScale == 0 ? 0 : (nextTime / current.timeScale + delta) * next.timeScale;\r\n\t\t\t\t\t\tcurrent.trackTime += currentDelta;\r\n\t\t\t\t\t\tthis.setCurrent(i, next, true);\r\n\t\t\t\t\t\twhile (next.mixingFrom != null) {\r\n\t\t\t\t\t\t\tnext.mixTime += delta;\r\n\t\t\t\t\t\t\tnext = next.mixingFrom;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (current.trackLast >= current.trackEnd && current.mixingFrom == null) {\r\n\t\t\t\t\ttracks[i] = null;\r\n\t\t\t\t\tthis.queue.end(current);\r\n\t\t\t\t\tthis.disposeNext(current);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (current.mixingFrom != null && this.updateMixingFrom(current, delta)) {\r\n\t\t\t\t\t// End mixing from entries once all have completed.\r\n\t\t\t\t\tlet from = current.mixingFrom;\r\n\t\t\t\t\tcurrent.mixingFrom = null;\r\n\t\t\t\t\tif (from != null) from.mixingTo = null;\r\n\t\t\t\t\twhile (from != null) {\r\n\t\t\t\t\t\tthis.queue.end(from);\r\n\t\t\t\t\t\tfrom = from.mixingFrom;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcurrent.trackTime += currentDelta;\r\n\t\t\t}\r\n\r\n\t\t\tthis.queue.drain();\r\n\t\t}\r\n\r\n\t\t/** Returns true when all mixing from entries are complete. */\r\n\t\tupdateMixingFrom (to: TrackEntry, delta: number): boolean {\r\n\t\t\tlet from = to.mixingFrom;\r\n\t\t\tif (from == null) return true;\r\n\r\n\t\t\tlet finished = this.updateMixingFrom(from, delta);\r\n\r\n\t\t\tfrom.animationLast = from.nextAnimationLast;\r\n\t\t\tfrom.trackLast = from.nextTrackLast;\r\n\r\n\t\t\t// Require mixTime > 0 to ensure the mixing from entry was applied at least once.\r\n\t\t\tif (to.mixTime > 0 && to.mixTime >= to.mixDuration) {\r\n\t\t\t\t// Require totalAlpha == 0 to ensure mixing is complete, unless mixDuration == 0 (the transition is a single frame).\r\n\t\t\t\tif (from.totalAlpha == 0 || to.mixDuration == 0) {\r\n\t\t\t\t\tto.mixingFrom = from.mixingFrom;\r\n\t\t\t\t\tif (from.mixingFrom != null) from.mixingFrom.mixingTo = to;\r\n\t\t\t\t\tto.interruptAlpha = from.interruptAlpha;\r\n\t\t\t\t\tthis.queue.end(from);\r\n\t\t\t\t}\r\n\t\t\t\treturn finished;\r\n\t\t\t}\r\n\r\n\t\t\tfrom.trackTime += delta * from.timeScale;\r\n\t\t\tto.mixTime += delta;\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t/** Poses the skeleton using the track entry animations. There are no side effects other than invoking listeners, so the\r\n\t\t * animation state can be applied to multiple skeletons to pose them identically.\r\n\t\t * @returns True if any animations were applied. */\r\n\t\tapply (skeleton: Skeleton) : boolean {\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\t\t\tif (this.animationsChanged) this._animationsChanged();\r\n\r\n\t\t\tlet events = this.events;\r\n\t\t\tlet tracks = this.tracks;\r\n\t\t\tlet applied = false;\r\n\r\n\t\t\tfor (let i = 0, n = tracks.length; i < n; i++) {\r\n\t\t\t\tlet current = tracks[i];\r\n\t\t\t\tif (current == null || current.delay > 0) continue;\r\n\t\t\t\tapplied = true;\r\n\t\t\t\tlet blend: MixBlend = i == 0 ? MixBlend.first : current.mixBlend;\r\n\r\n\t\t\t\t// Apply mixing from entries first.\r\n\t\t\t\tlet mix = current.alpha;\r\n\t\t\t\tif (current.mixingFrom != null)\r\n\t\t\t\t\tmix *= this.applyMixingFrom(current, skeleton, blend);\r\n\t\t\t\telse if (current.trackTime >= current.trackEnd && current.next == null)\r\n\t\t\t\t\tmix = 0;\r\n\r\n\t\t\t\t// Apply current entry.\r\n\t\t\t\tlet animationLast = current.animationLast, animationTime = current.getAnimationTime();\r\n\t\t\t\tlet timelineCount = current.animation.timelines.length;\r\n\t\t\t\tlet timelines = current.animation.timelines;\r\n\t\t\t\tif ((i == 0 && mix == 1) || blend == MixBlend.add) {\r\n\t\t\t\t\tfor (let ii = 0; ii < timelineCount; ii++) {\r\n\t\t\t\t\t\t// Fixes issue #302 on IOS9 where mix, blend sometimes became undefined and caused assets\r\n\t\t\t\t\t\t// to sometimes stop rendering when using color correction, as their RGBA values become NaN.\r\n\t\t\t\t\t\t// (https://github.com/pixijs/pixi-spine/issues/302)\r\n\t\t\t\t\t\tUtils.webkit602BugfixHelper(mix, blend);\r\n\t\t\t\t\t\tvar timeline = timelines[ii];\r\n\t\t\t\t\t\tif (timeline instanceof AttachmentTimeline)\r\n\t\t\t\t\t\t\tthis.applyAttachmentTimeline(timeline, skeleton, animationTime, blend, true);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\ttimeline.apply(skeleton, animationLast, animationTime, events, mix, blend, MixDirection.mixIn);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet timelineMode = current.timelineMode;\r\n\r\n\t\t\t\t\tlet firstFrame = current.timelinesRotation.length == 0;\r\n\t\t\t\t\tif (firstFrame) Utils.setArraySize(current.timelinesRotation, timelineCount << 1, null);\r\n\t\t\t\t\tlet timelinesRotation = current.timelinesRotation;\r\n\r\n\t\t\t\t\tfor (let ii = 0; ii < timelineCount; ii++) {\r\n\t\t\t\t\t\tlet timeline = timelines[ii];\r\n\t\t\t\t\t\tlet timelineBlend = timelineMode[ii]  == AnimationState.SUBSEQUENT ? blend : MixBlend.setup;\r\n\t\t\t\t\t\tif (timeline instanceof RotateTimeline) {\r\n\t\t\t\t\t\t\tthis.applyRotateTimeline(timeline, skeleton, animationTime, mix, timelineBlend, timelinesRotation, ii << 1, firstFrame);\r\n\t\t\t\t\t\t} else if (timeline instanceof AttachmentTimeline) {\r\n\t\t\t\t\t\t\tthis.applyAttachmentTimeline(timeline, skeleton, animationTime, blend, true);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// This fixes the WebKit 602 specific issue described at http://esotericsoftware.com/forum/iOS-10-disappearing-graphics-10109\r\n\t\t\t\t\t\t\tUtils.webkit602BugfixHelper(mix, blend);\r\n\t\t\t\t\t\t\ttimeline.apply(skeleton, animationLast, animationTime, events, mix, timelineBlend, MixDirection.mixIn);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.queueEvents(current, animationTime);\r\n\t\t\t\tevents.length = 0;\r\n\t\t\t\tcurrent.nextAnimationLast = animationTime;\r\n\t\t\t\tcurrent.nextTrackLast = current.trackTime;\r\n\t\t\t}\r\n\r\n\t\t\t// Set slots attachments to the setup pose, if needed. This occurs if an animation that is mixing out sets attachments so\r\n\t\t\t// subsequent timelines see any deform, but the subsequent timelines don't set an attachment (eg they are also mixing out or\r\n\t\t\t// the time is before the first key).\r\n\t\t\tvar setupState = this.unkeyedState + AnimationState.SETUP;\r\n\t\t\tvar slots = skeleton.slots;\r\n\t\t\tfor (var i = 0, n = skeleton.slots.length; i < n; i++) {\r\n\t\t\t\tvar slot = slots[i];\r\n\t\t\t\tif (slot.attachmentState == setupState) {\r\n\t\t\t\t\tvar attachmentName = slot.data.attachmentName;\r\n\t\t\t\t\tslot.attachment = (attachmentName == null ? null : skeleton.getAttachment(slot.data.index, attachmentName));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.unkeyedState += 2; // Increasing after each use avoids the need to reset attachmentState for every slot.\r\n\r\n\t\t\tthis.queue.drain();\r\n\t\t\treturn applied;\r\n\t\t}\r\n\r\n\t\tapplyMixingFrom (to: TrackEntry, skeleton: Skeleton, blend: MixBlend) {\r\n\t\t\tlet from = to.mixingFrom;\r\n\t\t\tif (from.mixingFrom != null) this.applyMixingFrom(from, skeleton, blend);\r\n\r\n\t\t\tlet mix = 0;\r\n\t\t\tif (to.mixDuration == 0) { // Single frame mix to undo mixingFrom changes.\r\n\t\t\t\tmix = 1;\r\n\t\t\t\tif (blend == MixBlend.first) blend = MixBlend.setup;\r\n\t\t\t} else {\r\n\t\t\t\tmix = to.mixTime / to.mixDuration;\r\n\t\t\t\tif (mix > 1) mix = 1;\r\n\t\t\t\tif (blend != MixBlend.first) blend = from.mixBlend;\r\n\t\t\t}\r\n\r\n\t\t\tlet events = mix < from.eventThreshold ? this.events : null;\r\n\t\t\tlet attachments = mix < from.attachmentThreshold, drawOrder = mix < from.drawOrderThreshold;\r\n\t\t\tlet animationLast = from.animationLast, animationTime = from.getAnimationTime();\r\n\t\t\tlet timelineCount = from.animation.timelines.length;\r\n\t\t\tlet timelines = from.animation.timelines;\r\n\t\t\tlet alphaHold = from.alpha * to.interruptAlpha, alphaMix = alphaHold * (1 - mix);\r\n\t\t\tif (blend == MixBlend.add) {\r\n\t\t\t\tfor (let i = 0; i < timelineCount; i++)\r\n\t\t\t\t\ttimelines[i].apply(skeleton, animationLast, animationTime, events, alphaMix, blend, MixDirection.mixOut);\r\n\t\t\t} else {\r\n\t\t\t\tlet timelineMode = from.timelineMode;\r\n\t\t\t\tlet timelineHoldMix = from.timelineHoldMix;\r\n\r\n\t\t\t\tlet firstFrame = from.timelinesRotation.length == 0;\r\n\t\t\t\tif (firstFrame) Utils.setArraySize(from.timelinesRotation, timelineCount << 1, null);\r\n\t\t\t\tlet timelinesRotation = from.timelinesRotation;\r\n\r\n\t\t\t\tfrom.totalAlpha = 0;\r\n\t\t\t\tfor (let i = 0; i < timelineCount; i++) {\r\n\t\t\t\t\tlet timeline = timelines[i];\r\n\t\t\t\t\tlet direction = MixDirection.mixOut;\r\n\t\t\t\t\tlet timelineBlend: MixBlend;\r\n\t\t\t\t\tlet alpha = 0;\r\n\t\t\t\t\tswitch (timelineMode[i]) {\r\n\t\t\t\t\tcase AnimationState.SUBSEQUENT:\r\n\t\t\t\t\t\tif (!drawOrder && timeline instanceof DrawOrderTimeline) continue;\r\n\t\t\t\t\t\ttimelineBlend = blend;\r\n\t\t\t\t\t\talpha = alphaMix;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AnimationState.FIRST:\r\n\t\t\t\t\t\ttimelineBlend = MixBlend.setup;\r\n\t\t\t\t\t\talpha = alphaMix;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AnimationState.HOLD:\r\n\t\t\t\t\t\ttimelineBlend = MixBlend.setup;\r\n\t\t\t\t\t\talpha = alphaHold;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\ttimelineBlend = MixBlend.setup;\r\n\t\t\t\t\t\tlet holdMix = timelineHoldMix[i];\r\n\t\t\t\t\t\talpha = alphaHold * Math.max(0, 1 - holdMix.mixTime / holdMix.mixDuration);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfrom.totalAlpha += alpha;\r\n\r\n\t\t\t\t\tif (timeline instanceof RotateTimeline)\r\n\t\t\t\t\t\tthis.applyRotateTimeline(timeline, skeleton, animationTime, alpha, timelineBlend, timelinesRotation, i << 1, firstFrame);\r\n\t\t\t\t\telse if (timeline instanceof AttachmentTimeline)\r\n\t\t\t\t\t\tthis.applyAttachmentTimeline(timeline, skeleton, animationTime, timelineBlend, attachments);\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// This fixes the WebKit 602 specific issue described at http://esotericsoftware.com/forum/iOS-10-disappearing-graphics-10109\r\n\t\t\t\t\t\tUtils.webkit602BugfixHelper(alpha, blend);\r\n\t\t\t\t\t\tif (drawOrder && timeline instanceof DrawOrderTimeline && timelineBlend == MixBlend.setup)\r\n\t\t\t\t\t\t\tdirection = MixDirection.mixIn;\r\n\t\t\t\t\t\ttimeline.apply(skeleton, animationLast, animationTime, events, alpha, timelineBlend, direction);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (to.mixDuration > 0) this.queueEvents(from, animationTime);\r\n\t\t\tthis.events.length = 0;\r\n\t\t\tfrom.nextAnimationLast = animationTime;\r\n\t\t\tfrom.nextTrackLast = from.trackTime;\r\n\r\n\t\t\treturn mix;\r\n\t\t}\r\n\r\n\t\tapplyAttachmentTimeline (timeline: AttachmentTimeline, skeleton: Skeleton, time: number, blend: MixBlend, attachments: boolean) {\r\n\r\n\t\t\tvar slot = skeleton.slots[timeline.slotIndex];\r\n\t\t\tif (!slot.bone.active) return;\r\n\r\n\t\t\tvar frames = timeline.frames;\r\n\t\t\tif (time < frames[0]) { // Time is before first frame.\r\n\t\t\t\tif (blend == MixBlend.setup || blend == MixBlend.first)\r\n\t\t\t\t\tthis.setAttachment(skeleton, slot, slot.data.attachmentName, attachments);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar frameIndex;\r\n\t\t\t\tif (time >= frames[frames.length - 1]) // Time is after last frame.\r\n\t\t\t\t\tframeIndex = frames.length - 1;\r\n\t\t\t\telse\r\n\t\t\t\t\tframeIndex = Animation.binarySearch(frames, time) - 1;\r\n\t\t\t\tthis.setAttachment(skeleton, slot, timeline.attachmentNames[frameIndex], attachments);\r\n\t\t\t}\r\n\r\n\t\t\t// If an attachment wasn't set (ie before the first frame or attachments is false), set the setup attachment later.\r\n\t\t\tif (slot.attachmentState <= this.unkeyedState) slot.attachmentState = this.unkeyedState + AnimationState.SETUP;\r\n\t\t}\r\n\r\n\t\tsetAttachment (skeleton: Skeleton, slot: Slot, attachmentName: string, attachments: boolean) {\r\n\t\t\tslot.attachment = attachmentName == null ? null : skeleton.getAttachment(slot.data.index, attachmentName);\r\n\t\t\tif (attachments) slot.attachmentState = this.unkeyedState + AnimationState.CURRENT;\r\n\t\t}\r\n\r\n\r\n\t\tapplyRotateTimeline (timeline: Timeline, skeleton: Skeleton, time: number, alpha: number, blend: MixBlend,\r\n\t\t\ttimelinesRotation: Array<number>, i: number, firstFrame: boolean) {\r\n\r\n\t\t\tif (firstFrame) timelinesRotation[i] = 0;\r\n\r\n\t\t\tif (alpha == 1) {\r\n\t\t\t\ttimeline.apply(skeleton, 0, time, null, 1, blend, MixDirection.mixIn);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet rotateTimeline = timeline as RotateTimeline;\r\n\t\t\tlet frames = rotateTimeline.frames;\r\n\t\t\tlet bone = skeleton.bones[rotateTimeline.boneIndex];\r\n\t\t\tif (!bone.active) return;\r\n\t\t\tlet r1 = 0, r2 = 0;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\t\tbone.rotation = bone.data.rotation;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\t\tr1 = bone.rotation;\r\n\t\t\t\t\t\tr2 = bone.data.rotation;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tr1 = blend == MixBlend.setup ? bone.data.rotation : bone.rotation;\r\n\t\t\t\tif (time >= frames[frames.length - RotateTimeline.ENTRIES]) // Time is after last frame.\r\n\t\t\t\t\tr2 = bone.data.rotation + frames[frames.length + RotateTimeline.PREV_ROTATION];\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\t\tlet frame = Animation.binarySearch(frames, time, RotateTimeline.ENTRIES);\r\n\t\t\t\t\tlet prevRotation = frames[frame + RotateTimeline.PREV_ROTATION];\r\n\t\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\t\tlet percent = rotateTimeline.getCurvePercent((frame >> 1) - 1,\r\n\t\t\t\t\t\t1 - (time - frameTime) / (frames[frame + RotateTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\t\tr2 = frames[frame + RotateTimeline.ROTATION] - prevRotation;\r\n\t\t\t\t\tr2 -= (16384 - ((16384.499999999996 - r2 / 360) | 0)) * 360;\r\n\t\t\t\t\tr2 = prevRotation + r2 * percent + bone.data.rotation;\r\n\t\t\t\t\tr2 -= (16384 - ((16384.499999999996 - r2 / 360) | 0)) * 360;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Mix between rotations using the direction of the shortest route on the first frame while detecting crosses.\r\n\t\t\tlet total = 0, diff = r2 - r1;\r\n\t\t\tdiff -= (16384 - ((16384.499999999996 - diff / 360) | 0)) * 360;\r\n\t\t\tif (diff == 0) {\r\n\t\t\t\ttotal = timelinesRotation[i];\r\n\t\t\t} else {\r\n\t\t\t\tlet lastTotal = 0, lastDiff = 0;\r\n\t\t\t\tif (firstFrame) {\r\n\t\t\t\t\tlastTotal = 0;\r\n\t\t\t\t\tlastDiff = diff;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlastTotal = timelinesRotation[i]; // Angle and direction of mix, including loops.\r\n\t\t\t\t\tlastDiff = timelinesRotation[i + 1]; // Difference between bones.\r\n\t\t\t\t}\r\n\t\t\t\tlet current = diff > 0, dir = lastTotal >= 0;\r\n\t\t\t\t// Detect cross at 0 (not 180).\r\n\t\t\t\tif (MathUtils.signum(lastDiff) != MathUtils.signum(diff) && Math.abs(lastDiff) <= 90) {\r\n\t\t\t\t\t// A cross after a 360 rotation is a loop.\r\n\t\t\t\t\tif (Math.abs(lastTotal) > 180) lastTotal += 360 * MathUtils.signum(lastTotal);\r\n\t\t\t\t\tdir = current;\r\n\t\t\t\t}\r\n\t\t\t\ttotal = diff + lastTotal - lastTotal % 360; // Store loops as part of lastTotal.\r\n\t\t\t\tif (dir != current) total += 360 * MathUtils.signum(lastTotal);\r\n\t\t\t\ttimelinesRotation[i] = total;\r\n\t\t\t}\r\n\t\t\ttimelinesRotation[i + 1] = diff;\r\n\t\t\tr1 += total * alpha;\r\n\t\t\tbone.rotation = r1 - (16384 - ((16384.499999999996 - r1 / 360) | 0)) * 360;\r\n\t\t}\r\n\r\n\t\tqueueEvents (entry: TrackEntry, animationTime: number) {\r\n\t\t\tlet animationStart = entry.animationStart, animationEnd = entry.animationEnd;\r\n\t\t\tlet duration = animationEnd - animationStart;\r\n\t\t\tlet trackLastWrapped = entry.trackLast % duration;\r\n\r\n\t\t\t// Queue events before complete.\r\n\t\t\tlet events = this.events;\r\n\t\t\tlet i = 0, n = events.length;\r\n\t\t\tfor (; i < n; i++) {\r\n\t\t\t\tlet event = events[i];\r\n\t\t\t\tif (event.time < trackLastWrapped) break;\r\n\t\t\t\tif (event.time > animationEnd) continue; // Discard events outside animation start/end.\r\n\t\t\t\tthis.queue.event(entry, event);\r\n\t\t\t}\r\n\r\n\t\t\t// Queue complete if completed a loop iteration or the animation.\r\n\t\t\tlet complete = false;\r\n\t\t\tif (entry.loop)\r\n\t\t\t\tcomplete = duration == 0 || trackLastWrapped > entry.trackTime % duration;\r\n\t\t\telse\r\n\t\t\t\tcomplete = animationTime >= animationEnd && entry.animationLast < animationEnd;\r\n\t\t\tif (complete) this.queue.complete(entry);\r\n\r\n\t\t\t// Queue events after complete.\r\n\t\t\tfor (; i < n; i++) {\r\n\t\t\t\tlet event = events[i];\r\n\t\t\t\tif (event.time < animationStart) continue; // Discard events outside animation start/end.\r\n\t\t\t\tthis.queue.event(entry, events[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Removes all animations from all tracks, leaving skeletons in their current pose.\r\n\t\t *\r\n\t\t * It may be desired to use {@link AnimationState#setEmptyAnimation()} to mix the skeletons back to the setup pose,\r\n\t\t * rather than leaving them in their current pose. */\r\n\t\tclearTracks () {\r\n\t\t\tlet oldDrainDisabled = this.queue.drainDisabled;\r\n\t\t\tthis.queue.drainDisabled = true;\r\n\t\t\tfor (let i = 0, n = this.tracks.length; i < n; i++)\r\n\t\t\t\tthis.clearTrack(i);\r\n\t\t\tthis.tracks.length = 0;\r\n\t\t\tthis.queue.drainDisabled = oldDrainDisabled;\r\n\t\t\tthis.queue.drain();\r\n\t\t}\r\n\r\n\t\t/** Removes all animations from the track, leaving skeletons in their current pose.\r\n\t\t *\r\n\t\t * It may be desired to use {@link AnimationState#setEmptyAnimation()} to mix the skeletons back to the setup pose,\r\n\t\t * rather than leaving them in their current pose. */\r\n\t\tclearTrack (trackIndex: number) {\r\n\t\t\tif (trackIndex >= this.tracks.length) return;\r\n\t\t\tlet current = this.tracks[trackIndex];\r\n\t\t\tif (current == null) return;\r\n\r\n\t\t\tthis.queue.end(current);\r\n\r\n\t\t\tthis.disposeNext(current);\r\n\r\n\t\t\tlet entry = current;\r\n\t\t\twhile (true) {\r\n\t\t\t\tlet from = entry.mixingFrom;\r\n\t\t\t\tif (from == null) break;\r\n\t\t\t\tthis.queue.end(from);\r\n\t\t\t\tentry.mixingFrom = null;\r\n\t\t\t\tentry.mixingTo = null;\r\n\t\t\t\tentry = from;\r\n\t\t\t}\r\n\r\n\t\t\tthis.tracks[current.trackIndex] = null;\r\n\r\n\t\t\tthis.queue.drain();\r\n\t\t}\r\n\r\n\t\tsetCurrent (index: number, current: TrackEntry, interrupt: boolean) {\r\n\t\t\tlet from = this.expandToIndex(index);\r\n\t\t\tthis.tracks[index] = current;\r\n\r\n\t\t\tif (from != null) {\r\n\t\t\t\tif (interrupt) this.queue.interrupt(from);\r\n\t\t\t\tcurrent.mixingFrom = from;\r\n\t\t\t\tfrom.mixingTo = current;\r\n\t\t\t\tcurrent.mixTime = 0;\r\n\r\n\t\t\t\t// Store the interrupted mix percentage.\r\n\t\t\t\tif (from.mixingFrom != null && from.mixDuration > 0)\r\n\t\t\t\t\tcurrent.interruptAlpha *= Math.min(1, from.mixTime / from.mixDuration);\r\n\r\n\t\t\t\tfrom.timelinesRotation.length = 0; // Reset rotation for mixing out, in case entry was mixed in.\r\n\t\t\t}\r\n\r\n\t\t\tthis.queue.start(current);\r\n\t\t}\r\n\r\n\t\t/** Sets an animation by name.\r\n\t \t*\r\n\t \t* {@link #setAnimationWith(}. */\r\n\t\tsetAnimation (trackIndex: number, animationName: string, loop: boolean) {\r\n\t\t\tlet animation = this.data.skeletonData.findAnimation(animationName);\r\n\t\t\tif (animation == null) throw new Error(\"Animation not found: \" + animationName);\r\n\t\t\treturn this.setAnimationWith(trackIndex, animation, loop);\r\n\t\t}\r\n\r\n\t\t/** Sets the current animation for a track, discarding any queued animations. If the formerly current track entry was never\r\n\t\t * applied to a skeleton, it is replaced (not mixed from).\r\n\t\t * @param loop If true, the animation will repeat. If false it will not, instead its last frame is applied if played beyond its\r\n\t\t *           duration. In either case {@link TrackEntry#trackEnd} determines when the track is cleared.\r\n\t\t * @returns A track entry to allow further customization of animation playback. References to the track entry must not be kept\r\n\t\t *         after the {@link AnimationStateListener#dispose()} event occurs. */\r\n\t\tsetAnimationWith (trackIndex: number, animation: Animation, loop: boolean) {\r\n\t\t\tif (animation == null) throw new Error(\"animation cannot be null.\");\r\n\t\t\tlet interrupt = true;\r\n\t\t\tlet current = this.expandToIndex(trackIndex);\r\n\t\t\tif (current != null) {\r\n\t\t\t\tif (current.nextTrackLast == -1) {\r\n\t\t\t\t\t// Don't mix from an entry that was never applied.\r\n\t\t\t\t\tthis.tracks[trackIndex] = current.mixingFrom;\r\n\t\t\t\t\tthis.queue.interrupt(current);\r\n\t\t\t\t\tthis.queue.end(current);\r\n\t\t\t\t\tthis.disposeNext(current);\r\n\t\t\t\t\tcurrent = current.mixingFrom;\r\n\t\t\t\t\tinterrupt = false;\r\n\t\t\t\t} else\r\n\t\t\t\t\tthis.disposeNext(current);\r\n\t\t\t}\r\n\t\t\tlet entry = this.trackEntry(trackIndex, animation, loop, current);\r\n\t\t\tthis.setCurrent(trackIndex, entry, interrupt);\r\n\t\t\tthis.queue.drain();\r\n\t\t\treturn entry;\r\n\t\t}\r\n\r\n\t\t/** Queues an animation by name.\r\n\t\t *\r\n\t\t * See {@link #addAnimationWith()}. */\r\n\t\taddAnimation (trackIndex: number, animationName: string, loop: boolean, delay: number) {\r\n\t\t\tlet animation = this.data.skeletonData.findAnimation(animationName);\r\n\t\t\tif (animation == null) throw new Error(\"Animation not found: \" + animationName);\r\n\t\t\treturn this.addAnimationWith(trackIndex, animation, loop, delay);\r\n\t\t}\r\n\r\n\t\t/** Adds an animation to be played after the current or last queued animation for a track. If the track is empty, it is\r\n\t\t * equivalent to calling {@link #setAnimationWith()}.\r\n\t\t * @param delay If > 0, sets {@link TrackEntry#delay}. If <= 0, the delay set is the duration of the previous track entry\r\n\t\t *           minus any mix duration (from the {@link AnimationStateData}) plus the specified `delay` (ie the mix\r\n\t\t *           ends at (`delay` = 0) or before (`delay` < 0) the previous track entry duration). If the\r\n\t\t *           previous entry is looping, its next loop completion is used instead of its duration.\r\n\t\t * @returns A track entry to allow further customization of animation playback. References to the track entry must not be kept\r\n\t\t *         after the {@link AnimationStateListener#dispose()} event occurs. */\r\n\t\taddAnimationWith (trackIndex: number, animation: Animation, loop: boolean, delay: number) {\r\n\t\t\tif (animation == null) throw new Error(\"animation cannot be null.\");\r\n\r\n\t\t\tlet last = this.expandToIndex(trackIndex);\r\n\t\t\tif (last != null) {\r\n\t\t\t\twhile (last.next != null)\r\n\t\t\t\t\tlast = last.next;\r\n\t\t\t}\r\n\r\n\t\t\tlet entry = this.trackEntry(trackIndex, animation, loop, last);\r\n\r\n\t\t\tif (last == null) {\r\n\t\t\t\tthis.setCurrent(trackIndex, entry, true);\r\n\t\t\t\tthis.queue.drain();\r\n\t\t\t} else {\r\n\t\t\t\tlast.next = entry;\r\n\t\t\t\tif (delay <= 0) {\r\n\t\t\t\t\tlet duration = last.animationEnd - last.animationStart;\r\n\t\t\t\t\tif (duration != 0) {\r\n\t\t\t\t\t\tif (last.loop)\r\n\t\t\t\t\t\t\tdelay += duration * (1 + ((last.trackTime / duration) | 0));\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tdelay += Math.max(duration, last.trackTime);\r\n\t\t\t\t\t\tdelay -= this.data.getMix(last.animation, animation);\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tdelay = last.trackTime;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tentry.delay = delay;\r\n\t\t\treturn entry;\r\n\t\t}\r\n\r\n\t\t/** Sets an empty animation for a track, discarding any queued animations, and sets the track entry's\r\n\t\t * {@link TrackEntry#mixduration}. An empty animation has no timelines and serves as a placeholder for mixing in or out.\r\n\t\t *\r\n\t\t * Mixing out is done by setting an empty animation with a mix duration using either {@link #setEmptyAnimation()},\r\n\t\t * {@link #setEmptyAnimations()}, or {@link #addEmptyAnimation()}. Mixing to an empty animation causes\r\n\t\t * the previous animation to be applied less and less over the mix duration. Properties keyed in the previous animation\r\n\t\t * transition to the value from lower tracks or to the setup pose value if no lower tracks key the property. A mix duration of\r\n\t\t * 0 still mixes out over one frame.\r\n\t\t *\r\n\t\t * Mixing in is done by first setting an empty animation, then adding an animation using\r\n\t\t * {@link #addAnimation()} and on the returned track entry, set the\r\n\t\t * {@link TrackEntry#setMixDuration()}. Mixing from an empty animation causes the new animation to be applied more and\r\n\t\t * more over the mix duration. Properties keyed in the new animation transition from the value from lower tracks or from the\r\n\t\t * setup pose value if no lower tracks key the property to the value keyed in the new animation. */\r\n\t\tsetEmptyAnimation (trackIndex: number, mixDuration: number) {\r\n\t\t\tlet entry = this.setAnimationWith(trackIndex, AnimationState.emptyAnimation, false);\r\n\t\t\tentry.mixDuration = mixDuration;\r\n\t\t\tentry.trackEnd = mixDuration;\r\n\t\t\treturn entry;\r\n\t\t}\r\n\r\n\t\t/** Adds an empty animation to be played after the current or last queued animation for a track, and sets the track entry's\r\n\t\t * {@link TrackEntry#mixDuration}. If the track is empty, it is equivalent to calling\r\n\t\t * {@link #setEmptyAnimation()}.\r\n\t\t *\r\n\t\t * See {@link #setEmptyAnimation()}.\r\n\t\t * @param delay If > 0, sets {@link TrackEntry#delay}. If <= 0, the delay set is the duration of the previous track entry\r\n\t\t *           minus any mix duration plus the specified `delay` (ie the mix ends at (`delay` = 0) or\r\n\t\t *           before (`delay` < 0) the previous track entry duration). If the previous entry is looping, its next\r\n\t\t *           loop completion is used instead of its duration.\r\n\t\t * @return A track entry to allow further customization of animation playback. References to the track entry must not be kept\r\n\t\t *         after the {@link AnimationStateListener#dispose()} event occurs. */\r\n\t\taddEmptyAnimation (trackIndex: number, mixDuration: number, delay: number) {\r\n\t\t\tif (delay <= 0) delay -= mixDuration;\r\n\t\t\tlet entry = this.addAnimationWith(trackIndex, AnimationState.emptyAnimation, false, delay);\r\n\t\t\tentry.mixDuration = mixDuration;\r\n\t\t\tentry.trackEnd = mixDuration;\r\n\t\t\treturn entry;\r\n\t\t}\r\n\r\n\t\t/** Sets an empty animation for every track, discarding any queued animations, and mixes to it over the specified mix\r\n\t \t* duration. */\r\n\t\tsetEmptyAnimations (mixDuration: number) {\r\n\t\t\tlet oldDrainDisabled = this.queue.drainDisabled;\r\n\t\t\tthis.queue.drainDisabled = true;\r\n\t\t\tfor (let i = 0, n = this.tracks.length; i < n; i++) {\r\n\t\t\t\tlet current = this.tracks[i];\r\n\t\t\t\tif (current != null) this.setEmptyAnimation(current.trackIndex, mixDuration);\r\n\t\t\t}\r\n\t\t\tthis.queue.drainDisabled = oldDrainDisabled;\r\n\t\t\tthis.queue.drain();\r\n\t\t}\r\n\r\n\t\texpandToIndex (index: number) {\r\n\t\t\tif (index < this.tracks.length) return this.tracks[index];\r\n\t\t\tUtils.ensureArrayCapacity(this.tracks, index + 1, null);\r\n\t\t\tthis.tracks.length = index + 1;\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** @param last May be null. */\r\n\t\ttrackEntry (trackIndex: number, animation: Animation, loop: boolean, last: TrackEntry) {\r\n\t\t\tlet entry = this.trackEntryPool.obtain();\r\n\t\t\tentry.trackIndex = trackIndex;\r\n\t\t\tentry.animation = animation;\r\n\t\t\tentry.loop = loop;\r\n\t\t\tentry.holdPrevious = false;\r\n\r\n\t\t\tentry.eventThreshold = 0;\r\n\t\t\tentry.attachmentThreshold = 0;\r\n\t\t\tentry.drawOrderThreshold = 0;\r\n\r\n\t\t\tentry.animationStart = 0;\r\n\t\t\tentry.animationEnd = animation.duration;\r\n\t\t\tentry.animationLast = -1;\r\n\t\t\tentry.nextAnimationLast = -1;\r\n\r\n\t\t\tentry.delay = 0;\r\n\t\t\tentry.trackTime = 0;\r\n\t\t\tentry.trackLast = -1;\r\n\t\t\tentry.nextTrackLast = -1;\r\n\t\t\tentry.trackEnd = Number.MAX_VALUE;\r\n\t\t\tentry.timeScale = 1;\r\n\r\n\t\t\tentry.alpha = 1;\r\n\t\t\tentry.interruptAlpha = 1;\r\n\t\t\tentry.mixTime = 0;\r\n\t\t\tentry.mixDuration = last == null ? 0 : this.data.getMix(last.animation, animation);\r\n\t\t\tentry.mixBlend = MixBlend.replace;\r\n\t\t\treturn entry;\r\n\t\t}\r\n\r\n\t\tdisposeNext (entry: TrackEntry) {\r\n\t\t\tlet next = entry.next;\r\n\t\t\twhile (next != null) {\r\n\t\t\t\tthis.queue.dispose(next);\r\n\t\t\t\tnext = next.next;\r\n\t\t\t}\r\n\t\t\tentry.next = null;\r\n\t\t}\r\n\r\n\t\t_animationsChanged () {\r\n\t\t\tthis.animationsChanged = false;\r\n\r\n\t\t\tthis.propertyIDs.clear();\r\n\r\n\t\t\tfor (let i = 0, n = this.tracks.length; i < n; i++) {\r\n\t\t\t\tlet entry = this.tracks[i];\r\n\t\t\t\tif (entry == null) continue;\r\n\t\t\t\twhile (entry.mixingFrom != null)\r\n\t\t\t\t\tentry = entry.mixingFrom;\r\n\r\n\t\t\t\tdo {\r\n\t\t\t\t\tif (entry.mixingFrom == null || entry.mixBlend != MixBlend.add) this.computeHold(entry);\r\n\t\t\t\t\tentry = entry.mixingTo;\r\n\t\t\t\t} while (entry != null)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcomputeHold (entry: TrackEntry) {\r\n\t\t\tlet to = entry.mixingTo;\r\n\t\t\tlet timelines = entry.animation.timelines;\r\n\t\t\tlet timelinesCount = entry.animation.timelines.length;\r\n\t\t\tlet timelineMode = Utils.setArraySize(entry.timelineMode, timelinesCount);\r\n\t\t\tentry.timelineHoldMix.length = 0;\r\n\t\t\tlet timelineDipMix = Utils.setArraySize(entry.timelineHoldMix, timelinesCount);\r\n\t\t\tlet propertyIDs = this.propertyIDs;\r\n\r\n\t\t\tif (to != null && to.holdPrevious) {\r\n\t\t\t\tfor (let i = 0; i < timelinesCount; i++) {\r\n\t\t\t\t\tpropertyIDs.add(timelines[i].getPropertyId());\r\n\t\t\t\t\ttimelineMode[i] = AnimationState.HOLD;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\touter:\r\n\t\t\tfor (let i = 0; i < timelinesCount; i++) {\r\n\t\t\t\tlet timeline = timelines[i];\r\n\t\t\t\tlet id = timeline.getPropertyId();\r\n\t\t\t\tif (!propertyIDs.add(id))\r\n\t\t\t\t\ttimelineMode[i] = AnimationState.SUBSEQUENT;\r\n\t\t\t\telse if (to == null || timeline instanceof AttachmentTimeline || timeline instanceof DrawOrderTimeline\r\n\t\t\t\t\t|| timeline instanceof EventTimeline || !to.animation.hasTimeline(id)) {\r\n\t\t\t\t\ttimelineMode[i] = AnimationState.FIRST;\r\n\t\t\t\t}else {\r\n\t\t\t\t\tfor (let next = to.mixingTo; next != null; next = next.mixingTo) {\r\n\t\t\t\t\t\tif (next.animation.hasTimeline(id)) continue;\r\n\t\t\t\t\t\tif (entry.mixDuration > 0) {\r\n\t\t\t\t\t\t\ttimelineMode[i] = AnimationState.HOLD_MIX;\r\n\t\t\t\t\t\t\ttimelineDipMix[i] = next;\r\n\t\t\t\t\t\t\tcontinue outer;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimelineMode[i] = AnimationState.HOLD;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Returns the track entry for the animation currently playing on the track, or null if no animation is currently playing. */\r\n\t\tgetCurrent (trackIndex: number) {\r\n\t\t\tif (trackIndex >= this.tracks.length) return null;\r\n\t\t\treturn this.tracks[trackIndex];\r\n\t\t}\r\n\r\n\t\t/** Adds a listener to receive events for all track entries. */\r\n\t\taddListener (listener: AnimationStateListener) {\r\n\t\t\tif (listener == null) throw new Error(\"listener cannot be null.\");\r\n\t\t\tthis.listeners.push(listener);\r\n\t\t}\r\n\r\n\t\t/** Removes the listener added with {@link #addListener()}. */\r\n\t\tremoveListener (listener: AnimationStateListener) {\r\n\t\t\tlet index = this.listeners.indexOf(listener);\r\n\t\t\tif (index >= 0) this.listeners.splice(index, 1);\r\n\t\t}\r\n\r\n\t\t/** Removes all listeners added with {@link #addListener()}. */\r\n\t\tclearListeners () {\r\n\t\t\tthis.listeners.length = 0;\r\n\t\t}\r\n\r\n\t\t/** Discards all listener notifications that have not yet been delivered. This can be useful to call from an\r\n\t\t * {@link AnimationStateListener} when it is known that further notifications that may have been already queued for delivery\r\n\t\t * are not wanted because new animations are being set. */\r\n\t\tclearListenerNotifications () {\r\n\t\t\tthis.queue.clear();\r\n\t\t}\r\n\t}\r\n\r\n\t/** Stores settings and other state for the playback of an animation on an {@link AnimationState} track.\r\n\t *\r\n\t * References to a track entry must not be kept after the {@link AnimationStateListener#dispose()} event occurs. */\r\n\texport class TrackEntry {\r\n\t\t/** The animation to apply for this track entry. */\r\n\t\tanimation: Animation;\r\n\r\n\t\t/** The animation queued to start after this animation, or null. `next` makes up a linked list. */\r\n\t\tnext: TrackEntry;\r\n\r\n\t\t/** The track entry for the previous animation when mixing from the previous animation to this animation, or null if no\r\n\t\t * mixing is currently occuring. When mixing from multiple animations, `mixingFrom` makes up a linked list. */\r\n\t\tmixingFrom: TrackEntry;\r\n\r\n\t\t/** The track entry for the next animation when mixing from this animation to the next animation, or null if no mixing is\r\n\t\t * currently occuring. When mixing to multiple animations, `mixingTo` makes up a linked list. */\r\n\t\tmixingTo: TrackEntry;\r\n\r\n\t\t/** The listener for events generated by this track entry, or null.\r\n\t\t *\r\n\t\t * A track entry returned from {@link AnimationState#setAnimation()} is already the current animation\r\n\t\t * for the track, so the track entry listener {@link AnimationStateListener#start()} will not be called. */\r\n\t\tlistener: AnimationStateListener;\r\n\r\n\t\t/** The index of the track where this track entry is either current or queued.\r\n\t\t *\r\n\t\t * See {@link AnimationState#getCurrent()}. */\r\n\t\ttrackIndex: number;\r\n\r\n\t\t/** If true, the animation will repeat. If false it will not, instead its last frame is applied if played beyond its\r\n\t\t * duration. */\r\n\t\tloop: boolean;\r\n\r\n\t\t/** If true, when mixing from the previous animation to this animation, the previous animation is applied as normal instead\r\n\t\t * of being mixed out.\r\n\t\t *\r\n\t\t * When mixing between animations that key the same property, if a lower track also keys that property then the value will\r\n\t\t * briefly dip toward the lower track value during the mix. This happens because the first animation mixes from 100% to 0%\r\n\t\t * while the second animation mixes from 0% to 100%. Setting `holdPrevious` to true applies the first animation\r\n\t\t * at 100% during the mix so the lower track value is overwritten. Such dipping does not occur on the lowest track which\r\n\t\t * keys the property, only when a higher track also keys the property.\r\n\t\t *\r\n\t\t * Snapping will occur if `holdPrevious` is true and this animation does not key all the same properties as the\r\n\t\t * previous animation. */\r\n\t\tholdPrevious: boolean;\r\n\r\n\t\t/** When the mix percentage ({@link #mixTime} / {@link #mixDuration}) is less than the\r\n\t\t * `eventThreshold`, event timelines are applied while this animation is being mixed out. Defaults to 0, so event\r\n\t\t * timelines are not applied while this animation is being mixed out. */\r\n\t\teventThreshold: number;\r\n\r\n\t\t/** When the mix percentage ({@link #mixtime} / {@link #mixDuration}) is less than the\r\n\t\t * `attachmentThreshold`, attachment timelines are applied while this animation is being mixed out. Defaults to\r\n\t\t * 0, so attachment timelines are not applied while this animation is being mixed out. */\r\n\t\tattachmentThreshold: number;\r\n\r\n\t\t/** When the mix percentage ({@link #mixTime} / {@link #mixDuration}) is less than the\r\n\t\t * `drawOrderThreshold`, draw order timelines are applied while this animation is being mixed out. Defaults to 0,\r\n\t\t * so draw order timelines are not applied while this animation is being mixed out. */\r\n\t\tdrawOrderThreshold: number;\r\n\r\n\t\t/** Seconds when this animation starts, both initially and after looping. Defaults to 0.\r\n\t\t *\r\n\t\t * When changing the `animationStart` time, it often makes sense to set {@link #animationLast} to the same\r\n\t\t * value to prevent timeline keys before the start time from triggering. */\r\n\t\tanimationStart: number;\r\n\r\n\t\t/** Seconds for the last frame of this animation. Non-looping animations won't play past this time. Looping animations will\r\n\t\t * loop back to {@link #animationStart} at this time. Defaults to the animation {@link Animation#duration}. */\r\n\t\tanimationEnd: number;\r\n\r\n\r\n\t\t/** The time in seconds this animation was last applied. Some timelines use this for one-time triggers. Eg, when this\r\n\t\t * animation is applied, event timelines will fire all events between the `animationLast` time (exclusive) and\r\n\t\t * `animationTime` (inclusive). Defaults to -1 to ensure triggers on frame 0 happen the first time this animation\r\n\t\t * is applied. */\r\n\t\tanimationLast: number;\r\n\r\n\t\tnextAnimationLast: number;\r\n\r\n\t\t/** Seconds to postpone playing the animation. When this track entry is the current track entry, `delay`\r\n\t\t * postpones incrementing the {@link #trackTime}. When this track entry is queued, `delay` is the time from\r\n\t\t * the start of the previous animation to when this track entry will become the current track entry (ie when the previous\r\n\t\t * track entry {@link TrackEntry#trackTime} >= this track entry's `delay`).\r\n\t\t *\r\n\t\t * {@link #timeScale} affects the delay. */\r\n\t\tdelay: number;\r\n\r\n\t\t/** Current time in seconds this track entry has been the current track entry. The track time determines\r\n\t\t * {@link #animationTime}. The track time can be set to start the animation at a time other than 0, without affecting\r\n\t\t * looping. */\r\n\t\ttrackTime: number;\r\n\r\n\t\ttrackLast: number; nextTrackLast: number;\r\n\r\n\t\t/** The track time in seconds when this animation will be removed from the track. Defaults to the highest possible float\r\n\t\t * value, meaning the animation will be applied until a new animation is set or the track is cleared. If the track end time\r\n\t\t * is reached, no other animations are queued for playback, and mixing from any previous animations is complete, then the\r\n\t\t * properties keyed by the animation are set to the setup pose and the track is cleared.\r\n\t\t *\r\n\t\t * It may be desired to use {@link AnimationState#addEmptyAnimation()} rather than have the animation\r\n\t\t * abruptly cease being applied. */\r\n\t\ttrackEnd: number;\r\n\r\n\t\t/** Multiplier for the delta time when this track entry is updated, causing time for this animation to pass slower or\r\n\t\t * faster. Defaults to 1.\r\n\t\t *\r\n\t\t * {@link #mixTime} is not affected by track entry time scale, so {@link #mixDuration} may need to be adjusted to\r\n\t\t * match the animation speed.\r\n\t\t *\r\n\t\t * When using {@link AnimationState#addAnimation()} with a `delay` <= 0, note the\r\n\t\t * {@link #delay} is set using the mix duration from the {@link AnimationStateData}, assuming time scale to be 1. If\r\n\t\t * the time scale is not 1, the delay may need to be adjusted.\r\n\t\t *\r\n\t\t * See AnimationState {@link AnimationState#timeScale} for affecting all animations. */\r\n\t\ttimeScale: number;\r\n\r\n\t\t/** Values < 1 mix this animation with the skeleton's current pose (usually the pose resulting from lower tracks). Defaults\r\n\t\t * to 1, which overwrites the skeleton's current pose with this animation.\r\n\t\t *\r\n\t\t * Typically track 0 is used to completely pose the skeleton, then alpha is used on higher tracks. It doesn't make sense to\r\n\t\t * use alpha on track 0 if the skeleton pose is from the last frame render. */\r\n\t\talpha: number;\r\n\r\n\t\t/** Seconds from 0 to the {@link #getMixDuration()} when mixing from the previous animation to this animation. May be\r\n\t\t * slightly more than `mixDuration` when the mix is complete. */\r\n\t\tmixTime: number;\r\n\r\n\t\t/** Seconds for mixing from the previous animation to this animation. Defaults to the value provided by AnimationStateData\r\n\t\t * {@link AnimationStateData#getMix()} based on the animation before this animation (if any).\r\n\t\t *\r\n\t\t * A mix duration of 0 still mixes out over one frame to provide the track entry being mixed out a chance to revert the\r\n\t\t * properties it was animating.\r\n\t\t *\r\n\t\t * The `mixDuration` can be set manually rather than use the value from\r\n\t\t * {@link AnimationStateData#getMix()}. In that case, the `mixDuration` can be set for a new\r\n\t\t * track entry only before {@link AnimationState#update(float)} is first called.\r\n\t\t *\r\n\t\t * When using {@link AnimationState#addAnimation()} with a `delay` <= 0, note the\r\n\t\t * {@link #delay} is set using the mix duration from the {@link AnimationStateData}, not a mix duration set\r\n\t\t * afterward. */\r\n\t\tmixDuration: number; interruptAlpha: number; totalAlpha: number;\r\n\r\n\t\t/** Controls how properties keyed in the animation are mixed with lower tracks. Defaults to {@link MixBlend#replace}, which\r\n\t\t * replaces the values from the lower tracks with the animation values. {@link MixBlend#add} adds the animation values to\r\n\t\t * the values from the lower tracks.\r\n\t\t *\r\n\t\t * The `mixBlend` can be set for a new track entry only before {@link AnimationState#apply()} is first\r\n\t\t * called. */\r\n\t\tmixBlend = MixBlend.replace;\r\n\t\ttimelineMode = new Array<number>();\r\n\t\ttimelineHoldMix = new Array<TrackEntry>();\r\n\t\ttimelinesRotation = new Array<number>();\r\n\r\n\t\treset () {\r\n\t\t\tthis.next = null;\r\n\t\t\tthis.mixingFrom = null;\r\n\t\t\tthis.mixingTo = null;\r\n\t\t\tthis.animation = null;\r\n\t\t\tthis.listener = null;\r\n\t\t\tthis.timelineMode.length = 0;\r\n\t\t\tthis.timelineHoldMix.length = 0;\r\n\t\t\tthis.timelinesRotation.length = 0;\r\n\t\t}\r\n\r\n\t\t/** Uses {@link #trackTime} to compute the `animationTime`, which is between {@link #animationStart}\r\n\t\t * and {@link #animationEnd}. When the `trackTime` is 0, the `animationTime` is equal to the\r\n\t\t * `animationStart` time. */\r\n\t\tgetAnimationTime () {\r\n\t\t\tif (this.loop) {\r\n\t\t\t\tlet duration = this.animationEnd - this.animationStart;\r\n\t\t\t\tif (duration == 0) return this.animationStart;\r\n\t\t\t\treturn (this.trackTime % duration) + this.animationStart;\r\n\t\t\t}\r\n\t\t\treturn Math.min(this.trackTime + this.animationStart, this.animationEnd);\r\n\t\t}\r\n\r\n\t\tsetAnimationLast(animationLast: number) {\r\n\t\t\tthis.animationLast = animationLast;\r\n\t\t\tthis.nextAnimationLast = animationLast;\r\n\t\t}\r\n\r\n\t\t/** Returns true if at least one loop has been completed.\r\n\t\t *\r\n\t\t * See {@link AnimationStateListener#complete()}. */\r\n\t\tisComplete () {\r\n\t\t\treturn this.trackTime >= this.animationEnd - this.animationStart;\r\n\t\t}\r\n\r\n\t\t/** Resets the rotation directions for mixing this entry's rotate timelines. This can be useful to avoid bones rotating the\r\n\t\t * long way around when using {@link #alpha} and starting animations on other tracks.\r\n\t\t *\r\n\t\t * Mixing with {@link MixBlend#replace} involves finding a rotation between two others, which has two possible solutions:\r\n\t\t * the short way or the long way around. The two rotations likely change over time, so which direction is the short or long\r\n\t\t * way also changes. If the short way was always chosen, bones would flip to the other side when that direction became the\r\n\t\t * long way. TrackEntry chooses the short way the first time it is applied and remembers that direction. */\r\n\t\tresetRotationDirections () {\r\n\t\t\tthis.timelinesRotation.length = 0;\r\n\t\t}\r\n\t}\r\n\r\n\texport class EventQueue {\r\n\t\tobjects: Array<any> = [];\r\n\t\tdrainDisabled = false;\r\n\t\tanimState: AnimationState;\r\n\r\n\t\tconstructor(animState: AnimationState) {\r\n\t\t\tthis.animState = animState;\r\n\t\t}\r\n\r\n\t\tstart (entry: TrackEntry) {\r\n\t\t\tthis.objects.push(EventType.start);\r\n\t\t\tthis.objects.push(entry);\r\n\t\t\tthis.animState.animationsChanged = true;\r\n\t\t}\r\n\r\n\t\tinterrupt (entry: TrackEntry) {\r\n\t\t\tthis.objects.push(EventType.interrupt);\r\n\t\t\tthis.objects.push(entry);\r\n\t\t}\r\n\r\n\t\tend (entry: TrackEntry) {\r\n\t\t\tthis.objects.push(EventType.end);\r\n\t\t\tthis.objects.push(entry);\r\n\t\t\tthis.animState.animationsChanged = true;\r\n\t\t}\r\n\r\n\t\tdispose (entry: TrackEntry) {\r\n\t\t\tthis.objects.push(EventType.dispose);\r\n\t\t\tthis.objects.push(entry);\r\n\t\t}\r\n\r\n\t\tcomplete (entry: TrackEntry) {\r\n\t\t\tthis.objects.push(EventType.complete);\r\n\t\t\tthis.objects.push(entry);\r\n\t\t}\r\n\r\n\t\tevent (entry: TrackEntry, event: Event) {\r\n\t\t\tthis.objects.push(EventType.event);\r\n\t\t\tthis.objects.push(entry);\r\n\t\t\tthis.objects.push(event);\r\n\t\t}\r\n\r\n\t\tdrain () {\r\n\t\t\tif (this.drainDisabled) return;\r\n\t\t\tthis.drainDisabled = true;\r\n\r\n\t\t\tlet objects = this.objects;\r\n\t\t\tlet listeners = this.animState.listeners;\r\n\r\n\t\t\tfor (let i = 0; i < objects.length; i += 2) {\r\n\t\t\t\tlet type = objects[i] as EventType;\r\n\t\t\t\tlet entry = objects[i + 1] as TrackEntry;\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\tcase EventType.start:\r\n\t\t\t\t\tif (entry.listener != null && entry.listener.start) entry.listener.start(entry);\r\n\t\t\t\t\tfor (let ii = 0; ii < listeners.length; ii++)\r\n\t\t\t\t\t\tif (listeners[ii].start) listeners[ii].start(entry);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase EventType.interrupt:\r\n\t\t\t\t\tif (entry.listener != null && entry.listener.interrupt) entry.listener.interrupt(entry);\r\n\t\t\t\t\tfor (let ii = 0; ii < listeners.length; ii++)\r\n\t\t\t\t\t\tif (listeners[ii].interrupt) listeners[ii].interrupt(entry);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase EventType.end:\r\n\t\t\t\t\tif (entry.listener != null && entry.listener.end) entry.listener.end(entry);\r\n\t\t\t\t\tfor (let ii = 0; ii < listeners.length; ii++)\r\n\t\t\t\t\t\tif (listeners[ii].end) listeners[ii].end(entry);\r\n\t\t\t\t\t// Fall through.\r\n\t\t\t\tcase EventType.dispose:\r\n\t\t\t\t\tif (entry.listener != null && entry.listener.dispose) entry.listener.dispose(entry);\r\n\t\t\t\t\tfor (let ii = 0; ii < listeners.length; ii++)\r\n\t\t\t\t\t\tif (listeners[ii].dispose) listeners[ii].dispose(entry);\r\n\t\t\t\t\tthis.animState.trackEntryPool.free(entry);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase EventType.complete:\r\n\t\t\t\t\tif (entry.listener != null && entry.listener.complete) entry.listener.complete(entry);\r\n\t\t\t\t\tfor (let ii = 0; ii < listeners.length; ii++)\r\n\t\t\t\t\t\tif (listeners[ii].complete) listeners[ii].complete(entry);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase EventType.event:\r\n\t\t\t\t\tlet event = objects[i++ + 2] as Event;\r\n\t\t\t\t\tif (entry.listener != null && entry.listener.event) entry.listener.event(entry, event);\r\n\t\t\t\t\tfor (let ii = 0; ii < listeners.length; ii++)\r\n\t\t\t\t\t\tif (listeners[ii].event) listeners[ii].event(entry, event);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.clear();\r\n\r\n\t\t\tthis.drainDisabled = false;\r\n\t\t}\r\n\r\n\t\tclear () {\r\n\t\t\tthis.objects.length = 0;\r\n\t\t}\r\n\t}\r\n\r\n\texport enum EventType {\r\n\t\tstart, interrupt, end, dispose, complete, event\r\n\t}\r\n\r\n\t/** The interface to implement for receiving TrackEntry events. It is always safe to call AnimationState methods when receiving\r\n\t * events.\r\n\t *\r\n\t * See TrackEntry {@link TrackEntry#listener} and AnimationState\r\n\t * {@link AnimationState#addListener()}. */\r\n\texport interface AnimationStateListener {\r\n\t\t/** Invoked when this entry has been set as the current entry. */\r\n\t\tstart (entry: TrackEntry): void;\r\n\r\n\t\t/** Invoked when another entry has replaced this entry as the current entry. This entry may continue being applied for\r\n\t\t * mixing. */\r\n\t\tinterrupt (entry: TrackEntry): void;\r\n\r\n\t\t/** Invoked when this entry is no longer the current entry and will never be applied again. */\r\n\t\tend (entry: TrackEntry): void;\r\n\r\n\t\t/** Invoked when this entry will be disposed. This may occur without the entry ever being set as the current entry.\r\n\t\t * References to the entry should not be kept after dispose is called, as it may be destroyed or reused. */\r\n\t\tdispose (entry: TrackEntry): void;\r\n\r\n\t\t/** Invoked every time this entry's animation completes a loop. */\r\n\t\tcomplete (entry: TrackEntry): void;\r\n\r\n\t\t/** Invoked when this entry's animation triggers an event. */\r\n\t\tevent (entry: TrackEntry, event: Event): void;\r\n\t}\r\n\r\n\texport abstract class AnimationStateAdapter implements AnimationStateListener {\r\n\t\tstart (entry: TrackEntry) {\r\n\t\t}\r\n\r\n\t\tinterrupt (entry: TrackEntry) {\r\n\t\t}\r\n\r\n\t\tend (entry: TrackEntry) {\r\n\t\t}\r\n\r\n\t\tdispose (entry: TrackEntry) {\r\n\t\t}\r\n\r\n\t\tcomplete (entry: TrackEntry) {\r\n\t\t}\r\n\r\n\t\tevent (entry: TrackEntry, event: Event) {\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { GLTexture } from \"./GLTexture\";\r\nimport { Mesh, Position2Attribute, ColorAttribute, TexCoordAttribute, Color2Attribute } from \"./Mesh\";\r\nimport { Shader } from \"./Shader\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\nimport { Disposable } from \"../core/Utils\";\r\n\r\n// module spine.webgl {\r\n\texport class PolygonBatcher implements Disposable {\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate drawCalls: number;\r\n\t\tprivate isDrawing = false;\r\n\t\tprivate mesh: Mesh;\r\n\t\tprivate shader: Shader = null;\r\n\t\tprivate lastTexture: GLTexture = null;\r\n\t\tprivate verticesLength = 0;\r\n\t\tprivate indicesLength = 0;\r\n\t\tprivate srcBlend: number;\r\n\t\tprivate dstBlend: number;\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext | WebGLRenderingContext, twoColorTint: boolean = true, maxVertices: number = 10920) {\r\n\t\t\tif (maxVertices > 10920) throw new Error(\"Can't have more than 10920 triangles per batch: \" + maxVertices);\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t\tlet attributes = twoColorTint ?\r\n\t\t\t\t\t[new Position2Attribute(), new ColorAttribute(), new TexCoordAttribute(), new Color2Attribute()] :\r\n\t\t\t\t\t[new Position2Attribute(), new ColorAttribute(), new TexCoordAttribute()];\r\n\t\t\tthis.mesh = new Mesh(context, attributes, maxVertices, maxVertices * 3);\r\n\t\t\tthis.srcBlend = this.context.gl.SRC_ALPHA;\r\n\t\t\tthis.dstBlend = this.context.gl.ONE_MINUS_SRC_ALPHA;\r\n\t\t}\r\n\r\n\t\tbegin (shader: Shader) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (this.isDrawing) throw new Error(\"PolygonBatch is already drawing. Call PolygonBatch.end() before calling PolygonBatch.begin()\");\r\n\t\t\tthis.drawCalls = 0;\r\n\t\t\tthis.shader = shader;\r\n\t\t\tthis.lastTexture = null;\r\n\t\t\tthis.isDrawing = true;\r\n\r\n\t\t\tgl.enable(gl.BLEND);\r\n\t\t\tgl.blendFunc(this.srcBlend, this.dstBlend);\r\n\t\t}\r\n\r\n\t\tsetBlendMode (srcBlend: number, dstBlend: number) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.srcBlend = srcBlend;\r\n\t\t\tthis.dstBlend = dstBlend;\r\n\t\t\tif (this.isDrawing) {\r\n\t\t\t\tthis.flush();\r\n\t\t\t\tgl.blendFunc(this.srcBlend, this.dstBlend);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdraw (texture: GLTexture, vertices: ArrayLike<number>, indices: Array<number>) {\r\n\t\t\tif (texture != this.lastTexture) {\r\n\t\t\t\tthis.flush();\r\n\t\t\t\tthis.lastTexture = texture;\r\n\t\t\t} else if (this.verticesLength + vertices.length > this.mesh.getVertices().length ||\r\n\t\t\t\t\tthis.indicesLength + indices.length > this.mesh.getIndices().length) {\r\n\t\t\t\tthis.flush();\r\n\t\t\t}\r\n\r\n\t\t\tlet indexStart = this.mesh.numVertices();\r\n\t\t\tthis.mesh.getVertices().set(vertices, this.verticesLength);\r\n\t\t\tthis.verticesLength += vertices.length;\r\n\t\t\tthis.mesh.setVerticesLength(this.verticesLength)\r\n\r\n\t\t\tlet indicesArray = this.mesh.getIndices();\r\n\t\t\tfor (let i = this.indicesLength, j = 0; j < indices.length; i++, j++)\r\n\t\t\t\tindicesArray[i] = indices[j] + indexStart;\r\n\t\t\tthis.indicesLength += indices.length;\r\n\t\t\tthis.mesh.setIndicesLength(this.indicesLength);\r\n\t\t}\r\n\r\n\t\tprivate flush () {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (this.verticesLength == 0) return;\r\n\r\n\t\t\tthis.lastTexture.bind();\r\n\t\t\tthis.mesh.draw(this.shader, gl.TRIANGLES);\r\n\r\n\t\t\tthis.verticesLength = 0;\r\n\t\t\tthis.indicesLength = 0;\r\n\t\t\tthis.mesh.setVerticesLength(0);\r\n\t\t\tthis.mesh.setIndicesLength(0);\r\n\t\t\tthis.drawCalls++;\r\n\t\t}\r\n\r\n\t\tend () {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (!this.isDrawing) throw new Error(\"PolygonBatch is not drawing. Call PolygonBatch.begin() before calling PolygonBatch.end()\");\r\n\t\t\tif (this.verticesLength > 0 || this.indicesLength > 0) this.flush();\r\n\t\t\tthis.shader = null;\r\n\t\t\tthis.lastTexture = null;\r\n\t\t\tthis.isDrawing = false;\r\n\r\n\t\t\tgl.disable(gl.BLEND);\r\n\t\t}\r\n\r\n\t\tgetDrawCalls () { return this.drawCalls; }\r\n\r\n\t\tdispose () {\r\n\t\t\tthis.mesh.dispose();\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BoundingBoxAttachment } from \"./attachments/BoundingBoxAttachment\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Pool, Utils } from \"./Utils\";\r\n\r\n// module spine {\r\n\t/** Collects each visible {@link BoundingBoxAttachment} and computes the world vertices for its polygon. The polygon vertices are\r\n\t * provided along with convenience methods for doing hit detection. */\r\n\texport class SkeletonBounds {\r\n\r\n\t\t/** The left edge of the axis aligned bounding box. */\r\n\t\tminX = 0;\r\n\r\n\t\t/** The bottom edge of the axis aligned bounding box. */\r\n\t\tminY = 0;\r\n\r\n\t\t/** The right edge of the axis aligned bounding box. */\r\n\t\tmaxX = 0;\r\n\r\n\t\t/** The top edge of the axis aligned bounding box. */\r\n\t\tmaxY = 0;\r\n\r\n\t\t/** The visible bounding boxes. */\r\n\t\tboundingBoxes = new Array<BoundingBoxAttachment>();\r\n\r\n\t\t/** The world vertices for the bounding box polygons. */\r\n\t\tpolygons = new Array<ArrayLike<number>>();\r\n\r\n\t\tprivate polygonPool = new Pool<ArrayLike<number>>(() => {\r\n\t\t\treturn Utils.newFloatArray(16);\r\n\t\t});\r\n\r\n\t\t/** Clears any previous polygons, finds all visible bounding box attachments, and computes the world vertices for each bounding\r\n\t\t * box's polygon.\r\n\t\t * @param updateAabb If true, the axis aligned bounding box containing all the polygons is computed. If false, the\r\n\t\t *           SkeletonBounds AABB methods will always return true. */\r\n\t\tupdate (skeleton: Skeleton, updateAabb: boolean) {\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\t\t\tlet boundingBoxes = this.boundingBoxes;\r\n\t\t\tlet polygons = this.polygons;\r\n\t\t\tlet polygonPool = this.polygonPool;\r\n\t\t\tlet slots = skeleton.slots;\r\n\t\t\tlet slotCount = slots.length;\r\n\r\n\t\t\tboundingBoxes.length = 0;\r\n\t\t\tpolygonPool.freeAll(polygons);\r\n\t\t\tpolygons.length = 0;\r\n\r\n\t\t\tfor (let i = 0; i < slotCount; i++) {\r\n\t\t\t\tlet slot = slots[i];\r\n\t\t\t\tif (!slot.bone.active) continue;\r\n\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\tif (attachment instanceof BoundingBoxAttachment) {\r\n\t\t\t\t\tlet boundingBox = attachment as BoundingBoxAttachment;\r\n\t\t\t\t\tboundingBoxes.push(boundingBox);\r\n\r\n\t\t\t\t\tlet polygon = polygonPool.obtain();\r\n\t\t\t\t\tif (polygon.length != boundingBox.worldVerticesLength) {\r\n\t\t\t\t\t\tpolygon = Utils.newFloatArray(boundingBox.worldVerticesLength);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpolygons.push(polygon);\r\n\t\t\t\t\tboundingBox.computeWorldVertices(slot, 0, boundingBox.worldVerticesLength, polygon, 0, 2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (updateAabb) {\r\n\t\t\t\tthis.aabbCompute();\r\n\t\t\t} else {\r\n\t\t\t\tthis.minX = Number.POSITIVE_INFINITY;\r\n\t\t\t\tthis.minY = Number.POSITIVE_INFINITY;\r\n\t\t\t\tthis.maxX = Number.NEGATIVE_INFINITY;\r\n\t\t\t\tthis.maxY = Number.NEGATIVE_INFINITY;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\taabbCompute () {\r\n\t\t\tlet minX = Number.POSITIVE_INFINITY, minY = Number.POSITIVE_INFINITY, maxX = Number.NEGATIVE_INFINITY, maxY = Number.NEGATIVE_INFINITY;\r\n\t\t\tlet polygons = this.polygons;\r\n\t\t\tfor (let i = 0, n = polygons.length; i < n; i++) {\r\n\t\t\t\tlet polygon = polygons[i];\r\n\t\t\t\tlet vertices = polygon;\r\n\t\t\t\tfor (let ii = 0, nn = polygon.length; ii < nn; ii += 2) {\r\n\t\t\t\t\tlet x = vertices[ii];\r\n\t\t\t\t\tlet y = vertices[ii + 1];\r\n\t\t\t\t\tminX = Math.min(minX, x);\r\n\t\t\t\t\tminY = Math.min(minY, y);\r\n\t\t\t\t\tmaxX = Math.max(maxX, x);\r\n\t\t\t\t\tmaxY = Math.max(maxY, y);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.minX = minX;\r\n\t\t\tthis.minY = minY;\r\n\t\t\tthis.maxX = maxX;\r\n\t\t\tthis.maxY = maxY;\r\n\t\t}\r\n\r\n\t\t/** Returns true if the axis aligned bounding box contains the point. */\r\n\t\taabbContainsPoint (x: number, y: number) {\r\n\t\t\treturn x >= this.minX && x <= this.maxX && y >= this.minY && y <= this.maxY;\r\n\t\t}\r\n\r\n\t\t/** Returns true if the axis aligned bounding box intersects the line segment. */\r\n\t\taabbIntersectsSegment (x1: number, y1: number, x2: number, y2: number) {\r\n\t\t\tlet minX = this.minX;\r\n\t\t\tlet minY = this.minY;\r\n\t\t\tlet maxX = this.maxX;\r\n\t\t\tlet maxY = this.maxY;\r\n\t\t\tif ((x1 <= minX && x2 <= minX) || (y1 <= minY && y2 <= minY) || (x1 >= maxX && x2 >= maxX) || (y1 >= maxY && y2 >= maxY))\r\n\t\t\t\treturn false;\r\n\t\t\tlet m = (y2 - y1) / (x2 - x1);\r\n\t\t\tlet y = m * (minX - x1) + y1;\r\n\t\t\tif (y > minY && y < maxY) return true;\r\n\t\t\ty = m * (maxX - x1) + y1;\r\n\t\t\tif (y > minY && y < maxY) return true;\r\n\t\t\tlet x = (minY - y1) / m + x1;\r\n\t\t\tif (x > minX && x < maxX) return true;\r\n\t\t\tx = (maxY - y1) / m + x1;\r\n\t\t\tif (x > minX && x < maxX) return true;\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t/** Returns true if the axis aligned bounding box intersects the axis aligned bounding box of the specified bounds. */\r\n\t\taabbIntersectsSkeleton (bounds: SkeletonBounds) {\r\n\t\t\treturn this.minX < bounds.maxX && this.maxX > bounds.minX && this.minY < bounds.maxY && this.maxY > bounds.minY;\r\n\t\t}\r\n\r\n\t\t/** Returns the first bounding box attachment that contains the point, or null. When doing many checks, it is usually more\r\n\t\t * efficient to only call this method if {@link #aabbContainsPoint(float, float)} returns true. */\r\n\t\tcontainsPoint (x: number, y: number): BoundingBoxAttachment {\r\n\t\t\tlet polygons = this.polygons;\r\n\t\t\tfor (let i = 0, n = polygons.length; i < n; i++)\r\n\t\t\t\tif (this.containsPointPolygon(polygons[i], x, y)) return this.boundingBoxes[i];\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Returns true if the polygon contains the point. */\r\n\t\tcontainsPointPolygon (polygon: ArrayLike<number>, x: number, y: number) {\r\n\t\t\tlet vertices = polygon;\r\n\t\t\tlet nn = polygon.length;\r\n\r\n\t\t\tlet prevIndex = nn - 2;\r\n\t\t\tlet inside = false;\r\n\t\t\tfor (let ii = 0; ii < nn; ii += 2) {\r\n\t\t\t\tlet vertexY = vertices[ii + 1];\r\n\t\t\t\tlet prevY = vertices[prevIndex + 1];\r\n\t\t\t\tif ((vertexY < y && prevY >= y) || (prevY < y && vertexY >= y)) {\r\n\t\t\t\t\tlet vertexX = vertices[ii];\r\n\t\t\t\t\tif (vertexX + (y - vertexY) / (prevY - vertexY) * (vertices[prevIndex] - vertexX) < x) inside = !inside;\r\n\t\t\t\t}\r\n\t\t\t\tprevIndex = ii;\r\n\t\t\t}\r\n\t\t\treturn inside;\r\n\t\t}\r\n\r\n\t\t/** Returns the first bounding box attachment that contains any part of the line segment, or null. When doing many checks, it\r\n\t\t * is usually more efficient to only call this method if {@link #aabbIntersectsSegment()} returns\r\n\t\t * true. */\r\n\t\tintersectsSegment (x1: number, y1: number, x2: number, y2: number) {\r\n\t\t\tlet polygons = this.polygons;\r\n\t\t\tfor (let i = 0, n = polygons.length; i < n; i++)\r\n\t\t\t\tif (this.intersectsSegmentPolygon(polygons[i], x1, y1, x2, y2)) return this.boundingBoxes[i];\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Returns true if the polygon contains any part of the line segment. */\r\n\t\tintersectsSegmentPolygon (polygon: ArrayLike<number>, x1: number, y1: number, x2: number, y2: number) {\r\n\t\t\tlet vertices = polygon;\r\n\t\t\tlet nn = polygon.length;\r\n\r\n\t\t\tlet width12 = x1 - x2, height12 = y1 - y2;\r\n\t\t\tlet det1 = x1 * y2 - y1 * x2;\r\n\t\t\tlet x3 = vertices[nn - 2], y3 = vertices[nn - 1];\r\n\t\t\tfor (let ii = 0; ii < nn; ii += 2) {\r\n\t\t\t\tlet x4 = vertices[ii], y4 = vertices[ii + 1];\r\n\t\t\t\tlet det2 = x3 * y4 - y3 * x4;\r\n\t\t\t\tlet width34 = x3 - x4, height34 = y3 - y4;\r\n\t\t\t\tlet det3 = width12 * height34 - height12 * width34;\r\n\t\t\t\tlet x = (det1 * width34 - width12 * det2) / det3;\r\n\t\t\t\tif (((x >= x3 && x <= x4) || (x >= x4 && x <= x3)) && ((x >= x1 && x <= x2) || (x >= x2 && x <= x1))) {\r\n\t\t\t\t\tlet y = (det1 * height34 - height12 * det2) / det3;\r\n\t\t\t\t\tif (((y >= y3 && y <= y4) || (y >= y4 && y <= y3)) && ((y >= y1 && y <= y2) || (y >= y2 && y <= y1))) return true;\r\n\t\t\t\t}\r\n\t\t\t\tx3 = x4;\r\n\t\t\t\ty3 = y4;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t/** Returns the polygon for the specified bounding box, or null. */\r\n\t\tgetPolygon (boundingBox: BoundingBoxAttachment) {\r\n\t\t\tif (boundingBox == null) throw new Error(\"boundingBox cannot be null.\");\r\n\t\t\tlet index = this.boundingBoxes.indexOf(boundingBox);\r\n\t\t\treturn index == -1 ? null : this.polygons[index];\r\n\t\t}\r\n\r\n\t\t/** The width of the axis aligned bounding box. */\r\n\t\tgetWidth () {\r\n\t\t\treturn this.maxX - this.minX;\r\n\t\t}\r\n\r\n\t\t/** The height of the axis aligned bounding box. */\r\n\t\tgetHeight () {\r\n\t\t\treturn this.maxY - this.minY;\r\n\t\t}\r\n\t}\r\n\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { ClippingAttachment } from \"../core/attachments/ClippingAttachment\";\r\nimport { MeshAttachment } from \"../core/attachments/MeshAttachment\";\r\nimport { PathAttachment } from \"../core/attachments/PathAttachment\";\r\nimport { RegionAttachment } from \"../core/attachments/RegionAttachment\";\r\nimport { Skeleton } from \"../core/Skeleton\";\r\nimport { SkeletonBounds } from \"../core/SkeletonBounds\";\r\nimport { Color, Utils, Disposable } from \"../core/Utils\";\r\nimport { ShapeRenderer } from \"./ShapeRenderer\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\texport class SkeletonDebugRenderer implements Disposable {\r\n\t\tboneLineColor = new Color(1, 0, 0, 1);\r\n\t\tboneOriginColor = new Color(0, 1, 0, 1);\r\n\t\tattachmentLineColor = new Color(0, 0, 1, 0.5);\r\n\t\ttriangleLineColor = new Color(1, 0.64, 0, 0.5);\r\n\t\tpathColor = new Color().setFromString(\"FF7F00\");\r\n\t\tclipColor = new Color(0.8, 0, 0, 2);\r\n\t\taabbColor = new Color(0, 1, 0, 0.5);\r\n\t\tdrawBones = true;\r\n\t\tdrawRegionAttachments = true;\r\n\t\tdrawBoundingBoxes = true;\r\n\t\tdrawMeshHull = true;\r\n\t\tdrawMeshTriangles = true;\r\n\t\tdrawPaths = true;\r\n\t\tdrawSkeletonXY = false;\r\n\t\tdrawClipping = true;\r\n\t\tpremultipliedAlpha = false;\r\n\t\tscale = 1;\r\n\t\tboneWidth = 2;\r\n\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate bounds = new SkeletonBounds();\r\n\t\tprivate temp = new Array<number>();\r\n\t\tprivate vertices = Utils.newFloatArray(2 * 1024);\r\n\t\tprivate static LIGHT_GRAY = new Color(192 / 255, 192 / 255, 192 / 255, 1);\r\n\t\tprivate static GREEN = new Color(0, 1, 0, 1);\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext | WebGLRenderingContext) {\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t}\r\n\r\n\t\tdraw (shapes: ShapeRenderer, skeleton: Skeleton, ignoredBones: Array<string> = null) {\r\n\t\t\tlet skeletonX = skeleton.x;\r\n\t\t\tlet skeletonY = skeleton.y;\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tlet srcFunc = this.premultipliedAlpha ? gl.ONE : gl.SRC_ALPHA;\r\n\t\t\tshapes.setBlendMode(srcFunc, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n\t\t\tlet bones = skeleton.bones;\r\n\t\t\tif (this.drawBones) {\r\n\t\t\t\tshapes.setColor(this.boneLineColor);\r\n\t\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\t\tlet bone = bones[i];\r\n\t\t\t\t\tif (ignoredBones && ignoredBones.indexOf(bone.data.name) > -1) continue;\r\n\t\t\t\t\tif (bone.parent == null) continue;\r\n\t\t\t\t\tlet x = skeletonX + bone.data.length * bone.a + bone.worldX;\r\n\t\t\t\t\tlet y = skeletonY + bone.data.length * bone.c + bone.worldY;\r\n\t\t\t\t\tshapes.rectLine(true, skeletonX + bone.worldX, skeletonY + bone.worldY, x, y, this.boneWidth * this.scale);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.drawSkeletonXY) shapes.x(skeletonX, skeletonY, 4 * this.scale);\r\n\t\t\t}\r\n\r\n\t\t\tif (this.drawRegionAttachments) {\r\n\t\t\t\tshapes.setColor(this.attachmentLineColor);\r\n\t\t\t\tlet slots = skeleton.slots;\r\n\t\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\t\tlet slot = slots[i];\r\n\t\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\t\tif (attachment instanceof RegionAttachment) {\r\n\t\t\t\t\t\tlet regionAttachment = <RegionAttachment>attachment;\r\n\t\t\t\t\t\tlet vertices = this.vertices;\r\n\t\t\t\t\t\tregionAttachment.computeWorldVertices(slot.bone, vertices, 0, 2);\r\n\t\t\t\t\t\tshapes.line(vertices[0], vertices[1], vertices[2], vertices[3]);\r\n\t\t\t\t\t\tshapes.line(vertices[2], vertices[3], vertices[4], vertices[5]);\r\n\t\t\t\t\t\tshapes.line(vertices[4], vertices[5], vertices[6], vertices[7]);\r\n\t\t\t\t\t\tshapes.line(vertices[6], vertices[7], vertices[0], vertices[1]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.drawMeshHull || this.drawMeshTriangles) {\r\n\t\t\t\tlet slots = skeleton.slots;\r\n\t\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\t\tlet slot = slots[i];\r\n\t\t\t\t\tif (!slot.bone.active) continue;\r\n\t\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\t\tif (!(attachment instanceof MeshAttachment)) continue;\r\n\t\t\t\t\tlet mesh = <MeshAttachment>attachment;\r\n\t\t\t\t\tlet vertices = this.vertices;\r\n\t\t\t\t\tmesh.computeWorldVertices(slot, 0, mesh.worldVerticesLength, vertices, 0, 2);\r\n\t\t\t\t\tlet triangles = mesh.triangles;\r\n\t\t\t\t\tlet hullLength = mesh.hullLength;\r\n\t\t\t\t\tif (this.drawMeshTriangles) {\r\n\t\t\t\t\t\tshapes.setColor(this.triangleLineColor);\r\n\t\t\t\t\t\tfor (let ii = 0, nn = triangles.length; ii < nn; ii += 3) {\r\n\t\t\t\t\t\t\tlet v1 = triangles[ii] * 2, v2 = triangles[ii + 1] * 2, v3 = triangles[ii + 2] * 2;\r\n\t\t\t\t\t\t\tshapes.triangle(false, vertices[v1], vertices[v1 + 1], //\r\n\t\t\t\t\t\t\t\tvertices[v2], vertices[v2 + 1], //\r\n\t\t\t\t\t\t\t\tvertices[v3], vertices[v3 + 1] //\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.drawMeshHull && hullLength > 0) {\r\n\t\t\t\t\t\tshapes.setColor(this.attachmentLineColor);\r\n\t\t\t\t\t\thullLength = (hullLength >> 1) * 2;\r\n\t\t\t\t\t\tlet lastX = vertices[hullLength - 2], lastY = vertices[hullLength - 1];\r\n\t\t\t\t\t\tfor (let ii = 0, nn = hullLength; ii < nn; ii += 2) {\r\n\t\t\t\t\t\t\tlet x = vertices[ii], y = vertices[ii + 1];\r\n\t\t\t\t\t\t\tshapes.line(x, y, lastX, lastY);\r\n\t\t\t\t\t\t\tlastX = x;\r\n\t\t\t\t\t\t\tlastY = y;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.drawBoundingBoxes) {\r\n\t\t\t\tlet bounds = this.bounds;\r\n\t\t\t\tbounds.update(skeleton, true);\r\n\t\t\t\tshapes.setColor(this.aabbColor);\r\n\t\t\t\tshapes.rect(false, bounds.minX, bounds.minY, bounds.getWidth(), bounds.getHeight());\r\n\t\t\t\tlet polygons = bounds.polygons;\r\n\t\t\t\tlet boxes = bounds.boundingBoxes;\r\n\t\t\t\tfor (let i = 0, n = polygons.length; i < n; i++) {\r\n\t\t\t\t\tlet polygon = polygons[i];\r\n\t\t\t\t\tshapes.setColor(boxes[i].color);\r\n\t\t\t\t\tshapes.polygon(polygon, 0, polygon.length);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.drawPaths) {\r\n\t\t\t\tlet slots = skeleton.slots;\r\n\t\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\t\tlet slot = slots[i];\r\n\t\t\t\t\tif (!slot.bone.active) continue;\r\n\t\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\t\tif (!(attachment instanceof PathAttachment)) continue;\r\n\t\t\t\t\tlet path = <PathAttachment>attachment;\r\n\t\t\t\t\tlet nn = path.worldVerticesLength;\r\n\t\t\t\t\tlet world = this.temp = Utils.setArraySize(this.temp, nn, 0);\r\n\t\t\t\t\tpath.computeWorldVertices(slot, 0, nn, world, 0, 2);\r\n\t\t\t\t\tlet color = this.pathColor;\r\n\t\t\t\t\tlet x1 = world[2], y1 = world[3], x2 = 0, y2 = 0;\r\n\t\t\t\t\tif (path.closed) {\r\n\t\t\t\t\t\tshapes.setColor(color);\r\n\t\t\t\t\t\tlet cx1 = world[0], cy1 = world[1], cx2 = world[nn - 2], cy2 = world[nn - 1];\r\n\t\t\t\t\t\tx2 = world[nn - 4];\r\n\t\t\t\t\t\ty2 = world[nn - 3];\r\n\t\t\t\t\t\tshapes.curve(x1, y1, cx1, cy1, cx2, cy2, x2, y2, 32);\r\n\t\t\t\t\t\tshapes.setColor(SkeletonDebugRenderer.LIGHT_GRAY);\r\n\t\t\t\t\t\tshapes.line(x1, y1, cx1, cy1);\r\n\t\t\t\t\t\tshapes.line(x2, y2, cx2, cy2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnn -= 4;\r\n\t\t\t\t\tfor (let ii = 4; ii < nn; ii += 6) {\r\n\t\t\t\t\t\tlet cx1 = world[ii], cy1 = world[ii + 1], cx2 = world[ii + 2], cy2 = world[ii + 3];\r\n\t\t\t\t\t\tx2 = world[ii + 4];\r\n\t\t\t\t\t\ty2 = world[ii + 5];\r\n\t\t\t\t\t\tshapes.setColor(color);\r\n\t\t\t\t\t\tshapes.curve(x1, y1, cx1, cy1, cx2, cy2, x2, y2, 32);\r\n\t\t\t\t\t\tshapes.setColor(SkeletonDebugRenderer.LIGHT_GRAY);\r\n\t\t\t\t\t\tshapes.line(x1, y1, cx1, cy1);\r\n\t\t\t\t\t\tshapes.line(x2, y2, cx2, cy2);\r\n\t\t\t\t\t\tx1 = x2;\r\n\t\t\t\t\t\ty1 = y2;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.drawBones) {\r\n\t\t\t\tshapes.setColor(this.boneOriginColor);\r\n\t\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\t\tlet bone = bones[i];\r\n\t\t\t\t\tif (ignoredBones && ignoredBones.indexOf(bone.data.name) > -1) continue;\r\n\t\t\t\t\tshapes.circle(true, skeletonX + bone.worldX, skeletonY + bone.worldY, 3 * this.scale, SkeletonDebugRenderer.GREEN, 8);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.drawClipping) {\r\n\t\t\t\tlet slots = skeleton.slots;\r\n\t\t\t\tshapes.setColor(this.clipColor)\r\n\t\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\t\tlet slot = slots[i];\r\n\t\t\t\t\tif (!slot.bone.active) continue;\r\n\t\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\t\tif (!(attachment instanceof ClippingAttachment)) continue;\r\n\t\t\t\t\tlet clip = <ClippingAttachment>attachment;\r\n\t\t\t\t\tlet nn = clip.worldVerticesLength;\r\n\t\t\t\t\tlet world = this.temp = Utils.setArraySize(this.temp, nn, 0);\r\n\t\t\t\t\tclip.computeWorldVertices(slot, 0, nn, world, 0, 2);\r\n\t\t\t\t\tfor (let i = 0, n = world.length; i < n; i+=2) {\r\n\t\t\t\t\t\tlet x = world[i];\r\n\t\t\t\t\t\tlet y = world[i + 1];\r\n\t\t\t\t\t\tlet x2 = world[(i + 2) % world.length];\r\n\t\t\t\t\t\tlet y2 = world[(i + 3) % world.length];\r\n\t\t\t\t\t\tshapes.line(x, y, x2, y2);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Pool } from \"./Utils\";\r\n\r\n// module spine {\r\n\texport class Triangulator {\r\n\t\tprivate convexPolygons = new Array<Array<number>>();\r\n\t\tprivate convexPolygonsIndices = new Array<Array<number>>();\r\n\r\n\t\tprivate indicesArray = new Array<number>();\r\n\t\tprivate isConcaveArray = new Array<boolean>();\r\n\t\tprivate triangles = new Array<number>();\r\n\r\n\t\tprivate polygonPool = new Pool<Array<number>>(() => {\r\n\t\t\treturn new Array<number>();\r\n\t\t});\r\n\r\n\t\tprivate polygonIndicesPool = new Pool<Array<number>>(() => {\r\n\t\t\treturn new Array<number>();\r\n\t\t});\r\n\r\n\t\tpublic triangulate (verticesArray: ArrayLike<number>): Array<number> {\r\n\t\t\tlet vertices = verticesArray;\r\n\t\t\tlet vertexCount = verticesArray.length >> 1;\r\n\r\n\t\t\tlet indices = this.indicesArray;\r\n\t\t\tindices.length = 0;\r\n\t\t\tfor (let i = 0; i < vertexCount; i++)\r\n\t\t\t\tindices[i] = i;\r\n\r\n\t\t\tlet isConcave = this.isConcaveArray;\r\n\t\t\tisConcave.length = 0;\r\n\t\t\tfor (let i = 0, n = vertexCount; i < n; ++i)\r\n\t\t\t\tisConcave[i] = Triangulator.isConcave(i, vertexCount, vertices, indices);\r\n\r\n\t\t\tlet triangles = this.triangles;\r\n\t\t\ttriangles.length = 0;\r\n\r\n\t\t\twhile (vertexCount > 3) {\r\n\t\t\t\t// Find ear tip.\r\n\t\t\t\tlet previous = vertexCount - 1, i = 0, next = 1;\r\n\t\t\t\twhile (true) {\r\n\t\t\t\t\touter:\r\n\t\t\t\t\tif (!isConcave[i]) {\r\n\t\t\t\t\t\tlet p1 = indices[previous] << 1, p2 = indices[i] << 1, p3 = indices[next] << 1;\r\n\t\t\t\t\t\tlet p1x = vertices[p1], p1y = vertices[p1 + 1];\r\n\t\t\t\t\t\tlet p2x = vertices[p2], p2y = vertices[p2 + 1];\r\n\t\t\t\t\t\tlet p3x = vertices[p3], p3y = vertices[p3 + 1];\r\n\t\t\t\t\t\tfor (let ii = (next + 1) % vertexCount; ii != previous; ii = (ii + 1) % vertexCount) {\r\n\t\t\t\t\t\t\tif (!isConcave[ii]) continue;\r\n\t\t\t\t\t\t\tlet v = indices[ii] << 1;\r\n\t\t\t\t\t\t\tlet vx = vertices[v], vy = vertices[v + 1];\r\n\t\t\t\t\t\t\tif (Triangulator.positiveArea(p3x, p3y, p1x, p1y, vx, vy)) {\r\n\t\t\t\t\t\t\t\tif (Triangulator.positiveArea(p1x, p1y, p2x, p2y, vx, vy)) {\r\n\t\t\t\t\t\t\t\t\tif (Triangulator.positiveArea(p2x, p2y, p3x, p3y, vx, vy)) break outer;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (next == 0) {\r\n\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\tif (!isConcave[i]) break;\r\n\t\t\t\t\t\t\ti--;\r\n\t\t\t\t\t\t} while (i > 0);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tprevious = i;\r\n\t\t\t\t\ti = next;\r\n\t\t\t\t\tnext = (next + 1) % vertexCount;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Cut ear tip.\r\n\t\t\t\ttriangles.push(indices[(vertexCount + i - 1) % vertexCount]);\r\n\t\t\t\ttriangles.push(indices[i]);\r\n\t\t\t\ttriangles.push(indices[(i + 1) % vertexCount]);\r\n\t\t\t\tindices.splice(i, 1);\r\n\t\t\t\tisConcave.splice(i, 1);\r\n\t\t\t\tvertexCount--;\r\n\r\n\t\t\t\tlet previousIndex = (vertexCount + i - 1) % vertexCount;\r\n\t\t\t\tlet nextIndex = i == vertexCount ? 0 : i;\r\n\t\t\t\tisConcave[previousIndex] = Triangulator.isConcave(previousIndex, vertexCount, vertices, indices);\r\n\t\t\t\tisConcave[nextIndex] = Triangulator.isConcave(nextIndex, vertexCount, vertices, indices);\r\n\t\t\t}\r\n\r\n\t\t\tif (vertexCount == 3) {\r\n\t\t\t\ttriangles.push(indices[2]);\r\n\t\t\t\ttriangles.push(indices[0]);\r\n\t\t\t\ttriangles.push(indices[1]);\r\n\t\t\t}\r\n\r\n\t\t\treturn triangles;\r\n\t\t}\r\n\r\n\t\tdecompose (verticesArray: Array<number>, triangles: Array<number>) : Array<Array<number>> {\r\n\t\t\tlet vertices = verticesArray;\r\n\t\t\tlet convexPolygons = this.convexPolygons;\r\n\t\t\tthis.polygonPool.freeAll(convexPolygons);\r\n\t\t\tconvexPolygons.length = 0;\r\n\r\n\t\t\tlet convexPolygonsIndices = this.convexPolygonsIndices;\r\n\t\t\tthis.polygonIndicesPool.freeAll(convexPolygonsIndices);\r\n\t\t\tconvexPolygonsIndices.length = 0;\r\n\r\n\t\t\tlet polygonIndices = this.polygonIndicesPool.obtain();\r\n\t\t\tpolygonIndices.length = 0;\r\n\r\n\t\t\tlet polygon = this.polygonPool.obtain();\r\n\t\t\tpolygon.length = 0;\r\n\r\n\t\t\t// Merge subsequent triangles if they form a triangle fan.\r\n\t\t\tlet fanBaseIndex = -1, lastWinding = 0;\r\n\t\t\tfor (let i = 0, n = triangles.length; i < n; i += 3) {\r\n\t\t\t\tlet t1 = triangles[i] << 1, t2 = triangles[i + 1] << 1, t3 = triangles[i + 2] << 1;\r\n\t\t\t\tlet x1 = vertices[t1], y1 = vertices[t1 + 1];\r\n\t\t\t\tlet x2 = vertices[t2], y2 = vertices[t2 + 1];\r\n\t\t\t\tlet x3 = vertices[t3], y3 = vertices[t3 + 1];\r\n\r\n\t\t\t\t// If the base of the last triangle is the same as this triangle, check if they form a convex polygon (triangle fan).\r\n\t\t\t\tlet merged = false;\r\n\t\t\t\tif (fanBaseIndex == t1) {\r\n\t\t\t\t\tlet o = polygon.length - 4;\r\n\t\t\t\t\tlet winding1 = Triangulator.winding(polygon[o], polygon[o + 1], polygon[o + 2], polygon[o + 3], x3, y3);\r\n\t\t\t\t\tlet winding2 = Triangulator.winding(x3, y3, polygon[0], polygon[1], polygon[2], polygon[3]);\r\n\t\t\t\t\tif (winding1 == lastWinding && winding2 == lastWinding) {\r\n\t\t\t\t\t\tpolygon.push(x3);\r\n\t\t\t\t\t\tpolygon.push(y3);\r\n\t\t\t\t\t\tpolygonIndices.push(t3);\r\n\t\t\t\t\t\tmerged = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Otherwise make this triangle the new base.\r\n\t\t\t\tif (!merged) {\r\n\t\t\t\t\tif (polygon.length > 0) {\r\n\t\t\t\t\t\tconvexPolygons.push(polygon);\r\n\t\t\t\t\t\tconvexPolygonsIndices.push(polygonIndices);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.polygonPool.free(polygon)\r\n\t\t\t\t\t\tthis.polygonIndicesPool.free(polygonIndices);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpolygon = this.polygonPool.obtain();\r\n\t\t\t\t\tpolygon.length = 0;\r\n\t\t\t\t\tpolygon.push(x1);\r\n\t\t\t\t\tpolygon.push(y1);\r\n\t\t\t\t\tpolygon.push(x2);\r\n\t\t\t\t\tpolygon.push(y2);\r\n\t\t\t\t\tpolygon.push(x3);\r\n\t\t\t\t\tpolygon.push(y3);\r\n\t\t\t\t\tpolygonIndices = this.polygonIndicesPool.obtain();\r\n\t\t\t\t\tpolygonIndices.length = 0;\r\n\t\t\t\t\tpolygonIndices.push(t1);\r\n\t\t\t\t\tpolygonIndices.push(t2);\r\n\t\t\t\t\tpolygonIndices.push(t3);\r\n\t\t\t\t\tlastWinding = Triangulator.winding(x1, y1, x2, y2, x3, y3);\r\n\t\t\t\t\tfanBaseIndex = t1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (polygon.length > 0) {\r\n\t\t\t\tconvexPolygons.push(polygon);\r\n\t\t\t\tconvexPolygonsIndices.push(polygonIndices);\r\n\t\t\t}\r\n\r\n\t\t\t// Go through the list of polygons and try to merge the remaining triangles with the found triangle fans.\r\n\t\t\tfor (let i = 0, n = convexPolygons.length; i < n; i++) {\r\n\t\t\t\tpolygonIndices = convexPolygonsIndices[i];\r\n\t\t\t\tif (polygonIndices.length == 0) continue;\r\n\t\t\t\tlet firstIndex = polygonIndices[0];\r\n\t\t\t\tlet lastIndex = polygonIndices[polygonIndices.length - 1];\r\n\r\n\t\t\t\tpolygon = convexPolygons[i];\r\n\t\t\t\tlet o = polygon.length - 4;\r\n\t\t\t\tlet prevPrevX = polygon[o], prevPrevY = polygon[o + 1];\r\n\t\t\t\tlet prevX = polygon[o + 2], prevY = polygon[o + 3];\r\n\t\t\t\tlet firstX = polygon[0], firstY = polygon[1];\r\n\t\t\t\tlet secondX = polygon[2], secondY = polygon[3];\r\n\t\t\t\tlet winding = Triangulator.winding(prevPrevX, prevPrevY, prevX, prevY, firstX, firstY);\r\n\r\n\t\t\t\tfor (let ii = 0; ii < n; ii++) {\r\n\t\t\t\t\tif (ii == i) continue;\r\n\t\t\t\t\tlet otherIndices = convexPolygonsIndices[ii];\r\n\t\t\t\t\tif (otherIndices.length != 3) continue;\r\n\t\t\t\t\tlet otherFirstIndex = otherIndices[0];\r\n\t\t\t\t\tlet otherSecondIndex = otherIndices[1];\r\n\t\t\t\t\tlet otherLastIndex = otherIndices[2];\r\n\r\n\t\t\t\t\tlet otherPoly = convexPolygons[ii];\r\n\t\t\t\t\tlet x3 = otherPoly[otherPoly.length - 2], y3 = otherPoly[otherPoly.length - 1];\r\n\r\n\t\t\t\t\tif (otherFirstIndex != firstIndex || otherSecondIndex != lastIndex) continue;\r\n\t\t\t\t\tlet winding1 = Triangulator.winding(prevPrevX, prevPrevY, prevX, prevY, x3, y3);\r\n\t\t\t\t\tlet winding2 = Triangulator.winding(x3, y3, firstX, firstY, secondX, secondY);\r\n\t\t\t\t\tif (winding1 == winding && winding2 == winding) {\r\n\t\t\t\t\t\totherPoly.length = 0;\r\n\t\t\t\t\t\totherIndices.length = 0;\r\n\t\t\t\t\t\tpolygon.push(x3);\r\n\t\t\t\t\t\tpolygon.push(y3);\r\n\t\t\t\t\t\tpolygonIndices.push(otherLastIndex);\r\n\t\t\t\t\t\tprevPrevX = prevX;\r\n\t\t\t\t\t\tprevPrevY = prevY;\r\n\t\t\t\t\t\tprevX = x3;\r\n\t\t\t\t\t\tprevY = y3;\r\n\t\t\t\t\t\tii = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove empty polygons that resulted from the merge step above.\r\n\t\t\tfor (let i = convexPolygons.length - 1; i >= 0; i--) {\r\n\t\t\t\tpolygon = convexPolygons[i];\r\n\t\t\t\tif (polygon.length == 0) {\r\n\t\t\t\t\tconvexPolygons.splice(i, 1);\r\n\t\t\t\t\tthis.polygonPool.free(polygon);\r\n\t\t\t\t\tpolygonIndices = convexPolygonsIndices[i]\r\n\t\t\t\t\tconvexPolygonsIndices.splice(i, 1)\r\n\t\t\t\t\tthis.polygonIndicesPool.free(polygonIndices);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn convexPolygons;\r\n\t\t}\r\n\r\n\t\tprivate static isConcave (index: number, vertexCount: number, vertices: ArrayLike<number>, indices: ArrayLike<number>): boolean {\r\n\t\t\tlet previous = indices[(vertexCount + index - 1) % vertexCount] << 1;\r\n\t\t\tlet current = indices[index] << 1;\r\n\t\t\tlet next = indices[(index + 1) % vertexCount] << 1;\r\n\t\t\treturn !this.positiveArea(vertices[previous], vertices[previous + 1], vertices[current], vertices[current + 1], vertices[next],\r\n\t\t\t\tvertices[next + 1]);\r\n\t\t}\r\n\r\n\t\tprivate static positiveArea (p1x: number, p1y: number, p2x: number, p2y: number, p3x: number, p3y: number): boolean {\r\n\t\t\treturn p1x * (p3y - p2y) + p2x * (p1y - p3y) + p3x * (p2y - p1y) >= 0;\r\n\t\t}\r\n\r\n\t\tprivate static winding (p1x: number, p1y: number, p2x: number, p2y: number, p3x: number, p3y: number): number {\r\n\t\t\tlet px = p2x - p1x, py = p2y - p1y;\r\n\t\t\treturn p3x * py - p3y * px + px * p1y - p1x * py >= 0 ? 1 : -1;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { ClippingAttachment } from \"./attachments/ClippingAttachment\";\r\nimport { Slot } from \"./Slot\";\r\nimport { Triangulator } from \"./Triangulator\";\r\nimport { Utils, Color, ArrayLike } from \"./Utils\";\r\n\r\n// module spine {\r\n\texport class SkeletonClipping {\r\n\t\tprivate triangulator = new Triangulator();\r\n\t\tprivate clippingPolygon = new Array<number>();\r\n\t\tprivate clipOutput = new Array<number>();\r\n\t\tclippedVertices = new Array<number>();\r\n\t\tclippedTriangles = new Array<number>();\r\n\t\tprivate scratch = new Array<number>();\r\n\r\n\t\tprivate clipAttachment: ClippingAttachment;\r\n\t\tprivate clippingPolygons: Array<Array<number>>;\r\n\r\n\t\tclipStart (slot: Slot, clip: ClippingAttachment): number {\r\n\t\t\tif (this.clipAttachment != null) return 0;\r\n\t\t\tthis.clipAttachment = clip;\r\n\r\n\t\t\tlet n = clip.worldVerticesLength;\r\n\t\t\tlet vertices = Utils.setArraySize(this.clippingPolygon, n);\r\n\t\t\tclip.computeWorldVertices(slot, 0, n, vertices, 0, 2);\r\n\t\t\tlet clippingPolygon = this.clippingPolygon;\r\n\t\t\tSkeletonClipping.makeClockwise(clippingPolygon);\r\n\t\t\tlet clippingPolygons = this.clippingPolygons = this.triangulator.decompose(clippingPolygon, this.triangulator.triangulate(clippingPolygon));\r\n\t\t\tfor (let i = 0, n = clippingPolygons.length; i < n; i++) {\r\n\t\t\t\tlet polygon = clippingPolygons[i];\r\n\t\t\t\tSkeletonClipping.makeClockwise(polygon);\r\n\t\t\t\tpolygon.push(polygon[0]);\r\n\t\t\t\tpolygon.push(polygon[1]);\r\n\t\t\t}\r\n\r\n\t\t\treturn clippingPolygons.length;\r\n\t\t}\r\n\r\n\t\tclipEndWithSlot (slot: Slot) {\r\n\t\t\tif (this.clipAttachment != null && this.clipAttachment.endSlot == slot.data) this.clipEnd();\r\n\t\t}\r\n\r\n\t\tclipEnd () {\r\n\t\t\tif (this.clipAttachment == null) return;\r\n\t\t\tthis.clipAttachment = null;\r\n\t\t\tthis.clippingPolygons = null;\r\n\t\t\tthis.clippedVertices.length = 0;\r\n\t\t\tthis.clippedTriangles.length = 0;\r\n\t\t\tthis.clippingPolygon.length = 0;\r\n\t\t}\r\n\r\n\t\tisClipping (): boolean {\r\n\t\t\treturn this.clipAttachment != null;\r\n\t\t}\r\n\r\n\t\tclipTriangles (vertices: ArrayLike<number>, verticesLength: number, triangles: ArrayLike<number>, trianglesLength: number, uvs: ArrayLike<number>,\r\n\t\t\tlight: Color, dark: Color, twoColor: boolean) {\r\n\r\n\t\t\tlet clipOutput = this.clipOutput, clippedVertices = this.clippedVertices;\r\n\t\t\tlet clippedTriangles = this.clippedTriangles;\r\n\t\t\tlet polygons = this.clippingPolygons;\r\n\t\t\tlet polygonsCount = this.clippingPolygons.length;\r\n\t\t\tlet vertexSize = twoColor ? 12 : 8;\r\n\r\n\t\t\tlet index = 0;\r\n\t\t\tclippedVertices.length = 0;\r\n\t\t\tclippedTriangles.length = 0;\r\n\t\t\touter:\r\n\t\t\tfor (let i = 0; i < trianglesLength; i += 3) {\r\n\t\t\t\tlet vertexOffset = triangles[i] << 1;\r\n\t\t\t\tlet x1 = vertices[vertexOffset], y1 = vertices[vertexOffset + 1];\r\n\t\t\t\tlet u1 = uvs[vertexOffset], v1 = uvs[vertexOffset + 1];\r\n\r\n\t\t\t\tvertexOffset = triangles[i + 1] << 1;\r\n\t\t\t\tlet x2 = vertices[vertexOffset], y2 = vertices[vertexOffset + 1];\r\n\t\t\t\tlet u2 = uvs[vertexOffset], v2 = uvs[vertexOffset + 1];\r\n\r\n\t\t\t\tvertexOffset = triangles[i + 2] << 1;\r\n\t\t\t\tlet x3 = vertices[vertexOffset], y3 = vertices[vertexOffset + 1];\r\n\t\t\t\tlet u3 = uvs[vertexOffset], v3 = uvs[vertexOffset + 1];\r\n\r\n\t\t\t\tfor (let p = 0; p < polygonsCount; p++) {\r\n\t\t\t\t\tlet s = clippedVertices.length;\r\n\t\t\t\t\tif (this.clip(x1, y1, x2, y2, x3, y3, polygons[p], clipOutput)) {\r\n\t\t\t\t\t\tlet clipOutputLength = clipOutput.length;\r\n\t\t\t\t\t\tif (clipOutputLength == 0) continue;\r\n\t\t\t\t\t\tlet d0 = y2 - y3, d1 = x3 - x2, d2 = x1 - x3, d4 = y3 - y1;\r\n\t\t\t\t\t\tlet d = 1 / (d0 * d2 + d1 * (y1 - y3));\r\n\r\n\t\t\t\t\t\tlet clipOutputCount = clipOutputLength >> 1;\r\n\t\t\t\t\t\tlet clipOutputItems = this.clipOutput;\r\n\t\t\t\t\t\tlet clippedVerticesItems = Utils.setArraySize(clippedVertices, s + clipOutputCount * vertexSize);\r\n\t\t\t\t\t\tfor (let ii = 0; ii < clipOutputLength; ii += 2) {\r\n\t\t\t\t\t\t\tlet x = clipOutputItems[ii], y = clipOutputItems[ii + 1];\r\n\t\t\t\t\t\t\tclippedVerticesItems[s] = x;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 1] = y;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 2] = light.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 3] = light.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 4] = light.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 5] = light.a;\r\n\t\t\t\t\t\t\tlet c0 = x - x3, c1 = y - y3;\r\n\t\t\t\t\t\t\tlet a = (d0 * c0 + d1 * c1) * d;\r\n\t\t\t\t\t\t\tlet b = (d4 * c0 + d2 * c1) * d;\r\n\t\t\t\t\t\t\tlet c = 1 - a - b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 6] = u1 * a + u2 * b + u3 * c;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 7] = v1 * a + v2 * b + v3 * c;\r\n\t\t\t\t\t\t\tif (twoColor) {\r\n\t\t\t\t\t\t\t\tclippedVerticesItems[s + 8] = dark.r;\r\n\t\t\t\t\t\t\t\tclippedVerticesItems[s + 9] = dark.g;\r\n\t\t\t\t\t\t\t\tclippedVerticesItems[s + 10] = dark.b;\r\n\t\t\t\t\t\t\t\tclippedVerticesItems[s + 11] = dark.a;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ts += vertexSize;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ts = clippedTriangles.length;\r\n\t\t\t\t\t\tlet clippedTrianglesItems = Utils.setArraySize(clippedTriangles, s + 3 * (clipOutputCount - 2));\r\n\t\t\t\t\t\tclipOutputCount--;\r\n\t\t\t\t\t\tfor (let ii = 1; ii < clipOutputCount; ii++) {\r\n\t\t\t\t\t\t\tclippedTrianglesItems[s] = index;\r\n\t\t\t\t\t\t\tclippedTrianglesItems[s + 1] = (index + ii);\r\n\t\t\t\t\t\t\tclippedTrianglesItems[s + 2] = (index + ii + 1);\r\n\t\t\t\t\t\t\ts += 3;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tindex += clipOutputCount + 1;\r\n\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet clippedVerticesItems = Utils.setArraySize(clippedVertices, s + 3 * vertexSize);\r\n\t\t\t\t\t\tclippedVerticesItems[s] = x1;\r\n\t\t\t\t\t\tclippedVerticesItems[s + 1] = y1;\r\n\t\t\t\t\t\tclippedVerticesItems[s + 2] = light.r;\r\n\t\t\t\t\t\tclippedVerticesItems[s + 3] = light.g;\r\n\t\t\t\t\t\tclippedVerticesItems[s + 4] = light.b;\r\n\t\t\t\t\t\tclippedVerticesItems[s + 5] = light.a;\r\n\t\t\t\t\t\tif (!twoColor) {\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 6] = u1;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 7] = v1;\r\n\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 8] = x2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 9] = y2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 10] = light.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 11] = light.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 12] = light.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 13] = light.a;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 14] = u2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 15] = v2;\r\n\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 16] = x3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 17] = y3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 18] = light.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 19] = light.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 20] = light.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 21] = light.a;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 22] = u3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 23] = v3;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 6] = u1;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 7] = v1;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 8] = dark.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 9] = dark.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 10] = dark.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 11] = dark.a;\r\n\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 12] = x2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 13] = y2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 14] = light.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 15] = light.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 16] = light.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 17] = light.a;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 18] = u2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 19] = v2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 20] = dark.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 21] = dark.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 22] = dark.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 23] = dark.a;\r\n\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 24] = x3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 25] = y3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 26] = light.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 27] = light.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 28] = light.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 29] = light.a;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 30] = u3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 31] = v3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 32] = dark.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 33] = dark.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 34] = dark.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 35] = dark.a;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ts = clippedTriangles.length;\r\n\t\t\t\t\t\tlet clippedTrianglesItems = Utils.setArraySize(clippedTriangles, s + 3);\r\n\t\t\t\t\t\tclippedTrianglesItems[s] = index;\r\n\t\t\t\t\t\tclippedTrianglesItems[s + 1] = (index + 1);\r\n\t\t\t\t\t\tclippedTrianglesItems[s + 2] = (index + 2);\r\n\t\t\t\t\t\tindex += 3;\r\n\t\t\t\t\t\tcontinue outer;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Clips the input triangle against the convex, clockwise clipping area. If the triangle lies entirely within the clipping\r\n\t\t * area, false is returned. The clipping area must duplicate the first vertex at the end of the vertices list. */\r\n\t\tclip (x1: number, y1: number, x2: number, y2: number, x3: number, y3: number, clippingArea: Array<number>, output: Array<number>) {\r\n\t\t\tlet originalOutput = output;\r\n\t\t\tlet clipped = false;\r\n\r\n\t\t\t// Avoid copy at the end.\r\n\t\t\tlet input: Array<number> = null;\r\n\t\t\tif (clippingArea.length % 4 >= 2) {\r\n\t\t\t\tinput = output;\r\n\t\t\t\toutput = this.scratch;\r\n\t\t\t} else\r\n\t\t\t\tinput = this.scratch;\r\n\r\n\t\t\tinput.length = 0;\r\n\t\t\tinput.push(x1);\r\n\t\t\tinput.push(y1);\r\n\t\t\tinput.push(x2);\r\n\t\t\tinput.push(y2);\r\n\t\t\tinput.push(x3);\r\n\t\t\tinput.push(y3);\r\n\t\t\tinput.push(x1);\r\n\t\t\tinput.push(y1);\r\n\t\t\toutput.length = 0;\r\n\r\n\t\t\tlet clippingVertices = clippingArea;\r\n\t\t\tlet clippingVerticesLast = clippingArea.length - 4;\r\n\t\t\tfor (let i = 0;; i += 2) {\r\n\t\t\t\tlet edgeX = clippingVertices[i], edgeY = clippingVertices[i + 1];\r\n\t\t\t\tlet edgeX2 = clippingVertices[i + 2], edgeY2 = clippingVertices[i + 3];\r\n\t\t\t\tlet deltaX = edgeX - edgeX2, deltaY = edgeY - edgeY2;\r\n\r\n\t\t\t\tlet inputVertices = input;\r\n\t\t\t\tlet inputVerticesLength = input.length - 2, outputStart = output.length;\r\n\t\t\t\tfor (let ii = 0; ii < inputVerticesLength; ii += 2) {\r\n\t\t\t\t\tlet inputX = inputVertices[ii], inputY = inputVertices[ii + 1];\r\n\t\t\t\t\tlet inputX2 = inputVertices[ii + 2], inputY2 = inputVertices[ii + 3];\r\n\t\t\t\t\tlet side2 = deltaX * (inputY2 - edgeY2) - deltaY * (inputX2 - edgeX2) > 0;\r\n\t\t\t\t\tif (deltaX * (inputY - edgeY2) - deltaY * (inputX - edgeX2) > 0) {\r\n\t\t\t\t\t\tif (side2) { // v1 inside, v2 inside\r\n\t\t\t\t\t\t\toutput.push(inputX2);\r\n\t\t\t\t\t\t\toutput.push(inputY2);\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// v1 inside, v2 outside\r\n\t\t\t\t\t\tlet c0 = inputY2 - inputY, c2 = inputX2 - inputX;\r\n\t\t\t\t\t\tlet s = c0 * (edgeX2 - edgeX) - c2 * (edgeY2 - edgeY);\r\n\t\t\t\t\t\tif (Math.abs(s) > 0.000001) {\r\n\t\t\t\t\t\t\tlet ua = (c2 * (edgeY - inputY) - c0 * (edgeX - inputX)) / s;\r\n\t\t\t\t\t\t\toutput.push(edgeX + (edgeX2 - edgeX) * ua);\r\n\t\t\t\t\t\t\toutput.push(edgeY + (edgeY2 - edgeY) * ua);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toutput.push(edgeX);\r\n\t\t\t\t\t\t\toutput.push(edgeY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (side2) { // v1 outside, v2 inside\r\n\t\t\t\t\t\tlet c0 = inputY2 - inputY, c2 = inputX2 - inputX;\r\n\t\t\t\t\t\tlet s = c0 * (edgeX2 - edgeX) - c2 * (edgeY2 - edgeY);\r\n\t\t\t\t\t\tif (Math.abs(s) > 0.000001) {\r\n\t\t\t\t\t\t\tlet ua = (c2 * (edgeY - inputY) - c0 * (edgeX - inputX)) / s;\r\n\t\t\t\t\t\t\toutput.push(edgeX + (edgeX2 - edgeX) * ua);\r\n\t\t\t\t\t\t\toutput.push(edgeY + (edgeY2 - edgeY) * ua);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toutput.push(edgeX);\r\n\t\t\t\t\t\t\toutput.push(edgeY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\toutput.push(inputX2);\r\n\t\t\t\t\t\toutput.push(inputY2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tclipped = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (outputStart == output.length) { // All edges outside.\r\n\t\t\t\t\toriginalOutput.length = 0;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toutput.push(output[0]);\r\n\t\t\t\toutput.push(output[1]);\r\n\r\n\t\t\t\tif (i == clippingVerticesLast) break;\r\n\t\t\t\tlet temp = output;\r\n\t\t\t\toutput = input;\r\n\t\t\t\toutput.length = 0;\r\n\t\t\t\tinput = temp;\r\n\t\t\t}\r\n\r\n\t\t\tif (originalOutput != output) {\r\n\t\t\t\toriginalOutput.length = 0;\r\n\t\t\t\tfor (let i = 0, n = output.length - 2; i < n; i++)\r\n\t\t\t\t\toriginalOutput[i] = output[i];\r\n\t\t\t} else\r\n\t\t\t\toriginalOutput.length = originalOutput.length - 2;\r\n\r\n\t\t\treturn clipped;\r\n\t\t}\r\n\r\n\t\tpublic static makeClockwise (polygon: ArrayLike<number>) {\r\n\t\t\tlet vertices = polygon;\r\n\t\t\tlet verticeslength = polygon.length;\r\n\r\n\t\t\tlet area = vertices[verticeslength - 2] * vertices[1] - vertices[0] * vertices[verticeslength - 1], p1x = 0, p1y = 0, p2x = 0, p2y = 0;\r\n\t\t\tfor (let i = 0, n = verticeslength - 3; i < n; i += 2) {\r\n\t\t\t\tp1x = vertices[i];\r\n\t\t\t\tp1y = vertices[i + 1];\r\n\t\t\t\tp2x = vertices[i + 2];\r\n\t\t\t\tp2y = vertices[i + 3];\r\n\t\t\t\tarea += p1x * p2y - p2x * p1y;\r\n\t\t\t}\r\n\t\t\tif (area < 0) return;\r\n\r\n\t\t\tfor (let i = 0, lastX = verticeslength - 2, n = verticeslength >> 1; i < n; i += 2) {\r\n\t\t\t\tlet x = vertices[i], y = vertices[i + 1];\r\n\t\t\t\tlet other = lastX - i;\r\n\t\t\t\tvertices[i] = vertices[other];\r\n\t\t\t\tvertices[i + 1] = vertices[other + 1];\r\n\t\t\t\tvertices[other] = x;\r\n\t\t\t\tvertices[other + 1] = y;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { ClippingAttachment } from \"../core/attachments/ClippingAttachment\";\r\nimport { MeshAttachment } from \"../core/attachments/MeshAttachment\";\r\nimport { RegionAttachment } from \"../core/attachments/RegionAttachment\";\r\nimport { BlendMode } from \"../core/BlendMode\";\r\nimport { Skeleton } from \"../core/Skeleton\";\r\nimport { SkeletonClipping } from \"../core/SkeletonClipping\";\r\nimport { TextureAtlasRegion } from \"../core/TextureAtlas\";\r\nimport { Color, Vector2, Utils, ArrayLike } from \"../core/Utils\";\r\nimport { VertexEffect } from \"../core/VertexEffect\";\r\nimport { GLTexture } from \"./GLTexture\";\r\nimport { PolygonBatcher } from \"./PolygonBatcher\";\r\nimport { ManagedWebGLRenderingContext, WebGLBlendModeConverter } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\tclass Renderable {\r\n\t\tconstructor(public vertices: ArrayLike<number>, public numVertices: number, public numFloats: number) {}\r\n\t};\r\n\r\n\texport class SkeletonRenderer {\r\n\t\tstatic QUAD_TRIANGLES = [0, 1, 2, 2, 3, 0];\r\n\r\n\t\tpremultipliedAlpha = false;\r\n\t\tvertexEffect: VertexEffect = null;\r\n\t\tprivate tempColor = new Color();\r\n\t\tprivate tempColor2 = new Color();\r\n\t\tprivate vertices:ArrayLike<number>;\r\n\t\tprivate vertexSize = 2 + 2 + 4;\r\n\t\tprivate twoColorTint = false;\r\n\t\tprivate renderable: Renderable = new Renderable(null, 0, 0);\r\n\t\tprivate clipper: SkeletonClipping = new SkeletonClipping();\r\n\t\tprivate temp = new Vector2();\r\n\t\tprivate temp2 = new Vector2();\r\n\t\tprivate temp3 = new Color();\r\n\t\tprivate temp4 = new Color();\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext, twoColorTint: boolean = true) {\r\n\t\t\tthis.twoColorTint = twoColorTint;\r\n\t\t\tif (twoColorTint)\r\n\t\t\t\tthis.vertexSize += 4;\r\n\t\t\tthis.vertices = Utils.newFloatArray(this.vertexSize * 1024);\r\n\t\t}\r\n\r\n\t\tdraw (batcher: PolygonBatcher, skeleton: Skeleton, slotRangeStart: number = -1, slotRangeEnd: number = -1) {\r\n\t\t\tlet clipper = this.clipper;\r\n\t\t\tlet premultipliedAlpha = this.premultipliedAlpha;\r\n\t\t\tlet twoColorTint = this.twoColorTint;\r\n\t\t\tlet blendMode: BlendMode = null;\r\n\r\n\t\t\tlet tempPos = this.temp;\r\n\t\t\tlet tempUv = this.temp2;\r\n\t\t\tlet tempLight = this.temp3;\r\n\t\t\tlet tempDark = this.temp4;\r\n\r\n\t\t\tlet renderable: Renderable = this.renderable;\r\n\t\t\tlet uvs: ArrayLike<number> = null;\r\n\t\t\tlet triangles: Array<number> = null;\r\n\t\t\tlet drawOrder = skeleton.drawOrder;\r\n\t\t\tlet attachmentColor: Color = null;\r\n\t\t\tlet skeletonColor = skeleton.color;\r\n\t\t\tlet vertexSize = twoColorTint ? 12 : 8;\r\n\t\t\tlet inRange = false;\r\n\t\t\tif (slotRangeStart == -1) inRange = true;\r\n\t\t\tfor (let i = 0, n = drawOrder.length; i < n; i++) {\r\n\t\t\t\tlet clippedVertexSize = clipper.isClipping() ? 2 : vertexSize;\r\n\t\t\t\tlet slot = drawOrder[i];\r\n\t\t\t\tif (!slot.bone.active) {\r\n\t\t\t\t\tclipper.clipEndWithSlot(slot);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (slotRangeStart >= 0 && slotRangeStart == slot.data.index) {\r\n\t\t\t\t\tinRange = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!inRange) {\r\n\t\t\t\t\tclipper.clipEndWithSlot(slot);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (slotRangeEnd >= 0 && slotRangeEnd == slot.data.index) {\r\n\t\t\t\t\tinRange = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\tlet texture: GLTexture = null;\r\n\t\t\t\tif (attachment instanceof RegionAttachment) {\r\n\t\t\t\t\tlet region = <RegionAttachment>attachment;\r\n\t\t\t\t\trenderable.vertices = this.vertices;\r\n\t\t\t\t\trenderable.numVertices = 4;\r\n\t\t\t\t\trenderable.numFloats = clippedVertexSize << 2;\r\n\t\t\t\t\tregion.computeWorldVertices(slot.bone, renderable.vertices, 0, clippedVertexSize);\r\n\t\t\t\t\ttriangles = SkeletonRenderer.QUAD_TRIANGLES;\r\n\t\t\t\t\tuvs = region.uvs;\r\n\t\t\t\t\ttexture = <GLTexture>(<TextureAtlasRegion>region.region.renderObject).texture;\r\n\t\t\t\t\tattachmentColor = region.color;\r\n\t\t\t\t} else if (attachment instanceof MeshAttachment) {\r\n\t\t\t\t\tlet mesh = <MeshAttachment>attachment;\r\n\t\t\t\t\trenderable.vertices = this.vertices;\r\n\t\t\t\t\trenderable.numVertices = (mesh.worldVerticesLength >> 1);\r\n\t\t\t\t\trenderable.numFloats = renderable.numVertices * clippedVertexSize;\r\n\t\t\t\t\tif (renderable.numFloats > renderable.vertices.length) {\r\n\t\t\t\t\t\trenderable.vertices = this.vertices = Utils.newFloatArray(renderable.numFloats);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmesh.computeWorldVertices(slot, 0, mesh.worldVerticesLength, renderable.vertices, 0, clippedVertexSize);\r\n\t\t\t\t\ttriangles = mesh.triangles;\r\n\t\t\t\t\ttexture = <GLTexture>(<TextureAtlasRegion>mesh.region.renderObject).texture;\r\n\t\t\t\t\tuvs = mesh.uvs;\r\n\t\t\t\t\tattachmentColor = mesh.color;\r\n\t\t\t\t} else if (attachment instanceof ClippingAttachment) {\r\n\t\t\t\t\tlet clip = <ClippingAttachment>(attachment);\r\n\t\t\t\t\tclipper.clipStart(slot, clip);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tclipper.clipEndWithSlot(slot);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (texture != null) {\r\n\t\t\t\t\tlet slotColor = slot.color;\r\n\t\t\t\t\tlet finalColor = this.tempColor;\r\n\t\t\t\t\tfinalColor.r = skeletonColor.r * slotColor.r * attachmentColor.r;\r\n\t\t\t\t\tfinalColor.g = skeletonColor.g * slotColor.g * attachmentColor.g;\r\n\t\t\t\t\tfinalColor.b = skeletonColor.b * slotColor.b * attachmentColor.b;\r\n\t\t\t\t\tfinalColor.a = skeletonColor.a * slotColor.a * attachmentColor.a;\r\n\t\t\t\t\tif (premultipliedAlpha) {\r\n\t\t\t\t\t\tfinalColor.r *= finalColor.a;\r\n\t\t\t\t\t\tfinalColor.g *= finalColor.a;\r\n\t\t\t\t\t\tfinalColor.b *= finalColor.a;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet darkColor = this.tempColor2;\r\n\t\t\t\t\tif (slot.darkColor == null)\r\n\t\t\t\t\t\tdarkColor.set(0, 0, 0, 1.0);\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (premultipliedAlpha) {\r\n\t\t\t\t\t\t\tdarkColor.r = slot.darkColor.r * finalColor.a;\r\n\t\t\t\t\t\t\tdarkColor.g = slot.darkColor.g * finalColor.a;\r\n\t\t\t\t\t\t\tdarkColor.b = slot.darkColor.b * finalColor.a;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdarkColor.setFromColor(slot.darkColor);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdarkColor.a = premultipliedAlpha ? 1.0 : 0.0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet slotBlendMode = slot.data.blendMode;\r\n\t\t\t\t\tif (slotBlendMode != blendMode) {\r\n\t\t\t\t\t\tblendMode = slotBlendMode;\r\n\t\t\t\t\t\tbatcher.setBlendMode(WebGLBlendModeConverter.getSourceGLBlendMode(blendMode, premultipliedAlpha), WebGLBlendModeConverter.getDestGLBlendMode(blendMode));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (clipper.isClipping()) {\r\n\t\t\t\t\t\tclipper.clipTriangles(renderable.vertices, renderable.numFloats, triangles, triangles.length, uvs, finalColor, darkColor, twoColorTint);\r\n\t\t\t\t\t\tlet clippedVertices = new Float32Array(clipper.clippedVertices);\r\n\t\t\t\t\t\tlet clippedTriangles = clipper.clippedTriangles;\r\n\t\t\t\t\t\tif (this.vertexEffect != null) {\r\n\t\t\t\t\t\t\tlet vertexEffect = this.vertexEffect;\r\n\t\t\t\t\t\t\tlet verts = clippedVertices;\r\n\t\t\t\t\t\t\tif (!twoColorTint) {\r\n\t\t\t\t\t\t\t\tfor (let v = 0, n = clippedVertices.length; v < n; v += vertexSize) {\r\n\t\t\t\t\t\t\t\t\ttempPos.x = verts[v];\r\n\t\t\t\t\t\t\t\t\ttempPos.y = verts[v + 1];\r\n\t\t\t\t\t\t\t\t\ttempLight.set(verts[v + 2], verts[v + 3], verts[v + 4], verts[v + 5]);\r\n\t\t\t\t\t\t\t\t\ttempUv.x = verts[v + 6];\r\n\t\t\t\t\t\t\t\t\ttempUv.y = verts[v + 7];\r\n\t\t\t\t\t\t\t\t\ttempDark.set(0, 0, 0, 0);\r\n\t\t\t\t\t\t\t\t\tvertexEffect.transform(tempPos, tempUv, tempLight, tempDark);\r\n\t\t\t\t\t\t\t\t\tverts[v] = tempPos.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 1] = tempPos.y;\r\n\t\t\t\t\t\t\t\t\tverts[v + 2] = tempLight.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 3] = tempLight.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 4] = tempLight.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 5] = tempLight.a;\r\n\t\t\t\t\t\t\t\t\tverts[v + 6] = tempUv.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 7] = tempUv.y\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tfor (let v = 0, n = clippedVertices.length; v < n; v += vertexSize) {\r\n\t\t\t\t\t\t\t\t\ttempPos.x = verts[v];\r\n\t\t\t\t\t\t\t\t\ttempPos.y = verts[v + 1];\r\n\t\t\t\t\t\t\t\t\ttempLight.set(verts[v + 2], verts[v + 3], verts[v + 4], verts[v + 5]);\r\n\t\t\t\t\t\t\t\t\ttempUv.x = verts[v + 6];\r\n\t\t\t\t\t\t\t\t\ttempUv.y = verts[v + 7];\r\n\t\t\t\t\t\t\t\t\ttempDark.set(verts[v + 8], verts[v + 9], verts[v + 10], verts[v + 11]);\r\n\t\t\t\t\t\t\t\t\tvertexEffect.transform(tempPos, tempUv, tempLight, tempDark);\r\n\t\t\t\t\t\t\t\t\tverts[v] = tempPos.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 1] = tempPos.y;\r\n\t\t\t\t\t\t\t\t\tverts[v + 2] = tempLight.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 3] = tempLight.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 4] = tempLight.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 5] = tempLight.a;\r\n\t\t\t\t\t\t\t\t\tverts[v + 6] = tempUv.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 7] = tempUv.y\r\n\t\t\t\t\t\t\t\t\tverts[v + 8] = tempDark.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 9] = tempDark.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 10] = tempDark.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 11] = tempDark.a;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbatcher.draw(texture, clippedVertices, clippedTriangles);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet verts = renderable.vertices;\r\n\t\t\t\t\t\tif (this.vertexEffect != null) {\r\n\t\t\t\t\t\t\tlet vertexEffect = this.vertexEffect;\r\n\t\t\t\t\t\t\tif (!twoColorTint) {\r\n\t\t\t\t\t\t\t\tfor (let v = 0, u = 0, n = renderable.numFloats; v < n; v += vertexSize, u += 2) {\r\n\t\t\t\t\t\t\t\t\ttempPos.x = verts[v];\r\n\t\t\t\t\t\t\t\t\ttempPos.y = verts[v + 1];\r\n\t\t\t\t\t\t\t\t\ttempUv.x = uvs[u];\r\n\t\t\t\t\t\t\t\t\ttempUv.y = uvs[u + 1]\r\n\t\t\t\t\t\t\t\t\ttempLight.setFromColor(finalColor);\r\n\t\t\t\t\t\t\t\t\ttempDark.set(0, 0, 0, 0);\r\n\t\t\t\t\t\t\t\t\tvertexEffect.transform(tempPos, tempUv, tempLight, tempDark);\r\n\t\t\t\t\t\t\t\t\tverts[v] = tempPos.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 1] = tempPos.y;\r\n\t\t\t\t\t\t\t\t\tverts[v + 2] = tempLight.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 3] = tempLight.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 4] = tempLight.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 5] = tempLight.a;\r\n\t\t\t\t\t\t\t\t\tverts[v + 6] = tempUv.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 7] = tempUv.y\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tfor (let v = 0, u = 0, n = renderable.numFloats; v < n; v += vertexSize, u += 2) {\r\n\t\t\t\t\t\t\t\t\ttempPos.x = verts[v];\r\n\t\t\t\t\t\t\t\t\ttempPos.y = verts[v + 1];\r\n\t\t\t\t\t\t\t\t\ttempUv.x = uvs[u];\r\n\t\t\t\t\t\t\t\t\ttempUv.y = uvs[u + 1]\r\n\t\t\t\t\t\t\t\t\ttempLight.setFromColor(finalColor);\r\n\t\t\t\t\t\t\t\t\ttempDark.setFromColor(darkColor);\r\n\t\t\t\t\t\t\t\t\tvertexEffect.transform(tempPos, tempUv, tempLight, tempDark);\r\n\t\t\t\t\t\t\t\t\tverts[v] = tempPos.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 1] = tempPos.y;\r\n\t\t\t\t\t\t\t\t\tverts[v + 2] = tempLight.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 3] = tempLight.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 4] = tempLight.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 5] = tempLight.a;\r\n\t\t\t\t\t\t\t\t\tverts[v + 6] = tempUv.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 7] = tempUv.y\r\n\t\t\t\t\t\t\t\t\tverts[v + 8] = tempDark.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 9] = tempDark.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 10] = tempDark.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 11] = tempDark.a;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (!twoColorTint) {\r\n\t\t\t\t\t\t\t\tfor (let v = 2, u = 0, n = renderable.numFloats; v < n; v += vertexSize, u += 2) {\r\n\t\t\t\t\t\t\t\t\tverts[v] = finalColor.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 1] = finalColor.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 2] = finalColor.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 3] = finalColor.a;\r\n\t\t\t\t\t\t\t\t\tverts[v + 4] = uvs[u];\r\n\t\t\t\t\t\t\t\t\tverts[v + 5] = uvs[u + 1];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tfor (let v = 2, u = 0, n = renderable.numFloats; v < n; v += vertexSize, u += 2) {\r\n\t\t\t\t\t\t\t\t\tverts[v] = finalColor.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 1] = finalColor.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 2] = finalColor.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 3] = finalColor.a;\r\n\t\t\t\t\t\t\t\t\tverts[v + 4] = uvs[u];\r\n\t\t\t\t\t\t\t\t\tverts[v + 5] = uvs[u + 1];\r\n\t\t\t\t\t\t\t\t\tverts[v + 6] = darkColor.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 7] = darkColor.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 8] = darkColor.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 9] = darkColor.a;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet view = (renderable.vertices as Float32Array).subarray(0, renderable.numFloats);\r\n\t\t\t\t\t\tbatcher.draw(texture, view, triangles);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclipper.clipEndWithSlot(slot);\r\n\t\t\t}\r\n\t\t\tclipper.clipEnd();\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { TimeKeeper, Color } from \"../core/Utils\";\r\nimport { GLTexture } from \"./GLTexture\";\r\nimport { SceneRenderer, ResizeMode } from \"./SceneRenderer\";\r\n\r\n// module spine.webgl {\r\n\texport class LoadingScreen {\r\n\t\tstatic FADE_SECONDS = 1;\r\n\r\n\t\tprivate static loaded = 0;\r\n\t\tprivate static spinnerImg: HTMLImageElement = null;\r\n\t\tprivate static logoImg: HTMLImageElement = null;\r\n\r\n\t\tprivate renderer: SceneRenderer;\r\n\t\tprivate logo: GLTexture = null;\r\n\t\tprivate spinner: GLTexture = null;\r\n\t\tprivate angle = 0;\r\n\t\tprivate fadeOut = 0;\r\n\t\tprivate timeKeeper = new TimeKeeper();\r\n\t\tbackgroundColor = new Color(0.135, 0.135, 0.135, 1);\r\n\t\tprivate tempColor = new Color();\r\n\t\tprivate firstDraw = 0;\r\n\r\n\t\tprivate static SPINNER_DATA = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKMAAACjCAYAAADmbK6AAAAACXBIWXMAAAsTAAALEwEAmpwYAAALB2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNS41IChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTYtMDktMDhUMTQ6MjU6MTIrMDI6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTgtMTEtMTVUMTY6NDA6NTkrMDE6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE4LTExLTE1VDE2OjQwOjU5KzAxOjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpmZDhlNTljMC02NGJjLTIxNGQtODAyZi1jZDlhODJjM2ZjMGMiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDpmYmNmZWJlYS03MjY2LWE0NGQtOTI4NS0wOTJmNGNhYzk4ZWEiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHRpZmY6T3JpZW50YXRpb249IjEiIHRpZmY6WFJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpZUmVzb2x1dGlvbj0iNzIwMDAwLzEwMDAwIiB0aWZmOlJlc29sdXRpb25Vbml0PSIyIiBleGlmOkNvbG9yU3BhY2U9IjY1NTM1IiBleGlmOlBpeGVsWERpbWVuc2lvbj0iMjk3IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iMjQyIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiIHN0RXZ0OndoZW49IjIwMTYtMDktMDhUMTQ6MjU6MTIrMDI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1LjUgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiNThlMTlkNi0xYTRjLTQyNDEtODU0ZC01MDVlZjYxMjRhODQiIHN0RXZ0OndoZW49IjIwMTgtMTEtMTVUMTY6NDA6MjMrMDE6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjQ3YzYzYzIwLWJkYjgtYzM0YS1hYzMyLWQ5MDdjOWEyOTA0MCIgc3RFdnQ6d2hlbj0iMjAxOC0xMS0xNVQxNjo0MDo1OSswMTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY29udmVydGVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJmcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvcG5nIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJkZXJpdmVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJjb252ZXJ0ZWQgZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ZmQ4ZTU5YzAtNjRiYy0yMTRkLTgwMmYtY2Q5YTgyYzNmYzBjIiBzdEV2dDp3aGVuPSIyMDE4LTExLTE1VDE2OjQwOjU5KzAxOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo0N2M2M2MyMC1iZGI4LWMzNGEtYWMzMi1kOTA3YzlhMjkwNDAiIHN0UmVmOmRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo2OWRmZjljYy01YzFiLWE5NDctOTc3OS03ODgxZjM0ODk3MDMiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiLz4gPHBob3Rvc2hvcDpEb2N1bWVudEFu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\";\r\n\r\n\t\tprivate static SPINE_LOGO_DATA = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKUAAABsCAYAAAALzHKmAAAACXBIWXMAAAsTAAALEwEAmpwYAAALB2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNS41IChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTYtMDktMDhUMTQ6MjU6MTIrMDI6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTgtMTEtMTVUMTY6NDA6NTkrMDE6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE4LTExLTE1VDE2OjQwOjU5KzAxOjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowMTdhZGQ3Ni04OTZlLThlNGUtYmM5MS00ZjEyNjI1YjA3MjgiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDplMTViNGE2ZS1hMDg3LWEzNDktODdhOS1mNDYzYjE2MzQ0Y2MiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHRpZmY6T3JpZW50YXRpb249IjEiIHRpZmY6WFJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpZUmVzb2x1dGlvbj0iNzIwMDAwLzEwMDAwIiB0aWZmOlJlc29sdXRpb25Vbml0PSIyIiBleGlmOkNvbG9yU3BhY2U9IjY1NTM1IiBleGlmOlBpeGVsWERpbWVuc2lvbj0iMjk3IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iMjQyIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiIHN0RXZ0OndoZW49IjIwMTYtMDktMDhUMTQ6MjU6MTIrMDI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1LjUgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiNThlMTlkNi0xYTRjLTQyNDEtODU0ZC01MDVlZjYxMjRhODQiIHN0RXZ0OndoZW49IjIwMTgtMTEtMTVUMTY6NDA6MjMrMDE6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjJlNjJiMWM2LWIxYzQtNDk0MC04MDMxLWU4ZDkyNTBmODJjNSIgc3RFdnQ6d2hlbj0iMjAxOC0xMS0xNVQxNjo0MDo1OSswMTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY29udmVydGVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJmcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvcG5nIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJkZXJpdmVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJjb252ZXJ0ZWQgZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MDE3YWRkNzYtODk2ZS04ZTRlLWJjOTEtNGYxMjYyNWIwNzI4IiBzdEV2dDp3aGVuPSIyMDE4LTExLTE1VDE2OjQwOjU5KzAxOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoyZTYyYjFjNi1iMWM0LTQ5NDAtODAzMS1lOGQ5MjUwZjgyYzUiIHN0UmVmOmRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo2OWRmZjljYy01YzFiLWE5NDctOTc3OS03ODgxZjM0ODk3MDMiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiLz4gPHBob3Rvc2hvcDpEb2N1bWVudEFu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\"\r\n\r\n\t\tconstructor (renderer: SceneRenderer) {\r\n\t\t\tthis.renderer = renderer;\r\n\r\n\t\t\tthis.timeKeeper.maxDelta = 9;\r\n\r\n\t\t\tif (LoadingScreen.logoImg === null) {\r\n\t\t\t\t// thank you Apple Inc.\r\n\t\t\t\tlet isSafari = navigator.userAgent.indexOf(\"Safari\") > -1;\r\n\r\n\t\t\t\tLoadingScreen.logoImg = new Image();\r\n\t\t\t\tLoadingScreen.logoImg.src = LoadingScreen.SPINE_LOGO_DATA;\r\n\t\t\t\tif (!isSafari) LoadingScreen.logoImg.crossOrigin = \"anonymous\";\r\n\t\t\t\tLoadingScreen.logoImg.onload = (ev) => {\r\n\t\t\t\t\tLoadingScreen.loaded++;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tLoadingScreen.spinnerImg = new Image();\r\n\t\t\t\tLoadingScreen.spinnerImg.src = LoadingScreen.SPINNER_DATA;\r\n\t\t\t\tif (!isSafari) LoadingScreen.spinnerImg.crossOrigin = \"anonymous\";\r\n\t\t\t\tLoadingScreen.spinnerImg.onload = (ev) => {\r\n\t\t\t\t\tLoadingScreen.loaded++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdraw (complete = false) {\r\n\t\t\tif (complete && this.fadeOut > LoadingScreen.FADE_SECONDS) return;\r\n\r\n\t\t\tthis.timeKeeper.update();\r\n\t\t\tlet a = Math.abs(Math.sin(this.timeKeeper.totalTime + 0.75));\r\n\t\t\tthis.angle -= this.timeKeeper.delta / 1.4 * 360 * (1 + 1.5 * Math.pow(a, 5));\r\n\r\n\t\t\tlet renderer = this.renderer;\r\n\t\t\tlet canvas = renderer.canvas;\r\n\t\t\tlet gl = renderer.context.gl;\r\n\r\n\t\t\trenderer.resize(ResizeMode.Stretch);\r\n\r\n\t\t\tlet cam = renderer.camera;\r\n\t\t\t// let oldX = cam.position.x;\r\n\t\t\t// let oldY = cam.position.y;\r\n\t\t\t// let oldZ = cam.position.z;\r\n\t\t\t// cam.position.set(canvas.width / 2, canvas.height / 2, 0);\r\n\t\t\t// cam.viewportWidth = canvas.width;\r\n\t\t\t// cam.viewportHeight = canvas.height;\r\n\r\n\t\t\tif (!complete) {\r\n\t\t\t\tgl.clearColor(this.backgroundColor.r, this.backgroundColor.g, this.backgroundColor.b, this.backgroundColor.a);\r\n\t\t\t\tgl.clear(gl.COLOR_BUFFER_BIT);\r\n\t\t\t\tthis.tempColor.a = 1;\r\n\t\t\t} else {\r\n\t\t\t\tthis.fadeOut += this.timeKeeper.delta * (this.timeKeeper.totalTime < 1 ? 2 : 1);\r\n\t\t\t\tif (this.fadeOut > LoadingScreen.FADE_SECONDS) {\r\n\t\t\t\t\t// cam.position.set(oldX, oldY, oldZ);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\ta = 1 - this.fadeOut / LoadingScreen.FADE_SECONDS;\r\n\t\t\t\tthis.tempColor.setFromColor(this.backgroundColor);\r\n\t\t\t\tthis.tempColor.a = 1 - (a - 1) * (a - 1);\r\n\t\t\t\trenderer.begin();\r\n\t\t\t\tlet x = canvas.width / 2;\r\n\t\t\t\trenderer.quad(true, \r\n\t\t\t\t\t0-x, 0, \r\n\t\t\t\t\tcanvas.width-x, 0, \r\n\t\t\t\t\tcanvas.width-x, canvas.height, \r\n\t\t\t\t\t0-x, canvas.height,\r\n\t\t\t\t\tthis.tempColor, this.tempColor, this.tempColor, this.tempColor);\r\n\t\t\t\t// renderer.quad(true, \r\n\t\t\t\t// \t0, 0, \r\n\t\t\t\t// \tcanvas.width, 0, \r\n\t\t\t\t// \tcanvas.width, canvas.height, \r\n\t\t\t\t// \t0, canvas.height,\r\n\t\t\t\t// \tthis.tempColor, this.tempColor, this.tempColor, this.tempColor);\r\n\t\t\t\trenderer.end();\r\n\t\t\t}\r\n\t\t\tthis.tempColor.set(1, 1, 1, this.tempColor.a);\r\n\r\n\t\t\tif (LoadingScreen.loaded != 2) return;\r\n\t\t\tif (this.logo === null) {\r\n\t\t\t\tthis.logo = new GLTexture(renderer.context, LoadingScreen.logoImg);\r\n\t\t\t\tthis.spinner = new GLTexture(renderer.context, LoadingScreen.spinnerImg);\r\n\t\t\t}\r\n\t\t\tthis.logo.update(false);\r\n\t\t\tthis.spinner.update(false);\r\n\r\n\t\t\tlet logoWidth = this.logo.getImage().width;\r\n\t\t\tlet logoHeight = this.logo.getImage().height;\r\n\t\t\tlet spinnerWidth = this.spinner.getImage().width;\r\n\t\t\tlet spinnerHeight = this.spinner.getImage().height;\r\n\r\n\t\t\trenderer.batcher.setBlendMode(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n\t\t\trenderer.begin();\r\n\t\t\trenderer.drawTexture(this.logo,\r\n\t\t\t\t// (canvas.width - logoWidth) / 2,\r\n\t\t\t\t(-logoWidth) / 2,\r\n\t\t\t\t(canvas.height - logoHeight) / 2,\r\n\t\t\t\tlogoWidth, logoHeight,\r\n\t\t\t\tthis.tempColor\r\n\t\t\t);\r\n\t\t\trenderer.drawTextureRotated(\r\n\t\t\t\tthis.spinner, \r\n\t\t\t\t// (canvas.width - spinnerWidth) / 2, \r\n\t\t\t\t(-spinnerWidth) / 2, \r\n\t\t\t\t(canvas.height - spinnerHeight) / 2, \r\n\t\t\t\tspinnerWidth, spinnerHeight, \r\n\t\t\t\tspinnerWidth / 2, spinnerHeight / 2,\r\n\t\t\t\tthis.angle, \r\n\t\t\t\tthis.tempColor\r\n\t\t\t);\r\n\t\t\trenderer.end();\r\n\r\n\t\t\t// cam.position.set(oldX, oldY, oldZ);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { SkeletonData } from \"./SkeletonData\";\r\nimport {Animation } from \"./Animation\";\r\nimport {Map } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores mix (crossfade) durations to be applied when {@link AnimationState} animations are changed. */\r\n\texport class AnimationStateData {\r\n\t\t/** The SkeletonData to look up animations when they are specified by name. */\r\n\t\tskeletonData: SkeletonData;\r\n\r\n\t\tanimationToMixTime: Map<number> = { };\r\n\r\n\t\t/** The mix duration to use when no mix duration has been defined between two animations. */\r\n\t\tdefaultMix = 0;\r\n\r\n\t\tconstructor (skeletonData: SkeletonData) {\r\n\t\t\tif (skeletonData == null) throw new Error(\"skeletonData cannot be null.\");\r\n\t\t\tthis.skeletonData = skeletonData;\r\n\t\t}\r\n\r\n\t\t/** Sets a mix duration by animation name.\r\n\t\t *\r\n\t\t * See {@link #setMixWith()}. */\r\n\t\tsetMix (fromName: string, toName: string, duration: number) {\r\n\t\t\tlet from = this.skeletonData.findAnimation(fromName);\r\n\t\t\tif (from == null) throw new Error(\"Animation not found: \" + fromName);\r\n\t\t\tlet to = this.skeletonData.findAnimation(toName);\r\n\t\t\tif (to == null) throw new Error(\"Animation not found: \" + toName);\r\n\t\t\tthis.setMixWith(from, to, duration);\r\n\t\t}\r\n\r\n\t\t/** Sets the mix duration when changing from the specified animation to the other.\r\n\t\t *\r\n\t\t * See {@link TrackEntry#mixDuration}. */\r\n\t\tsetMixWith (from: Animation, to: Animation, duration: number) {\r\n\t\t\tif (from == null) throw new Error(\"from cannot be null.\");\r\n\t\t\tif (to == null) throw new Error(\"to cannot be null.\");\r\n\t\t\tlet key = from.name + \".\" + to.name;\r\n\t\t\tthis.animationToMixTime[key] = duration;\r\n\t\t}\r\n\r\n\t\t/** Returns the mix duration to use when changing from the specified animation to the other, or the {@link #defaultMix} if\r\n\t \t* no mix duration has been set. */\r\n\t\tgetMix (from: Animation, to: Animation) {\r\n\t\t\tlet key = from.name + \".\" + to.name;\r\n\t\t\tlet value = this.animationToMixTime[key];\r\n\t\t\treturn value === undefined ? this.defaultMix : value;\r\n\t\t}\r\n\t}\r\n// }\r\n","import { Vector2 } from \"../core/Utils\";\r\nimport { Vector3 } from \"../webgl/Vector3\";\r\nimport { Actor } from \"./Actor\";\r\nimport { BoundingBox } from \"./Player\";\r\n\r\n// // module spine {\r\n    export class ActionName {\r\n\t\tstatic PLAY_ANIMATION = \"PLAY_ANIMATION\";\r\n\t\tstatic WANDER = \"WANDER\";\r\n\t\tstatic WALK_TO = \"WALK_TO\";\r\n        static PACE_AROUND = \"PACE_AROUND\";\r\n    }\r\n\r\n    export interface ActorAction {\r\n        SetAnimation(actor:Actor, animation:string, viewport: BoundingBox): void;\r\n        GetAnimations(): string[]\r\n        UpdatePhysics(actor: Actor, deltaSecs: number, viewport: BoundingBox): void\r\n    }\r\n\r\n    export function ParseActionNameToAction(actionName: string, actionData: any) : ActorAction \r\n    {\r\n        switch (actionName) {\r\n            case ActionName.PLAY_ANIMATION:\r\n                return new PlayAnimationAction(actionData);\r\n            case ActionName.WANDER:\r\n                return new WanderAction(actionData);\r\n            case ActionName.WALK_TO:\r\n                return new WalkToAction(actionData);\r\n            case ActionName.PACE_AROUND:\r\n                return new PaceAroundAction(actionData);\r\n            default:\r\n                console.log(\"Unknown action name \", actionName);\r\n                return null;\r\n        }\r\n    }\r\n\r\n    export class PlayAnimationAction implements ActorAction{\r\n        public actionData: any\r\n        public startPosition: Vector2\r\n        public endPosition: Vector2\r\n        public currentAnimation: string\r\n\r\n        constructor(actionData: any) {\r\n            this.actionData = actionData\r\n            this.currentAnimation = null;\r\n            this.endPosition = null;\r\n        }\r\n\r\n        getRandomPosition(currentPos: Vector2, viewport: BoundingBox): Vector2 {\r\n            let half = viewport.width / 2;\r\n            let rand = Math.random();\r\n\t\t\treturn new Vector2(rand*viewport.width - half, currentPos.y);\r\n        }\r\n\r\n        SetAnimation(actor:Actor, animation:string, viewport: BoundingBox) {\r\n            const startPosYScaled = actor.config.startPosY * viewport.y;\r\n            if (animation == \"Sit\") {\r\n\t\t\t\tactor.setPositionY(startPosYScaled + Math.abs(actor.animViewport.y));\r\n\t\t\t} else {\r\n\t\t\t\tactor.setPositionY(startPosYScaled);\r\n\t\t\t}\r\n            this.currentAnimation = animation;\r\n            if (this.currentAnimation.includes(\"Move\")) {\r\n                this.startPosition = null;\r\n                this.endPosition = null;\r\n            }\r\n        }\r\n\r\n        GetAnimations(): string[] {\r\n            return this.actionData[\"animations\"];\r\n        }\r\n\r\n        UpdatePhysics(actor: Actor, deltaSecs: number, viewport: BoundingBox) {\r\n            if (!this.currentAnimation.includes(\"Move\")) {\r\n                actor.setVelocity(0,0,0);\r\n            } else {\r\n                if (this.endPosition == null) {\r\n                    this.startPosition = actor.getPosition();\r\n                    this.endPosition = this.getRandomPosition(actor.getPosition(), viewport);\r\n                }\r\n    \r\n                let dir = this.endPosition.subtract(actor.getPosition());\r\n                if (dir.length() < 5) {\r\n                    // We have reached the target position. Find a new destination\r\n                    actor.setPosition(this.endPosition.x, this.endPosition.y, 0);\r\n                    this.startPosition = actor.getPosition();\r\n                    this.endPosition = this.getRandomPosition(actor.getPosition(), viewport);\r\n                }    \r\n                dir.normalize();\r\n                actor.setVelocity(\r\n                    dir.x * actor.getMovementSpeedX() * deltaSecs,\r\n                    dir.y * actor.getMovementSpeedY() * deltaSecs,\r\n                    0\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    export class WanderAction implements ActorAction{\r\n        public actionData: any\r\n        public startPosition: Vector2 = null;\r\n        public endPosition: Vector2 = null;\r\n\r\n        constructor(actionData: any) {\r\n            this.actionData = actionData\r\n            this.startPosition = null;\r\n            this.endPosition = null;\r\n        }\r\n\r\n        getRandomPosition(currentPos: Vector2, viewport: BoundingBox): Vector2 {\r\n            let half = viewport.width / 2;\r\n\t\t\treturn new Vector2(Math.random()*viewport.width - half, currentPos.y);\r\n        }\r\n\r\n        SetAnimation(actor:Actor, animation:string, viewport: BoundingBox) {\r\n            // TODO: Figure out what this for walking, wander, pace-around actions\r\n            // I know for playAnimation it is used to reset from a sit position\r\n            actor.setPositionY(actor.config.startPosY * viewport.y);\r\n        }\r\n\r\n        GetAnimations(): string[] {\r\n            return [this.actionData[\"wander_animation\"]];\r\n        }\r\n\r\n        UpdatePhysics(actor: Actor, deltaSecs: number, viewport: BoundingBox){\r\n            if (this.endPosition == null) {\r\n                this.startPosition = actor.getPosition();\r\n                this.endPosition = this.getRandomPosition(actor.getPosition(), viewport);\r\n            }\r\n\r\n            let dir = this.endPosition.subtract(actor.getPosition());\r\n            if (dir.length() < 5) {\r\n                // We have reached the target position. Find a new destination\r\n                actor.setPosition(this.endPosition.x, this.endPosition.y, 0);\r\n                this.startPosition = actor.getPosition();\r\n                this.endPosition = this.getRandomPosition(actor.getPosition(), viewport);\r\n            }    \r\n            dir.normalize();\r\n            actor.setVelocity(\r\n                dir.x * actor.getMovementSpeedX() * deltaSecs,\r\n                dir.y * actor.getMovementSpeedY() * deltaSecs,\r\n                0\r\n            );\r\n        }\r\n    }\r\n\r\n\r\n    export class WalkToAction implements ActorAction{\r\n        public actionData: any\r\n        public startPosition: Vector2 = null;\r\n        public endPosition: Vector2 = null;\r\n        public startDir: Vector2 = null;\r\n        public reachedDestination: boolean;\r\n\r\n        constructor(actionData: any) {\r\n            this.actionData = actionData;\r\n            this.startPosition = null;\r\n            this.endPosition = null;\r\n            this.startDir = null;\r\n            this.reachedDestination = false;\r\n        }\r\n\r\n        SetAnimation(actor:Actor, animation:string, viewport: BoundingBox) {\r\n            actor.setPositionY(actor.config.startPosY * viewport.y);\r\n        }\r\n\r\n        GetAnimations(): string[] {\r\n            if (this.reachedDestination) {\r\n                return [this.actionData[\"walk_to_final_animation\"]];\r\n            } else {\r\n                return [this.actionData[\"walk_to_animation\"]];\r\n            }\r\n        }\r\n\r\n        UpdatePhysics(actor: Actor, deltaSecs: number, viewport: BoundingBox) {\r\n            if (this.reachedDestination) {\r\n                return;\r\n            }\r\n\r\n            if (this.endPosition == null) {\r\n                this.startPosition = actor.getPosition();\r\n                let target = new Vector2(\r\n                    this.actionData[\"target_pos\"][\"x\"],\r\n                    this.actionData[\"target_pos\"][\"y\"],\r\n                );\r\n                this.endPosition = new Vector2(\r\n                    target.x * viewport.width - (viewport.width/2),\r\n                    0,\r\n                );\r\n                this.startDir = this.endPosition.subtract(this.startPosition);\r\n                if (this.startDir.length() < 10) {\r\n                    this.reachedDestination = true;\r\n                }\r\n                this.startDir = this.startDir.normalize()\r\n            }\r\n\r\n            let dir = this.endPosition.subtract(actor.getPosition()).normalize();\r\n            let angle = this.startDir.angle(dir);\r\n            let reached = Math.abs(Math.PI - angle) < 0.001;\r\n            if (reached || this.reachedDestination) {\r\n                // We have reached the target destination\r\n                actor.setPosition(this.endPosition.x, this.endPosition.y,0);\r\n                this.startPosition = actor.getPosition();\r\n                actor.setVelocity(0,0,0);\r\n                this.reachedDestination = true;\r\n                actor.InitAnimationState();\r\n            } else {\r\n                actor.setVelocity(\r\n                    dir.x * actor.getMovementSpeedX() * deltaSecs,\r\n                    dir.y * actor.getMovementSpeedY() * deltaSecs,\r\n                    0\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    export class PaceAroundAction implements ActorAction{\r\n        public actionData: any\r\n        public startPosition: Vector3 = null;\r\n        public endPosition: Vector3 = null;\r\n        public reachedDestination: boolean;\r\n\r\n        constructor(actionData: any) {\r\n            this.actionData = actionData;\r\n            this.startPosition = null;\r\n            this.endPosition = null;\r\n            this.reachedDestination = false;\r\n        }\r\n\r\n        SetAnimation(actor:Actor, animation:string, viewport: BoundingBox) {\r\n            actor.setPositionY(actor.config.startPosY * viewport.y);\r\n        }\r\n\r\n        GetAnimations(): string[] {\r\n            return [this.actionData[\"pace_around_animation\"]];\r\n        }\r\n\r\n        UpdatePhysics(actor: Actor, deltaSecs: number, viewport: BoundingBox) {\r\n            if (this.reachedDestination) {\r\n                this.reachedDestination = false;\r\n\r\n                // Swap the positions\r\n                let tempPosition = this.startPosition;\r\n                this.startPosition = this.endPosition;\r\n                this.endPosition = tempPosition;\r\n                return;\r\n            }\r\n\r\n            if (this.endPosition == null) {\r\n                // TODO: Make the z range configurable\r\n                let z1 = Math.random()*20;\r\n                let z2 = Math.random()*20;\r\n                let start = new Vector3(\r\n                    this.actionData[\"pace_start_pos\"][\"x\"],\r\n                    this.actionData[\"pace_start_pos\"][\"y\"],\r\n                    z1\r\n                )\r\n                let target = new Vector3(\r\n                    this.actionData[\"pace_end_pos\"][\"x\"],\r\n                    this.actionData[\"pace_end_pos\"][\"y\"],\r\n                    z2\r\n                );\r\n                this.startPosition = new Vector3(\r\n                    start.x * viewport.width - (viewport.width/2),\r\n                    start.y * viewport.height,\r\n                    start.z\r\n                )\r\n                this.endPosition = new Vector3(\r\n                    target.x * viewport.width - (viewport.width/2),\r\n                    target.y * viewport.height,\r\n                    target.z\r\n                );\r\n                let temp = this.endPosition.copy();\r\n                if (temp.sub(actor.getPosition3()).length() < 10) {\r\n                    this.reachedDestination = true;\r\n                }\r\n            }\r\n            // TODO: Figure out a better way of handling if we have reached an end position.\r\n            let dir = this.endPosition.copy().sub(actor.getPosition3()).normalize();\r\n            let dist_to = this.endPosition.copy().sub(actor.getPosition3()).length();\r\n            if (dist_to < 10 || this.reachedDestination) {\r\n                // We have reached the target destination\r\n                actor.setPosition(this.endPosition.x, this.endPosition.y, this.endPosition.z);\r\n                actor.setVelocity(0,0,0);\r\n                this.reachedDestination = true;\r\n            } else {\r\n                actor.setVelocity(\r\n                    dir.x * actor.getMovementSpeedX() * deltaSecs,\r\n                    dir.y * actor.getMovementSpeedY() * deltaSecs,\r\n                    dir.z * actor.getMovementSpeedZ() * deltaSecs\r\n                )\r\n            }\r\n        }\r\n    }\r\n// }","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { AnimationStateListener, AnimationState, TrackEntry } from \"../core/AnimationState\"\r\nimport { AnimationStateData } from \"../core/AnimationStateData\"\r\nimport { Skeleton } from \"../core/Skeleton\"\r\nimport { Vector2, TimeKeeper, Map } from \"../core/Utils\"\r\nimport { Vector3 } from \"../webgl/Vector3\"\r\nimport { ActorAction, ParseActionNameToAction } from \"./Action\"\r\nimport { SpinePlayer, BoundingBox } from \"./Player\"\r\nimport { Event } from \"../core/Event\"\r\n\r\n// // module spine {\r\n\r\n    export interface ActorUpdateConfig {\r\n        start_pos: Vector2\r\n        dest_pos: Vector2\r\n        loop_positions: boolean\r\n        wander: boolean\r\n        animation: string\r\n    }\r\n\r\n\texport interface SpineActorConfig {\r\n\t\t/* the URL of the skeleton .json file */\r\n\t\tjsonUrl?: string\r\n\r\n\t\t/* the URL of the skeleton .skel file */\r\n\t\tskelUrl: string\r\n\r\n\t\t/* the URL of the skeleton .atlas file. Atlas page images are automatically resolved. */\r\n\t\tatlasUrl: string\r\n\r\n\t\t/* Raw data URIs, mapping from a path to base 64 encoded raw data. When the player\r\n\t\t   resolves a path of the `jsonUrl`, `skelUrl`, `atlasUrl`, or the image paths\r\n\t\t   referenced in the atlas, it will first look for that path in this array of\r\n\t\t   raw data URIs. This allows embedding of resources directly in HTML/JS. */\r\n\t\trawDataURIs?: Map<string>\r\n\r\n\t\t/* Optional: the default mix time used to switch between two animations. */\r\n\t\tdefaultMix?: number\r\n\r\n\t\t/* Optional: the name of the skin to be set. Default: the default skin. */\r\n\t\tskin?: string\r\n\r\n\t\t/* Optional: list of skin names from which the user can choose. */\r\n\t\tskins?: string[]\r\n\r\n\t\t/* Optional: whether the skeleton uses premultiplied alpha. Default: true. */\r\n\t\tpremultipliedAlpha: boolean\r\n\r\n\t\t/** Optional: Animation play speed. 0 to 3.0 */\r\n\t\tanimationPlaySpeed: number,\r\n\r\n\t\tconfigScaleX: number\r\n\t\tconfigScaleY: number\r\n\t\tscaleX: number\r\n\t\tscaleY: number\r\n\t\tmaxSizePx: number\r\n\t\tstartPosX : number\r\n\t\tstartPosY : number\r\n\t\t// Specify extra offset in Pixel for X and Y to fit the chibi on the screen\r\n\t\textraOffsetX: number,\r\n\t\textraOffsetY: number,\r\n\r\n\t\tdefaultMovementSpeedPxX: number,\r\n\t\tdefaultMovementSpeedPxY: number,\r\n\t\tdefaultMovementSpeedPxZ: number,\r\n\t\tmovementSpeedPxX: number,\r\n\t\tmovementSpeedPxY: number,\r\n\t\tmovementSpeedPxZ: number,\r\n\r\n\t\t// Unused?\r\n\t\tdefaultScaleX?: number\r\n\t\tdefaultScaleY?: number\r\n\r\n\t\t/* Optional: the background image. Default: none. */\r\n\t\tbackgroundImage?: {\r\n\t\t\t/* The URL of the background image */\r\n\t\t\turl: string\r\n\r\n\t\t\t/* Optional: the position and size of the background image in world coordinates. Default: viewport. */\r\n\t\t\tx: number\r\n\t\t\ty: number\r\n\t\t\twidth: number\r\n\t\t\theight: number\r\n\t\t}\r\n\r\n\t\t// /* Optional: the background color used in fullscreen mode. Must be given in the format #rrggbbaa. Default: backgroundColor. */\r\n\t\t// fullScreenBackgroundColor: string\r\n\r\n\t\t// /* Optional: list of bone names that the user can control by dragging. */\r\n\t\t// controlBones: string[]\r\n\r\n\t\t/* Optional: callback when the widget and its assets have been successfully loaded. */\r\n\t\tsuccess?: (widget: SpinePlayer, actor: Actor) => void\r\n\r\n\t\t/* Optional: callback when the widget could not be loaded. */\r\n\t\terror?: (widget: SpinePlayer, actor: Actor, msg: string) => void\r\n\r\n\t\t/** Optional: Callbacks for the animations */\r\n\t\tanimation_listener?: AnimationStateListener\r\n\r\n\t\t/** char_002_amiya, enemy_1526_sfsui, etc */\r\n\t\tchibiId: string,\r\n\t\tuserDisplayName: string,\r\n\r\n\t\t/** Required: action name */\r\n\t\taction: string\r\n\t\t/** Required: A json object of the action data */\r\n\t\taction_data: any\r\n\t}\r\n\r\n\r\n\texport class Actor {\r\n\t\tpublic loaded: boolean;\r\n\t\tpublic skeleton: Skeleton;\r\n\t\tpublic animationState: AnimationState;\r\n\t\tpublic time = new TimeKeeper();\r\n\t\tpublic paused = false;\r\n\t\tpublic playTime = 0;\r\n\t\tpublic speed = 1;\r\n\t\tpublic config: SpineActorConfig;\r\n\t\tpublic lastAnimation: string = null;\r\n\t\t// public animations: string[]\r\n\r\n\t\tpublic viewport: BoundingBox = null;\r\n\t\tpublic animViewport: BoundingBox = null;\r\n\t\tpublic prevAnimViewport: BoundingBox = null;\r\n\t\tpublic defaultBB: BoundingBox = null;\r\n\r\n\t\t// Velocity is in world coordinates (pixels/second)\r\n\t\t// TODO: Abstract out this position/movement/speed data into a seperate class\r\n\t\t// TODO: Create our own vector3 class\r\n\t\tprivate movementSpeed: Vector3 = new Vector3();\r\n\t\t// Position is in world coordinates (with dimensions same as viewport)\r\n\t\t//   x-axis is 0 in center of the screen\r\n\t\t//   and y-axis is 0 at the bottom of the screen.\r\n\t\t// We use these coordinates compared to top-left corner.\r\n\t\tprivate position: Vector3 = new Vector3();\r\n\t\tpublic scale: Vector2 = new Vector2(1,1);\r\n\t\tprivate velocity: Vector3 = new Vector3(0, 0, 0);\r\n\t\tpublic startPosition: Vector2 = null;\r\n\t\tpublic currentAction: ActorAction = null;\r\n\r\n\t\t// Actor loading retry logic\r\n\t\tpublic load_attempts: number = 0;\r\n\t\tpublic max_load_attempts: number = 10;\r\n\t\tpublic load_perma_failed: boolean = false;\r\n\t\t// Record the timestamp when the actor was first loaded. We use this\r\n\t\t// to keep a stable sort order when rendering actors. Actors created\r\n\t\t// first should be rendered first, newer actors are rendered on top.\r\n\t\tpublic loadedWhen: number = new Date().getTime();\r\n\r\n\t\tconstructor(config: SpineActorConfig, viewport: BoundingBox) {\r\n\t\t\tthis.loadedWhen = new Date().getTime();\r\n\t\t\tthis.viewport = viewport;\r\n\t\t\tthis.ResetWithConfig(config);\r\n\t\t\tlet x = Math.random()*viewport.width - (viewport.width/2)\r\n\t\t\tlet z = 0;\r\n\t\t\tthis.position = new Vector3(x, 0, z);\r\n\r\n\t\t\tif (config.startPosX || config.startPosY) {\r\n\t\t\t\tthis.position = new Vector3(\r\n\t\t\t\t\t(config.startPosX* viewport.width) - (viewport.width/2),\r\n\t\t\t\t\tconfig.startPosY * viewport.height,\r\n\t\t\t\t\tz\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic getPosition(): Vector2 {\r\n\t\t\treturn new Vector2(\r\n\t\t\t\tthis.position.x,\r\n\t\t\t\tthis.position.y\r\n\t\t\t);\r\n\t\t}\r\n\t\tpublic getPosition3(): Vector3 {\r\n\t\t\treturn new Vector3(\r\n\t\t\t\tthis.position.x,\r\n\t\t\t\tthis.position.y,\r\n\t\t\t\tthis.position.z\r\n\t\t\t);\r\n\t\t}\r\n\t\tpublic getPositionX(): number {\r\n\t\t\treturn this.position.x;\r\n\t\t}\r\n\t\tpublic getPositionY(): number {\r\n\t\t\treturn this.position.y;\r\n\t\t}\r\n\t\tpublic getPositionZ(): number {\r\n\t\t\treturn this.position.z;\r\n\t\t}\r\n\t\tpublic setPositionX(x: number) {\r\n\t\t\tthis.position.x = x;\r\n\t\t}\r\n\t\tpublic setPositionY(y: number) {\r\n\t\t\tthis.position.y = y;\r\n\t\t}\r\n\t\tpublic setPositionZ(z: number) {\r\n\t\t\tthis.position.z = z;\r\n\t\t}\r\n\t\tpublic setPosition(x: number, y: number, z ?:number) {\r\n\t\t\tthis.position.x = x;\r\n\t\t\tthis.position.y = y;\r\n\t\t\tthis.position.z = z !== undefined ? z : 0;\r\n\t\t}\r\n\r\n\t\tpublic getMovmentSpeed(): Vector2 {\r\n\t\t\treturn new Vector2(\r\n\t\t\t\tthis.movementSpeed.x,\r\n\t\t\t\tthis.movementSpeed.y\r\n\t\t\t);\r\n\t\t}\r\n\t\tpublic getMovmentSpeed3(): Vector3 {\r\n\t\t\treturn new Vector3(\r\n\t\t\t\tthis.movementSpeed.x,\r\n\t\t\t\tthis.movementSpeed.y,\r\n\t\t\t\tthis.movementSpeed.z\r\n\t\t\t);\r\n\t\t}\r\n\t\tpublic getMovementSpeedX(): number {\r\n\t\t\treturn this.movementSpeed.x;\r\n\t\t}\r\n\t\tpublic getMovementSpeedY(): number {\r\n\t\t\treturn this.movementSpeed.y;\r\n\t\t}\r\n\t\tpublic getMovementSpeedZ(): number {\r\n\t\t\treturn this.movementSpeed.z;\r\n\t\t}\r\n\t\tpublic setMovementSpeedX(x: number) {\r\n\t\t\tthis.movementSpeed.x = x;\r\n\t\t}\r\n\t\tpublic setMovementSpeedY(y: number) {\r\n\t\t\tthis.movementSpeed.y = y;\r\n\t\t}\r\n\t\tpublic setMovementSpeedZ(z: number) {\r\n\t\t\tthis.movementSpeed.z = z;\r\n\t\t}\r\n\t\tpublic setMovementSpeed(x: number, y: number, z ?: number) {\t\t\t\r\n\t\t\tthis.movementSpeed.x = x;\r\n\t\t\tthis.movementSpeed.y = y;\r\n\t\t\tthis.movementSpeed.z = z !== undefined ? z : this.config.defaultMovementSpeedPxZ;\r\n\t\t}\r\n\r\n\t\tpublic getVelocity(): Vector2 {\r\n\t\t\treturn new Vector2(\r\n\t\t\t\tthis.velocity.x,\r\n\t\t\t\tthis.velocity.y\r\n\t\t\t)\r\n\t\t}\r\n\t\tpublic getVelocity3(): Vector3 {\r\n\t\t\treturn new Vector3(\r\n\t\t\t\tthis.velocity.x,\r\n\t\t\t\tthis.velocity.y,\r\n\t\t\t\tthis.velocity.z\r\n\t\t\t)\r\n\t\t}\r\n\t\tpublic setVelocity(x?: number, y ?: number, z ?: number) {\r\n\t\t\tthis.velocity = new Vector3(\r\n\t\t\t\tx != undefined ? x : this.velocity.x,\r\n\t\t\t\ty != undefined ? y : this.velocity.y,\r\n\t\t\t\tz != undefined ? z : this.velocity.z\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tpublic InitAnimations() {\r\n\t\t\tthis.initAnimationsInternal(this.currentAction.GetAnimations());\r\n\t\t}\r\n\r\n\t\tpublic GetAnimations(): string[] {\r\n\t\t\treturn this.currentAction.GetAnimations()\r\n\t\t}\r\n\r\n\t\tpublic ResetWithConfig(config: SpineActorConfig) {\r\n\t\t\tthis.load_attempts = 0;\r\n\t\t\tthis.load_perma_failed = false;\r\n\r\n\t\t\tthis.loaded = false;\r\n\t\t\tthis.skeleton = null;\r\n\t\t\tthis.animationState = null;\r\n\t\t\tthis.time = new TimeKeeper();\r\n\t\t\tthis.paused = false;\r\n\t\t\tthis.playTime = 0;\r\n\t\t\tthis.speed = 1;\r\n\t\t\tthis.config = config;\r\n\r\n\t\t\tthis.animViewport = null;\r\n\t\t\tthis.prevAnimViewport = null;\r\n\t\t\tthis.defaultBB = null;\r\n\r\n\t\t\t// Update movement speed from config\r\n\t\t\tif (config.movementSpeedPxX !== null \r\n\t\t\t\t&& config.movementSpeedPxY !== null\r\n\t\t\t\t&& config.movementSpeedPxZ !== null) {\r\n\t\t\t\tthis.movementSpeed = new Vector3(\r\n\t\t\t\t\tconfig.movementSpeedPxX, \r\n\t\t\t\t\tconfig.movementSpeedPxY,\r\n\t\t\t\t\tconfig.movementSpeedPxZ,\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthis.movementSpeed = new Vector3(\r\n\t\t\t\t\tconfig.defaultMovementSpeedPxX + Math.random()*config.defaultMovementSpeedPxX/2,\r\n\t\t\t\t\tconfig.defaultMovementSpeedPxY,\r\n\t\t\t\t\tconfig.defaultMovementSpeedPxZ,\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// current bearing should be kept the same, event as we change\r\n\t\t\t// the configuration/animation\r\n\t\t\tthis.scale.x = Math.sign(this.scale.x) * config.scaleX;\r\n\t\t\tthis.scale.y = Math.sign(this.scale.y) * config.scaleY;\r\n\r\n\t\t\tthis.currentAction = ParseActionNameToAction(\r\n\t\t\t\tthis.config.action,\r\n\t\t\t\tthis.config.action_data\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tpublic UpdatePhysics(deltaSecs: number, viewport: BoundingBox) {\r\n\t\t\tthis.currentAction.UpdatePhysics(this, deltaSecs, viewport);\r\n\t\t\tthis.position.x += this.velocity.x;\r\n\t\t\tthis.position.y += this.velocity.y;\r\n\t\t\tthis.position.z += this.velocity.z;\r\n\r\n\t\t\t// Make the Actor face right or left depending on velocity\r\n\t\t\tif (this.velocity.x != 0) {\r\n\t\t\t\tif (this.velocity.x > 0) {\r\n\t\t\t\t\tthis.scale.x = this.config.scaleX;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.scale.x = -this.config.scaleX;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.setSkeletonMovementData(viewport);\r\n\t\t}\r\n\r\n\t\tpublic InitAnimationState() {\r\n\t\t\tlet skeletonData = this.skeleton.data;\r\n\t\t\tlet stateData = new AnimationStateData(skeletonData);\r\n\t\t\tstateData.defaultMix = this.config.defaultMix;\r\n\t\t\tthis.animationState = new AnimationState(stateData);\r\n\t\t\tif (this.config.animation_listener) {\r\n\t\t\t\tthis.animationState.clearListeners();\r\n\t\t\t\tthis.animationState.addListener(this.config.animation_listener);\r\n\t\t\t}\r\n\t\t\tif(this.GetAnimations()) {\r\n\t\t\t\t// TODO: Verify all the animations are found in the skeleton data\r\n\t\t\t\tif (this.animationState) {\r\n\t\t\t\t\tif (!this.animationState.getCurrent(0)) {\r\n\t\t\t\t\t\tthis.InitAnimations();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic GetUsernameHeaderHeight() {\r\n\t\t\t// let avg_width = (51.620900749705015 * this.config.scaleX) / 0.15;\r\n\t\t\t// let avg_height = (60.99747806746469 * this.config.scaleY) / 0.15;\r\n\t\t\tlet finalHeight = 0;\r\n\t\t\tif (this.config.chibiId.includes(\"enemy_\")) {\r\n\t\t\t\tfinalHeight = this.defaultBB.height;\r\n\t\t\t} else {\r\n\t\t\t\t// HACK: Sometimes the chibi bounding box is too big and\r\n\t\t\t\t// doesn't reasonablly fit the chibi. In order to make\r\n\t\t\t\t// sure the name tags are placed at a reasonable height to\r\n\t\t\t\t// the sprite we use a heuristic which was empiracally found\r\n\t\t\t\t// based off the average height of all the operator chibis.\r\n\t\t\t\tlet avg_height = (70.0 * this.config.scaleY) / 0.15;\r\n\t\t\t\tlet height = this.defaultBB.height;\r\n\t\t\t\tif (height > avg_height) {\r\n\t\t\t\t\tfinalHeight =  avg_height;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfinalHeight =  height;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn finalHeight + Math.abs(this.config.extraOffsetY);\r\n\t\t}\r\n\r\n\t\t// Privates\r\n\t\t// ---------------------------------------------------------------------\r\n\r\n\t\tprivate setSkeletonMovementData(viewport: BoundingBox) {\r\n\t\t\tthis.skeleton.x = this.position.x + this.config.extraOffsetX;\r\n\t\t\tthis.skeleton.y = this.position.y + this.config.extraOffsetY;\r\n\t\t\tthis.skeleton.scaleX = this.scale.x;\r\n\t\t\tthis.skeleton.scaleY = this.scale.y;\r\n\t\t}\r\n\r\n\t\tprivate recordAnimation(animation: string) {\r\n\t\t\tthis.currentAction.SetAnimation(this, animation, this.viewport);\r\n\t\t\tthis.lastAnimation = animation;\r\n\t\t}\r\n\r\n\t\tprivate initAnimationsInternal(animations: string[]) {\r\n\t\t\tthis.setAnimationState(animations);\r\n\t\t\tthis.recordAnimation(animations[0]);\r\n\t\t\t\t\t\t\r\n\t\t\t// Resize very large chibis to more reasonable sizes\r\n\t\t\tlet width = this.defaultBB.width;\r\n\t\t\tlet height = this.defaultBB.height;\r\n\t\t\tlet maxSize = Math.sqrt(width*width + height*height);\r\n\t\t\t// if (height > maxSize) {\r\n\t\t\t// \tmaxSize = height;\r\n\t\t\t// }\r\n\t\t\tif (maxSize > this.config.maxSizePx && this.config.chibiId.includes(\"enemy_\")) {\r\n\t\t\t\tconsole.log(\"Resizing actor to \" + this.config.maxSizePx);\r\n\t\t\t\tlet ratio = width / height;\r\n\r\n\t\t\t\tlet xNew = 0;\r\n\t\t\t\tlet yNew = 0;\r\n\t\t\t\tif (height > width) {\r\n\t\t\t\t\txNew = ratio * this.config.maxSizePx;\r\n\t\t\t\t\tyNew = this.config.maxSizePx;\r\n\t\t\t\t} else {\r\n\t\t\t\t\txNew = this.config.maxSizePx;\r\n\t\t\t\t\tyNew = this.config.maxSizePx / ratio;\r\n\t\t\t\t}\r\n\t\t\t\tlet newScaleX = (xNew * this.config.scaleX) / width;\r\n\t\t\t\tlet newScaleY = (yNew * this.config.scaleY) / height;\r\n\r\n\t\t\t\t// TODO: setting defaultScale is a bug. We need to save it only once\r\n\t\t\t\tthis.config.defaultScaleX = this.config.scaleX;\r\n\t\t\t\tthis.config.defaultScaleY = this.config.scaleY;\r\n\t\t\t\tthis.config.scaleX = newScaleX;\r\n\t\t\t\tthis.config.scaleY = newScaleY;\r\n\t\t\t\tthis.scale.x = Math.sign(this.scale.x) * this.config.scaleX;\r\n\t\t\t\tthis.scale.y = Math.sign(this.scale.y) * this.config.scaleY;\r\n\r\n\t\t\t\tthis.setAnimationState(animations);\r\n\t\t\t\tthis.recordAnimation(animations[0]);\r\n\t\t\t\t// this.startAnimCallback(actor, animations[0]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate setAnimationState(animations: string[]) {\r\n\t\t\tlet animation = animations[0];\r\n\t\t\t// Determine viewport\r\n\t\t\tthis.animViewport = this.calculateAnimationViewport(animation);\r\n\t\t\tthis.defaultBB = this.getDefaultBoundingBox();\r\n\t\t\tthis.animationState.timeScale = this.config.animationPlaySpeed;\r\n\t\t\tthis.animationState.clearTracks();\r\n\t\t\tthis.skeleton.setToSetupPose();\r\n\t\t\t\r\n\t\t\tthis.animationState.setAnimation(0, animation, true);\r\n\t\t\tlet lastTrackEntry = null;\r\n\t\t\tfor (let i = 1; i < animations.length; i++) {\r\n\t\t\t\tlastTrackEntry = this.animationState.addAnimation(0, animations[i], false, 0);\r\n\t\t\t}\r\n\r\n\t\t\tif (lastTrackEntry) {\r\n\t\t\t\tthis.animationState.addListener({\r\n\t\t\t\t\tstart: (\r\n\t\t\t\t\t\t(trackEntry: TrackEntry) => {\r\n\t\t\t\t\t\t\tthis.recordAnimation(trackEntry.animation.name,)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t).bind(this),\r\n\t\t\t\t\tinterrupt: function (trackEntry) { },\r\n\t\t\t\t\tend: function (trackEntry) {},\r\n\t\t\t\t\tcomplete: (\r\n\t\t\t\t\t\t(trackEntry: TrackEntry) => { \r\n\t\t\t\t\t\t\t// Loop through all the animations\r\n\t\t\t\t\t\t\tif (trackEntry.next == null) {\r\n\t\t\t\t\t\t\t\tthis.animationState.setAnimation(0, animation, true);\r\n\t\t\t\t\t\t\t\tfor (let i = 1; i < animations.length; i++) {\r\n\t\t\t\t\t\t\t\t\tlastTrackEntry = this.animationState.addAnimation(0, animations[i], false, 0);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t).bind(this),\r\n\t\t\t\t\tdispose: function (trackEntry) {},\r\n\t\t\t\t\tevent: function (entry: TrackEntry, event: Event): void {}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate getDefaultBoundingBox() {\r\n\t\t\tlet animations = this.skeleton.data.animations;\r\n\r\n\t\t\tlet offsetAvg = new Vector2();\r\n\t\t\tlet sizeAvg = new Vector2();\r\n\t\t\tlet num_processed = 0;\r\n\t\t\tfor (let i = 0, n = animations.length; i < n; i++) {\r\n\t\t\t\tlet animationName = animations[i].name;\r\n\t\t\t\t// if (!animationName.toLocaleLowerCase().includes(\"default\")) {\r\n\t\t\t\t// \tcontinue;\r\n\t\t\t\t// }\r\n\t\t\t\tlet animation = this.skeleton.data.findAnimation(animationName);\r\n\t\t\t\tthis.animationState.clearTracks();\r\n\t\t\t\tthis.skeleton.setToSetupPose()\r\n\t\t\t\tthis.animationState.setAnimationWith(0, animation, true);\r\n\r\n\t\t\t\tlet savedX = this.skeleton.x;\r\n\t\t\t\tlet savedY = this.skeleton.y;\r\n\t\t\t\tthis.skeleton.x = 0;\r\n\t\t\t\tthis.skeleton.y = 0;\r\n\t\t\t\tthis.skeleton.scaleX = Math.abs(this.config.scaleX);\r\n\t\t\t\tthis.skeleton.scaleY = Math.abs(this.config.scaleY);\r\n\t\t\t\tthis.animationState.update(0);\r\n\t\t\t\tthis.animationState.apply(this.skeleton);\r\n\t\t\t\tthis.skeleton.updateWorldTransform();\r\n\t\t\t\tlet offset = new Vector2();\r\n\t\t\t\tlet size = new Vector2();\r\n\t\t\t\tthis.skeleton.getBounds(offset, size);\r\n\r\n\t\t\t\tthis.skeleton.x = savedX;\r\n\t\t\t\tthis.skeleton.y = savedY;\r\n\r\n\t\t\t\tif (Number.isFinite(offset.x) && Number.isFinite(offset.y) && Number.isFinite(size.x) && Number.isFinite(size.y)) {\r\n\t\t\t\t\tnum_processed += 1;\r\n\t\t\t\t\toffsetAvg.x += offset.x;\r\n\t\t\t\t\toffsetAvg.y += offset.y;\r\n\t\t\t\t\tsizeAvg.x += size.x;\r\n\t\t\t\t\tsizeAvg.y += size.y;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\toffsetAvg.x /= num_processed;\r\n\t\t\toffsetAvg.y /= num_processed;\r\n\t\t\tsizeAvg.x /= num_processed;\r\n\t\t\tsizeAvg.y /= num_processed;\r\n\r\n\t\t\t// this.average_width += sizeAvg.x;\r\n\t\t\t// this.average_height += sizeAvg.y;\r\n\t\t\t// this.average_count += 1;\r\n\r\n\t\t\tlet ret = {\r\n\t\t\t\tx: offsetAvg.x,\r\n\t\t\t\ty: offsetAvg.y,\r\n\t\t\t\twidth: sizeAvg.x,\r\n\t\t\t\theight: sizeAvg.y\r\n\t\t\t}\r\n\r\n\t\t\t// HACK: \r\n\t\t\t// For enemies whose y bounding box is too far from the bottom\r\n\t\t\t// We add an offset so that it is rendered where we want it\r\n\t\t\tif (this.config.chibiId.includes(\"enemy_\")) {\r\n\t\t\t\tif (ret.y < -15) {\r\n\t\t\t\t\tthis.config.extraOffsetY = -ret.y;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\r\n\t\tprivate calculateAnimationViewport (animationName: string) {\r\n\t\t\tlet animation = this.skeleton.data.findAnimation(animationName);\r\n\t\t\tthis.animationState.clearTracks();\r\n\t\t\tthis.skeleton.setToSetupPose()\r\n\t\t\tthis.animationState.setAnimationWith(0, animation, true);\r\n\r\n\t\t\tlet steps = 100;\r\n\t\t\tlet stepTime = animation.duration > 0 ? animation.duration / steps : 0;\r\n\t\t\tlet minX = 100000000;\r\n\t\t\tlet maxX = -100000000;\r\n\t\t\tlet minY = 100000000;\r\n\t\t\tlet maxY = -100000000;\r\n\t\t\tlet offset = new Vector2();\r\n\t\t\tlet size = new Vector2();\r\n\r\n\t\t\tlet savedX = this.skeleton.x;\r\n\t\t\tlet savedY = this.skeleton.y;\r\n\t\t\tfor (var i = 0; i < steps; i++) {\r\n\t\t\t\tthis.animationState.update(stepTime);\r\n\t\t\t\tthis.animationState.apply(this.skeleton);\r\n\r\n\t\t\t\t// TODO: Fix this hack\r\n\t\t\t\t// this.SetSkeletonMovementData(this.playerConfig.viewport);\r\n\t\t\t\tthis.skeleton.x = 0;\r\n\t\t\t\tthis.skeleton.y = 0;\r\n\t\t\t\tthis.skeleton.scaleX = Math.abs(this.config.scaleX);\r\n\t\t\t\tthis.skeleton.scaleY = Math.abs(this.config.scaleY);\r\n\t\t\t\tthis.skeleton.updateWorldTransform();\r\n\t\t\t\tthis.skeleton.getBounds(offset, size);\r\n\r\n\t\t\t\tminX = Math.min(offset.x, minX);\r\n\t\t\t\tmaxX = Math.max(offset.x + size.x, maxX);\r\n\t\t\t\tminY = Math.min(offset.y, minY);\r\n\t\t\t\tmaxY = Math.max(offset.y + size.y, maxY);\r\n\t\t\t}\r\n\r\n\t\t\tthis.skeleton.x = savedX;\r\n\t\t\tthis.skeleton.y = savedY;\r\n\r\n\t\t\toffset.x = minX;\r\n\t\t\toffset.y = minY;\r\n\t\t\tsize.x = maxX - minX;\r\n\t\t\tsize.y = maxY - minY;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tx: offset.x,\r\n\t\t\t\ty: offset.y,\r\n\t\t\t\twidth: size.x,\r\n\t\t\t\theight: size.y\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n//  }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport {AssetManager } from \"../webgl/AssetManager\";\r\nimport { AtlasAttachmentLoader } from \"../core/AtlasAttachmentLoader\"\r\nimport { Skeleton } from \"../core/Skeleton\"\r\nimport { SkeletonBinary } from \"../core/SkeletonBinary\"\r\nimport { SkeletonData } from \"../core/SkeletonData\"\r\nimport { SkeletonJson } from \"../core/SkeletonJson\"\r\nimport { Vector2, Color } from \"../core/Utils\"\r\nimport { PerspectiveCamera } from \"../webgl/Camera\"\r\nimport { Input } from \"../webgl/Input\"\r\nimport { LoadingScreen } from \"../webgl/LoadingScreen\"\r\nimport { M00 } from \"../webgl/Matrix4\"\r\nimport { ResizeMode, SceneRenderer } from \"../webgl/SceneRenderer\"\r\nimport { Vector3 } from \"../webgl/Vector3\"\r\nimport { ManagedWebGLRenderingContext } from \"../webgl/WebGL\"\r\nimport { Actor, SpineActorConfig } from \"./Actor\"\r\n\r\n// // module spine {\r\n\texport interface Viewport {\r\n\t\tx: number,\r\n\t\ty: number,\r\n\t\twidth: number,\r\n\t\theight: number,\r\n\t\tpadLeft: string | number\r\n\t\tpadRight: string | number\r\n\t\tpadTop: string | number\r\n\t\tpadBottom: string | number\r\n\t\tdebugRender: boolean\r\n\t}\r\n\r\n\texport interface BoundingBox {\r\n\t\tx: number,\r\n\t\ty: number,\r\n\t\twidth: number,\r\n\t\theight: number,\r\n\t}\r\n\r\n\texport interface SpinePlayerConfig {\r\n\t\t/* Optional: whether to show the player controls. Default: true. */\r\n\t\tshowControls: boolean\r\n\r\n\t\t/* Optional: the position and size of the viewport in world coordinates of the skeleton. Default: the setup pose bounding box. */\r\n\t\tviewport: Viewport\r\n\r\n\t\t/* Optional: whether the canvas should be transparent. Default: false. */\r\n\t\talpha: boolean\r\n\r\n\t\t/* Optional: the background color. Must be given in the format #rrggbbaa. Default: #000000ff. */\r\n\t\tbackgroundColor: string\r\n\r\n\t\ttextSize: number,\r\n\t\ttextFont: string,\r\n\r\n\t\t/* Optional: the background image. Default: none. */\r\n\t\tbackgroundImage: {\r\n\t\t\t/* The URL of the background image */\r\n\t\t\turl: string\r\n\r\n\t\t\t/* Optional: the position and size of the background image in world coordinates. Default: viewport. */\r\n\t\t\tx: number\r\n\t\t\ty: number\r\n\t\t\twidth: number\r\n\t\t\theight: number\r\n\t\t} | undefined\r\n\r\n\t\t/* Optional: the background color used in fullscreen mode. Must be given in the format #rrggbbaa. Default: backgroundColor. */\r\n\t\tfullScreenBackgroundColor: string | undefined\r\n\r\n\t\t/** Optional: \r\n\t\t *  How often to send back runtime debug information to the server.\r\n\t\t *  This is to help debug performance issues. Default: 60 seconds.\r\n\t\t */\r\n\t\truntimeDebugInfoDumpIntervalSec: number\r\n\r\n\t\t// Camera Near and Far customization\r\n\t\tcameraPerspectiveNear: number\r\n\t\tcameraPerspectiveFar: number\r\n\t}\r\n\r\n\tclass Slider {\r\n\t\tprivate slider: HTMLElement;\r\n\t\tprivate value: HTMLElement;\r\n\t\tprivate knob: HTMLElement;\r\n\t\tpublic change: (percentage: number) => void;\r\n\r\n\t\tconstructor(public snaps = 0, public snapPercentage = 0.1, public big = false) {}\r\n\r\n\t\trender(): HTMLElement {\r\n\t\t\tthis.slider = createElement(/*html*/`\r\n\t\t\t\t<div class=\"spine-player-slider ${this.big ? \"big\": \"\"}\">\r\n\t\t\t\t\t<div class=\"spine-player-slider-value\"></div>\r\n\t\t\t\t\t<!--<div class=\"spine-player-slider-knob\"></div>-->\r\n\t\t\t\t</div>\r\n\t\t\t`);\r\n\t\t\tthis.value = findWithClass(this.slider, \"spine-player-slider-value\")[0];\r\n\t\t\t// this.knob = findWithClass(this.slider, \"spine-player-slider-knob\")[0];\r\n\t\t\tthis.setValue(0);\r\n\r\n\t\t\tlet input = new Input(this.slider);\r\n\t\t\tvar dragging = false;\r\n\t\t\tinput.addListener({\r\n\t\t\t\tdown: (x, y) => {\r\n\t\t\t\t\tdragging = true;\r\n\t\t\t\t\tthis.value.classList.add(\"hovering\");\r\n\t\t\t\t},\r\n\t\t\t\tup: (x, y) => {\r\n\t\t\t\t\tdragging = false;\r\n\t\t\t\t\tlet percentage = x / this.slider.clientWidth;\r\n\t\t\t\t\tpercentage = percentage = Math.max(0, Math.min(percentage, 1));\r\n\t\t\t\t\tthis.setValue(x / this.slider.clientWidth);\r\n\t\t\t\t\tif (this.change) this.change(percentage);\r\n\t\t\t\t\tthis.value.classList.remove(\"hovering\");\r\n\t\t\t\t},\r\n\t\t\t\tmoved: (x, y) => {\r\n\t\t\t\t\tif (dragging) {\r\n\t\t\t\t\t\tlet percentage = x / this.slider.clientWidth;\r\n\t\t\t\t\t\tpercentage = Math.max(0, Math.min(percentage, 1));\r\n\t\t\t\t\t\tpercentage = this.setValue(x / this.slider.clientWidth);\r\n\t\t\t\t\t\tif (this.change) this.change(percentage);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tdragged: (x, y) => {\r\n\t\t\t\t\tlet percentage = x / this.slider.clientWidth;\r\n\t\t\t\t\tpercentage = Math.max(0, Math.min(percentage, 1));\r\n\t\t\t\t\tpercentage = this.setValue(x / this.slider.clientWidth);\r\n\t\t\t\t\tif (this.change) this.change(percentage);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\r\n\t\t\treturn this.slider;\r\n\t\t}\r\n\r\n\t\tsetValue(percentage: number): number {\r\n\t\t\tpercentage = Math.max(0, Math.min(1, percentage));\r\n\t\t\tif (this.snaps > 0) {\r\n\t\t\t\tlet modulo = percentage % (1 / this.snaps);\r\n\t\t\t\t// floor\r\n\t\t\t\tif (modulo < (1 / this.snaps) * this.snapPercentage) {\r\n\t\t\t\t\tpercentage = percentage - modulo;\r\n\t\t\t\t} else if (modulo > (1 / this.snaps) - (1 / this.snaps) * this.snapPercentage) {\r\n\t\t\t\t\tpercentage = percentage - modulo + (1 / this.snaps);\r\n\t\t\t\t}\r\n\t\t\t\tpercentage = Math.max(0, Math.min(1, percentage));\r\n\t\t\t}\r\n\t\t\tthis.value.style.width = \"\" + (percentage * 100) + \"%\";\r\n\t\t\t// this.knob.style.left = \"\" + (-8 + percentage * this.slider.clientWidth) + \"px\";\r\n\t\t\treturn percentage;\r\n\t\t}\r\n\t}\r\n\r\n\ttype RenderCallbackFn = (context: ManagedWebGLRenderingContext) => void;\r\n\ttype RemoveCallbackFn = () => void;\r\n\r\n\texport class SpinePlayer {\r\n\t\tstatic HOVER_COLOR_INNER = new Color(0.478, 0, 0, 0.25);\r\n\t\tstatic HOVER_COLOR_OUTER = new Color(1, 1, 1, 1);\r\n\t\tstatic NON_HOVER_COLOR_INNER = new Color(0.478, 0, 0, 0.5);\r\n\t\tstatic NON_HOVER_COLOR_OUTER = new Color(1, 0, 0, 0.8);\r\n\r\n\t\t// private average_width = 0;\r\n\t\t// private average_height = 0;\r\n\t\t// private average_count = 0;\r\n\r\n\t\tprivate sceneRenderer: SceneRenderer;\r\n\t\tprivate dom: HTMLElement;\r\n\t\tprivate playerControls: HTMLElement;\r\n\t\tprivate canvas: HTMLCanvasElement;\r\n\t\tprivate textCanvas: HTMLCanvasElement;\r\n\t\tprivate textCanvasContext: CanvasRenderingContext2D;\r\n\t\tprivate timelineSlider: Slider;\r\n\t\tprivate playButton: HTMLElement;\r\n\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate loadingScreen: LoadingScreen;\r\n\t\tprivate assetManager: AssetManager;\r\n\r\n\t\tprivate paused = false;\r\n\t\tprivate actors = new Map<string, Actor>();\r\n\t\tprivate playerConfig: SpinePlayerConfig = null;\r\n\t\t\r\n\t\tprivate parent: HTMLElement;\r\n\r\n\t\tprivate stopRequestAnimationFrame = false;\r\n\t\tprivate lastRequestAnimationFrameId = 0;\r\n\t\tprivate windowFpsFrameCount:number = 0;\r\n\t\tprivate webSocket: WebSocket = null;\r\n\t\tprivate renderCallbacks: RenderCallbackFn[] = [];\r\n\r\n\t\tconstructor(parent: HTMLElement | string, playerConfig: SpinePlayerConfig) {\r\n\t\t\tif (typeof parent === \"string\") {\r\n\t\t\t\tthis.parent = document.getElementById(parent);\r\n\t\t\t} else  {\r\n\t\t\t\tthis.parent = parent;\r\n\t\t\t}\r\n\t\t\t// this.playerConfig = null;\r\n\t\t\tthis.playerConfig = this.validatePlayerConfig(playerConfig);\r\n\t\t\tthis.parent.appendChild(this.setupDom());\r\n\t\t}\r\n\r\n\t\tsetWebsocket(webSocket: WebSocket) {\r\n\t\t\tthis.webSocket = webSocket;\r\n\t\t}\r\n\r\n\t\tvalidatePlayerConfig(config: SpinePlayerConfig): SpinePlayerConfig {\r\n\t\t\tif (!config) throw new Error(\"Please pass a configuration to new.SpinePlayer().\");\r\n\t\t\tif (!config.alpha) config.alpha = false;\r\n\t\t\tif (!config.backgroundColor) config.backgroundColor = \"#000000\";\r\n\t\t\tif (!config.fullScreenBackgroundColor) config.fullScreenBackgroundColor = config.backgroundColor;\r\n\t\t\tif (typeof config.showControls === \"undefined\")\r\n\t\t\t\tconfig.showControls = true;\r\n\t\t\tif (!config.runtimeDebugInfoDumpIntervalSec) config.runtimeDebugInfoDumpIntervalSec = 60;\r\n\t\t\tif (!config.textSize) config.textSize = 14;\r\n\t\t\tif (!config.textFont) config.textFont = \"lato\";\r\n\t\t\tif (!config.cameraPerspectiveNear) config.cameraPerspectiveNear = 1.0;\r\n\t\t\tif (!config.cameraPerspectiveFar) config.cameraPerspectiveFar = 1000.0;\r\n\t\t\treturn config;\r\n\t\t}\r\n\r\n\t\tvalidateActorConfig(config: SpineActorConfig): SpineActorConfig {\r\n\t\t\tif (!config) throw new Error(\"Please pass a configuration to new.SpinePlayer().\");\r\n\t\t\tif (!config.jsonUrl && !config.skelUrl) throw new Error(\"Please specify the URL of the skeleton JSON or .skel file.\");\r\n\t\t\tif (!config.atlasUrl) throw new Error(\"Please specify the URL of the atlas file.\");\r\n\t\t\t// if (!config.alpha) config.alpha = false;\r\n\t\t\t// if (!config.backgroundColor) config.backgroundColor = \"#000000\";\r\n\t\t\t// if (!config.fullScreenBackgroundColor) config.fullScreenBackgroundColor = config.backgroundColor;\r\n\t\t\tif (typeof config.premultipliedAlpha === \"undefined\") config.premultipliedAlpha = true;\r\n\t\t\tif (!config.scaleX) config.scaleX = 1;\r\n\t\t\tif (!config.scaleY) config.scaleY = 1;\r\n\t\t\tif (!config.extraOffsetX) config.extraOffsetX = 0;\r\n\t\t\tif (!config.extraOffsetY) config.extraOffsetY = 0;\r\n\t\t\tif (!config.success) config.success = (widget, actor) => {};\r\n\t\t\tif (!config.error) config.error = (widget, actor, msg) => {};\r\n\t\t\tif (!config.animation_listener) {\r\n\t\t\t\tconfig.animation_listener = {\r\n\t\t\t\t\tevent: function(trackIndex, event) {\r\n\t\t\t\t\t\t// console.log(\"Event on track \" + trackIndex + \": \" + JSON.stringify(event));\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: function(trackIndex) {\r\n\t\t\t\t\t\t// console.log(\"Animation on track \" + trackIndex + \" completed\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstart: function(trackIndex) {\r\n\t\t\t\t\t\t// console.log(\"Animation on track \" + trackIndex + \" started\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tend: function(trackIndex) {\r\n\t\t\t\t\t\t// console.log(\"Animation on track \" + trackIndex + \" ended\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tinterrupt: function(trackIndex) {\r\n\t\t\t\t\t\t// console.log(\"Animation on track \" + trackIndex + \" ended\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdispose: function(trackIndex) {\r\n\t\t\t\t\t\t// console.log(\"Animation on track \" + trackIndex + \" ended\");\r\n\t\t\t\t\t},\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (config.skins && config.skin) {\r\n\t\t\t\tif (config.skins.indexOf(config.skin) < 0) {\r\n\t\t\t\t\tthrow new Error(\"Default skin '\" + \r\n\t\t\t\t\t\tconfig.skin + \r\n\t\t\t\t\t\t\"' is not contained in the list of selectable skins \" + \r\n\t\t\t\t\t\tescapeHtml(JSON.stringify(config.skins)) + \r\n\t\t\t\t\t\t\".\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (typeof config.defaultMix === \"undefined\")\r\n\t\t\t\tconfig.defaultMix = 0.25;\r\n\r\n\t\t\tif (config.configScaleX == undefined) {config.configScaleX = 1.0;}\r\n\t\t\tif (config.configScaleY == undefined) {config.configScaleY = 1.0;}\r\n\t\t\tif (config.scaleX == undefined) {config.scaleX = 0.45;}\r\n\t\t\tif (config.scaleY == undefined) {config.scaleY = 0.45;}\r\n\t\t\tif (config.maxSizePx == undefined) {config.maxSizePx = 350;}\r\n\t\t\tif (config.startPosX == undefined) {config.startPosX = null;}\r\n\t\t\tif (config.startPosY == undefined) {config.startPosY = null;}\r\n\t\t\tif (config.extraOffsetX == undefined) {config.extraOffsetX = 0;}\r\n\t\t\tif (config.extraOffsetY == undefined) {config.extraOffsetY = 0;}\r\n\t\t\tif (config.defaultMovementSpeedPxX == undefined) {config.defaultMovementSpeedPxX = 80;}\r\n\t\t\tif (config.defaultMovementSpeedPxY == undefined) {config.defaultMovementSpeedPxY = 80;}\r\n\t\t\tif (config.defaultMovementSpeedPxZ == undefined) {config.defaultMovementSpeedPxZ = 80;}\r\n\t\t\tif (config.movementSpeedPxX == undefined) {config.movementSpeedPxX = null;}\r\n\t\t\tif (config.movementSpeedPxY == undefined) {config.movementSpeedPxY = null;}\r\n\t\t\tif (config.movementSpeedPxZ == undefined) {config.movementSpeedPxZ = config.defaultMovementSpeedPxZ;}\r\n\r\n\t\t\tif (config.chibiId == undefined) {config.chibiId = crypto.randomUUID();}\r\n\t\t\tif (config.userDisplayName == undefined) {config.userDisplayName = crypto.randomUUID();}\r\n\t\t\tif (!isAlphanumeric(config.chibiId)) {\r\n\t\t\t\tthrow Error(\"ChibiId is not valid\");\r\n\t\t\t}\r\n\t\t\tif (!isAlphanumeric(config.userDisplayName)) {\r\n\t\t\t\tthrow Error(\"userDisplayName is not valid\");\r\n\t\t\t}\r\n\t\t\tif (config.action == undefined) {\r\n\t\t\t\tthrow Error(\"config.action must be set\");\r\n\t\t\t}\r\n\r\n\t\t\treturn config;\r\n\t\t}\r\n\r\n\t\tshowError(actor: Actor, error: string) {\r\n\t\t\tlet errorDom = findWithClass(this.dom, \"spine-player-error\")[0];\r\n\t\t\terrorDom.classList.remove(\"spine-player-hidden\");\r\n\t\t\terrorDom.innerHTML = `<p style=\"text-align: center; align-self: center;\">${error}</p>`;\r\n\r\n\t\t\t// this.playerConfig.error(this, error);\r\n\t\t\tactor.config.error(this, actor, error);\r\n\t\t}\r\n\r\n\t\thideError() {\r\n\t\t\tlet errorDom = findWithClass(this.dom, \"spine-player-error\")[0];\r\n\t\t\terrorDom.classList.add(\"spine-player-hidden\");\r\n\t\t}\r\n\r\n\t\tsetupDom(): HTMLElement {\r\n\t\t\tlet dom = this.dom = createElement(/*html*/`\r\n\t\t\t\t<div class=\"spine-player\">\r\n\t\t\t\t\t<div class=\"spine-player-error spine-player-hidden\"></div>\r\n\t\t\t\t\t<canvas id=\"spine-canvas\" class=\"spine-player-canvas\"></canvas>\r\n\t\t\t\t\t<canvas id=\"spine-text\" class=\"spine-player-text-canvas\"></canvas>\r\n\t\t\t\t\t<div class=\"spine-player-controls spine-player-popup-parent spine-player-controls-hidden\">\r\n\t\t\t\t\t\t<div class=\"spine-player-timeline\">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"spine-player-buttons\">\r\n\t\t\t\t\t\t\t<button id=\"spine-player-button-play-pause\" class=\"spine-player-button spine-player-button-icon-pause\"></button>\r\n\t\t\t\t\t\t\t<div class=\"spine-player-button-spacer\"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t`)\r\n\r\n\t\t\ttry {\r\n\t\t\t\t// Setup the scene renderer and OpenGL context\r\n\t\t\t\t// this.canvas = findWithClass(dom, \"spine-player-canvas\")[0] as HTMLCanvasElement;\r\n\t\t\t\tthis.canvas = findWithId(dom, \"spine-canvas\")[0] as HTMLCanvasElement;\r\n\t\t\t\tthis.textCanvas = findWithId(dom, \"spine-text\")[0] as HTMLCanvasElement;\r\n\t\t\t\tthis.textCanvasContext = this.textCanvas.getContext(\"2d\");\r\n\t\t\t\t// var webglConfig = { alpha: config.alpha };\r\n\t\t\t\tvar webglConfig = { alpha: this.playerConfig.alpha};\r\n\t\t\t\tthis.context = new ManagedWebGLRenderingContext(this.canvas, webglConfig);\r\n\t\t\t\t// Setup the scene renderer and loading screen\r\n\t\t\t\tthis.sceneRenderer = new SceneRenderer(this.canvas, this.context, true);\r\n\t\t\t\tthis.loadingScreen = new LoadingScreen(this.sceneRenderer);\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// this.showError(\"Sorry, your browser does not support WebGL.<br><br>Please use the latest version of Firefox, Chrome, Edge, or Safari.\");\r\n\t\t\t\tconsole.log(\"Sorry, your browser does not support WebGL.<br><br>Please use the latest version of Firefox, Chrome, Edge, or Safari.\");\r\n\t\t\t\treturn dom;\r\n\t\t\t}\r\n\r\n\t\t\t// configure the camera\r\n\t\t\tthis.configurePerspectiveCamera(this.playerConfig.viewport);\r\n\r\n\t\t\t// Load the assets\r\n\t\t\tthis.assetManager = new AssetManager(this.context);\r\n\r\n\t\t\t// Setup rendering loop\r\n\t\t\tthis.lastRequestAnimationFrameId = requestAnimationFrame(() => this.drawFrame());\r\n\r\n\t\t\t// Setup FPS counter\r\n\t\t\tperformance.mark('fps_window_start');\r\n\t\t\tthis.windowFpsFrameCount = 0;\r\n\t\t\tif (this.playerConfig.runtimeDebugInfoDumpIntervalSec > 0) {\r\n\t\t\t\tsetInterval(() => this.callbackSendRuntimeUpdateInfo(), 1000* this.playerConfig.runtimeDebugInfoDumpIntervalSec);\r\n\t\t\t}\r\n\r\n\t\t\t// Setup the event listeners for UI elements\r\n\t\t\tthis.playerControls = findWithClass(dom, \"spine-player-controls\")[0];\r\n\t\t\tlet timeline = findWithClass(dom, \"spine-player-timeline\")[0];\r\n\t\t\tthis.timelineSlider = new Slider();\r\n\t\t\ttimeline.appendChild(this.timelineSlider.render());\r\n\t\t\tthis.playButton = findWithId(dom, \"spine-player-button-play-pause\")[0];\r\n\r\n\t\t\tthis.playButton.onclick = () => {\r\n\t\t\t\tif (this.paused) this.play()\r\n\t\t\t\telse this.pause();\r\n\t\t\t}\r\n\r\n\t\t\t// Register a global resize handler to redraw and avoid flicker\r\n\t\t\twindow.onresize = () => {\r\n\t\t\t\tthis.drawFrame(false);\r\n\t\t\t}\r\n\r\n\t\t\t// Setup the input processor and controllable bones\r\n\t\t\tthis.setupInput();\r\n\r\n\t\t\treturn dom;\r\n\t\t}\r\n\r\n\t\tcallbackSendRuntimeUpdateInfo() {\r\n\t\t\tperformance.mark('fps_window_end');\r\n\t\t\tconst totalTime = performance.measure('fps_window_time', 'fps_window_start', 'fps_window_end')\r\n\t\t\tconst averageFps = this.windowFpsFrameCount / (totalTime.duration  / 1000);\r\n\r\n\t\t\tif (this.webSocket != null) {\r\n\t\t\t\tconst payload = JSON.stringify(\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype_name: \"RUNTIME_DEBUG_UPDATE\",\r\n\t\t\t\t\t\taverage_fps: averageFps, \r\n\t\t\t\t\t}\r\n\t\t\t\t)\r\n\t\t\t\tthis.webSocket.send(payload);\r\n\t\t\t}\r\n\r\n\t\t\tperformance.mark('fps_window_start');\r\n\t\t\tthis.windowFpsFrameCount = 0;\r\n\t\t}\r\n\r\n\t\tchangeOrAddActor(actorName: string, config: SpineActorConfig) {\r\n\t\t\tif (this.actors.has(actorName)) {\r\n\t\t\t\tlet actor = this.actors.get(actorName);\r\n\t\t\t\tactor.ResetWithConfig(config);\r\n\t\t\t\tthis.setupActor(actor);\r\n\t\t\t} else {\r\n\t\t\t\tlet actor = new Actor(config, this.playerConfig.viewport);\r\n\t\t\t\tthis.setupActor(actor);\r\n\t\t\t\tthis.actors.set(actorName, actor);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic getActor(actorName: string) : Actor {\r\n\t\t\treturn this.actors.get(actorName);\r\n\t\t}\r\n\r\n\t\tpublic getActorNames() : Array<string> {\r\n\t\t\treturn Array.from(this.actors.keys());\r\n\t\t}\r\n\r\n\t\tremoveActor(actorName: string) {\r\n\t\t\tthis.actors.delete(actorName)\r\n\t\t}\r\n\r\n\t\tsetupActor(actor: Actor) {\r\n\t\t\tlet config = actor.config;\r\n\r\n\t\t\ttry {\r\n\t\t\t\t// Validate the configuration\r\n\t\t\t\t// this.config = this.validatePlayerConfig(config);\r\n\t\t\t\tactor.config = this.validateActorConfig(actor.config);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis.showError(actor, e);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Load the assets\r\n\t\t\tif (config.rawDataURIs) {\r\n\t\t\t\tfor (let path in config.rawDataURIs) {\r\n\t\t\t\t\tlet data = config.rawDataURIs[path];\r\n\t\t\t\t\tthis.assetManager.setRawDataURI(path, data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (config.jsonUrl) {\r\n\t\t\t\tthis.assetManager.loadText(config.jsonUrl);\r\n\t\t\t} else {\r\n\t\t\t\tthis.assetManager.loadBinary(config.skelUrl);\r\n\t\t\t}\r\n\t\t\tthis.assetManager.loadTextureAtlas(config.atlasUrl);\r\n\t\t\tif (config.backgroundImage && config.backgroundImage.url) {\r\n\t\t\t\tthis.assetManager.loadTexture(config.backgroundImage.url);\r\n\t\t\t}\r\n\r\n\t\t\t// Setup rendering loop\r\n\t\t\t// this.lastRequestAnimationFrameId = requestAnimationFrame(() => this.drawFrame());\r\n\t\t}\r\n\r\n\t\tdrawText(text: string, xpx: number, ypx: number) {\r\n\t\t\tlet viewport = this.playerConfig.viewport;\r\n\t\t\t// TODO: I don't understand why this is worldToScreen.\r\n\t\t\tlet tt = this.sceneRenderer.camera.worldToScreen(\r\n\t\t\t\tnew Vector3(xpx,ypx,0)\r\n\t\t\t);\r\n\t\t\tlet textpos = new Vector2(tt.x, tt.y);\r\n\t\t\ttextpos.y = viewport.height - textpos.y;\r\n\t\t\txpx = textpos.x;\r\n\t\t\typx = textpos.y;\r\n\r\n\t\t\tlet ctx = this.textCanvasContext;\r\n\t\t\tctx.save();\r\n\t\t\tctx.translate(xpx, ypx);\r\n\r\n\t\t\tctx.font = this.playerConfig.textSize + \"px \" + this.playerConfig.textFont;\r\n\t\t\tctx.textBaseline = \"bottom\";\r\n\t\t\tlet data = ctx.measureText(text);\r\n\t\t\tlet height = data.actualBoundingBoxAscent - data.actualBoundingBoxDescent;\r\n\t\t\tlet width = data.width;\r\n\r\n\t\t\tctx.beginPath();\r\n\t\t\tlet pad = 5;\r\n\t\t\tctx.fillStyle = \"black\";\r\n\t\t\tctx.fillRect(-width/2 - pad, pad, width + 2*pad, -height - 2*pad);\r\n\t\t\tctx.fill();\r\n\r\n\t\t\tctx.fillStyle = \"white\";\r\n\t\t\tctx.fillText(text, -width/2, 0);\r\n\t\t\tctx.restore();\r\n\t\t}\r\n\r\n\t\tgetPerspectiveCameraZOffset(viewport: BoundingBox, near: number, far: number, fovY:number): number {\r\n\t\t\tlet width = viewport.width;\r\n\t\t\tlet height = viewport.height;\r\n\t\t\tlet cam = new PerspectiveCamera(width, height);\r\n\t\t\tcam.near = near;\r\n\t\t\tcam.far = far;\r\n\t\t\tcam.fov = fovY;\r\n\t\t\tcam.zoom = 1;\r\n\t\t\tcam.position.x = 0.0;\r\n\t\t\tcam.position.y = 0.0;\r\n\t\t\tcam.position.z = 0.0;\r\n\t\t\tcam.update();\r\n\r\n\t\t\tlet a = cam.projectionView.values[M00];\r\n\t\t\tlet w = -a * (width/2);\r\n\t\t\treturn w;\r\n\t\t}\r\n\r\n\t\tconfigurePerspectiveCamera(viewport: BoundingBox) {\r\n\t\t\tlet cam = this.sceneRenderer.camera;\r\n\t\t\tcam.near = this.playerConfig.cameraPerspectiveNear;\r\n\t\t\tcam.far = this.playerConfig.cameraPerspectiveFar;\r\n\t\t\tcam.zoom = 1;\r\n\t\t\tcam.position.x = 0;\r\n\t\t\tcam.position.y = viewport.height/2;\r\n\t\t\t// TODO: Negative so that the view is not flipped?\r\n\t\t\tcam.position.z = -this.getPerspectiveCameraZOffset(\r\n\t\t\t\tviewport, cam.near, cam.far, cam.fov\r\n\t\t\t);\r\n\t\t\tcam.direction = new Vector3(0, 0, -1);\r\n\t\t\tcam.update();\r\n\t\t}\r\n\r\n\t\tupdateCameraSettings(actor: Actor, viewport: BoundingBox) {\r\n\t\t\tlet cam = this.sceneRenderer.camera;\r\n\t\t\tcam.position.x = 0;\r\n\t\t\tcam.position.y = viewport.height/2;\r\n\t\t\t// TODO: Negative so that the view is not flipped?\r\n\t\t\tcam.position.z = -this.getPerspectiveCameraZOffset(viewport, cam.near, cam.far, cam.fov);\r\n\t\t\tcam.position.z += actor.getPositionZ();\r\n\t\t\tcam.direction = new Vector3(0, 0, -1);\r\n\t\t\t// let origin = new Vector3(0,0,0);\r\n\t\t\t// let pos = new Vector3(0,0,cam.position.z)\r\n\t\t\t// let dir = origin.sub(pos).normalize();\r\n\t\t\t// cam.direction = dir;\r\n\t\t\tcam.update();\r\n\t\t}\r\n\r\n\t\tdrawFrame (requestNextFrame = true) {\r\n\t\t\tif (requestNextFrame && !this.stopRequestAnimationFrame) {\r\n\t\t\t\tthis.lastRequestAnimationFrameId = requestAnimationFrame(() => this.drawFrame());\r\n\t\t\t}\r\n\t\t\tlet ctx = this.context;\r\n\t\t\tlet gl = ctx.gl;\r\n\r\n\t\t\t// Clear the viewport\r\n\t\t\tvar doc = document as any;\r\n\t\t\tvar isFullscreen = doc.fullscreenElement || doc.webkitFullscreenElement || doc.mozFullScreenElement || doc.msFullscreenElement;\r\n\t\t\t// let bg = new Color().setFromString(isFullscreen ? this.config.fullScreenBackgroundColor : this.config.backgroundColor);\r\n\t\t\tlet bg = new Color().setFromString(\r\n\t\t\t\tisFullscreen ? \r\n\t\t\t\tthis.playerConfig.fullScreenBackgroundColor :\r\n\t\t\t\tthis.playerConfig.backgroundColor\r\n\t\t\t);\r\n\t\t\tgl.clearColor(bg.r, bg.g, bg.b, bg.a);\r\n\t\t\tgl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n\t\t\t// Clear the Text Canvas\r\n\t\t\tthis.textCanvas.width = this.textCanvas.clientWidth;\r\n\t\t\tthis.textCanvas.height = this.textCanvas.clientHeight;\r\n\t\t\tthis.textCanvasContext.clearRect(0,0, this.textCanvas.width, this.textCanvas.height);\r\n\r\n\t\t\t// // Display loading screen\r\n\t\t\t// this.loadingScreen.backgroundColor.setFromColor(bg);\r\n\t\t\t// this.loadingScreen.draw(this.assetManager.isLoadingComplete());\r\n\r\n\t\t\t// Resize the canvas\r\n\t\t\tthis.sceneRenderer.resize(ResizeMode.Expand);\r\n\r\n\t\t\t// Order the actors to draw based on their z-order\r\n\t\t\tlet actorsZOrder = Array.from(this.actors.keys()).sort((a:string,b:string ) => {\r\n\t\t\t\tlet a1 = this.actors.get(a);\r\n\t\t\t\tlet a2 = this.actors.get(b);\r\n\t\t\t\tlet r = a2.getPositionZ() - a1.getPositionZ()\r\n\t\t\t\t// To ensure stable sort\r\n\t\t\t\tif (r == 0) {return a1.loadedWhen - a2.loadedWhen;}\r\n\t\t\t\treturn r;\r\n\t\t\t});\r\n\r\n\t\t\tlet all_actors_loaded = true;\r\n\t\t\tfor (let key of actorsZOrder) {\r\n\t\t\t\tlet actor = this.actors.get(key);\r\n\t\t\t\tif (actor.load_perma_failed) {\r\n\t\t\t\t\t// Permanant failure trying to load this actor. Just skip it.\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Have we finished loading the asset? Then set things up\r\n\t\t\t\t// if (this.assetManager.isLoadingComplete() && this.skeleton == null) this.loadSkeleton();\r\n\t\t\t\tif (this.assetManager.isLoadingComplete() && actor.skeleton == null) {\r\n\t\t\t\t\tthis.loadSkeleton(actor);\r\n\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t// // Resize the canvas\r\n\t\t\t\t// this.sceneRenderer.resize(webgl.ResizeMode.Expand);\r\n\r\n\t\t\t\t// Update and draw the skeleton\r\n\t\t\t\tif (!actor.loaded) {\r\n\t\t\t\t\tall_actors_loaded = false;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet viewport = this.playerConfig.viewport;\r\n\r\n\t\t\t\t// Update animation and skeleton based on user selections\r\n\t\t\t\t// if (!actor.paused && actor.config.animations.length > 0) {\r\n\t\t\t\tif (!actor.paused && actor.GetAnimations().length > 0) {\r\n\t\t\t\t\tactor.time.update();\r\n\t\t\t\t\tlet delta = actor.time.delta * actor.speed;\r\n\r\n\t\t\t\t\tlet animationDuration = actor.animationState.getCurrent(0).animation.duration;\r\n\t\t\t\t\tactor.playTime += delta;\r\n\t\t\t\t\twhile (actor.playTime >= animationDuration && animationDuration != 0) {\r\n\t\t\t\t\t\tactor.playTime -= animationDuration;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tactor.playTime = Math.max(0, Math.min(actor.playTime, animationDuration));\r\n\t\t\t\t\tthis.timelineSlider.setValue(actor.playTime / animationDuration);\r\n\r\n\t\t\t\t\tactor.UpdatePhysics(delta, viewport);\r\n\t\t\t\t\tactor.skeleton.setToSetupPose();\t\t\t\t\t\r\n\t\t\t\t\tactor.animationState.update(delta);\r\n\t\t\t\t\tactor.animationState.apply(actor.skeleton);\r\n\t\t\t\t}\r\n\t\t\t\tactor.skeleton.updateWorldTransform();\r\n\r\n\t\t\t\t// Update the camera\r\n\t\t\t\tthis.updateCameraSettings(actor, viewport);\r\n\r\n\t\t\t\tthis.sceneRenderer.begin();\r\n\t\t\t\t// // Draw background image if given\r\n\t\t\t\tif (actor.config.backgroundImage && actor.config.backgroundImage.url) {\r\n\t\t\t\t\tlet bgImage = this.assetManager.get(actor.config.backgroundImage.url);\r\n\t\t\t\t\tif (!(actor.config.backgroundImage.hasOwnProperty(\"x\") && actor.config.backgroundImage.hasOwnProperty(\"y\") && actor.config.backgroundImage.hasOwnProperty(\"width\") && actor.config.backgroundImage.hasOwnProperty(\"height\"))) {\r\n\t\t\t\t\t\tthis.sceneRenderer.drawTexture(bgImage, viewport.x, viewport.y, viewport.width, viewport.height);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.sceneRenderer.drawTexture(bgImage, actor.config.backgroundImage.x, actor.config.backgroundImage.y, actor.config.backgroundImage.width, actor.config.backgroundImage.height);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// Draw skeleton \r\n\t\t\t\tthis.sceneRenderer.drawSkeleton(actor.skeleton, actor.config.premultipliedAlpha);\r\n\r\n\t\t\t\t// Render the user's name above the chibi\r\n\t\t\t\t// TODO: Need to figure out if the actor.animViewport.y has any breaking changes\r\n\t\t\t\t// The subtraction of animViewport is to account for the fact the \r\n\t\t\t\t// character could be sitting and we offset the actors.postion.y \r\n\t\t\t\t// to make them \"sit\" in the air.\r\n\t\t\t\tthis.drawText(\r\n\t\t\t\t\tactor.config.userDisplayName,\r\n\t\t\t\t\tactor.getPositionX(),\r\n\t\t\t\t\tactor.getPositionY() - Math.abs(actor.animViewport.y) + actor.GetUsernameHeaderHeight(),\r\n\t\t\t\t)\r\n\t\t\t\tthis.sceneRenderer.end();\r\n\r\n\t\t\t\t// Render the debug output with a fixed camera.\r\n\t\t\t\tif (this.playerConfig.viewport.debugRender) {\r\n\t\t\t\t\tthis.sceneRenderer.begin();\r\n\r\n\t\t\t\t\tlet actor_pos = actor.getPosition();\r\n\t\t\t\t\tif (actor.scale.x > 0) {\r\n\t\t\t\t\t\tthis.sceneRenderer.rect(\r\n\t\t\t\t\t\t\tfalse, \r\n\t\t\t\t\t\t\tactor_pos.x + actor.animViewport.x,\r\n\t\t\t\t\t\t\tactor_pos.y + actor.animViewport.y,\r\n\t\t\t\t\t\t\tactor.animViewport.width,\r\n\t\t\t\t\t\t\tactor.animViewport.height,\r\n\t\t\t\t\t\t\tColor.BLUE\r\n\t\t\t\t\t\t);\t\t\t\t\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.sceneRenderer.rect(\r\n\t\t\t\t\t\t\tfalse, \r\n\t\t\t\t\t\t\tactor_pos.x - (actor.animViewport.width + actor.animViewport.x),\r\n\t\t\t\t\t\t\tactor_pos.y + actor.animViewport.y,\r\n\t\t\t\t\t\t\tactor.animViewport.width,\r\n\t\t\t\t\t\t\tactor.animViewport.height,\r\n\t\t\t\t\t\t\tColor.GREEN\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.sceneRenderer.rect(\r\n\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t\tactor_pos.x + actor.defaultBB.x,\r\n\t\t\t\t\t\tactor_pos.y + actor.defaultBB.y,\r\n\t\t\t\t\t\tactor.defaultBB.width,\r\n\t\t\t\t\t\tactor.defaultBB.height,\r\n\t\t\t\t\t\tColor.ORANGE\r\n\t\t\t\t\t)\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.sceneRenderer.circle(true, actor_pos.x, actor_pos.y, 10, Color.RED);\r\n\t\t\t\t\tthis.sceneRenderer.end();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.broadcastRenderCallback();\r\n\r\n\t\t\tif (all_actors_loaded) {\r\n\t\t\t\tthis.assetManager.clearErrors();\r\n\t\t\t\tthis.hideError();\r\n\t\t\t}\r\n\t\t\tthis.windowFpsFrameCount += 1;\r\n\t\t}\r\n\r\n\r\n\t\tpublic registerRenderCallback(callback: RenderCallbackFn) : RemoveCallbackFn{\r\n\t\t\tthis.renderCallbacks.push(callback);\r\n\t\t\treturn () => {\r\n\t\t\t\tthis.renderCallbacks = this.renderCallbacks.filter(c => c !== callback);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tbroadcastRenderCallback() {\r\n\t\t\tfor (let i = 0; i < this.renderCallbacks.length; i++) {\r\n\t\t\t\tthis.renderCallbacks[i](this.context);;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tscale(sourceWidth: number, sourceHeight: number, targetWidth: number, targetHeight: number): Vector2 {\r\n\t\t\tlet targetRatio = targetHeight / targetWidth;\r\n\t\t\tlet sourceRatio = sourceHeight / sourceWidth;\r\n\t\t\tlet scale = targetRatio > sourceRatio ? targetWidth / sourceWidth : targetHeight / sourceHeight;\r\n\t\t\tlet temp = new Vector2();\r\n\t\t\ttemp.x = sourceWidth * scale;\r\n\t\t\ttemp.y = sourceHeight * scale;\r\n\t\t\treturn temp;\r\n\t\t}\r\n\r\n\t\tloadSkeleton (actor: Actor) {\r\n\t\t\tif (actor.loaded || actor.load_perma_failed) return;\r\n\r\n\t\t\tif (this.assetManager.hasErrors()) {\r\n\t\t\t\tthis.showError(actor, \"Error: assets could not be loaded.<br><br>\" + escapeHtml(JSON.stringify(this.assetManager.getErrors())));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet atlas = this.assetManager.get(actor.config.atlasUrl);\r\n\t\t\tlet skeletonData: SkeletonData;\r\n\t\t\tif (actor.config.jsonUrl) {\r\n\t\t\t\tlet jsonText = this.assetManager.get(actor.config.jsonUrl);\r\n\t\t\t\tlet json = new SkeletonJson(new AtlasAttachmentLoader(atlas));\r\n\t\t\t\ttry {\r\n\t\t\t\t\tskeletonData = json.readSkeletonData(jsonText);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tthis.showError(actor, \"Error: could not load skeleton .json.<br><br>\" + escapeHtml(JSON.stringify(e)));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet binaryData = this.assetManager.get(actor.config.skelUrl);\r\n\t\t\t\tlet binary = new SkeletonBinary(new AtlasAttachmentLoader(atlas));\r\n\t\t\t\ttry {\r\n\t\t\t\t\tskeletonData = binary.readSkeletonData(binaryData);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tthis.showError(actor, \"Error: could not load skeleton .skel.<br><br>\" + escapeHtml(JSON.stringify(e)));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tactor.skeleton = new Skeleton(skeletonData);\r\n\t\t\t\r\n\t\t\t// Setup skin\r\n\t\t\tif (!actor.config.skin) {\r\n\t\t\t\tif (skeletonData.skins.length > 0) {\r\n\t\t\t\t\tactor.config.skin = skeletonData.skins[0].name;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (actor.config.skins && actor.config.skin.length > 0) {\r\n\t\t\t\tactor.config.skins.forEach(skin => {\r\n\t\t\t\t\tif (!actor.skeleton.data.findSkin(skin)) {\r\n\t\t\t\t\t\tthis.showError(actor, `Error: skin '${skin}' in selectable skin list does not exist in skeleton.`);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (actor.config.skin) {\r\n\t\t\t\tif (!actor.skeleton.data.findSkin(actor.config.skin)) {\r\n\t\t\t\t\tthis.showError(actor, `Error: skin '${actor.config.skin}' does not exist in skeleton.`);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tactor.skeleton.setSkinByName(actor.config.skin);\r\n\t\t\t\tactor.skeleton.setSlotsToSetupPose();\r\n\t\t\t}\r\n\t\t\tactor.InitAnimationState();\r\n\r\n\t\t\tactor.config.success(this, actor);\r\n\t\t\tactor.loaded = true;\r\n\t\t}\r\n\r\n\t\tprivate cancelId: any = 0;\r\n\t\tprivate setupInput () {\r\n\t\t\tlet canvas = this.canvas;\r\n\t\t\tlet input = new Input(canvas);\r\n\t\t\tinput.addListener({\r\n\t\t\t\tdown: (x, y) => {},\r\n\t\t\t\tdragged: (x, y) => {},\r\n\t\t\t\tmoved: (x, y) => {},\r\n\t\t\t\tup: (x, y) => {\r\n\t\t\t\t\tif (!this.playerConfig.showControls) return;\r\n\t\t\t\t\tif (this.paused) {\r\n\t\t\t\t\t\tthis.play()\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.pause()\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t});\r\n\r\n\t\t\t// For the manual hover to work, we need to disable\r\n\t\t\t// hidding the controls if the mouse/touch entered\r\n\t\t\t// the clickable area of a child of the controls.\r\n\t\t\t// For this we need to register a mouse handler on\r\n\t\t\t// the document and see if we are within the canvas\r\n\t\t\t// area :/\r\n\t\t\tvar mouseOverControls = true;\r\n\t\t\tvar mouseOverCanvas = false;\r\n\t\t\tdocument.addEventListener(\"mousemove\", (ev: UIEvent) => {\r\n\t\t\t\tif (ev instanceof MouseEvent) {\r\n\t\t\t\t\thandleHover(ev.clientX, ev.clientY);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tdocument.addEventListener(\"touchmove\", (ev: UIEvent) => {\r\n\t\t\t\tif (ev instanceof TouchEvent) {\r\n\t\t\t\t\tvar touches = ev.changedTouches;\r\n\t\t\t\t\tif (touches.length > 0) {\r\n\t\t\t\t\t\tvar touch = touches[0];\r\n\t\t\t\t\t\thandleHover(touch.clientX, touch.clientY);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tlet handleHover = (mouseX: number, mouseY: number) => {\r\n\t\t\t\t// if (!this.config.showControls) return;\r\n\t\t\t\tif (!this.playerConfig.showControls) return;\r\n\r\n\t\t\t\tlet popup = findWithClass(this.dom, \"spine-player-popup\");\r\n\t\t\t\tmouseOverControls = overlap(mouseX, mouseY, this.playerControls.getBoundingClientRect());\r\n\t\t\t\tmouseOverCanvas = overlap(mouseX, mouseY, this.canvas.getBoundingClientRect());\r\n\t\t\t\tclearTimeout(this.cancelId);\r\n\t\t\t\tlet hide = popup.length == 0 && !mouseOverControls && !mouseOverCanvas && !this.paused;\r\n\t\t\t\tif (hide) {\r\n\t\t\t\t\tthis.playerControls.classList.add(\"spine-player-controls-hidden\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.playerControls.classList.remove(\"spine-player-controls-hidden\");\r\n\t\t\t\t}\r\n\t\t\t\tif (!mouseOverControls && popup.length == 0 && !this.paused) {\r\n\t\t\t\t\tlet remove = () => {\r\n\t\t\t\t\t\tif (!this.paused) this.playerControls.classList.add(\"spine-player-controls-hidden\");\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.cancelId = setTimeout(remove, 1000);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet overlap = (mouseX: number, mouseY: number, rect: DOMRect | ClientRect): boolean => {\r\n\t\t\t\tlet x = mouseX - rect.left;\r\n\t\t\t\tlet y = mouseY - rect.top;\r\n\t\t\t\treturn x >= 0 && x <= rect.width && y >= 0 && y <= rect.height;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate play () {\r\n\t\t\tthis.paused = false;\r\n\t\t\tlet remove = () => {\r\n\t\t\t\tif (!this.paused) this.playerControls.classList.add(\"spine-player-controls-hidden\");\r\n\t\t\t};\r\n\t\t\tthis.cancelId = setTimeout(remove, 1000);\r\n\t\t\tthis.playButton.classList.remove(\"spine-player-button-icon-play\");\r\n\t\t\tthis.playButton.classList.add(\"spine-player-button-icon-pause\");\r\n\r\n\t\t\tfor(let [key,actor] of this.actors) {\r\n\t\t\t\tactor.paused = false;\r\n\t\t\t\tif (actor.animationState) {\r\n\t\t\t\t\tif (!actor.animationState.getCurrent(0)) {\r\n\t\t\t\t\t\tactor.InitAnimations();\r\n\t\t\t\t\t\t// this.setAnimations(actor, actor.GetAnimations());\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate pause () {\r\n\t\t\tthis.paused = true;\r\n\t\t\tthis.playerControls.classList.remove(\"spine-player-controls-hidden\");\r\n\t\t\tclearTimeout(this.cancelId);\r\n\r\n\t\t\tthis.playButton.classList.remove(\"spine-player-button-icon-pause\");\r\n\t\t\tthis.playButton.classList.add(\"spine-player-button-icon-play\");\r\n\r\n\t\t\tfor(let [key, actor] of this.actors) {\r\n\t\t\t\tactor.paused = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Exposed only for testing.\r\n\t\tpublic getSceneRenderer() : SceneRenderer {\r\n\t\t\treturn this.sceneRenderer;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction isContained(dom: HTMLElement, needle: HTMLElement): boolean {\r\n\t\tif (dom === needle) return true;\r\n\t\tlet findRecursive = (dom: HTMLElement, needle: HTMLElement) => {\r\n\t\t\tfor(var i = 0; i < dom.children.length; i++) {\r\n\t\t\t\tlet child = dom.children[i] as HTMLElement;\r\n\t\t\t\tif (child === needle) return true;\r\n\t\t\t\tif (findRecursive(child, needle)) return true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\treturn findRecursive(dom, needle);\r\n\t}\r\n\r\n\tfunction findWithId(dom: HTMLElement, id: string): HTMLElement[] {\r\n\t\tlet found = new Array<HTMLElement>()\r\n\t\tlet findRecursive = (dom: HTMLElement, id: string, found: HTMLElement[]) => {\r\n\t\t\tfor(var i = 0; i < dom.children.length; i++) {\r\n\t\t\t\tlet child = dom.children[i] as HTMLElement;\r\n\t\t\t\tif (child.id === id) found.push(child);\r\n\t\t\t\tfindRecursive(child, id, found);\r\n\t\t\t}\r\n\t\t};\r\n\t\tfindRecursive(dom, id, found);\r\n\t\treturn found;\r\n\t}\r\n\r\n\tfunction findWithClass(dom: HTMLElement, className: string): HTMLElement[] {\r\n\t\tlet found = new Array<HTMLElement>()\r\n\t\tlet findRecursive = (dom: HTMLElement, className: string, found: HTMLElement[]) => {\r\n\t\t\tfor(var i = 0; i < dom.children.length; i++) {\r\n\t\t\t\tlet child = dom.children[i] as HTMLElement;\r\n\t\t\t\tif (child.classList.contains(className)) found.push(child);\r\n\t\t\t\tfindRecursive(child, className, found);\r\n\t\t\t}\r\n\t\t};\r\n\t\tfindRecursive(dom, className, found);\r\n\t\treturn found;\r\n\t}\r\n\r\n\tfunction createElement(html: string): HTMLElement {\r\n\t\tlet dom = document.createElement(\"div\");\r\n\t\tdom.innerHTML = html;\r\n\t\treturn dom.children[0] as HTMLElement;\r\n\t}\r\n\r\n\tfunction removeClass(elements: HTMLCollection, clazz: string) {\r\n\t\tfor (var i = 0; i < elements.length; i++) {\r\n\t\t\telements[i].classList.remove(clazz);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction escapeHtml(str: string) {\r\n\t\tif (!str) return \"\";\r\n\t\treturn str\r\n\t\t\t .replace(/&/g, \"&amp;\")\r\n\t\t\t .replace(/</g, \"&lt;\")\r\n\t\t\t .replace(/>/g, \"&gt;\")\r\n\t\t\t .replace(/\"/g, \"&#34;\")\r\n\t\t\t .replace(/'/g, \"&#39;\");\r\n\t }\r\n\r\n\tfunction isAlphanumeric(str: string): boolean {\r\n\t\treturn /^[a-zA-Z0-9_-]{1,100}$/.test(str)\r\n\t}\r\n//  }\r\n","\r\nimport { Actor, SpineActorConfig } from \"../player/Actor\";\r\nimport { SpinePlayer, SpinePlayerConfig } from \"../player/Player\";\r\n\r\nexport interface RuntimeConfig {\r\n    width: number,\r\n    height: number\r\n    debugMode: boolean\r\n    chibiScale: number\r\n}\r\n\r\nexport class Runtime {\r\n    public socket: WebSocket;\r\n    public spinePlayer: SpinePlayer;\r\n    public spinePlayerConfig: SpinePlayerConfig;\r\n    public actorConfig: SpineActorConfig;\r\n    public defaultBackoffTimeMsec: number;\r\n    public backoffTimeMsec: number;\r\n    public backOffMaxtimeMsec: number;\r\n    public channelName: string;\r\n    public runtimeConfig: RuntimeConfig;\r\n\r\n    constructor(channelName: string, config: RuntimeConfig) {\r\n        this.runtimeConfig = config;\r\n        const { width, height, debugMode, chibiScale } = config;\r\n\r\n        // TODO: Make the fonts configurable\r\n        let font = new FontFace(\"lato\", \"url(/public/fonts/Lato/Lato-Black.ttf)\");\r\n        font.load().then(() => { document.fonts.add(font); })\r\n\r\n        this.channelName = channelName;\r\n        this.socket = null;\r\n        this.spinePlayer = null;\r\n        this.defaultBackoffTimeMsec = 15 * 1000; // 15 seconds\r\n        this.backoffTimeMsec = 15 * 1000; // 15 seconds\r\n        this.backOffMaxtimeMsec = 5 * 60 * 1000; // 5 minutes\r\n        this.openWebSocket(this.channelName);\r\n\r\n        if (this.spinePlayer == null) {\r\n            this.spinePlayerConfig = {\r\n                backgroundColor: \"#00000000\",\r\n                alpha: true,\r\n                showControls: true,\r\n                viewport: {\r\n                    x: 0,\r\n                    y: 0,\r\n                    width: width,\r\n                    height: height,\r\n                    padLeft: 0,\r\n                    padRight: 0,\r\n                    padTop: 0,\r\n                    padBottom: 0,\r\n                    debugRender: debugMode,\r\n                },\r\n                fullScreenBackgroundColor: null,\r\n                backgroundImage: null,\r\n                textSize: 14,\r\n                textFont: \"lato\",\r\n                runtimeDebugInfoDumpIntervalSec: 60,\r\n\r\n                cameraPerspectiveNear: 1,\r\n                cameraPerspectiveFar: 2000,\r\n            };\r\n\r\n            console.log(\"Creating a new spine player\");\r\n            this.spinePlayer = new SpinePlayer(\"container\", this.spinePlayerConfig);\r\n        }\r\n    }\r\n\r\n    openWebSocket(channelName: string) {\r\n        const protocolPrefix = (window.location.protocol === 'https:') ? 'wss:' : 'ws:';\r\n        const websocketPath = protocolPrefix + '//' + location.host + `/ws/?channelName=${channelName}`;\r\n\r\n        console.log(\"Openning websocket\");\r\n        this.socket = new WebSocket(websocketPath);\r\n        this.socket.addEventListener(\"open\", (event) => {\r\n            console.log(\"Socket opened\");\r\n            this.backoffTimeMsec = this.defaultBackoffTimeMsec;\r\n            this.spinePlayer.setWebsocket(this.socket);\r\n        });\r\n        this.socket.addEventListener(\"message\",\r\n            this.messageHandler.bind(this)\r\n        );\r\n        this.socket.addEventListener(\"close\", (event) => {\r\n            console.log(\"Close received: \", event);\r\n            this.spinePlayer.setWebsocket(null);\r\n\r\n            // if (event.code >= 1000 && event.code <= 1002) {\r\n            //     return\r\n            // }\r\n            this.backoffTimeMsec *= 2;\r\n            if (this.backoffTimeMsec < this.backOffMaxtimeMsec) {\r\n                console.log(\"Retrying in \" + this.backoffTimeMsec + \"ms\");\r\n                setTimeout(() => this.openWebSocket(this.channelName), this.backoffTimeMsec);\r\n            }\r\n        });\r\n        this.socket.addEventListener(\"error\", (event) => {\r\n            console.log(\"Error received: \", event);\r\n        });\r\n    }\r\n\r\n    messageHandler(event: MessageEvent) {\r\n        let requestData = JSON.parse(event.data)\r\n        console.log(\"Message received: \", requestData);\r\n\r\n        if (requestData[\"type_name\"] == \"SET_OPERATOR\") {\r\n            this.swapCharacter(requestData)\r\n        } else if (requestData[\"type_name\"] == \"REMOVE_OPERATOR\") {\r\n            this.removeCharacter(requestData);\r\n        }\r\n    }\r\n\r\n    swapCharacter(requestData: any) {\r\n        let username = requestData[\"user_name\"];\r\n        let startPosX = null;\r\n        let startPosY = null;\r\n        if (requestData[\"start_pos\"] != null) {\r\n            startPosX = requestData[\"start_pos\"][\"x\"];\r\n            startPosY = requestData[\"start_pos\"][\"y\"];\r\n        }\r\n        let configScaleX = 1;\r\n        let configScaleY = 1;\r\n        if (requestData[\"sprite_scale\"] != null) {\r\n            configScaleX = requestData[\"sprite_scale\"][\"x\"];\r\n            configScaleY = requestData[\"sprite_scale\"][\"y\"];\r\n        }\r\n        let configMaxPixelSize = 350;\r\n        if (requestData[\"max_sprite_pixel_size\"] != null) {\r\n            configMaxPixelSize = requestData[\"max_sprite_pixel_size\"];\r\n        }\r\n\r\n        let referenceMovementSpeedPx = 80;\r\n        let referenceMovementSpeedPy = 80;\r\n        let referenceMovementSpeedPz = 80;\r\n        if (requestData[\"movement_speed_px\"] != null) {\r\n            referenceMovementSpeedPx = requestData[\"movement_speed_px\"];\r\n        }\r\n        if (requestData[\"movement_speed_py\"] != null) {\r\n            referenceMovementSpeedPx = requestData[\"movement_speed_py\"];\r\n        }\r\n        if (requestData[\"movement_speed_pz\"] != null) {\r\n            referenceMovementSpeedPz = requestData[\"movement_speed_pz\"];\r\n        }\r\n        let movementSpeedPxX = null;\r\n        let movementSpeedPxY = null;\r\n        let movementSpeedPxZ = referenceMovementSpeedPz;\r\n        if (requestData[\"movement_speed\"] != null) {\r\n            movementSpeedPxX = Math.floor(requestData[\"movement_speed\"][\"x\"] * referenceMovementSpeedPx);\r\n            movementSpeedPxY = Math.floor(requestData[\"movement_speed\"][\"y\"] * referenceMovementSpeedPy);\r\n            // movementSpeedPxZ = Math.floor(requestData[\"movement_speed\"][\"z\"] * referenceMovementSpeedPz);\r\n        }\r\n        let defaultMovementSpeedPxX = referenceMovementSpeedPx;\r\n        let defaultMovementSpeedPxY = referenceMovementSpeedPy;\r\n        let defaultMovementSpeedPxZ = referenceMovementSpeedPz;\r\n\r\n        this.actorConfig = {\r\n            chibiId: requestData[\"operator_id\"],\r\n            userDisplayName: requestData['user_name_display'],\r\n            skelUrl: requestData[\"skel_file\"],\r\n            atlasUrl: requestData[\"atlas_file\"],\r\n\r\n            startPosX: startPosX,\r\n            startPosY: startPosY,\r\n            defaultMovementSpeedPxX: defaultMovementSpeedPxX,\r\n            defaultMovementSpeedPxY: defaultMovementSpeedPxY,\r\n            defaultMovementSpeedPxZ: defaultMovementSpeedPxZ,\r\n            movementSpeedPxX: movementSpeedPxX,\r\n            movementSpeedPxY: movementSpeedPxY,\r\n            movementSpeedPxZ: movementSpeedPxZ,\r\n\r\n            configScaleX: configScaleX,\r\n            configScaleY: configScaleY,\r\n            scaleX: 0.45 * this.runtimeConfig.chibiScale * configScaleX,\r\n            scaleY: 0.45 * this.runtimeConfig.chibiScale * configScaleY,\r\n            maxSizePx: configMaxPixelSize,\r\n            premultipliedAlpha: true,\r\n            animationPlaySpeed: requestData[\"animation_speed\"] ? requestData[\"animation_speed\"] : 1.0,\r\n            extraOffsetX: 0,\r\n            extraOffsetY: 0,\r\n\r\n            action: requestData[\"action\"],\r\n            action_data: requestData[\"action_data\"],\r\n\r\n            success: (widget, actor) => {\r\n                // console.log(\"Successfully loaded actor\");\r\n            },\r\n            error: (widget, actor: Actor, error) => {\r\n                actor.load_attempts += 1;\r\n                if (actor.load_attempts > actor.max_load_attempts) {\r\n                    actor.load_perma_failed = true;\r\n                }\r\n                console.log(this);\r\n                console.log(error);\r\n            }\r\n        };\r\n\r\n        this.spinePlayer.changeOrAddActor(username, this.actorConfig);\r\n    }\r\n\r\n    removeCharacter(requestData: any) {\r\n        if (this.spinePlayer) {\r\n            this.spinePlayer.removeActor(requestData[\"user_name\"]);\r\n        }\r\n    }\r\n}\r\n","\r\nexport function setContainerSizeFromQuery(searchParams: URLSearchParams) {\r\n    let containerWidth = searchParams.has('width')\r\n        ? Number.parseInt(searchParams.get('width'))\r\n        : 1920;\r\n    let containerHeight = searchParams.has('height')\r\n        ? Number.parseInt(searchParams.get('height'))\r\n        : 1080;\r\n    let container = document.getElementById(\"container\")\r\n    if (!Number.isInteger(containerWidth)) {\r\n        containerWidth = 1920;\r\n    }\r\n    if (!Number.isInteger(containerHeight)) {\r\n        containerHeight = 1080;\r\n    }\r\n    containerWidth = Math.max(containerWidth, 0)\r\n    containerHeight = Math.max(containerHeight, 0)\r\n\r\n    // const windowWidth = window.screen.availWidth;\r\n    // const windowHeight = window.screen.availHeight;\r\n    // containerWidth = Math.min(containerWidth, windowWidth);\r\n    // containerHeight = Math.min(containerHeight, windowHeight);\r\n\r\n    console.log(containerWidth, containerHeight);\r\n    container.style.width = `${containerWidth}px`\r\n    container.style.height = `${containerHeight}px`\r\n    return [containerWidth, containerHeight];\r\n}\r\n\r\nexport function getRuntimeConfigFromQueryParams(searchParams: URLSearchParams) {\r\n    const debugMode = searchParams.get('debug') === 'true';\r\n    const scale = Math.max(Math.min((parseFloat(searchParams.get('scale')) || 1), 3), 0.1);\r\n    const [containerWidth, containerHeight] = setContainerSizeFromQuery(searchParams);\r\n    return {\r\n        width: containerWidth,\r\n        height: containerHeight,\r\n        debugMode: debugMode,\r\n        chibiScale: scale\r\n    }\r\n}"],"names":["Texture","_image","constructor","image","this","getImage","filterFromString","text","toLowerCase","TextureFilter","Nearest","Linear","MipMap","MipMapNearestNearest","MipMapLinearNearest","MipMapNearestLinear","MipMapLinearLinear","Error","wrapFromString","TextureWrap","MirroredRepeat","ClampToEdge","Repeat","BlendMode","TransformMode","PositionMode","SpacingMode","RotateMode","MixBlend","MixDirection","TimelineType","TextureRegion","renderObject","u","v","u2","v2","width","height","rotate","offsetX","offsetY","originalWidth","originalHeight","FakeTexture","setFilters","minFilter","magFilter","setWraps","uWrap","vWrap","dispose","TextureAtlas","pages","Array","regions","atlasText","textureLoader","load","reader","TextureAtlasReader","tuple","page","line","readLine","trim","length","region","TextureAtlasRegion","name","rotateValue","readValue","toLocaleLowerCase","degrees","parseFloat","readTuple","x","parseInt","y","Math","abs","index","texture","push","TextureAtlasPage","direction","findRegion","i","lines","split","colon","indexOf","substring","lastMatch","comma","substr","pathPrefix","assets","errors","toLoad","loaded","rawDataUris","encodePath","path","parts","encodeURIComponent","join","downloadText","url","success","error","data","textData","atob","request","XMLHttpRequest","overrideMimeType","open","onload","status","responseText","onerror","send","base64ToArrayBuffer","base64","binaryString","bytes","Uint8Array","charCodeAt","downloadBinary","data64","binaryData","console","log","responseType","response","setRawDataURI","loadBinary","state","loadText","loadTexture","storagePath","img","Image","crossOrigin","ev","src","loadTextureAtlas","parent","lastIndexOf","atlasData","pagesLoaded","count","atlasPages","document","createElement","e","ex","message","atlasPage","pageLoadError","imagePath","atlas","get","errorMessage","remove","asset","removeAll","key","isLoadingComplete","getToLoad","getLoaded","hasErrors","Object","keys","getErrors","clearErrors","ManagedWebGLRenderingContext","canvas","gl","restorables","canvasOrContext","contextConfig","alpha","HTMLCanvasElement","getContext","addEventListener","preventDefault","n","restore","addRestorable","restorable","removeRestorable","splice","WebGLBlendModeConverter","static","getDestGLBlendMode","blendMode","Normal","ONE_MINUS_SRC_ALPHA","Additive","ONE","Multiply","Screen","getSourceGLBlendMode","premultipliedAlpha","SRC_ALPHA","DST_COLOR","GLTexture","context","boundUnit","useMipMaps","super","bind","texParameteri","TEXTURE_2D","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","validateMagFilter","TEXTURE_WRAP_S","TEXTURE_WRAP_T","update","createTexture","DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","texImage2D","RGBA","UNSIGNED_BYTE","LINEAR","LINEAR_MIPMAP_LINEAR","CLAMP_TO_EDGE","generateMipmap","unit","activeTexture","TEXTURE0","bindTexture","unbind","deleteTexture","AssetManager","IntSet","array","add","value","contains","undefined","clear","Color","r","g","b","a","set","clamp","setFromColor","c","setFromString","hex","charAt","rgba8888ToColor","color","rgb888ToColor","MathUtils","PI","radiansToDegrees","degreesToRadians","min","max","cosDeg","cos","degRad","sinDeg","sin","signum","toInt","floor","ceil","cbrt","pow","randomTriangular","randomTriangularWith","mode","random","d","sqrt","Utils","arrayCopy","source","sourceStart","dest","destStart","numElements","j","setArraySize","size","oldSize","ensureArrayCapacity","newArray","defaultValue","newFloatArray","SUPPORTS_TYPED_ARRAYS","Float32Array","newShortArray","Int16Array","toFloatArray","toSinglePrecision","fround","webkit602BugfixHelper","blend","element","identity","Pool","items","instantiator","obtain","pop","free","item","reset","freeAll","Vector2","subtract","other","normalize","len","normalize_new","angle","dot","len_a","len_b","acos","TimeKeeper","maxDelta","framesPerSecond","delta","totalTime","lastTime","Date","now","frameCount","frameTime","Attachment","VertexAttachment","id","nextID","bones","vertices","worldVerticesLength","deformAttachment","computeWorldVertices","slot","start","worldVertices","offset","stride","skeleton","bone","deformArray","deform","worldX","worldY","w","vx","vy","skip","skeletonBones","wx","wy","weight","f","copyTo","attachment","BoundingBoxAttachment","copy","ClippingAttachment","endSlot","MeshAttachment","regionUVs","uvs","triangles","hullLength","edges","parentMesh","tempColor","updateUVs","textureWidth","textureHeight","getParentMesh","setParentMesh","newLinkedMesh","PathAttachment","lengths","closed","constantSpeed","PointAttachment","rotation","computeWorldPosition","point","computeWorldRotation","atan2","radDeg","RegionAttachment","scaleX","scaleY","rendererObject","updateOffset","regionScaleX","regionScaleY","localX","localY","localX2","localY2","radians","localXCos","localXSin","localYCos","localYSin","localX2Cos","localX2Sin","localY2Cos","localY2Sin","OX1","OY1","OX2","OY2","OX3","OY3","OX4","OY4","setRegion","vertexOffset","AtlasAttachmentLoader","newRegionAttachment","skin","newMeshAttachment","newBoundingBoxAttachment","newPathAttachment","newPointAttachment","newClippingAttachment","BoneData","shearX","shearY","transformMode","skinRequired","Bone","children","ax","ay","arotation","ascaleX","ascaleY","ashearX","ashearY","appliedValid","sorted","active","setToSetupPose","isActive","updateWorldTransformWith","updateWorldTransform","rotationY","sx","sy","pa","pb","pc","pd","la","lb","lc","ld","OnlyTranslation","NoRotationOrReflection","s","prx","rx","ry","sign","NoScale","NoScaleOrReflection","za","zc","zb","zd","getWorldRotationX","getWorldRotationY","getWorldScaleX","getWorldScaleY","updateAppliedTransform","pid","dx","dy","ia","ib","ic","ra","rb","rc","rd","det","worldToLocal","world","invDet","localToWorld","local","worldToLocalRotation","worldRotation","localToWorldRotation","localRotation","rotateWorld","IkConstraint","target","bendDirection","compress","stretch","mix","softness","findBone","apply","apply1","uniform","apply2","targetX","targetY","p","rotationIK","tx","ty","ps","dd","child","bendDir","px","py","psx","psy","csx","os1","os2","s2","cx","cy","cwx","cwy","pp","a1","a2","l1","l2","td","sd","outer","aa","bb","ta","c1","c2","q","r0","r1","minAngle","minX","minDist","minY","maxAngle","maxX","maxDist","maxY","os","ConstraintData","order","PathConstraintData","positionMode","spacingMode","rotateMode","offsetRotation","position","spacing","rotateMix","translateMix","PathConstraint","spaces","positions","curves","segments","findSlot","getAttachment","percentSpacing","Percent","tangents","Tangent","scale","ChainScale","boneCount","spacesCount","lengthSpacing","Length","setupLength","epsilon","computeWorldPositions","boneX","boneY","tip","Chain","PI2","percentPosition","out","verticesLength","curveCount","prevCurve","NONE","pathLength","o","curve","space","BEFORE","addBeforePosition","AFTER","addAfterPosition","prev","addCurvePosition","x1","y1","cx1","cy1","cx2","cy2","x2","y2","tmpx","tmpy","dddfx","dddfy","ddfx","ddfy","dfx","dfy","curveLength","segment","ii","temp","isNaN","tt","ttt","uu","uuu","ut","ut3","uut3","utt3","Slot","darkColor","attachmentTime","attachmentState","getSkeleton","setAttachment","time","setAttachmentTime","getAttachmentTime","attachmentName","TransformConstraint","scaleMix","shearMix","relative","applyRelativeLocal","applyAbsoluteLocal","applyRelativeWorld","applyAbsoluteWorld","tb","tc","degRadReflect","offsetShearY","modified","ts","offsetScaleX","offsetScaleY","by","Skeleton","slots","drawOrder","ikConstraints","transformConstraints","pathConstraints","_updateCache","updateCacheReset","boneData","slotData","ikConstraintData","transformConstraintData","pathConstraintData","updateCache","skinBones","ikCount","transformCount","pathCount","constraintCount","constraint","sortIkConstraint","sortTransformConstraint","sortPathConstraint","sortBone","constraints","constrained","sortReset","slotIndex","slotBone","sortPathConstraintAttachment","defaultSkin","skins","sortPathConstraintAttachmentWith","attachments","pathBones","boneIndex","setBonesToSetupPose","setSlotsToSetupPose","getRootBone","boneName","findBoneIndex","slotName","findSlotIndex","setSkinByName","skinName","findSkin","setSkin","newSkin","attachAll","getAttachmentByName","findIkConstraint","constraintName","ikConstraint","findTransformConstraint","findPathConstraint","getBounds","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","mesh","nn","Animation","timelines","timelineIds","duration","getPropertyId","hasTimeline","loop","events","binarySearch","values","step","low","high","current","linearSearch","last","CurveTimeline","BEZIER_SIZE","getFrameCount","setLinear","frameIndex","setStepped","STEPPED","getCurveType","type","BEZIER","setCurve","getCurvePercent","percent","prevX","prevY","RotateTimeline","frames","setFrame","ROTATION","setup","first","ENTRIES","PREV_ROTATION","replace","frame","prevRotation","PREV_TIME","TranslateTimeline","translate","X","Y","PREV_X","PREV_Y","ScaleTimeline","bx","mixOut","ShearTimeline","shear","ColorTimeline","R","G","B","A","PREV_R","PREV_G","PREV_B","PREV_A","TwoColorTimeline","twoColor","r2","g2","b2","R2","G2","B2","light","dark","setupLight","setupDark","PREV_R2","PREV_G2","PREV_B2","AttachmentTimeline","attachmentNames","zeros","DeformTimeline","frameVertices","firedEvents","slotAttachment","vertexCount","vertexAttachment","setupVertices","lastVertices","prevVertices","nextVertices","EventTimeline","event","MAX_VALUE","DrawOrderTimeline","drawOrders","drawOrderToSetupIndex","IkConstraintTimeline","ikConstraintIndex","MIX","SOFTNESS","BEND_DIRECTION","COMPRESS","STRETCH","PREV_MIX","PREV_SOFTNESS","PREV_BEND_DIRECTION","PREV_COMPRESS","PREV_STRETCH","mixIn","TransformConstraintTimeline","transformConstraintIndex","transformConstraint","ROTATE","TRANSLATE","SCALE","SHEAR","PREV_ROTATE","PREV_TRANSLATE","PREV_SCALE","PREV_SHEAR","PathConstraintPositionTimeline","pathConstraintIndex","pathConstraintPosition","VALUE","PREV_VALUE","PathConstraintSpacingTimeline","pathConstraintSpacing","PathConstraintMixTimeline","pathConstraintMix","AttachmentType","Event","intValue","floatValue","stringValue","volume","balance","EventData","audioPath","IkConstraintData","SkeletonData","animations","version","hash","fps","imagesPath","findEvent","eventDataName","findAnimation","animationName","animation","findPathConstraintIndex","pathConstraintName","SkinEntry","Skin","addSkin","contained","getAttachments","copySkin","dictionary","removeAttachment","entries","slotAttachments","getAttachmentsForSlot","oldSkin","SlotData","TransformConstraintData","SkeletonBinary","Fixed","attachmentLoader","linkedMeshes","readSkeletonData","binary","skeletonData","input","BinaryInput","readString","readFloat","nonessential","readBoolean","readInt","strings","TransformModeValues","readInt32","readStringRef","BlendModeValues","readByte","PositionModeValues","SpacingModeValues","RotateModeValues","readSkin","linkedMesh","inheritDeform","readAnimation","slotCount","readAttachment","typeIndex","AttachmentTypeValues","Region","BoundingBox","readVertices","box","Mesh","readFloatArray","readShortArray","LinkedMesh","Path","Point","Clipping","endSlotIndex","clip","Vertices","weights","bonesArray","readShort","tempColor1","tempColor2","timelineType","SLOT_ATTACHMENT","timeline","SLOT_COLOR","readCurve","SLOT_TWO_COLOR","BONE_ROTATE","BONE_TRANSLATE","BONE_SCALE","BONE_SHEAR","timelineScale","PATH_POSITION","PATH_SPACING","PATH_MIX","iii","nnn","weighted","deformLength","end","vn","drawOrderCount","offsetCount","unchanged","originalIndex","unchangedIndex","eventCount","eventData","CURVE_STEPPED","CURVE_BEZIER","buffer","DataView","getInt8","getInt16","getInt32","optimizePositive","result","byteCount","chars","String","fromCharCode","getFloat32","SkeletonJson","json","root","JSON","parse","skeletonMap","spine","images","boneMap","parentName","getValue","transformModeFromString","slotMap","blendModeFromString","ik","constraintMap","targetName","transform","positionModeFromString","spacingModeFromString","rotateModeFromString","skinMap","entryName","eventName","eventMap","animationMap","map","scaledVertices","timelineName","timelineMap","valueMap","deformName","deformMap","verticesValue","drawOrderNode","draworder","drawOrderMap","offsets","offsetMap","hasOwnProperty","prop","str","Vector3","z","setFrom","sub","cross","multiply","matrix","l_mat","M30","M31","M32","M33","M00","M01","M02","M03","M10","M11","M12","M13","M20","M21","M22","M23","project","l_w","distance","Matrix4","transpose","t","invert","l_det","inv_det","determinant","projection","front","back","fovy","aspectRatio","fovy_rad","top","tan","right","ortho2d","ortho","left","bottom","near","far","x_orth","y_orth","z_orth","tz","m","multiplyLeft","lookAt","up","initTemps","xAxis","yAxis","zAxis","val","tmpMatrix","OrthoCamera","fov","zoom","viewportWidth","viewportHeight","projectionView","inverseProjectionView","view","is_perspective","tmp","screenToWorld","screenCoords","screenWidth","screenHeight","worldToScreen","worldCoords","setViewport","PerspectiveCamera","if_throw","ret","Input","lastX","lastY","buttonDown","currTouch","touchesPool","Touch","listeners","setupCallbacks","mouseMove","MouseEvent","rect","getBoundingClientRect","clientX","clientY","dragged","moved","mouseUp","removeEventListener","down","touches","changedTouches","touch","identifier","addListener","listener","removeListener","idx","Shader","vertexShader","fragmentShader","vs","vsSource","fs","fsSource","program","tmp2x2","tmp3x3","tmp4x4","getProgram","getVertexShader","getFragmentShader","getVertexShaderSource","getFragmentSource","compile","compileShader","VERTEX_SHADER","FRAGMENT_SHADER","compileProgram","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","isContextLost","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","useProgram","setUniformi","uniform1i","getUniformLocation","setUniformf","uniform1f","setUniform2f","value2","uniform2f","setUniform3f","value3","uniform3f","setUniform4f","value4","uniform4f","setUniform2x2f","uniformMatrix2fv","setUniform3x3f","uniformMatrix3fv","setUniform4x4f","uniformMatrix4fv","location","getAttributeLocation","attribute","getAttribLocation","newColoredTextured","POSITION","COLOR","TEXCOORDS","MVP_MATRIX","newTwoColoredTextured","COLOR2","newColored","attributes","verticesBuffer","dirtyVertices","indices","indicesBuffer","indicesLength","dirtyIndices","elementsPerVertex","getAttributes","maxVertices","numVertices","setVerticesLength","getVertices","maxIndices","numIndices","setIndicesLength","getIndices","getVertexSizeInFloats","Uint16Array","setVertices","setIndices","draw","primitiveType","drawWithOffset","drawElements","UNSIGNED_SHORT","drawArrays","bindBuffer","ARRAY_BUFFER","attrib","enableVertexAttribArray","vertexAttribPointer","FLOAT","ELEMENT_ARRAY_BUFFER","disableVertexAttribArray","createBuffer","bufferData","subarray","DYNAMIC_DRAW","deleteBuffer","VertexAttribute","Position2Attribute","VertexAttributeType","Float","TexCoordAttribute","ColorAttribute","Color2Attribute","ShapeType","ResizeMode","EventType","PolygonBatcher","drawCalls","isDrawing","lastTexture","srcBlend","dstBlend","twoColorTint","begin","enable","BLEND","blendFunc","setBlendMode","flush","indexStart","indicesArray","TRIANGLES","disable","getDrawCalls","ShapeRenderer","shapeType","Filled","vertexIndex","setColor","setColorWith","check","vertex","Line","triangle","filled","x3","y3","color2","color3","quad","x4","y4","color4","rectLine","polygon","polygonVertices","firstX","firstY","circle","radius","subdiv_step","subdiv_step2","subdiv_step3","pre1","pre2","pre4","pre5","tmp1x","tmp1y","tmp2x","tmp2y","fx","fy","SkeletonBounds","boundingBoxes","polygons","polygonPool","updateAabb","boundingBox","aabbCompute","aabbContainsPoint","aabbIntersectsSegment","aabbIntersectsSkeleton","bounds","containsPoint","containsPointPolygon","prevIndex","inside","vertexY","vertexX","intersectsSegment","intersectsSegmentPolygon","width12","height12","det1","det2","width34","height34","det3","getPolygon","getWidth","getHeight","SkeletonDebugRenderer","boneLineColor","boneOriginColor","attachmentLineColor","triangleLineColor","pathColor","clipColor","aabbColor","drawBones","drawRegionAttachments","drawBoundingBoxes","drawMeshHull","drawMeshTriangles","drawPaths","drawSkeletonXY","drawClipping","boneWidth","shapes","ignoredBones","skeletonX","skeletonY","srcFunc","regionAttachment","v1","v3","boxes","LIGHT_GRAY","GREEN","Triangulator","convexPolygons","convexPolygonsIndices","isConcaveArray","polygonIndicesPool","triangulate","verticesArray","isConcave","previous","next","p1","p2","p3","p1x","p1y","p2x","p2y","p3x","p3y","positiveArea","previousIndex","nextIndex","decompose","polygonIndices","fanBaseIndex","lastWinding","t1","t2","t3","merged","winding1","winding","winding2","firstIndex","lastIndex","prevPrevX","prevPrevY","secondX","secondY","otherIndices","otherFirstIndex","otherSecondIndex","otherLastIndex","otherPoly","SkeletonClipping","triangulator","clippingPolygon","clipOutput","clippedVertices","clippedTriangles","scratch","clipAttachment","clippingPolygons","clipStart","makeClockwise","clipEndWithSlot","clipEnd","isClipping","clipTriangles","trianglesLength","polygonsCount","vertexSize","u1","u3","clippedVerticesItems","clippedTrianglesItems","clipOutputLength","d0","d1","d2","d4","clipOutputCount","clipOutputItems","c0","clippingArea","output","originalOutput","clipped","clippingVertices","clippingVerticesLast","edgeX","edgeY","edgeX2","edgeY2","deltaX","deltaY","inputVertices","inputVerticesLength","outputStart","inputX","inputY","inputX2","inputY2","side2","ua","verticeslength","area","Renderable","numFloats","SkeletonRenderer","vertexEffect","renderable","clipper","temp2","temp3","temp4","batcher","slotRangeStart","slotRangeEnd","tempPos","tempUv","tempLight","tempDark","attachmentColor","skeletonColor","inRange","clippedVertexSize","QUAD_TRIANGLES","slotColor","finalColor","slotBlendMode","verts","SceneRenderer","orthoCamera","perspectiveCamera","camera","batcherShader","shapesShader","activeRenderer","skeletonRenderer","skeletonDebugRenderer","QUAD","WHITE","enableRenderer","drawSkeleton","drawSkeletonDebug","drawTexture","drawTextureUV","drawTextureRotated","pivotX","pivotY","worldOriginX","worldOriginY","fx2","fy2","p4x","p4y","drawRegion","resize","resizeMode","clientWidth","h","clientHeight","viewport","Stretch","Expand","Fit","sourceWidth","sourceHeight","targetWidth","targetHeight","renderer","LoadingScreen","logo","spinner","fadeOut","timeKeeper","backgroundColor","firstDraw","logoImg","isSafari","navigator","userAgent","SPINE_LOGO_DATA","spinnerImg","SPINNER_DATA","complete","FADE_SECONDS","clearColor","COLOR_BUFFER_BIT","logoWidth","logoHeight","spinnerWidth","spinnerHeight","AnimationState","tracks","timeScale","unkeyedState","queue","EventQueue","propertyIDs","animationsChanged","trackEntryPool","TrackEntry","animationLast","nextAnimationLast","trackLast","nextTrackLast","currentDelta","delay","nextTime","trackTime","setCurrent","mixingFrom","mixTime","trackEnd","disposeNext","updateMixingFrom","from","mixingTo","drain","to","finished","mixDuration","totalAlpha","interruptAlpha","_animationsChanged","applied","mixBlend","applyMixingFrom","animationTime","getAnimationTime","timelineCount","applyAttachmentTimeline","timelineMode","firstFrame","timelinesRotation","timelineBlend","SUBSEQUENT","applyRotateTimeline","queueEvents","setupState","SETUP","eventThreshold","attachmentThreshold","drawOrderThreshold","alphaHold","alphaMix","timelineHoldMix","FIRST","HOLD","holdMix","CURRENT","rotateTimeline","total","diff","lastTotal","lastDiff","dir","entry","animationStart","animationEnd","trackLastWrapped","clearTracks","oldDrainDisabled","drainDisabled","clearTrack","trackIndex","interrupt","expandToIndex","setAnimation","setAnimationWith","trackEntry","addAnimation","addAnimationWith","getMix","setEmptyAnimation","emptyAnimation","addEmptyAnimation","setEmptyAnimations","holdPrevious","computeHold","timelinesCount","timelineDipMix","HOLD_MIX","getCurrent","clearListeners","clearListenerNotifications","setAnimationLast","isComplete","resetRotationDirections","objects","animState","AnimationStateData","animationToMixTime","defaultMix","setMix","fromName","toName","setMixWith","ActionName","PlayAnimationAction","actionData","startPosition","endPosition","currentAnimation","getRandomPosition","currentPos","half","rand","SetAnimation","actor","startPosYScaled","config","startPosY","setPositionY","animViewport","includes","GetAnimations","UpdatePhysics","deltaSecs","getPosition","setPosition","setVelocity","getMovementSpeedX","getMovementSpeedY","WanderAction","WalkToAction","startDir","reachedDestination","InitAnimationState","PaceAroundAction","tempPosition","z1","z2","getPosition3","getMovementSpeedZ","Actor","animationState","paused","playTime","speed","lastAnimation","prevAnimViewport","defaultBB","movementSpeed","velocity","currentAction","load_attempts","max_load_attempts","load_perma_failed","loadedWhen","getTime","ResetWithConfig","startPosX","getPositionX","getPositionY","getPositionZ","setPositionX","setPositionZ","getMovmentSpeed","getMovmentSpeed3","setMovementSpeedX","setMovementSpeedY","setMovementSpeedZ","setMovementSpeed","defaultMovementSpeedPxZ","getVelocity","getVelocity3","InitAnimations","initAnimationsInternal","movementSpeedPxX","movementSpeedPxY","movementSpeedPxZ","defaultMovementSpeedPxX","defaultMovementSpeedPxY","actionName","PLAY_ANIMATION","WANDER","WALK_TO","PACE_AROUND","ParseActionNameToAction","action","action_data","setSkeletonMovementData","stateData","animation_listener","GetUsernameHeaderHeight","finalHeight","chibiId","avg_height","extraOffsetY","extraOffsetX","recordAnimation","setAnimationState","maxSizePx","ratio","xNew","yNew","newScaleX","newScaleY","defaultScaleX","defaultScaleY","calculateAnimationViewport","getDefaultBoundingBox","animationPlaySpeed","lastTrackEntry","offsetAvg","sizeAvg","num_processed","savedX","savedY","isFinite","stepTime","Slider","snaps","snapPercentage","big","slider","knob","change","render","findWithClass","setValue","dragging","classList","percentage","modulo","style","SpinePlayer","sceneRenderer","dom","playerControls","textCanvas","textCanvasContext","timelineSlider","playButton","loadingScreen","assetManager","actors","Map","playerConfig","stopRequestAnimationFrame","lastRequestAnimationFrameId","windowFpsFrameCount","webSocket","renderCallbacks","getElementById","validatePlayerConfig","appendChild","setupDom","setWebsocket","fullScreenBackgroundColor","showControls","runtimeDebugInfoDumpIntervalSec","textSize","textFont","cameraPerspectiveNear","cameraPerspectiveFar","validateActorConfig","jsonUrl","skelUrl","atlasUrl","widget","msg","escapeHtml","stringify","configScaleX","configScaleY","crypto","randomUUID","userDisplayName","isAlphanumeric","showError","errorDom","innerHTML","hideError","findWithId","webglConfig","configurePerspectiveCamera","requestAnimationFrame","drawFrame","performance","mark","setInterval","callbackSendRuntimeUpdateInfo","onclick","play","pause","window","onresize","setupInput","measure","averageFps","payload","type_name","average_fps","changeOrAddActor","actorName","has","setupActor","getActor","getActorNames","removeActor","delete","rawDataURIs","backgroundImage","drawText","xpx","ypx","textpos","ctx","save","font","textBaseline","measureText","actualBoundingBoxAscent","actualBoundingBoxDescent","beginPath","fillStyle","fillRect","fill","fillText","getPerspectiveCameraZOffset","fovY","cam","updateCameraSettings","requestNextFrame","doc","isFullscreen","fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement","bg","clearRect","actorsZOrder","sort","all_actors_loaded","loadSkeleton","animationDuration","bgImage","debugRender","actor_pos","BLUE","ORANGE","RED","broadcastRenderCallback","registerRenderCallback","callback","filter","jsonText","forEach","cancelId","mouseOverControls","mouseOverCanvas","handleHover","TouchEvent","mouseX","mouseY","popup","overlap","clearTimeout","setTimeout","getSceneRenderer","found","findRecursive","className","html","test","Runtime","socket","spinePlayer","spinePlayerConfig","actorConfig","defaultBackoffTimeMsec","backoffTimeMsec","backOffMaxtimeMsec","channelName","runtimeConfig","debugMode","chibiScale","FontFace","then","fonts","openWebSocket","padLeft","padRight","padTop","padBottom","websocketPath","protocol","host","WebSocket","messageHandler","requestData","swapCharacter","removeCharacter","username","configMaxPixelSize","referenceMovementSpeedPx","referenceMovementSpeedPz","getRuntimeConfigFromQueryParams","searchParams","containerWidth","containerHeight","container","isInteger","setContainerSizeFromQuery"],"sourceRoot":""}