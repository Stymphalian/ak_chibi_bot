{"version":3,"file":"43.7ea36d5bf66ae78cb53c.js","mappings":"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","sources":["webpack://spine/./src/core/Texture.ts","webpack://spine/./src/core/BlendMode.ts","webpack://spine/./src/core/BoneData.ts","webpack://spine/./src/core/PathConstraintData.ts","webpack://spine/./src/core/Animation.ts","webpack://spine/./src/core/TextureAtlas.ts","webpack://spine/./src/core/AssetManager.ts","webpack://spine/./src/webgl/WebGL.ts","webpack://spine/./src/webgl/GLTexture.ts","webpack://spine/./src/webgl/AssetManager.ts","webpack://spine/./src/core/Utils.ts","webpack://spine/./src/core/attachments/Attachment.ts","webpack://spine/./src/core/attachments/BoundingBoxAttachment.ts","webpack://spine/./src/core/attachments/ClippingAttachment.ts","webpack://spine/./src/core/attachments/MeshAttachment.ts","webpack://spine/./src/core/attachments/PathAttachment.ts","webpack://spine/./src/core/attachments/PointAttachment.ts","webpack://spine/./src/core/attachments/RegionAttachment.ts","webpack://spine/./src/core/AtlasAttachmentLoader.ts","webpack://spine/./src/core/Bone.ts","webpack://spine/./src/core/IkConstraint.ts","webpack://spine/./src/core/ConstraintData.ts","webpack://spine/./src/core/PathConstraint.ts","webpack://spine/./src/core/Slot.ts","webpack://spine/./src/core/TransformConstraint.ts","webpack://spine/./src/core/Skeleton.ts","webpack://spine/./src/core/attachments/AttachmentType.ts","webpack://spine/./src/core/Event.ts","webpack://spine/./src/core/EventData.ts","webpack://spine/./src/core/IkConstraintData.ts","webpack://spine/./src/core/SkeletonData.ts","webpack://spine/./src/core/Skin.ts","webpack://spine/./src/core/SlotData.ts","webpack://spine/./src/core/TransformConstraintData.ts","webpack://spine/./src/core/SkeletonBinary.ts","webpack://spine/./src/core/SkeletonJson.ts","webpack://spine/./src/webgl/Input.ts","webpack://spine/./src/webgl/Vector3.ts","webpack://spine/./src/webgl/Matrix4.ts","webpack://spine/./src/webgl/Camera.ts","webpack://spine/./src/webgl/Shader.ts","webpack://spine/./src/webgl/Mesh.ts","webpack://spine/./src/webgl/ShapeRenderer.ts","webpack://spine/./src/webgl/SceneRenderer.ts","webpack://spine/./src/core/AnimationState.ts","webpack://spine/./src/webgl/PolygonBatcher.ts","webpack://spine/./src/core/SkeletonBounds.ts","webpack://spine/./src/webgl/SkeletonDebugRenderer.ts","webpack://spine/./src/core/Triangulator.ts","webpack://spine/./src/core/SkeletonClipping.ts","webpack://spine/./src/webgl/SkeletonRenderer.ts","webpack://spine/./src/webgl/LoadingScreen.ts","webpack://spine/./src/core/AnimationStateData.ts","webpack://spine/./src/player/Action.ts","webpack://spine/./src/player/Actor.ts","webpack://spine/./src/player/Utils.ts","webpack://spine/./src/player/Player.ts","webpack://spine/./src/stym/runtime.ts","webpack://spine/./src/stym/utils.ts"],"sourcesContent":["/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\n// module spine {\r\n\texport abstract class Texture {\r\n\t\tprotected _image: HTMLImageElement;\r\n\r\n\t\tconstructor (image: HTMLImageElement) {\r\n\t\t\tthis._image = image;\r\n\t\t}\r\n\r\n\t\tgetImage (): HTMLImageElement {\r\n\t\t\treturn this._image;\r\n\t\t}\r\n\r\n\t\tabstract setFilters (minFilter: TextureFilter, magFilter: TextureFilter): void;\r\n\t\tabstract setWraps (uWrap: TextureWrap, vWrap: TextureWrap): void;\r\n\t\tabstract dispose (): void;\r\n\r\n\t\tpublic static filterFromString (text: string): TextureFilter {\r\n\t\t\tswitch (text.toLowerCase()) {\r\n\t\t\t\tcase \"nearest\": return TextureFilter.Nearest;\r\n\t\t\t\tcase \"linear\": return TextureFilter.Linear;\r\n\t\t\t\tcase \"mipmap\": return TextureFilter.MipMap;\r\n\t\t\t\tcase \"mipmapnearestnearest\": return TextureFilter.MipMapNearestNearest;\r\n\t\t\t\tcase \"mipmaplinearnearest\": return TextureFilter.MipMapLinearNearest;\r\n\t\t\t\tcase \"mipmapnearestlinear\": return TextureFilter.MipMapNearestLinear;\r\n\t\t\t\tcase \"mipmaplinearlinear\": return TextureFilter.MipMapLinearLinear;\r\n\t\t\t\tdefault: throw new Error(`Unknown texture filter ${text}`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic static wrapFromString (text: string): TextureWrap {\r\n\t\t\tswitch (text.toLowerCase()) {\r\n\t\t\t\tcase \"mirroredtepeat\": return TextureWrap.MirroredRepeat;\r\n\t\t\t\tcase \"clamptoedge\": return TextureWrap.ClampToEdge;\r\n\t\t\t\tcase \"repeat\": return TextureWrap.Repeat;\r\n\t\t\t\tdefault: throw new Error(`Unknown texture wrap ${text}`);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport enum TextureFilter {\r\n\t\tNearest = 9728, // WebGLRenderingContext.NEAREST\r\n\t\tLinear = 9729, // WebGLRenderingContext.LINEAR\r\n\t\tMipMap = 9987, // WebGLRenderingContext.LINEAR_MIPMAP_LINEAR\r\n\t\tMipMapNearestNearest = 9984, // WebGLRenderingContext.NEAREST_MIPMAP_NEAREST\r\n\t\tMipMapLinearNearest = 9985, // WebGLRenderingContext.LINEAR_MIPMAP_NEAREST\r\n\t\tMipMapNearestLinear = 9986, // WebGLRenderingContext.NEAREST_MIPMAP_LINEAR\r\n\t\tMipMapLinearLinear = 9987 // WebGLRenderingContext.LINEAR_MIPMAP_LINEAR\r\n\t}\r\n\r\n\texport enum TextureWrap {\r\n\t\tMirroredRepeat = 33648, // WebGLRenderingContext.MIRRORED_REPEAT\r\n\t\tClampToEdge = 33071, // WebGLRenderingContext.CLAMP_TO_EDGE\r\n\t\tRepeat = 10497 // WebGLRenderingContext.REPEAT\r\n\t}\r\n\r\n\texport class TextureRegion {\r\n\t\trenderObject: any;\r\n\t\tu = 0; v = 0;\r\n\t\tu2 = 0; v2 = 0;\r\n\t\twidth = 0; height = 0;\r\n\t\trotate = false;\r\n\t\toffsetX = 0; offsetY = 0;\r\n\t\toriginalWidth = 0; originalHeight = 0;\r\n\t}\r\n\r\n\texport class FakeTexture extends Texture {\r\n\t\tsetFilters(minFilter: TextureFilter, magFilter: TextureFilter) { }\r\n\t\tsetWraps(uWrap: TextureWrap, vWrap: TextureWrap) { }\r\n\t\tdispose() { }\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\n// module spine {\r\n\r\n\t/** Determines how images are blended with existing pixels when drawn. */\r\n\texport enum BlendMode {\r\n\t\tNormal,\r\n\t\tAdditive,\r\n\t\tMultiply,\r\n\t\tScreen\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Color } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the setup pose for a {@link Bone}. */\r\n\texport class BoneData {\r\n\t\t/** The index of the bone in {@link Skeleton#getBones()}. */\r\n\t\tindex: number;\r\n\r\n\t\t/** The name of the bone, which is unique across all bones in the skeleton. */\r\n\t\tname: string;\r\n\r\n\t\t/** @returns May be null. */\r\n\t\tparent: BoneData;\r\n\r\n\t\t/** The bone's length. */\r\n\t\tlength: number;\r\n\r\n\t\t/** The local x translation. */\r\n\t\tx = 0;\r\n\r\n\t\t/** The local y translation. */\r\n\t\ty = 0;\r\n\r\n\t\t/** The local rotation. */\r\n\t\trotation = 0;\r\n\r\n\t\t/** The local scaleX. */\r\n\t\tscaleX = 1;\r\n\r\n\t\t/** The local scaleY. */\r\n\t\tscaleY = 1;\r\n\r\n\t\t/** The local shearX. */\r\n\t\tshearX = 0;\r\n\r\n\t\t/** The local shearX. */\r\n\t\tshearY = 0;\r\n\r\n\t\t/** The transform mode for how parent world transforms affect this bone. */\r\n\t\ttransformMode = TransformMode.Normal;\r\n\r\n\t\t/** When true, {@link Skeleton#updateWorldTransform()} only updates this bone if the {@link Skeleton#skin} contains this\r\n\t \t* bone.\r\n\t \t* @see Skin#bones */\r\n\t\tskinRequired = false;\r\n\r\n\t\t/** The color of the bone as it was in Spine. Available only when nonessential data was exported. Bones are not usually\r\n\t\t * rendered at runtime. */\r\n\t\tcolor = new Color();\r\n\r\n\t\tconstructor (index: number, name: string, parent: BoneData) {\r\n\t\t\tif (index < 0) throw new Error(\"index must be >= 0.\");\r\n\t\t\tif (name == null) throw new Error(\"name cannot be null.\");\r\n\t\t\tthis.index = index;\r\n\t\t\tthis.name = name;\r\n\t\t\tthis.parent = parent;\r\n\t\t}\r\n\t}\r\n\r\n\t/** Determines how a bone inherits world transforms from parent bones. */\r\n\texport enum TransformMode {\r\n\t\tNormal, OnlyTranslation, NoRotationOrReflection, NoScale, NoScaleOrReflection\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BoneData } from \"./BoneData\";\r\nimport { ConstraintData } from \"./ConstraintData\";\r\nimport { SlotData } from \"./SlotData\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the setup pose for a {@link PathConstraint}.\r\n\t *\r\n\t * See [Path constraints](http://esotericsoftware.com/spine-path-constraints) in the Spine User Guide. */\r\n\texport class PathConstraintData extends ConstraintData {\r\n\r\n\t\t/** The bones that will be modified by this path constraint. */\r\n\t\tbones = new Array<BoneData>();\r\n\r\n\t\t/** The slot whose path attachment will be used to constrained the bones. */\r\n\t\ttarget: SlotData;\r\n\r\n\t\t/** The mode for positioning the first bone on the path. */\r\n\t\tpositionMode: PositionMode;\r\n\r\n\t\t/** The mode for positioning the bones after the first bone on the path. */\r\n\t\tspacingMode: SpacingMode;\r\n\r\n\t\t/** The mode for adjusting the rotation of the bones. */\r\n\t\trotateMode: RotateMode;\r\n\r\n\t\t/** An offset added to the constrained bone rotation. */\r\n\t\toffsetRotation: number;\r\n\r\n\t\t/** The position along the path. */\r\n\t\tposition: number;\r\n\r\n\t\t/** The spacing between bones. */\r\n\t\tspacing: number;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained rotations. */\r\n\t\trotateMix: number;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained translations. */\r\n\t\ttranslateMix: number;\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name, 0, false);\r\n\t\t}\r\n\t}\r\n\r\n\t/** Controls how the first bone is positioned along the path.\r\n\t *\r\n\t * See [Position mode](http://esotericsoftware.com/spine-path-constraints#Position-mode) in the Spine User Guide. */\r\n\texport enum PositionMode {\r\n\t\tFixed, Percent\r\n\t}\r\n\r\n\t/** Controls how bones after the first bone are positioned along the path.\r\n\t *\r\n\t * [Spacing mode](http://esotericsoftware.com/spine-path-constraints#Spacing-mode) in the Spine User Guide. */\r\n\texport enum SpacingMode {\r\n\t\tLength, Fixed, Percent\r\n\t}\r\n\r\n\t/** Controls how bones are rotated, translated, and scaled to match the path.\r\n\t *\r\n\t * [Rotate mode](http://esotericsoftware.com/spine-path-constraints#Rotate-mod) in the Spine User Guide. */\r\n\texport enum RotateMode {\r\n\t\tTangent, Chain, ChainScale\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { VertexAttachment, Attachment } from \"./attachments/Attachment\";\r\nimport { IkConstraint } from \"./IkConstraint\";\r\nimport { PathConstraint } from \"./PathConstraint\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Slot } from \"./Slot\";\r\nimport { TransformConstraint } from \"./TransformConstraint\";\r\nimport { Utils, MathUtils, ArrayLike } from \"./Utils\";\r\nimport { Event } from \"./Event\";\r\n\r\n// module spine {\r\n\r\n\t/** A simple container for a list of timelines and a name. */\r\n\texport class Animation {\r\n\t\t/** The animation's name, which is unique across all animations in the skeleton. */\r\n\t\tname: string;\r\n\t\ttimelines: Array<Timeline>;\r\n\t\ttimelineIds: Array<boolean>;\r\n\r\n\t\t/** The duration of the animation in seconds, which is the highest time of all keys in the timeline. */\r\n\t\tduration: number;\r\n\r\n\t\tconstructor (name: string, timelines: Array<Timeline>, duration: number) {\r\n\t\t\tif (name == null) throw new Error(\"name cannot be null.\");\r\n\t\t\tif (timelines == null) throw new Error(\"timelines cannot be null.\");\r\n\t\t\tthis.name = name;\r\n\t\t\tthis.timelines = timelines;\r\n\t\t\tthis.timelineIds = [];\r\n\t\t\tfor (var i = 0; i < timelines.length; i++)\r\n\t\t\t\tthis.timelineIds[timelines[i].getPropertyId()] = true;\r\n\t\t\tthis.duration = duration;\r\n\t\t}\r\n\r\n\t\thasTimeline (id: number) {\r\n\t\t\treturn this.timelineIds[id] == true;\r\n\t\t}\r\n\r\n\t\t/** Applies all the animation's timelines to the specified skeleton.\r\n\t\t *\r\n\t\t * See Timeline {@link Timeline#apply(Skeleton, float, float, Array, float, MixBlend, MixDirection)}.\r\n\t\t * @param loop If true, the animation repeats after {@link #getDuration()}.\r\n\t\t * @param events May be null to ignore fired events. */\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, loop: boolean, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\r\n\t\t\tif (loop && this.duration != 0) {\r\n\t\t\t\ttime %= this.duration;\r\n\t\t\t\tif (lastTime > 0) lastTime %= this.duration;\r\n\t\t\t}\r\n\r\n\t\t\tlet timelines = this.timelines;\r\n\t\t\tfor (let i = 0, n = timelines.length; i < n; i++)\r\n\t\t\t\ttimelines[i].apply(skeleton, lastTime, time, events, alpha, blend, direction);\r\n\t\t}\r\n\r\n\t\t/** @param target After the first and before the last value.\r\n\t \t * @returns index of first value greater than the target. */\r\n\t\tstatic binarySearch (values: ArrayLike<number>, target: number, step: number = 1) {\r\n\t\t\tlet low = 0;\r\n\t\t\tlet high = values.length / step - 2;\r\n\t\t\tif (high == 0) return step;\r\n\t\t\tlet current = high >>> 1;\r\n\t\t\twhile (true) {\r\n\t\t\t\tif (values[(current + 1) * step] <= target)\r\n\t\t\t\t\tlow = current + 1;\r\n\t\t\t\telse\r\n\t\t\t\t\thigh = current;\r\n\t\t\t\tif (low == high) return (low + 1) * step;\r\n\t\t\t\tcurrent = (low + high) >>> 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic linearSearch (values: ArrayLike<number>, target: number, step: number) {\r\n\t\t\tfor (let i = 0, last = values.length - step; i <= last; i += step)\r\n\t\t\t\tif (values[i] > target) return i;\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\t/** The interface for all timelines. */\r\n\texport interface Timeline {\r\n\t\t/** Applies this timeline to the skeleton.\r\n\t\t * @param skeleton The skeleton the timeline is being applied to. This provides access to the bones, slots, and other\r\n\t\t *           skeleton components the timeline may change.\r\n\t\t * @param lastTime The time this timeline was last applied. Timelines such as {@link EventTimeline}} trigger only at specific\r\n\t\t *           times rather than every frame. In that case, the timeline triggers everything between `lastTime`\r\n\t\t *           (exclusive) and `time` (inclusive).\r\n\t\t * @param time The time within the animation. Most timelines find the key before and the key after this time so they can\r\n\t\t *           interpolate between the keys.\r\n\t\t * @param events If any events are fired, they are added to this list. Can be null to ignore fired events or if the timeline\r\n\t\t *           does not fire events.\r\n\t\t * @param alpha 0 applies the current or setup value (depending on `blend`). 1 applies the timeline value.\r\n\t\t *           Between 0 and 1 applies a value between the current or setup value and the timeline value. By adjusting\r\n\t\t *           `alpha` over time, an animation can be mixed in or out. `alpha` can also be useful to\r\n\t\t *           apply animations on top of each other (layering).\r\n\t\t * @param blend Controls how mixing is applied when `alpha` < 1.\r\n\t\t * @param direction Indicates whether the timeline is mixing in or out. Used by timelines which perform instant transitions,\r\n\t\t *           such as {@link DrawOrderTimeline} or {@link AttachmentTimeline}. */\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection): void;\r\n\r\n\t\t/** Uniquely encodes both the type of this timeline and the skeleton property that it affects. */\r\n\t\tgetPropertyId (): number;\r\n\t}\r\n\r\n\t/** Controls how a timeline value is mixed with the setup pose value or current pose value when a timeline's `alpha`\r\n\t * < 1.\r\n\t *\r\n\t * See Timeline {@link Timeline#apply(Skeleton, float, float, Array, float, MixBlend, MixDirection)}. */\r\n\texport enum MixBlend {\r\n\t\t/** Transitions from the setup value to the timeline value (the current value is not used). Before the first key, the setup\r\n\t\t * value is set. */\r\n\t\tsetup,\r\n\t\t/** Transitions from the current value to the timeline value. Before the first key, transitions from the current value to\r\n\t\t * the setup value. Timelines which perform instant transitions, such as {@link DrawOrderTimeline} or\r\n\t\t * {@link AttachmentTimeline}, use the setup value before the first key.\r\n\t\t *\r\n\t\t * `first` is intended for the first animations applied, not for animations layered on top of those. */\r\n\t\tfirst,\r\n\t\t/** Transitions from the current value to the timeline value. No change is made before the first key (the current value is\r\n\t\t * kept until the first key).\r\n\t\t *\r\n\t\t * `replace` is intended for animations layered on top of others, not for the first animations applied. */\r\n\t\treplace,\r\n\t\t/** Transitions from the current value to the current value plus the timeline value. No change is made before the first key\r\n\t\t * (the current value is kept until the first key).\r\n\t\t *\r\n\t\t * `add` is intended for animations layered on top of others, not for the first animations applied. Properties\r\n\t\t * keyed by additive animations must be set manually or by another animation before applying the additive animations, else\r\n\t\t * the property values will increase continually. */\r\n\t\tadd\r\n\t}\r\n\r\n\t/** Indicates whether a timeline's `alpha` is mixing out over time toward 0 (the setup or current pose value) or\r\n\t * mixing in toward 1 (the timeline's value).\r\n\t *\r\n\t * See Timeline {@link Timeline#apply(Skeleton, float, float, Array, float, MixBlend, MixDirection)}. */\r\n\texport enum MixDirection {\r\n\t\tmixIn, mixOut\r\n\t}\r\n\r\n\texport enum TimelineType {\r\n\t\trotate, translate, scale, shear,\r\n\t\tattachment, color, deform,\r\n\t\tevent, drawOrder,\r\n\t\tikConstraint, transformConstraint,\r\n\t\tpathConstraintPosition, pathConstraintSpacing, pathConstraintMix,\r\n\t\ttwoColor\r\n\t}\r\n\r\n\t/** The base class for timelines that use interpolation between key frame values. */\r\n\texport abstract class CurveTimeline implements Timeline {\r\n\t\tstatic LINEAR = 0; static STEPPED = 1; static BEZIER = 2;\r\n\t\tstatic BEZIER_SIZE = 10 * 2 - 1;\r\n\r\n\t\tprivate curves: ArrayLike<number>; // type, x, y, ...\r\n\r\n\t\tabstract getPropertyId(): number;\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tif (frameCount <= 0) throw new Error(\"frameCount must be > 0: \" + frameCount);\r\n\t\t\tthis.curves = Utils.newFloatArray((frameCount - 1) * CurveTimeline.BEZIER_SIZE);\r\n\t\t}\r\n\r\n\t\t/** The number of key frames for this timeline. */\r\n\t\tgetFrameCount () {\r\n\t\t\treturn this.curves.length / CurveTimeline.BEZIER_SIZE + 1;\r\n\t\t}\r\n\r\n\t\t/** Sets the specified key frame to linear interpolation. */\r\n\t\tsetLinear (frameIndex: number) {\r\n\t\t\tthis.curves[frameIndex * CurveTimeline.BEZIER_SIZE] = CurveTimeline.LINEAR;\r\n\t\t}\r\n\r\n\t\t/** Sets the specified key frame to stepped interpolation. */\r\n\t\tsetStepped (frameIndex: number) {\r\n\t\t\tthis.curves[frameIndex * CurveTimeline.BEZIER_SIZE] = CurveTimeline.STEPPED;\r\n\t\t}\r\n\r\n\t\t/** Returns the interpolation type for the specified key frame.\r\n\t\t * @returns Linear is 0, stepped is 1, Bezier is 2. */\r\n\t\tgetCurveType (frameIndex: number): number {\r\n\t\t\tlet index = frameIndex * CurveTimeline.BEZIER_SIZE;\r\n\t\t\tif (index == this.curves.length) return CurveTimeline.LINEAR;\r\n\t\t\tlet type = this.curves[index];\r\n\t\t\tif (type == CurveTimeline.LINEAR) return CurveTimeline.LINEAR;\r\n\t\t\tif (type == CurveTimeline.STEPPED) return CurveTimeline.STEPPED;\r\n\t\t\treturn CurveTimeline.BEZIER;\r\n\t\t}\r\n\r\n\t\t/** Sets the specified key frame to Bezier interpolation. `cx1` and `cx2` are from 0 to 1,\r\n\t\t * representing the percent of time between the two key frames. `cy1` and `cy2` are the percent of the\r\n\t\t * difference between the key frame's values. */\r\n\t\tsetCurve (frameIndex: number, cx1: number, cy1: number, cx2: number, cy2: number) {\r\n\t\t\tlet tmpx = (-cx1 * 2 + cx2) * 0.03, tmpy = (-cy1 * 2 + cy2) * 0.03;\r\n\t\t\tlet dddfx = ((cx1 - cx2) * 3 + 1) * 0.006, dddfy = ((cy1 - cy2) * 3 + 1) * 0.006;\r\n\t\t\tlet ddfx = tmpx * 2 + dddfx, ddfy = tmpy * 2 + dddfy;\r\n\t\t\tlet dfx = cx1 * 0.3 + tmpx + dddfx * 0.16666667, dfy = cy1 * 0.3 + tmpy + dddfy * 0.16666667;\r\n\r\n\t\t\tlet i = frameIndex * CurveTimeline.BEZIER_SIZE;\r\n\t\t\tlet curves = this.curves;\r\n\t\t\tcurves[i++] = CurveTimeline.BEZIER;\r\n\r\n\t\t\tlet x = dfx, y = dfy;\r\n\t\t\tfor (let n = i + CurveTimeline.BEZIER_SIZE - 1; i < n; i += 2) {\r\n\t\t\t\tcurves[i] = x;\r\n\t\t\t\tcurves[i + 1] = y;\r\n\t\t\t\tdfx += ddfx;\r\n\t\t\t\tdfy += ddfy;\r\n\t\t\t\tddfx += dddfx;\r\n\t\t\t\tddfy += dddfy;\r\n\t\t\t\tx += dfx;\r\n\t\t\t\ty += dfy;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Returns the interpolated percentage for the specified key frame and linear percentage. */\r\n\t\tgetCurvePercent (frameIndex: number, percent: number) {\r\n\t\t\tpercent = MathUtils.clamp(percent, 0, 1);\r\n\t\t\tlet curves = this.curves;\r\n\t\t\tlet i = frameIndex * CurveTimeline.BEZIER_SIZE;\r\n\t\t\tlet type = curves[i];\r\n\t\t\tif (type == CurveTimeline.LINEAR) return percent;\r\n\t\t\tif (type == CurveTimeline.STEPPED) return 0;\r\n\t\t\ti++;\r\n\t\t\tlet x = 0;\r\n\t\t\tfor (let start = i, n = i + CurveTimeline.BEZIER_SIZE - 1; i < n; i += 2) {\r\n\t\t\t\tx = curves[i];\r\n\t\t\t\tif (x >= percent) {\r\n\t\t\t\t\tlet prevX: number, prevY: number;\r\n\t\t\t\t\tif (i == start) {\r\n\t\t\t\t\t\tprevX = 0;\r\n\t\t\t\t\t\tprevY = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tprevX = curves[i - 2];\r\n\t\t\t\t\t\tprevY = curves[i - 1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn prevY + (curves[i + 1] - prevY) * (percent - prevX) / (x - prevX);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet y = curves[i - 1];\r\n\t\t\treturn y + (1 - y) * (percent - x) / (1 - x); // Last point is 1,1.\r\n\t\t}\r\n\r\n\t\tabstract apply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection): void;\r\n\t}\r\n\r\n\t/** Changes a bone's local {@link Bone#rotation}. */\r\n\texport class RotateTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 2;\r\n\t\tstatic PREV_TIME = -2; static PREV_ROTATION = -1;\r\n\t\tstatic ROTATION = 1;\r\n\r\n\t\t/** The index of the bone in {@link Skeleton#bones} that will be changed. */\r\n\t\tboneIndex: number;\r\n\r\n\t\t/** The time in seconds and rotation in degrees for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, degrees, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount << 1);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.rotate << 24) + this.boneIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time and angle of the specified keyframe. */\r\n\t\tsetFrame (frameIndex: number, time: number, degrees: number) {\r\n\t\t\tframeIndex <<= 1;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + RotateTimeline.ROTATION] = degrees;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\r\n\t\t\tlet bone = skeleton.bones[this.boneIndex];\r\n\t\t\tif (!bone.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tbone.rotation = bone.data.rotation;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tlet r = bone.data.rotation - bone.rotation;\r\n\t\t\t\t\tbone.rotation += (r - (16384 - ((16384.499999999996 - r / 360) | 0)) * 360) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (time >= frames[frames.length - RotateTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tlet r = frames[frames.length + RotateTimeline.PREV_ROTATION];\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tbone.rotation = bone.data.rotation + r * alpha;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\tcase MixBlend.replace:\r\n\t\t\t\t\tr += bone.data.rotation - bone.rotation;\r\n\t\t\t\t\tr -= (16384 - ((16384.499999999996 - r / 360) | 0)) * 360; // Wrap within -180 and 180.\r\n\t\t\t\tcase MixBlend.add:\r\n\t\t\t\t\tbone.rotation += r * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\tlet frame = Animation.binarySearch(frames, time, RotateTimeline.ENTRIES);\r\n\t\t\tlet prevRotation = frames[frame + RotateTimeline.PREV_ROTATION];\r\n\t\t\tlet frameTime = frames[frame];\r\n\t\t\tlet percent = this.getCurvePercent((frame >> 1) - 1,\r\n\t\t\t\t1 - (time - frameTime) / (frames[frame + RotateTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\tlet r = frames[frame + RotateTimeline.ROTATION] - prevRotation;\r\n\t\t\tr = prevRotation + (r - (16384 - ((16384.499999999996 - r / 360) | 0)) * 360) * percent;\r\n\t\t\tswitch (blend) {\r\n\t\t\tcase MixBlend.setup:\r\n\t\t\t\tbone.rotation = bone.data.rotation + (r - (16384 - ((16384.499999999996 - r / 360) | 0)) * 360) * alpha;\r\n\t\t\t\tbreak;\r\n\t\t\tcase MixBlend.first:\r\n\t\t\tcase MixBlend.replace:\r\n\t\t\t\tr += bone.data.rotation - bone.rotation;\r\n\t\t\tcase MixBlend.add:\r\n\t\t\t\tbone.rotation += (r - (16384 - ((16384.499999999996 - r / 360) | 0)) * 360) * alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a bone's local {@link Bone#x} and {@link Bone#y}. */\r\n\texport class TranslateTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 3;\r\n\t\tstatic PREV_TIME = -3; static PREV_X = -2; static PREV_Y = -1;\r\n\t\tstatic X = 1; static Y = 2;\r\n\r\n\t\t/** The index of the bone in {@link Skeleton#bones} that will be changed. */\r\n\t\tboneIndex: number;\r\n\r\n\t\t/** The time in seconds, x, and y values for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, x, y, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * TranslateTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.translate << 24) + this.boneIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds, x, and y values for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, x: number, y: number) {\r\n\t\t\tframeIndex *= TranslateTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + TranslateTimeline.X] = x;\r\n\t\t\tthis.frames[frameIndex + TranslateTimeline.Y] = y;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\r\n\t\t\tlet bone = skeleton.bones[this.boneIndex];\r\n\t\t\tif (!bone.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tbone.x = bone.data.x;\r\n\t\t\t\t\tbone.y = bone.data.y;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tbone.x += (bone.data.x - bone.x) * alpha;\r\n\t\t\t\t\tbone.y += (bone.data.y - bone.y) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet x = 0, y = 0;\r\n\t\t\tif (time >= frames[frames.length - TranslateTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tx = frames[frames.length + TranslateTimeline.PREV_X];\r\n\t\t\t\ty = frames[frames.length + TranslateTimeline.PREV_Y];\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, TranslateTimeline.ENTRIES);\r\n\t\t\t\tx = frames[frame + TranslateTimeline.PREV_X];\r\n\t\t\t\ty = frames[frame + TranslateTimeline.PREV_Y];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / TranslateTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + TranslateTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tx += (frames[frame + TranslateTimeline.X] - x) * percent;\r\n\t\t\t\ty += (frames[frame + TranslateTimeline.Y] - y) * percent;\r\n\t\t\t}\r\n\t\t\tswitch (blend) {\r\n\t\t\tcase MixBlend.setup:\r\n\t\t\t\tbone.x = bone.data.x + x * alpha;\r\n\t\t\t\tbone.y = bone.data.y + y * alpha;\r\n\t\t\t\tbreak;\r\n\t\t\tcase MixBlend.first:\r\n\t\t\tcase MixBlend.replace:\r\n\t\t\t\tbone.x += (bone.data.x + x - bone.x) * alpha;\r\n\t\t\t\tbone.y += (bone.data.y + y - bone.y) * alpha;\r\n\t\t\t\tbreak;\r\n\t\t\tcase MixBlend.add:\r\n\t\t\t\tbone.x += x * alpha;\r\n\t\t\t\tbone.y += y * alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a bone's local {@link Bone#scaleX)} and {@link Bone#scaleY}. */\r\n\texport class ScaleTimeline extends TranslateTimeline {\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.scale << 24) + this.boneIndex;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\r\n\t\t\tlet bone = skeleton.bones[this.boneIndex];\r\n\t\t\tif (!bone.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tbone.scaleX = bone.data.scaleX;\r\n\t\t\t\t\tbone.scaleY = bone.data.scaleY;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tbone.scaleX += (bone.data.scaleX - bone.scaleX) * alpha;\r\n\t\t\t\t\tbone.scaleY += (bone.data.scaleY - bone.scaleY) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet x = 0, y = 0;\r\n\t\t\tif (time >= frames[frames.length - ScaleTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tx = frames[frames.length + ScaleTimeline.PREV_X] * bone.data.scaleX;\r\n\t\t\t\ty = frames[frames.length + ScaleTimeline.PREV_Y] * bone.data.scaleY;\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, ScaleTimeline.ENTRIES);\r\n\t\t\t\tx = frames[frame + ScaleTimeline.PREV_X];\r\n\t\t\t\ty = frames[frame + ScaleTimeline.PREV_Y];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / ScaleTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + ScaleTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tx = (x + (frames[frame + ScaleTimeline.X] - x) * percent) * bone.data.scaleX;\r\n\t\t\t\ty = (y + (frames[frame + ScaleTimeline.Y] - y) * percent) * bone.data.scaleY;\r\n\t\t\t}\r\n\t\t\tif (alpha == 1) {\r\n\t\t\t\tif (blend == MixBlend.add) {\r\n\t\t\t\t\tbone.scaleX += x - bone.data.scaleX;\r\n\t\t\t\t\tbone.scaleY += y - bone.data.scaleY;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbone.scaleX = x;\r\n\t\t\t\t\tbone.scaleY = y;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet bx = 0, by = 0;\r\n\t\t\t\tif (direction == MixDirection.mixOut) {\r\n\t\t\t\t\tswitch (blend) {\r\n\t\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\t\tbx = bone.data.scaleX;\r\n\t\t\t\t\t\tby = bone.data.scaleY;\r\n\t\t\t\t\t\tbone.scaleX = bx + (Math.abs(x) * MathUtils.signum(bx) - bx) * alpha;\r\n\t\t\t\t\t\tbone.scaleY = by + (Math.abs(y) * MathUtils.signum(by) - by) * alpha;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tcase MixBlend.replace:\r\n\t\t\t\t\t\tbx = bone.scaleX;\r\n\t\t\t\t\t\tby = bone.scaleY;\r\n\t\t\t\t\t\tbone.scaleX = bx + (Math.abs(x) * MathUtils.signum(bx) - bx) * alpha;\r\n\t\t\t\t\t\tbone.scaleY = by + (Math.abs(y) * MathUtils.signum(by) - by) * alpha;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase MixBlend.add:\r\n\t\t\t\t\t\tbx = bone.scaleX;\r\n\t\t\t\t\t\tby = bone.scaleY;\r\n\t\t\t\t\t\tbone.scaleX = bx + (Math.abs(x) * MathUtils.signum(bx) - bone.data.scaleX) * alpha;\r\n\t\t\t\t\t\tbone.scaleY = by + (Math.abs(y) * MathUtils.signum(by) - bone.data.scaleY) * alpha;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tswitch (blend) {\r\n\t\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\t\tbx = Math.abs(bone.data.scaleX) * MathUtils.signum(x);\r\n\t\t\t\t\t\tby = Math.abs(bone.data.scaleY) * MathUtils.signum(y);\r\n\t\t\t\t\t\tbone.scaleX = bx + (x - bx) * alpha;\r\n\t\t\t\t\t\tbone.scaleY = by + (y - by) * alpha;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tcase MixBlend.replace:\r\n\t\t\t\t\t\tbx = Math.abs(bone.scaleX) * MathUtils.signum(x);\r\n\t\t\t\t\t\tby = Math.abs(bone.scaleY) * MathUtils.signum(y);\r\n\t\t\t\t\t\tbone.scaleX = bx + (x - bx) * alpha;\r\n\t\t\t\t\t\tbone.scaleY = by + (y - by) * alpha;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase MixBlend.add:\r\n\t\t\t\t\t\tbx = MathUtils.signum(x);\r\n\t\t\t\t\t\tby = MathUtils.signum(y);\r\n\t\t\t\t\t\tbone.scaleX = Math.abs(bone.scaleX) * bx + (x - Math.abs(bone.data.scaleX) * bx) * alpha;\r\n\t\t\t\t\t\tbone.scaleY = Math.abs(bone.scaleY) * by + (y - Math.abs(bone.data.scaleY) * by) * alpha;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a bone's local {@link Bone#shearX} and {@link Bone#shearY}. */\r\n\texport class ShearTimeline extends TranslateTimeline {\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.shear << 24) + this.boneIndex;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\r\n\t\t\tlet bone = skeleton.bones[this.boneIndex];\r\n\t\t\tif (!bone.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tbone.shearX = bone.data.shearX;\r\n\t\t\t\t\tbone.shearY = bone.data.shearY;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tbone.shearX += (bone.data.shearX - bone.shearX) * alpha;\r\n\t\t\t\t\tbone.shearY += (bone.data.shearY - bone.shearY) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet x = 0, y = 0;\r\n\t\t\tif (time >= frames[frames.length - ShearTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tx = frames[frames.length + ShearTimeline.PREV_X];\r\n\t\t\t\ty = frames[frames.length + ShearTimeline.PREV_Y];\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, ShearTimeline.ENTRIES);\r\n\t\t\t\tx = frames[frame + ShearTimeline.PREV_X];\r\n\t\t\t\ty = frames[frame + ShearTimeline.PREV_Y];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / ShearTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + ShearTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tx = x + (frames[frame + ShearTimeline.X] - x) * percent;\r\n\t\t\t\ty = y + (frames[frame + ShearTimeline.Y] - y) * percent;\r\n\t\t\t}\r\n\t\t\tswitch (blend) {\r\n\t\t\tcase MixBlend.setup:\r\n\t\t\t\tbone.shearX = bone.data.shearX + x * alpha;\r\n\t\t\t\tbone.shearY = bone.data.shearY + y * alpha;\r\n\t\t\t\tbreak;\r\n\t\t\tcase MixBlend.first:\r\n\t\t\tcase MixBlend.replace:\r\n\t\t\t\tbone.shearX += (bone.data.shearX + x - bone.shearX) * alpha;\r\n\t\t\t\tbone.shearY += (bone.data.shearY + y - bone.shearY) * alpha;\r\n\t\t\t\tbreak;\r\n\t\t\tcase MixBlend.add:\r\n\t\t\t\tbone.shearX += x * alpha;\r\n\t\t\t\tbone.shearY += y * alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a slot's {@link Slot#color}. */\r\n\texport class ColorTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 5;\r\n\t\tstatic PREV_TIME = -5; static PREV_R = -4; static PREV_G = -3; static PREV_B = -2; static PREV_A = -1;\r\n\t\tstatic R = 1; static G = 2; static B = 3; static A = 4;\r\n\r\n\t\t/** The index of the slot in {@link Skeleton#slots} that will be changed. */\r\n\t\tslotIndex: number;\r\n\r\n\t\t/** The time in seconds, red, green, blue, and alpha values for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, r, g, b, a, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * ColorTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.color << 24) + this.slotIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds, red, green, blue, and alpha for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, r: number, g: number, b: number, a: number) {\r\n\t\t\tframeIndex *= ColorTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + ColorTimeline.R] = r;\r\n\t\t\tthis.frames[frameIndex + ColorTimeline.G] = g;\r\n\t\t\tthis.frames[frameIndex + ColorTimeline.B] = b;\r\n\t\t\tthis.frames[frameIndex + ColorTimeline.A] = a;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet slot = skeleton.slots[this.slotIndex];\r\n\t\t\tif (!slot.bone.active) return;\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tslot.color.setFromColor(slot.data.color);\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tlet color = slot.color, setup = slot.data.color;\r\n\t\t\t\t\tcolor.add((setup.r - color.r) * alpha, (setup.g - color.g) * alpha, (setup.b - color.b) * alpha,\r\n\t\t\t\t\t\t(setup.a - color.a) * alpha);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet r = 0, g = 0, b = 0, a = 0;\r\n\t\t\tif (time >= frames[frames.length - ColorTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tlet i = frames.length;\r\n\t\t\t\tr = frames[i + ColorTimeline.PREV_R];\r\n\t\t\t\tg = frames[i + ColorTimeline.PREV_G];\r\n\t\t\t\tb = frames[i + ColorTimeline.PREV_B];\r\n\t\t\t\ta = frames[i + ColorTimeline.PREV_A];\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, ColorTimeline.ENTRIES);\r\n\t\t\t\tr = frames[frame + ColorTimeline.PREV_R];\r\n\t\t\t\tg = frames[frame + ColorTimeline.PREV_G];\r\n\t\t\t\tb = frames[frame + ColorTimeline.PREV_B];\r\n\t\t\t\ta = frames[frame + ColorTimeline.PREV_A];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / ColorTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + ColorTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tr += (frames[frame + ColorTimeline.R] - r) * percent;\r\n\t\t\t\tg += (frames[frame + ColorTimeline.G] - g) * percent;\r\n\t\t\t\tb += (frames[frame + ColorTimeline.B] - b) * percent;\r\n\t\t\t\ta += (frames[frame + ColorTimeline.A] - a) * percent;\r\n\t\t\t}\r\n\t\t\tif (alpha == 1)\r\n\t\t\t\tslot.color.set(r, g, b, a);\r\n\t\t\telse {\r\n\t\t\t\tlet color = slot.color;\r\n\t\t\t\tif (blend == MixBlend.setup) color.setFromColor(slot.data.color);\r\n\t\t\t\tcolor.add((r - color.r) * alpha, (g - color.g) * alpha, (b - color.b) * alpha, (a - color.a) * alpha);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a slot's {@link Slot#color} and {@link Slot#darkColor} for two color tinting. */\r\n\texport class TwoColorTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 8;\r\n\t\tstatic PREV_TIME = -8; static PREV_R = -7; static PREV_G = -6; static PREV_B = -5; static PREV_A = -4;\r\n\t\tstatic PREV_R2 = -3; static PREV_G2 = -2; static PREV_B2 = -1;\r\n\t\tstatic R = 1; static G = 2; static B = 3; static A = 4; static R2 = 5; static G2 = 6; static B2 = 7;\r\n\r\n\t\t/** The index of the slot in {@link Skeleton#slots()} that will be changed. The {@link Slot#darkColor()} must not be\r\n\t\t * null. */\r\n\t\tslotIndex: number;\r\n\r\n\t\t/** The time in seconds, red, green, blue, and alpha values of the color, red, green, blue of the dark color, for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, r, g, b, a, r2, g2, b2, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * TwoColorTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.twoColor << 24) + this.slotIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds, light, and dark colors for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, r: number, g: number, b: number, a: number, r2: number, g2: number, b2: number) {\r\n\t\t\tframeIndex *= TwoColorTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.R] = r;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.G] = g;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.B] = b;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.A] = a;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.R2] = r2;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.G2] = g2;\r\n\t\t\tthis.frames[frameIndex + TwoColorTimeline.B2] = b2;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet slot = skeleton.slots[this.slotIndex];\r\n\t\t\tif (!slot.bone.active) return;\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tslot.color.setFromColor(slot.data.color);\r\n\t\t\t\t\tslot.darkColor.setFromColor(slot.data.darkColor);\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tlet light = slot.color, dark = slot.darkColor, setupLight = slot.data.color, setupDark = slot.data.darkColor;\r\n\t\t\t\t\tlight.add((setupLight.r - light.r) * alpha, (setupLight.g - light.g) * alpha, (setupLight.b - light.b) * alpha,\r\n\t\t\t\t\t\t(setupLight.a - light.a) * alpha);\r\n\t\t\t\t\tdark.add((setupDark.r - dark.r) * alpha, (setupDark.g - dark.g) * alpha, (setupDark.b - dark.b) * alpha, 0);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet r = 0, g = 0, b = 0, a = 0, r2 = 0, g2 = 0, b2 = 0;\r\n\t\t\tif (time >= frames[frames.length - TwoColorTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tlet i = frames.length;\r\n\t\t\t\tr = frames[i + TwoColorTimeline.PREV_R];\r\n\t\t\t\tg = frames[i + TwoColorTimeline.PREV_G];\r\n\t\t\t\tb = frames[i + TwoColorTimeline.PREV_B];\r\n\t\t\t\ta = frames[i + TwoColorTimeline.PREV_A];\r\n\t\t\t\tr2 = frames[i + TwoColorTimeline.PREV_R2];\r\n\t\t\t\tg2 = frames[i + TwoColorTimeline.PREV_G2];\r\n\t\t\t\tb2 = frames[i + TwoColorTimeline.PREV_B2];\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, TwoColorTimeline.ENTRIES);\r\n\t\t\t\tr = frames[frame + TwoColorTimeline.PREV_R];\r\n\t\t\t\tg = frames[frame + TwoColorTimeline.PREV_G];\r\n\t\t\t\tb = frames[frame + TwoColorTimeline.PREV_B];\r\n\t\t\t\ta = frames[frame + TwoColorTimeline.PREV_A];\r\n\t\t\t\tr2 = frames[frame + TwoColorTimeline.PREV_R2];\r\n\t\t\t\tg2 = frames[frame + TwoColorTimeline.PREV_G2];\r\n\t\t\t\tb2 = frames[frame + TwoColorTimeline.PREV_B2];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / TwoColorTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + TwoColorTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tr += (frames[frame + TwoColorTimeline.R] - r) * percent;\r\n\t\t\t\tg += (frames[frame + TwoColorTimeline.G] - g) * percent;\r\n\t\t\t\tb += (frames[frame + TwoColorTimeline.B] - b) * percent;\r\n\t\t\t\ta += (frames[frame + TwoColorTimeline.A] - a) * percent;\r\n\t\t\t\tr2 += (frames[frame + TwoColorTimeline.R2] - r2) * percent;\r\n\t\t\t\tg2 += (frames[frame + TwoColorTimeline.G2] - g2) * percent;\r\n\t\t\t\tb2 += (frames[frame + TwoColorTimeline.B2] - b2) * percent;\r\n\t\t\t}\r\n\t\t\tif (alpha == 1) {\r\n\t\t\t\tslot.color.set(r, g, b, a);\r\n\t\t\t\tslot.darkColor.set(r2, g2, b2, 1);\r\n\t\t\t} else {\r\n\t\t\t\tlet light = slot.color, dark = slot.darkColor;\r\n\t\t\t\tif (blend == MixBlend.setup) {\r\n\t\t\t\t\tlight.setFromColor(slot.data.color);\r\n\t\t\t\t\tdark.setFromColor(slot.data.darkColor);\r\n\t\t\t\t}\r\n\t\t\t\tlight.add((r - light.r) * alpha, (g - light.g) * alpha, (b - light.b) * alpha, (a - light.a) * alpha);\r\n\t\t\t\tdark.add((r2 - dark.r) * alpha, (g2 - dark.g) * alpha, (b2 - dark.b) * alpha, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a slot's {@link Slot#attachment}. */\r\n\texport class AttachmentTimeline implements Timeline {\r\n\t\t/** The index of the slot in {@link Skeleton#slots} that will be changed. */\r\n\t\tslotIndex: number;\r\n\r\n\t\t/** The time in seconds for each key frame. */\r\n\t\tframes: ArrayLike<number> // time, ...\r\n\r\n\t\t/** The attachment name for each key frame. May contain null values to clear the attachment. */\r\n\t\tattachmentNames: Array<string>;\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount);\r\n\t\t\tthis.attachmentNames = new Array<string>(frameCount);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.attachment << 24) + this.slotIndex;\r\n\t\t}\r\n\r\n\t\t/** The number of key frames for this timeline. */\r\n\t\tgetFrameCount () {\r\n\t\t\treturn this.frames.length;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds and the attachment name for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, attachmentName: string) {\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.attachmentNames[frameIndex] = attachmentName;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, events: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet slot = skeleton.slots[this.slotIndex];\r\n\t\t\tif (!slot.bone.active) return;\r\n\t\t\tif (direction == MixDirection.mixOut) {\r\n\t\t\t\tif (blend == MixBlend.setup)\r\n\t\t\t\t\tthis.setAttachment(skeleton, slot, slot.data.attachmentName);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tif (blend == MixBlend.setup || blend == MixBlend.first) this.setAttachment(skeleton, slot, slot.data.attachmentName);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet frameIndex = 0;\r\n\t\t\tif (time >= frames[frames.length - 1]) // Time is after last frame.\r\n\t\t\t\tframeIndex = frames.length - 1;\r\n\t\t\telse\r\n\t\t\t\tframeIndex = Animation.binarySearch(frames, time, 1) - 1;\r\n\r\n\t\t\tlet attachmentName = this.attachmentNames[frameIndex];\r\n\t\t\tskeleton.slots[this.slotIndex]\r\n\t\t\t\t.setAttachment(attachmentName == null ? null : skeleton.getAttachment(this.slotIndex, attachmentName));\r\n\t\t}\r\n\r\n\t\tsetAttachment(skeleton: Skeleton, slot: Slot, attachmentName: string) {\r\n\t\t\tslot.attachment = attachmentName == null ? null : skeleton.getAttachment(this.slotIndex, attachmentName);\r\n\t\t}\r\n\t}\r\n\r\n\tlet zeros : ArrayLike<number> = null;\r\n\r\n\t/** Changes a slot's {@link Slot#deform} to deform a {@link VertexAttachment}. */\r\n\texport class DeformTimeline extends CurveTimeline {\r\n\t\t/** The index of the slot in {@link Skeleton#getSlots()} that will be changed. */\r\n\t\tslotIndex: number;\r\n\r\n\t\t/** The attachment that will be deformed. */\r\n\t\tattachment: VertexAttachment;\r\n\r\n\t\t/** The time in seconds for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, ...\r\n\r\n\t\t/** The vertices for each key frame. */\r\n\t\tframeVertices: Array<ArrayLike<number>>;\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount);\r\n\t\t\tthis.frameVertices = new Array<ArrayLike<number>>(frameCount);\r\n\t\t\tif (zeros == null) zeros = Utils.newFloatArray(64);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.deform << 27) + + this.attachment.id + this.slotIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds and the vertices for the specified key frame.\r\n\t\t * @param vertices Vertex positions for an unweighted VertexAttachment, or deform offsets if it has weights. */\r\n\t\tsetFrame (frameIndex: number, time: number, vertices: ArrayLike<number>) {\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frameVertices[frameIndex] = vertices;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet slot: Slot = skeleton.slots[this.slotIndex];\r\n\t\t\tif (!slot.bone.active) return;\r\n\t\t\tlet slotAttachment: Attachment = slot.getAttachment();\r\n\t\t\tif (!(slotAttachment instanceof VertexAttachment) || !((<VertexAttachment>slotAttachment).deformAttachment == this.attachment)) return;\r\n\r\n\t\t\tlet deformArray: Array<number> = slot.deform;\r\n\t\t\tif (deformArray.length == 0) blend = MixBlend.setup;\r\n\r\n\t\t\tlet frameVertices = this.frameVertices;\r\n\t\t\tlet vertexCount = frameVertices[0].length;\r\n\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tlet vertexAttachment = <VertexAttachment>slotAttachment;\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tdeformArray.length = 0;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tif (alpha == 1) {\r\n\t\t\t\t\t\tdeformArray.length = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet deform: Array<number> = Utils.setArraySize(deformArray, vertexCount);\r\n\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t// Unweighted vertex positions.\r\n\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\tfor (var i = 0; i < vertexCount; i++)\r\n\t\t\t\t\t\t\tdeform[i] += (setupVertices[i] - deform[i]) * alpha;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Weighted deform offsets.\r\n\t\t\t\t\t\talpha = 1 - alpha;\r\n\t\t\t\t\t\tfor (var i = 0; i < vertexCount; i++)\r\n\t\t\t\t\t\t\tdeform[i] *= alpha;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet deform: Array<number> = Utils.setArraySize(deformArray, vertexCount);\r\n\t\t\tif (time >= frames[frames.length - 1]) { // Time is after last frame.\r\n\t\t\t\tlet lastVertices = frameVertices[frames.length - 1];\r\n\t\t\t\tif (alpha == 1) {\r\n\t\t\t\t\tif (blend == MixBlend.add) {\r\n\t\t\t\t\t\tlet vertexAttachment = slotAttachment as VertexAttachment;\r\n\t\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t\t// Unweighted vertex positions, with alpha.\r\n\t\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\t\tdeform[i] += lastVertices[i] - setupVertices[i];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Weighted deform offsets, with alpha.\r\n\t\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++)\r\n\t\t\t\t\t\t\t\tdeform[i] += lastVertices[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tUtils.arrayCopy(lastVertices, 0, deform, 0, vertexCount);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tswitch (blend) {\r\n\t\t\t\t\tcase MixBlend.setup: {\r\n\t\t\t\t\t\tlet vertexAttachment = slotAttachment as VertexAttachment;\r\n\t\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t\t// Unweighted vertex positions, with alpha.\r\n\t\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\t\tlet setup = setupVertices[i];\r\n\t\t\t\t\t\t\t\tdeform[i] = setup + (lastVertices[i] - setup) * alpha;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Weighted deform offsets, with alpha.\r\n\t\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++)\r\n\t\t\t\t\t\t\t\tdeform[i] = lastVertices[i] * alpha;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tcase MixBlend.replace:\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++)\r\n\t\t\t\t\t\t\tdeform[i] += (lastVertices[i] - deform[i]) * alpha;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase MixBlend.add:\r\n\t\t\t\t\t\tlet vertexAttachment = slotAttachment as VertexAttachment;\r\n\t\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t\t// Unweighted vertex positions, with alpha.\r\n\t\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\t\tdeform[i] += (lastVertices[i] - setupVertices[i]) * alpha;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Weighted deform offsets, with alpha.\r\n\t\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++)\r\n\t\t\t\t\t\t\t\tdeform[i] += lastVertices[i] * alpha;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\tlet frame = Animation.binarySearch(frames, time);\r\n\t\t\tlet prevVertices = frameVertices[frame - 1];\r\n\t\t\tlet nextVertices = frameVertices[frame];\r\n\t\t\tlet frameTime = frames[frame];\r\n\t\t\tlet percent = this.getCurvePercent(frame - 1, 1 - (time - frameTime) / (frames[frame - 1] - frameTime));\r\n\r\n\t\t\tif (alpha == 1) {\r\n\t\t\t\tif (blend == MixBlend.add) {\r\n\t\t\t\t\tlet vertexAttachment = slotAttachment as VertexAttachment;\r\n\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t// Unweighted vertex positions, with alpha.\r\n\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\t\tdeform[i] += prev + (nextVertices[i] - prev) * percent - setupVertices[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Weighted deform offsets, with alpha.\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\t\tdeform[i] += prev + (nextVertices[i] - prev) * percent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\tdeform[i] = prev + (nextVertices[i] - prev) * percent;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup: {\r\n\t\t\t\t\tlet vertexAttachment = slotAttachment as VertexAttachment;\r\n\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t// Unweighted vertex positions, with alpha.\r\n\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\tlet prev = prevVertices[i], setup = setupVertices[i];\r\n\t\t\t\t\t\t\tdeform[i] = setup + (prev + (nextVertices[i] - prev) * percent - setup) * alpha;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Weighted deform offsets, with alpha.\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\t\tdeform[i] = (prev + (nextVertices[i] - prev) * percent) * alpha;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\tcase MixBlend.replace:\r\n\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\tdeform[i] += (prev + (nextVertices[i] - prev) * percent - deform[i]) * alpha;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MixBlend.add:\r\n\t\t\t\t\tlet vertexAttachment = slotAttachment as VertexAttachment;\r\n\t\t\t\t\tif (vertexAttachment.bones == null) {\r\n\t\t\t\t\t\t// Unweighted vertex positions, with alpha.\r\n\t\t\t\t\t\tlet setupVertices = vertexAttachment.vertices;\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\t\tdeform[i] += (prev + (nextVertices[i] - prev) * percent - setupVertices[i]) * alpha;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Weighted deform offsets, with alpha.\r\n\t\t\t\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\t\t\t\tlet prev = prevVertices[i];\r\n\t\t\t\t\t\t\tdeform[i] += (prev + (nextVertices[i] - prev) * percent) * alpha;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Fires an {@link Event} when specific animation times are reached. */\r\n\texport class EventTimeline implements Timeline {\r\n\t\t/** The time in seconds for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, ...\r\n\r\n\t\t/** The event for each key frame. */\r\n\t\tevents: Array<Event>;\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount);\r\n\t\t\tthis.events = new Array<Event>(frameCount);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn TimelineType.event << 24;\r\n\t\t}\r\n\r\n\t\t/** The number of key frames for this timeline. */\r\n\t\tgetFrameCount () {\r\n\t\t\treturn this.frames.length;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds and the event for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, event: Event) {\r\n\t\t\tthis.frames[frameIndex] = event.time;\r\n\t\t\tthis.events[frameIndex] = event;\r\n\t\t}\r\n\r\n\t\t/** Fires events for frames > `lastTime` and <= `time`. */\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tif (firedEvents == null) return;\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tlet frameCount = this.frames.length;\r\n\r\n\t\t\tif (lastTime > time) { // Fire events after last time for looped animations.\r\n\t\t\t\tthis.apply(skeleton, lastTime, Number.MAX_VALUE, firedEvents, alpha, blend, direction);\r\n\t\t\t\tlastTime = -1;\r\n\t\t\t} else if (lastTime >= frames[frameCount - 1]) // Last time is after last frame.\r\n\t\t\t\treturn;\r\n\t\t\tif (time < frames[0]) return; // Time is before first frame.\r\n\r\n\t\t\tlet frame = 0;\r\n\t\t\tif (lastTime < frames[0])\r\n\t\t\t\tframe = 0;\r\n\t\t\telse {\r\n\t\t\t\tframe = Animation.binarySearch(frames, lastTime);\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\twhile (frame > 0) { // Fire multiple events with the same frame.\r\n\t\t\t\t\tif (frames[frame - 1] != frameTime) break;\r\n\t\t\t\t\tframe--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (; frame < frameCount && time >= frames[frame]; frame++)\r\n\t\t\t\tfiredEvents.push(this.events[frame]);\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a skeleton's {@link Skeleton#drawOrder}. */\r\n\texport class DrawOrderTimeline implements Timeline {\r\n\t\t/** The time in seconds for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, ...\r\n\r\n\t\t/** The draw order for each key frame. See {@link #setFrame(int, float, int[])}. */\r\n\t\tdrawOrders: Array<Array<number>>;\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount);\r\n\t\t\tthis.drawOrders = new Array<Array<number>>(frameCount);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn TimelineType.drawOrder << 24;\r\n\t\t}\r\n\r\n\t\t/** The number of key frames for this timeline. */\r\n\t\tgetFrameCount () {\r\n\t\t\treturn this.frames.length;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds and the draw order for the specified key frame.\r\n\t\t * @param drawOrder For each slot in {@link Skeleton#slots}, the index of the new draw order. May be null to use setup pose\r\n\t\t *           draw order. */\r\n\t\tsetFrame (frameIndex: number, time: number, drawOrder: Array<number>) {\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.drawOrders[frameIndex] = drawOrder;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet drawOrder: Array<Slot> = skeleton.drawOrder;\r\n\t\t\tlet slots: Array<Slot> = skeleton.slots;\r\n\t\t\tif (direction == MixDirection.mixOut) {\r\n\t\t\t\tif (blend == MixBlend.setup) Utils.arrayCopy(skeleton.slots, 0, skeleton.drawOrder, 0, skeleton.slots.length);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tif (blend == MixBlend.setup || blend == MixBlend.first) Utils.arrayCopy(skeleton.slots, 0, skeleton.drawOrder, 0, skeleton.slots.length);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet frame = 0;\r\n\t\t\tif (time >= frames[frames.length - 1]) // Time is after last frame.\r\n\t\t\t\tframe = frames.length - 1;\r\n\t\t\telse\r\n\t\t\t\tframe = Animation.binarySearch(frames, time) - 1;\r\n\r\n\t\t\tlet drawOrderToSetupIndex = this.drawOrders[frame];\r\n\t\t\tif (drawOrderToSetupIndex == null)\r\n\t\t\t\tUtils.arrayCopy(slots, 0, drawOrder, 0, slots.length);\r\n\t\t\telse {\r\n\t\t\t\tfor (let i = 0, n = drawOrderToSetupIndex.length; i < n; i++)\r\n\t\t\t\t\tdrawOrder[i] = slots[drawOrderToSetupIndex[i]];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes an IK constraint's {@link IkConstraint#mix}, {@link IkConstraint#softness},\r\n\t * {@link IkConstraint#bendDirection}, {@link IkConstraint#stretch}, and {@link IkConstraint#compress}. */\r\n\texport class IkConstraintTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 6;\r\n\t\tstatic PREV_TIME = -6; static PREV_MIX = -5; static PREV_SOFTNESS = -4; static PREV_BEND_DIRECTION = -3; static PREV_COMPRESS = -2; static PREV_STRETCH = -1;\r\n\t\tstatic MIX = 1; static SOFTNESS = 2; static BEND_DIRECTION = 3; static COMPRESS = 4; static STRETCH = 5;\r\n\r\n\t\t/** The index of the IK constraint slot in {@link Skeleton#ikConstraints} that will be changed. */\r\n\t\tikConstraintIndex: number;\r\n\r\n\t\t/** The time in seconds, mix, softness, bend direction, compress, and stretch for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, mix, softness, bendDirection, compress, stretch, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * IkConstraintTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.ikConstraint << 24) + this.ikConstraintIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds, mix, softness, bend direction, compress, and stretch for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, mix: number, softness: number, bendDirection: number, compress: boolean, stretch: boolean) {\r\n\t\t\tframeIndex *= IkConstraintTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + IkConstraintTimeline.MIX] = mix;\r\n\t\t\tthis.frames[frameIndex + IkConstraintTimeline.SOFTNESS] = softness;\r\n\t\t\tthis.frames[frameIndex + IkConstraintTimeline.BEND_DIRECTION] = bendDirection;\r\n\t\t\tthis.frames[frameIndex + IkConstraintTimeline.COMPRESS] = compress ? 1 : 0;\r\n\t\t\tthis.frames[frameIndex + IkConstraintTimeline.STRETCH] = stretch ? 1 : 0;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tlet constraint: IkConstraint = skeleton.ikConstraints[this.ikConstraintIndex];\r\n\t\t\tif (!constraint.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tconstraint.mix = constraint.data.mix;\r\n\t\t\t\t\tconstraint.softness = constraint.data.softness;\r\n\t\t\t\t\tconstraint.bendDirection = constraint.data.bendDirection;\r\n\t\t\t\t\tconstraint.compress = constraint.data.compress;\r\n\t\t\t\t\tconstraint.stretch = constraint.data.stretch;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tconstraint.mix += (constraint.data.mix - constraint.mix) * alpha;\r\n\t\t\t\t\tconstraint.softness += (constraint.data.softness - constraint.softness) * alpha;\r\n\t\t\t\t\tconstraint.bendDirection = constraint.data.bendDirection;\r\n\t\t\t\t\tconstraint.compress = constraint.data.compress;\r\n\t\t\t\t\tconstraint.stretch = constraint.data.stretch;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (time >= frames[frames.length - IkConstraintTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tif (blend == MixBlend.setup) {\r\n\t\t\t\t\tconstraint.mix = constraint.data.mix + (frames[frames.length + IkConstraintTimeline.PREV_MIX] - constraint.data.mix) * alpha;\r\n\t\t\t\t\tconstraint.softness = constraint.data.softness\r\n\t\t\t\t\t\t+ (frames[frames.length + IkConstraintTimeline.PREV_SOFTNESS] - constraint.data.softness) * alpha;\r\n\t\t\t\t\tif (direction == MixDirection.mixOut) {\r\n\t\t\t\t\t\tconstraint.bendDirection = constraint.data.bendDirection;\r\n\t\t\t\t\t\tconstraint.compress = constraint.data.compress;\r\n\t\t\t\t\t\tconstraint.stretch = constraint.data.stretch;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconstraint.bendDirection = frames[frames.length + IkConstraintTimeline.PREV_BEND_DIRECTION]\r\n\t\t\t\t\t\tconstraint.compress = frames[frames.length + IkConstraintTimeline.PREV_COMPRESS] != 0;\r\n\t\t\t\t\t\tconstraint.stretch = frames[frames.length + IkConstraintTimeline.PREV_STRETCH] != 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconstraint.mix += (frames[frames.length + IkConstraintTimeline.PREV_MIX] - constraint.mix) * alpha;\r\n\t\t\t\t\tconstraint.softness += (frames[frames.length + IkConstraintTimeline.PREV_SOFTNESS] - constraint.softness) * alpha;\r\n\t\t\t\t\tif (direction == MixDirection.mixIn) {\r\n\t\t\t\t\t\tconstraint.bendDirection = frames[frames.length + IkConstraintTimeline.PREV_BEND_DIRECTION];\r\n\t\t\t\t\t\tconstraint.compress = frames[frames.length + IkConstraintTimeline.PREV_COMPRESS] != 0;\r\n\t\t\t\t\t\tconstraint.stretch = frames[frames.length + IkConstraintTimeline.PREV_STRETCH] != 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\tlet frame = Animation.binarySearch(frames, time, IkConstraintTimeline.ENTRIES);\r\n\t\t\tlet mix = frames[frame + IkConstraintTimeline.PREV_MIX];\r\n\t\t\tlet softness = frames[frame + IkConstraintTimeline.PREV_SOFTNESS];\r\n\t\t\tlet frameTime = frames[frame];\r\n\t\t\tlet percent = this.getCurvePercent(frame / IkConstraintTimeline.ENTRIES - 1,\r\n\t\t\t\t1 - (time - frameTime) / (frames[frame + IkConstraintTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\tif (blend == MixBlend.setup) {\r\n\t\t\t\tconstraint.mix = constraint.data.mix + (mix + (frames[frame + IkConstraintTimeline.MIX] - mix) * percent - constraint.data.mix) * alpha;\r\n\t\t\t\tconstraint.softness = constraint.data.softness\r\n\t\t\t\t\t+ (softness + (frames[frame + IkConstraintTimeline.SOFTNESS] - softness) * percent - constraint.data.softness) * alpha;\r\n\t\t\t\tif (direction == MixDirection.mixOut) {\r\n\t\t\t\t\tconstraint.bendDirection = constraint.data.bendDirection;\r\n\t\t\t\t\tconstraint.compress = constraint.data.compress;\r\n\t\t\t\t\tconstraint.stretch = constraint.data.stretch;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconstraint.bendDirection = frames[frame + IkConstraintTimeline.PREV_BEND_DIRECTION];\r\n\t\t\t\t\tconstraint.compress = frames[frame + IkConstraintTimeline.PREV_COMPRESS] != 0;\r\n\t\t\t\t\tconstraint.stretch = frames[frame + IkConstraintTimeline.PREV_STRETCH] != 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconstraint.mix += (mix + (frames[frame + IkConstraintTimeline.MIX] - mix) * percent - constraint.mix) * alpha;\r\n\t\t\t\tconstraint.softness += (softness + (frames[frame + IkConstraintTimeline.SOFTNESS] - softness) * percent - constraint.softness) * alpha;\r\n\t\t\t\tif (direction == MixDirection.mixIn) {\r\n\t\t\t\t\tconstraint.bendDirection = frames[frame + IkConstraintTimeline.PREV_BEND_DIRECTION];\r\n\t\t\t\t\tconstraint.compress = frames[frame + IkConstraintTimeline.PREV_COMPRESS] != 0;\r\n\t\t\t\t\tconstraint.stretch = frames[frame + IkConstraintTimeline.PREV_STRETCH] != 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a transform constraint's {@link TransformConstraint#rotateMix}, {@link TransformConstraint#translateMix},\r\n\t * {@link TransformConstraint#scaleMix}, and {@link TransformConstraint#shearMix}. */\r\n\texport class TransformConstraintTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 5;\r\n\t\tstatic PREV_TIME = -5; static PREV_ROTATE = -4; static PREV_TRANSLATE = -3; static PREV_SCALE = -2; static PREV_SHEAR = -1;\r\n\t\tstatic ROTATE = 1; static TRANSLATE = 2; static SCALE = 3; static SHEAR = 4;\r\n\r\n\t\t/** The index of the transform constraint slot in {@link Skeleton#transformConstraints} that will be changed. */\r\n\t\ttransformConstraintIndex: number;\r\n\r\n\t\t/** The time in seconds, rotate mix, translate mix, scale mix, and shear mix for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, rotate mix, translate mix, scale mix, shear mix, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * TransformConstraintTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.transformConstraint << 24) + this.transformConstraintIndex;\r\n\t\t}\r\n\r\n\t\t/** The time in seconds, rotate mix, translate mix, scale mix, and shear mix for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, rotateMix: number, translateMix: number, scaleMix: number, shearMix: number) {\r\n\t\t\tframeIndex *= TransformConstraintTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + TransformConstraintTimeline.ROTATE] = rotateMix;\r\n\t\t\tthis.frames[frameIndex + TransformConstraintTimeline.TRANSLATE] = translateMix;\r\n\t\t\tthis.frames[frameIndex + TransformConstraintTimeline.SCALE] = scaleMix;\r\n\t\t\tthis.frames[frameIndex + TransformConstraintTimeline.SHEAR] = shearMix;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\r\n\t\t\tlet constraint: TransformConstraint = skeleton.transformConstraints[this.transformConstraintIndex];\r\n\t\t\tif (!constraint.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tlet data = constraint.data;\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tconstraint.rotateMix = data.rotateMix;\r\n\t\t\t\t\tconstraint.translateMix = data.translateMix;\r\n\t\t\t\t\tconstraint.scaleMix = data.scaleMix;\r\n\t\t\t\t\tconstraint.shearMix = data.shearMix;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tconstraint.rotateMix += (data.rotateMix - constraint.rotateMix) * alpha;\r\n\t\t\t\t\tconstraint.translateMix += (data.translateMix - constraint.translateMix) * alpha;\r\n\t\t\t\t\tconstraint.scaleMix += (data.scaleMix - constraint.scaleMix) * alpha;\r\n\t\t\t\t\tconstraint.shearMix += (data.shearMix - constraint.shearMix) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet rotate = 0, translate = 0, scale = 0, shear = 0;\r\n\t\t\tif (time >= frames[frames.length - TransformConstraintTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\tlet i = frames.length;\r\n\t\t\t\trotate = frames[i + TransformConstraintTimeline.PREV_ROTATE];\r\n\t\t\t\ttranslate = frames[i + TransformConstraintTimeline.PREV_TRANSLATE];\r\n\t\t\t\tscale = frames[i + TransformConstraintTimeline.PREV_SCALE];\r\n\t\t\t\tshear = frames[i + TransformConstraintTimeline.PREV_SHEAR];\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, TransformConstraintTimeline.ENTRIES);\r\n\t\t\t\trotate = frames[frame + TransformConstraintTimeline.PREV_ROTATE];\r\n\t\t\t\ttranslate = frames[frame + TransformConstraintTimeline.PREV_TRANSLATE];\r\n\t\t\t\tscale = frames[frame + TransformConstraintTimeline.PREV_SCALE];\r\n\t\t\t\tshear = frames[frame + TransformConstraintTimeline.PREV_SHEAR];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / TransformConstraintTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + TransformConstraintTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\trotate += (frames[frame + TransformConstraintTimeline.ROTATE] - rotate) * percent;\r\n\t\t\t\ttranslate += (frames[frame + TransformConstraintTimeline.TRANSLATE] - translate) * percent;\r\n\t\t\t\tscale += (frames[frame + TransformConstraintTimeline.SCALE] - scale) * percent;\r\n\t\t\t\tshear += (frames[frame + TransformConstraintTimeline.SHEAR] - shear) * percent;\r\n\t\t\t}\r\n\t\t\tif (blend == MixBlend.setup) {\r\n\t\t\t\tlet data = constraint.data;\r\n\t\t\t\tconstraint.rotateMix = data.rotateMix + (rotate - data.rotateMix) * alpha;\r\n\t\t\t\tconstraint.translateMix = data.translateMix + (translate - data.translateMix) * alpha;\r\n\t\t\t\tconstraint.scaleMix = data.scaleMix + (scale - data.scaleMix) * alpha;\r\n\t\t\t\tconstraint.shearMix = data.shearMix + (shear - data.shearMix) * alpha;\r\n\t\t\t} else {\r\n\t\t\t\tconstraint.rotateMix += (rotate - constraint.rotateMix) * alpha;\r\n\t\t\t\tconstraint.translateMix += (translate - constraint.translateMix) * alpha;\r\n\t\t\t\tconstraint.scaleMix += (scale - constraint.scaleMix) * alpha;\r\n\t\t\t\tconstraint.shearMix += (shear - constraint.shearMix) * alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a path constraint's {@link PathConstraint#position}. */\r\n\texport class PathConstraintPositionTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 2;\r\n\t\tstatic PREV_TIME = -2; static PREV_VALUE = -1;\r\n\t\tstatic VALUE = 1;\r\n\r\n\t\t/** The index of the path constraint slot in {@link Skeleton#pathConstraints} that will be changed. */\r\n\t\tpathConstraintIndex: number;\r\n\r\n\t\t/** The time in seconds and path constraint position for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, position, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * PathConstraintPositionTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.pathConstraintPosition << 24) + this.pathConstraintIndex;\r\n\t\t}\r\n\r\n\t\t/** Sets the time in seconds and path constraint position for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, value: number) {\r\n\t\t\tframeIndex *= PathConstraintPositionTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + PathConstraintPositionTimeline.VALUE] = value;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tlet constraint: PathConstraint = skeleton.pathConstraints[this.pathConstraintIndex];\r\n\t\t\tif (!constraint.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tconstraint.position = constraint.data.position;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tconstraint.position += (constraint.data.position - constraint.position) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet position = 0;\r\n\t\t\tif (time >= frames[frames.length - PathConstraintPositionTimeline.ENTRIES]) // Time is after last frame.\r\n\t\t\t\tposition = frames[frames.length + PathConstraintPositionTimeline.PREV_VALUE];\r\n\t\t\telse {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, PathConstraintPositionTimeline.ENTRIES);\r\n\t\t\t\tposition = frames[frame + PathConstraintPositionTimeline.PREV_VALUE];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / PathConstraintPositionTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + PathConstraintPositionTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tposition += (frames[frame + PathConstraintPositionTimeline.VALUE] - position) * percent;\r\n\t\t\t}\r\n\t\t\tif (blend == MixBlend.setup)\r\n\t\t\t\tconstraint.position = constraint.data.position + (position - constraint.data.position) * alpha;\r\n\t\t\telse\r\n\t\t\t\tconstraint.position += (position - constraint.position) * alpha;\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a path constraint's {@link PathConstraint#spacing}. */\r\n\texport class PathConstraintSpacingTimeline extends PathConstraintPositionTimeline {\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.pathConstraintSpacing << 24) + this.pathConstraintIndex;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tlet constraint: PathConstraint = skeleton.pathConstraints[this.pathConstraintIndex];\r\n\t\t\tif (!constraint.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tconstraint.spacing = constraint.data.spacing;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tconstraint.spacing += (constraint.data.spacing - constraint.spacing) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet spacing = 0;\r\n\t\t\tif (time >= frames[frames.length - PathConstraintSpacingTimeline.ENTRIES]) // Time is after last frame.\r\n\t\t\t\tspacing = frames[frames.length + PathConstraintSpacingTimeline.PREV_VALUE];\r\n\t\t\telse {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, PathConstraintSpacingTimeline.ENTRIES);\r\n\t\t\t\tspacing = frames[frame + PathConstraintSpacingTimeline.PREV_VALUE];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / PathConstraintSpacingTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + PathConstraintSpacingTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\tspacing += (frames[frame + PathConstraintSpacingTimeline.VALUE] - spacing) * percent;\r\n\t\t\t}\r\n\r\n\t\t\tif (blend == MixBlend.setup)\r\n\t\t\t\tconstraint.spacing = constraint.data.spacing + (spacing - constraint.data.spacing) * alpha;\r\n\t\t\telse\r\n\t\t\t\tconstraint.spacing += (spacing - constraint.spacing) * alpha;\r\n\t\t}\r\n\t}\r\n\r\n\t/** Changes a transform constraint's {@link PathConstraint#rotateMix} and\r\n\t * {@link TransformConstraint#translateMix}. */\r\n\texport class PathConstraintMixTimeline extends CurveTimeline {\r\n\t\tstatic ENTRIES = 3;\r\n\t\tstatic PREV_TIME = -3; static PREV_ROTATE = -2; static PREV_TRANSLATE = -1;\r\n\t\tstatic ROTATE = 1; static TRANSLATE = 2;\r\n\r\n\t\t/** The index of the path constraint slot in {@link Skeleton#getPathConstraints()} that will be changed. */\r\n\t\tpathConstraintIndex: number;\r\n\r\n\t\t/** The time in seconds, rotate mix, and translate mix for each key frame. */\r\n\t\tframes: ArrayLike<number>; // time, rotate mix, translate mix, ...\r\n\r\n\t\tconstructor (frameCount: number) {\r\n\t\t\tsuper(frameCount);\r\n\t\t\tthis.frames = Utils.newFloatArray(frameCount * PathConstraintMixTimeline.ENTRIES);\r\n\t\t}\r\n\r\n\t\tgetPropertyId () {\r\n\t\t\treturn (TimelineType.pathConstraintMix << 24) + this.pathConstraintIndex;\r\n\t\t}\r\n\r\n\t\t/** The time in seconds, rotate mix, and translate mix for the specified key frame. */\r\n\t\tsetFrame (frameIndex: number, time: number, rotateMix: number, translateMix: number) {\r\n\t\t\tframeIndex *= PathConstraintMixTimeline.ENTRIES;\r\n\t\t\tthis.frames[frameIndex] = time;\r\n\t\t\tthis.frames[frameIndex + PathConstraintMixTimeline.ROTATE] = rotateMix;\r\n\t\t\tthis.frames[frameIndex + PathConstraintMixTimeline.TRANSLATE] = translateMix;\r\n\t\t}\r\n\r\n\t\tapply (skeleton: Skeleton, lastTime: number, time: number, firedEvents: Array<Event>, alpha: number, blend: MixBlend, direction: MixDirection) {\r\n\t\t\tlet frames = this.frames;\r\n\t\t\tlet constraint: PathConstraint = skeleton.pathConstraints[this.pathConstraintIndex];\r\n\t\t\tif (!constraint.active) return;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\tconstraint.rotateMix = constraint.data.rotateMix;\r\n\t\t\t\t\tconstraint.translateMix = constraint.data.translateMix;\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\tconstraint.rotateMix += (constraint.data.rotateMix - constraint.rotateMix) * alpha;\r\n\t\t\t\t\tconstraint.translateMix += (constraint.data.translateMix - constraint.translateMix) * alpha;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet rotate = 0, translate = 0;\r\n\t\t\tif (time >= frames[frames.length - PathConstraintMixTimeline.ENTRIES]) { // Time is after last frame.\r\n\t\t\t\trotate = frames[frames.length + PathConstraintMixTimeline.PREV_ROTATE];\r\n\t\t\t\ttranslate = frames[frames.length + PathConstraintMixTimeline.PREV_TRANSLATE];\r\n\t\t\t} else {\r\n\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\tlet frame = Animation.binarySearch(frames, time, PathConstraintMixTimeline.ENTRIES);\r\n\t\t\t\trotate = frames[frame + PathConstraintMixTimeline.PREV_ROTATE];\r\n\t\t\t\ttranslate = frames[frame + PathConstraintMixTimeline.PREV_TRANSLATE];\r\n\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\tlet percent = this.getCurvePercent(frame / PathConstraintMixTimeline.ENTRIES - 1,\r\n\t\t\t\t\t1 - (time - frameTime) / (frames[frame + PathConstraintMixTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\trotate += (frames[frame + PathConstraintMixTimeline.ROTATE] - rotate) * percent;\r\n\t\t\t\ttranslate += (frames[frame + PathConstraintMixTimeline.TRANSLATE] - translate) * percent;\r\n\t\t\t}\r\n\r\n\t\t\tif (blend == MixBlend.setup) {\r\n\t\t\t\tconstraint.rotateMix = constraint.data.rotateMix + (rotate - constraint.data.rotateMix) * alpha;\r\n\t\t\t\tconstraint.translateMix = constraint.data.translateMix + (translate - constraint.data.translateMix) * alpha;\r\n\t\t\t} else {\r\n\t\t\t\tconstraint.rotateMix += (rotate - constraint.rotateMix) * alpha;\r\n\t\t\t\tconstraint.translateMix += (translate - constraint.translateMix) * alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Texture, TextureWrap, TextureFilter, TextureRegion } from \"./Texture\";\r\nimport { Disposable} from \"./Utils\";\r\n\r\n// module spine {\r\n\texport class TextureAtlas implements Disposable {\r\n\t\tpages = new Array<TextureAtlasPage>();\r\n\t\tregions = new Array<TextureAtlasRegion>();\r\n\r\n\t\tconstructor (atlasText: string, textureLoader: (path: string) => any) {\r\n\t\t\tthis.load(atlasText, textureLoader);\r\n\t\t}\r\n\r\n\t\tprivate load (atlasText: string, textureLoader: (path: string) => any) {\r\n\t\t\tif (textureLoader == null)\r\n\t\t\t\tthrow new Error(\"textureLoader cannot be null.\");\r\n\r\n\t\t\tlet reader = new TextureAtlasReader(atlasText);\r\n\t\t\tlet tuple = new Array<string>(4);\r\n\t\t\tlet page:TextureAtlasPage = null;\r\n\t\t\twhile (true) {\r\n\t\t\t\tlet line = reader.readLine();\r\n\t\t\t\tif (line == null)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tline = line.trim();\r\n\t\t\t\tif (line.length == 0)\r\n\t\t\t\t\tpage = null;\r\n\t\t\t\telse if (!page) {\r\n\t\t\t\t\tpage = new TextureAtlasPage();\r\n\t\t\t\t\tpage.name = line;\r\n\r\n\t\t\t\t\tif (reader.readTuple(tuple) == 2) { // size is only optional for an atlas packed with an old TexturePacker.\r\n\t\t\t\t\t\tpage.width = parseInt(tuple[0]);\r\n\t\t\t\t\t\tpage.height = parseInt(tuple[1]);\r\n\t\t\t\t\t\treader.readTuple(tuple);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// page.format = Format[tuple[0]]; we don't need format in WebGL\r\n\r\n\t\t\t\t\treader.readTuple(tuple);\r\n\t\t\t\t\tpage.minFilter = Texture.filterFromString(tuple[0]);\r\n\t\t\t\t\tpage.magFilter = Texture.filterFromString(tuple[1]);\r\n\r\n\t\t\t\t\tlet direction= reader.readValue();\r\n\t\t\t\t\tpage.uWrap = TextureWrap.ClampToEdge;\r\n\t\t\t\t\tpage.vWrap = TextureWrap.ClampToEdge;\r\n\t\t\t\t\tif (direction == \"x\")\r\n\t\t\t\t\t\tpage.uWrap = TextureWrap.Repeat;\r\n\t\t\t\t\telse if (direction == \"y\")\r\n\t\t\t\t\t\tpage.vWrap = TextureWrap.Repeat;\r\n\t\t\t\t\telse if (direction == \"xy\")\r\n\t\t\t\t\t\tpage.uWrap = page.vWrap = TextureWrap.Repeat;\r\n\r\n\t\t\t\t\tpage.texture = textureLoader(line);\r\n\t\t\t\t\tpage.texture.setFilters(page.minFilter, page.magFilter);\r\n\t\t\t\t\tpage.texture.setWraps(page.uWrap, page.vWrap);\r\n\t\t\t\t\tpage.width = page.texture.getImage().width;\r\n\t\t\t\t\tpage.height = page.texture.getImage().height;\r\n\t\t\t\t\tthis.pages.push(page);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet region:TextureAtlasRegion = new TextureAtlasRegion();\r\n\t\t\t\t\tregion.name = line;\r\n\t\t\t\t\tregion.page = page;\r\n\r\n\t\t\t\t\tlet rotateValue = reader.readValue();\r\n\t\t\t\t\tif (rotateValue.toLocaleLowerCase() == \"true\") {\r\n\t\t\t\t\t\tregion.degrees = 90;\r\n\t\t\t\t\t} else if (rotateValue.toLocaleLowerCase() == \"false\") {\r\n\t\t\t\t\t\tregion.degrees = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tregion.degrees = parseFloat(rotateValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tregion.rotate = region.degrees == 90;\r\n\r\n\t\t\t\t\treader.readTuple(tuple);\r\n\t\t\t\t\tlet x = parseInt(tuple[0]);\r\n\t\t\t\t\tlet y = parseInt(tuple[1]);\r\n\r\n\t\t\t\t\treader.readTuple(tuple);\r\n\t\t\t\t\tlet width = parseInt(tuple[0]);\r\n\t\t\t\t\tlet height = parseInt(tuple[1]);\r\n\r\n\t\t\t\t\tregion.u = x / page.width;\r\n\t\t\t\t\tregion.v = y / page.height;\r\n\t\t\t\t\tif (region.rotate) {\r\n\t\t\t\t\t\tregion.u2 = (x + height) / page.width;\r\n\t\t\t\t\t\tregion.v2 = (y + width) / page.height;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tregion.u2 = (x + width) / page.width;\r\n\t\t\t\t\t\tregion.v2 = (y + height) / page.height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tregion.x = x;\r\n\t\t\t\t\tregion.y = y;\r\n\t\t\t\t\tregion.width = Math.abs(width);\r\n\t\t\t\t\tregion.height = Math.abs(height);\r\n\r\n\t\t\t\t\tif (reader.readTuple(tuple) == 4) { // split is optional\r\n\t\t\t\t\t\t// region.splits = new Vector.<int>(parseInt(tuple[0]), parseInt(tuple[1]), parseInt(tuple[2]), parseInt(tuple[3]));\r\n\t\t\t\t\t\tif (reader.readTuple(tuple) == 4) { // pad is optional, but only present with splits\r\n\t\t\t\t\t\t\t//region.pads = Vector.<int>(parseInt(tuple[0]), parseInt(tuple[1]), parseInt(tuple[2]), parseInt(tuple[3]));\r\n\t\t\t\t\t\t\treader.readTuple(tuple);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tregion.originalWidth = parseInt(tuple[0]);\r\n\t\t\t\t\tregion.originalHeight = parseInt(tuple[1]);\r\n\r\n\t\t\t\t\treader.readTuple(tuple);\r\n\t\t\t\t\tregion.offsetX = parseInt(tuple[0]);\r\n\t\t\t\t\tregion.offsetY = parseInt(tuple[1]);\r\n\r\n\t\t\t\t\tregion.index = parseInt(reader.readValue());\r\n\r\n\t\t\t\t\tregion.texture = page.texture;\r\n\t\t\t\t\tthis.regions.push(region);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfindRegion (name: string): TextureAtlasRegion {\r\n\t\t\tfor (let i = 0; i < this.regions.length; i++) {\r\n\t\t\t\tif (this.regions[i].name == name) {\r\n\t\t\t\t\treturn this.regions[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t\tfor (let i = 0; i < this.pages.length; i++) {\r\n\t\t\t\tthis.pages[i].texture.dispose();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tclass TextureAtlasReader {\r\n\t\tlines: Array<string>;\r\n\t\tindex: number = 0;\r\n\r\n\t\tconstructor (text: string) {\r\n\t\t\tthis.lines = text.split(/\\r\\n|\\r|\\n/);\r\n\t\t}\r\n\r\n\t\treadLine (): string {\r\n\t\t\tif (this.index >= this.lines.length)\r\n\t\t\t\treturn null;\r\n\t\t\treturn this.lines[this.index++];\r\n\t\t}\r\n\r\n\t\treadValue (): string {\r\n\t\t\tlet line = this.readLine();\r\n\t\t\tlet colon= line.indexOf(\":\");\r\n\t\t\tif (colon == -1)\r\n\t\t\t\tthrow new Error(\"Invalid line: \" + line);\r\n\t\t\treturn line.substring(colon + 1).trim();\r\n\t\t}\r\n\r\n\t\treadTuple (tuple: Array<string>): number {\r\n\t\t\tlet line = this.readLine();\r\n\t\t\tlet colon = line.indexOf(\":\");\r\n\t\t\tif (colon == -1)\r\n\t\t\t\tthrow new Error(\"Invalid line: \" + line);\r\n\t\t\tlet i = 0, lastMatch = colon + 1;\r\n\t\t\tfor (; i < 3; i++) {\r\n\t\t\t\tlet comma = line.indexOf(\",\", lastMatch);\r\n\t\t\t\tif (comma == -1) break;\r\n\t\t\t\ttuple[i] = line.substr(lastMatch, comma - lastMatch).trim();\r\n\t\t\t\tlastMatch = comma + 1;\r\n\t\t\t}\r\n\t\t\ttuple[i] = line.substring(lastMatch).trim();\r\n\t\t\treturn i + 1;\r\n\t\t}\r\n\t}\r\n\r\n\texport class TextureAtlasPage {\r\n\t\tname: string;\r\n\t\tminFilter: TextureFilter;\r\n\t\tmagFilter: TextureFilter;\r\n\t\tuWrap: TextureWrap;\r\n\t\tvWrap: TextureWrap;\r\n\t\ttexture: Texture;\r\n\t\twidth: number;\r\n\t\theight: number;\r\n\t}\r\n\r\n\texport class TextureAtlasRegion extends TextureRegion {\r\n\t\tpage: TextureAtlasPage;\r\n\t\tname: string;\r\n\t\tx: number;\r\n\t\ty: number;\r\n\t\tindex: number;\r\n\t\t// rotate: boolean;\r\n\t\tdegrees: number;\r\n\t\ttexture: Texture;\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { FakeTexture } from \"./Texture\";\r\nimport { TextureAtlas } from \"./TextureAtlas\";\r\nimport {Map, Disposable} from \"./Utils\";\r\n\r\n// module spine {\r\n\texport class AssetManager implements Disposable {\r\n\t\tprivate pathPrefix: string;\r\n\t\tprivate textureLoader: (image: HTMLImageElement) => any;\r\n\t\tprivate assets: Map<any> = {};\r\n\t\tprivate errors: Map<string> = {};\r\n\t\tprivate toLoad = 0;\r\n\t\tprivate loaded = 0;\r\n\t\tprivate rawDataUris: Map<string> = {};\r\n\r\n\t\tconstructor (textureLoader: (image: HTMLImageElement) => any, pathPrefix: string = \"\") {\r\n\t\t\tthis.textureLoader = textureLoader;\r\n\t\t\tthis.pathPrefix = pathPrefix;\r\n\t\t}\r\n\t\t\r\n\t\tprivate encodePath(path: string) {\r\n\t\t\tlet parts = path.split(\"/\");\r\n\t\t\tfor (let i = 0; i < parts.length; i++) {\r\n\t\t\t\tparts[i] = encodeURIComponent(parts[i]);\r\n\t\t\t}\r\n\t\t\tpath = parts.join(\"/\");\r\n\t\t\treturn path\r\n\t\t}\r\n\r\n\t\tprivate downloadText (url: string, success: (data: string) => void, error: (status: number, responseText: string) => void) {\r\n\t\t\tif (this.rawDataUris[url]) {\r\n\t\t\t\tlet data = this.rawDataUris[url];\r\n\t\t\t\tlet textData = atob(data);\r\n\t\t\t\tsuccess(textData);\r\n\t\t\t\treturn;\r\n\t\t\t} \r\n\r\n\t\t\tlet request = new XMLHttpRequest();\r\n\t\t\trequest.overrideMimeType(\"text/html\");\r\n\t\t\t// if (this.rawDataUris[url]) {\r\n\t\t\t// \turl = this.rawDataUris[url];\r\n\t\t\t// } \r\n\t\t\t// request.open(\"GET\", url, true);\r\n\t\t\trequest.open(\"GET\", this.encodePath(url), true);\r\n\t\t\trequest.onload = () => {\r\n\t\t\t\tif (request.status == 200) {\r\n\t\t\t\t\t// success(request.responseText);\r\n\r\n\t\t\t\t\t// HACK: Add logic to handle empty resopnse\r\n\t\t\t\t\tif (request.responseText.length == 0) {\r\n\t\t\t\t\t\terror(request.status, request.responseText);\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsuccess(request.responseText);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\terror(request.status, request.responseText);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\trequest.onerror = () => {\r\n\t\t\t\terror(request.status, request.responseText);\r\n\t\t\t}\r\n\t\t\trequest.send();\r\n\t\t}\r\n\r\n\t\tprivate base64ToArrayBuffer(base64: string): Uint8Array {\r\n\t\t\tvar binaryString = atob(base64);\r\n\t\t\tvar bytes = new Uint8Array(binaryString.length);\r\n\t\t\tfor (var i = 0; i < binaryString.length; i++) {\r\n\t\t\t\tbytes[i] = binaryString.charCodeAt(i);\r\n\t\t\t}\r\n\t\t\treturn bytes;\r\n\t\t}\r\n\r\n\t\tprivate downloadBinary (url: string, success: (data: Uint8Array) => void, error: (status: number, responseText: string) => void) {\r\n\t\t\tif (this.rawDataUris[url]) {\r\n\t\t\t\tlet data64 = this.rawDataUris[url];\r\n\t\t\t\tlet binaryData = this.base64ToArrayBuffer(data64);\r\n\t\t\t\tconsole.log(url, data64);\r\n\t\t\t\tsuccess(binaryData);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet request = new XMLHttpRequest();\r\n\t\t\t// request.open(\"GET\", url, true);\r\n\t\t\trequest.open(\"GET\", this.encodePath(url), true);\r\n\t\t\trequest.responseType = \"arraybuffer\";\r\n\t\t\trequest.onload = () => {\r\n\t\t\t\tif (request.status == 200) {\r\n\t\t\t\t\t// success(new Uint8Array(request.response as ArrayBuffer));\r\n\t\t\t\t\t// HACK: Add logic to handle empty response\r\n\t\t\t\t\tif (request.response == null) {\r\n\t\t\t\t\t\terror(request.status, request.responseText);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsuccess(new Uint8Array(request.response as ArrayBuffer));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// error(request.status, request.responseText);\r\n\t\t\t\t\terror(request.status, request.response);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\trequest.onerror = () => {\r\n\t\t\t\terror(request.status, request.response);\r\n\t\t\t\t// error(request.status, request.responseText);\r\n\t\t\t}\r\n\t\t\trequest.send();\r\n\t\t}\r\n\r\n\t\tsetRawDataURI(path: string, data: string) {\r\n\t\t\tthis.rawDataUris[this.pathPrefix + path] = data;\r\n\t\t}\r\n\r\n\t\tloadBinary(path: string,\r\n\t\t\tsuccess: (path: string, binary: Uint8Array) => void = null,\r\n\t\t\terror: (path: string, error: string) => void = null) {\r\n\t\t\tpath = this.pathPrefix + path;\r\n\t\t\tthis.toLoad++;\r\n\r\n\t\t\tthis.downloadBinary(path, (data: Uint8Array): void => {\r\n\t\t\t\tthis.assets[path] = data;\r\n\t\t\t\tif (success) success(path, data);\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t}, (state: number, responseText: string): void => {\r\n\t\t\t\tthis.errors[path] = `Couldn't load binary ${path}: status ${status}, ${responseText}`;\r\n\t\t\t\tif (error) error(path, `Couldn't load binary ${path}: status ${status}, ${responseText}`);\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tloadText(path: string,\r\n\t\t\tsuccess: (path: string, text: string) => void = null,\r\n\t\t\terror: (path: string, error: string) => void = null) {\r\n\t\t\tpath = this.pathPrefix + path;\r\n\t\t\tthis.toLoad++;\r\n\r\n\t\t\tthis.downloadText(path, (data: string): void => {\r\n\t\t\t\tthis.assets[path] = data;\r\n\t\t\t\tif (success) success(path, data);\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t}, (state: number, responseText: string): void => {\r\n\t\t\t\tthis.errors[path] = `Couldn't load text ${path}: status ${status}, ${responseText}`;\r\n\t\t\t\tif (error) error(path, `Couldn't load text ${path}: status ${status}, ${responseText}`);\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tloadTexture (path: string,\r\n\t\t\tsuccess: (path: string, image: HTMLImageElement) => void = null,\r\n\t\t\terror: (path: string, error: string) => void = null) {\r\n\t\t\tpath = this.pathPrefix + path;\r\n\t\t\tlet storagePath = path;\r\n\t\t\tthis.toLoad++;\r\n\t\t\tlet img = new Image();\r\n\t\t\timg.crossOrigin = \"anonymous\";\r\n\t\t\timg.onload = (ev) => {\r\n\t\t\t\tlet texture = this.textureLoader(img);\r\n\t\t\t\tthis.assets[storagePath] = texture;\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t\tif (success) success(path, img);\r\n\t\t\t}\r\n\t\t\timg.onerror = (ev) => {\r\n\t\t\t\tthis.errors[path] = `Couldn't load image ${path}`;\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t\tif (error) error(path, `Couldn't load image ${path}`);\r\n\t\t\t}\r\n\t\t\r\n\t\t\tif (this.rawDataUris[path]) {\r\n\t\t\t\tlet data = this.rawDataUris[path];\r\n\t\t\t\timg.src = \"data:image/png;base64,\" + data;\r\n\t\t\t} else {\r\n\t\t\t\timg.src = this.encodePath(path);\t\r\n\t\t\t}\r\n\t\t\t// if (this.rawDataUris[path]) {\r\n\t\t\t// \tpath = this.rawDataUris[path];\r\n\t\t\t// }\r\n\t\t\t// img.src = path;\r\n\t\t}\r\n\r\n\t\tloadTextureAtlas (path: string,\r\n\t\t\tsuccess: (path: string, atlas: TextureAtlas) => void = null,\r\n\t\t\terror: (path: string, error: string) => void = null\r\n\t\t) {\r\n\t\t\tlet parent = path.lastIndexOf(\"/\") >= 0 ? path.substring(0, path.lastIndexOf(\"/\")) : \"\";\r\n\t\t\tpath = this.pathPrefix + path;\r\n\t\t\tthis.toLoad++;\r\n\r\n\t\t\tthis.downloadText(path, (atlasData: string): void => {\r\n\t\t\t\tlet pagesLoaded: any = { count: 0 };\r\n\t\t\t\tlet atlasPages = new Array<string>();\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet atlas = new TextureAtlas(atlasData, (path: string) => {\r\n\t\t\t\t\t\tatlasPages.push(parent == \"\" ? path : parent + \"/\" + path);\r\n\t\t\t\t\t\tlet image = document.createElement(\"img\") as HTMLImageElement;\r\n\t\t\t\t\t\timage.width = 16;\r\n\t\t\t\t\t\timage.height = 16;\r\n\t\t\t\t\t\treturn new FakeTexture(image);\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tlet ex = e as Error;\r\n\t\t\t\t\tthis.errors[path] = `Couldn't load texture atlas ${path}: ${ex.message}`;\r\n\t\t\t\t\tif (error) error(path, `Couldn't load texture atlas ${path}: ${ex.message}`);\r\n\t\t\t\t\tthis.toLoad--;\r\n\t\t\t\t\tthis.loaded++;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let atlasPage of atlasPages) {\r\n\t\t\t\t\tlet pageLoadError = false;\r\n\t\t\t\t\tthis.loadTexture(atlasPage, (imagePath: string, image: HTMLImageElement) => {\r\n\t\t\t\t\t\tpagesLoaded.count++;\r\n\r\n\t\t\t\t\t\tif (pagesLoaded.count == atlasPages.length) {\r\n\t\t\t\t\t\t\tif (!pageLoadError) {\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tlet atlas = new TextureAtlas(atlasData, (path: string) => {\r\n\t\t\t\t\t\t\t\t\t\treturn this.get(parent == \"\" ? path : parent + \"/\" + path);\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tthis.assets[path] = atlas;\r\n\t\t\t\t\t\t\t\t\tif (success) success(path, atlas);\r\n\t\t\t\t\t\t\t\t\tthis.toLoad--;\r\n\t\t\t\t\t\t\t\t\tthis.loaded++;\r\n\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\tlet ex = e as Error;\r\n\t\t\t\t\t\t\t\t\tthis.errors[path] = `Couldn't load texture atlas ${path}: ${ex.message}`;\r\n\t\t\t\t\t\t\t\t\tif (error) error(path, `Couldn't load texture atlas ${path}: ${ex.message}`);\r\n\t\t\t\t\t\t\t\t\tthis.toLoad--;\r\n\t\t\t\t\t\t\t\t\tthis.loaded++;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.errors[path] = `Couldn't load texture atlas page ${imagePath}} of atlas ${path}`;\r\n\t\t\t\t\t\t\t\tif (error) error(path, `Couldn't load texture atlas page ${imagePath} of atlas ${path}`);\r\n\t\t\t\t\t\t\t\tthis.toLoad--;\r\n\t\t\t\t\t\t\t\tthis.loaded++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, (imagePath: string, errorMessage: string) => {\r\n\t\t\t\t\t\tpageLoadError = true;\r\n\t\t\t\t\t\tpagesLoaded.count++;\r\n\r\n\t\t\t\t\t\tif (pagesLoaded.count == atlasPages.length) {\r\n\t\t\t\t\t\t\tthis.errors[path] = `Couldn't load texture atlas page ${imagePath}} of atlas ${path}`;\r\n\t\t\t\t\t\t\tif (error) error(path, `Couldn't load texture atlas page ${imagePath} of atlas ${path}`);\r\n\t\t\t\t\t\t\tthis.toLoad--;\r\n\t\t\t\t\t\t\tthis.loaded++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, (state: number, responseText: string): void => {\r\n\t\t\t\tthis.errors[path] = `Couldn't load texture atlas ${path}: status ${status}, ${responseText}`;\r\n\t\t\t\tif (error) error(path, `Couldn't load texture atlas ${path}: status ${status}, ${responseText}`);\r\n\t\t\t\tthis.toLoad--;\r\n\t\t\t\tthis.loaded++;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tget (path: string) {\r\n\t\t\tpath = this.pathPrefix + path;\r\n\t\t\treturn this.assets[path];\r\n\t\t}\r\n\r\n\t\tremove (path: string) {\r\n\t\t\tpath = this.pathPrefix + path;\r\n\t\t\tlet asset = this.assets[path];\r\n\t\t\tif ((<any>asset).dispose) (<any>asset).dispose();\r\n\t\t\tthis.assets[path] = null;\r\n\t\t}\r\n\r\n\t\tremoveAll () {\r\n\t\t\tfor (let key in this.assets) {\r\n\t\t\t\tlet asset = this.assets[key];\r\n\t\t\t\tif ((<any>asset).dispose) (<any>asset).dispose();\r\n\t\t\t}\r\n\t\t\tthis.assets = {};\r\n\t\t}\r\n\r\n\t\tisLoadingComplete (): boolean {\r\n\t\t\treturn this.toLoad == 0;\r\n\t\t}\r\n\r\n\t\tgetToLoad (): number {\r\n\t\t\treturn this.toLoad;\r\n\t\t}\r\n\r\n\t\tgetLoaded (): number {\r\n\t\t\treturn this.loaded;\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t\tthis.removeAll();\r\n\t\t}\r\n\r\n\t\thasErrors() {\r\n\t\t\treturn Object.keys(this.errors).length > 0;\r\n\t\t}\r\n\r\n\t\tgetErrors() {\r\n\t\t\treturn this.errors;\r\n\t\t}\r\n\r\n\t\tclearErrors() {\r\n\t\t\tthis.errors = {};\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BlendMode } from \"../core/BlendMode\";\r\nimport { Restorable } from \"../core/Utils\";\r\n\r\n// module spine.webgl {\r\n\texport class ManagedWebGLRenderingContext {\r\n\t\tpublic canvas: HTMLCanvasElement | OffscreenCanvas;\r\n\t\tpublic gl: WebGLRenderingContext;\r\n\t\tprivate restorables = new Array<Restorable>();\r\n\r\n\t\tconstructor(canvasOrContext: HTMLCanvasElement | WebGLRenderingContext | OffscreenCanvas, contextConfig: any = { alpha: \"true\" }) {\r\n\t\t\tif (canvasOrContext instanceof HTMLCanvasElement || canvasOrContext instanceof OffscreenCanvas) {\r\n\t\t\t\tlet canvas = canvasOrContext;\r\n\t\t\t\tthis.gl = <WebGLRenderingContext> (canvas.getContext(\"webgl2\", contextConfig) || canvas.getContext(\"webgl\", contextConfig));\r\n\t\t\t\tthis.canvas = canvas;\r\n\t\t\t\tcanvas.addEventListener(\"webglcontextlost\", (e: any) => {\r\n\t\t\t\t\tlet event = <WebGLContextEvent>e;\r\n\t\t\t\t\tif (e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcanvas.addEventListener(\"webglcontextrestored\", (e: any) => {\r\n\t\t\t\t\tfor (let i = 0, n = this.restorables.length; i < n; i++) {\r\n\t\t\t\t\t\tthis.restorables[i].restore();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tthis.gl = canvasOrContext;\r\n\t\t\t\tthis.canvas = this.gl.canvas;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\taddRestorable(restorable: Restorable) {\r\n\t\t\tthis.restorables.push(restorable);\r\n\t\t}\r\n\r\n\t\tremoveRestorable(restorable: Restorable) {\r\n\t\t\tlet index = this.restorables.indexOf(restorable);\r\n\t\t\tif (index > -1) this.restorables.splice(index, 1);\r\n\t\t}\r\n\t}\r\n\r\n\texport class WebGLBlendModeConverter {\r\n\t\tstatic ZERO = 0;\r\n\t\tstatic ONE = 1;\r\n\t\tstatic SRC_COLOR = 0x0300;\r\n\t\tstatic ONE_MINUS_SRC_COLOR = 0x0301;\r\n\t\tstatic SRC_ALPHA = 0x0302;\r\n\t\tstatic ONE_MINUS_SRC_ALPHA = 0x0303;\r\n\t\tstatic DST_ALPHA = 0x0304;\r\n\t\tstatic ONE_MINUS_DST_ALPHA = 0x0305;\r\n\t\tstatic DST_COLOR = 0x0306\r\n\r\n\t\tstatic getDestGLBlendMode (blendMode: BlendMode) {\r\n\t\t\tswitch(blendMode) {\r\n\t\t\t\tcase BlendMode.Normal: return WebGLBlendModeConverter.ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tcase BlendMode.Additive: return WebGLBlendModeConverter.ONE;\r\n\t\t\t\tcase BlendMode.Multiply: return WebGLBlendModeConverter.ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tcase BlendMode.Screen: return WebGLBlendModeConverter.ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tdefault: throw new Error(\"Unknown blend mode: \" + blendMode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic getSourceGLBlendMode (blendMode: BlendMode, premultipliedAlpha: boolean = false) {\r\n\t\t\tswitch(blendMode) {\r\n\t\t\t\tcase BlendMode.Normal: return premultipliedAlpha? WebGLBlendModeConverter.ONE : WebGLBlendModeConverter.SRC_ALPHA;\r\n\t\t\t\tcase BlendMode.Additive: return premultipliedAlpha? WebGLBlendModeConverter.ONE : WebGLBlendModeConverter.SRC_ALPHA;\r\n\t\t\t\tcase BlendMode.Multiply: return WebGLBlendModeConverter.DST_COLOR;\r\n\t\t\t\tcase BlendMode.Screen: return WebGLBlendModeConverter.ONE;\r\n\t\t\t\tdefault: throw new Error(\"Unknown blend mode: \" + blendMode);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Texture, TextureFilter, TextureWrap } from \"../core/Texture\";\r\nimport { Restorable, Disposable } from \"../core/Utils\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\texport class GLTexture extends Texture implements Disposable, Restorable {\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate texture: WebGLTexture = null;\r\n\t\tprivate boundUnit = 0;\r\n\t\tprivate useMipMaps = false;\r\n\r\n\t\tpublic static DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL = false;\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext | WebGLRenderingContext, image: HTMLImageElement, useMipMaps: boolean = false) {\r\n\t\t\tsuper(image);\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t\tthis.useMipMaps = useMipMaps;\r\n\t\t\tthis.restore();\r\n\t\t\tthis.context.addRestorable(this);\r\n\t\t}\r\n\r\n\t\tsetFilters (minFilter: TextureFilter, magFilter: TextureFilter) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.bind();\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, minFilter);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, GLTexture.validateMagFilter(magFilter));\r\n\t\t}\r\n\r\n\t\tstatic validateMagFilter (magFilter: TextureFilter) {\r\n\t\t\tswitch(magFilter) {\r\n\t\t\t\tcase TextureFilter.MipMap:\r\n\t\t\t\tcase TextureFilter.MipMapLinearLinear:\r\n\t\t\t\tcase TextureFilter.MipMapLinearNearest:\r\n\t\t\t\tcase TextureFilter.MipMapNearestLinear:\r\n\t\t\t\tcase TextureFilter.MipMapNearestNearest:\r\n\t\t\t\t\treturn TextureFilter.Linear;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn magFilter;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsetWraps (uWrap: TextureWrap, vWrap: TextureWrap) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.bind();\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, uWrap);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, vWrap);\r\n\t\t}\r\n\r\n\t\tupdate (useMipMaps: boolean) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (!this.texture) {\r\n\t\t\t\tthis.texture = this.context.gl.createTexture();\r\n\t\t\t}\r\n\t\t\tthis.bind();\r\n\t\t\tif (GLTexture.DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL) gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);\r\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this._image);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, useMipMaps ? gl.LINEAR_MIPMAP_LINEAR : gl.LINEAR);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\t\t\tif (useMipMaps) gl.generateMipmap(gl.TEXTURE_2D);\r\n\t\t}\r\n\r\n\t\trestore () {\r\n\t\t\tthis.texture = null;\r\n\t\t\tthis.update(this.useMipMaps);\r\n\t\t}\r\n\r\n\t\tbind (unit: number = 0) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.boundUnit = unit;\r\n\t\t\tgl.activeTexture(gl.TEXTURE0 + unit);\r\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n\t\t}\r\n\r\n\t\tunbind () {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tgl.activeTexture(gl.TEXTURE0 + this.boundUnit);\r\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, null);\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t\tthis.context.removeRestorable(this);\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tgl.deleteTexture(this.texture);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { AssetManager as spineAssetManager } from \"../core/AssetManager\";\r\nimport { GLTexture } from \"./GLTexture\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\nimport { Restorable, Disposable } from \"../core/Utils\";\r\n\r\n\r\ntype AssetManagerContext = ManagedWebGLRenderingContext | WebGLRenderingContext;\r\ntype AssetManagerContextList = AssetManagerContext[];\r\n\r\nexport class AssetManager extends spineAssetManager {\r\n\r\n\t// HACK!!!!\r\n\t// This is a hack to allow loading textures for multiple webGl Context\r\n\t// without needing to keep multiple assetManagers around.\r\n\t// We load the GLTextures for all the contexts but only the first\r\n\t// context is treated as 'primary' and returned from the textureLoader\r\n\t// callback. This allows the existing code for TextureAtlas to work\r\n\t// normally.\r\n\tprivate altTextures: GLTexture[] = [];\r\n\r\n\tconstructor(context: AssetManagerContextList | AssetManagerContext, pathPrefix: string = \"\") {\r\n\t\tsuper((image: HTMLImageElement) => {\r\n\r\n\t\t\tif (context instanceof ManagedWebGLRenderingContext || context instanceof WebGLRenderingContext) {\r\n\t\t\t\treturn new GLTexture(context as AssetManagerContext, image);\r\n\t\t\t} else {\r\n\t\t\t\tlet ctx = context as AssetManagerContextList;\r\n\t\t\t\tfor (let i = 1; i < ctx.length; i++) {\r\n\t\t\t\t\tthis.altTextures.push(new GLTexture(ctx[i], image));\r\n\t\t\t\t}\r\n\t\t\t\treturn new GLTexture(ctx[0], image);\r\n\t\t\t}\r\n\r\n\t\t}, pathPrefix);\r\n\t}\r\n\r\n\tdispose() {\r\n\t\tsuper.dispose();\r\n\t\tfor (let i = 0; i < this.altTextures.length; i++) {\r\n\t\t\tthis.altTextures[i].dispose();\r\n\t\t}\r\n\t\tthis.altTextures = [];\r\n\t}\r\n}\r\n\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { MixBlend } from \"./Animation\";\r\nimport { Skeleton } from \"./Skeleton\";\r\n\r\n// module spine {\r\n\texport interface Map<T> {\r\n\t\t[key: string]: T;\r\n\t}\r\n\r\n\texport class IntSet {\r\n\t\tarray = new Array<number>();\r\n\r\n\t\tadd (value: number): boolean {\r\n\t\t\tlet contains = this.contains(value);\r\n\t\t\tthis.array[value | 0] = value | 0;\r\n\t\t\treturn !contains;\r\n\t\t}\r\n\r\n\t\tcontains (value: number) {\r\n\t\t\treturn this.array[value | 0] != undefined;\r\n\t\t}\r\n\r\n\t\tremove (value: number) {\r\n\t\t\tthis.array[value | 0] = undefined;\r\n\t\t}\r\n\r\n\t\tclear () {\r\n\t\t\tthis.array.length = 0;\r\n\t\t}\r\n\t}\r\n\r\n\texport interface Disposable {\r\n\t\tdispose (): void;\r\n\t}\r\n\r\n\texport interface Restorable {\r\n\t\trestore (): void;\r\n\t}\r\n\r\n\texport class Color {\r\n\t\tpublic static WHITE = new Color(1, 1, 1, 1);\r\n\t\tpublic static RED = new Color(1, 0, 0, 1);\r\n\t\tpublic static GREEN = new Color(0, 1, 0, 1);\r\n\t\tpublic static BLUE = new Color(0, 0, 1, 1);\r\n\t\tpublic static MAGENTA = new Color(1, 0, 1, 1);\r\n\t\tpublic static ORANGE = new Color(1, 0.5, 0.1, 1.0);\r\n\r\n\t\tconstructor (public r: number = 0, public g: number = 0, public b: number = 0, public a: number = 0) {\r\n\t\t}\r\n\r\n\t\tset (r: number, g: number, b: number, a: number) {\r\n\t\t\tthis.r = r;\r\n\t\t\tthis.g = g;\r\n\t\t\tthis.b = b;\r\n\t\t\tthis.a = a;\r\n\t\t\tthis.clamp();\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tsetFromColor (c: Color) {\r\n\t\t\tthis.r = c.r;\r\n\t\t\tthis.g = c.g;\r\n\t\t\tthis.b = c.b;\r\n\t\t\tthis.a = c.a;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tsetFromString (hex: string) {\r\n\t\t\thex = hex.charAt(0) == '#' ? hex.substr(1) : hex;\r\n\t\t\tthis.r = parseInt(hex.substr(0, 2), 16) / 255.0;\r\n\t\t\tthis.g = parseInt(hex.substr(2, 2), 16) / 255.0;\r\n\t\t\tthis.b = parseInt(hex.substr(4, 2), 16) / 255.0;\r\n\t\t\tthis.a = (hex.length != 8 ? 255 : parseInt(hex.substr(6, 2), 16)) / 255.0;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tadd (r: number, g: number, b: number, a: number) {\r\n\t\t\tthis.r += r;\r\n\t\t\tthis.g += g;\r\n\t\t\tthis.b += b;\r\n\t\t\tthis.a += a;\r\n\t\t\tthis.clamp();\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tclamp () {\r\n\t\t\tif (this.r < 0) this.r = 0;\r\n\t\t\telse if (this.r > 1) this.r = 1;\r\n\r\n\t\t\tif (this.g < 0) this.g = 0;\r\n\t\t\telse if (this.g > 1) this.g = 1;\r\n\r\n\t\t\tif (this.b < 0) this.b = 0;\r\n\t\t\telse if (this.b > 1) this.b = 1;\r\n\r\n\t\t\tif (this.a < 0) this.a = 0;\r\n\t\t\telse if (this.a > 1) this.a = 1;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tstatic rgba8888ToColor(color: Color, value: number) {\r\n\t\t\tcolor.r = ((value & 0xff000000) >>> 24) / 255;\r\n\t\t\tcolor.g = ((value & 0x00ff0000) >>> 16) / 255;\r\n\t\t\tcolor.b = ((value & 0x0000ff00) >>> 8) / 255;\r\n\t\t\tcolor.a = ((value & 0x000000ff)) / 255;\r\n\t\t}\r\n\r\n\t\tstatic rgb888ToColor (color: Color, value: number) {\r\n\t\t\tcolor.r = ((value & 0x00ff0000) >>> 16) / 255;\r\n\t\t\tcolor.g = ((value & 0x0000ff00) >>> 8) / 255;\r\n\t\t\tcolor.b = ((value & 0x000000ff)) / 255;\r\n\t\t}\r\n\t}\r\n\r\n\texport class MathUtils {\r\n\t\tstatic PI = 3.1415927;\r\n\t\tstatic PI2 = MathUtils.PI * 2;\r\n\t\tstatic radiansToDegrees = 180 / MathUtils.PI;\r\n\t\tstatic radDeg = MathUtils.radiansToDegrees;\r\n\t\tstatic degreesToRadians = MathUtils.PI / 180;\r\n\t\tstatic degRad = MathUtils.degreesToRadians;\r\n\r\n\t\tstatic clamp (value: number, min: number, max: number) {\r\n\t\t\tif (value < min) return min;\r\n\t\t\tif (value > max) return max;\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tstatic cosDeg (degrees: number) {\r\n\t\t\treturn Math.cos(degrees * MathUtils.degRad);\r\n\t\t}\r\n\r\n\t\tstatic sinDeg (degrees: number) {\r\n\t\t\treturn Math.sin(degrees * MathUtils.degRad);\r\n\t\t}\r\n\r\n\t\tstatic signum (value: number): number {\r\n\t\t\treturn value > 0 ? 1 : value < 0 ? -1 : 0;\r\n\t\t}\r\n\r\n\t\tstatic toInt (x: number) {\r\n\t\t\treturn x > 0 ? Math.floor(x) : Math.ceil(x);\r\n\t\t}\r\n\r\n\t\tstatic cbrt (x: number) {\r\n\t\t\tlet y = Math.pow(Math.abs(x), 1/3);\r\n\t\t\treturn x < 0 ? -y : y;\r\n\t\t}\r\n\r\n\t\tstatic randomTriangular (min: number, max: number): number {\r\n\t\t\treturn MathUtils.randomTriangularWith(min, max, (min + max) * 0.5);\r\n\t\t}\r\n\r\n\t\tstatic randomTriangularWith (min: number, max: number, mode: number): number {\r\n\t\t\tlet u = Math.random();\r\n\t\t\tlet d = max - min;\r\n\t\t\tif (u <= (mode - min) / d) return min + Math.sqrt(u * d * (mode - min));\r\n\t\t\treturn max - Math.sqrt((1 - u) * d * (max - mode));\r\n\t\t}\r\n\t}\r\n\r\n\texport abstract class Interpolation {\r\n\t\tprotected abstract applyInternal (a: number): number;\r\n\t\tapply(start: number, end: number, a: number): number {\r\n\t\t\treturn start + (end - start) * this.applyInternal(a);\r\n\t\t}\r\n\t}\r\n\r\n\texport class Pow extends Interpolation {\r\n\t\tprotected power = 2;\r\n\r\n\t\tconstructor (power: number) {\r\n\t\t\tsuper();\r\n\t\t\tthis.power = power;\r\n\t\t}\r\n\r\n\t\tapplyInternal (a: number): number {\r\n\t\t\tif (a <= 0.5) return Math.pow(a * 2, this.power) / 2;\r\n\t\t\treturn Math.pow((a - 1) * 2, this.power) / (this.power % 2 == 0 ? -2 : 2) + 1;\r\n\t\t}\r\n\t}\r\n\r\n\texport class PowOut extends Pow {\r\n\t\tconstructor (power: number) {\r\n\t\t\tsuper(power);\r\n\t\t}\r\n\r\n\t\tapplyInternal (a: number) : number {\r\n\t\t\treturn Math.pow(a - 1, this.power) * (this.power % 2 == 0 ? -1 : 1) + 1;\r\n\t\t}\r\n\t}\r\n\r\n\texport class Utils {\r\n\t\tstatic SUPPORTS_TYPED_ARRAYS = typeof(Float32Array) !== \"undefined\";\r\n\r\n\t\tstatic arrayCopy<T> (source: ArrayLike<T>, sourceStart: number, dest: ArrayLike<T>, destStart: number, numElements: number) {\r\n\t\t\tfor (let i = sourceStart, j = destStart; i < sourceStart + numElements; i++, j++) {\r\n\t\t\t\tdest[j] = source[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic setArraySize<T> (array: Array<T>, size: number, value: any = 0): Array<T> {\r\n\t\t\tlet oldSize = array.length;\r\n\t\t\tif (oldSize == size) return array;\r\n\t\t\tarray.length = size;\r\n\t\t\tif (oldSize < size) {\r\n\t\t\t\tfor (let i = oldSize; i < size; i++) array[i] = value;\r\n\t\t\t}\r\n\t\t\treturn array;\r\n\t\t}\r\n\r\n\t\tstatic ensureArrayCapacity<T> (array: Array<T>, size: number, value: any = 0): Array<T> {\r\n\t\t\tif (array.length >= size) return array;\r\n\t\t\treturn Utils.setArraySize(array, size, value);\r\n\t\t}\r\n\r\n\t\tstatic newArray<T> (size: number, defaultValue: T): Array<T> {\r\n\t\t\tlet array = new Array<T>(size);\r\n\t\t\tfor (let i = 0; i < size; i++) array[i] = defaultValue;\r\n\t\t\treturn array;\r\n\t\t}\r\n\r\n\t\tstatic newFloatArray (size: number): ArrayLike<number> {\r\n\t\t\tif (Utils.SUPPORTS_TYPED_ARRAYS) {\r\n\t\t\t\treturn new Float32Array(size)\r\n\t\t\t} else {\r\n\t\t\t\t let array = new Array<number>(size);\r\n\t\t\t\t for (let i = 0; i < array.length; i++) array[i] = 0;\r\n\t\t\t\t return array;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic newShortArray (size: number): ArrayLike<number> {\r\n\t\t\tif (Utils.SUPPORTS_TYPED_ARRAYS) {\r\n\t\t\t\treturn new Int16Array(size)\r\n\t\t\t} else {\r\n\t\t\t\t let array = new Array<number>(size);\r\n\t\t\t\t for (let i = 0; i < array.length; i++) array[i] = 0;\r\n\t\t\t\t return array;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic toFloatArray (array: Array<number>) {\r\n\t\t\treturn Utils.SUPPORTS_TYPED_ARRAYS ? new Float32Array(array) : array;\r\n\t\t}\r\n\r\n\t\tstatic toSinglePrecision (value: number) {\r\n\t\t\treturn Utils.SUPPORTS_TYPED_ARRAYS ? Math.fround(value) : value;\r\n\t\t}\r\n\r\n\t\t// This function is used to fix WebKit 602 specific issue described at http://esotericsoftware.com/forum/iOS-10-disappearing-graphics-10109\r\n\t\tstatic webkit602BugfixHelper (alpha: number, blend: MixBlend) {\r\n\r\n\t\t}\r\n\r\n\t\tstatic contains<T> (array: Array<T>, element: T, identity = true) {\r\n\t\t\tfor (var i = 0; i < array.length; i++) {\r\n\t\t\t\tif (array[i] == element) return true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\texport class DebugUtils {\r\n\t\tstatic logBones(skeleton: Skeleton) {\r\n\t\t\tfor (let i = 0; i < skeleton.bones.length; i++) {\r\n\t\t\t\tlet bone = skeleton.bones[i];\r\n\t\t\t\tconsole.log(bone.data.name + \", \" + bone.a + \", \" + bone.b + \", \" + bone.c + \", \" + bone.d + \", \" + bone.worldX + \", \" + bone.worldY);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport class Pool<T> {\r\n\t\tprivate items = new Array<T>();\r\n\t\tprivate instantiator: () => T;\r\n\r\n\t\tconstructor (instantiator: () => T) {\r\n\t\t\tthis.instantiator = instantiator;\r\n\t\t}\r\n\r\n\t\tobtain () {\r\n\t\t\treturn this.items.length > 0 ? this.items.pop() : this.instantiator();\r\n\t\t}\r\n\r\n\t\tfree (item: T) {\r\n\t\t\tif ((item as any).reset) (item as any).reset();\r\n\t\t\tthis.items.push(item);\r\n\t\t}\r\n\r\n\t\tfreeAll (items: ArrayLike<T>) {\r\n\t\t\tfor (let i = 0; i < items.length; i++) {\r\n\t\t\t\tif ((items[i] as any).reset) (items[i] as any).reset();\r\n\t\t\t\tthis.items[i] = items[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tclear () {\r\n\t\t\tthis.items.length = 0;\r\n\t\t}\r\n\t}\r\n\r\n\texport class Vector2 {\r\n\t\tconstructor (public x = 0, public y = 0) {\r\n\t\t}\r\n\r\n\t\tset (x: number, y: number): Vector2 {\r\n\t\t\tthis.x = x;\r\n\t\t\tthis.y = y;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tlength () {\r\n\t\t\tlet x = this.x;\r\n\t\t\tlet y = this.y;\r\n\t\t\treturn Math.sqrt(x * x + y * y);\r\n\t\t}\r\n\r\n\t\tsubtract(other: Vector2): Vector2 {\r\n\t\t\treturn new Vector2(this.x - other.x, this.y - other.y);\r\n\t\t}\r\n\r\n\t\tnormalize () {\r\n\t\t\tlet len = this.length();\r\n\t\t\tif (len != 0) {\r\n\t\t\t\tthis.x /= len;\r\n\t\t\t\tthis.y /= len;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tnormalize_new() {\r\n\t\t\tlet len = this.length();\r\n\t\t\treturn new Vector2(\r\n\t\t\t\tthis.x / len,\r\n\t\t\t\tthis.y / len\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tangle(other: Vector2) {\r\n\t\t\tlet dot = this.x * other.x + this.y * other.y;\r\n\t\t\tlet len_a = Math.sqrt(this.x*this.x + this.y*this.y);\r\n\t\t\tlet len_b = Math.sqrt(other.x*other.x + other.y*other.y);\r\n\t\t\treturn Math.acos(dot / (len_a*len_b));\r\n\t\t}\r\n\t}\r\n\r\n\texport class TimeKeeper {\r\n\t\tmaxDelta = 0.064;\r\n\t\tframesPerSecond = 0;\r\n\t\tdelta = 0;\r\n\t\ttotalTime = 0;\r\n\r\n\t\tprivate lastTime = Date.now() / 1000;\r\n\t\tprivate frameCount = 0;\r\n\t\tprivate frameTime = 0;\r\n\r\n\t\tupdate () {\r\n\t\t\tlet now = Date.now() / 1000;\r\n\t\t\tthis.delta = now - this.lastTime;\r\n\t\t\tthis.frameTime += this.delta;\r\n\t\t\tthis.totalTime += this.delta;\r\n\t\t\tif (this.delta > this.maxDelta) this.delta = this.maxDelta;\r\n\t\t\tthis.lastTime = now;\r\n\r\n\t\t\tthis.frameCount++;\r\n\t\t\tif (this.frameTime > 1) {\r\n\t\t\t\tthis.framesPerSecond = this.frameCount / this.frameTime;\r\n\t\t\t\tthis.frameTime = 0;\r\n\t\t\t\tthis.frameCount = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport interface ArrayLike<T> {\r\n\t\tlength: number;\r\n\t\t[n: number]: T;\r\n\t}\r\n\r\n\texport class WindowedMean {\r\n\t\tvalues: Array<number>;\r\n\t\taddedValues = 0;\r\n\t\tlastValue = 0;\r\n\t\tmean = 0;\r\n\t\tdirty = true;\r\n\r\n\t\tconstructor (windowSize: number = 32) {\r\n\t\t\tthis.values = new Array<number>(windowSize);\r\n\t\t}\r\n\r\n\t\thasEnoughData () {\r\n\t\t\treturn this.addedValues >= this.values.length;\r\n\t\t}\r\n\r\n\t\taddValue (value: number) {\r\n\t\t\tif (this.addedValues < this.values.length)\r\n\t\t\t\tthis.addedValues++;\r\n\t\t\tthis.values[this.lastValue++] = value;\r\n\t\t\tif (this.lastValue > this.values.length - 1) this.lastValue = 0;\r\n\t\t\tthis.dirty = true;\r\n\t\t}\r\n\r\n\t\tgetMean () {\r\n\t\t\tif (this.hasEnoughData()) {\r\n\t\t\t\tif (this.dirty) {\r\n\t\t\t\t\tlet mean = 0;\r\n\t\t\t\t\tfor (let i = 0; i < this.values.length; i++) {\r\n\t\t\t\t\t\tmean += this.values[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.mean = mean / this.values.length;\r\n\t\t\t\t\tthis.dirty = false;\r\n\t\t\t\t}\r\n\t\t\t\treturn this.mean;\r\n\t\t\t} else {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Slot } from \"../Slot\";\r\nimport { Utils, ArrayLike } from \"../Utils\";\r\n\r\n// module spine {\r\n\t/** The base class for all attachments. */\r\n\texport abstract class Attachment {\r\n\t\tname: string;\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tif (name == null) throw new Error(\"name cannot be null.\");\r\n\t\t\tthis.name = name;\r\n\t\t}\r\n\r\n\t\tabstract copy (): Attachment;\r\n\t}\r\n\r\n\t/** Base class for an attachment with vertices that are transformed by one or more bones and can be deformed by a slot's\r\n\t * {@link Slot#deform}. */\r\n\texport abstract class VertexAttachment extends Attachment {\r\n\t\tprivate static nextID = 0;\r\n\r\n\t\t/** The unique ID for this attachment. */\r\n\t\tid = (VertexAttachment.nextID++ & 65535) << 11;\r\n\r\n\t\t/** The bones which affect the {@link #getVertices()}. The array entries are, for each vertex, the number of bones affecting\r\n\t\t * the vertex followed by that many bone indices, which is the index of the bone in {@link Skeleton#bones}. Will be null\r\n\t\t * if this attachment has no weights. */\r\n\t\tbones: Array<number>;\r\n\r\n\t\t/** The vertex positions in the bone's coordinate system. For a non-weighted attachment, the values are `x,y`\r\n\t\t * entries for each vertex. For a weighted attachment, the values are `x,y,weight` entries for each bone affecting\r\n\t\t * each vertex. */\r\n\t\tvertices: ArrayLike<number>;\r\n\r\n\t\t/** The maximum number of world vertex values that can be output by\r\n\t\t * {@link #computeWorldVertices()} using the `count` parameter. */\r\n\t\tworldVerticesLength = 0;\r\n\r\n\t\t/** Deform keys for the deform attachment are also applied to this attachment. May be null if no deform keys should be applied. */\r\n\t\tdeformAttachment: VertexAttachment = this;\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\t/** Transforms the attachment's local {@link vertices} to world coordinates. If the slot's {@link Slot#deform} is\r\n\t\t * not empty, it is used to deform the vertices.\r\n\t\t *\r\n\t\t * See [World transforms](http://esotericsoftware.com/spine-runtime-skeletons#World-transforms) in the Spine\r\n\t\t * Runtimes Guide.\r\n\t\t * @param start The index of the first {@link #vertices} value to transform. Each vertex has 2 values, x and y.\r\n\t\t * @param count The number of world vertex values to output. Must be <= {@link #worldVerticesLength} - `start`.\r\n\t\t * @param worldVertices The output world vertices. Must have a length >= `offset` + `count` *\r\n\t\t *           `stride` / 2.\r\n\t\t * @param offset The `worldVertices` index to begin writing values.\r\n\t\t * @param stride The number of `worldVertices` entries between the value pairs written. */\r\n\t\tcomputeWorldVertices (slot: Slot, start: number, count: number, worldVertices: ArrayLike<number>, offset: number, stride: number) {\r\n\t\t\tcount = offset + (count >> 1) * stride;\r\n\t\t\tlet skeleton = slot.bone.skeleton;\r\n\t\t\tlet deformArray = slot.deform;\r\n\t\t\tlet vertices = this.vertices;\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tif (bones == null) {\r\n\t\t\t\tif (deformArray.length > 0) vertices = deformArray;\r\n\t\t\t\tlet bone = slot.bone;\r\n\t\t\t\tlet x = bone.worldX;\r\n\t\t\t\tlet y = bone.worldY;\r\n\t\t\t\tlet a = bone.a, b = bone.b, c = bone.c, d = bone.d;\r\n\t\t\t\tfor (let v = start, w = offset; w < count; v += 2, w += stride) {\r\n\t\t\t\t\tlet vx = vertices[v], vy = vertices[v + 1];\r\n\t\t\t\t\tworldVertices[w] = vx * a + vy * b + x;\r\n\t\t\t\t\tworldVertices[w + 1] = vx * c + vy * d + y;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet v = 0, skip = 0;\r\n\t\t\tfor (let i = 0; i < start; i += 2) {\r\n\t\t\t\tlet n = bones[v];\r\n\t\t\t\tv += n + 1;\r\n\t\t\t\tskip += n;\r\n\t\t\t}\r\n\t\t\tlet skeletonBones = skeleton.bones;\r\n\t\t\tif (deformArray.length == 0) {\r\n\t\t\t\tfor (let w = offset, b = skip * 3; w < count; w += stride) {\r\n\t\t\t\t\tlet wx = 0, wy = 0;\r\n\t\t\t\t\tlet n = bones[v++];\r\n\t\t\t\t\tn += v;\r\n\t\t\t\t\tfor (; v < n; v++, b += 3) {\r\n\t\t\t\t\t\tlet bone = skeletonBones[bones[v]];\r\n\t\t\t\t\t\tlet vx = vertices[b], vy = vertices[b + 1], weight = vertices[b + 2];\r\n\t\t\t\t\t\twx += (vx * bone.a + vy * bone.b + bone.worldX) * weight;\r\n\t\t\t\t\t\twy += (vx * bone.c + vy * bone.d + bone.worldY) * weight;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tworldVertices[w] = wx;\r\n\t\t\t\t\tworldVertices[w + 1] = wy;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet deform = deformArray;\r\n\t\t\t\tfor (let w = offset, b = skip * 3, f = skip << 1; w < count; w += stride) {\r\n\t\t\t\t\tlet wx = 0, wy = 0;\r\n\t\t\t\t\tlet n = bones[v++];\r\n\t\t\t\t\tn += v;\r\n\t\t\t\t\tfor (; v < n; v++, b += 3, f += 2) {\r\n\t\t\t\t\t\tlet bone = skeletonBones[bones[v]];\r\n\t\t\t\t\t\tlet vx = vertices[b] + deform[f], vy = vertices[b + 1] + deform[f + 1], weight = vertices[b + 2];\r\n\t\t\t\t\t\twx += (vx * bone.a + vy * bone.b + bone.worldX) * weight;\r\n\t\t\t\t\t\twy += (vx * bone.c + vy * bone.d + bone.worldY) * weight;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tworldVertices[w] = wx;\r\n\t\t\t\t\tworldVertices[w + 1] = wy;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Does not copy id (generated) or name (set on construction). **/\r\n\t\tcopyTo (attachment: VertexAttachment) {\r\n\t\t\tif (this.bones != null) {\r\n\t\t\t\tattachment.bones = new Array<number>(this.bones.length);\r\n\t\t\t\tUtils.arrayCopy(this.bones, 0, attachment.bones, 0, this.bones.length);\r\n\t\t\t} else\r\n\t\t\t\tattachment.bones = null;\r\n\r\n\t\t\tif (this.vertices != null) {\r\n\t\t\t\tattachment.vertices = Utils.newFloatArray(this.vertices.length);\r\n\t\t\t\tUtils.arrayCopy(this.vertices, 0, attachment.vertices, 0, this.vertices.length);\r\n\t\t\t} else\r\n\t\t\t\tattachment.vertices = null;\r\n\r\n\t\t\tattachment.worldVerticesLength = this.worldVerticesLength;\r\n\t\t\tattachment.deformAttachment = this.deformAttachment;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Color } from \"../Utils\";\r\nimport { VertexAttachment, Attachment } from \"./Attachment\";\r\n\r\n// module spine {\r\n\r\n\t/** An attachment with vertices that make up a polygon. Can be used for hit detection, creating physics bodies, spawning particle\r\n\t * effects, and more.\r\n\t *\r\n\t * See {@link SkeletonBounds} and [Bounding Boxes](http://esotericsoftware.com/spine-bounding-boxes) in the Spine User\r\n\t * Guide. */\r\n\texport class BoundingBoxAttachment extends VertexAttachment {\r\n\t\tcolor = new Color(1, 1, 1, 1);\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\tcopy (): Attachment {\r\n\t\t\tlet copy = new BoundingBoxAttachment(this.name);\r\n\t\t\tthis.copyTo(copy);\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\t\t\treturn copy;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { SlotData } from \"../SlotData\";\r\nimport { Color } from \"../Utils\";\r\nimport { Attachment, VertexAttachment } from \"./Attachment\";\r\n\r\n// module spine {\r\n\t/** An attachment with vertices that make up a polygon used for clipping the rendering of other attachments. */\r\n\texport class ClippingAttachment extends VertexAttachment {\r\n\t\t/** Clipping is performed between the clipping polygon's slot and the end slot. Returns null if clipping is done until the end of\r\n\t\t * the skeleton's rendering. */\r\n\t\tendSlot: SlotData;\r\n\r\n\t\t// Nonessential.\r\n\t\t/** The color of the clipping polygon as it was in Spine. Available only when nonessential data was exported. Clipping polygons\r\n\t\t * are not usually rendered at runtime. */\r\n\t\tcolor = new Color(0.2275, 0.2275, 0.8078, 1); // ce3a3aff\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\tcopy (): Attachment {\r\n\t\t\tlet copy = new ClippingAttachment(this.name);\r\n\t\t\tthis.copyTo(copy);\r\n\t\t\tcopy.endSlot = this.endSlot;\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\t\t\treturn copy;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { TextureRegion } from \"../Texture\";\r\nimport { TextureAtlasRegion } from \"../TextureAtlas\";\r\nimport { Color, Utils, ArrayLike } from \"../Utils\";\r\nimport { VertexAttachment, Attachment } from \"./Attachment\";\r\n\r\n// module spine {\r\n\t/** An attachment that displays a textured mesh. A mesh has hull vertices and internal vertices within the hull. Holes are not\r\n\t * supported. Each vertex has UVs (texture coordinates) and triangles are used to map an image on to the mesh.\r\n\t *\r\n\t * See [Mesh attachments](http://esotericsoftware.com/spine-meshes) in the Spine User Guide. */\r\n\texport class MeshAttachment extends VertexAttachment {\r\n\t\tregion: TextureRegion;\r\n\r\n\t\t/** The name of the texture region for this attachment. */\r\n\t\tpath: string;\r\n\r\n\t\t/** The UV pair for each vertex, normalized within the texture region. */\r\n\t\tregionUVs: ArrayLike<number>;\r\n\r\n\t\t/** The UV pair for each vertex, normalized within the entire texture.\r\n\t\t *\r\n\t\t * See {@link #updateUVs}. */\r\n\t\tuvs: ArrayLike<number>;\r\n\r\n\t\t/** Triplets of vertex indices which describe the mesh's triangulation. */\r\n\t\ttriangles: Array<number>;\r\n\r\n\t\t/** The color to tint the mesh. */\r\n\t\tcolor = new Color(1, 1, 1, 1);\r\n\r\n\t\t/** The width of the mesh's image. Available only when nonessential data was exported. */\r\n\t\twidth: number;\r\n\r\n\t\t/** The height of the mesh's image. Available only when nonessential data was exported. */\r\n\t\theight: number;\r\n\r\n\t\t/** The number of entries at the beginning of {@link #vertices} that make up the mesh hull. */\r\n\t\thullLength: number;\r\n\r\n\t\t/** Vertex index pairs describing edges for controling triangulation. Mesh triangles will never cross edges. Only available if\r\n\t\t * nonessential data was exported. Triangulation is not performed at runtime. */\r\n\t\tedges: Array<number>;\r\n\r\n\t\tprivate parentMesh: MeshAttachment;\r\n\t\ttempColor = new Color(0, 0, 0, 0);\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\t/** Calculates {@link #uvs} using {@link #regionUVs} and the {@link #region}. Must be called after changing the region UVs or\r\n\t\t * region. */\r\n\t\tupdateUVs () {\r\n\t\t\tlet regionUVs = this.regionUVs;\r\n\t\t\tif (this.uvs == null || this.uvs.length != regionUVs.length) this.uvs = Utils.newFloatArray(regionUVs.length);\r\n\t\t\tlet uvs = this.uvs;\r\n\t\t\tlet n = this.uvs.length;\r\n\t\t\tlet u = this.region.u, v = this.region.v, width = 0, height = 0;\r\n\t\t\tif (this.region instanceof TextureAtlasRegion) {\r\n\t\t\t\tlet region = this.region;\r\n\t\t\t\tlet textureWidth = region.texture.getImage().width, textureHeight = region.texture.getImage().height;\r\n\t\t\t\tswitch(region.degrees) {\r\n\t\t\t\tcase 90:\r\n\t\t\t\t\tu -= (region.originalHeight - region.offsetY - region.height) / textureWidth;\r\n\t\t\t\t\tv -= (region.originalWidth - region.offsetX - region.width) / textureHeight;\r\n\t\t\t\t\twidth = region.originalHeight / textureWidth;\r\n\t\t\t\t\theight = region.originalWidth / textureHeight;\r\n\t\t\t\t\tfor (let i = 0; i < n; i += 2) {\r\n\t\t\t\t\t\tuvs[i] = u + regionUVs[i + 1] * width;\r\n\t\t\t\t\t\tuvs[i + 1] = v + (1 - regionUVs[i]) * height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase 180:\r\n\t\t\t\t\tu -= (region.originalWidth - region.offsetX - region.width) / textureWidth;\r\n\t\t\t\t\tv -= region.offsetY / textureHeight;\r\n\t\t\t\t\twidth = region.originalWidth / textureWidth;\r\n\t\t\t\t\theight = region.originalHeight / textureHeight;\r\n\t\t\t\t\tfor (let i = 0; i < n; i += 2) {\r\n\t\t\t\t\t\tuvs[i] = u + (1 - regionUVs[i]) * width;\r\n\t\t\t\t\t\tuvs[i + 1] = v + (1 - regionUVs[i + 1]) * height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\tcase 270:\r\n\t\t\t\t\tu -= region.offsetY / textureWidth;\r\n\t\t\t\t\tv -= region.offsetX / textureHeight;\r\n\t\t\t\t\twidth = region.originalHeight / textureWidth;\r\n\t\t\t\t\theight = region.originalWidth / textureHeight;\r\n\t\t\t\t\tfor (let i = 0; i < n; i += 2) {\r\n\t\t\t\t\t\tuvs[i] = u + (1 - regionUVs[i + 1]) * width;\r\n\t\t\t\t\t\tuvs[i + 1] = v + regionUVs[i] * height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tu -= region.offsetX / textureWidth;\r\n\t\t\t\tv -= (region.originalHeight - region.offsetY - region.height) / textureHeight;\r\n\t\t\t\twidth = region.originalWidth / textureWidth;\r\n\t\t\t\theight = region.originalHeight / textureHeight;\r\n\t\t\t} else if (this.region == null) {\r\n\t\t\t\tu = v = 0;\r\n\t\t\t\twidth = height = 1;\r\n\t\t\t} else {\r\n\t\t\t\twidth = this.region.u2 - u;\r\n\t\t\t\theight = this.region.v2 - v;\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = 0; i < n; i += 2) {\r\n\t\t\t\tuvs[i] = u + regionUVs[i] * width;\r\n\t\t\t\tuvs[i + 1] = v + regionUVs[i + 1] * height;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** The parent mesh if this is a linked mesh, else null. A linked mesh shares the {@link #bones}, {@link #vertices},\r\n\t\t * {@link #regionUVs}, {@link #triangles}, {@link #hullLength}, {@link #edges}, {@link #width}, and {@link #height} with the\r\n\t\t * parent mesh, but may have a different {@link #name} or {@link #path} (and therefore a different texture). */\r\n\t\tgetParentMesh () {\r\n\t\t\treturn this.parentMesh;\r\n\t\t}\r\n\r\n\t\t/** @param parentMesh May be null. */\r\n\t\tsetParentMesh (parentMesh: MeshAttachment) {\r\n\t\t\tthis.parentMesh = parentMesh;\r\n\t\t\tif (parentMesh != null) {\r\n\t\t\t\tthis.bones = parentMesh.bones;\r\n\t\t\t\tthis.vertices = parentMesh.vertices;\r\n\t\t\t\tthis.worldVerticesLength = parentMesh.worldVerticesLength;\r\n\t\t\t\tthis.regionUVs = parentMesh.regionUVs;\r\n\t\t\t\tthis.triangles = parentMesh.triangles;\r\n\t\t\t\tthis.hullLength = parentMesh.hullLength;\r\n\t\t\t\tthis.worldVerticesLength = parentMesh.worldVerticesLength\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcopy (): Attachment {\r\n\t\t\tif (this.parentMesh != null) return this.newLinkedMesh();\r\n\r\n\t\t\tlet copy = new MeshAttachment(this.name);\r\n\t\t\tcopy.region = this.region;\r\n\t\t\tcopy.path = this.path;\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\r\n\t\t\tthis.copyTo(copy);\r\n\t\t\tcopy.regionUVs = new Array<number>(this.regionUVs.length);\r\n\t\t\tUtils.arrayCopy(this.regionUVs, 0, copy.regionUVs, 0, this.regionUVs.length);\r\n\t\t\tcopy.uvs = new Array<number>(this.uvs.length);\r\n\t\t\tUtils.arrayCopy(this.uvs, 0, copy.uvs, 0, this.uvs.length);\r\n\t\t\tcopy.triangles = new Array<number>(this.triangles.length);\r\n\t\t\tUtils.arrayCopy(this.triangles, 0, copy.triangles, 0, this.triangles.length);\r\n\t\t\tcopy.hullLength = this.hullLength;\r\n\r\n\t\t\t// Nonessential.\r\n\t\t\tif (this.edges != null) {\r\n\t\t\t\tcopy.edges = new Array<number>(this.edges.length);\r\n\t\t\t\tUtils.arrayCopy(this.edges, 0, copy.edges, 0, this.edges.length);\r\n\t\t\t}\r\n\t\t\tcopy.width = this.width;\r\n\t\t\tcopy.height = this.height;\r\n\r\n\t\t\treturn copy;\r\n\t\t}\r\n\r\n\t\t/** Returns a new mesh with the {@link #parentMesh} set to this mesh's parent mesh, if any, else to this mesh. **/\r\n\t\tnewLinkedMesh (): MeshAttachment {\r\n\t\t\tlet copy = new MeshAttachment(this.name);\r\n\t\t\tcopy.region = this.region;\r\n\t\t\tcopy.path = this.path;\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\t\t\tcopy.deformAttachment = this.deformAttachment;\r\n\t\t\tcopy.setParentMesh(this.parentMesh != null ? this.parentMesh : this);\r\n\t\t\tcopy.updateUVs();\r\n\t\t\treturn copy;\r\n\t\t}\r\n\t}\r\n\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Color, Utils } from \"../Utils\";\r\nimport { VertexAttachment, Attachment } from \"./Attachment\";\r\n\r\n// module spine {\r\n\r\n\t/** An attachment whose vertices make up a composite Bezier curve.\r\n\t *\r\n\t * See {@link PathConstraint} and [Paths](http://esotericsoftware.com/spine-paths) in the Spine User Guide. */\r\n\texport class PathAttachment extends VertexAttachment {\r\n\r\n\t\t/** The lengths along the path in the setup pose from the start of the path to the end of each Bezier curve. */\r\n\t\tlengths: Array<number>;\r\n\r\n\t\t/** If true, the start and end knots are connected. */\r\n\t\tclosed = false;\r\n\r\n\t\t/** If true, additional calculations are performed to make calculating positions along the path more accurate. If false, fewer\r\n\t\t * calculations are performed but calculating positions along the path is less accurate. */\r\n\t\tconstantSpeed = false;\r\n\r\n\t\t/** The color of the path as it was in Spine. Available only when nonessential data was exported. Paths are not usually\r\n\t\t * rendered at runtime. */\r\n\t\tcolor = new Color(1, 1, 1, 1);\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\tcopy (): Attachment {\r\n\t\t\tlet copy = new PathAttachment(this.name);\r\n\t\t\tthis.copyTo(copy);\r\n\t\t\tcopy.lengths = new Array<number>(this.lengths.length);\r\n\t\t\tUtils.arrayCopy(this.lengths, 0, copy.lengths, 0, this.lengths.length);\r\n\t\t\tcopy.closed = closed;\r\n\t\t\tcopy.constantSpeed = this.constantSpeed;\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\t\t\treturn copy;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Bone } from \"../Bone\";\r\nimport { Color, Vector2, MathUtils } from \"../Utils\";\r\nimport { VertexAttachment, Attachment } from \"./Attachment\";\r\n\r\n// module spine {\r\n\t/** An attachment which is a single point and a rotation. This can be used to spawn projectiles, particles, etc. A bone can be\r\n\t * used in similar ways, but a PointAttachment is slightly less expensive to compute and can be hidden, shown, and placed in a\r\n\t * skin.\r\n\t *\r\n\t * See [Point Attachments](http://esotericsoftware.com/spine-point-attachments) in the Spine User Guide. */\r\n\texport class PointAttachment extends VertexAttachment {\r\n\t\tx: number; y: number; rotation: number;\r\n\r\n\t\t/** The color of the point attachment as it was in Spine. Available only when nonessential data was exported. Point attachments\r\n\t\t * are not usually rendered at runtime. */\r\n\t\tcolor = new Color(0.38, 0.94, 0, 1);\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\tcomputeWorldPosition (bone: Bone, point: Vector2) {\r\n\t\t\tpoint.x = this.x * bone.a + this.y * bone.b + bone.worldX;\r\n\t\t\tpoint.y = this.x * bone.c + this.y * bone.d + bone.worldY;\r\n\t\t\treturn point;\r\n\t\t}\r\n\r\n\t\tcomputeWorldRotation (bone: Bone) {\r\n\t\t\tlet cos = MathUtils.cosDeg(this.rotation), sin = MathUtils.sinDeg(this.rotation);\r\n\t\t\tlet x = cos * bone.a + sin * bone.b;\r\n\t\t\tlet y = cos * bone.c + sin * bone.d;\r\n\t\t\treturn Math.atan2(y, x) * MathUtils.radDeg;\r\n\t\t}\r\n\r\n\t\tcopy (): Attachment {\r\n\t\t\tlet copy = new PointAttachment(this.name);\r\n\t\t\tcopy.x = this.x;\r\n\t\t\tcopy.y = this.y;\r\n\t\t\tcopy.rotation = this.rotation;\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\t\t\treturn copy;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Bone } from \"../Bone\";\r\nimport { TextureRegion } from \"../Texture\";\r\nimport { Color, Utils, ArrayLike } from \"../Utils\";\r\nimport { Attachment } from \"./Attachment\";\r\n\r\n// module spine {\r\n\r\n\t/** An attachment that displays a textured quadrilateral.\r\n\t *\r\n\t * See [Region attachments](http://esotericsoftware.com/spine-regions) in the Spine User Guide. */\r\n\texport class RegionAttachment extends Attachment {\r\n\t\tstatic OX1 = 0;\r\n\t\tstatic OY1 = 1;\r\n\t\tstatic OX2 = 2;\r\n\t\tstatic OY2 = 3;\r\n\t\tstatic OX3 = 4;\r\n\t\tstatic OY3 = 5;\r\n\t\tstatic OX4 = 6;\r\n\t\tstatic OY4 = 7;\r\n\r\n\t\tstatic X1 = 0;\r\n\t\tstatic Y1 = 1;\r\n\t\tstatic C1R = 2;\r\n\t\tstatic C1G = 3;\r\n\t\tstatic C1B = 4;\r\n\t\tstatic C1A = 5;\r\n\t\tstatic U1 = 6;\r\n\t\tstatic V1 = 7;\r\n\r\n\t\tstatic X2 = 8;\r\n\t\tstatic Y2 = 9;\r\n\t\tstatic C2R = 10;\r\n\t\tstatic C2G = 11;\r\n\t\tstatic C2B = 12;\r\n\t\tstatic C2A = 13;\r\n\t\tstatic U2 = 14;\r\n\t\tstatic V2 = 15;\r\n\r\n\t\tstatic X3 = 16;\r\n\t\tstatic Y3 = 17;\r\n\t\tstatic C3R = 18;\r\n\t\tstatic C3G = 19;\r\n\t\tstatic C3B = 20;\r\n\t\tstatic C3A = 21;\r\n\t\tstatic U3 = 22;\r\n\t\tstatic V3 = 23;\r\n\r\n\t\tstatic X4 = 24;\r\n\t\tstatic Y4 = 25;\r\n\t\tstatic C4R = 26;\r\n\t\tstatic C4G = 27;\r\n\t\tstatic C4B = 28;\r\n\t\tstatic C4A = 29;\r\n\t\tstatic U4 = 30;\r\n\t\tstatic V4 = 31;\r\n\r\n\t\t/** The local x translation. */\r\n\t\tx = 0;\r\n\r\n\t\t/** The local y translation. */\r\n\t\ty = 0;\r\n\r\n\t\t/** The local scaleX. */\r\n\t\tscaleX = 1;\r\n\r\n\t\t/** The local scaleY. */\r\n\t\tscaleY = 1;\r\n\r\n\t\t/** The local rotation. */\r\n\t\trotation = 0;\r\n\r\n\t\t/** The width of the region attachment in Spine. */\r\n\t\twidth = 0;\r\n\r\n\t\t/** The height of the region attachment in Spine. */\r\n\t\theight = 0;\r\n\r\n\t\t/** The color to tint the region attachment. */\r\n\t\tcolor = new Color(1, 1, 1, 1);\r\n\r\n\t\t/** The name of the texture region for this attachment. */\r\n\t\tpath: string;\r\n\r\n\t\trendererObject: any;\r\n\t\tregion: TextureRegion;\r\n\r\n\t\t/** For each of the 4 vertices, a pair of <code>x,y</code> values that is the local position of the vertex.\r\n\t\t *\r\n\t\t * See {@link #updateOffset()}. */\r\n\t\toffset = Utils.newFloatArray(8);\r\n\r\n\r\n\t\tuvs = Utils.newFloatArray(8);\r\n\r\n\t\ttempColor = new Color(1, 1, 1, 1);\r\n\r\n\t\tconstructor (name:string) {\r\n\t\t\tsuper(name);\r\n\t\t}\r\n\r\n\t\t/** Calculates the {@link #offset} using the region settings. Must be called after changing region settings. */\r\n\t\tupdateOffset () : void {\r\n\t\t\tlet regionScaleX = this.width / this.region.originalWidth * this.scaleX;\r\n\t\t\tlet regionScaleY = this.height / this.region.originalHeight * this.scaleY;\r\n\t\t\tlet localX = -this.width / 2 * this.scaleX + this.region.offsetX * regionScaleX;\r\n\t\t\tlet localY = -this.height / 2 * this.scaleY + this.region.offsetY * regionScaleY;\r\n\t\t\tlet localX2 = localX + this.region.width * regionScaleX;\r\n\t\t\tlet localY2 = localY + this.region.height * regionScaleY;\r\n\t\t\tlet radians = this.rotation * Math.PI / 180;\r\n\t\t\tlet cos = Math.cos(radians);\r\n\t\t\tlet sin = Math.sin(radians);\r\n\t\t\tlet localXCos = localX * cos + this.x;\r\n\t\t\tlet localXSin = localX * sin;\r\n\t\t\tlet localYCos = localY * cos + this.y;\r\n\t\t\tlet localYSin = localY * sin;\r\n\t\t\tlet localX2Cos = localX2 * cos + this.x;\r\n\t\t\tlet localX2Sin = localX2 * sin;\r\n\t\t\tlet localY2Cos = localY2 * cos + this.y;\r\n\t\t\tlet localY2Sin = localY2 * sin;\r\n\t\t\tlet offset = this.offset;\r\n\t\t\toffset[RegionAttachment.OX1] = localXCos - localYSin;\r\n\t\t\toffset[RegionAttachment.OY1] = localYCos + localXSin;\r\n\t\t\toffset[RegionAttachment.OX2] = localXCos - localY2Sin;\r\n\t\t\toffset[RegionAttachment.OY2] = localY2Cos + localXSin;\r\n\t\t\toffset[RegionAttachment.OX3] = localX2Cos - localY2Sin;\r\n\t\t\toffset[RegionAttachment.OY3] = localY2Cos + localX2Sin;\r\n\t\t\toffset[RegionAttachment.OX4] = localX2Cos - localYSin;\r\n\t\t\toffset[RegionAttachment.OY4] = localYCos + localX2Sin;\r\n\t\t}\r\n\r\n\t\tsetRegion (region: TextureRegion) : void {\r\n\t\t\tthis.region = region;\r\n\t\t\tlet uvs = this.uvs;\r\n\t\t\tif (region.rotate) {\r\n\t\t\t\tuvs[2] = region.u;\r\n\t\t\t\tuvs[3] = region.v2;\r\n\t\t\t\tuvs[4] = region.u;\r\n\t\t\t\tuvs[5] = region.v;\r\n\t\t\t\tuvs[6] = region.u2;\r\n\t\t\t\tuvs[7] = region.v;\r\n\t\t\t\tuvs[0] = region.u2;\r\n\t\t\t\tuvs[1] = region.v2;\r\n\t\t\t} else {\r\n\t\t\t\tuvs[0] = region.u;\r\n\t\t\t\tuvs[1] = region.v2;\r\n\t\t\t\tuvs[2] = region.u;\r\n\t\t\t\tuvs[3] = region.v;\r\n\t\t\t\tuvs[4] = region.u2;\r\n\t\t\t\tuvs[5] = region.v;\r\n\t\t\t\tuvs[6] = region.u2;\r\n\t\t\t\tuvs[7] = region.v2;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Transforms the attachment's four vertices to world coordinates.\r\n\t\t *\r\n\t\t * See [World transforms](http://esotericsoftware.com/spine-runtime-skeletons#World-transforms) in the Spine\r\n\t\t * Runtimes Guide.\r\n\t\t * @param worldVertices The output world vertices. Must have a length >= `offset` + 8.\r\n\t\t * @param offset The `worldVertices` index to begin writing values.\r\n\t\t * @param stride The number of `worldVertices` entries between the value pairs written. */\r\n\t\tcomputeWorldVertices (bone: Bone, worldVertices: ArrayLike<number>, offset: number, stride: number) {\r\n\t\t\tlet vertexOffset = this.offset;\r\n\t\t\tlet x = bone.worldX, y = bone.worldY;\r\n\t\t\tlet a = bone.a, b = bone.b, c = bone.c, d = bone.d;\r\n\t\t\tlet offsetX = 0, offsetY = 0;\r\n\r\n\t\t\toffsetX = vertexOffset[RegionAttachment.OX1];\r\n\t\t\toffsetY = vertexOffset[RegionAttachment.OY1];\r\n\t\t\tworldVertices[offset] = offsetX * a + offsetY * b + x; // br\r\n\t\t\tworldVertices[offset + 1] = offsetX * c + offsetY * d + y;\r\n\t\t\toffset += stride;\r\n\r\n\t\t\toffsetX = vertexOffset[RegionAttachment.OX2];\r\n\t\t\toffsetY = vertexOffset[RegionAttachment.OY2];\r\n\t\t\tworldVertices[offset] = offsetX * a + offsetY * b + x; // bl\r\n\t\t\tworldVertices[offset + 1] = offsetX * c + offsetY * d + y;\r\n\t\t\toffset += stride;\r\n\r\n\t\t\toffsetX = vertexOffset[RegionAttachment.OX3];\r\n\t\t\toffsetY = vertexOffset[RegionAttachment.OY3];\r\n\t\t\tworldVertices[offset] = offsetX * a + offsetY * b + x; // ul\r\n\t\t\tworldVertices[offset + 1] = offsetX * c + offsetY * d + y;\r\n\t\t\toffset += stride;\r\n\r\n\t\t\toffsetX = vertexOffset[RegionAttachment.OX4];\r\n\t\t\toffsetY = vertexOffset[RegionAttachment.OY4];\r\n\t\t\tworldVertices[offset] = offsetX * a + offsetY * b + x; // ur\r\n\t\t\tworldVertices[offset + 1] = offsetX * c + offsetY * d + y;\r\n\t\t}\r\n\r\n\t\tcopy (): Attachment {\r\n\t\t\tlet copy = new RegionAttachment(this.name);\r\n\t\t\tcopy.region = this.region;\r\n\t\t\tcopy.rendererObject = this.rendererObject;\r\n\t\t\tcopy.path = this.path;\r\n\t\t\tcopy.x = this.x;\r\n\t\t\tcopy.y = this.y;\r\n\t\t\tcopy.scaleX = this.scaleX;\r\n\t\t\tcopy.scaleY = this.scaleY;\r\n\t\t\tcopy.rotation = this.rotation;\r\n\t\t\tcopy.width = this.width;\r\n\t\t\tcopy.height = this.height;\r\n\t\t\tUtils.arrayCopy(this.uvs, 0, copy.uvs, 0, 8);\r\n\t\t\tUtils.arrayCopy(this.offset, 0, copy.offset, 0, 8);\r\n\t\t\tcopy.color.setFromColor(this.color);\r\n\t\t\treturn copy;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { AttachmentLoader } from \"./attachments/AttachmentLoader\";\r\nimport { BoundingBoxAttachment } from \"./attachments/BoundingBoxAttachment\";\r\nimport { ClippingAttachment } from \"./attachments/ClippingAttachment\";\r\nimport { MeshAttachment } from \"./attachments/MeshAttachment\";\r\nimport { PathAttachment } from \"./attachments/PathAttachment\";\r\nimport { PointAttachment } from \"./attachments/PointAttachment\";\r\nimport { RegionAttachment } from \"./attachments/RegionAttachment\";\r\nimport { Skin } from \"./Skin\";\r\nimport { TextureAtlas } from \"./TextureAtlas\";\r\n\r\n// module spine {\r\n\t/** An {@link AttachmentLoader} that configures attachments using texture regions from an {@link TextureAtlas}.\r\n\t *\r\n\t * See [Loading skeleton data](http://esotericsoftware.com/spine-loading-skeleton-data#JSON-and-binary-data) in the\r\n\t * Spine Runtimes Guide. */\r\n\texport class AtlasAttachmentLoader implements AttachmentLoader {\r\n\t\tatlas: TextureAtlas;\r\n\r\n\t\tconstructor (atlas: TextureAtlas) {\r\n\t\t\tthis.atlas = atlas;\r\n\t\t}\r\n\r\n\t\tnewRegionAttachment (skin: Skin, name: string, path: string): RegionAttachment {\r\n\t\t\tlet region = this.atlas.findRegion(path);\r\n\t\t\tif (region == null) throw new Error(\"Region not found in atlas: \" + path + \" (region attachment: \" + name + \")\");\r\n\t\t\tregion.renderObject = region;\r\n\t\t\tlet attachment = new RegionAttachment(name);\r\n\t\t\tattachment.setRegion(region);\r\n\t\t\treturn attachment;\r\n\t\t}\r\n\r\n\t\tnewMeshAttachment (skin: Skin, name: string, path: string) : MeshAttachment {\r\n\t\t\tlet region = this.atlas.findRegion(path);\r\n\t\t\tif (region == null) throw new Error(\"Region not found in atlas: \" + path + \" (mesh attachment: \" + name + \")\");\r\n\t\t\tregion.renderObject = region;\r\n\t\t\tlet attachment = new MeshAttachment(name);\r\n\t\t\tattachment.region = region;\r\n\t\t\treturn attachment;\r\n\t\t}\r\n\r\n\t\tnewBoundingBoxAttachment (skin: Skin, name: string) : BoundingBoxAttachment {\r\n\t\t\treturn new BoundingBoxAttachment(name);\r\n\t\t}\r\n\r\n\t\tnewPathAttachment (skin: Skin, name: string): PathAttachment {\r\n\t\t\treturn new PathAttachment(name);\r\n\t\t}\r\n\r\n\t\tnewPointAttachment(skin: Skin, name: string): PointAttachment {\r\n\t\t\treturn new PointAttachment(name);\r\n\t\t}\r\n\r\n\t\tnewClippingAttachment(skin: Skin, name: string): ClippingAttachment {\r\n\t\t\treturn new ClippingAttachment(name);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BoneData, TransformMode } from \"./BoneData\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Updatable } from \"./Updatable\";\r\nimport { MathUtils, Vector2 } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores a bone's current pose.\r\n\t *\r\n\t * A bone has a local transform which is used to compute its world transform. A bone also has an applied transform, which is a\r\n\t * local transform that can be applied to compute the world transform. The local transform and applied transform may differ if a\r\n\t * constraint or application code modifies the world transform after it was computed from the local transform. */\r\n\texport class Bone implements Updatable {\r\n\t\t/** The bone's setup pose data. */\r\n\t\tdata: BoneData;\r\n\r\n\t\t/** The skeleton this bone belongs to. */\r\n\t\tskeleton: Skeleton;\r\n\r\n\t\t/** The parent bone, or null if this is the root bone. */\r\n\t\tparent: Bone;\r\n\r\n\t\t/** The immediate children of this bone. */\r\n\t\tchildren = new Array<Bone>();\r\n\r\n\t\t/** The local x translation. */\r\n\t\tx = 0;\r\n\r\n\t\t/** The local y translation. */\r\n\t\ty = 0;\r\n\r\n\t\t/** The local rotation in degrees, counter clockwise. */\r\n\t\trotation = 0;\r\n\r\n\t\t/** The local scaleX. */\r\n\t\tscaleX = 0;\r\n\r\n\t\t/** The local scaleY. */\r\n\t\tscaleY = 0;\r\n\r\n\t\t/** The local shearX. */\r\n\t\tshearX = 0;\r\n\r\n\t\t/** The local shearY. */\r\n\t\tshearY = 0;\r\n\r\n\t\t/** The applied local x translation. */\r\n\t\tax = 0;\r\n\r\n\t\t/** The applied local y translation. */\r\n\t\tay = 0;\r\n\r\n\t\t/** The applied local rotation in degrees, counter clockwise. */\r\n\t\tarotation = 0;\r\n\r\n\t\t/** The applied local scaleX. */\r\n\t\tascaleX = 0;\r\n\r\n\t\t/** The applied local scaleY. */\r\n\t\tascaleY = 0;\r\n\r\n\t\t/** The applied local shearX. */\r\n\t\tashearX = 0;\r\n\r\n\t\t/** The applied local shearY. */\r\n\t\tashearY = 0;\r\n\r\n\t\t/** If true, the applied transform matches the world transform. If false, the world transform has been modified since it was\r\n\t \t* computed and {@link #updateAppliedTransform()} must be called before accessing the applied transform. */\r\n\t\tappliedValid = false;\r\n\r\n\t\t/** Part of the world transform matrix for the X axis. If changed, {@link #appliedValid} should be set to false. */\r\n\t\ta = 0;\r\n\r\n\t\t/** Part of the world transform matrix for the Y axis. If changed, {@link #appliedValid} should be set to false. */\r\n\t\tb = 0;\r\n\r\n\t\t/** Part of the world transform matrix for the X axis. If changed, {@link #appliedValid} should be set to false. */\r\n\t\tc = 0;\r\n\r\n\t\t/** Part of the world transform matrix for the Y axis. If changed, {@link #appliedValid} should be set to false. */\r\n\t\td = 0;\r\n\r\n\t\t/** The world X position. If changed, {@link #appliedValid} should be set to false. */\r\n\t\tworldY = 0;\r\n\r\n\t\t/** The world Y position. If changed, {@link #appliedValid} should be set to false. */\r\n\t\tworldX = 0;\r\n\r\n\t\tsorted = false;\r\n\t\tactive = false;\r\n\r\n\t\t/** @param parent May be null. */\r\n\t\tconstructor (data: BoneData, skeleton: Skeleton, parent: Bone) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\t\t\tthis.data = data;\r\n\t\t\tthis.skeleton = skeleton;\r\n\t\t\tthis.parent = parent;\r\n\t\t\tthis.setToSetupPose();\r\n\t\t}\r\n\r\n\t\t/** Returns false when the bone has not been computed because {@link BoneData#skinRequired} is true and the\r\n\t \t* {@link Skeleton#skin active skin} does not {@link Skin#bones contain} this bone. */\r\n\t\tisActive () {\r\n\t\t\treturn this.active;\r\n\t\t}\r\n\r\n\t\t/** Same as {@link #updateWorldTransform()}. This method exists for Bone to implement {@link Updatable}. */\r\n\t\tupdate () {\r\n\t\t\tthis.updateWorldTransformWith(this.x, this.y, this.rotation, this.scaleX, this.scaleY, this.shearX, this.shearY);\r\n\t\t}\r\n\r\n\t\t/** Computes the world transform using the parent bone and this bone's local transform.\r\n\t\t *\r\n\t\t * See {@link #updateWorldTransformWith()}. */\r\n\t\tupdateWorldTransform () {\r\n\t\t\tthis.updateWorldTransformWith(this.x, this.y, this.rotation, this.scaleX, this.scaleY, this.shearX, this.shearY);\r\n\t\t}\r\n\r\n\t\t/** Computes the world transform using the parent bone and the specified local transform. Child bones are not updated.\r\n\t\t *\r\n\t\t * See [World transforms](http://esotericsoftware.com/spine-runtime-skeletons#World-transforms) in the Spine\r\n\t\t * Runtimes Guide. */\r\n\t\tupdateWorldTransformWith (x: number, y: number, rotation: number, scaleX: number, scaleY: number, shearX: number, shearY: number) {\r\n\t\t\tthis.ax = x;\r\n\t\t\tthis.ay = y;\r\n\t\t\tthis.arotation = rotation;\r\n\t\t\tthis.ascaleX = scaleX;\r\n\t\t\tthis.ascaleY = scaleY;\r\n\t\t\tthis.ashearX = shearX;\r\n\t\t\tthis.ashearY = shearY;\r\n\t\t\tthis.appliedValid = true;\r\n\r\n\t\t\tlet parent = this.parent;\r\n\t\t\tif (parent == null) { // Root bone.\r\n\t\t\t\tlet skeleton = this.skeleton;\r\n\t\t\t\tlet rotationY = rotation + 90 + shearY;\r\n\t\t\t\tlet sx = skeleton.scaleX;\r\n\t\t\t\tlet sy = skeleton.scaleY;\r\n\t\t\t\tthis.a = MathUtils.cosDeg(rotation + shearX) * scaleX * sx;\r\n\t\t\t\tthis.b = MathUtils.cosDeg(rotationY) * scaleY * sx;\r\n\t\t\t\tthis.c = MathUtils.sinDeg(rotation + shearX) * scaleX * sy;\r\n\t\t\t\tthis.d = MathUtils.sinDeg(rotationY) * scaleY * sy;\r\n\t\t\t\tthis.worldX = x * sx + skeleton.x;\r\n\t\t\t\tthis.worldY = y * sy + skeleton.y;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet pa = parent.a, pb = parent.b, pc = parent.c, pd = parent.d;\r\n\t\t\tthis.worldX = pa * x + pb * y + parent.worldX;\r\n\t\t\tthis.worldY = pc * x + pd * y + parent.worldY;\r\n\r\n\t\t\tswitch (this.data.transformMode) {\r\n\t\t\tcase TransformMode.Normal: {\r\n\t\t\t\tlet rotationY = rotation + 90 + shearY;\r\n\t\t\t\tlet la = MathUtils.cosDeg(rotation + shearX) * scaleX;\r\n\t\t\t\tlet lb = MathUtils.cosDeg(rotationY) * scaleY;\r\n\t\t\t\tlet lc = MathUtils.sinDeg(rotation + shearX) * scaleX;\r\n\t\t\t\tlet ld = MathUtils.sinDeg(rotationY) * scaleY;\r\n\t\t\t\tthis.a = pa * la + pb * lc;\r\n\t\t\t\tthis.b = pa * lb + pb * ld;\r\n\t\t\t\tthis.c = pc * la + pd * lc;\r\n\t\t\t\tthis.d = pc * lb + pd * ld;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcase TransformMode.OnlyTranslation: {\r\n\t\t\t\tlet rotationY = rotation + 90 + shearY;\r\n\t\t\t\tthis.a = MathUtils.cosDeg(rotation + shearX) * scaleX;\r\n\t\t\t\tthis.b = MathUtils.cosDeg(rotationY) * scaleY;\r\n\t\t\t\tthis.c = MathUtils.sinDeg(rotation + shearX) * scaleX;\r\n\t\t\t\tthis.d = MathUtils.sinDeg(rotationY) * scaleY;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase TransformMode.NoRotationOrReflection: {\r\n\t\t\t\tlet s = pa * pa + pc * pc;\r\n\t\t\t\tlet prx = 0;\r\n\t\t\t\tif (s > 0.0001) {\r\n\t\t\t\t\ts = Math.abs(pa * pd - pb * pc) / s;\r\n\t\t\t\t\tpb = pc * s;\r\n\t\t\t\t\tpd = pa * s;\r\n\t\t\t\t\tprx = Math.atan2(pc, pa) * MathUtils.radDeg;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpa = 0;\r\n\t\t\t\t\tpc = 0;\r\n\t\t\t\t\tprx = 90 - Math.atan2(pd, pb) * MathUtils.radDeg;\r\n\t\t\t\t}\r\n\t\t\t\tlet rx = rotation + shearX - prx;\r\n\t\t\t\tlet ry = rotation + shearY - prx + 90;\r\n\t\t\t\tlet la = MathUtils.cosDeg(rx) * scaleX;\r\n\t\t\t\tlet lb = MathUtils.cosDeg(ry) * scaleY;\r\n\t\t\t\tlet lc = MathUtils.sinDeg(rx) * scaleX;\r\n\t\t\t\tlet ld = MathUtils.sinDeg(ry) * scaleY;\r\n\t\t\t\tthis.a = pa * la - pb * lc;\r\n\t\t\t\tthis.b = pa * lb - pb * ld;\r\n\t\t\t\tthis.c = pc * la + pd * lc;\r\n\t\t\t\tthis.d = pc * lb + pd * ld;\r\n\r\n\t\t\t\t// HACK!!!\r\n\t\t\t\t// The transform mode specicially says no reflections\r\n\t\t\t\t// But this is the only way for it to look good?\r\n\t\t\t\tthis.a *= Math.sign(this.skeleton.scaleX);\r\n\t\t\t\tthis.b *= Math.sign(this.skeleton.scaleX);\r\n\t\t\t\tthis.c *= Math.sign(this.skeleton.scaleY);\r\n\t\t\t\tthis.d *= Math.sign(this.skeleton.scaleY);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcase TransformMode.NoScale:\r\n\t\t\tcase TransformMode.NoScaleOrReflection: {\r\n\t\t\t\tlet cos = MathUtils.cosDeg(rotation);\r\n\t\t\t\tlet sin = MathUtils.sinDeg(rotation);\r\n\t\t\t\tlet za = (pa * cos + pb * sin) / this.skeleton.scaleX;\r\n\t\t\t\tlet zc = (pc * cos + pd * sin) / this.skeleton.scaleY;\r\n\t\t\t\tlet s = Math.sqrt(za * za + zc * zc);\r\n\t\t\t\tif (s > 0.00001) s = 1 / s;\r\n\t\t\t\tza *= s;\r\n\t\t\t\tzc *= s;\r\n\t\t\t\ts = Math.sqrt(za * za + zc * zc);\r\n\t\t\t\tif (this.data.transformMode == TransformMode.NoScale\r\n\t\t\t\t\t&& (pa * pd - pb * pc < 0) != (this.skeleton.scaleX < 0 != this.skeleton.scaleY < 0)) s = -s;\r\n\t\t\t\tlet r = Math.PI / 2 + Math.atan2(zc, za);\r\n\t\t\t\tlet zb = Math.cos(r) * s;\r\n\t\t\t\tlet zd = Math.sin(r) * s;\r\n\t\t\t\tlet la = MathUtils.cosDeg(shearX) * scaleX;\r\n\t\t\t\tlet lb = MathUtils.cosDeg(90 + shearY) * scaleY;\r\n\t\t\t\tlet lc = MathUtils.sinDeg(shearX) * scaleX;\r\n\t\t\t\tlet ld = MathUtils.sinDeg(90 + shearY) * scaleY;\r\n\t\t\t\tthis.a = za * la + zb * lc;\r\n\t\t\t\tthis.b = za * lb + zb * ld;\r\n\t\t\t\tthis.c = zc * la + zd * lc;\r\n\t\t\t\tthis.d = zc * lb + zd * ld;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.a *= this.skeleton.scaleX;\r\n\t\t\tthis.b *= this.skeleton.scaleX;\r\n\t\t\tthis.c *= this.skeleton.scaleY;\r\n\t\t\tthis.d *= this.skeleton.scaleY;\r\n\t\t}\r\n\r\n\t\t/** Sets this bone's local transform to the setup pose. */\r\n\t\tsetToSetupPose () {\r\n\t\t\tlet data = this.data;\r\n\t\t\tthis.x = data.x;\r\n\t\t\tthis.y = data.y;\r\n\t\t\tthis.rotation = data.rotation;\r\n\t\t\tthis.scaleX = data.scaleX;\r\n\t\t\tthis.scaleY = data.scaleY;\r\n\t\t\tthis.shearX = data.shearX;\r\n\t\t\tthis.shearY = data.shearY;\r\n\t\t}\r\n\r\n\t\t/** The world rotation for the X axis, calculated using {@link #a} and {@link #c}. */\r\n\t\tgetWorldRotationX () {\r\n\t\t\treturn Math.atan2(this.c, this.a) * MathUtils.radDeg;\r\n\t\t}\r\n\r\n\t\t/** The world rotation for the Y axis, calculated using {@link #b} and {@link #d}. */\r\n\t\tgetWorldRotationY () {\r\n\t\t\treturn Math.atan2(this.d, this.b) * MathUtils.radDeg;\r\n\t\t}\r\n\r\n\t\t/** The magnitude (always positive) of the world scale X, calculated using {@link #a} and {@link #c}. */\r\n\t\tgetWorldScaleX () {\r\n\t\t\treturn Math.sqrt(this.a * this.a + this.c * this.c);\r\n\t\t}\r\n\r\n\t\t/** The magnitude (always positive) of the world scale Y, calculated using {@link #b} and {@link #d}. */\r\n\t\tgetWorldScaleY () {\r\n\t\t\treturn Math.sqrt(this.b * this.b + this.d * this.d);\r\n\t\t}\r\n\r\n\t\t/** Computes the applied transform values from the world transform. This allows the applied transform to be accessed after the\r\n\t\t * world transform has been modified (by a constraint, {@link #rotateWorld()}, etc).\r\n\t\t *\r\n\t\t * If {@link #updateWorldTransform()} has been called for a bone and {@link #appliedValid} is false, then\r\n\t\t * {@link #updateAppliedTransform()} must be called before accessing the applied transform.\r\n\t\t *\r\n\t\t * Some information is ambiguous in the world transform, such as -1,-1 scale versus 180 rotation. The applied transform after\r\n\t\t * calling this method is equivalent to the local tranform used to compute the world transform, but may not be identical. */\r\n\t\tupdateAppliedTransform () {\r\n\t\t\tthis.appliedValid = true;\r\n\t\t\tlet parent = this.parent;\r\n\t\t\tif (parent == null) {\r\n\t\t\t\tthis.ax = this.worldX;\r\n\t\t\t\tthis.ay = this.worldY;\r\n\t\t\t\tthis.arotation = Math.atan2(this.c, this.a) * MathUtils.radDeg;\r\n\t\t\t\tthis.ascaleX = Math.sqrt(this.a * this.a + this.c * this.c);\r\n\t\t\t\tthis.ascaleY = Math.sqrt(this.b * this.b + this.d * this.d);\r\n\t\t\t\tthis.ashearX = 0;\r\n\t\t\t\tthis.ashearY = Math.atan2(this.a * this.b + this.c * this.d, this.a * this.d - this.b * this.c) * MathUtils.radDeg;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet pa = parent.a, pb = parent.b, pc = parent.c, pd = parent.d;\r\n\t\t\tlet pid = 1 / (pa * pd - pb * pc);\r\n\t\t\tlet dx = this.worldX - parent.worldX, dy = this.worldY - parent.worldY;\r\n\t\t\tthis.ax = (dx * pd * pid - dy * pb * pid);\r\n\t\t\tthis.ay = (dy * pa * pid - dx * pc * pid);\r\n\t\t\tlet ia = pid * pd;\r\n\t\t\tlet id = pid * pa;\r\n\t\t\tlet ib = pid * pb;\r\n\t\t\tlet ic = pid * pc;\r\n\t\t\tlet ra = ia * this.a - ib * this.c;\r\n\t\t\tlet rb = ia * this.b - ib * this.d;\r\n\t\t\tlet rc = id * this.c - ic * this.a;\r\n\t\t\tlet rd = id * this.d - ic * this.b;\r\n\t\t\tthis.ashearX = 0;\r\n\t\t\tthis.ascaleX = Math.sqrt(ra * ra + rc * rc);\r\n\t\t\tif (this.ascaleX > 0.0001) {\r\n\t\t\t\tlet det = ra * rd - rb * rc;\r\n\t\t\t\tthis.ascaleY = det / this.ascaleX;\r\n\t\t\t\tthis.ashearY = Math.atan2(ra * rb + rc * rd, det) * MathUtils.radDeg;\r\n\t\t\t\tthis.arotation = Math.atan2(rc, ra) * MathUtils.radDeg;\r\n\t\t\t} else {\r\n\t\t\t\tthis.ascaleX = 0;\r\n\t\t\t\tthis.ascaleY = Math.sqrt(rb * rb + rd * rd);\r\n\t\t\t\tthis.ashearY = 0;\r\n\t\t\t\tthis.arotation = 90 - Math.atan2(rd, rb) * MathUtils.radDeg;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Transforms a point from world coordinates to the bone's local coordinates. */\r\n\t\tworldToLocal (world: Vector2) {\r\n\t\t\tlet a = this.a, b = this.b, c = this.c, d = this.d;\r\n\t\t\tlet invDet = 1 / (a * d - b * c);\r\n\t\t\tlet x = world.x - this.worldX, y = world.y - this.worldY;\r\n\t\t\tworld.x = (x * d * invDet - y * b * invDet);\r\n\t\t\tworld.y = (y * a * invDet - x * c * invDet);\r\n\t\t\treturn world;\r\n\t\t}\r\n\r\n\t\t/** Transforms a point from the bone's local coordinates to world coordinates. */\r\n\t\tlocalToWorld (local: Vector2) {\r\n\t\t\tlet x = local.x, y = local.y;\r\n\t\t\tlocal.x = x * this.a + y * this.b + this.worldX;\r\n\t\t\tlocal.y = x * this.c + y * this.d + this.worldY;\r\n\t\t\treturn local;\r\n\t\t}\r\n\r\n\t\t/** Transforms a world rotation to a local rotation. */\r\n\t\tworldToLocalRotation (worldRotation: number) {\r\n\t\t\tlet sin = MathUtils.sinDeg(worldRotation), cos = MathUtils.cosDeg(worldRotation);\r\n\t\t\treturn Math.atan2(this.a * sin - this.c * cos, this.d * cos - this.b * sin) * MathUtils.radDeg + this.rotation - this.shearX;\r\n\t\t}\r\n\r\n\t\t/** Transforms a local rotation to a world rotation. */\r\n\t\tlocalToWorldRotation (localRotation: number) {\r\n\t\t\tlocalRotation -= this.rotation - this.shearX;\r\n\t\t\tlet sin = MathUtils.sinDeg(localRotation), cos = MathUtils.cosDeg(localRotation);\r\n\t\t\treturn Math.atan2(cos * this.c + sin * this.d, cos * this.a + sin * this.b) * MathUtils.radDeg;\r\n\t\t}\r\n\r\n\t\t/** Rotates the world transform the specified amount and sets {@link #appliedValid} to false.\r\n\t\t * {@link #updateWorldTransform()} will need to be called on any child bones, recursively, and any constraints reapplied. */\r\n\t\trotateWorld (degrees: number) {\r\n\t\t\tlet a = this.a, b = this.b, c = this.c, d = this.d;\r\n\t\t\tlet cos = MathUtils.cosDeg(degrees), sin = MathUtils.sinDeg(degrees);\r\n\t\t\tthis.a = cos * a - sin * c;\r\n\t\t\tthis.b = cos * b - sin * d;\r\n\t\t\tthis.c = sin * a + cos * c;\r\n\t\t\tthis.d = sin * b + cos * d;\r\n\t\t\tthis.appliedValid = false;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Bone } from \"./Bone\";\r\nimport { TransformMode } from \"./BoneData\";\r\nimport { IkConstraintData } from \"./IkConstraintData\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Updatable } from \"./Updatable\";\r\nimport { MathUtils } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the current pose for an IK constraint. An IK constraint adjusts the rotation of 1 or 2 constrained bones so the tip of\r\n\t * the last bone is as close to the target bone as possible.\r\n\t *\r\n\t * See [IK constraints](http://esotericsoftware.com/spine-ik-constraints) in the Spine User Guide. */\r\n\texport class IkConstraint implements Updatable {\r\n\t\t/** The IK constraint's setup pose data. */\r\n\t\tdata: IkConstraintData;\r\n\r\n\t\t/** The bones that will be modified by this IK constraint. */\r\n\t\tbones: Array<Bone>;\r\n\r\n\t\t/** The bone that is the IK target. */\r\n\t\ttarget: Bone;\r\n\r\n\t\t/** Controls the bend direction of the IK bones, either 1 or -1. */\r\n\t\tbendDirection = 0;\r\n\r\n\t\t/** When true and only a single bone is being constrained, if the target is too close, the bone is scaled to reach it. */\r\n\t\tcompress = false;\r\n\r\n\t\t/** When true, if the target is out of range, the parent bone is scaled to reach it. If more than one bone is being constrained\r\n\t\t * and the parent bone has local nonuniform scale, stretch is not applied. */\r\n\t\tstretch = false;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained rotations. */\r\n\t\tmix = 1;\r\n\r\n\t\t/** For two bone IK, the distance from the maximum reach of the bones that rotation will slow. */\r\n\t\tsoftness = 0;\r\n\t\tactive = false;\r\n\r\n\t\tconstructor (data: IkConstraintData, skeleton: Skeleton) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\t\t\tthis.data = data;\r\n\t\t\tthis.mix = data.mix;\r\n\t\t\tthis.softness = data.softness;\r\n\t\t\tthis.bendDirection = data.bendDirection;\r\n\t\t\tthis.compress = data.compress;\r\n\t\t\tthis.stretch = data.stretch;\r\n\r\n\t\t\tthis.bones = new Array<Bone>();\r\n\t\t\tfor (let i = 0; i < data.bones.length; i++)\r\n\t\t\t\tthis.bones.push(skeleton.findBone(data.bones[i].name));\r\n\t\t\tthis.target = skeleton.findBone(data.target.name);\r\n\t\t}\r\n\r\n\t\tisActive () {\r\n\t\t\treturn this.active;\r\n\t\t}\r\n\r\n\t\t/** Applies the constraint to the constrained bones. */\r\n\t\tapply () {\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tupdate () {\r\n\t\t\tlet target = this.target;\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tswitch (bones.length) {\r\n\t\t\tcase 1:\r\n\t\t\t\tthis.apply1(bones[0], target.worldX, target.worldY, this.compress, this.stretch, this.data.uniform, this.mix);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tthis.apply2(bones[0], bones[1], target.worldX, target.worldY, this.bendDirection, this.stretch, this.softness, this.mix);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Applies 1 bone IK. The target is specified in the world coordinate system. */\r\n\t\tapply1 (bone: Bone, targetX: number, targetY: number, compress: boolean, stretch: boolean, uniform: boolean, alpha: number) {\r\n\t\t\tif (!bone.appliedValid) bone.updateAppliedTransform();\r\n\t\t\tlet p = bone.parent;\r\n\r\n\t\t\tlet pa = p.a, pb = p.b, pc = p.c, pd = p.d;\r\n\t\t\tlet rotationIK = -bone.ashearX - bone.arotation, tx = 0, ty = 0;\r\n\r\n\t\t\tswitch(bone.data.transformMode) {\r\n\t\t\t\tcase TransformMode.OnlyTranslation:\r\n\t\t\t\t\ttx = targetX - bone.worldX;\r\n\t\t\t\t\tty = targetY - bone.worldY;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TransformMode.NoRotationOrReflection:\r\n\t\t\t\t\trotationIK += Math.atan2(pc, pa) * MathUtils.radDeg;\r\n\t\t\t\t\tlet ps = Math.abs(pa * pd - pb * pc) / (pa * pa + pc * pc);\r\n\t\t\t\t\tpb = -pc * ps;\r\n\t\t\t\t\tpd = pa * ps;\r\n\t\t\t\t\t// Fall through\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tlet x = targetX - p.worldX, y = targetY - p.worldY;\r\n\t\t\t\t\tlet d = pa * pd - pb * pc;\r\n\t\t\t\t\ttx = (x * pd - y * pb) / d - bone.ax;\r\n\t\t\t\t\tty = (y * pa - x * pc) / d - bone.ay;\r\n\t\t\t}\r\n\t\t\trotationIK += Math.atan2(ty, tx) * MathUtils.radDeg;\r\n\t\t\tif (bone.ascaleX < 0) rotationIK += 180;\r\n\t\t\tif (rotationIK > 180)\r\n\t\t\t\trotationIK -= 360;\r\n\t\t\telse if (rotationIK < -180) rotationIK += 360;\r\n\t\t\tlet sx = bone.ascaleX, sy = bone.ascaleY;\r\n\t\t\tif (compress || stretch) {\r\n\t\t\t\tswitch (bone.data.transformMode) {\r\n\t\t\t\t\tcase TransformMode.NoScale:\r\n\t\t\t\t\tcase TransformMode.NoScaleOrReflection:\r\n\t\t\t\t\t\ttx = targetX - bone.worldX;\r\n\t\t\t\t\t\tty = targetY - bone.worldY;\r\n\t\t\t\t}\r\n\t\t\t\tlet b = bone.data.length * sx, dd = Math.sqrt(tx * tx + ty * ty);\r\n\t\t\t\tif ((compress && dd < b) || (stretch && dd > b) && b > 0.0001) {\r\n\t\t\t\t\tlet s = (dd / b - 1) * alpha + 1;\r\n\t\t\t\t\tsx *= s;\r\n\t\t\t\t\tif (uniform) sy *= s;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbone.updateWorldTransformWith(bone.ax, bone.ay, bone.arotation + rotationIK * alpha, sx, sy, bone.ashearX,\r\n\t\t\t\tbone.ashearY);\r\n\t\t}\r\n\r\n\t\t/** Applies 2 bone IK. The target is specified in the world coordinate system.\r\n\t\t * @param child A direct descendant of the parent bone. */\r\n\t\tapply2 (parent: Bone, child: Bone, targetX: number, targetY: number, bendDir: number, stretch: boolean, softness: number, alpha: number) {\r\n\t\t\tif (alpha == 0) {\r\n\t\t\t\tchild.updateWorldTransform();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!parent.appliedValid) parent.updateAppliedTransform();\r\n\t\t\tif (!child.appliedValid) child.updateAppliedTransform();\r\n\t\t\tlet px = parent.ax, py = parent.ay, psx = parent.ascaleX, sx = psx, psy = parent.ascaleY, csx = child.ascaleX;\r\n\t\t\tlet os1 = 0, os2 = 0, s2 = 0;\r\n\t\t\tif (psx < 0) {\r\n\t\t\t\tpsx = -psx;\r\n\t\t\t\tos1 = 180;\r\n\t\t\t\ts2 = -1;\r\n\t\t\t} else {\r\n\t\t\t\tos1 = 0;\r\n\t\t\t\ts2 = 1;\r\n\t\t\t}\r\n\t\t\tif (psy < 0) {\r\n\t\t\t\tpsy = -psy;\r\n\t\t\t\ts2 = -s2;\r\n\t\t\t}\r\n\t\t\tif (csx < 0) {\r\n\t\t\t\tcsx = -csx;\r\n\t\t\t\tos2 = 180;\r\n\t\t\t} else\r\n\t\t\t\tos2 = 0;\r\n\t\t\tlet cx = child.ax, cy = 0, cwx = 0, cwy = 0, a = parent.a, b = parent.b, c = parent.c, d = parent.d;\r\n\t\t\tlet u = Math.abs(psx - psy) <= 0.0001;\r\n\t\t\tif (!u) {\r\n\t\t\t\tcy = 0;\r\n\t\t\t\tcwx = a * cx + parent.worldX;\r\n\t\t\t\tcwy = c * cx + parent.worldY;\r\n\t\t\t} else {\r\n\t\t\t\tcy = child.ay;\r\n\t\t\t\tcwx = a * cx + b * cy + parent.worldX;\r\n\t\t\t\tcwy = c * cx + d * cy + parent.worldY;\r\n\t\t\t}\r\n\t\t\tlet pp = parent.parent;\r\n\t\t\ta = pp.a;\r\n\t\t\tb = pp.b;\r\n\t\t\tc = pp.c;\r\n\t\t\td = pp.d;\r\n\t\t\tlet id = 1 / (a * d - b * c), x = cwx - pp.worldX, y = cwy - pp.worldY;\r\n\t\t\tlet dx = (x * d - y * b) * id - px, dy = (y * a - x * c) * id - py;\r\n\t\t\tlet l1 = Math.sqrt(dx * dx + dy * dy), l2 = child.data.length * csx, a1, a2;\r\n\t\t\tif (l1 < 0.0001) {\r\n\t\t\t\tthis.apply1(parent, targetX, targetY, false, stretch, false, alpha);\r\n\t\t\t\tchild.updateWorldTransformWith(cx, cy, 0, child.ascaleX, child.ascaleY, child.ashearX, child.ashearY);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tx = targetX - pp.worldX;\r\n\t\t\ty = targetY - pp.worldY;\r\n\t\t\tlet tx = (x * d - y * b) * id - px, ty = (y * a - x * c) * id - py;\r\n\t\t\tlet dd = tx * tx + ty * ty;\r\n\t\t\tif (softness != 0) {\r\n\t\t\t\tsoftness *= psx * (csx + 1) / 2;\r\n\t\t\t\tlet td = Math.sqrt(dd), sd = td - l1 - l2 * psx + softness;\r\n\t\t\t\tif (sd > 0) {\r\n\t\t\t\t\tlet p = Math.min(1, sd / (softness * 2)) - 1;\r\n\t\t\t\t\tp = (sd - softness * (1 - p * p)) / td;\r\n\t\t\t\t\ttx -= p * tx;\r\n\t\t\t\t\tty -= p * ty;\r\n\t\t\t\t\tdd = tx * tx + ty * ty;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\touter:\r\n\t\t\tif (u) {\r\n\t\t\t\tl2 *= psx;\r\n\t\t\t\tlet cos = (dd - l1 * l1 - l2 * l2) / (2 * l1 * l2);\r\n\t\t\t\tif (cos < -1)\r\n\t\t\t\t\tcos = -1;\r\n\t\t\t\telse if (cos > 1) {\r\n\t\t\t\t\tcos = 1;\r\n\t\t\t\t\tif (stretch) sx *= (Math.sqrt(dd) / (l1 + l2) - 1) * alpha + 1;\r\n\t\t\t\t}\r\n\t\t\t\ta2 = Math.acos(cos) * bendDir;\r\n\t\t\t\ta = l1 + l2 * cos;\r\n\t\t\t\tb = l2 * Math.sin(a2);\r\n\t\t\t\ta1 = Math.atan2(ty * a - tx * b, tx * a + ty * b);\r\n\t\t\t} else {\r\n\t\t\t\ta = psx * l2;\r\n\t\t\t\tb = psy * l2;\r\n\t\t\t\tlet aa = a * a, bb = b * b, ta = Math.atan2(ty, tx);\r\n\t\t\t\tc = bb * l1 * l1 + aa * dd - aa * bb;\r\n\t\t\t\tlet c1 = -2 * bb * l1, c2 = bb - aa;\r\n\t\t\t\td = c1 * c1 - 4 * c2 * c;\r\n\t\t\t\tif (d >= 0) {\r\n\t\t\t\t\tlet q = Math.sqrt(d);\r\n\t\t\t\t\tif (c1 < 0) q = -q;\r\n\t\t\t\t\tq = -(c1 + q) / 2;\r\n\t\t\t\t\tlet r0 = q / c2, r1 = c / q;\r\n\t\t\t\t\tlet r = Math.abs(r0) < Math.abs(r1) ? r0 : r1;\r\n\t\t\t\t\tif (r * r <= dd) {\r\n\t\t\t\t\t\ty = Math.sqrt(dd - r * r) * bendDir;\r\n\t\t\t\t\t\ta1 = ta - Math.atan2(y, r);\r\n\t\t\t\t\t\ta2 = Math.atan2(y / psy, (r - l1) / psx);\r\n\t\t\t\t\t\tbreak outer;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet minAngle = MathUtils.PI, minX = l1 - a, minDist = minX * minX, minY = 0;\r\n\t\t\t\tlet maxAngle = 0, maxX = l1 + a, maxDist = maxX * maxX, maxY = 0;\r\n\t\t\t\tc = -a * l1 / (aa - bb);\r\n\t\t\t\tif (c >= -1 && c <= 1) {\r\n\t\t\t\t\tc = Math.acos(c);\r\n\t\t\t\t\tx = a * Math.cos(c) + l1;\r\n\t\t\t\t\ty = b * Math.sin(c);\r\n\t\t\t\t\td = x * x + y * y;\r\n\t\t\t\t\tif (d < minDist) {\r\n\t\t\t\t\t\tminAngle = c;\r\n\t\t\t\t\t\tminDist = d;\r\n\t\t\t\t\t\tminX = x;\r\n\t\t\t\t\t\tminY = y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (d > maxDist) {\r\n\t\t\t\t\t\tmaxAngle = c;\r\n\t\t\t\t\t\tmaxDist = d;\r\n\t\t\t\t\t\tmaxX = x;\r\n\t\t\t\t\t\tmaxY = y;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (dd <= (minDist + maxDist) / 2) {\r\n\t\t\t\t\ta1 = ta - Math.atan2(minY * bendDir, minX);\r\n\t\t\t\t\ta2 = minAngle * bendDir;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ta1 = ta - Math.atan2(maxY * bendDir, maxX);\r\n\t\t\t\t\ta2 = maxAngle * bendDir;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet os = Math.atan2(cy, cx) * s2;\r\n\t\t\tlet rotation = parent.arotation;\r\n\t\t\ta1 = (a1 - os) * MathUtils.radDeg + os1 - rotation;\r\n\t\t\tif (a1 > 180)\r\n\t\t\t\ta1 -= 360;\r\n\t\t\telse if (a1 < -180) a1 += 360;\r\n\t\t\tparent.updateWorldTransformWith(px, py, rotation + a1 * alpha, sx, parent.ascaleY, 0, 0);\r\n\t\t\trotation = child.arotation;\r\n\t\t\ta2 = ((a2 + os) * MathUtils.radDeg - child.ashearX) * s2 + os2 - rotation;\r\n\t\t\tif (a2 > 180)\r\n\t\t\t\ta2 -= 360;\r\n\t\t\telse if (a2 < -180) a2 += 360;\r\n\t\t\tchild.updateWorldTransformWith(cx, cy, rotation + a2 * alpha, child.ascaleX, child.ascaleY, child.ashearX, child.ashearY);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\n// module spine {\r\n\t/** The base class for all constraint datas. */\r\n\texport abstract class ConstraintData {\r\n\t\tconstructor(public name: string, public order: number, public skinRequired: boolean) { }\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { PathAttachment } from \"./attachments/PathAttachment\";\r\nimport { Bone } from \"./Bone\";\r\nimport { PathConstraintData, SpacingMode, RotateMode, PositionMode } from \"./PathConstraintData\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Slot } from \"./Slot\";\r\nimport { Updatable } from \"./Updatable\";\r\nimport { Utils, MathUtils } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the current pose for a path constraint. A path constraint adjusts the rotation, translation, and scale of the\r\n\t * constrained bones so they follow a {@link PathAttachment}.\r\n\t *\r\n\t * See [Path constraints](http://esotericsoftware.com/spine-path-constraints) in the Spine User Guide. */\r\n\texport class PathConstraint implements Updatable {\r\n\t\tstatic NONE = -1; static BEFORE = -2; static AFTER = -3;\r\n\t\tstatic epsilon = 0.00001;\r\n\r\n\t\t/** The path constraint's setup pose data. */\r\n\t\tdata: PathConstraintData;\r\n\r\n\t\t/** The bones that will be modified by this path constraint. */\r\n\t\tbones: Array<Bone>;\r\n\r\n\t\t/** The slot whose path attachment will be used to constrained the bones. */\r\n\t\ttarget: Slot;\r\n\r\n\t\t/** The position along the path. */\r\n\t\tposition = 0;\r\n\r\n\t\t/** The spacing between bones. */\r\n\t\tspacing = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained rotations. */\r\n\t\trotateMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained translations. */\r\n\t\ttranslateMix = 0;\r\n\r\n\t\tspaces = new Array<number>(); positions = new Array<number>();\r\n\t\tworld = new Array<number>(); curves = new Array<number>(); lengths = new Array<number>();\r\n\t\tsegments = new Array<number>();\r\n\r\n\t\tactive = false;\r\n\r\n\t\tconstructor (data: PathConstraintData, skeleton: Skeleton) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\t\t\tthis.data = data;\r\n\t\t\tthis.bones = new Array<Bone>();\r\n\t\t\tfor (let i = 0, n = data.bones.length; i < n; i++)\r\n\t\t\t\tthis.bones.push(skeleton.findBone(data.bones[i].name));\r\n\t\t\tthis.target = skeleton.findSlot(data.target.name);\r\n\t\t\tthis.position = data.position;\r\n\t\t\tthis.spacing = data.spacing;\r\n\t\t\tthis.rotateMix = data.rotateMix;\r\n\t\t\tthis.translateMix = data.translateMix;\r\n\t\t}\r\n\r\n\t\tisActive () {\r\n\t\t\treturn this.active;\r\n\t\t}\r\n\r\n\t\t/** Applies the constraint to the constrained bones. */\r\n\t\tapply () {\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tupdate () {\r\n\t\t\tlet attachment = this.target.getAttachment();\r\n\t\t\tif (!(attachment instanceof PathAttachment)) return;\r\n\r\n\t\t\tlet rotateMix = this.rotateMix, translateMix = this.translateMix;\r\n\t\t\tlet translate = translateMix > 0, rotate = rotateMix > 0;\r\n\t\t\tif (!translate && !rotate) return;\r\n\r\n\t\t\tlet data = this.data;\r\n\t\t\tlet percentSpacing = data.spacingMode == SpacingMode.Percent;\r\n\t\t\tlet rotateMode = data.rotateMode;\r\n\t\t\tlet tangents = rotateMode == RotateMode.Tangent, scale = rotateMode == RotateMode.ChainScale;\r\n\t\t\tlet boneCount = this.bones.length, spacesCount = tangents ? boneCount : boneCount + 1;\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tlet spaces = Utils.setArraySize(this.spaces, spacesCount), lengths: Array<number> = null;\r\n\t\t\tlet spacing = this.spacing;\r\n\t\t\tif (scale || !percentSpacing) {\r\n\t\t\t\tif (scale) lengths = Utils.setArraySize(this.lengths, boneCount);\r\n\t\t\t\tlet lengthSpacing = data.spacingMode == SpacingMode.Length;\r\n\t\t\t\tfor (let i = 0, n = spacesCount - 1; i < n;) {\r\n\t\t\t\t\tlet bone = bones[i];\r\n\t\t\t\t\tlet setupLength = bone.data.length;\r\n\t\t\t\t\tif (setupLength < PathConstraint.epsilon) {\r\n\t\t\t\t\t\tif (scale) lengths[i] = 0;\r\n\t\t\t\t\t\tspaces[++i] = 0;\r\n\t\t\t\t\t} else if (percentSpacing) {\r\n\t\t\t\t\t\tif (scale) {\r\n\t\t\t\t\t\t\tlet x = setupLength * bone.a, y = setupLength * bone.c;\r\n\t\t\t\t\t\t\tlet length = Math.sqrt(x * x + y * y);\r\n\t\t\t\t\t\t\tlengths[i] = length;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tspaces[++i] = spacing;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet x = setupLength * bone.a, y = setupLength * bone.c;\r\n\t\t\t\t\t\tlet length = Math.sqrt(x * x + y * y);\r\n\t\t\t\t\t\tif (scale) lengths[i] = length;\r\n\t\t\t\t\t\tspaces[++i] = (lengthSpacing ? setupLength + spacing : spacing) * length / setupLength;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (let i = 1; i < spacesCount; i++)\r\n\t\t\t\t\tspaces[i] = spacing;\r\n\t\t\t}\r\n\r\n\t\t\tlet positions = this.computeWorldPositions(<PathAttachment>attachment, spacesCount, tangents,\r\n\t\t\t\tdata.positionMode == PositionMode.Percent, percentSpacing);\r\n\t\t\tlet boneX = positions[0], boneY = positions[1], offsetRotation = data.offsetRotation;\r\n\t\t\tlet tip = false;\r\n\t\t\tif (offsetRotation == 0)\r\n\t\t\t\ttip = rotateMode == RotateMode.Chain;\r\n\t\t\telse {\r\n\t\t\t\ttip = false;\r\n\t\t\t\tlet p = this.target.bone;\r\n\t\t\t\toffsetRotation *= p.a * p.d - p.b * p.c > 0 ? MathUtils.degRad : -MathUtils.degRad;\r\n\t\t\t}\r\n\t\t\tfor (let i = 0, p = 3; i < boneCount; i++, p += 3) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tbone.worldX += (boneX - bone.worldX) * translateMix;\r\n\t\t\t\tbone.worldY += (boneY - bone.worldY) * translateMix;\r\n\t\t\t\tlet x = positions[p], y = positions[p + 1], dx = x - boneX, dy = y - boneY;\r\n\t\t\t\tif (scale) {\r\n\t\t\t\t\tlet length = lengths[i];\r\n\t\t\t\t\tif (length != 0) {\r\n\t\t\t\t\t\tlet s = (Math.sqrt(dx * dx + dy * dy) / length - 1) * rotateMix + 1;\r\n\t\t\t\t\t\tbone.a *= s;\r\n\t\t\t\t\t\tbone.c *= s;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tboneX = x;\r\n\t\t\t\tboneY = y;\r\n\t\t\t\tif (rotate) {\r\n\t\t\t\t\tlet a = bone.a, b = bone.b, c = bone.c, d = bone.d, r = 0, cos = 0, sin = 0;\r\n\t\t\t\t\tif (tangents)\r\n\t\t\t\t\t\tr = positions[p - 1];\r\n\t\t\t\t\telse if (spaces[i + 1] == 0)\r\n\t\t\t\t\t\tr = positions[p + 2];\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tr = Math.atan2(dy, dx);\r\n\t\t\t\t\tr -= Math.atan2(c, a);\r\n\t\t\t\t\tif (tip) {\r\n\t\t\t\t\t\tcos = Math.cos(r);\r\n\t\t\t\t\t\tsin = Math.sin(r);\r\n\t\t\t\t\t\tlet length = bone.data.length;\r\n\t\t\t\t\t\tboneX += (length * (cos * a - sin * c) - dx) * rotateMix;\r\n\t\t\t\t\t\tboneY += (length * (sin * a + cos * c) - dy) * rotateMix;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tr += offsetRotation;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (r > MathUtils.PI)\r\n\t\t\t\t\t\tr -= MathUtils.PI2;\r\n\t\t\t\t\telse if (r < -MathUtils.PI) //\r\n\t\t\t\t\t\tr += MathUtils.PI2;\r\n\t\t\t\t\tr *= rotateMix;\r\n\t\t\t\t\tcos = Math.cos(r);\r\n\t\t\t\t\tsin = Math.sin(r);\r\n\t\t\t\t\tbone.a = cos * a - sin * c;\r\n\t\t\t\t\tbone.b = cos * b - sin * d;\r\n\t\t\t\t\tbone.c = sin * a + cos * c;\r\n\t\t\t\t\tbone.d = sin * b + cos * d;\r\n\t\t\t\t}\r\n\t\t\t\tbone.appliedValid = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcomputeWorldPositions (path: PathAttachment, spacesCount: number, tangents: boolean, percentPosition: boolean,\r\n\t\t\tpercentSpacing: boolean) {\r\n\t\t\tlet target = this.target;\r\n\t\t\tlet position = this.position;\r\n\t\t\tlet spaces = this.spaces, out = Utils.setArraySize(this.positions, spacesCount * 3 + 2), world: Array<number> = null;\r\n\t\t\tlet closed = path.closed;\r\n\t\t\tlet verticesLength = path.worldVerticesLength, curveCount = verticesLength / 6, prevCurve = PathConstraint.NONE;\r\n\r\n\t\t\tif (!path.constantSpeed) {\r\n\t\t\t\tlet lengths = path.lengths;\r\n\t\t\t\tcurveCount -= closed ? 1 : 2;\r\n\t\t\t\tlet pathLength = lengths[curveCount];\r\n\t\t\t\tif (percentPosition) position *= pathLength;\r\n\t\t\t\tif (percentSpacing) {\r\n\t\t\t\t\tfor (let i = 1; i < spacesCount; i++)\r\n\t\t\t\t\t\tspaces[i] *= pathLength;\r\n\t\t\t\t}\r\n\t\t\t\tworld = Utils.setArraySize(this.world, 8);\r\n\t\t\t\tfor (let i = 0, o = 0, curve = 0; i < spacesCount; i++, o += 3) {\r\n\t\t\t\t\tlet space = spaces[i];\r\n\t\t\t\t\tposition += space;\r\n\t\t\t\t\tlet p = position;\r\n\r\n\t\t\t\t\tif (closed) {\r\n\t\t\t\t\t\tp %= pathLength;\r\n\t\t\t\t\t\tif (p < 0) p += pathLength;\r\n\t\t\t\t\t\tcurve = 0;\r\n\t\t\t\t\t} else if (p < 0) {\r\n\t\t\t\t\t\tif (prevCurve != PathConstraint.BEFORE) {\r\n\t\t\t\t\t\t\tprevCurve = PathConstraint.BEFORE;\r\n\t\t\t\t\t\t\tpath.computeWorldVertices(target, 2, 4, world, 0, 2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.addBeforePosition(p, world, 0, out, o);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else if (p > pathLength) {\r\n\t\t\t\t\t\tif (prevCurve != PathConstraint.AFTER) {\r\n\t\t\t\t\t\t\tprevCurve = PathConstraint.AFTER;\r\n\t\t\t\t\t\t\tpath.computeWorldVertices(target, verticesLength - 6, 4, world, 0, 2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.addAfterPosition(p - pathLength, world, 0, out, o);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Determine curve containing position.\r\n\t\t\t\t\tfor (;; curve++) {\r\n\t\t\t\t\t\tlet length = lengths[curve];\r\n\t\t\t\t\t\tif (p > length) continue;\r\n\t\t\t\t\t\tif (curve == 0)\r\n\t\t\t\t\t\t\tp /= length;\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tlet prev = lengths[curve - 1];\r\n\t\t\t\t\t\t\tp = (p - prev) / (length - prev);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (curve != prevCurve) {\r\n\t\t\t\t\t\tprevCurve = curve;\r\n\t\t\t\t\t\tif (closed && curve == curveCount) {\r\n\t\t\t\t\t\t\tpath.computeWorldVertices(target, verticesLength - 4, 4, world, 0, 2);\r\n\t\t\t\t\t\t\tpath.computeWorldVertices(target, 0, 4, world, 4, 2);\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tpath.computeWorldVertices(target, curve * 6 + 2, 8, world, 0, 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.addCurvePosition(p, world[0], world[1], world[2], world[3], world[4], world[5], world[6], world[7], out, o,\r\n\t\t\t\t\t\ttangents || (i > 0 && space == 0));\r\n\t\t\t\t}\r\n\t\t\t\treturn out;\r\n\t\t\t}\r\n\r\n\t\t\t// World vertices.\r\n\t\t\tif (closed) {\r\n\t\t\t\tverticesLength += 2;\r\n\t\t\t\tworld = Utils.setArraySize(this.world, verticesLength);\r\n\t\t\t\tpath.computeWorldVertices(target, 2, verticesLength - 4, world, 0, 2);\r\n\t\t\t\tpath.computeWorldVertices(target, 0, 2, world, verticesLength - 4, 2);\r\n\t\t\t\tworld[verticesLength - 2] = world[0];\r\n\t\t\t\tworld[verticesLength - 1] = world[1];\r\n\t\t\t} else {\r\n\t\t\t\tcurveCount--;\r\n\t\t\t\tverticesLength -= 4;\r\n\t\t\t\tworld = Utils.setArraySize(this.world, verticesLength);\r\n\t\t\t\tpath.computeWorldVertices(target, 2, verticesLength, world, 0, 2);\r\n\t\t\t}\r\n\r\n\t\t\t// Curve lengths.\r\n\t\t\tlet curves = Utils.setArraySize(this.curves, curveCount);\r\n\t\t\tlet pathLength = 0;\r\n\t\t\tlet x1 = world[0], y1 = world[1], cx1 = 0, cy1 = 0, cx2 = 0, cy2 = 0, x2 = 0, y2 = 0;\r\n\t\t\tlet tmpx = 0, tmpy = 0, dddfx = 0, dddfy = 0, ddfx = 0, ddfy = 0, dfx = 0, dfy = 0;\r\n\t\t\tfor (let i = 0, w = 2; i < curveCount; i++, w += 6) {\r\n\t\t\t\tcx1 = world[w];\r\n\t\t\t\tcy1 = world[w + 1];\r\n\t\t\t\tcx2 = world[w + 2];\r\n\t\t\t\tcy2 = world[w + 3];\r\n\t\t\t\tx2 = world[w + 4];\r\n\t\t\t\ty2 = world[w + 5];\r\n\t\t\t\ttmpx = (x1 - cx1 * 2 + cx2) * 0.1875;\r\n\t\t\t\ttmpy = (y1 - cy1 * 2 + cy2) * 0.1875;\r\n\t\t\t\tdddfx = ((cx1 - cx2) * 3 - x1 + x2) * 0.09375;\r\n\t\t\t\tdddfy = ((cy1 - cy2) * 3 - y1 + y2) * 0.09375;\r\n\t\t\t\tddfx = tmpx * 2 + dddfx;\r\n\t\t\t\tddfy = tmpy * 2 + dddfy;\r\n\t\t\t\tdfx = (cx1 - x1) * 0.75 + tmpx + dddfx * 0.16666667;\r\n\t\t\t\tdfy = (cy1 - y1) * 0.75 + tmpy + dddfy * 0.16666667;\r\n\t\t\t\tpathLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\tdfx += ddfx;\r\n\t\t\t\tdfy += ddfy;\r\n\t\t\t\tddfx += dddfx;\r\n\t\t\t\tddfy += dddfy;\r\n\t\t\t\tpathLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\tdfx += ddfx;\r\n\t\t\t\tdfy += ddfy;\r\n\t\t\t\tpathLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\tdfx += ddfx + dddfx;\r\n\t\t\t\tdfy += ddfy + dddfy;\r\n\t\t\t\tpathLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\tcurves[i] = pathLength;\r\n\t\t\t\tx1 = x2;\r\n\t\t\t\ty1 = y2;\r\n\t\t\t}\r\n\t\t\tif (percentPosition)\r\n\t\t\t\tposition *= pathLength;\r\n\t\t\telse\r\n\t\t\t\tposition *= pathLength / path.lengths[curveCount - 1];\r\n\t\t\tif (percentSpacing) {\r\n\t\t\t\tfor (let i = 1; i < spacesCount; i++)\r\n\t\t\t\t\tspaces[i] *= pathLength;\r\n\t\t\t}\r\n\r\n\t\t\tlet segments = this.segments;\r\n\t\t\tlet curveLength = 0;\r\n\t\t\tfor (let i = 0, o = 0, curve = 0, segment = 0; i < spacesCount; i++, o += 3) {\r\n\t\t\t\tlet space = spaces[i];\r\n\t\t\t\tposition += space;\r\n\t\t\t\tlet p = position;\r\n\r\n\t\t\t\tif (closed) {\r\n\t\t\t\t\tp %= pathLength;\r\n\t\t\t\t\tif (p < 0) p += pathLength;\r\n\t\t\t\t\tcurve = 0;\r\n\t\t\t\t} else if (p < 0) {\r\n\t\t\t\t\tthis.addBeforePosition(p, world, 0, out, o);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else if (p > pathLength) {\r\n\t\t\t\t\tthis.addAfterPosition(p - pathLength, world, verticesLength - 4, out, o);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Determine curve containing position.\r\n\t\t\t\tfor (;; curve++) {\r\n\t\t\t\t\tlet length = curves[curve];\r\n\t\t\t\t\tif (p > length) continue;\r\n\t\t\t\t\tif (curve == 0)\r\n\t\t\t\t\t\tp /= length;\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlet prev = curves[curve - 1];\r\n\t\t\t\t\t\tp = (p - prev) / (length - prev);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Curve segment lengths.\r\n\t\t\t\tif (curve != prevCurve) {\r\n\t\t\t\t\tprevCurve = curve;\r\n\t\t\t\t\tlet ii = curve * 6;\r\n\t\t\t\t\tx1 = world[ii];\r\n\t\t\t\t\ty1 = world[ii + 1];\r\n\t\t\t\t\tcx1 = world[ii + 2];\r\n\t\t\t\t\tcy1 = world[ii + 3];\r\n\t\t\t\t\tcx2 = world[ii + 4];\r\n\t\t\t\t\tcy2 = world[ii + 5];\r\n\t\t\t\t\tx2 = world[ii + 6];\r\n\t\t\t\t\ty2 = world[ii + 7];\r\n\t\t\t\t\ttmpx = (x1 - cx1 * 2 + cx2) * 0.03;\r\n\t\t\t\t\ttmpy = (y1 - cy1 * 2 + cy2) * 0.03;\r\n\t\t\t\t\tdddfx = ((cx1 - cx2) * 3 - x1 + x2) * 0.006;\r\n\t\t\t\t\tdddfy = ((cy1 - cy2) * 3 - y1 + y2) * 0.006;\r\n\t\t\t\t\tddfx = tmpx * 2 + dddfx;\r\n\t\t\t\t\tddfy = tmpy * 2 + dddfy;\r\n\t\t\t\t\tdfx = (cx1 - x1) * 0.3 + tmpx + dddfx * 0.16666667;\r\n\t\t\t\t\tdfy = (cy1 - y1) * 0.3 + tmpy + dddfy * 0.16666667;\r\n\t\t\t\t\tcurveLength = Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\t\tsegments[0] = curveLength;\r\n\t\t\t\t\tfor (ii = 1; ii < 8; ii++) {\r\n\t\t\t\t\t\tdfx += ddfx;\r\n\t\t\t\t\t\tdfy += ddfy;\r\n\t\t\t\t\t\tddfx += dddfx;\r\n\t\t\t\t\t\tddfy += dddfy;\r\n\t\t\t\t\t\tcurveLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\t\t\tsegments[ii] = curveLength;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdfx += ddfx;\r\n\t\t\t\t\tdfy += ddfy;\r\n\t\t\t\t\tcurveLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\t\tsegments[8] = curveLength;\r\n\t\t\t\t\tdfx += ddfx + dddfx;\r\n\t\t\t\t\tdfy += ddfy + dddfy;\r\n\t\t\t\t\tcurveLength += Math.sqrt(dfx * dfx + dfy * dfy);\r\n\t\t\t\t\tsegments[9] = curveLength;\r\n\t\t\t\t\tsegment = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Weight by segment length.\r\n\t\t\t\tp *= curveLength;\r\n\t\t\t\tfor (;; segment++) {\r\n\t\t\t\t\tlet length = segments[segment];\r\n\t\t\t\t\tif (p > length) continue;\r\n\t\t\t\t\tif (segment == 0)\r\n\t\t\t\t\t\tp /= length;\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlet prev = segments[segment - 1];\r\n\t\t\t\t\t\tp = segment + (p - prev) / (length - prev);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis.addCurvePosition(p * 0.1, x1, y1, cx1, cy1, cx2, cy2, x2, y2, out, o, tangents || (i > 0 && space == 0));\r\n\t\t\t}\r\n\t\t\treturn out;\r\n\t\t}\r\n\r\n\t\taddBeforePosition (p: number, temp: Array<number>, i: number, out: Array<number>, o: number) {\r\n\t\t\tlet x1 = temp[i], y1 = temp[i + 1], dx = temp[i + 2] - x1, dy = temp[i + 3] - y1, r = Math.atan2(dy, dx);\r\n\t\t\tout[o] = x1 + p * Math.cos(r);\r\n\t\t\tout[o + 1] = y1 + p * Math.sin(r);\r\n\t\t\tout[o + 2] = r;\r\n\t\t}\r\n\r\n\t\taddAfterPosition (p: number, temp: Array<number>, i: number, out: Array<number>, o: number) {\r\n\t\t\tlet x1 = temp[i + 2], y1 = temp[i + 3], dx = x1 - temp[i], dy = y1 - temp[i + 1], r = Math.atan2(dy, dx);\r\n\t\t\tout[o] = x1 + p * Math.cos(r);\r\n\t\t\tout[o + 1] = y1 + p * Math.sin(r);\r\n\t\t\tout[o + 2] = r;\r\n\t\t}\r\n\r\n\t\taddCurvePosition (p: number, x1: number, y1: number, cx1: number, cy1: number, cx2: number, cy2: number, x2: number, y2: number,\r\n\t\t\tout: Array<number>, o: number, tangents: boolean) {\r\n\t\t\tif (p == 0 || isNaN(p)) {\r\n\t\t\t\tout[o] = x1;\r\n\t\t\t\tout[o + 1] = y1;\r\n\t\t\t\tout[o + 2] = Math.atan2(cy1 - y1, cx1 - x1);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet tt = p * p, ttt = tt * p, u = 1 - p, uu = u * u, uuu = uu * u;\r\n\t\t\tlet ut = u * p, ut3 = ut * 3, uut3 = u * ut3, utt3 = ut3 * p;\r\n\t\t\tlet x = x1 * uuu + cx1 * uut3 + cx2 * utt3 + x2 * ttt, y = y1 * uuu + cy1 * uut3 + cy2 * utt3 + y2 * ttt;\r\n\t\t\tout[o] = x;\r\n\t\t\tout[o + 1] = y;\r\n\t\t\tif (tangents) {\r\n\t\t\t\tif (p < 0.001)\r\n\t\t\t\t\tout[o + 2] = Math.atan2(cy1 - y1, cx1 - x1);\r\n\t\t\t\telse\r\n\t\t\t\t\tout[o + 2] = Math.atan2(y - (y1 * uu + cy1 * ut * 2 + cy2 * tt), x - (x1 * uu + cx1 * ut * 2 + cx2 * tt));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Attachment } from \"./attachments/Attachment\";\r\nimport { Bone } from \"./Bone\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { SlotData } from \"./SlotData\";\r\nimport { Color } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores a slot's current pose. Slots organize attachments for {@link Skeleton#drawOrder} purposes and provide a place to store\r\n\t * state for an attachment. State cannot be stored in an attachment itself because attachments are stateless and may be shared\r\n\t * across multiple skeletons. */\r\n\texport class Slot {\r\n\t\t/** The slot's setup pose data. */\r\n\t\tdata: SlotData;\r\n\r\n\t\t/** The bone this slot belongs to. */\r\n\t\tbone: Bone;\r\n\r\n\t\t/** The color used to tint the slot's attachment. If {@link #getDarkColor()} is set, this is used as the light color for two\r\n\t\t * color tinting. */\r\n\t\tcolor: Color;\r\n\r\n\t\t/** The dark color used to tint the slot's attachment for two color tinting, or null if two color tinting is not used. The dark\r\n\t\t * color's alpha is not used. */\r\n\t\tdarkColor: Color;\r\n\r\n\t\tattachment: Attachment;\r\n\r\n\t\tprivate attachmentTime: number;\r\n\r\n\t\tattachmentState: number;\r\n\r\n\t\t/** Values to deform the slot's attachment. For an unweighted mesh, the entries are local positions for each vertex. For a\r\n\t\t * weighted mesh, the entries are an offset for each vertex which will be added to the mesh's local vertex positions.\r\n\t\t *\r\n\t\t * See {@link VertexAttachment#computeWorldVertices()} and {@link DeformTimeline}. */\r\n\t\tdeform = new Array<number>();\r\n\r\n\t\tconstructor (data: SlotData, bone: Bone) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tif (bone == null) throw new Error(\"bone cannot be null.\");\r\n\t\t\tthis.data = data;\r\n\t\t\tthis.bone = bone;\r\n\t\t\tthis.color = new Color();\r\n\t\t\tthis.darkColor = data.darkColor == null ? null : new Color();\r\n\t\t\tthis.setToSetupPose();\r\n\t\t}\r\n\r\n\t\t/** The skeleton this slot belongs to. */\r\n\t\tgetSkeleton (): Skeleton {\r\n\t\t\treturn this.bone.skeleton;\r\n\t\t}\r\n\r\n\t\t/** The current attachment for the slot, or null if the slot has no attachment. */\r\n\t\tgetAttachment (): Attachment {\r\n\t\t\treturn this.attachment;\r\n\t\t}\r\n\r\n\t\t/** Sets the slot's attachment and, if the attachment changed, resets {@link #attachmentTime} and clears {@link #deform}.\r\n\t\t * @param attachment May be null. */\r\n\t\tsetAttachment (attachment: Attachment) {\r\n\t\t\tif (this.attachment == attachment) return;\r\n\t\t\tthis.attachment = attachment;\r\n\t\t\tthis.attachmentTime = this.bone.skeleton.time;\r\n\t\t\tthis.deform.length = 0;\r\n\t\t}\r\n\r\n\t\tsetAttachmentTime (time: number) {\r\n\t\t\tthis.attachmentTime = this.bone.skeleton.time - time;\r\n\t\t}\r\n\r\n\t\t/** The time that has elapsed since the last time the attachment was set or cleared. Relies on Skeleton\r\n\t\t * {@link Skeleton#time}. */\r\n\t\tgetAttachmentTime (): number {\r\n\t\t\treturn this.bone.skeleton.time - this.attachmentTime;\r\n\t\t}\r\n\r\n\t\t/** Sets this slot to the setup pose. */\r\n\t\tsetToSetupPose () {\r\n\t\t\tthis.color.setFromColor(this.data.color);\r\n\t\t\tif (this.darkColor != null) this.darkColor.setFromColor(this.data.darkColor);\r\n\t\t\tif (this.data.attachmentName == null)\r\n\t\t\t\tthis.attachment = null;\r\n\t\t\telse {\r\n\t\t\t\tthis.attachment = null;\r\n\t\t\t\tthis.setAttachment(this.bone.skeleton.getAttachment(this.data.index, this.data.attachmentName));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Bone } from \"./Bone\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { TransformConstraintData } from \"./TransformConstraintData\";\r\nimport { Updatable } from \"./Updatable\";\r\nimport { Vector2, MathUtils } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the current pose for a transform constraint. A transform constraint adjusts the world transform of the constrained\r\n\t * bones to match that of the target bone.\r\n\t *\r\n\t * See [Transform constraints](http://esotericsoftware.com/spine-transform-constraints) in the Spine User Guide. */\r\n\texport class TransformConstraint implements Updatable {\r\n\r\n\t\t/** The transform constraint's setup pose data. */\r\n\t\tdata: TransformConstraintData;\r\n\r\n\t\t/** The bones that will be modified by this transform constraint. */\r\n\t\tbones: Array<Bone>;\r\n\r\n\t\t/** The target bone whose world transform will be copied to the constrained bones. */\r\n\t\ttarget: Bone;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained rotations. */\r\n\t\trotateMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained translations. */\r\n\t\ttranslateMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained scales. */\r\n\t\tscaleMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained scales. */\r\n\t\tshearMix = 0;\r\n\r\n\t\ttemp = new Vector2();\r\n\t\tactive = false;\r\n\r\n\t\tconstructor (data: TransformConstraintData, skeleton: Skeleton) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\t\t\tthis.data = data;\r\n\t\t\tthis.rotateMix = data.rotateMix;\r\n\t\t\tthis.translateMix = data.translateMix;\r\n\t\t\tthis.scaleMix = data.scaleMix;\r\n\t\t\tthis.shearMix = data.shearMix;\r\n\t\t\tthis.bones = new Array<Bone>();\r\n\t\t\tfor (let i = 0; i < data.bones.length; i++)\r\n\t\t\t\tthis.bones.push(skeleton.findBone(data.bones[i].name));\r\n\t\t\tthis.target = skeleton.findBone(data.target.name);\r\n\t\t}\r\n\r\n\t\tisActive () {\r\n\t\t\treturn this.active;\r\n\t\t}\r\n\r\n\t\t/** Applies the constraint to the constrained bones. */\r\n\t\tapply () {\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tupdate () {\r\n\t\t\tif (this.data.local) {\r\n\t\t\t\tif (this.data.relative)\r\n\t\t\t\t\tthis.applyRelativeLocal();\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.applyAbsoluteLocal();\r\n\r\n\t\t\t} else {\r\n\t\t\t\tif (this.data.relative)\r\n\t\t\t\t\tthis.applyRelativeWorld();\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.applyAbsoluteWorld();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tapplyAbsoluteWorld () {\r\n\t\t\tlet rotateMix = this.rotateMix, translateMix = this.translateMix, scaleMix = this.scaleMix, shearMix = this.shearMix;\r\n\t\t\tlet target = this.target;\r\n\t\t\tlet ta = target.a, tb = target.b, tc = target.c, td = target.d;\r\n\t\t\tlet degRadReflect = ta * td - tb * tc > 0 ? MathUtils.degRad : -MathUtils.degRad;\r\n\t\t\tlet offsetRotation = this.data.offsetRotation * degRadReflect;\r\n\t\t\tlet offsetShearY = this.data.offsetShearY * degRadReflect;\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tlet modified = false;\r\n\r\n\t\t\t\tif (rotateMix != 0) {\r\n\t\t\t\t\tlet a = bone.a, b = bone.b, c = bone.c, d = bone.d;\r\n\t\t\t\t\tlet r = Math.atan2(tc, ta) - Math.atan2(c, a) + offsetRotation;\r\n\t\t\t\t\tif (r > MathUtils.PI)\r\n\t\t\t\t\t\tr -= MathUtils.PI2;\r\n\t\t\t\t\telse if (r < -MathUtils.PI)\r\n\t\t\t\t\t\tr += MathUtils.PI2;\r\n\t\t\t\t\tr *= rotateMix;\r\n\t\t\t\t\tlet cos = Math.cos(r), sin = Math.sin(r);\r\n\t\t\t\t\tbone.a = cos * a - sin * c;\r\n\t\t\t\t\tbone.b = cos * b - sin * d;\r\n\t\t\t\t\tbone.c = sin * a + cos * c;\r\n\t\t\t\t\tbone.d = sin * b + cos * d;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (translateMix != 0) {\r\n\t\t\t\t\tlet temp = this.temp;\r\n\t\t\t\t\ttarget.localToWorld(temp.set(this.data.offsetX, this.data.offsetY));\r\n\t\t\t\t\tbone.worldX += (temp.x - bone.worldX) * translateMix;\r\n\t\t\t\t\tbone.worldY += (temp.y - bone.worldY) * translateMix;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (scaleMix > 0) {\r\n\t\t\t\t\tlet s = Math.sqrt(bone.a * bone.a + bone.c * bone.c);\r\n\t\t\t\t\tlet ts = Math.sqrt(ta * ta + tc * tc);\r\n\t\t\t\t\tif (s > 0.00001) s = (s + (ts - s + this.data.offsetScaleX) * scaleMix) / s;\r\n\t\t\t\t\tbone.a *= s;\r\n\t\t\t\t\tbone.c *= s;\r\n\t\t\t\t\ts = Math.sqrt(bone.b * bone.b + bone.d * bone.d);\r\n\t\t\t\t\tts = Math.sqrt(tb * tb + td * td);\r\n\t\t\t\t\tif (s > 0.00001) s = (s + (ts - s + this.data.offsetScaleY) * scaleMix) / s;\r\n\t\t\t\t\tbone.b *= s;\r\n\t\t\t\t\tbone.d *= s;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (shearMix > 0) {\r\n\t\t\t\t\tlet b = bone.b, d = bone.d;\r\n\t\t\t\t\tlet by = Math.atan2(d, b);\r\n\t\t\t\t\tlet r = Math.atan2(td, tb) - Math.atan2(tc, ta) - (by - Math.atan2(bone.c, bone.a));\r\n\t\t\t\t\tif (r > MathUtils.PI)\r\n\t\t\t\t\t\tr -= MathUtils.PI2;\r\n\t\t\t\t\telse if (r < -MathUtils.PI)\r\n\t\t\t\t\t\tr += MathUtils.PI2;\r\n\t\t\t\t\tr = by + (r + offsetShearY) * shearMix;\r\n\t\t\t\t\tlet s = Math.sqrt(b * b + d * d);\r\n\t\t\t\t\tbone.b = Math.cos(r) * s;\r\n\t\t\t\t\tbone.d = Math.sin(r) * s;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (modified) bone.appliedValid = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tapplyRelativeWorld () {\r\n\t\t\tlet rotateMix = this.rotateMix, translateMix = this.translateMix, scaleMix = this.scaleMix, shearMix = this.shearMix;\r\n\t\t\tlet target = this.target;\r\n\t\t\tlet ta = target.a, tb = target.b, tc = target.c, td = target.d;\r\n\t\t\tlet degRadReflect = ta * td - tb * tc > 0 ? MathUtils.degRad : -MathUtils.degRad;\r\n\t\t\tlet offsetRotation = this.data.offsetRotation * degRadReflect, offsetShearY = this.data.offsetShearY * degRadReflect;\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tlet modified = false;\r\n\r\n\t\t\t\tif (rotateMix != 0) {\r\n\t\t\t\t\tlet a = bone.a, b = bone.b, c = bone.c, d = bone.d;\r\n\t\t\t\t\tlet r = Math.atan2(tc, ta) + offsetRotation;\r\n\t\t\t\t\tif (r > MathUtils.PI)\r\n\t\t\t\t\t\tr -= MathUtils.PI2;\r\n\t\t\t\t\telse if (r < -MathUtils.PI) r += MathUtils.PI2;\r\n\t\t\t\t\tr *= rotateMix;\r\n\t\t\t\t\tlet cos = Math.cos(r), sin = Math.sin(r);\r\n\t\t\t\t\tbone.a = cos * a - sin * c;\r\n\t\t\t\t\tbone.b = cos * b - sin * d;\r\n\t\t\t\t\tbone.c = sin * a + cos * c;\r\n\t\t\t\t\tbone.d = sin * b + cos * d;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (translateMix != 0) {\r\n\t\t\t\t\tlet temp = this.temp;\r\n\t\t\t\t\ttarget.localToWorld(temp.set(this.data.offsetX, this.data.offsetY));\r\n\t\t\t\t\tbone.worldX += temp.x * translateMix;\r\n\t\t\t\t\tbone.worldY += temp.y * translateMix;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (scaleMix > 0) {\r\n\t\t\t\t\tlet s = (Math.sqrt(ta * ta + tc * tc) - 1 + this.data.offsetScaleX) * scaleMix + 1;\r\n\t\t\t\t\tbone.a *= s;\r\n\t\t\t\t\tbone.c *= s;\r\n\t\t\t\t\ts = (Math.sqrt(tb * tb + td * td) - 1 + this.data.offsetScaleY) * scaleMix + 1;\r\n\t\t\t\t\tbone.b *= s;\r\n\t\t\t\t\tbone.d *= s;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (shearMix > 0) {\r\n\t\t\t\t\tlet r = Math.atan2(td, tb) - Math.atan2(tc, ta);\r\n\t\t\t\t\tif (r > MathUtils.PI)\r\n\t\t\t\t\t\tr -= MathUtils.PI2;\r\n\t\t\t\t\telse if (r < -MathUtils.PI) r += MathUtils.PI2;\r\n\t\t\t\t\tlet b = bone.b, d = bone.d;\r\n\t\t\t\t\tr = Math.atan2(d, b) + (r - MathUtils.PI / 2 + offsetShearY) * shearMix;\r\n\t\t\t\t\tlet s = Math.sqrt(b * b + d * d);\r\n\t\t\t\t\tbone.b = Math.cos(r) * s;\r\n\t\t\t\t\tbone.d = Math.sin(r) * s;\r\n\t\t\t\t\tmodified = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (modified) bone.appliedValid = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tapplyAbsoluteLocal () {\r\n\t\t\tlet rotateMix = this.rotateMix, translateMix = this.translateMix, scaleMix = this.scaleMix, shearMix = this.shearMix;\r\n\t\t\tlet target = this.target;\r\n\t\t\tif (!target.appliedValid) target.updateAppliedTransform();\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tif (!bone.appliedValid) bone.updateAppliedTransform();\r\n\r\n\t\t\t\tlet rotation = bone.arotation;\r\n\t\t\t\tif (rotateMix != 0) {\r\n\t\t\t\t\tlet r = target.arotation - rotation + this.data.offsetRotation;\r\n\t\t\t\t\tr -= (16384 - ((16384.499999999996 - r / 360) | 0)) * 360;\r\n\t\t\t\t\trotation += r * rotateMix;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet x = bone.ax, y = bone.ay;\r\n\t\t\t\tif (translateMix != 0) {\r\n\t\t\t\t\tx += (target.ax - x + this.data.offsetX) * translateMix;\r\n\t\t\t\t\ty += (target.ay - y + this.data.offsetY) * translateMix;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet scaleX = bone.ascaleX, scaleY = bone.ascaleY;\r\n\t\t\t\tif (scaleMix != 0) {\r\n\t\t\t\t\tif (scaleX > 0.00001) scaleX = (scaleX + (target.ascaleX - scaleX + this.data.offsetScaleX) * scaleMix) / scaleX;\r\n\t\t\t\t\tif (scaleY > 0.00001) scaleY = (scaleY + (target.ascaleY - scaleY + this.data.offsetScaleY) * scaleMix) / scaleY;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet shearY = bone.ashearY;\r\n\t\t\t\tif (shearMix != 0) {\r\n\t\t\t\t\tlet r = target.ashearY - shearY + this.data.offsetShearY;\r\n\t\t\t\t\tr -= (16384 - ((16384.499999999996 - r / 360) | 0)) * 360;\r\n\t\t\t\t\tbone.shearY += r * shearMix;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbone.updateWorldTransformWith(x, y, rotation, scaleX, scaleY, bone.ashearX, shearY);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tapplyRelativeLocal () {\r\n\t\t\tlet rotateMix = this.rotateMix, translateMix = this.translateMix, scaleMix = this.scaleMix, shearMix = this.shearMix;\r\n\t\t\tlet target = this.target;\r\n\t\t\tif (!target.appliedValid) target.updateAppliedTransform();\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tif (!bone.appliedValid) bone.updateAppliedTransform();\r\n\r\n\t\t\t\tlet rotation = bone.arotation;\r\n\t\t\t\tif (rotateMix != 0) rotation += (target.arotation + this.data.offsetRotation) * rotateMix;\r\n\r\n\t\t\t\tlet x = bone.ax, y = bone.ay;\r\n\t\t\t\tif (translateMix != 0) {\r\n\t\t\t\t\tx += (target.ax + this.data.offsetX) * translateMix;\r\n\t\t\t\t\ty += (target.ay + this.data.offsetY) * translateMix;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet scaleX = bone.ascaleX, scaleY = bone.ascaleY;\r\n\t\t\t\tif (scaleMix != 0) {\r\n\t\t\t\t\tif (scaleX > 0.00001) scaleX *= ((target.ascaleX - 1 + this.data.offsetScaleX) * scaleMix) + 1;\r\n\t\t\t\t\tif (scaleY > 0.00001) scaleY *= ((target.ascaleY - 1 + this.data.offsetScaleY) * scaleMix) + 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet shearY = bone.ashearY;\r\n\t\t\t\tif (shearMix != 0) shearY += (target.ashearY + this.data.offsetShearY) * shearMix;\r\n\r\n\t\t\t\tbone.updateWorldTransformWith(x, y, rotation, scaleX, scaleY, bone.ashearX, shearY);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Attachment } from \"./attachments/Attachment\";\r\nimport { MeshAttachment } from \"./attachments/MeshAttachment\";\r\nimport { PathAttachment } from \"./attachments/PathAttachment\";\r\nimport { RegionAttachment } from \"./attachments/RegionAttachment\";\r\nimport { Bone } from \"./Bone\";\r\nimport { IkConstraint } from \"./IkConstraint\";\r\nimport { PathConstraint } from \"./PathConstraint\";\r\nimport { SkeletonData } from \"./SkeletonData\";\r\nimport { Skin } from \"./Skin\";\r\nimport { Slot } from \"./Slot\";\r\nimport { TransformConstraint } from \"./TransformConstraint\";\r\nimport { Updatable } from \"./Updatable\";\r\nimport { Color, Utils, Vector2 } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the current pose for a skeleton.\r\n\t *\r\n\t * See [Instance objects](http://esotericsoftware.com/spine-runtime-architecture#Instance-objects) in the Spine Runtimes Guide. */\r\n\texport class Skeleton {\r\n\t\t/** The skeleton's setup pose data. */\r\n\t\tdata: SkeletonData;\r\n\r\n\t\t/** The skeleton's bones, sorted parent first. The root bone is always the first bone. */\r\n\t\tbones: Array<Bone>;\r\n\r\n\t\t/** The skeleton's slots. */\r\n\t\tslots: Array<Slot>;\r\n\r\n\t\t/** The skeleton's slots in the order they should be drawn. The returned array may be modified to change the draw order. */\r\n\t\tdrawOrder: Array<Slot>;\r\n\r\n\t\t/** The skeleton's IK constraints. */\r\n\t\tikConstraints: Array<IkConstraint>;\r\n\r\n\t\t/** The skeleton's transform constraints. */\r\n\t\ttransformConstraints: Array<TransformConstraint>;\r\n\r\n\t\t/** The skeleton's path constraints. */\r\n\t\tpathConstraints: Array<PathConstraint>;\r\n\r\n\t\t/** The list of bones and constraints, sorted in the order they should be updated, as computed by {@link #updateCache()}. */\r\n\t\t_updateCache = new Array<Updatable>();\r\n\t\tupdateCacheReset = new Array<Updatable>();\r\n\r\n\t\t/** The skeleton's current skin. May be null. */\r\n\t\tskin: Skin;\r\n\r\n\t\t/** The color to tint all the skeleton's attachments. */\r\n\t\tcolor: Color;\r\n\r\n\t\t/** Returns the skeleton's time. This can be used for tracking, such as with Slot {@link Slot#attachmentTime}.\r\n\t\t * <p>\r\n\t\t * See {@link #update()}. */\r\n\t\ttime = 0;\r\n\r\n\t\t/** Scales the entire skeleton on the X axis. This affects all bones, even if the bone's transform mode disallows scale\r\n\t \t* inheritance. */\r\n\t\tscaleX = 1;\r\n\r\n\t\t/** Scales the entire skeleton on the Y axis. This affects all bones, even if the bone's transform mode disallows scale\r\n\t \t* inheritance. */\r\n\t\tscaleY = 1;\r\n\r\n\t\t/** Sets the skeleton X position, which is added to the root bone worldX position. */\r\n\t\tx = 0;\r\n\r\n\t\t/** Sets the skeleton Y position, which is added to the root bone worldY position. */\r\n\t\ty = 0;\r\n\r\n\t\tconstructor (data: SkeletonData) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tthis.data = data;\r\n\r\n\t\t\tthis.bones = new Array<Bone>();\r\n\t\t\tfor (let i = 0; i < data.bones.length; i++) {\r\n\t\t\t\tlet boneData = data.bones[i];\r\n\t\t\t\tlet bone: Bone;\r\n\t\t\t\tif (boneData.parent == null)\r\n\t\t\t\t\tbone = new Bone(boneData, this, null);\r\n\t\t\t\telse {\r\n\t\t\t\t\tlet parent = this.bones[boneData.parent.index];\r\n\t\t\t\t\tbone = new Bone(boneData, this, parent);\r\n\t\t\t\t\tparent.children.push(bone);\r\n\t\t\t\t}\r\n\t\t\t\tthis.bones.push(bone);\r\n\t\t\t}\r\n\r\n\t\t\tthis.slots = new Array<Slot>();\r\n\t\t\tthis.drawOrder = new Array<Slot>();\r\n\t\t\tfor (let i = 0; i < data.slots.length; i++) {\r\n\t\t\t\tlet slotData = data.slots[i];\r\n\t\t\t\tlet bone = this.bones[slotData.boneData.index];\r\n\t\t\t\tlet slot = new Slot(slotData, bone);\r\n\t\t\t\tthis.slots.push(slot);\r\n\t\t\t\tthis.drawOrder.push(slot);\r\n\t\t\t}\r\n\r\n\t\t\tthis.ikConstraints = new Array<IkConstraint>();\r\n\t\t\tfor (let i = 0; i < data.ikConstraints.length; i++) {\r\n\t\t\t\tlet ikConstraintData = data.ikConstraints[i];\r\n\t\t\t\tthis.ikConstraints.push(new IkConstraint(ikConstraintData, this));\r\n\t\t\t}\r\n\r\n\t\t\tthis.transformConstraints = new Array<TransformConstraint>();\r\n\t\t\tfor (let i = 0; i < data.transformConstraints.length; i++) {\r\n\t\t\t\tlet transformConstraintData = data.transformConstraints[i];\r\n\t\t\t\tthis.transformConstraints.push(new TransformConstraint(transformConstraintData, this));\r\n\t\t\t}\r\n\r\n\t\t\tthis.pathConstraints = new Array<PathConstraint>();\r\n\t\t\tfor (let i = 0; i < data.pathConstraints.length; i++) {\r\n\t\t\t\tlet pathConstraintData = data.pathConstraints[i];\r\n\t\t\t\tthis.pathConstraints.push(new PathConstraint(pathConstraintData, this));\r\n\t\t\t}\r\n\r\n\t\t\tthis.color = new Color(1, 1, 1, 1);\r\n\t\t\tthis.updateCache();\r\n\t\t}\r\n\r\n\t\t/** Caches information about bones and constraints. Must be called if the {@link #getSkin()} is modified or if bones,\r\n\t\t * constraints, or weighted path attachments are added or removed. */\r\n\t\tupdateCache () {\r\n\t\t\tlet updateCache = this._updateCache;\r\n\t\t\tupdateCache.length = 0;\r\n\t\t\tthis.updateCacheReset.length = 0;\r\n\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tbone.sorted = bone.data.skinRequired;\r\n\t\t\t\tbone.active = !bone.sorted;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.skin != null) {\r\n\t\t\t\tlet skinBones = this.skin.bones;\r\n\t\t\t\tfor (let i = 0, n = this.skin.bones.length; i < n; i++) {\r\n\t\t\t\t\tlet bone = this.bones[skinBones[i].index];\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tbone.sorted = false;\r\n\t\t\t\t\t\tbone.active = true;\r\n\t\t\t\t\t\tbone = bone.parent;\r\n\t\t\t\t\t} while (bone != null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// IK first, lowest hierarchy depth first.\r\n\t\t\tlet ikConstraints = this.ikConstraints;\r\n\t\t\tlet transformConstraints = this.transformConstraints;\r\n\t\t\tlet pathConstraints = this.pathConstraints;\r\n\t\t\tlet ikCount = ikConstraints.length, transformCount = transformConstraints.length, pathCount = pathConstraints.length;\r\n\t\t\tlet constraintCount = ikCount + transformCount + pathCount;\r\n\r\n\t\t\touter:\r\n\t\t\tfor (let i = 0; i < constraintCount; i++) {\r\n\t\t\t\tfor (let ii = 0; ii < ikCount; ii++) {\r\n\t\t\t\t\tlet constraint = ikConstraints[ii];\r\n\t\t\t\t\tif (constraint.data.order == i) {\r\n\t\t\t\t\t\tthis.sortIkConstraint(constraint);\r\n\t\t\t\t\t\tcontinue outer;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor (let ii = 0; ii < transformCount; ii++) {\r\n\t\t\t\t\tlet constraint = transformConstraints[ii];\r\n\t\t\t\t\tif (constraint.data.order == i) {\r\n\t\t\t\t\t\tthis.sortTransformConstraint(constraint);\r\n\t\t\t\t\t\tcontinue outer;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor (let ii = 0; ii < pathCount; ii++) {\r\n\t\t\t\t\tlet constraint = pathConstraints[ii];\r\n\t\t\t\t\tif (constraint.data.order == i) {\r\n\t\t\t\t\t\tthis.sortPathConstraint(constraint);\r\n\t\t\t\t\t\tcontinue outer;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++)\r\n\t\t\t\tthis.sortBone(bones[i]);\r\n\t\t}\r\n\r\n\t\tsortIkConstraint (constraint: IkConstraint) {\r\n\t\t\tconstraint.active = constraint.target.isActive() && (!constraint.data.skinRequired || (this.skin != null && Utils.contains(this.skin.constraints, constraint.data, true)));\r\n\t\t\tif (!constraint.active) return;\r\n\r\n\t\t\tlet target = constraint.target;\r\n\t\t\tthis.sortBone(target);\r\n\r\n\t\t\tlet constrained = constraint.bones;\r\n\t\t\tlet parent = constrained[0];\r\n\t\t\tthis.sortBone(parent);\r\n\r\n\t\t\tif (constrained.length > 1) {\r\n\t\t\t\tlet child = constrained[constrained.length - 1];\r\n\t\t\t\tif (!(this._updateCache.indexOf(child) > -1)) this.updateCacheReset.push(child);\r\n\t\t\t}\r\n\r\n\t\t\tthis._updateCache.push(constraint);\r\n\r\n\t\t\tthis.sortReset(parent.children);\r\n\t\t\tconstrained[constrained.length - 1].sorted = true;\r\n\t\t}\r\n\r\n\t\tsortPathConstraint (constraint: PathConstraint) {\r\n\t\t\tconstraint.active = constraint.target.bone.isActive() && (!constraint.data.skinRequired || (this.skin != null && Utils.contains(this.skin.constraints, constraint.data, true)));\r\n\t\t\tif (!constraint.active) return;\r\n\r\n\t\t\tlet slot = constraint.target;\r\n\t\t\tlet slotIndex = slot.data.index;\r\n\t\t\tlet slotBone = slot.bone;\r\n\t\t\tif (this.skin != null) this.sortPathConstraintAttachment(this.skin, slotIndex, slotBone);\r\n\t\t\tif (this.data.defaultSkin != null && this.data.defaultSkin != this.skin)\r\n\t\t\t\tthis.sortPathConstraintAttachment(this.data.defaultSkin, slotIndex, slotBone);\r\n\t\t\tfor (let i = 0, n = this.data.skins.length; i < n; i++)\r\n\t\t\t\tthis.sortPathConstraintAttachment(this.data.skins[i], slotIndex, slotBone);\r\n\r\n\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\tif (attachment instanceof PathAttachment) this.sortPathConstraintAttachmentWith(attachment, slotBone);\r\n\r\n\t\t\tlet constrained = constraint.bones;\r\n\t\t\tlet boneCount = constrained.length;\r\n\t\t\tfor (let i = 0; i < boneCount; i++)\r\n\t\t\t\tthis.sortBone(constrained[i]);\r\n\r\n\t\t\tthis._updateCache.push(constraint);\r\n\r\n\t\t\tfor (let i = 0; i < boneCount; i++)\r\n\t\t\t\tthis.sortReset(constrained[i].children);\r\n\t\t\tfor (let i = 0; i < boneCount; i++)\r\n\t\t\t\tconstrained[i].sorted = true;\r\n\t\t}\r\n\r\n\t\tsortTransformConstraint (constraint: TransformConstraint) {\r\n\t\t\tconstraint.active = constraint.target.isActive() && (!constraint.data.skinRequired || (this.skin != null && Utils.contains(this.skin.constraints, constraint.data, true)));\r\n\t\t\tif (!constraint.active) return;\r\n\r\n\t\t\tthis.sortBone(constraint.target);\r\n\r\n\t\t\tlet constrained = constraint.bones;\r\n\t\t\tlet boneCount = constrained.length;\r\n\t\t\tif (constraint.data.local) {\r\n\t\t\t\tfor (let i = 0; i < boneCount; i++) {\r\n\t\t\t\t\tlet child = constrained[i];\r\n\t\t\t\t\tthis.sortBone(child.parent);\r\n\t\t\t\t\tif (!(this._updateCache.indexOf(child) > -1)) this.updateCacheReset.push(child);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (let i = 0; i < boneCount; i++) {\r\n\t\t\t\t\tthis.sortBone(constrained[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._updateCache.push(constraint);\r\n\r\n\t\t\tfor (let ii = 0; ii < boneCount; ii++)\r\n\t\t\t\tthis.sortReset(constrained[ii].children);\r\n\t\t\tfor (let ii = 0; ii < boneCount; ii++)\r\n\t\t\t\tconstrained[ii].sorted = true;\r\n\t\t}\r\n\r\n\t\tsortPathConstraintAttachment (skin: Skin, slotIndex: number, slotBone: Bone) {\r\n\t\t\tlet attachments = skin.attachments[slotIndex];\r\n\t\t\tif (!attachments) return;\r\n\t\t\tfor (let key in attachments) {\r\n\t\t\t\tthis.sortPathConstraintAttachmentWith(attachments[key], slotBone);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsortPathConstraintAttachmentWith (attachment: Attachment, slotBone: Bone) {\r\n\t\t\tif (!(attachment instanceof PathAttachment)) return;\r\n\t\t\tlet pathBones = (<PathAttachment>attachment).bones;\r\n\t\t\tif (pathBones == null)\r\n\t\t\t\tthis.sortBone(slotBone);\r\n\t\t\telse {\r\n\t\t\t\tlet bones = this.bones;\r\n\t\t\t\tlet i = 0;\r\n\t\t\t\twhile (i < pathBones.length) {\r\n\t\t\t\t\tlet boneCount = pathBones[i++];\r\n\t\t\t\t\tfor (let n = i + boneCount; i < n; i++) {\r\n\t\t\t\t\t\tlet boneIndex = pathBones[i];\r\n\t\t\t\t\t\tthis.sortBone(bones[boneIndex]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsortBone (bone: Bone) {\r\n\t\t\tif (bone.sorted) return;\r\n\t\t\tlet parent = bone.parent;\r\n\t\t\tif (parent != null) this.sortBone(parent);\r\n\t\t\tbone.sorted = true;\r\n\t\t\tthis._updateCache.push(bone);\r\n\t\t}\r\n\r\n\t\tsortReset (bones: Array<Bone>) {\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tif (!bone.active) continue;\r\n\t\t\t\tif (bone.sorted) this.sortReset(bone.children);\r\n\t\t\t\tbone.sorted = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Updates the world transform for each bone and applies all constraints.\r\n\t\t *\r\n\t\t * See [World transforms](http://esotericsoftware.com/spine-runtime-skeletons#World-transforms) in the Spine\r\n\t\t * Runtimes Guide. */\r\n\t\tupdateWorldTransform () {\r\n\t\t\tlet updateCacheReset = this.updateCacheReset;\r\n\t\t\tfor (let i = 0, n = updateCacheReset.length; i < n; i++) {\r\n\t\t\t\tlet bone = updateCacheReset[i] as Bone;\r\n\t\t\t\tbone.ax = bone.x;\r\n\t\t\t\tbone.ay = bone.y;\r\n\t\t\t\tbone.arotation = bone.rotation;\r\n\t\t\t\tbone.ascaleX = bone.scaleX;\r\n\t\t\t\tbone.ascaleY = bone.scaleY;\r\n\t\t\t\tbone.ashearX = bone.shearX;\r\n\t\t\t\tbone.ashearY = bone.shearY;\r\n\t\t\t\tbone.appliedValid = true;\r\n\t\t\t}\r\n\t\t\tlet updateCache = this._updateCache;\r\n\t\t\tfor (let i = 0, n = updateCache.length; i < n; i++)\r\n\t\t\t\tupdateCache[i].update();\r\n\t\t}\r\n\r\n\t\t/** Sets the bones, constraints, and slots to their setup pose values. */\r\n\t\tsetToSetupPose () {\r\n\t\t\tthis.setBonesToSetupPose();\r\n\t\t\tthis.setSlotsToSetupPose();\r\n\t\t}\r\n\r\n\t\t/** Sets the bones and constraints to their setup pose values. */\r\n\t\tsetBonesToSetupPose () {\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++)\r\n\t\t\t\tbones[i].setToSetupPose();\r\n\r\n\t\t\tlet ikConstraints = this.ikConstraints;\r\n\t\t\tfor (let i = 0, n = ikConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = ikConstraints[i];\r\n\t\t\t\tconstraint.mix = constraint.data.mix;\r\n\t\t\t\tconstraint.softness = constraint.data.softness;\r\n\t\t\t\tconstraint.bendDirection = constraint.data.bendDirection;\r\n\t\t\t\tconstraint.compress = constraint.data.compress;\r\n\t\t\t\tconstraint.stretch = constraint.data.stretch;\r\n\t\t\t}\r\n\r\n\t\t\tlet transformConstraints = this.transformConstraints;\r\n\t\t\tfor (let i = 0, n = transformConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = transformConstraints[i];\r\n\t\t\t\tlet data = constraint.data;\r\n\t\t\t\tconstraint.rotateMix = data.rotateMix;\r\n\t\t\t\tconstraint.translateMix = data.translateMix;\r\n\t\t\t\tconstraint.scaleMix = data.scaleMix;\r\n\t\t\t\tconstraint.shearMix = data.shearMix;\r\n\t\t\t}\r\n\r\n\t\t\tlet pathConstraints = this.pathConstraints;\r\n\t\t\tfor (let i = 0, n = pathConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = pathConstraints[i];\r\n\t\t\t\tlet data = constraint.data;\r\n\t\t\t\tconstraint.position = data.position;\r\n\t\t\t\tconstraint.spacing = data.spacing;\r\n\t\t\t\tconstraint.rotateMix = data.rotateMix;\r\n\t\t\t\tconstraint.translateMix = data.translateMix;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Sets the slots and draw order to their setup pose values. */\r\n\t\tsetSlotsToSetupPose () {\r\n\t\t\tlet slots = this.slots;\r\n\t\t\tUtils.arrayCopy(slots, 0, this.drawOrder, 0, slots.length);\r\n\t\t\tfor (let i = 0, n = slots.length; i < n; i++)\r\n\t\t\t\tslots[i].setToSetupPose();\r\n\t\t}\r\n\r\n\t\t/** @returns May return null. */\r\n\t\tgetRootBone () {\r\n\t\t\tif (this.bones.length == 0) return null;\r\n\t\t\treturn this.bones[0];\r\n\t\t}\r\n\r\n\t\t/** @returns May be null. */\r\n\t\tfindBone (boneName: string) {\r\n\t\t\tif (boneName == null) throw new Error(\"boneName cannot be null.\");\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tif (bone.data.name == boneName) return bone;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** @returns -1 if the bone was not found. */\r\n\t\tfindBoneIndex (boneName: string) {\r\n\t\t\tif (boneName == null) throw new Error(\"boneName cannot be null.\");\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++)\r\n\t\t\t\tif (bones[i].data.name == boneName) return i;\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\t/** Finds a slot by comparing each slot's name. It is more efficient to cache the results of this method than to call it\r\n\t\t * repeatedly.\r\n\t\t * @returns May be null. */\r\n\t\tfindSlot (slotName: string) {\r\n\t\t\tif (slotName == null) throw new Error(\"slotName cannot be null.\");\r\n\t\t\tlet slots = this.slots;\r\n\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\tlet slot = slots[i];\r\n\t\t\t\tif (slot.data.name == slotName) return slot;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** @returns -1 if the bone was not found. */\r\n\t\tfindSlotIndex (slotName: string) {\r\n\t\t\tif (slotName == null) throw new Error(\"slotName cannot be null.\");\r\n\t\t\tlet slots = this.slots;\r\n\t\t\tfor (let i = 0, n = slots.length; i < n; i++)\r\n\t\t\t\tif (slots[i].data.name == slotName) return i;\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\t/** Sets a skin by name.\r\n\t\t *\r\n\t\t * See {@link #setSkin()}. */\r\n\t\tsetSkinByName (skinName: string) {\r\n\t\t\tlet skin = this.data.findSkin(skinName);\r\n\t\t\tif (skin == null) throw new Error(\"Skin not found: \" + skinName);\r\n\t\t\tthis.setSkin(skin);\r\n\t\t}\r\n\r\n\t\t/** Sets the skin used to look up attachments before looking in the {@link SkeletonData#defaultSkin default skin}. If the\r\n\t\t * skin is changed, {@link #updateCache()} is called.\r\n\t\t *\r\n\t\t * Attachments from the new skin are attached if the corresponding attachment from the old skin was attached. If there was no\r\n\t\t * old skin, each slot's setup mode attachment is attached from the new skin.\r\n\t\t *\r\n\t\t * After changing the skin, the visible attachments can be reset to those attached in the setup pose by calling\r\n\t\t * {@link #setSlotsToSetupPose()}. Also, often {@link AnimationState#apply()} is called before the next time the\r\n\t\t * skeleton is rendered to allow any attachment keys in the current animation(s) to hide or show attachments from the new skin.\r\n\t\t * @param newSkin May be null. */\r\n\t\tsetSkin (newSkin: Skin) {\r\n\t\t\tif (newSkin == this.skin) return;\r\n\t\t\tif (newSkin != null) {\r\n\t\t\t\tif (this.skin != null)\r\n\t\t\t\t\tnewSkin.attachAll(this, this.skin);\r\n\t\t\t\telse {\r\n\t\t\t\t\tlet slots = this.slots;\r\n\t\t\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\t\t\tlet slot = slots[i];\r\n\t\t\t\t\t\tlet name = slot.data.attachmentName;\r\n\t\t\t\t\t\tif (name != null) {\r\n\t\t\t\t\t\t\tlet attachment: Attachment = newSkin.getAttachment(i, name);\r\n\t\t\t\t\t\t\tif (attachment != null) slot.setAttachment(attachment);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.skin = newSkin;\r\n\t\t\tthis.updateCache();\r\n\t\t}\r\n\r\n\r\n\t\t/** Finds an attachment by looking in the {@link #skin} and {@link SkeletonData#defaultSkin} using the slot name and attachment\r\n\t\t * name.\r\n\t\t *\r\n\t\t * See {@link #getAttachment()}.\r\n\t\t * @returns May be null. */\r\n\t\tgetAttachmentByName (slotName: string, attachmentName: string): Attachment {\r\n\t\t\treturn this.getAttachment(this.data.findSlotIndex(slotName), attachmentName);\r\n\t\t}\r\n\r\n\t\t/** Finds an attachment by looking in the {@link #skin} and {@link SkeletonData#defaultSkin} using the slot index and\r\n\t\t * attachment name. First the skin is checked and if the attachment was not found, the default skin is checked.\r\n\t\t *\r\n\t\t * See [Runtime skins](http://esotericsoftware.com/spine-runtime-skins) in the Spine Runtimes Guide.\r\n\t\t * @returns May be null. */\r\n\t\tgetAttachment (slotIndex: number, attachmentName: string): Attachment {\r\n\t\t\tif (attachmentName == null) throw new Error(\"attachmentName cannot be null.\");\r\n\t\t\tif (this.skin != null) {\r\n\t\t\t\tlet attachment: Attachment = this.skin.getAttachment(slotIndex, attachmentName);\r\n\t\t\t\tif (attachment != null) return attachment;\r\n\t\t\t}\r\n\t\t\tif (this.data.defaultSkin != null) return this.data.defaultSkin.getAttachment(slotIndex, attachmentName);\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** A convenience method to set an attachment by finding the slot with {@link #findSlot()}, finding the attachment with\r\n\t\t * {@link #getAttachment()}, then setting the slot's {@link Slot#attachment}.\r\n\t\t * @param attachmentName May be null to clear the slot's attachment. */\r\n\t\tsetAttachment (slotName: string, attachmentName: string) {\r\n\t\t\tif (slotName == null) throw new Error(\"slotName cannot be null.\");\r\n\t\t\tlet slots = this.slots;\r\n\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\tlet slot = slots[i];\r\n\t\t\t\tif (slot.data.name == slotName) {\r\n\t\t\t\t\tlet attachment: Attachment = null;\r\n\t\t\t\t\tif (attachmentName != null) {\r\n\t\t\t\t\t\tattachment = this.getAttachment(i, attachmentName);\r\n\t\t\t\t\t\tif (attachment == null)\r\n\t\t\t\t\t\t\tthrow new Error(\"Attachment not found: \" + attachmentName + \", for slot: \" + slotName);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tslot.setAttachment(attachment);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthrow new Error(\"Slot not found: \" + slotName);\r\n\t\t}\r\n\r\n\r\n\t\t/** Finds an IK constraint by comparing each IK constraint's name. It is more efficient to cache the results of this method\r\n\t\t * than to call it repeatedly.\r\n\t\t * @return May be null. */\r\n\t\tfindIkConstraint (constraintName: string) {\r\n\t\t\tif (constraintName == null) throw new Error(\"constraintName cannot be null.\");\r\n\t\t\tlet ikConstraints = this.ikConstraints;\r\n\t\t\tfor (let i = 0, n = ikConstraints.length; i < n; i++) {\r\n\t\t\t\tlet ikConstraint = ikConstraints[i];\r\n\t\t\t\tif (ikConstraint.data.name == constraintName) return ikConstraint;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds a transform constraint by comparing each transform constraint's name. It is more efficient to cache the results of\r\n\t\t * this method than to call it repeatedly.\r\n\t\t * @return May be null. */\r\n\t\tfindTransformConstraint (constraintName: string) {\r\n\t\t\tif (constraintName == null) throw new Error(\"constraintName cannot be null.\");\r\n\t\t\tlet transformConstraints = this.transformConstraints;\r\n\t\t\tfor (let i = 0, n = transformConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = transformConstraints[i];\r\n\t\t\t\tif (constraint.data.name == constraintName) return constraint;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds a path constraint by comparing each path constraint's name. It is more efficient to cache the results of this method\r\n\t\t * than to call it repeatedly.\r\n\t\t * @return May be null. */\r\n\t\tfindPathConstraint (constraintName: string) {\r\n\t\t\tif (constraintName == null) throw new Error(\"constraintName cannot be null.\");\r\n\t\t\tlet pathConstraints = this.pathConstraints;\r\n\t\t\tfor (let i = 0, n = pathConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = pathConstraints[i];\r\n\t\t\t\tif (constraint.data.name == constraintName) return constraint;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Returns the axis aligned bounding box (AABB) of the region and mesh attachments for the current pose.\r\n\t\t * @param offset An output value, the distance from the skeleton origin to the bottom left corner of the AABB.\r\n\t\t * @param size An output value, the width and height of the AABB.\r\n\t\t * @param temp Working memory to temporarily store attachments' computed world vertices. */\r\n\t\tgetBounds (offset: Vector2, size: Vector2, temp: Array<number> = new Array<number>(2)) {\r\n\t\t\tif (offset == null) throw new Error(\"offset cannot be null.\");\r\n\t\t\tif (size == null) throw new Error(\"size cannot be null.\");\r\n\t\t\tlet drawOrder = this.drawOrder;\r\n\t\t\tlet minX = Number.POSITIVE_INFINITY, minY = Number.POSITIVE_INFINITY, maxX = Number.NEGATIVE_INFINITY, maxY = Number.NEGATIVE_INFINITY;\r\n\t\t\tfor (let i = 0, n = drawOrder.length; i < n; i++) {\r\n\t\t\t\tlet slot = drawOrder[i];\r\n\t\t\t\tif (!slot.bone.active) continue;\r\n\t\t\t\tlet verticesLength = 0;\r\n\t\t\t\tlet vertices: ArrayLike<number> = null;\r\n\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\tif (attachment instanceof RegionAttachment) {\r\n\t\t\t\t\tverticesLength = 8;\r\n\t\t\t\t\tvertices = Utils.setArraySize(temp, verticesLength, 0);\r\n\t\t\t\t\t(<RegionAttachment>attachment).computeWorldVertices(slot.bone, vertices, 0, 2);\r\n\t\t\t\t} else if (attachment instanceof MeshAttachment) {\r\n\t\t\t\t\tlet mesh = (<MeshAttachment>attachment);\r\n\t\t\t\t\tverticesLength = mesh.worldVerticesLength;\r\n\t\t\t\t\tvertices = Utils.setArraySize(temp, verticesLength, 0);\r\n\t\t\t\t\tmesh.computeWorldVertices(slot, 0, verticesLength, vertices, 0, 2);\r\n\t\t\t\t}\r\n\t\t\t\tif (vertices != null) {\r\n\t\t\t\t\tfor (let ii = 0, nn = vertices.length; ii < nn; ii += 2) {\r\n\t\t\t\t\t\tlet x = vertices[ii], y = vertices[ii + 1];\r\n\t\t\t\t\t\tminX = Math.min(minX, x);\r\n\t\t\t\t\t\tminY = Math.min(minY, y);\r\n\t\t\t\t\t\tmaxX = Math.max(maxX, x);\r\n\t\t\t\t\t\tmaxY = Math.max(maxY, y);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\toffset.set(minX, minY);\r\n\t\t\tsize.set(maxX - minX, maxY - minY);\r\n\t\t}\r\n\r\n\t\t/** Increments the skeleton's {@link #time}. */\r\n\t\tupdate (delta: number) {\r\n\t\t\tthis.time += delta;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\n// module spine {\r\n\texport enum AttachmentType {\r\n\t\tRegion, BoundingBox, Mesh, LinkedMesh, Path, Point, Clipping\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { EventData } from \"./EventData\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the current pose values for an {@link Event}.\r\n\t *\r\n\t * See Timeline {@link Timeline#apply()},\r\n\t * AnimationStateListener {@link AnimationStateListener#event()}, and\r\n\t * [Events](http://esotericsoftware.com/spine-events) in the Spine User Guide. */\r\n\texport class Event {\r\n\t\tdata: EventData;\r\n\t\tintValue: number;\r\n\t\tfloatValue: number;\r\n\t\tstringValue: string;\r\n\t\ttime: number;\r\n\t\tvolume: number;\r\n\t\tbalance: number;\r\n\r\n\t\tconstructor (time: number, data: EventData) {\r\n\t\t\tif (data == null) throw new Error(\"data cannot be null.\");\r\n\t\t\tthis.time = time;\r\n\t\t\tthis.data = data;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\n// module spine {\r\n\t/** Stores the setup pose values for an {@link Event}.\r\n\t *\r\n\t * See [Events](http://esotericsoftware.com/spine-events) in the Spine User Guide. */\r\n\texport class EventData {\r\n\t\tname: string;\r\n\t\tintValue: number;\r\n\t\tfloatValue: number;\r\n\t\tstringValue: string;\r\n\t\taudioPath: string;\r\n\t\tvolume: number;\r\n\t\tbalance: number;\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tthis.name = name;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BoneData } from \"./BoneData\";\r\nimport { ConstraintData } from \"./ConstraintData\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the setup pose for an {@link IkConstraint}.\r\n\t * <p>\r\n\t * See [IK constraints](http://esotericsoftware.com/spine-ik-constraints) in the Spine User Guide. */\r\n\texport class IkConstraintData extends ConstraintData {\r\n\t\t/** The bones that are constrained by this IK constraint. */\r\n\t\tbones = new Array<BoneData>();\r\n\r\n\t\t/** The bone that is the IK target. */\r\n\t\ttarget: BoneData;\r\n\r\n\t\t/** Controls the bend direction of the IK bones, either 1 or -1. */\r\n\t\tbendDirection = 1;\r\n\r\n\t\t/** When true and only a single bone is being constrained, if the target is too close, the bone is scaled to reach it. */\r\n\t\tcompress = false;\r\n\r\n\t\t/** When true, if the target is out of range, the parent bone is scaled to reach it. If more than one bone is being constrained\r\n\t\t * and the parent bone has local nonuniform scale, stretch is not applied. */\r\n\t\tstretch = false;\r\n\r\n\t\t/** When true, only a single bone is being constrained, and {@link #getCompress()} or {@link #getStretch()} is used, the bone\r\n\t\t * is scaled on both the X and Y axes. */\r\n\t\tuniform = false;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained rotations. */\r\n\t\tmix = 1;\r\n\r\n\t\t/** For two bone IK, the distance from the maximum reach of the bones that rotation will slow. */\r\n\t\tsoftness = 0;\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name, 0, false);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BoneData } from \"./BoneData\";\r\nimport { EventData } from \"./EventData\";\r\nimport { IkConstraintData } from \"./IkConstraintData\";\r\nimport { PathConstraintData } from \"./PathConstraintData\";\r\nimport { Skin } from \"./Skin\";\r\nimport { SlotData } from \"./SlotData\";\r\nimport {Animation } from \"./Animation\";\r\nimport { TransformConstraintData } from \"./TransformConstraintData\";\r\n\r\n// module spine {\r\n\t/** Stores the setup pose and all of the stateless data for a skeleton.\r\n\t *\r\n\t * See [Data objects](http://esotericsoftware.com/spine-runtime-architecture#Data-objects) in the Spine Runtimes\r\n\t * Guide. */\r\n\texport class SkeletonData {\r\n\r\n\t\t/** The skeleton's name, which by default is the name of the skeleton data file, if possible. May be null. */\r\n\t\tname: string;\r\n\r\n\t\t/** The skeleton's bones, sorted parent first. The root bone is always the first bone. */\r\n\t\tbones = new Array<BoneData>(); // Ordered parents first.\r\n\r\n\t\t/** The skeleton's slots. */\r\n\t\tslots = new Array<SlotData>(); // Setup pose draw order.\r\n\t\tskins = new Array<Skin>();\r\n\r\n\t\t/** The skeleton's default skin. By default this skin contains all attachments that were not in a skin in Spine.\r\n\t\t *\r\n\t\t * See {@link Skeleton#getAttachmentByName()}.\r\n\t\t * May be null. */\r\n\t\tdefaultSkin: Skin;\r\n\r\n\t\t/** The skeleton's events. */\r\n\t\tevents = new Array<EventData>();\r\n\r\n\t\t/** The skeleton's animations. */\r\n\t\tanimations = new Array<Animation>();\r\n\r\n\t\t/** The skeleton's IK constraints. */\r\n\t\tikConstraints = new Array<IkConstraintData>();\r\n\r\n\t\t/** The skeleton's transform constraints. */\r\n\t\ttransformConstraints = new Array<TransformConstraintData>();\r\n\r\n\t\t/** The skeleton's path constraints. */\r\n\t\tpathConstraints = new Array<PathConstraintData>();\r\n\r\n\t\t/** The X coordinate of the skeleton's axis aligned bounding box in the setup pose. */\r\n\t\tx: number;\r\n\r\n\t\t/** The Y coordinate of the skeleton's axis aligned bounding box in the setup pose. */\r\n\t\ty: number;\r\n\r\n\t\t/** The width of the skeleton's axis aligned bounding box in the setup pose. */\r\n\t\twidth: number;\r\n\r\n\t\t/** The height of the skeleton's axis aligned bounding box in the setup pose. */\r\n\t\theight: number;\r\n\r\n\t\t/** The Spine version used to export the skeleton data, or null. */\r\n\t\tversion: string;\r\n\r\n\t\t/** The skeleton data hash. This value will change if any of the skeleton data has changed. May be null. */\r\n\t\thash: string;\r\n\r\n\t\t// Nonessential\r\n\t\t/** The dopesheet FPS in Spine. Available only when nonessential data was exported. */\r\n\t\tfps = 0;\r\n\r\n\t\t/** The path to the images directory as defined in Spine. Available only when nonessential data was exported. May be null. */\r\n\t\timagesPath: string;\r\n\r\n\t\t/** The path to the audio directory as defined in Spine. Available only when nonessential data was exported. May be null. */\r\n\t\taudioPath: string;\r\n\r\n\t\t/** Finds a bone by comparing each bone's name. It is more efficient to cache the results of this method than to call it\r\n\t\t * multiple times.\r\n\t\t * @returns May be null. */\r\n\t\tfindBone (boneName: string) {\r\n\t\t\tif (boneName == null) throw new Error(\"boneName cannot be null.\");\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\tlet bone = bones[i];\r\n\t\t\t\tif (bone.name == boneName) return bone;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfindBoneIndex (boneName: string) {\r\n\t\t\tif (boneName == null) throw new Error(\"boneName cannot be null.\");\r\n\t\t\tlet bones = this.bones;\r\n\t\t\tfor (let i = 0, n = bones.length; i < n; i++)\r\n\t\t\t\tif (bones[i].name == boneName) return i;\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\t/** Finds a slot by comparing each slot's name. It is more efficient to cache the results of this method than to call it\r\n\t\t * multiple times.\r\n\t\t * @returns May be null. */\r\n\t\tfindSlot (slotName: string) {\r\n\t\t\tif (slotName == null) throw new Error(\"slotName cannot be null.\");\r\n\t\t\tlet slots = this.slots;\r\n\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\tlet slot = slots[i];\r\n\t\t\t\tif (slot.name == slotName) return slot;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfindSlotIndex (slotName: string) {\r\n\t\t\tif (slotName == null) throw new Error(\"slotName cannot be null.\");\r\n\t\t\tlet slots = this.slots;\r\n\t\t\tfor (let i = 0, n = slots.length; i < n; i++)\r\n\t\t\t\tif (slots[i].name == slotName) return i;\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\t/** Finds a skin by comparing each skin's name. It is more efficient to cache the results of this method than to call it\r\n\t\t * multiple times.\r\n\t\t * @returns May be null. */\r\n\t\tfindSkin (skinName: string) {\r\n\t\t\tif (skinName == null) throw new Error(\"skinName cannot be null.\");\r\n\t\t\tlet skins = this.skins;\r\n\t\t\tfor (let i = 0, n = skins.length; i < n; i++) {\r\n\t\t\t\tlet skin = skins[i];\r\n\t\t\t\tif (skin.name == skinName) return skin;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds an event by comparing each events's name. It is more efficient to cache the results of this method than to call it\r\n\t\t * multiple times.\r\n\t\t * @returns May be null. */\r\n\t\tfindEvent (eventDataName: string) {\r\n\t\t\tif (eventDataName == null) throw new Error(\"eventDataName cannot be null.\");\r\n\t\t\tlet events = this.events;\r\n\t\t\tfor (let i = 0, n = events.length; i < n; i++) {\r\n\t\t\t\tlet event = events[i];\r\n\t\t\t\tif (event.name == eventDataName) return event;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds an animation by comparing each animation's name. It is more efficient to cache the results of this method than to\r\n\t\t * call it multiple times.\r\n\t\t * @returns May be null. */\r\n\t\tfindAnimation (animationName: string) {\r\n\t\t\tif (animationName == null) throw new Error(\"animationName cannot be null.\");\r\n\t\t\tlet animations = this.animations;\r\n\t\t\tfor (let i = 0, n = animations.length; i < n; i++) {\r\n\t\t\t\tlet animation = animations[i];\r\n\t\t\t\tif (animation.name == animationName) return animation;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds an IK constraint by comparing each IK constraint's name. It is more efficient to cache the results of this method\r\n\t\t * than to call it multiple times.\r\n\t\t * @return May be null. */\r\n\t\tfindIkConstraint (constraintName: string) {\r\n\t\t\tif (constraintName == null) throw new Error(\"constraintName cannot be null.\");\r\n\t\t\tlet ikConstraints = this.ikConstraints;\r\n\t\t\tfor (let i = 0, n = ikConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = ikConstraints[i];\r\n\t\t\t\tif (constraint.name == constraintName) return constraint;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds a transform constraint by comparing each transform constraint's name. It is more efficient to cache the results of\r\n\t\t * this method than to call it multiple times.\r\n\t\t * @return May be null. */\r\n\t\tfindTransformConstraint (constraintName: string) {\r\n\t\t\tif (constraintName == null) throw new Error(\"constraintName cannot be null.\");\r\n\t\t\tlet transformConstraints = this.transformConstraints;\r\n\t\t\tfor (let i = 0, n = transformConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = transformConstraints[i];\r\n\t\t\t\tif (constraint.name == constraintName) return constraint;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Finds a path constraint by comparing each path constraint's name. It is more efficient to cache the results of this method\r\n\t\t * than to call it multiple times.\r\n\t\t * @return May be null. */\r\n\t\tfindPathConstraint (constraintName: string) {\r\n\t\t\tif (constraintName == null) throw new Error(\"constraintName cannot be null.\");\r\n\t\t\tlet pathConstraints = this.pathConstraints;\r\n\t\t\tfor (let i = 0, n = pathConstraints.length; i < n; i++) {\r\n\t\t\t\tlet constraint = pathConstraints[i];\r\n\t\t\t\tif (constraint.name == constraintName) return constraint;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfindPathConstraintIndex (pathConstraintName: string) {\r\n\t\t\tif (pathConstraintName == null) throw new Error(\"pathConstraintName cannot be null.\");\r\n\t\t\tlet pathConstraints = this.pathConstraints;\r\n\t\t\tfor (let i = 0, n = pathConstraints.length; i < n; i++)\r\n\t\t\t\tif (pathConstraints[i].name == pathConstraintName) return i;\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Attachment } from \"./attachments/Attachment\";\r\nimport { MeshAttachment } from \"./attachments/MeshAttachment\";\r\nimport { BoneData } from \"./BoneData\";\r\nimport { ConstraintData } from \"./ConstraintData\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Map } from \"./Utils\";\r\n\r\n// module spine {\r\n\t/** Stores an entry in the skin consisting of the slot index, name, and attachment **/\r\n\texport class SkinEntry {\r\n\t\tconstructor(public slotIndex: number, public name: string, public attachment: Attachment) { }\r\n\t}\r\n\r\n\t/** Stores attachments by slot index and attachment name.\r\n\t *\r\n\t * See SkeletonData {@link SkeletonData#defaultSkin}, Skeleton {@link Skeleton#skin}, and\r\n\t * [Runtime skins](http://esotericsoftware.com/spine-runtime-skins) in the Spine Runtimes Guide. */\r\n\texport class Skin {\r\n\t\t/** The skin's name, which is unique across all skins in the skeleton. */\r\n\t\tname: string;\r\n\r\n\t\tattachments = new Array<Map<Attachment>>();\r\n\t\tbones = Array<BoneData>();\r\n\t\tconstraints = new Array<ConstraintData>();\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tif (name == null) throw new Error(\"name cannot be null.\");\r\n\t\t\tthis.name = name;\r\n\t\t}\r\n\r\n\t\t/** Adds an attachment to the skin for the specified slot index and name. */\r\n\t\tsetAttachment (slotIndex: number, name: string, attachment: Attachment) {\r\n\t\t\tif (attachment == null) throw new Error(\"attachment cannot be null.\");\r\n\t\t\tlet attachments = this.attachments;\r\n\t\t\tif (slotIndex >= attachments.length) attachments.length = slotIndex + 1;\r\n\t\t\tif (!attachments[slotIndex]) attachments[slotIndex] = { };\r\n\t\t\tattachments[slotIndex][name] = attachment;\r\n\t\t}\r\n\r\n\t\t/** Adds all attachments, bones, and constraints from the specified skin to this skin. */\r\n\t\taddSkin (skin: Skin) {\r\n\t\t\tfor(let i = 0; i < skin.bones.length; i++) {\r\n\t\t\t\tlet bone = skin.bones[i];\r\n\t\t\t\tlet contained = false;\r\n\t\t\t\tfor (let j = 0; j < this.bones.length; j++) {\r\n\t\t\t\t\tif (this.bones[j] == bone) {\r\n\t\t\t\t\t\tcontained = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!contained) this.bones.push(bone);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < skin.constraints.length; i++) {\r\n\t\t\t\tlet constraint = skin.constraints[i];\r\n\t\t\t\tlet contained = false;\r\n\t\t\t\tfor (let j = 0; j < this.constraints.length; j++) {\r\n\t\t\t\t\tif (this.constraints[j] == constraint) {\r\n\t\t\t\t\t\tcontained = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!contained) this.constraints.push(constraint);\r\n\t\t\t}\r\n\r\n\t\t\tlet attachments = skin.getAttachments();\r\n\t\t\tfor (let i = 0; i < attachments.length; i++) {\r\n\t\t\t\tvar attachment = attachments[i];\r\n\t\t\t\tthis.setAttachment(attachment.slotIndex, attachment.name, attachment.attachment);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Adds all bones and constraints and copies of all attachments from the specified skin to this skin. Mesh attachments are not\r\n\t\t * copied, instead a new linked mesh is created. The attachment copies can be modified without affecting the originals. */\r\n\t\tcopySkin (skin: Skin) {\r\n\t\t\tfor(let i = 0; i < skin.bones.length; i++) {\r\n\t\t\t\tlet bone = skin.bones[i];\r\n\t\t\t\tlet contained = false;\r\n\t\t\t\tfor (let j = 0; j < this.bones.length; j++) {\r\n\t\t\t\t\tif (this.bones[j] == bone) {\r\n\t\t\t\t\t\tcontained = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!contained) this.bones.push(bone);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < skin.constraints.length; i++) {\r\n\t\t\t\tlet constraint = skin.constraints[i];\r\n\t\t\t\tlet contained = false;\r\n\t\t\t\tfor (let j = 0; j < this.constraints.length; j++) {\r\n\t\t\t\t\tif (this.constraints[j] == constraint) {\r\n\t\t\t\t\t\tcontained = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!contained) this.constraints.push(constraint);\r\n\t\t\t}\r\n\r\n\t\t\tlet attachments = skin.getAttachments();\r\n\t\t\tfor (let i = 0; i < attachments.length; i++) {\r\n\t\t\t\tvar attachment = attachments[i];\r\n\t\t\t\tif (attachment.attachment == null) continue;\r\n\t\t\t\tif (attachment.attachment instanceof MeshAttachment) {\r\n\t\t\t\t\tattachment.attachment = attachment.attachment.newLinkedMesh();\r\n\t\t\t\t\tthis.setAttachment(attachment.slotIndex, attachment.name, attachment.attachment);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tattachment.attachment = attachment.attachment.copy();\r\n\t\t\t\t\tthis.setAttachment(attachment.slotIndex, attachment.name, attachment.attachment);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Returns the attachment for the specified slot index and name, or null. */\r\n\t\tgetAttachment (slotIndex: number, name: string): Attachment {\r\n\t\t\tlet dictionary = this.attachments[slotIndex];\r\n\t\t\treturn dictionary ? dictionary[name] : null;\r\n\t\t}\r\n\r\n\t\t/** Removes the attachment in the skin for the specified slot index and name, if any. */\r\n\t\tremoveAttachment (slotIndex: number, name: string) {\r\n\t\t\tlet dictionary = this.attachments[slotIndex];\r\n\t\t\tif (dictionary) dictionary[name] = null;\r\n\t\t}\r\n\r\n\t\t/** Returns all attachments in this skin. */\r\n\t\tgetAttachments (): Array<SkinEntry> {\r\n\t\t\tlet entries = new Array<SkinEntry>();\r\n\t\t\tfor (var i = 0; i < this.attachments.length; i++) {\r\n\t\t\t\tlet slotAttachments = this.attachments[i];\r\n\t\t\t\tif (slotAttachments) {\r\n\t\t\t\t\tfor (let name in slotAttachments) {\r\n\t\t\t\t\t\tlet attachment = slotAttachments[name];\r\n\t\t\t\t\t\tif (attachment) entries.push(new SkinEntry(i, name, attachment));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn entries;\r\n\t\t}\r\n\r\n\t\t/** Returns all attachments in this skin for the specified slot index. */\r\n\t\tgetAttachmentsForSlot (slotIndex: number, attachments: Array<SkinEntry>) {\r\n\t\t\tlet slotAttachments = this.attachments[slotIndex];\r\n\t\t\tif (slotAttachments) {\r\n\t\t\t\tfor (let name in slotAttachments) {\r\n\t\t\t\t\tlet attachment = slotAttachments[name];\r\n\t\t\t\t\tif (attachment) attachments.push(new SkinEntry(slotIndex, name, attachment));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Clears all attachments, bones, and constraints. */\r\n\t\tclear () {\r\n\t\t\tthis.attachments.length = 0;\r\n\t\t\tthis.bones.length = 0;\r\n\t\t\tthis.constraints.length = 0;\r\n\t\t}\r\n\r\n\t\t/** Attach each attachment in this skin if the corresponding attachment in the old skin is currently attached. */\r\n\t\tattachAll (skeleton: Skeleton, oldSkin: Skin) {\r\n\t\t\tlet slotIndex = 0;\r\n\t\t\tfor (let i = 0; i < skeleton.slots.length; i++) {\r\n\t\t\t\tlet slot = skeleton.slots[i];\r\n\t\t\t\tlet slotAttachment = slot.getAttachment();\r\n\t\t\t\tif (slotAttachment && slotIndex < oldSkin.attachments.length) {\r\n\t\t\t\t\tlet dictionary = oldSkin.attachments[slotIndex];\r\n\t\t\t\t\tfor (let key in dictionary) {\r\n\t\t\t\t\t\tlet skinAttachment:Attachment = dictionary[key];\r\n\t\t\t\t\t\tif (slotAttachment == skinAttachment) {\r\n\t\t\t\t\t\t\tlet attachment = this.getAttachment(slotIndex, key);\r\n\t\t\t\t\t\t\tif (attachment != null) slot.setAttachment(attachment);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tslotIndex++;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BlendMode } from \"./BlendMode\";\r\nimport { BoneData } from \"./BoneData\";\r\nimport { Color } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the setup pose for a {@link Slot}. */\r\n\texport class SlotData {\r\n\r\n\t\t/** The index of the slot in {@link Skeleton#getSlots()}. */\r\n\t\tindex: number;\r\n\r\n\t\t/** The name of the slot, which is unique across all slots in the skeleton. */\r\n\t\tname: string;\r\n\r\n\t\t/** The bone this slot belongs to. */\r\n\t\tboneData: BoneData;\r\n\r\n\t\t/** The color used to tint the slot's attachment. If {@link #getDarkColor()} is set, this is used as the light color for two\r\n\t\t * color tinting. */\r\n\t\tcolor = new Color(1, 1, 1, 1);\r\n\r\n\t\t/** The dark color used to tint the slot's attachment for two color tinting, or null if two color tinting is not used. The dark\r\n\t\t * color's alpha is not used. */\r\n\t\tdarkColor: Color;\r\n\r\n\t\t/** The name of the attachment that is visible for this slot in the setup pose, or null if no attachment is visible. */\r\n\t\tattachmentName: string;\r\n\r\n\t\t/** The blend mode for drawing the slot's attachment. */\r\n\t\tblendMode: BlendMode;\r\n\r\n\t\tconstructor (index: number, name: string, boneData: BoneData) {\r\n\t\t\tif (index < 0) throw new Error(\"index must be >= 0.\");\r\n\t\t\tif (name == null) throw new Error(\"name cannot be null.\");\r\n\t\t\tif (boneData == null) throw new Error(\"boneData cannot be null.\");\r\n\t\t\tthis.index = index;\r\n\t\t\tthis.name = name;\r\n\t\t\tthis.boneData = boneData;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BoneData } from \"./BoneData\";\r\nimport { ConstraintData } from \"./ConstraintData\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores the setup pose for a {@link TransformConstraint}.\r\n\t *\r\n\t * See [Transform constraints](http://esotericsoftware.com/spine-transform-constraints) in the Spine User Guide. */\r\n\texport class TransformConstraintData extends ConstraintData {\r\n\r\n\t\t/** The bones that will be modified by this transform constraint. */\r\n\t\tbones = new Array<BoneData>();\r\n\r\n\t\t/** The target bone whose world transform will be copied to the constrained bones. */\r\n\t\ttarget: BoneData;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained rotations. */\r\n\t\trotateMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained translations. */\r\n\t\ttranslateMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained scales. */\r\n\t\tscaleMix = 0;\r\n\r\n\t\t/** A percentage (0-1) that controls the mix between the constrained and unconstrained shears. */\r\n\t\tshearMix = 0;\r\n\r\n\t\t/** An offset added to the constrained bone rotation. */\r\n\t\toffsetRotation = 0;\r\n\r\n\t\t/** An offset added to the constrained bone X translation. */\r\n\t\toffsetX = 0;\r\n\r\n\t\t/** An offset added to the constrained bone Y translation. */\r\n\t\toffsetY = 0;\r\n\r\n\t\t/** An offset added to the constrained bone scaleX. */\r\n\t\toffsetScaleX = 0;\r\n\r\n\t\t/** An offset added to the constrained bone scaleY. */\r\n\t\toffsetScaleY = 0;\r\n\r\n\t\t/** An offset added to the constrained bone shearY. */\r\n\t\toffsetShearY = 0;\r\n\r\n\t\trelative = false;\r\n\t\tlocal = false;\r\n\r\n\t\tconstructor (name: string) {\r\n\t\t\tsuper(name, 0, false);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Timeline, AttachmentTimeline, ColorTimeline, TwoColorTimeline, RotateTimeline, ScaleTimeline, ShearTimeline, TranslateTimeline, IkConstraintTimeline, TransformConstraintTimeline, PathConstraintSpacingTimeline, PathConstraintPositionTimeline, PathConstraintMixTimeline, DeformTimeline, DrawOrderTimeline, EventTimeline, CurveTimeline } from \"./Animation\";\r\nimport { VertexAttachment, Attachment } from \"./attachments/Attachment\";\r\nimport { AttachmentLoader } from \"./attachments/AttachmentLoader\";\r\nimport { AttachmentType } from \"./attachments/AttachmentType\";\r\nimport { MeshAttachment } from \"./attachments/MeshAttachment\";\r\nimport {Animation} from \"./Animation\";\r\nimport { BlendMode } from \"./BlendMode\";\r\nimport { TransformMode, BoneData } from \"./BoneData\";\r\nimport {Event } from \"./Event\";\r\nimport { EventData } from \"./EventData\";\r\nimport { IkConstraintData } from \"./IkConstraintData\";\r\nimport { PositionMode, SpacingMode, RotateMode, PathConstraintData } from \"./PathConstraintData\";\r\nimport { SkeletonData } from \"./SkeletonData\";\r\nimport { Skin } from \"./Skin\";\r\nimport { SlotData } from \"./SlotData\";\r\nimport { TransformConstraintData } from \"./TransformConstraintData\";\r\nimport { Color, Utils } from \"./Utils\";\r\n\r\n// module spine {\r\n\t/** Loads skeleton data in the Spine binary format.\r\n\t *\r\n\t * See [Spine binary format](http://esotericsoftware.com/spine-binary-format) and\r\n\t * [JSON and binary data](http://esotericsoftware.com/spine-loading-skeleton-data#JSON-and-binary-data) in the Spine\r\n\t * Runtimes Guide. */\r\n\texport class SkeletonBinary {\r\n\t\tstatic AttachmentTypeValues = [ 0 /*AttachmentType.Region*/, 1/*AttachmentType.BoundingBox*/, 2/*AttachmentType.Mesh*/, 3/*AttachmentType.LinkedMesh*/, 4/*AttachmentType.Path*/, 5/*AttachmentType.Point*/, 6/*AttachmentType.Clipping*/ ];\r\n\t\tstatic TransformModeValues = [TransformMode.Normal, TransformMode.OnlyTranslation, TransformMode.NoRotationOrReflection, TransformMode.NoScale, TransformMode.NoScaleOrReflection];\r\n\t\tstatic PositionModeValues = [ PositionMode.Fixed, PositionMode.Percent ];\r\n\t\tstatic SpacingModeValues = [ SpacingMode.Length, SpacingMode.Fixed, SpacingMode.Percent];\r\n\t\tstatic RotateModeValues = [ RotateMode.Tangent, RotateMode.Chain, RotateMode.ChainScale ];\r\n\t\tstatic BlendModeValues = [ BlendMode.Normal, BlendMode.Additive, BlendMode.Multiply, BlendMode.Screen];\r\n\r\n\t\tstatic BONE_ROTATE = 0;\r\n\t\tstatic BONE_TRANSLATE = 1;\r\n\t\tstatic BONE_SCALE = 2;\r\n\t\tstatic BONE_SHEAR = 3;\r\n\r\n\t\tstatic SLOT_ATTACHMENT = 0;\r\n\t\tstatic SLOT_COLOR = 1;\r\n\t\tstatic SLOT_TWO_COLOR = 2;\r\n\r\n\t\tstatic PATH_POSITION = 0;\r\n\t\tstatic PATH_SPACING = 1;\r\n\t\tstatic PATH_MIX = 2;\r\n\r\n\t\tstatic CURVE_LINEAR = 0;\r\n\t\tstatic CURVE_STEPPED = 1;\r\n\t\tstatic CURVE_BEZIER = 2;\r\n\r\n\t\t/** Scales bone positions, image sizes, and translations as they are loaded. This allows different size images to be used at\r\n\t\t * runtime than were used in Spine.\r\n\t\t *\r\n\t\t * See [Scaling](http://esotericsoftware.com/spine-loading-skeleton-data#Scaling) in the Spine Runtimes Guide. */\r\n\t\tscale = 1;\r\n\r\n\t\tattachmentLoader: AttachmentLoader;\r\n\t\tprivate linkedMeshes = new Array<LinkedMesh>();\r\n\r\n\t\tconstructor (attachmentLoader: AttachmentLoader) {\r\n\t\t\tthis.attachmentLoader = attachmentLoader;\r\n\t\t}\r\n\r\n\t\treadSkeletonData (binary: Uint8Array): SkeletonData {\r\n\t\t\tlet scale = this.scale;\r\n\r\n\t\t\tlet skeletonData = new SkeletonData();\r\n\t\t\tskeletonData.name = \"\"; // BOZO\r\n\r\n\t\t\tlet input = new BinaryInput(binary);\r\n\r\n\t\t\tskeletonData.hash = input.readString();\r\n\t\t\tskeletonData.version = input.readString();\r\n\t\t\tif (\"3.8.75\" == skeletonData.version)\r\n\t\t\t\t\tthrow new Error(\"Unsupported skeleton data, please export with a newer version of Spine.\");\r\n\t\t\tskeletonData.x = input.readFloat();\r\n\t\t\tskeletonData.y = input.readFloat();\r\n\t\t\tskeletonData.width = input.readFloat();\r\n\t\t\tskeletonData.height = input.readFloat();\r\n\r\n\t\t\tlet nonessential = input.readBoolean();\r\n\t\t\tif (nonessential) {\r\n\t\t\t\tskeletonData.fps = input.readFloat();\r\n\r\n\t\t\t\tskeletonData.imagesPath = input.readString();\r\n\t\t\t\tskeletonData.audioPath = input.readString();\r\n\t\t\t}\r\n\r\n\t\t\tlet n = 0;\r\n\t\t\t// Strings.\r\n\t\t\tn = input.readInt(true)\r\n\t\t\tfor (let i = 0; i < n; i++)\r\n\t\t\t\tinput.strings.push(input.readString());\r\n\r\n\t\t\t// Bones.\r\n\t\t\tn = input.readInt(true)\r\n\t\t\tfor (let i = 0; i < n; i++) {\r\n\t\t\t\tlet name = input.readString();\r\n\t\t\t\tlet parent = i == 0 ? null : skeletonData.bones[input.readInt(true)];\r\n\t\t\t\tlet data = new BoneData(i, name, parent);\r\n\t\t\t\tdata.rotation = input.readFloat();\r\n\t\t\t\tdata.x = input.readFloat() * scale;\r\n\t\t\t\tdata.y = input.readFloat() * scale;\r\n\t\t\t\tdata.scaleX = input.readFloat();\r\n\t\t\t\tdata.scaleY = input.readFloat();\r\n\t\t\t\tdata.shearX = input.readFloat();\r\n\t\t\t\tdata.shearY = input.readFloat();\r\n\t\t\t\tdata.length = input.readFloat() * scale;\r\n\t\t\t\tdata.transformMode = SkeletonBinary.TransformModeValues[input.readInt(true)];\r\n\t\t\t\tdata.skinRequired = input.readBoolean();\r\n\t\t\t\tif (nonessential) Color.rgba8888ToColor(data.color, input.readInt32());\r\n\t\t\t\tskeletonData.bones.push(data);\r\n\t\t\t}\r\n\r\n\t\t\t// Slots.\r\n\t\t\tn = input.readInt(true);\r\n\t\t\tfor (let i = 0; i < n; i++) {\r\n\t\t\t\tlet slotName = input.readString();\r\n\t\t\t\tlet boneData = skeletonData.bones[input.readInt(true)];\r\n\t\t\t\tlet data = new SlotData(i, slotName, boneData);\r\n\t\t\t\tColor.rgba8888ToColor(data.color, input.readInt32());\r\n\r\n\t\t\t\tlet darkColor = input.readInt32();\r\n\t\t\t\tif (darkColor != -1) Color.rgb888ToColor(data.darkColor = new Color(), darkColor);\r\n\r\n\t\t\t\tdata.attachmentName = input.readStringRef();\r\n\t\t\t\tdata.blendMode = SkeletonBinary.BlendModeValues[input.readInt(true)];\r\n\t\t\t\tskeletonData.slots.push(data);\r\n\t\t\t}\r\n\r\n\t\t\t// IK constraints.\r\n\t\t\tn = input.readInt(true);\r\n\t\t\tfor (let i = 0, nn; i < n; i++) {\r\n\t\t\t\tlet data = new IkConstraintData(input.readString());\r\n\t\t\t\tdata.order = input.readInt(true);\r\n\t\t\t\tdata.skinRequired = input.readBoolean();\r\n\t\t\t\tnn = input.readInt(true);\r\n\t\t\t\tfor (let ii = 0; ii < nn; ii++)\r\n\t\t\t\t\tdata.bones.push(skeletonData.bones[input.readInt(true)]);\r\n\t\t\t\tdata.target = skeletonData.bones[input.readInt(true)];\r\n\t\t\t\tdata.mix = input.readFloat();\r\n\t\t\t\tdata.softness = input.readFloat() * scale;\r\n\t\t\t\tdata.bendDirection = input.readByte();\r\n\t\t\t\tdata.compress = input.readBoolean();\r\n\t\t\t\tdata.stretch = input.readBoolean();\r\n\t\t\t\tdata.uniform = input.readBoolean();\r\n\t\t\t\tskeletonData.ikConstraints.push(data);\r\n\t\t\t}\r\n\r\n\t\t\t// Transform constraints.\r\n\t\t\tn = input.readInt(true);\r\n\t\t\tfor (let i = 0, nn; i < n; i++) {\r\n\t\t\t\tlet data = new TransformConstraintData(input.readString());\r\n\t\t\t\tdata.order = input.readInt(true);\r\n\t\t\t\tdata.skinRequired = input.readBoolean();\r\n\t\t\t\tnn = input.readInt(true);\r\n\t\t\t\tfor (let ii = 0; ii < nn; ii++)\r\n\t\t\t\t\tdata.bones.push(skeletonData.bones[input.readInt(true)]);\r\n\t\t\t\tdata.target = skeletonData.bones[input.readInt(true)];\r\n\t\t\t\tdata.local = input.readBoolean();\r\n\t\t\t\tdata.relative = input.readBoolean();\r\n\t\t\t\tdata.offsetRotation = input.readFloat();\r\n\t\t\t\tdata.offsetX = input.readFloat() * scale;\r\n\t\t\t\tdata.offsetY = input.readFloat() * scale;\r\n\t\t\t\tdata.offsetScaleX = input.readFloat();\r\n\t\t\t\tdata.offsetScaleY = input.readFloat();\r\n\t\t\t\tdata.offsetShearY = input.readFloat();\r\n\t\t\t\tdata.rotateMix = input.readFloat();\r\n\t\t\t\tdata.translateMix = input.readFloat();\r\n\t\t\t\tdata.scaleMix = input.readFloat();\r\n\t\t\t\tdata.shearMix = input.readFloat();\r\n\t\t\t\tskeletonData.transformConstraints.push(data);\r\n\t\t\t}\r\n\r\n\t\t\t// Path constraints.\r\n\t\t\tn = input.readInt(true);\r\n\t\t\tfor (let i = 0, nn; i < n; i++) {\r\n\t\t\t\tlet data = new PathConstraintData(input.readString());\r\n\t\t\t\tdata.order = input.readInt(true);\r\n\t\t\t\tdata.skinRequired = input.readBoolean();\r\n\t\t\t\tnn = input.readInt(true);\r\n\t\t\t\tfor (let ii = 0; ii < nn; ii++)\r\n\t\t\t\t\tdata.bones.push(skeletonData.bones[input.readInt(true)]);\r\n\t\t\t\tdata.target = skeletonData.slots[input.readInt(true)];\r\n\t\t\t\tdata.positionMode = SkeletonBinary.PositionModeValues[input.readInt(true)];\r\n\t\t\t\tdata.spacingMode = SkeletonBinary.SpacingModeValues[input.readInt(true)];\r\n\t\t\t\tdata.rotateMode = SkeletonBinary.RotateModeValues[input.readInt(true)];\r\n\t\t\t\tdata.offsetRotation = input.readFloat();\r\n\t\t\t\tdata.position = input.readFloat();\r\n\t\t\t\tif (data.positionMode == PositionMode.Fixed) data.position *= scale;\r\n\t\t\t\tdata.spacing = input.readFloat();\r\n\t\t\t\tif (data.spacingMode == SpacingMode.Length || data.spacingMode == SpacingMode.Fixed) data.spacing *= scale;\r\n\t\t\t\tdata.rotateMix = input.readFloat();\r\n\t\t\t\tdata.translateMix = input.readFloat();\r\n\t\t\t\tskeletonData.pathConstraints.push(data);\r\n\t\t\t}\r\n\r\n\t\t\t// Default skin.\r\n\t\t\tlet defaultSkin = this.readSkin(input, skeletonData, true, nonessential);\r\n\t\t\tif (defaultSkin != null) {\r\n\t\t\t\tskeletonData.defaultSkin = defaultSkin;\r\n\t\t\t\tskeletonData.skins.push(defaultSkin);\r\n\t\t\t}\r\n\r\n\t\t\t// Skins.\r\n\t\t\t{\r\n\t\t\t\tlet i = skeletonData.skins.length;\r\n\t\t\t\tUtils.setArraySize(skeletonData.skins, n = i + input.readInt(true));\r\n\t\t\t\tfor (; i < n; i++)\r\n\t\t\t\t\tskeletonData.skins[i] = this.readSkin(input, skeletonData, false, nonessential);\r\n\t\t\t}\r\n\r\n\t\t\t// Linked meshes.\r\n\t\t\tn = this.linkedMeshes.length;\r\n\t\t\tfor (let i = 0; i < n; i++) {\r\n\t\t\t\tlet linkedMesh = this.linkedMeshes[i];\r\n\t\t\t\tlet skin = linkedMesh.skin == null ? skeletonData.defaultSkin : skeletonData.findSkin(linkedMesh.skin);\r\n\t\t\t\tif (skin == null) throw new Error(\"Skin not found: \" + linkedMesh.skin);\r\n\t\t\t\tlet parent = skin.getAttachment(linkedMesh.slotIndex, linkedMesh.parent);\r\n\t\t\t\tif (parent == null) throw new Error(\"Parent mesh not found: \" + linkedMesh.parent);\r\n\t\t\t\tlinkedMesh.mesh.deformAttachment = linkedMesh.inheritDeform ? parent as VertexAttachment : linkedMesh.mesh;\r\n\t\t\t\tlinkedMesh.mesh.setParentMesh(parent as MeshAttachment);\r\n\t\t\t\tlinkedMesh.mesh.updateUVs();\r\n\t\t\t}\r\n\t\t\tthis.linkedMeshes.length = 0;\r\n\r\n\t\t\t// Events.\r\n\t\t\tn = input.readInt(true);\r\n\t\t\tfor (let i = 0; i < n; i++) {\r\n\t\t\t\tlet data = new EventData(input.readStringRef());\r\n\t\t\t\tdata.intValue = input.readInt(false);\r\n\t\t\t\tdata.floatValue = input.readFloat();\r\n\t\t\t\tdata.stringValue = input.readString();\r\n\t\t\t\tdata.audioPath = input.readString();\r\n\t\t\t\tif (data.audioPath != null) {\r\n\t\t\t\t\tdata.volume = input.readFloat();\r\n\t\t\t\t\tdata.balance = input.readFloat();\r\n\t\t\t\t}\r\n\t\t\t\tskeletonData.events.push(data);\r\n\t\t\t}\r\n\r\n\t\t\t// Animations.\r\n\t\t\tn = input.readInt(true);\r\n\t\t\tfor (let i = 0; i < n; i++)\r\n\t\t\t\tskeletonData.animations.push(this.readAnimation(input, input.readString(), skeletonData));\r\n\t\t\treturn skeletonData;\r\n\t\t}\r\n\r\n\t\tprivate readSkin (input: BinaryInput, skeletonData: SkeletonData, defaultSkin: boolean, nonessential: boolean): Skin {\r\n\t\t\tlet skin = null;\r\n\t\t\tlet slotCount = 0;\r\n\r\n\t\t\tif (defaultSkin) {\r\n\t\t\t\tslotCount = input.readInt(true)\r\n\t\t\t\tif (slotCount == 0) return null;\r\n\t\t\t\tskin = new Skin(\"default\");\r\n\t\t\t} else {\r\n\t\t\t\tskin = new Skin(input.readStringRef());\r\n\t\t\t\tskin.bones.length = input.readInt(true);\r\n\t\t\t\tfor (let i = 0, n = skin.bones.length; i < n; i++)\r\n\t\t\t\t\tskin.bones[i] = skeletonData.bones[input.readInt(true)];\r\n\r\n\t\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++)\r\n\t\t\t\t\tskin.constraints.push(skeletonData.ikConstraints[input.readInt(true)]);\r\n\t\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++)\r\n\t\t\t\t\tskin.constraints.push(skeletonData.transformConstraints[input.readInt(true)]);\r\n\t\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++)\r\n\t\t\t\t\tskin.constraints.push(skeletonData.pathConstraints[input.readInt(true)]);\r\n\r\n\t\t\t\tslotCount = input.readInt(true);\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = 0; i < slotCount; i++) {\r\n\t\t\t\tlet slotIndex = input.readInt(true);\r\n\t\t\t\tfor (let ii = 0, nn = input.readInt(true); ii < nn; ii++) {\r\n\t\t\t\t\tlet name = input.readStringRef();\r\n\t\t\t\t\tlet attachment = this.readAttachment(input, skeletonData, skin, slotIndex, name, nonessential);\r\n\t\t\t\t\tif (attachment != null) skin.setAttachment(slotIndex, name, attachment);\r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t\treturn skin;\r\n\t\t}\r\n\r\n\t\tprivate readAttachment(input: BinaryInput, skeletonData: SkeletonData, skin: Skin, slotIndex: number, attachmentName: string, nonessential: boolean): Attachment {\r\n\t\t\tlet scale = this.scale;\r\n\r\n\t\t\tlet name = input.readStringRef();\r\n\t\t\tif (name == null) name = attachmentName;\r\n\r\n\t\t\tlet typeIndex = input.readByte();\r\n\t\t\tlet type = SkeletonBinary.AttachmentTypeValues[typeIndex];\r\n\t\t\tswitch (type) {\r\n\t\t\tcase AttachmentType.Region: {\r\n\t\t\t\tlet path = input.readStringRef();\r\n\t\t\t\tlet rotation = input.readFloat();\r\n\t\t\t\tlet x = input.readFloat();\r\n\t\t\t\tlet y = input.readFloat();\r\n\t\t\t\tlet scaleX = input.readFloat();\r\n\t\t\t\tlet scaleY = input.readFloat();\r\n\t\t\t\tlet width = input.readFloat();\r\n\t\t\t\tlet height = input.readFloat();\r\n\t\t\t\tlet color = input.readInt32();\r\n\r\n\t\t\t\tif (path == null) path = name;\r\n\t\t\t\tlet region = this.attachmentLoader.newRegionAttachment(skin, name, path);\r\n\t\t\t\tif (region == null) return null;\r\n\t\t\t\tregion.path = path;\r\n\t\t\t\tregion.x = x * scale;\r\n\t\t\t\tregion.y = y * scale;\r\n\t\t\t\tregion.scaleX = scaleX;\r\n\t\t\t\tregion.scaleY = scaleY;\r\n\t\t\t\tregion.rotation = rotation;\r\n\t\t\t\tregion.width = width * scale;\r\n\t\t\t\tregion.height = height * scale;\r\n\t\t\t\tColor.rgba8888ToColor(region.color, color);\r\n\t\t\t\tregion.updateOffset();\r\n\t\t\t\treturn region;\r\n\t\t\t}\r\n\t\t\tcase AttachmentType.BoundingBox: {\r\n\t\t\t\tlet vertexCount = input.readInt(true);\r\n\t\t\t\tlet vertices = this.readVertices(input, vertexCount);\r\n\t\t\t\tlet color = nonessential ? input.readInt32() : 0;\r\n\r\n\t\t\t\tlet box = this.attachmentLoader.newBoundingBoxAttachment(skin, name);\r\n\t\t\t\tif (box == null) return null;\r\n\t\t\t\tbox.worldVerticesLength = vertexCount << 1;\r\n\t\t\t\tbox.vertices = vertices.vertices;\r\n\t\t\t\tbox.bones = vertices.bones;\r\n\t\t\t\tif (nonessential) Color.rgba8888ToColor(box.color, color);\r\n\t\t\t\treturn box;\r\n\t\t\t}\r\n\t\t\tcase AttachmentType.Mesh: {\r\n\t\t\t\tlet path = input.readStringRef();\r\n\t\t\t\tlet color = input.readInt32();\r\n\t\t\t\tlet vertexCount = input.readInt(true);\r\n\t\t\t\tlet uvs = this.readFloatArray(input, vertexCount << 1, 1);\r\n\t\t\t\tlet triangles = this.readShortArray(input);\r\n\t\t\t\tlet vertices = this.readVertices(input, vertexCount);\r\n\t\t\t\tlet hullLength = input.readInt(true);\r\n\t\t\t\tlet edges = null;\r\n\t\t\t\tlet width = 0, height = 0;\r\n\t\t\t\tif (nonessential) {\r\n\t\t\t\t\tedges = this.readShortArray(input);\r\n\t\t\t\t\twidth = input.readFloat();\r\n\t\t\t\t\theight = input.readFloat();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (path == null) path = name;\r\n\t\t\t\tlet mesh = this.attachmentLoader.newMeshAttachment(skin, name, path);\r\n\t\t\t\tif (mesh == null) return null;\r\n\t\t\t\tmesh.path = path;\r\n\t\t\t\tColor.rgba8888ToColor(mesh.color, color);\r\n\t\t\t\tmesh.bones = vertices.bones;\r\n\t\t\t\tmesh.vertices = vertices.vertices;\r\n\t\t\t\tmesh.worldVerticesLength = vertexCount << 1;\r\n\t\t\t\tmesh.triangles = triangles;\r\n\t\t\t\tmesh.regionUVs = uvs;\r\n\t\t\t\tmesh.updateUVs();\r\n\t\t\t\tmesh.hullLength = hullLength << 1;\r\n\t\t\t\tif (nonessential) {\r\n\t\t\t\t\tmesh.edges = edges;\r\n\t\t\t\t\tmesh.width = width * scale;\r\n\t\t\t\t\tmesh.height = height * scale;\r\n\t\t\t\t}\r\n\t\t\t\treturn mesh;\r\n\t\t\t}\r\n\t\t\tcase AttachmentType.LinkedMesh: {\r\n\t\t\t\tlet path = input.readStringRef();\r\n\t\t\t\tlet color = input.readInt32();\r\n\t\t\t\tlet skinName = input.readStringRef();\r\n\t\t\t\tlet parent = input.readStringRef();\r\n\t\t\t\tlet inheritDeform = input.readBoolean();\r\n\t\t\t\tlet width = 0, height = 0;\r\n\t\t\t\tif (nonessential) {\r\n\t\t\t\t\twidth = input.readFloat();\r\n\t\t\t\t\theight = input.readFloat();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (path == null) path = name;\r\n\t\t\t\tlet mesh = this.attachmentLoader.newMeshAttachment(skin, name, path);\r\n\t\t\t\tif (mesh == null) return null;\r\n\t\t\t\tmesh.path = path;\r\n\t\t\t\tColor.rgba8888ToColor(mesh.color, color);\r\n\t\t\t\tif (nonessential) {\r\n\t\t\t\t\tmesh.width = width * scale;\r\n\t\t\t\t\tmesh.height = height * scale;\r\n\t\t\t\t}\r\n\t\t\t\tthis.linkedMeshes.push(new LinkedMesh(mesh, skinName, slotIndex, parent, inheritDeform));\r\n\t\t\t\treturn mesh;\r\n\t\t\t}\r\n\t\t\tcase AttachmentType.Path: {\r\n\t\t\t\tlet closed = input.readBoolean();\r\n\t\t\t\tlet constantSpeed = input.readBoolean();\r\n\t\t\t\tlet vertexCount = input.readInt(true);\r\n\t\t\t\tlet vertices = this.readVertices(input, vertexCount);\r\n\t\t\t\tlet lengths = Utils.newArray(vertexCount / 3, 0);\r\n\t\t\t\tfor (let i = 0, n = lengths.length; i < n; i++)\r\n\t\t\t\t\tlengths[i] = input.readFloat() * scale;\r\n\t\t\t\tlet color = nonessential ? input.readInt32() : 0;\r\n\r\n\t\t\t\tlet path = this.attachmentLoader.newPathAttachment(skin, name);\r\n\t\t\t\tif (path == null) return null;\r\n\t\t\t\tpath.closed = closed;\r\n\t\t\t\tpath.constantSpeed = constantSpeed;\r\n\t\t\t\tpath.worldVerticesLength = vertexCount << 1;\r\n\t\t\t\tpath.vertices = vertices.vertices;\r\n\t\t\t\tpath.bones = vertices.bones;\r\n\t\t\t\tpath.lengths = lengths;\r\n\t\t\t\tif (nonessential) Color.rgba8888ToColor(path.color, color);\r\n\t\t\t\treturn path;\r\n\t\t\t}\r\n\t\t\tcase AttachmentType.Point: {\r\n\t\t\t\tlet rotation = input.readFloat();\r\n\t\t\t\tlet x = input.readFloat();\r\n\t\t\t\tlet y = input.readFloat();\r\n\t\t\t\tlet color = nonessential ? input.readInt32() : 0;\r\n\r\n\t\t\t\tlet point = this.attachmentLoader.newPointAttachment(skin, name);\r\n\t\t\t\tif (point == null) return null;\r\n\t\t\t\tpoint.x = x * scale;\r\n\t\t\t\tpoint.y = y * scale;\r\n\t\t\t\tpoint.rotation = rotation;\r\n\t\t\t\tif (nonessential) Color.rgba8888ToColor(point.color, color);\r\n\t\t\t\treturn point;\r\n\t\t\t}\r\n\t\t\tcase AttachmentType.Clipping: {\r\n\t\t\t\tlet endSlotIndex = input.readInt(true);\r\n\t\t\t\tlet vertexCount = input.readInt(true);\r\n\t\t\t\tlet vertices = this.readVertices(input, vertexCount);\r\n\t\t\t\tlet color = nonessential ? input.readInt32() : 0;\r\n\r\n\t\t\t\tlet clip = this.attachmentLoader.newClippingAttachment(skin, name);\r\n\t\t\t\tif (clip == null) return null;\r\n\t\t\t\tclip.endSlot = skeletonData.slots[endSlotIndex];\r\n\t\t\t\tclip.worldVerticesLength = vertexCount << 1;\r\n\t\t\t\tclip.vertices = vertices.vertices;\r\n\t\t\t\tclip.bones = vertices.bones;\r\n\t\t\t\tif (nonessential) Color.rgba8888ToColor(clip.color, color);\r\n\t\t\t\treturn clip;\r\n\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tprivate readVertices (input: BinaryInput, vertexCount: number): Vertices {\r\n\t\t\tlet verticesLength = vertexCount << 1;\r\n\t\t\tlet vertices = new Vertices();\r\n\t\t\tlet scale = this.scale;\r\n\t\t\tif (!input.readBoolean()) {\r\n\t\t\t\tvertices.vertices = this.readFloatArray(input, verticesLength, scale);\r\n\t\t\t\treturn vertices;\r\n\t\t\t}\r\n\t\t\tlet weights = new Array<number>();\r\n\t\t\tlet bonesArray = new Array<number>();\r\n\t\t\tfor (let i = 0; i < vertexCount; i++) {\r\n\t\t\t\tlet boneCount = input.readInt(true);\r\n\t\t\t\tbonesArray.push(boneCount);\r\n\t\t\t\tfor (let ii = 0; ii < boneCount; ii++) {\r\n\t\t\t\t\tbonesArray.push(input.readInt(true));\r\n\t\t\t\t\tweights.push(input.readFloat() * scale);\r\n\t\t\t\t\tweights.push(input.readFloat() * scale);\r\n\t\t\t\t\tweights.push(input.readFloat());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvertices.vertices = Utils.toFloatArray(weights);\r\n\t\t\tvertices.bones = bonesArray;\r\n\t\t\treturn vertices;\r\n\t\t}\r\n\r\n\t\tprivate readFloatArray (input: BinaryInput, n: number, scale: number): number[] {\r\n\t\t\tlet array = new Array<number>(n);\r\n\t\t\tif (scale == 1) {\r\n\t\t\t\tfor (let i = 0; i < n; i++)\r\n\t\t\t\t\tarray[i] = input.readFloat();\r\n\t\t\t} else {\r\n\t\t\t\tfor (let i = 0; i < n; i++)\r\n\t\t\t\t\tarray[i] = input.readFloat() * scale;\r\n\t\t\t}\r\n\t\t\treturn array;\r\n\t\t}\r\n\r\n\t\tprivate readShortArray (input: BinaryInput): number[] {\r\n\t\t\tlet n = input.readInt(true);\r\n\t\t\tlet array = new Array<number>(n);\r\n\t\t\tfor (let i = 0; i < n; i++)\r\n\t\t\t\tarray[i] = input.readShort();\r\n\t\t\treturn array;\r\n\t\t}\r\n\r\n\t\tprivate readAnimation (input: BinaryInput, name: string, skeletonData: SkeletonData): Animation {\r\n\t\t\tlet timelines = new Array<Timeline>();\r\n\t\t\tlet scale = this.scale;\r\n\t\t\tlet duration = 0;\r\n\t\t\tlet tempColor1 = new Color();\r\n\t\t\tlet tempColor2 = new Color();\r\n\r\n\t\t\t// Slot timelines.\r\n\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++) {\r\n\t\t\t\tlet slotIndex = input.readInt(true);\r\n\t\t\t\tfor (let ii = 0, nn = input.readInt(true); ii < nn; ii++) {\r\n\t\t\t\t\tlet timelineType = input.readByte();\r\n\t\t\t\t\tlet frameCount = input.readInt(true);\r\n\t\t\t\t\tswitch (timelineType) {\r\n\t\t\t\t\tcase SkeletonBinary.SLOT_ATTACHMENT: {\r\n\t\t\t\t\t\tlet timeline = new AttachmentTimeline(frameCount);\r\n\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++)\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readStringRef());\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[frameCount - 1]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcase SkeletonBinary.SLOT_COLOR: {\r\n\t\t\t\t\t\tlet timeline = new ColorTimeline(frameCount);\r\n\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\tlet time = input.readFloat();\r\n\t\t\t\t\t\t\tColor.rgba8888ToColor(tempColor1, input.readInt32());\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, time, tempColor1.r, tempColor1.g, tempColor1.b, tempColor1.a);\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * ColorTimeline.ENTRIES]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcase SkeletonBinary.SLOT_TWO_COLOR: {\r\n\t\t\t\t\t\tlet timeline = new TwoColorTimeline(frameCount);\r\n\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\tlet time = input.readFloat();\r\n\t\t\t\t\t\t\tColor.rgba8888ToColor(tempColor1, input.readInt32());\r\n\t\t\t\t\t\t\tColor.rgb888ToColor(tempColor2, input.readInt32());\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, time, tempColor1.r, tempColor1.g, tempColor1.b, tempColor1.a, tempColor2.r,\r\n\t\t\t\t\t\t\t\ttempColor2.g, tempColor2.b);\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * TwoColorTimeline.ENTRIES]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Bone timelines.\r\n\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++) {\r\n\t\t\t\tlet boneIndex = input.readInt(true);\r\n\t\t\t\tfor (let ii = 0, nn = input.readInt(true); ii < nn; ii++) {\r\n\t\t\t\t\tlet timelineType = input.readByte();\r\n\t\t\t\t\tlet frameCount = input.readInt(true);\r\n\t\t\t\t\tswitch (timelineType) {\r\n\t\t\t\t\tcase SkeletonBinary.BONE_ROTATE: {\r\n\t\t\t\t\t\tlet timeline = new RotateTimeline(frameCount);\r\n\t\t\t\t\t\ttimeline.boneIndex = boneIndex;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readFloat());\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * RotateTimeline.ENTRIES]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcase SkeletonBinary.BONE_TRANSLATE:\r\n\t\t\t\t\tcase SkeletonBinary.BONE_SCALE:\r\n\t\t\t\t\tcase SkeletonBinary.BONE_SHEAR: {\r\n\t\t\t\t\t\tlet timeline;\r\n\t\t\t\t\t\tlet timelineScale = 1;\r\n\t\t\t\t\t\tif (timelineType == SkeletonBinary.BONE_SCALE)\r\n\t\t\t\t\t\t\ttimeline = new ScaleTimeline(frameCount);\r\n\t\t\t\t\t\telse if (timelineType == SkeletonBinary.BONE_SHEAR)\r\n\t\t\t\t\t\t\ttimeline = new ShearTimeline(frameCount);\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\ttimeline = new TranslateTimeline(frameCount);\r\n\t\t\t\t\t\t\ttimelineScale = scale;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimeline.boneIndex = boneIndex;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readFloat() * timelineScale,\r\n\t\t\t\t\t\t\t\tinput.readFloat() * timelineScale);\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * TranslateTimeline.ENTRIES]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// IK constraint timelines.\r\n\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++) {\r\n\t\t\t\tlet index = input.readInt(true);\r\n\t\t\t\tlet frameCount = input.readInt(true);\r\n\t\t\t\tlet timeline = new IkConstraintTimeline(frameCount);\r\n\t\t\t\ttimeline.ikConstraintIndex = index;\r\n\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readFloat(), input.readFloat() * scale, input.readByte(), input.readBoolean(),\r\n\t\t\t\t\t\tinput.readBoolean());\r\n\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t}\r\n\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * IkConstraintTimeline.ENTRIES]);\r\n\t\t\t}\r\n\r\n\t\t\t// Transform constraint timelines.\r\n\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++) {\r\n\t\t\t\tlet index = input.readInt(true);\r\n\t\t\t\tlet frameCount = input.readInt(true);\r\n\t\t\t\tlet timeline = new TransformConstraintTimeline(frameCount);\r\n\t\t\t\ttimeline.transformConstraintIndex = index;\r\n\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readFloat(), input.readFloat(), input.readFloat(),\r\n\t\t\t\t\t\tinput.readFloat());\r\n\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t}\r\n\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * TransformConstraintTimeline.ENTRIES]);\r\n\t\t\t}\r\n\r\n\t\t\t// Path constraint timelines.\r\n\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++) {\r\n\t\t\t\tlet index = input.readInt(true);\r\n\t\t\t\tlet data = skeletonData.pathConstraints[index];\r\n\t\t\t\tfor (let ii = 0, nn = input.readInt(true); ii < nn; ii++) {\r\n\t\t\t\t\tlet timelineType = input.readByte();\r\n\t\t\t\t\tlet frameCount = input.readInt(true);\r\n\t\t\t\t\tswitch (timelineType) {\r\n\t\t\t\t\tcase SkeletonBinary.PATH_POSITION:\r\n\t\t\t\t\tcase SkeletonBinary.PATH_SPACING: {\r\n\t\t\t\t\t\tlet timeline;\r\n\t\t\t\t\t\tlet timelineScale = 1;\r\n\t\t\t\t\t\tif (timelineType == SkeletonBinary.PATH_SPACING) {\r\n\t\t\t\t\t\t\ttimeline = new PathConstraintSpacingTimeline(frameCount);\r\n\t\t\t\t\t\t\tif (data.spacingMode == SpacingMode.Length || data.spacingMode == SpacingMode.Fixed) timelineScale = scale;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttimeline = new PathConstraintPositionTimeline(frameCount);\r\n\t\t\t\t\t\t\tif (data.positionMode == PositionMode.Fixed) timelineScale = scale;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimeline.pathConstraintIndex = index;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readFloat() * timelineScale);\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * PathConstraintPositionTimeline.ENTRIES]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcase SkeletonBinary.PATH_MIX: {\r\n\t\t\t\t\t\tlet timeline = new PathConstraintMixTimeline(frameCount);\r\n\t\t\t\t\t\ttimeline.pathConstraintIndex = index;\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, input.readFloat(), input.readFloat(), input.readFloat());\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(frameCount - 1) * PathConstraintMixTimeline.ENTRIES]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Deform timelines.\r\n\t\t\tfor (let i = 0, n = input.readInt(true); i < n; i++) {\r\n\t\t\t\tlet skin = skeletonData.skins[input.readInt(true)];\r\n\t\t\t\tfor (let ii = 0, nn = input.readInt(true); ii < nn; ii++) {\r\n\t\t\t\t\tlet slotIndex = input.readInt(true);\r\n\t\t\t\t\tfor (let iii = 0, nnn = input.readInt(true); iii < nnn; iii++) {\r\n\t\t\t\t\t\tlet attachment = skin.getAttachment(slotIndex, input.readStringRef()) as VertexAttachment;\r\n\t\t\t\t\t\tlet weighted = attachment.bones != null;\r\n\t\t\t\t\t\tlet vertices = attachment.vertices;\r\n\t\t\t\t\t\tlet deformLength = weighted ? vertices.length / 3 * 2 : vertices.length;\r\n\r\n\t\t\t\t\t\tlet frameCount = input.readInt(true);\r\n\t\t\t\t\t\tlet timeline = new DeformTimeline(frameCount);\r\n\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\t\t\t\t\t\ttimeline.attachment = attachment;\r\n\r\n\t\t\t\t\t\tfor (let frameIndex = 0; frameIndex < frameCount; frameIndex++) {\r\n\t\t\t\t\t\t\tlet time = input.readFloat();\r\n\t\t\t\t\t\t\tlet deform;\r\n\t\t\t\t\t\t\tlet end = input.readInt(true);\r\n\t\t\t\t\t\t\tif (end == 0)\r\n\t\t\t\t\t\t\t\tdeform = weighted ? Utils.newFloatArray(deformLength) : vertices;\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tdeform = Utils.newFloatArray(deformLength);\r\n\t\t\t\t\t\t\t\tlet start = input.readInt(true);\r\n\t\t\t\t\t\t\t\tend += start;\r\n\t\t\t\t\t\t\t\tif (scale == 1) {\r\n\t\t\t\t\t\t\t\t\tfor (let v = start; v < end; v++)\r\n\t\t\t\t\t\t\t\t\t\tdeform[v] = input.readFloat();\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfor (let v = start; v < end; v++)\r\n\t\t\t\t\t\t\t\t\t\tdeform[v] = input.readFloat() * scale;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (!weighted) {\r\n\t\t\t\t\t\t\t\t\tfor (let v = 0, vn = deform.length; v < vn; v++)\r\n\t\t\t\t\t\t\t\t\t\tdeform[v] += vertices[v];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, time, deform);\r\n\t\t\t\t\t\t\tif (frameIndex < frameCount - 1) this.readCurve(input, frameIndex, timeline);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[frameCount - 1]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Draw order timeline.\r\n\t\t\tlet drawOrderCount = input.readInt(true);\r\n\t\t\tif (drawOrderCount > 0) {\r\n\t\t\t\tlet timeline = new DrawOrderTimeline(drawOrderCount);\r\n\t\t\t\tlet slotCount = skeletonData.slots.length;\r\n\t\t\t\tfor (let i = 0; i < drawOrderCount; i++) {\r\n\t\t\t\t\tlet time = input.readFloat();\r\n\t\t\t\t\tlet offsetCount = input.readInt(true);\r\n\t\t\t\t\tlet drawOrder = Utils.newArray(slotCount, 0);\r\n\t\t\t\t\tfor (let ii = slotCount - 1; ii >= 0; ii--)\r\n\t\t\t\t\t\tdrawOrder[ii] = -1;\r\n\t\t\t\t\tlet unchanged = Utils.newArray(slotCount - offsetCount, 0);\r\n\t\t\t\t\tlet originalIndex = 0, unchangedIndex = 0;\r\n\t\t\t\t\tfor (let ii = 0; ii < offsetCount; ii++) {\r\n\t\t\t\t\t\tlet slotIndex = input.readInt(true);\r\n\t\t\t\t\t\t// Collect unchanged items.\r\n\t\t\t\t\t\twhile (originalIndex != slotIndex)\r\n\t\t\t\t\t\t\tunchanged[unchangedIndex++] = originalIndex++;\r\n\t\t\t\t\t\t// Set changed items.\r\n\t\t\t\t\t\tdrawOrder[originalIndex + input.readInt(true)] = originalIndex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Collect remaining unchanged items.\r\n\t\t\t\t\twhile (originalIndex < slotCount)\r\n\t\t\t\t\t\tunchanged[unchangedIndex++] = originalIndex++;\r\n\t\t\t\t\t// Fill in unchanged items.\r\n\t\t\t\t\tfor (let ii = slotCount - 1; ii >= 0; ii--)\r\n\t\t\t\t\t\tif (drawOrder[ii] == -1) drawOrder[ii] = unchanged[--unchangedIndex];\r\n\t\t\t\t\ttimeline.setFrame(i, time, drawOrder);\r\n\t\t\t\t}\r\n\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\tduration = Math.max(duration, timeline.frames[drawOrderCount - 1]);\r\n\t\t\t}\r\n\r\n\t\t\t// Event timeline.\r\n\t\t\tlet eventCount = input.readInt(true);\r\n\t\t\tif (eventCount > 0) {\r\n\t\t\t\tlet timeline = new EventTimeline(eventCount);\r\n\t\t\t\tfor (let i = 0; i < eventCount; i++) {\r\n\t\t\t\t\tlet time = input.readFloat();\r\n\t\t\t\t\tlet eventData = skeletonData.events[input.readInt(true)];\r\n\t\t\t\t\tlet event = new Event(time, eventData);\r\n\t\t\t\t\tevent.intValue = input.readInt(false);\r\n\t\t\t\t\tevent.floatValue = input.readFloat();\r\n\t\t\t\t\tevent.stringValue = input.readBoolean() ? input.readString() : eventData.stringValue;\r\n\t\t\t\t\tif (event.data.audioPath != null) {\r\n\t\t\t\t\t\tevent.volume = input.readFloat();\r\n\t\t\t\t\t\tevent.balance = input.readFloat();\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimeline.setFrame(i, event);\r\n\t\t\t\t}\r\n\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\tduration = Math.max(duration, timeline.frames[eventCount - 1]);\r\n\t\t\t}\r\n\r\n\t\t\treturn new Animation(name, timelines, duration);\r\n\t\t}\r\n\r\n\t\tprivate readCurve (input: BinaryInput, frameIndex: number, timeline: CurveTimeline) {\r\n\t\t\tswitch (input.readByte()) {\r\n\t\t\tcase SkeletonBinary.CURVE_STEPPED:\r\n\t\t\t\ttimeline.setStepped(frameIndex);\r\n\t\t\t\tbreak;\r\n\t\t\tcase SkeletonBinary.CURVE_BEZIER:\r\n\t\t\t\tthis.setCurve(timeline, frameIndex, input.readFloat(), input.readFloat(), input.readFloat(), input.readFloat());\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsetCurve (timeline: CurveTimeline, frameIndex: number, cx1: number, cy1: number, cx2: number, cy2: number) {\r\n\t\t\ttimeline.setCurve(frameIndex, cx1, cy1, cx2, cy2);\r\n\t\t}\r\n\t}\r\n\r\n\tclass BinaryInput {\r\n\t\tconstructor(data: Uint8Array, public strings = new Array<string>(), private index: number = 0, private buffer = new DataView(data.buffer)) { \r\n\r\n\t\t}\r\n\r\n\t\treadByte(): number {\r\n\t\t\treturn this.buffer.getInt8(this.index++);\r\n\t\t}\r\n\r\n\t\treadShort(): number {\r\n\t\t\tlet value = this.buffer.getInt16(this.index);\r\n\t\t\tthis.index += 2;\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\treadInt32(): number {\r\n\t\t\t let value = this.buffer.getInt32(this.index)\r\n\t\t\t this.index += 4;\r\n\t\t\t return value;\r\n\t\t}\r\n\r\n\t\treadInt(optimizePositive: boolean) {\r\n\t\t\tlet b = this.readByte();\r\n\t\t\tlet result = b & 0x7F;\r\n\t\t\tif ((b & 0x80) != 0) {\r\n\t\t\t\tb = this.readByte();\r\n\t\t\t\tresult |= (b & 0x7F) << 7;\r\n\t\t\t\tif ((b & 0x80) != 0) {\r\n\t\t\t\t\tb = this.readByte();\r\n\t\t\t\t\tresult |= (b & 0x7F) << 14;\r\n\t\t\t\t\tif ((b & 0x80) != 0) {\r\n\t\t\t\t\t\tb = this.readByte();\r\n\t\t\t\t\t\tresult |= (b & 0x7F) << 21;\r\n\t\t\t\t\t\tif ((b & 0x80) != 0) {\r\n\t\t\t\t\t\t\tb = this.readByte();\r\n\t\t\t\t\t\t\tresult |= (b & 0x7F) << 28;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn optimizePositive ? result : ((result >>> 1) ^ -(result & 1));\r\n\t\t}\r\n\r\n\t\treadStringRef (): string {\r\n\t\t\tlet index = this.readInt(true);\r\n\t\t\treturn index == 0 ? null : this.strings[index - 1];\r\n\t\t}\r\n\r\n\t\treadString (): string {\r\n\t\t\tlet byteCount = this.readInt(true);\r\n\t\t\tswitch (byteCount) {\r\n\t\t\tcase 0:\r\n\t\t\t\treturn null;\r\n\t\t\tcase 1:\r\n\t\t\t\treturn \"\";\r\n\t\t\t}\r\n\t\t\tbyteCount--;\r\n\t\t\tlet chars = \"\";\r\n\t\t\tlet charCount = 0;\r\n\t\t\tfor (let i = 0; i < byteCount;) {\r\n\t\t\t\tlet b = this.readByte();\r\n\t\t\t\tswitch (b >> 4) {\r\n\t\t\t\tcase 12:\r\n\t\t\t\tcase 13:\r\n\t\t\t\t\tchars += String.fromCharCode(((b & 0x1F) << 6 | this.readByte() & 0x3F));\r\n\t\t\t\t\ti += 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 14:\r\n\t\t\t\t\tchars += String.fromCharCode(((b & 0x0F) << 12 | (this.readByte() & 0x3F) << 6 | this.readByte() & 0x3F));\r\n\t\t\t\t\ti += 3;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tchars += String.fromCharCode(b);\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn chars;\r\n\t\t}\r\n\r\n\t\treadFloat (): number {\r\n\t\t\tlet value = this.buffer.getFloat32(this.index);\r\n\t\t\tthis.index += 4;\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\treadBoolean (): boolean {\r\n\t\t\treturn this.readByte() != 0;\r\n\t\t}\r\n\t}\r\n\r\n\tclass LinkedMesh {\r\n\t\tparent: string; skin: string;\r\n\t\tslotIndex: number;\r\n\t\tmesh: MeshAttachment;\r\n\t\tinheritDeform: boolean;\r\n\r\n\t\tconstructor (mesh: MeshAttachment, skin: string, slotIndex: number, parent: string, inheritDeform: boolean) {\r\n\t\t\tthis.mesh = mesh;\r\n\t\t\tthis.skin = skin;\r\n\t\t\tthis.slotIndex = slotIndex;\r\n\t\t\tthis.parent = parent;\r\n\t\t\tthis.inheritDeform = inheritDeform;\r\n\t\t}\r\n\t}\r\n\r\n\tclass Vertices {\r\n\t\tconstructor(public bones: Array<number> = null, public vertices: Array<number> | Float32Array = null) { }\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Timeline, AttachmentTimeline, ColorTimeline, TwoColorTimeline, RotateTimeline, TranslateTimeline, ScaleTimeline, ShearTimeline, IkConstraintTimeline, TransformConstraintTimeline, PathConstraintPositionTimeline, PathConstraintSpacingTimeline, PathConstraintMixTimeline, DeformTimeline, DrawOrderTimeline, EventTimeline, CurveTimeline } from \"./Animation\";\r\nimport { VertexAttachment, Attachment } from \"./attachments/Attachment\";\r\nimport { AttachmentLoader } from \"./attachments/AttachmentLoader\";\r\nimport { MeshAttachment } from \"./attachments/MeshAttachment\";\r\nimport { Event } from \"./Event\";\r\nimport { BlendMode } from \"./BlendMode\";\r\nimport { BoneData, TransformMode } from \"./BoneData\";\r\nimport { EventData } from \"./EventData\";\r\nimport { IkConstraintData } from \"./IkConstraintData\";\r\nimport { PathConstraintData, PositionMode, SpacingMode, RotateMode } from \"./PathConstraintData\";\r\nimport { SkeletonData } from \"./SkeletonData\";\r\nimport { Skin } from \"./Skin\";\r\nimport { SlotData } from \"./SlotData\";\r\nimport { TransformConstraintData } from \"./TransformConstraintData\";\r\nimport { Color, Utils, ArrayLike } from \"./Utils\";\r\nimport { Animation } from \"./Animation\";\r\n\r\n// module spine {\r\n\r\n\t/** Loads skeleton data in the Spine JSON format.\r\n\t *\r\n\t * See [Spine JSON format](http://esotericsoftware.com/spine-json-format) and\r\n\t * [JSON and binary data](http://esotericsoftware.com/spine-loading-skeleton-data#JSON-and-binary-data) in the Spine\r\n\t * Runtimes Guide. */\r\n\texport class SkeletonJson {\r\n\t\tattachmentLoader: AttachmentLoader;\r\n\r\n\t\t/** Scales bone positions, image sizes, and translations as they are loaded. This allows different size images to be used at\r\n\t\t * runtime than were used in Spine.\r\n\t\t *\r\n\t\t * See [Scaling](http://esotericsoftware.com/spine-loading-skeleton-data#Scaling) in the Spine Runtimes Guide. */\r\n\t\tscale = 1;\r\n\t\tprivate linkedMeshes = new Array<LinkedMesh>();\r\n\r\n\t\tconstructor (attachmentLoader: AttachmentLoader) {\r\n\t\t\tthis.attachmentLoader = attachmentLoader;\r\n\t\t}\r\n\r\n\t\treadSkeletonData (json: string | any): SkeletonData {\r\n\t\t\tlet scale = this.scale;\r\n\t\t\tlet skeletonData = new SkeletonData();\r\n\t\t\tlet root = typeof(json) === \"string\" ? JSON.parse(json) : json;\r\n\r\n\t\t\t// Skeleton\r\n\t\t\tlet skeletonMap = root.skeleton;\r\n\t\t\tif (skeletonMap != null) {\r\n\t\t\t\tskeletonData.hash = skeletonMap.hash;\r\n\t\t\t\tskeletonData.version = skeletonMap.spine;\r\n\t\t\t\tif (\"3.8.75\" == skeletonData.version)\r\n\t\t\t\t\tthrow new Error(\"Unsupported skeleton data, please export with a newer version of Spine.\");\r\n\t\t\t\tskeletonData.x = skeletonMap.x;\r\n\t\t\t\tskeletonData.y = skeletonMap.y;\r\n\t\t\t\tskeletonData.width = skeletonMap.width;\r\n\t\t\t\tskeletonData.height = skeletonMap.height;\r\n\t\t\t\tskeletonData.fps = skeletonMap.fps;\r\n\t\t\t\tskeletonData.imagesPath = skeletonMap.images;\r\n\t\t\t}\r\n\r\n\t\t\t// Bones\r\n\t\t\tif (root.bones) {\r\n\t\t\t\tfor (let i = 0; i < root.bones.length; i++) {\r\n\t\t\t\t\tlet boneMap = root.bones[i];\r\n\r\n\t\t\t\t\tlet parent: BoneData = null;\r\n\t\t\t\t\tlet parentName: string = this.getValue(boneMap, \"parent\", null);\r\n\t\t\t\t\tif (parentName != null) {\r\n\t\t\t\t\t\tparent = skeletonData.findBone(parentName);\r\n\t\t\t\t\t\tif (parent == null) throw new Error(\"Parent bone not found: \" + parentName);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet data = new BoneData(skeletonData.bones.length, boneMap.name, parent);\r\n\t\t\t\t\tdata.length = this.getValue(boneMap, \"length\", 0) * scale;\r\n\t\t\t\t\tdata.x = this.getValue(boneMap, \"x\", 0) * scale;\r\n\t\t\t\t\tdata.y = this.getValue(boneMap, \"y\", 0) * scale;\r\n\t\t\t\t\tdata.rotation = this.getValue(boneMap, \"rotation\", 0);\r\n\t\t\t\t\tdata.scaleX = this.getValue(boneMap, \"scaleX\", 1);\r\n\t\t\t\t\tdata.scaleY = this.getValue(boneMap, \"scaleY\", 1);\r\n\t\t\t\t\tdata.shearX = this.getValue(boneMap, \"shearX\", 0);\r\n\t\t\t\t\tdata.shearY = this.getValue(boneMap, \"shearY\", 0);\r\n\t\t\t\t\tdata.transformMode = SkeletonJson.transformModeFromString(this.getValue(boneMap, \"transform\", \"normal\"));\r\n\t\t\t\t\tdata.skinRequired = this.getValue(boneMap, \"skin\", false);\r\n\r\n\t\t\t\t\tskeletonData.bones.push(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Slots.\r\n\t\t\tif (root.slots) {\r\n\t\t\t\tfor (let i = 0; i < root.slots.length; i++) {\r\n\t\t\t\t\tlet slotMap = root.slots[i];\r\n\t\t\t\t\tlet slotName: string = slotMap.name;\r\n\t\t\t\t\tlet boneName: string = slotMap.bone;\r\n\t\t\t\t\tlet boneData = skeletonData.findBone(boneName);\r\n\t\t\t\t\tif (boneData == null) throw new Error(\"Slot bone not found: \" + boneName);\r\n\t\t\t\t\tlet data = new SlotData(skeletonData.slots.length, slotName, boneData);\r\n\r\n\t\t\t\t\tlet color: string = this.getValue(slotMap, \"color\", null);\r\n\t\t\t\t\tif (color != null) data.color.setFromString(color);\r\n\r\n\t\t\t\t\tlet dark: string = this.getValue(slotMap, \"dark\", null);\r\n\t\t\t\t\tif (dark != null) {\r\n\t\t\t\t\t\tdata.darkColor = new Color(1, 1, 1, 1);\r\n\t\t\t\t\t\tdata.darkColor.setFromString(dark);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdata.attachmentName = this.getValue(slotMap, \"attachment\", null);\r\n\t\t\t\t\tdata.blendMode = SkeletonJson.blendModeFromString(this.getValue(slotMap, \"blend\", \"normal\"));\r\n\t\t\t\t\tskeletonData.slots.push(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// IK constraints\r\n\t\t\tif (root.ik) {\r\n\t\t\t\tfor (let i = 0; i < root.ik.length; i++) {\r\n\t\t\t\t\tlet constraintMap = root.ik[i];\r\n\t\t\t\t\tlet data = new IkConstraintData(constraintMap.name);\r\n\t\t\t\t\tdata.order = this.getValue(constraintMap, \"order\", 0);\r\n\t\t\t\t\tdata.skinRequired = this.getValue(constraintMap, \"skin\", false);\r\n\r\n\t\t\t\t\tfor (let j = 0; j < constraintMap.bones.length; j++) {\r\n\t\t\t\t\t\tlet boneName = constraintMap.bones[j];\r\n\t\t\t\t\t\tlet bone = skeletonData.findBone(boneName);\r\n\t\t\t\t\t\tif (bone == null) throw new Error(\"IK bone not found: \" + boneName);\r\n\t\t\t\t\t\tdata.bones.push(bone);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet targetName: string = constraintMap.target;\r\n\t\t\t\t\tdata.target = skeletonData.findBone(targetName);\r\n\t\t\t\t\tif (data.target == null) throw new Error(\"IK target bone not found: \" + targetName);\r\n\r\n\t\t\t\t\tdata.mix = this.getValue(constraintMap, \"mix\", 1);\r\n\t\t\t\t\tdata.softness = this.getValue(constraintMap, \"softness\", 0) * scale;\r\n\t\t\t\t\tdata.bendDirection = this.getValue(constraintMap, \"bendPositive\", true) ? 1 : -1;\r\n\t\t\t\t\tdata.compress = this.getValue(constraintMap, \"compress\", false);\r\n\t\t\t\t\tdata.stretch = this.getValue(constraintMap, \"stretch\", false);\r\n\t\t\t\t\tdata.uniform = this.getValue(constraintMap, \"uniform\", false);\r\n\r\n\t\t\t\t\tskeletonData.ikConstraints.push(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Transform constraints.\r\n\t\t\tif (root.transform) {\r\n\t\t\t\tfor (let i = 0; i < root.transform.length; i++) {\r\n\t\t\t\t\tlet constraintMap = root.transform[i];\r\n\t\t\t\t\tlet data = new TransformConstraintData(constraintMap.name);\r\n\t\t\t\t\tdata.order = this.getValue(constraintMap, \"order\", 0);\r\n\t\t\t\t\tdata.skinRequired = this.getValue(constraintMap, \"skin\", false);\r\n\r\n\t\t\t\t\tfor (let j = 0; j < constraintMap.bones.length; j++) {\r\n\t\t\t\t\t\tlet boneName = constraintMap.bones[j];\r\n\t\t\t\t\t\tlet bone = skeletonData.findBone(boneName);\r\n\t\t\t\t\t\tif (bone == null) throw new Error(\"Transform constraint bone not found: \" + boneName);\r\n\t\t\t\t\t\tdata.bones.push(bone);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet targetName: string = constraintMap.target;\r\n\t\t\t\t\tdata.target = skeletonData.findBone(targetName);\r\n\t\t\t\t\tif (data.target == null) throw new Error(\"Transform constraint target bone not found: \" + targetName);\r\n\r\n\t\t\t\t\tdata.local = this.getValue(constraintMap, \"local\", false);\r\n\t\t\t\t\tdata.relative = this.getValue(constraintMap, \"relative\", false);\r\n\t\t\t\t\tdata.offsetRotation = this.getValue(constraintMap, \"rotation\", 0);\r\n\t\t\t\t\tdata.offsetX = this.getValue(constraintMap, \"x\", 0) * scale;\r\n\t\t\t\t\tdata.offsetY = this.getValue(constraintMap, \"y\", 0) * scale;\r\n\t\t\t\t\tdata.offsetScaleX = this.getValue(constraintMap, \"scaleX\", 0);\r\n\t\t\t\t\tdata.offsetScaleY = this.getValue(constraintMap, \"scaleY\", 0);\r\n\t\t\t\t\tdata.offsetShearY = this.getValue(constraintMap, \"shearY\", 0);\r\n\r\n\t\t\t\t\tdata.rotateMix = this.getValue(constraintMap, \"rotateMix\", 1);\r\n\t\t\t\t\tdata.translateMix = this.getValue(constraintMap, \"translateMix\", 1);\r\n\t\t\t\t\tdata.scaleMix = this.getValue(constraintMap, \"scaleMix\", 1);\r\n\t\t\t\t\tdata.shearMix = this.getValue(constraintMap, \"shearMix\", 1);\r\n\r\n\t\t\t\t\tskeletonData.transformConstraints.push(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Path constraints.\r\n\t\t\tif (root.path) {\r\n\t\t\t\tfor (let i = 0; i < root.path.length; i++) {\r\n\t\t\t\t\tlet constraintMap = root.path[i];\r\n\t\t\t\t\tlet data = new PathConstraintData(constraintMap.name);\r\n\t\t\t\t\tdata.order = this.getValue(constraintMap, \"order\", 0);\r\n\t\t\t\t\tdata.skinRequired = this.getValue(constraintMap, \"skin\", false);\r\n\r\n\t\t\t\t\tfor (let j = 0; j < constraintMap.bones.length; j++) {\r\n\t\t\t\t\t\tlet boneName = constraintMap.bones[j];\r\n\t\t\t\t\t\tlet bone = skeletonData.findBone(boneName);\r\n\t\t\t\t\t\tif (bone == null) throw new Error(\"Transform constraint bone not found: \" + boneName);\r\n\t\t\t\t\t\tdata.bones.push(bone);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet targetName: string = constraintMap.target;\r\n\t\t\t\t\tdata.target = skeletonData.findSlot(targetName);\r\n\t\t\t\t\tif (data.target == null) throw new Error(\"Path target slot not found: \" + targetName);\r\n\r\n\t\t\t\t\tdata.positionMode = SkeletonJson.positionModeFromString(this.getValue(constraintMap, \"positionMode\", \"percent\"));\r\n\t\t\t\t\tdata.spacingMode = SkeletonJson.spacingModeFromString(this.getValue(constraintMap, \"spacingMode\", \"length\"));\r\n\t\t\t\t\tdata.rotateMode = SkeletonJson.rotateModeFromString(this.getValue(constraintMap, \"rotateMode\", \"tangent\"));\r\n\t\t\t\t\tdata.offsetRotation = this.getValue(constraintMap, \"rotation\", 0);\r\n\t\t\t\t\tdata.position = this.getValue(constraintMap, \"position\", 0);\r\n\t\t\t\t\tif (data.positionMode == PositionMode.Fixed) data.position *= scale;\r\n\t\t\t\t\tdata.spacing = this.getValue(constraintMap, \"spacing\", 0);\r\n\t\t\t\t\tif (data.spacingMode == SpacingMode.Length || data.spacingMode == SpacingMode.Fixed) data.spacing *= scale;\r\n\t\t\t\t\tdata.rotateMix = this.getValue(constraintMap, \"rotateMix\", 1);\r\n\t\t\t\t\tdata.translateMix = this.getValue(constraintMap, \"translateMix\", 1);\r\n\r\n\t\t\t\t\tskeletonData.pathConstraints.push(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Skins.\r\n\t\t\tif (root.skins) {\r\n\t\t\t\tfor (let i = 0; i < root.skins.length; i++) {\r\n\t\t\t\t\tlet skinMap = root.skins[i]\r\n\t\t\t\t\tlet skin = new Skin(skinMap.name);\r\n\r\n\t\t\t\t\tif (skinMap.bones) {\r\n\t\t\t\t\t\tfor (let ii = 0; ii < skinMap.bones.length; ii++) {\r\n\t\t\t\t\t\t\tlet bone = skeletonData.findBone(skinMap.bones[ii]);\r\n\t\t\t\t\t\t\tif (bone == null) throw new Error(\"Skin bone not found: \" + skinMap.bones[i]);\r\n\t\t\t\t\t\t\tskin.bones.push(bone);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (skinMap.ik) {\r\n\t\t\t\t\t\tfor (let ii = 0; ii < skinMap.ik.length; ii++) {\r\n\t\t\t\t\t\t\tlet constraint = skeletonData.findIkConstraint(skinMap.ik[ii]);\r\n\t\t\t\t\t\t\tif (constraint == null) throw new Error(\"Skin IK constraint not found: \" + skinMap.ik[i]);\r\n\t\t\t\t\t\t\tskin.constraints.push(constraint);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (skinMap.transform) {\r\n\t\t\t\t\t\tfor (let ii = 0; ii < skinMap.transform.length; ii++) {\r\n\t\t\t\t\t\t\tlet constraint = skeletonData.findTransformConstraint(skinMap.transform[ii]);\r\n\t\t\t\t\t\t\tif (constraint == null) throw new Error(\"Skin transform constraint not found: \" + skinMap.transform[i]);\r\n\t\t\t\t\t\t\tskin.constraints.push(constraint);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (skinMap.path) {\r\n\t\t\t\t\t\tfor (let ii = 0; ii < skinMap.path.length; ii++) {\r\n\t\t\t\t\t\t\tlet constraint = skeletonData.findPathConstraint(skinMap.path[ii]);\r\n\t\t\t\t\t\t\tif (constraint == null) throw new Error(\"Skin path constraint not found: \" + skinMap.path[i]);\r\n\t\t\t\t\t\t\tskin.constraints.push(constraint);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (let slotName in skinMap.attachments) {\r\n\t\t\t\t\t\tlet slot = skeletonData.findSlot(slotName);\r\n\t\t\t\t\t\tif (slot == null) throw new Error(\"Slot not found: \" + slotName);\r\n\t\t\t\t\t\tlet slotMap = skinMap.attachments[slotName];\r\n\t\t\t\t\t\tfor (let entryName in slotMap) {\r\n\t\t\t\t\t\t\tlet attachment = this.readAttachment(slotMap[entryName], skin, slot.index, entryName, skeletonData);\r\n\t\t\t\t\t\t\tif (attachment != null) skin.setAttachment(slot.index, entryName, attachment);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tskeletonData.skins.push(skin);\r\n\t\t\t\t\tif (skin.name == \"default\") skeletonData.defaultSkin = skin;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Linked meshes.\r\n\t\t\tfor (let i = 0, n = this.linkedMeshes.length; i < n; i++) {\r\n\t\t\t\tlet linkedMesh = this.linkedMeshes[i];\r\n\t\t\t\tlet skin = linkedMesh.skin == null ? skeletonData.defaultSkin : skeletonData.findSkin(linkedMesh.skin);\r\n\t\t\t\tif (skin == null) throw new Error(\"Skin not found: \" + linkedMesh.skin);\r\n\t\t\t\tlet parent = skin.getAttachment(linkedMesh.slotIndex, linkedMesh.parent);\r\n\t\t\t\tif (parent == null) throw new Error(\"Parent mesh not found: \" + linkedMesh.parent);\r\n\t\t\t\tlinkedMesh.mesh.deformAttachment = linkedMesh.inheritDeform ? <VertexAttachment>parent : <VertexAttachment>linkedMesh.mesh;\r\n\t\t\t\tlinkedMesh.mesh.setParentMesh(<MeshAttachment> parent);\r\n\t\t\t\tlinkedMesh.mesh.updateUVs();\r\n\t\t\t}\r\n\t\t\tthis.linkedMeshes.length = 0;\r\n\r\n\t\t\t// Events.\r\n\t\t\tif (root.events) {\r\n\t\t\t\tfor (let eventName in root.events) {\r\n\t\t\t\t\tlet eventMap = root.events[eventName];\r\n\t\t\t\t\tlet data = new EventData(eventName);\r\n\t\t\t\t\tdata.intValue = this.getValue(eventMap, \"int\", 0);\r\n\t\t\t\t\tdata.floatValue = this.getValue(eventMap, \"float\", 0);\r\n\t\t\t\t\tdata.stringValue = this.getValue(eventMap, \"string\", \"\");\r\n\t\t\t\t\tdata.audioPath = this.getValue(eventMap, \"audio\", null);\r\n\t\t\t\t\tif (data.audioPath != null) {\r\n\t\t\t\t\t\tdata.volume = this.getValue(eventMap, \"volume\", 1);\r\n\t\t\t\t\t\tdata.balance = this.getValue(eventMap, \"balance\", 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tskeletonData.events.push(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Animations.\r\n\t\t\tif (root.animations) {\r\n\t\t\t\tfor (let animationName in root.animations) {\r\n\t\t\t\t\tlet animationMap = root.animations[animationName];\r\n\t\t\t\t\tthis.readAnimation(animationMap, animationName, skeletonData);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn skeletonData;\r\n\t\t}\r\n\r\n\t\treadAttachment (map: any, skin: Skin, slotIndex: number, name: string, skeletonData: SkeletonData): Attachment {\r\n\t\t\tlet scale = this.scale;\r\n\t\t\tname = this.getValue(map, \"name\", name);\r\n\r\n\t\t\tlet type = this.getValue(map, \"type\", \"region\");\r\n\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase \"region\": {\r\n\t\t\t\t\tlet path = this.getValue(map, \"path\", name);\r\n\t\t\t\t\tlet region = this.attachmentLoader.newRegionAttachment(skin, name, path);\r\n\t\t\t\t\tif (region == null) return null;\r\n\t\t\t\t\tregion.path = path;\r\n\t\t\t\t\tregion.x = this.getValue(map, \"x\", 0) * scale;\r\n\t\t\t\t\tregion.y = this.getValue(map, \"y\", 0) * scale;\r\n\t\t\t\t\tregion.scaleX = this.getValue(map, \"scaleX\", 1);\r\n\t\t\t\t\tregion.scaleY = this.getValue(map, \"scaleY\", 1);\r\n\t\t\t\t\tregion.rotation = this.getValue(map, \"rotation\", 0);\r\n\t\t\t\t\tregion.width = map.width * scale;\r\n\t\t\t\t\tregion.height = map.height * scale;\r\n\r\n\t\t\t\t\tlet color: string = this.getValue(map, \"color\", null);\r\n\t\t\t\t\tif (color != null) region.color.setFromString(color);\r\n\r\n\t\t\t\t\tregion.updateOffset();\r\n\t\t\t\t\treturn region;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"boundingbox\": {\r\n\t\t\t\t\tlet box = this.attachmentLoader.newBoundingBoxAttachment(skin, name);\r\n\t\t\t\t\tif (box == null) return null;\r\n\t\t\t\t\tthis.readVertices(map, box, map.vertexCount << 1);\r\n\t\t\t\t\tlet color: string = this.getValue(map, \"color\", null);\r\n\t\t\t\t\tif (color != null) box.color.setFromString(color);\r\n\t\t\t\t\treturn box;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"mesh\":\r\n\t\t\t\tcase \"linkedmesh\": {\r\n\t\t\t\t\tlet path = this.getValue(map, \"path\", name);\r\n\t\t\t\t\tlet mesh = this.attachmentLoader.newMeshAttachment(skin, name, path);\r\n\t\t\t\t\tif (mesh == null) return null;\r\n\t\t\t\t\tmesh.path = path;\r\n\r\n\t\t\t\t\tlet color = this.getValue(map, \"color\", null);\r\n\t\t\t\t\tif (color != null) mesh.color.setFromString(color);\r\n\r\n\t\t\t\t\tmesh.width = this.getValue(map, \"width\", 0) * scale;\r\n\t\t\t\t\tmesh.height = this.getValue(map, \"height\", 0) * scale;\r\n\r\n\t\t\t\t\tlet parent: string = this.getValue(map, \"parent\", null);\r\n\t\t\t\t\tif (parent != null) {\r\n\t\t\t\t\t\tthis.linkedMeshes.push(new LinkedMesh(mesh, <string> this.getValue(map, \"skin\", null), slotIndex, parent, this.getValue(map, \"deform\", true)));\r\n\t\t\t\t\t\treturn mesh;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet uvs: Array<number> = map.uvs;\r\n\t\t\t\t\tthis.readVertices(map, mesh, uvs.length);\r\n\t\t\t\t\tmesh.triangles = map.triangles;\r\n\t\t\t\t\tmesh.regionUVs = uvs;\r\n\t\t\t\t\tmesh.updateUVs();\r\n\r\n\t\t\t\t\tmesh.edges = this.getValue(map, \"edges\", null);\r\n\t\t\t\t\tmesh.hullLength = this.getValue(map, \"hull\", 0) * 2;\r\n\t\t\t\t\treturn mesh;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"path\": {\r\n\t\t\t\t\tlet path = this.attachmentLoader.newPathAttachment(skin, name);\r\n\t\t\t\t\tif (path == null) return null;\r\n\t\t\t\t\tpath.closed = this.getValue(map, \"closed\", false);\r\n\t\t\t\t\tpath.constantSpeed = this.getValue(map, \"constantSpeed\", true);\r\n\r\n\t\t\t\t\tlet vertexCount = map.vertexCount;\r\n\t\t\t\t\tthis.readVertices(map, path, vertexCount << 1);\r\n\r\n\t\t\t\t\tlet lengths: Array<number> = Utils.newArray(vertexCount / 3, 0);\r\n\t\t\t\t\tfor (let i = 0; i < map.lengths.length; i++)\r\n\t\t\t\t\t\tlengths[i] = map.lengths[i] * scale;\r\n\t\t\t\t\tpath.lengths = lengths;\r\n\r\n\t\t\t\t\tlet color: string = this.getValue(map, \"color\", null);\r\n\t\t\t\t\tif (color != null) path.color.setFromString(color);\r\n\t\t\t\t\treturn path;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"point\": {\r\n\t\t\t\t\tlet point = this.attachmentLoader.newPointAttachment(skin, name);\r\n\t\t\t\t\tif (point == null) return null;\r\n\t\t\t\t\tpoint.x = this.getValue(map, \"x\", 0) * scale;\r\n\t\t\t\t\tpoint.y = this.getValue(map, \"y\", 0) * scale;\r\n\t\t\t\t\tpoint.rotation = this.getValue(map, \"rotation\", 0);\r\n\r\n\t\t\t\t\tlet color = this.getValue(map, \"color\", null);\r\n\t\t\t\t\tif (color != null) point.color.setFromString(color);\r\n\t\t\t\t\treturn point;\r\n\t\t\t\t}\r\n\t\t\t\tcase \"clipping\": {\r\n\t\t\t\t\tlet clip = this.attachmentLoader.newClippingAttachment(skin, name);\r\n\t\t\t\t\tif (clip == null) return null;\r\n\r\n\t\t\t\t\tlet end = this.getValue(map, \"end\", null);\r\n\t\t\t\t\tif (end != null) {\r\n\t\t\t\t\t\tlet slot = skeletonData.findSlot(end);\r\n\t\t\t\t\t\tif (slot == null) throw new Error(\"Clipping end slot not found: \" + end);\r\n\t\t\t\t\t\tclip.endSlot = slot;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet vertexCount = map.vertexCount;\r\n\t\t\t\t\tthis.readVertices(map, clip, vertexCount << 1);\r\n\r\n\t\t\t\t\tlet color: string = this.getValue(map, \"color\", null);\r\n\t\t\t\t\tif (color != null) clip.color.setFromString(color);\r\n\t\t\t\t\treturn clip;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treadVertices (map: any, attachment: VertexAttachment, verticesLength: number) {\r\n\t\t\tlet scale = this.scale;\r\n\t\t\tattachment.worldVerticesLength = verticesLength;\r\n\t\t\tlet vertices: Array<number> = map.vertices;\r\n\t\t\tif (verticesLength == vertices.length) {\r\n\t\t\t\tlet scaledVertices = Utils.toFloatArray(vertices);\r\n\t\t\t\tif (scale != 1) {\r\n\t\t\t\t\tfor (let i = 0, n = vertices.length; i < n; i++)\r\n\t\t\t\t\t\tscaledVertices[i] *= scale;\r\n\t\t\t\t}\r\n\t\t\t\tattachment.vertices = scaledVertices;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet weights = new Array<number>();\r\n\t\t\tlet bones = new Array<number>();\r\n\t\t\tfor (let i = 0, n = vertices.length; i < n;) {\r\n\t\t\t\tlet boneCount = vertices[i++];\r\n\t\t\t\tbones.push(boneCount);\r\n\t\t\t\tfor (let nn = i + boneCount * 4; i < nn; i += 4) {\r\n\t\t\t\t\tbones.push(vertices[i]);\r\n\t\t\t\t\tweights.push(vertices[i + 1] * scale);\r\n\t\t\t\t\tweights.push(vertices[i + 2] * scale);\r\n\t\t\t\t\tweights.push(vertices[i + 3]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tattachment.bones = bones;\r\n\t\t\tattachment.vertices = Utils.toFloatArray(weights);\r\n\t\t}\r\n\r\n\t\treadAnimation (map: any, name: string, skeletonData: SkeletonData) {\r\n\t\t\tlet scale = this.scale;\r\n\t\t\tlet timelines = new Array<Timeline>();\r\n\t\t\tlet duration = 0;\r\n\r\n\t\t\t// Slot timelines.\r\n\t\t\tif (map.slots) {\r\n\t\t\t\tfor (let slotName in map.slots) {\r\n\t\t\t\t\tlet slotMap = map.slots[slotName];\r\n\t\t\t\t\tlet slotIndex = skeletonData.findSlotIndex(slotName);\r\n\t\t\t\t\tif (slotIndex == -1) throw new Error(\"Slot not found: \" + slotName);\r\n\t\t\t\t\tfor (let timelineName in slotMap) {\r\n\t\t\t\t\t\tlet timelineMap = slotMap[timelineName];\r\n\t\t\t\t\t\tif (timelineName == \"attachment\") {\r\n\t\t\t\t\t\t\tlet timeline = new AttachmentTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex++, this.getValue(valueMap, \"time\", 0), valueMap.name);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[timeline.getFrameCount() - 1]);\r\n\t\t\t\t\t\t} else if (timelineName == \"color\") {\r\n\t\t\t\t\t\t\tlet timeline = new ColorTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\tlet color = new Color();\r\n\t\t\t\t\t\t\t\tcolor.setFromString(valueMap.color);\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), color.r, color.g, color.b, color.a);\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * ColorTimeline.ENTRIES]);\r\n\r\n\t\t\t\t\t\t} else if (timelineName == \"twoColor\") {\r\n\t\t\t\t\t\t\tlet timeline = new TwoColorTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\tlet light = new Color();\r\n\t\t\t\t\t\t\t\tlet dark = new Color();\r\n\t\t\t\t\t\t\t\tlight.setFromString(valueMap.light);\r\n\t\t\t\t\t\t\t\tdark.setFromString(valueMap.dark);\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), light.r, light.g, light.b, light.a, dark.r, dark.g, dark.b);\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * TwoColorTimeline.ENTRIES]);\r\n\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tthrow new Error(\"Invalid timeline type for a slot: \" + timelineName + \" (\" + slotName + \")\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Bone timelines.\r\n\t\t\tif (map.bones) {\r\n\t\t\t\tfor (let boneName in map.bones) {\r\n\t\t\t\t\tlet boneMap = map.bones[boneName];\r\n\t\t\t\t\tlet boneIndex = skeletonData.findBoneIndex(boneName);\r\n\t\t\t\t\tif (boneIndex == -1) throw new Error(\"Bone not found: \" + boneName);\r\n\t\t\t\t\tfor (let timelineName in boneMap) {\r\n\t\t\t\t\t\tlet timelineMap = boneMap[timelineName];\r\n\t\t\t\t\t\tif (timelineName === \"rotate\") {\r\n\t\t\t\t\t\t\tlet timeline = new RotateTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\ttimeline.boneIndex = boneIndex;\r\n\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), this.getValue(valueMap, \"angle\", 0));\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * RotateTimeline.ENTRIES]);\r\n\r\n\t\t\t\t\t\t} else if (timelineName === \"translate\" || timelineName === \"scale\" || timelineName === \"shear\") {\r\n\t\t\t\t\t\t\tlet timeline: TranslateTimeline = null;\r\n\t\t\t\t\t\t\tlet timelineScale = 1, defaultValue = 0;\r\n\t\t\t\t\t\t\tif (timelineName === \"scale\") {\r\n\t\t\t\t\t\t\t\ttimeline = new ScaleTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\t\tdefaultValue = 1;\r\n\t\t\t\t\t\t\t} else if (timelineName === \"shear\")\r\n\t\t\t\t\t\t\t\ttimeline = new ShearTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\ttimeline = new TranslateTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\t\ttimelineScale = scale;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimeline.boneIndex = boneIndex;\r\n\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\tlet x = this.getValue(valueMap, \"x\", defaultValue), y = this.getValue(valueMap, \"y\", defaultValue);\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), x * timelineScale, y * timelineScale);\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * TranslateTimeline.ENTRIES]);\r\n\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tthrow new Error(\"Invalid timeline type for a bone: \" + timelineName + \" (\" + boneName + \")\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// IK constraint timelines.\r\n\t\t\tif (map.ik) {\r\n\t\t\t\tfor (let constraintName in map.ik) {\r\n\t\t\t\t\tlet constraintMap = map.ik[constraintName];\r\n\t\t\t\t\tlet constraint = skeletonData.findIkConstraint(constraintName);\r\n\t\t\t\t\tlet timeline = new IkConstraintTimeline(constraintMap.length);\r\n\t\t\t\t\ttimeline.ikConstraintIndex = skeletonData.ikConstraints.indexOf(constraint);\r\n\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\tfor (let i = 0; i < constraintMap.length; i++) {\r\n\t\t\t\t\t\tlet valueMap = constraintMap[i];\r\n\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), this.getValue(valueMap, \"mix\", 1), this.getValue(valueMap, \"softness\", 0) * scale,\r\n\t\t\t\t\t\t\tthis.getValue(valueMap, \"bendPositive\", true) ? 1 : -1, this.getValue(valueMap, \"compress\", false), this.getValue(valueMap, \"stretch\", false));\r\n\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\tduration = Math.max(duration, timeline.frames[(timeline.getFrameCount() - 1) * IkConstraintTimeline.ENTRIES]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Transform constraint timelines.\r\n\t\t\tif (map.transform) {\r\n\t\t\t\tfor (let constraintName in map.transform) {\r\n\t\t\t\t\tlet constraintMap = map.transform[constraintName];\r\n\t\t\t\t\tlet constraint = skeletonData.findTransformConstraint(constraintName);\r\n\t\t\t\t\tlet timeline = new TransformConstraintTimeline(constraintMap.length);\r\n\t\t\t\t\ttimeline.transformConstraintIndex = skeletonData.transformConstraints.indexOf(constraint);\r\n\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\tfor (let i = 0; i < constraintMap.length; i++) {\r\n\t\t\t\t\t\tlet valueMap = constraintMap[i];\r\n\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), this.getValue(valueMap, \"rotateMix\", 1),\r\n\t\t\t\t\t\t\tthis.getValue(valueMap, \"translateMix\", 1), this.getValue(valueMap, \"scaleMix\", 1), this.getValue(valueMap, \"shearMix\", 1));\r\n\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\tduration = Math.max(duration,\r\n\t\t\t\t\t\ttimeline.frames[(timeline.getFrameCount() - 1) * TransformConstraintTimeline.ENTRIES]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Path constraint timelines.\r\n\t\t\tif (map.path) {\r\n\t\t\t\tfor (let constraintName in map.path) {\r\n\t\t\t\t\tlet constraintMap = map.path[constraintName];\r\n\t\t\t\t\tlet index = skeletonData.findPathConstraintIndex(constraintName);\r\n\t\t\t\t\tif (index == -1) throw new Error(\"Path constraint not found: \" + constraintName);\r\n\t\t\t\t\tlet data = skeletonData.pathConstraints[index];\r\n\t\t\t\t\tfor (let timelineName in constraintMap) {\r\n\t\t\t\t\t\tlet timelineMap = constraintMap[timelineName];\r\n\t\t\t\t\t\tif (timelineName === \"position\" || timelineName === \"spacing\") {\r\n\t\t\t\t\t\t\tlet timeline: PathConstraintPositionTimeline = null;\r\n\t\t\t\t\t\t\tlet timelineScale = 1;\r\n\t\t\t\t\t\t\tif (timelineName === \"spacing\") {\r\n\t\t\t\t\t\t\t\ttimeline = new PathConstraintSpacingTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\t\tif (data.spacingMode == SpacingMode.Length || data.spacingMode == SpacingMode.Fixed) timelineScale = scale;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttimeline = new PathConstraintPositionTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\t\tif (data.positionMode == PositionMode.Fixed) timelineScale = scale;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimeline.pathConstraintIndex = index;\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), this.getValue(valueMap, timelineName, 0) * timelineScale);\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration,\r\n\t\t\t\t\t\t\t\ttimeline.frames[(timeline.getFrameCount() - 1) * PathConstraintPositionTimeline.ENTRIES]);\r\n\t\t\t\t\t\t} else if (timelineName === \"mix\") {\r\n\t\t\t\t\t\t\tlet timeline = new PathConstraintMixTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\ttimeline.pathConstraintIndex = index;\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let i = 0; i < timelineMap.length; i++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[i];\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), this.getValue(valueMap, \"rotateMix\", 1),\r\n\t\t\t\t\t\t\t\t\tthis.getValue(valueMap, \"translateMix\", 1));\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration,\r\n\t\t\t\t\t\t\t\ttimeline.frames[(timeline.getFrameCount() - 1) * PathConstraintMixTimeline.ENTRIES]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Deform timelines.\r\n\t\t\tif (map.deform) {\r\n\t\t\t\tfor (let deformName in map.deform) {\r\n\t\t\t\t\tlet deformMap = map.deform[deformName];\r\n\t\t\t\t\tlet skin = skeletonData.findSkin(deformName);\r\n\t\t\t\t\tif (skin == null) throw new Error(\"Skin not found: \" + deformName);\r\n\t\t\t\t\tfor (let slotName in deformMap) {\r\n\t\t\t\t\t\tlet slotMap = deformMap[slotName];\r\n\t\t\t\t\t\tlet slotIndex = skeletonData.findSlotIndex(slotName);\r\n\t\t\t\t\t\tif (slotIndex == -1) throw new Error(\"Slot not found: \" + slotMap.name);\r\n\t\t\t\t\t\tfor (let timelineName in slotMap) {\r\n\t\t\t\t\t\t\tlet timelineMap = slotMap[timelineName];\r\n\t\t\t\t\t\t\tlet attachment = <VertexAttachment>skin.getAttachment(slotIndex, timelineName);\r\n\t\t\t\t\t\t\tif (attachment == null) throw new Error(\"Deform attachment not found: \" + timelineMap.name);\r\n\t\t\t\t\t\t\tlet weighted = attachment.bones != null;\r\n\t\t\t\t\t\t\tlet vertices = attachment.vertices;\r\n\t\t\t\t\t\t\tlet deformLength = weighted ? vertices.length / 3 * 2 : vertices.length;\r\n\r\n\t\t\t\t\t\t\tlet timeline = new DeformTimeline(timelineMap.length);\r\n\t\t\t\t\t\t\ttimeline.slotIndex = slotIndex;\r\n\t\t\t\t\t\t\ttimeline.attachment = attachment;\r\n\r\n\t\t\t\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\t\t\t\tfor (let j = 0; j < timelineMap.length; j++) {\r\n\t\t\t\t\t\t\t\tlet valueMap = timelineMap[j];\r\n\t\t\t\t\t\t\t\tlet deform: ArrayLike<number>;\r\n\t\t\t\t\t\t\t\tlet verticesValue: Array<Number> = this.getValue(valueMap, \"vertices\", null);\r\n\t\t\t\t\t\t\t\tif (verticesValue == null)\r\n\t\t\t\t\t\t\t\t\tdeform = weighted ? Utils.newFloatArray(deformLength) : vertices;\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tdeform = Utils.newFloatArray(deformLength);\r\n\t\t\t\t\t\t\t\t\tlet start = <number>this.getValue(valueMap, \"offset\", 0);\r\n\t\t\t\t\t\t\t\t\tUtils.arrayCopy(verticesValue, 0, deform, start, verticesValue.length);\r\n\t\t\t\t\t\t\t\t\tif (scale != 1) {\r\n\t\t\t\t\t\t\t\t\t\tfor (let i = start, n = i + verticesValue.length; i < n; i++)\r\n\t\t\t\t\t\t\t\t\t\t\tdeform[i] *= scale;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif (!weighted) {\r\n\t\t\t\t\t\t\t\t\t\tfor (let i = 0; i < deformLength; i++)\r\n\t\t\t\t\t\t\t\t\t\t\tdeform[i] += vertices[i];\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\ttimeline.setFrame(frameIndex, this.getValue(valueMap, \"time\", 0), deform);\r\n\t\t\t\t\t\t\t\tthis.readCurve(valueMap, timeline, frameIndex);\r\n\t\t\t\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\t\t\t\tduration = Math.max(duration, timeline.frames[timeline.getFrameCount() - 1]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Draw order timeline.\r\n\t\t\tlet drawOrderNode = map.drawOrder;\r\n\t\t\tif (drawOrderNode == null) drawOrderNode = map.draworder;\r\n\t\t\tif (drawOrderNode != null) {\r\n\t\t\t\tlet timeline = new DrawOrderTimeline(drawOrderNode.length);\r\n\t\t\t\tlet slotCount = skeletonData.slots.length;\r\n\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\tfor (let j = 0; j < drawOrderNode.length; j++) {\r\n\t\t\t\t\tlet drawOrderMap = drawOrderNode[j];\r\n\t\t\t\t\tlet drawOrder: Array<number> = null;\r\n\t\t\t\t\tlet offsets = this.getValue(drawOrderMap, \"offsets\", null);\r\n\t\t\t\t\tif (offsets != null) {\r\n\t\t\t\t\t\tdrawOrder = Utils.newArray<number>(slotCount, -1);\r\n\t\t\t\t\t\tlet unchanged = Utils.newArray<number>(slotCount - offsets.length, 0);\r\n\t\t\t\t\t\tlet originalIndex = 0, unchangedIndex = 0;\r\n\t\t\t\t\t\tfor (let i = 0; i < offsets.length; i++) {\r\n\t\t\t\t\t\t\tlet offsetMap = offsets[i];\r\n\t\t\t\t\t\t\tlet slotIndex = skeletonData.findSlotIndex(offsetMap.slot);\r\n\t\t\t\t\t\t\tif (slotIndex == -1) throw new Error(\"Slot not found: \" + offsetMap.slot);\r\n\t\t\t\t\t\t\t// Collect unchanged items.\r\n\t\t\t\t\t\t\twhile (originalIndex != slotIndex)\r\n\t\t\t\t\t\t\t\tunchanged[unchangedIndex++] = originalIndex++;\r\n\t\t\t\t\t\t\t// Set changed items.\r\n\t\t\t\t\t\t\tdrawOrder[originalIndex + offsetMap.offset] = originalIndex++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Collect remaining unchanged items.\r\n\t\t\t\t\t\twhile (originalIndex < slotCount)\r\n\t\t\t\t\t\t\tunchanged[unchangedIndex++] = originalIndex++;\r\n\t\t\t\t\t\t// Fill in unchanged items.\r\n\t\t\t\t\t\tfor (let i = slotCount - 1; i >= 0; i--)\r\n\t\t\t\t\t\t\tif (drawOrder[i] == -1) drawOrder[i] = unchanged[--unchangedIndex];\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimeline.setFrame(frameIndex++, this.getValue(drawOrderMap, \"time\", 0), drawOrder);\r\n\t\t\t\t}\r\n\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\tduration = Math.max(duration, timeline.frames[timeline.getFrameCount() - 1]);\r\n\t\t\t}\r\n\r\n\t\t\t// Event timeline.\r\n\t\t\tif (map.events) {\r\n\t\t\t\tlet timeline = new EventTimeline(map.events.length);\r\n\t\t\t\tlet frameIndex = 0;\r\n\t\t\t\tfor (let i = 0; i < map.events.length; i++) {\r\n\t\t\t\t\tlet eventMap = map.events[i];\r\n\t\t\t\t\tlet eventData = skeletonData.findEvent(eventMap.name);\r\n\t\t\t\t\tif (eventData == null) throw new Error(\"Event not found: \" + eventMap.name);\r\n\t\t\t\t\tlet event = new Event(Utils.toSinglePrecision(this.getValue(eventMap, \"time\", 0)), eventData);\r\n\t\t\t\t\tevent.intValue = this.getValue(eventMap, \"int\", eventData.intValue);\r\n\t\t\t\t\tevent.floatValue = this.getValue(eventMap, \"float\", eventData.floatValue);\r\n\t\t\t\t\tevent.stringValue = this.getValue(eventMap, \"string\", eventData.stringValue);\r\n\t\t\t\t\tif (event.data.audioPath != null) {\r\n\t\t\t\t\t\tevent.volume = this.getValue(eventMap, \"volume\", 1);\r\n\t\t\t\t\t\tevent.balance = this.getValue(eventMap, \"balance\", 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimeline.setFrame(frameIndex++, event);\r\n\t\t\t\t}\r\n\t\t\t\ttimelines.push(timeline);\r\n\t\t\t\tduration = Math.max(duration, timeline.frames[timeline.getFrameCount() - 1]);\r\n\t\t\t}\r\n\r\n\t\t\tif (isNaN(duration)) {\r\n\t\t\t\tthrow new Error(\"Error while parsing animation, duration is NaN\");\r\n\t\t\t}\r\n\r\n\t\t\tskeletonData.animations.push(new Animation(name, timelines, duration));\r\n\t\t}\r\n\r\n\t\treadCurve (map: any, timeline: CurveTimeline, frameIndex: number) {\r\n\t\t\tif (!map.hasOwnProperty(\"curve\")) return;\r\n\t\t\tif (map.curve == \"stepped\")\r\n\t\t\t\ttimeline.setStepped(frameIndex);\r\n\t\t\telse {\r\n\t\t\t\tlet curve: number = map.curve;\r\n\t\t\t\ttimeline.setCurve(frameIndex, curve, this.getValue(map, \"c2\", 0), this.getValue(map, \"c3\", 1), this.getValue(map, \"c4\", 1));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tgetValue (map: any, prop: string, defaultValue: any) {\r\n\t\t\treturn map[prop] !== undefined ? map[prop] : defaultValue;\r\n\t\t}\r\n\r\n\t\tstatic blendModeFromString (str: string) {\r\n\t\t\tstr = str.toLowerCase();\r\n\t\t\tif (str == \"normal\") return BlendMode.Normal;\r\n\t\t\tif (str == \"additive\") return BlendMode.Additive;\r\n\t\t\tif (str == \"multiply\") return BlendMode.Multiply;\r\n\t\t\tif (str == \"screen\") return BlendMode.Screen;\r\n\t\t\tthrow new Error(`Unknown blend mode: ${str}`);\r\n\t\t}\r\n\r\n\t\tstatic positionModeFromString (str: string) {\r\n\t\t\tstr = str.toLowerCase();\r\n\t\t\tif (str == \"fixed\") return PositionMode.Fixed;\r\n\t\t\tif (str == \"percent\") return PositionMode.Percent;\r\n\t\t\tthrow new Error(`Unknown position mode: ${str}`);\r\n\t\t}\r\n\r\n\t\tstatic spacingModeFromString (str: string) {\r\n\t\t\tstr = str.toLowerCase();\r\n\t\t\tif (str == \"length\") return SpacingMode.Length;\r\n\t\t\tif (str == \"fixed\") return SpacingMode.Fixed;\r\n\t\t\tif (str == \"percent\") return SpacingMode.Percent;\r\n\t\t\tthrow new Error(`Unknown position mode: ${str}`);\r\n\t\t}\r\n\r\n\t\tstatic rotateModeFromString (str: string) {\r\n\t\t\tstr = str.toLowerCase();\r\n\t\t\tif (str == \"tangent\") return RotateMode.Tangent;\r\n\t\t\tif (str == \"chain\") return RotateMode.Chain;\r\n\t\t\tif (str == \"chainscale\") return RotateMode.ChainScale;\r\n\t\t\tthrow new Error(`Unknown rotate mode: ${str}`);\r\n\t\t}\r\n\r\n\t\tstatic transformModeFromString(str: string) {\r\n\t\t\tstr = str.toLowerCase();\r\n\t\t\tif (str == \"normal\") return TransformMode.Normal;\r\n\t\t\tif (str == \"onlytranslation\") return TransformMode.OnlyTranslation;\r\n\t\t\tif (str == \"norotationorreflection\") return TransformMode.NoRotationOrReflection;\r\n\t\t\tif (str == \"noscale\") return TransformMode.NoScale;\r\n\t\t\tif (str == \"noscaleorreflection\") return TransformMode.NoScaleOrReflection;\r\n\t\t\tthrow new Error(`Unknown transform mode: ${str}`);\r\n\t\t}\r\n\t}\r\n\r\n\tclass LinkedMesh {\r\n\t\tparent: string; skin: string;\r\n\t\tslotIndex: number;\r\n\t\tmesh: MeshAttachment;\r\n\t\tinheritDeform: boolean;\r\n\r\n\t\tconstructor (mesh: MeshAttachment, skin: string, slotIndex: number, parent: string, inheritDeform: boolean) {\r\n\t\t\tthis.mesh = mesh;\r\n\t\t\tthis.skin = skin;\r\n\t\t\tthis.slotIndex = slotIndex;\r\n\t\t\tthis.parent = parent;\r\n\t\t\tthis.inheritDeform = inheritDeform;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Pool } from \"../core/Utils\";\r\n\r\n// module spine.webgl {\r\n\texport class Input {\r\n\t\telement: HTMLElement;\r\n\t\tlastX = 0;\r\n\t\tlastY = 0;\r\n\t\tbuttonDown = false;\r\n\t\tcurrTouch: Touch = null;\r\n\t\ttouchesPool = new Pool<Touch>(() => {\r\n\t\t\treturn new Touch(0, 0, 0);\r\n\t\t});\r\n\r\n\t\tprivate listeners = new Array<InputListener>();\r\n\t\tconstructor (element: HTMLElement) {\r\n\t\t\tthis.element = element;\r\n\t\t\tthis.setupCallbacks(element);\r\n\t\t}\r\n\r\n\t\tprivate setupCallbacks(element: HTMLElement) {\r\n\t\t\tlet mouseDown = (ev: UIEvent) => {\r\n\t\t\t\tif (ev instanceof MouseEvent) {\r\n\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\tlet x = ev.clientX - rect.left;\r\n\t\t\t\t\tlet y = ev.clientY - rect.top;\r\n\r\n\t\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\t\tif (listeners[i].down) listeners[i].down(x, y);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.lastX = x;\r\n\t\t\t\t\tthis.lastY = y;\r\n\t\t\t\t\tthis.buttonDown = true;\r\n\r\n\t\t\t\t\tdocument.addEventListener(\"mousemove\", mouseMove);\r\n\t\t\t\t\tdocument.addEventListener(\"mouseup\", mouseUp);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet mouseMove = (ev: UIEvent) => {\r\n\t\t\t\tif (ev instanceof MouseEvent) {\r\n\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\tlet x = ev.clientX - rect.left;\r\n\t\t\t\t\tlet y = ev.clientY - rect.top;\r\n\r\n\t\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\t\tif (this.buttonDown) {\r\n\t\t\t\t\t\t\tif (listeners[i].dragged) listeners[i].dragged(x, y);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (listeners[i].moved) listeners[i].moved(x, y);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.lastX = x;\r\n\t\t\t\t\tthis.lastY = y;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tlet mouseUp = (ev: UIEvent) => {\r\n\t\t\t\tif (ev instanceof MouseEvent) {\r\n\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\tlet x = ev.clientX - rect.left;\r\n\t\t\t\t\tlet y = ev.clientY - rect.top;\r\n\r\n\t\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\t\tif (listeners[i].up) listeners[i].up(x, y);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.lastX = x;\r\n\t\t\t\t\tthis.lastY = y;\r\n\t\t\t\t\tthis.buttonDown = false;\r\n\t\t\t\t\tdocument.removeEventListener(\"mousemove\", mouseMove);\r\n\t\t\t\t\tdocument.removeEventListener(\"mouseup\", mouseUp);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\r\n\t\t\telement.addEventListener(\"mousedown\", mouseDown, true);\r\n\t\t\telement.addEventListener(\"mousemove\", mouseMove, true);\r\n\t\t\telement.addEventListener(\"mouseup\", mouseUp, true);\r\n\t\t\telement.addEventListener(\"touchstart\", (ev: TouchEvent) => {\r\n\t\t\t\tif (this.currTouch != null) return;\r\n\r\n\t\t\t\tvar touches = ev.changedTouches;\r\n\t\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\t\tvar touch = touches[i];\r\n\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\tlet x = touch.clientX - rect.left;\r\n\t\t\t\t\tlet y = touch.clientY - rect.top;\r\n\t\t\t\t\tthis.currTouch = this.touchesPool.obtain();\r\n\t\t\t\t\tthis.currTouch.identifier = touch.identifier;\r\n\t\t\t\t\tthis.currTouch.x = x;\r\n\t\t\t\t\tthis.currTouch.y = y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\tif (listeners[i].down) listeners[i].down(this.currTouch.x, this.currTouch.y);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.lastX = this.currTouch.x;\r\n\t\t\t\tthis.lastY = this.currTouch.y;\r\n\t\t\t\tthis.buttonDown = true;\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}, false);\r\n\t\t\telement.addEventListener(\"touchend\", (ev: TouchEvent) => {\r\n\t\t\t\tvar touches = ev.changedTouches;\r\n\t\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\t\tvar touch = touches[i];\r\n\t\t\t\t\tif (this.currTouch.identifier === touch.identifier) {\r\n\t\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\t\tlet x = this.currTouch.x = touch.clientX - rect.left;\r\n\t\t\t\t\t\tlet y = this.currTouch.y = touch.clientY - rect.top;\r\n\t\t\t\t\t\tthis.touchesPool.free(this.currTouch);\r\n\t\t\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\t\t\tif (listeners[i].up) listeners[i].up(x, y);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.lastX = x;\r\n\t\t\t\t\t\tthis.lastY = y;\r\n\t\t\t\t\t\tthis.buttonDown = false;\r\n\t\t\t\t\t\tthis.currTouch = null;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}, false);\r\n\t\t\telement.addEventListener(\"touchcancel\", (ev: TouchEvent) => {\r\n\t\t\t\tvar touches = ev.changedTouches;\r\n\t\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\t\tvar touch = touches[i];\r\n\t\t\t\t\tif (this.currTouch.identifier === touch.identifier) {\r\n\t\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\t\tlet x = this.currTouch.x = touch.clientX - rect.left;\r\n\t\t\t\t\t\tlet y = this.currTouch.y = touch.clientY - rect.top;\r\n\t\t\t\t\t\tthis.touchesPool.free(this.currTouch);\r\n\t\t\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\t\t\tif (listeners[i].up) listeners[i].up(x, y);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.lastX = x;\r\n\t\t\t\t\t\tthis.lastY = y;\r\n\t\t\t\t\t\tthis.buttonDown = false;\r\n\t\t\t\t\t\tthis.currTouch = null;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}, false);\r\n\t\t\telement.addEventListener(\"touchmove\", (ev: TouchEvent) => {\r\n\t\t\t\tif (this.currTouch == null) return;\r\n\r\n\t\t\t\tvar touches = ev.changedTouches;\r\n\t\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\t\tvar touch = touches[i];\r\n\t\t\t\t\tif (this.currTouch.identifier === touch.identifier) {\r\n\t\t\t\t\t\tlet rect = element.getBoundingClientRect();\r\n\t\t\t\t\t\tlet x = touch.clientX - rect.left;\r\n\t\t\t\t\t\tlet y = touch.clientY - rect.top;\r\n\r\n\t\t\t\t\t\tlet listeners = this.listeners;\r\n\t\t\t\t\t\tfor (let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\t\t\tif (listeners[i].dragged) listeners[i].dragged(x, y);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.lastX = this.currTouch.x = x;\r\n\t\t\t\t\t\tthis.lastY = this.currTouch.y = y;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}, false);\r\n\t\t}\r\n\r\n\t\taddListener(listener: InputListener) {\r\n\t\t\tthis.listeners.push(listener);\r\n\t\t}\r\n\r\n\t\tremoveListener(listener: InputListener) {\r\n\t\t\tlet idx = this.listeners.indexOf(listener);\r\n\t\t\tif (idx > -1) {\r\n\t\t\t\tthis.listeners.splice(idx, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport class Touch {\r\n\t\tconstructor(public identifier: number, public x: number, public y: number) {\r\n\t\t}\r\n\t}\r\n\r\n\texport interface InputListener {\r\n\t\tdown(x: number, y: number): void;\r\n\t\tup(x: number, y: number): void;\r\n\t\tmoved(x: number, y: number): void;\r\n\t\tdragged(x: number, y: number): void;\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Matrix4, M30, M31, M32, M33, M00, M01, M02, M03, M10, M11, M12, M13, M20, M21, M22, M23 } from \"./Matrix4\";\r\n\r\n// module spine.webgl {\r\n\texport class Vector3 {\r\n\t\tx = 0;\r\n\t\ty = 0;\r\n\t\tz = 0;\r\n\t\tw = 0;\r\n\r\n\t\tconstructor (x: number = 0, y: number = 0, z: number = 0) {\r\n\t\t\tthis.x = x;\r\n\t\t\tthis.y = y;\r\n\t\t\tthis.z = z;\r\n\t\t}\r\n\r\n\t\tsetFrom(v: Vector3): Vector3 {\r\n\t\t\tthis.x = v.x;\r\n\t\t\tthis.y = v.y;\r\n\t\t\tthis.z = v.z;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tset (x: number, y: number, z: number): Vector3 {\r\n\t\t\tthis.x = x;\r\n\t\t\tthis.y = y;\r\n\t\t\tthis.z = z;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tadd (v: Vector3): Vector3 {\r\n\t\t\tthis.x += v.x;\r\n\t\t\tthis.y += v.y;\r\n\t\t\tthis.z += v.z;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tsub (v: Vector3): Vector3 {\r\n\t\t\tthis.x -= v.x;\r\n\t\t\tthis.y -= v.y;\r\n\t\t\tthis.z -= v.z;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tscale (s: number): Vector3 {\r\n\t\t\tthis.x *= s;\r\n\t\t\tthis.y *= s;\r\n\t\t\tthis.z *= s;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tnormalize (): Vector3 {\r\n\t\t\tlet len = this.length();\r\n\t\t\tif (len == 0) return this;\r\n\t\t\tlen = 1 / len;\r\n\t\t\tthis.x *= len;\r\n\t\t\tthis.y *= len;\r\n\t\t\tthis.z *= len;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tcross (v: Vector3): Vector3 {\r\n\t\t\treturn this.set(this.y * v.z - this.z * v.y, this.z * v.x - this.x * v.z, this.x * v.y - this.y * v.x)\r\n\t\t}\r\n\r\n\t\tmultiply (matrix: Matrix4): Vector3 {\r\n\t\t\tlet l_mat = matrix.values;\r\n\t\t\tthis.w = this.x * l_mat[M30] + this.y * l_mat[M31] + this.z * l_mat[M32] + l_mat[M33];\r\n\t\t\treturn this.set(\r\n\t\t\t\tthis.x * l_mat[M00] + this.y * l_mat[M01] + this.z * l_mat[M02] + l_mat[M03],\r\n\t\t\t\tthis.x * l_mat[M10] + this.y * l_mat[M11] + this.z * l_mat[M12] + l_mat[M13],\r\n\t\t\t\tthis.x * l_mat[M20] + this.y * l_mat[M21] + this.z * l_mat[M22] + l_mat[M23]);\r\n\t\t}\r\n\r\n\t\tproject (matrix: Matrix4): Vector3 {\r\n\t\t\tlet l_mat = matrix.values;\r\n\t\t\tthis.w = (this.x * l_mat[M30] + this.y * l_mat[M31] + this.z * l_mat[M32] + l_mat[M33]);\r\n\t\t\tlet l_w = 1 / this.w;\r\n\t\t\treturn this.set(\r\n\t\t\t\t(this.x * l_mat[M00] + this.y * l_mat[M01] + this.z * l_mat[M02] + l_mat[M03]) * l_w,\r\n\t\t\t\t(this.x * l_mat[M10] + this.y * l_mat[M11] + this.z * l_mat[M12] + l_mat[M13]) * l_w,\r\n\t\t\t\t(this.x * l_mat[M20] + this.y * l_mat[M21] + this.z * l_mat[M22] + l_mat[M23]) * l_w);\r\n\t\t}\r\n\r\n\t\tdot (v: Vector3): number {\r\n\t\t\treturn this.x * v.x + this.y * v.y + this.z * v.z;\r\n\t\t}\r\n\r\n\t\tlength (): number {\r\n\t\t\treturn Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\r\n\t\t}\r\n\r\n\t\tdistance (v: Vector3): number {\r\n\t\t\tlet a = v.x - this.x;\r\n\t\t\tlet b = v.y - this.y;\r\n\t\t\tlet c = v.z - this.z;\r\n\t\t\treturn Math.sqrt(a * a + b * b + c * c);\r\n\t\t}\r\n\r\n\t\tcopy(): Vector3 {\r\n\t\t\treturn new Vector3(this.x, this.y, this.z);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Vector3 } from \"./Vector3\";\r\n\r\n// module spine.webgl {\r\n\texport const M00 = 0;\r\n\texport const M01 = 4;\r\n\texport const M02 = 8;\r\n\texport const M03 = 12;\r\n\texport const M10 = 1;\r\n\texport const M11 = 5;\r\n\texport const M12 = 9;\r\n\texport const M13 = 13;\r\n\texport const M20 = 2;\r\n\texport const M21 = 6;\r\n\texport const M22 = 10;\r\n\texport const M23 = 14;\r\n\texport const M30 = 3;\r\n\texport const M31 = 7;\r\n\texport const M32 = 11;\r\n\texport const M33 = 15;\r\n\r\n\texport class Matrix4 {\r\n\t\ttemp: Float32Array = new Float32Array(16);\r\n\t\tvalues: Float32Array = new Float32Array(16);\r\n\r\n\t\tprivate static xAxis: Vector3 = null;\r\n\t\tprivate static yAxis: Vector3 = null;\r\n\t\tprivate static zAxis: Vector3 = null;\r\n\t\tprivate static tmpMatrix = new Matrix4();\r\n\r\n\t\tconstructor () {\r\n\t\t\tlet v = this.values;\r\n\t\t\tthis.identity();\r\n\t\t\tv[M00] = 1;\r\n\t\t\tv[M11] = 1;\r\n\t\t\tv[M22] = 1;\r\n\t\t\tv[M33] = 1;\r\n\t\t}\r\n\r\n\t\tset (values: ArrayLike<number>): Matrix4 {\r\n\t\t\tthis.values.set(values);\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\ttranspose (): Matrix4 {\r\n\t\t\tlet t = this.temp;\r\n\t\t\tlet v = this.values;\r\n\t\t\tt[M00] = v[M00];\r\n\t\t\tt[M01] = v[M10];\r\n\t\t\tt[M02] = v[M20];\r\n\t\t\tt[M03] = v[M30];\r\n\t\t\tt[M10] = v[M01];\r\n\t\t\tt[M11] = v[M11];\r\n\t\t\tt[M12] = v[M21];\r\n\t\t\tt[M13] = v[M31];\r\n\t\t\tt[M20] = v[M02];\r\n\t\t\tt[M21] = v[M12];\r\n\t\t\tt[M22] = v[M22];\r\n\t\t\tt[M23] = v[M32];\r\n\t\t\tt[M30] = v[M03];\r\n\t\t\tt[M31] = v[M13];\r\n\t\t\tt[M32] = v[M23];\r\n\t\t\tt[M33] = v[M33];\r\n\t\t\treturn this.set(t);\r\n\t\t}\r\n\r\n\t\tidentity (): Matrix4 {\r\n\t\t\tlet v = this.values;\r\n\t\t\tv[M00] = 1;\r\n\t\t\tv[M01] = 0;\r\n\t\t\tv[M02] = 0;\r\n\t\t\tv[M03] = 0;\r\n\t\t\tv[M10] = 0;\r\n\t\t\tv[M11] = 1;\r\n\t\t\tv[M12] = 0;\r\n\t\t\tv[M13] = 0;\r\n\t\t\tv[M20] = 0;\r\n\t\t\tv[M21] = 0;\r\n\t\t\tv[M22] = 1;\r\n\t\t\tv[M23] = 0;\r\n\t\t\tv[M30] = 0;\r\n\t\t\tv[M31] = 0;\r\n\t\t\tv[M32] = 0;\r\n\t\t\tv[M33] = 1;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tinvert (): Matrix4 {\r\n\t\t\tlet v = this.values;\r\n\t\t\tlet t = this.temp;\r\n\t\t\tlet l_det = v[M30] * v[M21] * v[M12] * v[M03] - v[M20] * v[M31] * v[M12] * v[M03] - v[M30] * v[M11] * v[M22] * v[M03]\r\n\t\t\t\t+ v[M10] * v[M31] * v[M22] * v[M03] + v[M20] * v[M11] * v[M32] * v[M03] - v[M10] * v[M21] * v[M32] * v[M03]\r\n\t\t\t\t- v[M30] * v[M21] * v[M02] * v[M13] + v[M20] * v[M31] * v[M02] * v[M13] + v[M30] * v[M01] * v[M22] * v[M13]\r\n\t\t\t\t- v[M00] * v[M31] * v[M22] * v[M13] - v[M20] * v[M01] * v[M32] * v[M13] + v[M00] * v[M21] * v[M32] * v[M13]\r\n\t\t\t\t+ v[M30] * v[M11] * v[M02] * v[M23] - v[M10] * v[M31] * v[M02] * v[M23] - v[M30] * v[M01] * v[M12] * v[M23]\r\n\t\t\t\t+ v[M00] * v[M31] * v[M12] * v[M23] + v[M10] * v[M01] * v[M32] * v[M23] - v[M00] * v[M11] * v[M32] * v[M23]\r\n\t\t\t\t- v[M20] * v[M11] * v[M02] * v[M33] + v[M10] * v[M21] * v[M02] * v[M33] + v[M20] * v[M01] * v[M12] * v[M33]\r\n\t\t\t\t- v[M00] * v[M21] * v[M12] * v[M33] - v[M10] * v[M01] * v[M22] * v[M33] + v[M00] * v[M11] * v[M22] * v[M33];\r\n\t\t\tif (l_det == 0) throw new Error(\"non-invertible matrix\");\r\n\t\t\tlet inv_det = 1.0 / l_det;\r\n\t\t\tt[M00] = v[M12] * v[M23] * v[M31] - v[M13] * v[M22] * v[M31] + v[M13] * v[M21] * v[M32]\r\n\t\t\t\t- v[M11] * v[M23] * v[M32] - v[M12] * v[M21] * v[M33] + v[M11] * v[M22] * v[M33];\r\n\t\t\tt[M01] = v[M03] * v[M22] * v[M31] - v[M02] * v[M23] * v[M31] - v[M03] * v[M21] * v[M32]\r\n\t\t\t\t+ v[M01] * v[M23] * v[M32] + v[M02] * v[M21] * v[M33] - v[M01] * v[M22] * v[M33];\r\n\t\t\tt[M02] = v[M02] * v[M13] * v[M31] - v[M03] * v[M12] * v[M31] + v[M03] * v[M11] * v[M32]\r\n\t\t\t\t- v[M01] * v[M13] * v[M32] - v[M02] * v[M11] * v[M33] + v[M01] * v[M12] * v[M33];\r\n\t\t\tt[M03] = v[M03] * v[M12] * v[M21] - v[M02] * v[M13] * v[M21] - v[M03] * v[M11] * v[M22]\r\n\t\t\t\t+ v[M01] * v[M13] * v[M22] + v[M02] * v[M11] * v[M23] - v[M01] * v[M12] * v[M23];\r\n\t\t\tt[M10] = v[M13] * v[M22] * v[M30] - v[M12] * v[M23] * v[M30] - v[M13] * v[M20] * v[M32]\r\n\t\t\t\t+ v[M10] * v[M23] * v[M32] + v[M12] * v[M20] * v[M33] - v[M10] * v[M22] * v[M33];\r\n\t\t\tt[M11] = v[M02] * v[M23] * v[M30] - v[M03] * v[M22] * v[M30] + v[M03] * v[M20] * v[M32]\r\n\t\t\t\t- v[M00] * v[M23] * v[M32] - v[M02] * v[M20] * v[M33] + v[M00] * v[M22] * v[M33];\r\n\t\t\tt[M12] = v[M03] * v[M12] * v[M30] - v[M02] * v[M13] * v[M30] - v[M03] * v[M10] * v[M32]\r\n\t\t\t\t+ v[M00] * v[M13] * v[M32] + v[M02] * v[M10] * v[M33] - v[M00] * v[M12] * v[M33];\r\n\t\t\tt[M13] = v[M02] * v[M13] * v[M20] - v[M03] * v[M12] * v[M20] + v[M03] * v[M10] * v[M22]\r\n\t\t\t\t- v[M00] * v[M13] * v[M22] - v[M02] * v[M10] * v[M23] + v[M00] * v[M12] * v[M23];\r\n\t\t\tt[M20] = v[M11] * v[M23] * v[M30] - v[M13] * v[M21] * v[M30] + v[M13] * v[M20] * v[M31]\r\n\t\t\t\t- v[M10] * v[M23] * v[M31] - v[M11] * v[M20] * v[M33] + v[M10] * v[M21] * v[M33];\r\n\t\t\tt[M21] = v[M03] * v[M21] * v[M30] - v[M01] * v[M23] * v[M30] - v[M03] * v[M20] * v[M31]\r\n\t\t\t\t+ v[M00] * v[M23] * v[M31] + v[M01] * v[M20] * v[M33] - v[M00] * v[M21] * v[M33];\r\n\t\t\tt[M22] = v[M01] * v[M13] * v[M30] - v[M03] * v[M11] * v[M30] + v[M03] * v[M10] * v[M31]\r\n\t\t\t\t- v[M00] * v[M13] * v[M31] - v[M01] * v[M10] * v[M33] + v[M00] * v[M11] * v[M33];\r\n\t\t\tt[M23] = v[M03] * v[M11] * v[M20] - v[M01] * v[M13] * v[M20] - v[M03] * v[M10] * v[M21]\r\n\t\t\t\t+ v[M00] * v[M13] * v[M21] + v[M01] * v[M10] * v[M23] - v[M00] * v[M11] * v[M23];\r\n\t\t\tt[M30] = v[M12] * v[M21] * v[M30] - v[M11] * v[M22] * v[M30] - v[M12] * v[M20] * v[M31]\r\n\t\t\t\t+ v[M10] * v[M22] * v[M31] + v[M11] * v[M20] * v[M32] - v[M10] * v[M21] * v[M32];\r\n\t\t\tt[M31] = v[M01] * v[M22] * v[M30] - v[M02] * v[M21] * v[M30] + v[M02] * v[M20] * v[M31]\r\n\t\t\t\t- v[M00] * v[M22] * v[M31] - v[M01] * v[M20] * v[M32] + v[M00] * v[M21] * v[M32];\r\n\t\t\tt[M32] = v[M02] * v[M11] * v[M30] - v[M01] * v[M12] * v[M30] - v[M02] * v[M10] * v[M31]\r\n\t\t\t\t+ v[M00] * v[M12] * v[M31] + v[M01] * v[M10] * v[M32] - v[M00] * v[M11] * v[M32];\r\n\t\t\tt[M33] = v[M01] * v[M12] * v[M20] - v[M02] * v[M11] * v[M20] + v[M02] * v[M10] * v[M21]\r\n\t\t\t\t- v[M00] * v[M12] * v[M21] - v[M01] * v[M10] * v[M22] + v[M00] * v[M11] * v[M22];\r\n\t\t\tv[M00] = t[M00] * inv_det;\r\n\t\t\tv[M01] = t[M01] * inv_det;\r\n\t\t\tv[M02] = t[M02] * inv_det;\r\n\t\t\tv[M03] = t[M03] * inv_det;\r\n\t\t\tv[M10] = t[M10] * inv_det;\r\n\t\t\tv[M11] = t[M11] * inv_det;\r\n\t\t\tv[M12] = t[M12] * inv_det;\r\n\t\t\tv[M13] = t[M13] * inv_det;\r\n\t\t\tv[M20] = t[M20] * inv_det;\r\n\t\t\tv[M21] = t[M21] * inv_det;\r\n\t\t\tv[M22] = t[M22] * inv_det;\r\n\t\t\tv[M23] = t[M23] * inv_det;\r\n\t\t\tv[M30] = t[M30] * inv_det;\r\n\t\t\tv[M31] = t[M31] * inv_det;\r\n\t\t\tv[M32] = t[M32] * inv_det;\r\n\t\t\tv[M33] = t[M33] * inv_det;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tdeterminant (): number {\r\n\t\t\tlet v = this.values;\r\n\t\t\treturn v[M30] * v[M21] * v[M12] * v[M03] - v[M20] * v[M31] * v[M12] * v[M03] - v[M30] * v[M11] * v[M22] * v[M03]\r\n\t\t\t\t+ v[M10] * v[M31] * v[M22] * v[M03] + v[M20] * v[M11] * v[M32] * v[M03] - v[M10] * v[M21] * v[M32] * v[M03]\r\n\t\t\t\t- v[M30] * v[M21] * v[M02] * v[M13] + v[M20] * v[M31] * v[M02] * v[M13] + v[M30] * v[M01] * v[M22] * v[M13]\r\n\t\t\t\t- v[M00] * v[M31] * v[M22] * v[M13] - v[M20] * v[M01] * v[M32] * v[M13] + v[M00] * v[M21] * v[M32] * v[M13]\r\n\t\t\t\t+ v[M30] * v[M11] * v[M02] * v[M23] - v[M10] * v[M31] * v[M02] * v[M23] - v[M30] * v[M01] * v[M12] * v[M23]\r\n\t\t\t\t+ v[M00] * v[M31] * v[M12] * v[M23] + v[M10] * v[M01] * v[M32] * v[M23] - v[M00] * v[M11] * v[M32] * v[M23]\r\n\t\t\t\t- v[M20] * v[M11] * v[M02] * v[M33] + v[M10] * v[M21] * v[M02] * v[M33] + v[M20] * v[M01] * v[M12] * v[M33]\r\n\t\t\t\t- v[M00] * v[M21] * v[M12] * v[M33] - v[M10] * v[M01] * v[M22] * v[M33] + v[M00] * v[M11] * v[M22] * v[M33];\r\n\t\t}\r\n\r\n\t\ttranslate (x: number, y: number, z: number): Matrix4 {\r\n\t\t\tlet v = this.values;\r\n\t\t\tv[M03] += x;\r\n\t\t\tv[M13] += y;\r\n\t\t\tv[M23] += z;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tcopy (): Matrix4 {\r\n\t\t\treturn new Matrix4().set(this.values);\r\n\t\t}\r\n\r\n\t\tprojection (front: number, back: number, fovy: number, aspectRatio: number): Matrix4 {\r\n\t\t\tthis.identity();\r\n\t\t\tlet fovy_rad = fovy * (Math.PI / 180);\r\n\t\t\tlet tangent = Math.tan(fovy_rad / 2.0);\r\n\t\t\tlet itangent = 1.0 / tangent;\r\n\t\t\tlet top = front * itangent;\r\n\t\t\tlet right = top * aspectRatio;\r\n\t\t\t\r\n\t\t\tlet v = this.values;\r\n\t\t\tv[M00] = front / right\r\n\t\t\tv[M10] = 0;\r\n\t\t\tv[M20] = 0;\r\n\t\t\tv[M30] = 0;\r\n\t\t\tv[M01] = 0;\r\n\t\t\tv[M11] = front / top;\r\n\t\t\tv[M21] = 0;\r\n\t\t\tv[M31] = 0;\r\n\t\t\tv[M02] = 0;\r\n\t\t\tv[M12] = 0;\r\n\t\t\tv[M22] = -(back +front) / (back - front);\r\n\t\t\tv[M32] = -1;\r\n\t\t\tv[M03] = 0;\r\n\t\t\tv[M13] = 0;\r\n\t\t\tv[M23] = -(2*back*front) / (back - front);\r\n\t\t\tv[M33] = 0;\r\n\r\n\t\t\t// let fovy_rad = fovy * (Math.PI / 180);\r\n\t\t\t// let l_fd = (1.0 / Math.tan(fovy_rad / 2.0));\r\n\t\t\t// let l_a1 = (far + near) / (near - far);\r\n\t\t\t// let l_a2 = (2 * far * near) / (near - far);\r\n\t\t\t// let v = this.values;\r\n\t\t\t// v[M00] = l_fd / aspectRatio;\r\n\t\t\t// v[M10] = 0;\r\n\t\t\t// v[M20] = 0;\r\n\t\t\t// v[M30] = 0;\r\n\t\t\t// v[M01] = 0;\r\n\t\t\t// v[M11] = l_fd;\r\n\t\t\t// v[M21] = 0;\r\n\t\t\t// v[M31] = 0;\r\n\t\t\t// v[M02] = 0;\r\n\t\t\t// v[M12] = 0;\r\n\t\t\t// v[M22] = l_a1;\r\n\t\t\t// v[M32] = -1;\r\n\t\t\t// v[M03] = 0;\r\n\t\t\t// v[M13] = 0;\r\n\t\t\t// v[M23] = l_a2;\r\n\t\t\t// v[M33] = 0;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tortho2d (x: number, y: number, width: number, height: number): Matrix4 {\r\n\t\t\treturn this.ortho(x, x + width, y, y + height, 0, 1);\r\n\t\t}\r\n\r\n\t\tortho (left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix4 {\r\n\t\t\tthis.identity();\r\n\t\t\tlet x_orth = 2 / (right - left);\r\n\t\t\tlet y_orth = 2 / (top - bottom);\r\n\t\t\tlet z_orth = -2 / (far - near);\r\n\r\n\t\t\tlet tx = -(right + left) / (right - left);\r\n\t\t\tlet ty = -(top + bottom) / (top - bottom);\r\n\t\t\tlet tz = -(far + near) / (far - near);\r\n\r\n\t\t\tlet v = this.values;\r\n\t\t\tv[M00] = x_orth;\r\n\t\t\tv[M10] = 0;\r\n\t\t\tv[M20] = 0;\r\n\t\t\tv[M30] = 0;\r\n\t\t\tv[M01] = 0;\r\n\t\t\tv[M11] = y_orth;\r\n\t\t\tv[M21] = 0;\r\n\t\t\tv[M31] = 0;\r\n\t\t\tv[M02] = 0;\r\n\t\t\tv[M12] = 0;\r\n\t\t\tv[M22] = z_orth;\r\n\t\t\tv[M32] = 0;\r\n\t\t\tv[M03] = tx;\r\n\t\t\tv[M13] = ty;\r\n\t\t\tv[M23] = tz;\r\n\t\t\tv[M33] = 1;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tmultiply (matrix: Matrix4): Matrix4 {\r\n\t\t\tlet t = this.temp;\r\n\t\t\tlet v = this.values;\r\n\t\t\tlet m = matrix.values;\r\n\t\t\tt[M00] = v[M00] * m[M00] + v[M01] * m[M10] + v[M02] * m[M20] + v[M03] * m[M30];\r\n\t\t\tt[M01] = v[M00] * m[M01] + v[M01] * m[M11] + v[M02] * m[M21] + v[M03] * m[M31];\r\n\t\t\tt[M02] = v[M00] * m[M02] + v[M01] * m[M12] + v[M02] * m[M22] + v[M03] * m[M32];\r\n\t\t\tt[M03] = v[M00] * m[M03] + v[M01] * m[M13] + v[M02] * m[M23] + v[M03] * m[M33];\r\n\t\t\tt[M10] = v[M10] * m[M00] + v[M11] * m[M10] + v[M12] * m[M20] + v[M13] * m[M30];\r\n\t\t\tt[M11] = v[M10] * m[M01] + v[M11] * m[M11] + v[M12] * m[M21] + v[M13] * m[M31];\r\n\t\t\tt[M12] = v[M10] * m[M02] + v[M11] * m[M12] + v[M12] * m[M22] + v[M13] * m[M32];\r\n\t\t\tt[M13] = v[M10] * m[M03] + v[M11] * m[M13] + v[M12] * m[M23] + v[M13] * m[M33];\r\n\t\t\tt[M20] = v[M20] * m[M00] + v[M21] * m[M10] + v[M22] * m[M20] + v[M23] * m[M30];\r\n\t\t\tt[M21] = v[M20] * m[M01] + v[M21] * m[M11] + v[M22] * m[M21] + v[M23] * m[M31];\r\n\t\t\tt[M22] = v[M20] * m[M02] + v[M21] * m[M12] + v[M22] * m[M22] + v[M23] * m[M32];\r\n\t\t\tt[M23] = v[M20] * m[M03] + v[M21] * m[M13] + v[M22] * m[M23] + v[M23] * m[M33];\r\n\t\t\tt[M30] = v[M30] * m[M00] + v[M31] * m[M10] + v[M32] * m[M20] + v[M33] * m[M30];\r\n\t\t\tt[M31] = v[M30] * m[M01] + v[M31] * m[M11] + v[M32] * m[M21] + v[M33] * m[M31];\r\n\t\t\tt[M32] = v[M30] * m[M02] + v[M31] * m[M12] + v[M32] * m[M22] + v[M33] * m[M32];\r\n\t\t\tt[M33] = v[M30] * m[M03] + v[M31] * m[M13] + v[M32] * m[M23] + v[M33] * m[M33];\r\n\t\t\treturn this.set(this.temp);\r\n\t\t}\r\n\r\n\t\tmultiplyLeft (matrix: Matrix4): Matrix4 {\r\n\t\t\tlet t = this.temp;\r\n\t\t\tlet v = this.values;\r\n\t\t\tlet m = matrix.values;\r\n\t\t\tt[M00] = m[M00] * v[M00] + m[M01] * v[M10] + m[M02] * v[M20] + m[M03] * v[M30];\r\n\t\t\tt[M01] = m[M00] * v[M01] + m[M01] * v[M11] + m[M02] * v[M21] + m[M03] * v[M31];\r\n\t\t\tt[M02] = m[M00] * v[M02] + m[M01] * v[M12] + m[M02] * v[M22] + m[M03] * v[M32];\r\n\t\t\tt[M03] = m[M00] * v[M03] + m[M01] * v[M13] + m[M02] * v[M23] + m[M03] * v[M33];\r\n\t\t\tt[M10] = m[M10] * v[M00] + m[M11] * v[M10] + m[M12] * v[M20] + m[M13] * v[M30];\r\n\t\t\tt[M11] = m[M10] * v[M01] + m[M11] * v[M11] + m[M12] * v[M21] + m[M13] * v[M31];\r\n\t\t\tt[M12] = m[M10] * v[M02] + m[M11] * v[M12] + m[M12] * v[M22] + m[M13] * v[M32];\r\n\t\t\tt[M13] = m[M10] * v[M03] + m[M11] * v[M13] + m[M12] * v[M23] + m[M13] * v[M33];\r\n\t\t\tt[M20] = m[M20] * v[M00] + m[M21] * v[M10] + m[M22] * v[M20] + m[M23] * v[M30];\r\n\t\t\tt[M21] = m[M20] * v[M01] + m[M21] * v[M11] + m[M22] * v[M21] + m[M23] * v[M31];\r\n\t\t\tt[M22] = m[M20] * v[M02] + m[M21] * v[M12] + m[M22] * v[M22] + m[M23] * v[M32];\r\n\t\t\tt[M23] = m[M20] * v[M03] + m[M21] * v[M13] + m[M22] * v[M23] + m[M23] * v[M33];\r\n\t\t\tt[M30] = m[M30] * v[M00] + m[M31] * v[M10] + m[M32] * v[M20] + m[M33] * v[M30];\r\n\t\t\tt[M31] = m[M30] * v[M01] + m[M31] * v[M11] + m[M32] * v[M21] + m[M33] * v[M31];\r\n\t\t\tt[M32] = m[M30] * v[M02] + m[M31] * v[M12] + m[M32] * v[M22] + m[M33] * v[M32];\r\n\t\t\tt[M33] = m[M30] * v[M03] + m[M31] * v[M13] + m[M32] * v[M23] + m[M33] * v[M33];\r\n\t\t\treturn this.set(this.temp);\r\n\t\t}\r\n\r\n\t\tlookAt (position: Vector3, direction: Vector3, up: Vector3) {\r\n\t\t\tMatrix4.initTemps();\r\n\t\t\tlet xAxis = Matrix4.xAxis, yAxis = Matrix4.yAxis, zAxis = Matrix4.zAxis;\r\n\t\t\tzAxis.setFrom(direction).normalize();\r\n\t\t\txAxis.setFrom(direction).normalize();\r\n\t\t\txAxis.cross(up).normalize();\r\n\t\t\tyAxis.setFrom(xAxis).cross(zAxis).normalize();\r\n\t\t\tthis.identity();\r\n\t\t\tlet val = this.values;\r\n\t\t\tval[M00] = xAxis.x;\r\n\t\t\tval[M01] = xAxis.y;\r\n\t\t\tval[M02] = xAxis.z;\r\n\t\t\tval[M10] = yAxis.x;\r\n\t\t\tval[M11] = yAxis.y;\r\n\t\t\tval[M12] = yAxis.z;\r\n\t\t\tval[M20] = -zAxis.x;\r\n\t\t\tval[M21] = -zAxis.y;\r\n\t\t\tval[M22] = -zAxis.z;\r\n\r\n\t\t\tMatrix4.tmpMatrix.identity();\r\n\t\t\tMatrix4.tmpMatrix.values[M03] = -position.x;\r\n\t\t\tMatrix4.tmpMatrix.values[M13] = -position.y;\r\n\t\t\tMatrix4.tmpMatrix.values[M23] = -position.z;\r\n\t\t\tthis.multiply(Matrix4.tmpMatrix)\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tstatic initTemps() {\r\n\t\t\tif (Matrix4.xAxis === null) Matrix4.xAxis = new Vector3();\r\n\t\t\tif (Matrix4.yAxis === null) Matrix4.yAxis = new Vector3();\r\n\t\t\tif (Matrix4.zAxis === null) Matrix4.zAxis = new Vector3();\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Matrix4 } from \"./Matrix4\";\r\nimport { Vector3 } from \"./Vector3\";\r\n\r\n// module spine.webgl {\r\n\r\n\texport interface Camera {\r\n\t\tposition: Vector3;\r\n\t\tdirection: Vector3;\r\n\t\tup: Vector3;\r\n\t\tnear: number\r\n\t\tfar: number\r\n\t\tfov: number\r\n\t\tzoom: number\r\n\t\tviewportWidth: number\r\n\t\tviewportHeight: number\r\n\t\tprojectionView: Matrix4;\r\n\t\tinverseProjectionView: Matrix4;\r\n\t\tprojection: Matrix4;\r\n\t\tview: Matrix4;\r\n\t\tis_perspective: boolean;\r\n\r\n\t\tupdate() : void;\r\n\t\tscreenToWorld (screenCoords: Vector3, screenWidth: number, screenHeight: number) : Vector3;\r\n\t\tworldToScreen(worldCoords: Vector3): Vector3;\r\n\t\tsetViewport(viewportWidth: number, viewportHeight: number): void;\r\n\t}\r\n\r\n\texport class OrthoCamera {\r\n\t\tposition = new Vector3(0, 0, 0);\r\n\t\tdirection = new Vector3(0, 0, -1);\r\n\t\tup = new Vector3(0, 1, 0);\r\n\t\tnear = 0;\r\n\t\tfar = 100;\r\n\t\tfov = 0.0; // unused\r\n\t\tzoom = 1;\r\n\t\tviewportWidth = 0;\r\n\t\tviewportHeight = 0;\r\n\t\tprojectionView = new Matrix4();\r\n\t\tinverseProjectionView = new Matrix4();\r\n\t\tprojection = new Matrix4();\r\n\t\tview = new Matrix4();\r\n\t\tis_perspective = false;\r\n\r\n\t\tprivate tmp = new Vector3();\r\n\r\n\t\tconstructor (viewportWidth: number, viewportHeight: number) {\r\n\t\t\tthis.viewportWidth = viewportWidth;\r\n\t\t\tthis.viewportHeight = viewportHeight;\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tupdate () {\r\n\t\t\tlet projection = this.projection;\r\n\t\t\tlet view = this.view;\r\n\t\t\tlet projectionView = this.projectionView;\r\n\t\t\tlet inverseProjectionView = this.inverseProjectionView;\r\n\t\t\tlet zoom = this.zoom, viewportWidth = this.viewportWidth, viewportHeight = this.viewportHeight;\r\n\t\t\tprojection.ortho(zoom * (-viewportWidth / 2), zoom * (viewportWidth / 2),\r\n\t\t\t\t\t\t\t zoom * (-viewportHeight / 2), zoom * (viewportHeight / 2),\r\n\t\t\t\t\t\t\t this.near, this.far);\r\n\t\t\tview.lookAt(this.position, this.direction, this.up);\r\n\t\t\tprojectionView.set(projection.values);\r\n\t\t\tprojectionView.multiply(view);\r\n\t\t\tinverseProjectionView.set(projectionView.values).invert();\r\n\t\t}\r\n\r\n\t\tscreenToWorld (screenCoords: Vector3, screenWidth: number, screenHeight: number) {\r\n\t\t\tlet x = screenCoords.x;\r\n\t\t\tlet y = screenCoords.y;\r\n\t\t\tlet z = screenCoords.z;\r\n\t\t\tlet tmp = this.tmp;\r\n\t\t\ttmp.x = (2 * (x / screenWidth)) - 1;\r\n\t\t\t// tmp.y = 1 - (2 * (y / screenHeight));\r\n\t\t\ttmp.y = (2 * (y / screenHeight)) - 1;\r\n\t\t\ttmp.z = z;\r\n\t\t\ttmp.project(this.inverseProjectionView);\r\n\t\t\tscreenCoords.set(tmp.x, tmp.y, tmp.z);\r\n\t\t\treturn screenCoords;\r\n\t\t}\r\n\r\n\t\tworldToScreen(worldCoords: Vector3): Vector3 {\r\n\t\t\tlet tmp = new Vector3(\r\n\t\t\t\tworldCoords.x,\r\n\t\t\t\tworldCoords.y,\r\n\t\t\t\tworldCoords.z,\r\n\t\t\t)\r\n\t\t\ttmp.multiply(this.projectionView);\r\n\t\t\ttmp.x = ((tmp.x + 1)/2) * (this.viewportWidth);\r\n\t\t\t// tmp.y = (1.0 - (tmp.y + 1)/2) * (this.viewportHeight);\r\n\t\t\ttmp.y = ((tmp.y + 1)/2) * (this.viewportHeight);\r\n\t\t\treturn new Vector3(tmp.x, tmp.y, 0);\r\n\t\t}\r\n\r\n\t\t// screenToWorld (screenCoords: Vector3, screenWidth: number, screenHeight: number) {\r\n\t\t// \tlet x = screenCoords.x;y = screenHeight - screenCoords.y - 1;\r\n\t\t// \tlet tmp = this.tmp;\r\n\t\t// \ttmp.x = (2 * x) / screenWidth - 1;\r\n\t\t// \ttmp.y = (2 * y) / screenHeight - 1;\r\n\t\t// \ttmp.z = (2 * screenCoords.z) - 1;\r\n\t\t// \ttmp.project(this.inverseProjectionView);\r\n\t\t// \tscreenCoords.set(tmp.x, tmp.y, tmp.z);\r\n\t\t// \treturn screenCoords;\r\n\t\t// }\r\n\r\n\t\t// worldToScreen(worldCoords: Vector2): spine.Vector2 {\r\n\t\t// \tlet tmp = new Vector3(\r\n\t\t// \t\tworldCoords.x,\r\n\t\t// \t\tworldCoords.y,\r\n\t\t// \t\t0,\r\n\t\t// \t)\r\n\t\t// \ttmp.multiply(this.projectionView);\r\n\t\t// \ttmp.x = ((tmp.x + 1)/2) * (this.viewportWidth);\r\n\t\t// \ttmp.y = ((tmp.y + 1)/2) * (this.viewportHeight);\r\n\t\t// \treturn new spine.Vector2(tmp.x, tmp.y);\r\n\t\t// }\r\n\r\n\t\tsetViewport(viewportWidth: number, viewportHeight: number) {\r\n\t\t\tthis.viewportWidth = viewportWidth;\r\n\t\t\tthis.viewportHeight = viewportHeight;\r\n\t\t}\r\n\t}\r\n\r\n\texport class PerspectiveCamera {\r\n\t\tposition = new Vector3(0, 0, 0);\r\n\t\tdirection = new Vector3(0, 0, -1);\r\n\t\tup = new Vector3(0, 1, 0);\r\n\t\tnear = 1;\r\n\t\tfar = 1000;\r\n\t\tzoom = 1;\r\n\t\tfov = 45;\r\n\t\tviewportWidth = 0;\r\n\t\tviewportHeight = 0;\r\n\t\tprojectionView = new Matrix4();\r\n\t\tinverseProjectionView = new Matrix4();\r\n\t\tprojection = new Matrix4();\r\n\t\tview = new Matrix4();\r\n\t\tis_perspective = true;\r\n\r\n\t\tprivate tmp = new Vector3();\r\n\r\n\t\tconstructor (viewportWidth: number, viewportHeight: number) {\r\n\t\t\tthis.viewportWidth = viewportWidth;\r\n\t\t\tthis.viewportHeight = viewportHeight;\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tupdate (if_throw = false) {\r\n\t\t\tlet projection = this.projection;\r\n\t\t\tlet view = this.view;\r\n\t\t\tlet projectionView = this.projectionView;\r\n\t\t\tlet inverseProjectionView = this.inverseProjectionView;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tprojection.projection(\r\n\t\t\t\t\tthis.near,\r\n\t\t\t\t\tthis.far,\r\n\t\t\t\t\tthis.fov,\r\n\t\t\t\t\tthis.viewportWidth / this.viewportHeight\r\n\t\t\t\t)\r\n\t\t\t\tview.lookAt(this.position, this.direction, this.up);\r\n\t\t\t\tprojectionView.set(projection.values);\r\n\t\t\t\tprojectionView.multiply(view);\r\n\t\t\t\tinverseProjectionView.set(projectionView.values).invert();\r\n\t\t\t} catch(e) {\r\n\t\t\t\tif (if_throw) {\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tscreenToWorld (screenCoords: Vector3, screenWidth: number, screenHeight: number) {\r\n\t\t\tlet x = screenCoords.x;\r\n\t\t\tlet y = screenCoords.y;\r\n\t\t\tlet z = screenCoords.z;\r\n\t\t\tlet tmp = this.tmp;\r\n\t\t\ttmp.x = (2 * (x / screenWidth)) - 1;\r\n\t\t\ttmp.y = (2 * (y / screenHeight)) - 1;\r\n\t\t\t// tmp.y = 1 - (2 * (y / screenHeight));  old\r\n\t\t\ttmp.z = z;\r\n\t\t\ttmp.project(this.inverseProjectionView);\r\n\t\t\tscreenCoords.set(tmp.x, tmp.y, tmp.z);\r\n\t\t\treturn screenCoords;\r\n\t\t}\r\n\r\n\t\tworldToScreen(worldCoords: Vector3): Vector3 {\r\n\t\t\tlet tmp = new Vector3(\r\n\t\t\t\tworldCoords.x,\r\n\t\t\t\tworldCoords.y,\r\n\t\t\t\tworldCoords.z,\r\n\t\t\t)\r\n\r\n\t\t\ttmp.project(this.projectionView);\r\n\t\t\ttmp.x = ((tmp.x + 1)/2) * (this.viewportWidth);\r\n\t\t\ttmp.y = ((tmp.y + 1)/2) * (this.viewportHeight);\r\n\t\t\t// tmp.y = (1.0 - ((tmp.y + 1)/2)) * (this.viewportHeight); old\r\n\t\t\tlet ret =  new Vector3(tmp.x, tmp.y, tmp.z);\r\n\t\t\tret.w = tmp.w;\r\n\t\t\treturn ret;\r\n\t\t}\r\n\r\n\t\tsetViewport(viewportWidth: number, viewportHeight: number) {\r\n\t\t\tthis.viewportWidth = viewportWidth;\r\n\t\t\tthis.viewportHeight = viewportHeight;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Restorable, Disposable } from \"../core/Utils\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\texport class Shader implements Disposable, Restorable {\r\n\t\tpublic static MVP_MATRIX = \"u_projTrans\";\r\n\t\tpublic static POSITION = \"a_position\";\r\n\t\tpublic static COLOR = \"a_color\";\r\n\t\tpublic static COLOR2 = \"a_color2\";\r\n\t\tpublic static TEXCOORDS = \"a_texCoords\";\r\n\t\tpublic static SAMPLER = \"u_texture\";\r\n\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate vs: WebGLShader = null;\r\n\t\tprivate vsSource: string;\r\n\t\tprivate fs: WebGLShader = null;\r\n\t\tprivate fsSource: string;\r\n\t\tprivate program: WebGLProgram = null;\r\n\t\tprivate tmp2x2: Float32Array = new Float32Array(2 * 2);\r\n\t\tprivate tmp3x3: Float32Array = new Float32Array(3 * 3);\r\n\t\tprivate tmp4x4: Float32Array = new Float32Array(4 * 4);\r\n\r\n\t\tpublic getProgram () { return this.program; }\r\n\t\tpublic getVertexShader () { return this.vertexShader; }\r\n\t\tpublic getFragmentShader () { return this.fragmentShader; }\r\n\t\tpublic getVertexShaderSource () { return this.vsSource; }\r\n\t\tpublic getFragmentSource () { return this.fsSource; }\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext | WebGLRenderingContext, private vertexShader: string, private fragmentShader: string) {\r\n\t\t\tthis.vsSource = vertexShader;\r\n\t\t\tthis.fsSource = fragmentShader;\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t\tthis.context.addRestorable(this);\r\n\t\t\tthis.compile();\r\n\t\t}\r\n\r\n\t\tprivate compile () {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\ttry {\r\n\t\t\t\tthis.vs = this.compileShader(gl.VERTEX_SHADER, this.vertexShader);\r\n\t\t\t\tthis.fs = this.compileShader(gl.FRAGMENT_SHADER, this.fragmentShader);\r\n\t\t\t\tthis.program = this.compileProgram(this.vs, this.fs);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.log(\"Shader compilation error\", e);\r\n\t\t\t\tthis.dispose();\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate compileShader (type: number, source: string) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tlet shader = gl.createShader(type);\r\n\t\t\tgl.shaderSource(shader, source);\r\n\t\t\tgl.compileShader(shader);\r\n\t\t\tif (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n\t\t\t\tlet error = \"Couldn't compile shader: \" + gl.getShaderInfoLog(shader);\r\n\t\t\t\tgl.deleteShader(shader);\r\n\t\t\t\tif (!gl.isContextLost()) throw new Error(error);\r\n\t\t\t}\r\n\t\t\treturn shader;\r\n\t\t}\r\n\r\n\t\tprivate compileProgram (vs: WebGLShader, fs: WebGLShader) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tlet program = gl.createProgram();\r\n\t\t\tgl.attachShader(program, vs);\r\n\t\t\tgl.attachShader(program, fs);\r\n\t\t\tgl.linkProgram(program);\r\n\r\n\t\t\tif (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n\t\t\t\tlet error = \"Couldn't compile shader program: \" + gl.getProgramInfoLog(program);\r\n\t\t\t\tgl.deleteProgram(program);\r\n\t\t\t\tif (!gl.isContextLost()) throw new Error(error);\r\n\t\t\t}\r\n\t\t\treturn program;\r\n\t\t}\r\n\r\n\t\trestore () {\r\n\t\t\tthis.compile();\r\n\t\t}\r\n\r\n\t\tpublic bind () {\r\n\t\t\tthis.context.gl.useProgram(this.program);\r\n\t\t}\r\n\r\n\t\tpublic unbind () {\r\n\t\t\tthis.context.gl.useProgram(null);\r\n\t\t}\r\n\r\n\t\tpublic setUniformi (uniform: string, value: number) {\r\n\t\t\tthis.context.gl.uniform1i(this.getUniformLocation(uniform), value);\r\n\t\t}\r\n\r\n\t\tpublic setUniformf (uniform: string, value: number) {\r\n\t\t\tthis.context.gl.uniform1f(this.getUniformLocation(uniform), value);\r\n\t\t}\r\n\r\n\t\tpublic setUniform2f (uniform: string, value: number, value2: number) {\r\n\t\t\tthis.context.gl.uniform2f(this.getUniformLocation(uniform), value, value2);\r\n\t\t}\r\n\r\n\t\tpublic setUniform3f (uniform: string, value: number, value2: number, value3: number) {\r\n\t\t\tthis.context.gl.uniform3f(this.getUniformLocation(uniform), value, value2, value3);\r\n\t\t}\r\n\r\n\t\tpublic setUniform4f (uniform: string, value: number, value2: number, value3: number, value4: number) {\r\n\t\t\tthis.context.gl.uniform4f(this.getUniformLocation(uniform), value, value2, value3, value4);\r\n\t\t}\r\n\r\n\t\tpublic setUniform2x2f (uniform: string, value: ArrayLike<number>) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.tmp2x2.set(value);\r\n\t\t\tgl.uniformMatrix2fv(this.getUniformLocation(uniform), false, this.tmp2x2);\r\n\t\t}\r\n\r\n\t\tpublic setUniform3x3f (uniform: string, value: ArrayLike<number>) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.tmp3x3.set(value);\r\n\t\t\tgl.uniformMatrix3fv(this.getUniformLocation(uniform), false, this.tmp3x3);\r\n\t\t}\r\n\r\n\t\tpublic setUniform4x4f (uniform: string, value: ArrayLike<number>) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.tmp4x4.set(value);\r\n\t\t\tgl.uniformMatrix4fv(this.getUniformLocation(uniform), false, this.tmp4x4);\r\n\t\t}\r\n\r\n\t\tpublic getUniformLocation (uniform: string): WebGLUniformLocation {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tlet location = gl.getUniformLocation(this.program, uniform);\r\n\t\t\tif (!location && !gl.isContextLost()) throw new Error(`Couldn't find location for uniform ${uniform}`);\r\n\t\t\treturn location;\r\n\t\t}\r\n\r\n\t\tpublic getAttributeLocation (attribute: string): number {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tlet location = gl.getAttribLocation(this.program, attribute);\r\n\t\t\tif (location == -1 && !gl.isContextLost()) throw new Error(`Couldn't find location for attribute ${attribute}`);\r\n\t\t\treturn location;\r\n\t\t}\r\n\r\n\t\tpublic dispose () {\r\n\t\t\tthis.context.removeRestorable(this);\r\n\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (this.vs) {\r\n\t\t\t\tgl.deleteShader(this.vs);\r\n\t\t\t\tthis.vs = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.fs) {\r\n\t\t\t\tgl.deleteShader(this.fs);\r\n\t\t\t\tthis.fs = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.program) {\r\n\t\t\t\tgl.deleteProgram(this.program);\r\n\t\t\t\tthis.program = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic static newColoredTextured (context: ManagedWebGLRenderingContext | WebGLRenderingContext): Shader {\r\n\t\t\tlet vs = `\r\n\t\t\t\tattribute vec4 ${Shader.POSITION};\r\n\t\t\t\tattribute vec4 ${Shader.COLOR};\r\n\t\t\t\tattribute vec2 ${Shader.TEXCOORDS};\r\n\t\t\t\tuniform mat4 ${Shader.MVP_MATRIX};\r\n\t\t\t\tvarying vec4 v_color;\r\n\t\t\t\tvarying vec2 v_texCoords;\r\n\r\n\t\t\t\tvoid main () {\r\n\t\t\t\t\tv_color = ${Shader.COLOR};\r\n\t\t\t\t\tv_texCoords = ${Shader.TEXCOORDS};\r\n\t\t\t\t\tgl_Position = ${Shader.MVP_MATRIX} * ${Shader.POSITION};\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\r\n\t\t\tlet fs = `\r\n\t\t\t\t#ifdef GL_ES\r\n\t\t\t\t\t#define LOWP lowp\r\n\t\t\t\t\tprecision mediump float;\r\n\t\t\t\t#else\r\n\t\t\t\t\t#define LOWP\r\n\t\t\t\t#endif\r\n\t\t\t\tvarying LOWP vec4 v_color;\r\n\t\t\t\tvarying vec2 v_texCoords;\r\n\t\t\t\tuniform sampler2D u_texture;\r\n\r\n\t\t\t\tvoid main () {\r\n\t\t\t\t\tgl_FragColor = v_color * texture2D(u_texture, v_texCoords);\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\r\n\t\t\treturn new Shader(context, vs, fs);\r\n\t\t}\r\n\r\n\t\tpublic static newTwoColoredTextured (context: ManagedWebGLRenderingContext | WebGLRenderingContext): Shader {\r\n\t\t\tlet vs = `\r\n\t\t\t\tattribute vec4 ${Shader.POSITION};\r\n\t\t\t\tattribute vec4 ${Shader.COLOR};\r\n\t\t\t\tattribute vec4 ${Shader.COLOR2};\r\n\t\t\t\tattribute vec2 ${Shader.TEXCOORDS};\r\n\t\t\t\tuniform mat4 ${Shader.MVP_MATRIX};\r\n\t\t\t\tvarying vec4 v_light;\r\n\t\t\t\tvarying vec4 v_dark;\r\n\t\t\t\tvarying vec2 v_texCoords;\r\n\r\n\t\t\t\tvoid main () {\r\n\t\t\t\t\tv_light = ${Shader.COLOR};\r\n\t\t\t\t\tv_dark = ${Shader.COLOR2};\r\n\t\t\t\t\tv_texCoords = ${Shader.TEXCOORDS};\r\n\t\t\t\t\tgl_Position = ${Shader.MVP_MATRIX} * ${Shader.POSITION};\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\r\n\t\t\tlet fs = `\r\n\t\t\t\t#ifdef GL_ES\r\n\t\t\t\t\t#define LOWP lowp\r\n\t\t\t\t\tprecision mediump float;\r\n\t\t\t\t#else\r\n\t\t\t\t\t#define LOWP\r\n\t\t\t\t#endif\r\n\t\t\t\tvarying LOWP vec4 v_light;\r\n\t\t\t\tvarying LOWP vec4 v_dark;\r\n\t\t\t\tvarying vec2 v_texCoords;\r\n\t\t\t\tuniform sampler2D u_texture;\r\n\r\n\t\t\t\tvoid main () {\r\n\t\t\t\t\tvec4 texColor = texture2D(u_texture, v_texCoords);\r\n\t\t\t\t\tgl_FragColor.a = texColor.a * v_light.a;\r\n\t\t\t\t\tgl_FragColor.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\r\n\t\t\treturn new Shader(context, vs, fs);\r\n\t\t}\r\n\r\n\t\tpublic static newColored (context: ManagedWebGLRenderingContext | WebGLRenderingContext): Shader {\r\n\t\t\tlet vs = `\r\n\t\t\t\tattribute vec4 ${Shader.POSITION};\r\n\t\t\t\tattribute vec4 ${Shader.COLOR};\r\n\t\t\t\tuniform mat4 ${Shader.MVP_MATRIX};\r\n\t\t\t\tvarying vec4 v_color;\r\n\r\n\t\t\t\tvoid main () {\r\n\t\t\t\t\tv_color = ${Shader.COLOR};\r\n\t\t\t\t\tgl_Position = ${Shader.MVP_MATRIX} * ${Shader.POSITION};\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\r\n\t\t\tlet fs = `\r\n\t\t\t\t#ifdef GL_ES\r\n\t\t\t\t\t#define LOWP lowp\r\n\t\t\t\t\tprecision mediump float;\r\n\t\t\t\t#else\r\n\t\t\t\t\t#define LOWP\r\n\t\t\t\t#endif\r\n\t\t\t\tvarying LOWP vec4 v_color;\r\n\r\n\t\t\t\tvoid main () {\r\n\t\t\t\t\tgl_FragColor = v_color;\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\r\n\t\t\treturn new Shader(context, vs, fs);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Restorable, Disposable } from \"../core/Utils\";\r\nimport { Shader } from \"./Shader\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\texport class Mesh implements Disposable, Restorable {\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate vertices:Float32Array;\r\n\t\tprivate verticesBuffer: WebGLBuffer;\r\n\t\tprivate verticesLength = 0;\r\n\t\tprivate dirtyVertices = false;\r\n\t\tprivate indices:Uint16Array;\r\n\t\tprivate indicesBuffer: WebGLBuffer;\r\n\t\tprivate indicesLength = 0;\r\n\t\tprivate dirtyIndices = false;\r\n\t\tprivate elementsPerVertex = 0;\r\n\r\n\t\tgetAttributes (): VertexAttribute[] { return this.attributes; }\r\n\r\n\t\tmaxVertices (): number { return this.vertices.length / this.elementsPerVertex; }\r\n\t\tnumVertices (): number { return this.verticesLength / this.elementsPerVertex; }\r\n\t\tsetVerticesLength (length: number) {\r\n\t\t\tthis.dirtyVertices = true;\r\n\t\t\tthis.verticesLength = length;\r\n\t\t}\r\n\t\tgetVertices (): Float32Array { return this.vertices; }\r\n\r\n\t\tmaxIndices (): number { return this.indices.length; }\r\n\t\tnumIndices (): number { return this.indicesLength; }\r\n\t\tsetIndicesLength (length: number) {\r\n\t\t\tthis.dirtyIndices = true;\r\n\t\t\tthis.indicesLength = length;\r\n\t\t}\r\n\t\tgetIndices (): Uint16Array { return this.indices };\r\n\r\n\t\tgetVertexSizeInFloats (): number {\r\n\t\t\tlet size = 0;\r\n\t\t\tfor (var i = 0; i < this.attributes.length; i++) {\r\n\t\t\t\tlet attribute = this.attributes[i];\r\n\t\t\t\tsize += attribute.numElements;\r\n\t\t\t}\r\n\t\t\treturn size;\r\n\t\t}\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext | WebGLRenderingContext, private attributes: VertexAttribute[], maxVertices: number, maxIndices: number) {\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t\tthis.elementsPerVertex = 0;\r\n\t\t\tfor (let i = 0; i < attributes.length; i++) {\r\n\t\t\t\tthis.elementsPerVertex += attributes[i].numElements;\r\n\t\t\t}\r\n\t\t\tthis.vertices = new Float32Array(maxVertices * this.elementsPerVertex);\r\n\t\t\tthis.indices = new Uint16Array(maxIndices);\r\n\t\t\tthis.context.addRestorable(this);\r\n\t\t}\r\n\r\n\t\tsetVertices (vertices: Array<number>) {\r\n\t\t\tthis.dirtyVertices = true;\r\n\t\t\tif (vertices.length > this.vertices.length) throw Error(\"Mesh can't store more than \" + this.maxVertices() + \" vertices\");\r\n\t\t\tthis.vertices.set(vertices, 0);\r\n\t\t\tthis.verticesLength = vertices.length;\r\n\t\t}\r\n\r\n\t\tsetIndices (indices: Array<number>) {\r\n\t\t\tthis.dirtyIndices = true;\r\n\t\t\tif (indices.length > this.indices.length) throw Error(\"Mesh can't store more than \" + this.maxIndices() + \" indices\");\r\n\t\t\tthis.indices.set(indices, 0);\r\n\t\t\tthis.indicesLength = indices.length;\r\n\t\t}\r\n\r\n\t\tdraw (shader: Shader, primitiveType: number) {\r\n\t\t\tthis.drawWithOffset(shader, primitiveType, 0, this.indicesLength > 0? this.indicesLength: this.verticesLength / this.elementsPerVertex);\r\n\t\t}\r\n\r\n\t\tdrawWithOffset (shader: Shader, primitiveType: number, offset: number, count: number) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (this.dirtyVertices || this.dirtyIndices) this.update();\r\n\t\t\tthis.bind(shader);\r\n\t\t\tif (this.indicesLength > 0) {\r\n\t\t\t\tgl.drawElements(primitiveType, count, gl.UNSIGNED_SHORT, offset * 2);\r\n\t\t\t} else {\r\n\t\t\t\tgl.drawArrays(primitiveType, offset, count);\r\n\t\t\t}\r\n\t\t\tthis.unbind(shader);\r\n\t\t}\r\n\r\n\t\tbind (shader: Shader) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.verticesBuffer);\r\n\t\t\tlet offset = 0;\r\n\t\t\tfor (let i = 0; i < this.attributes.length; i++) {\r\n\t\t\t\tlet attrib = this.attributes[i];\r\n\t\t\t\tlet location = shader.getAttributeLocation(attrib.name);\r\n\t\t\t\tgl.enableVertexAttribArray(location);\r\n\t\t\t\tgl.vertexAttribPointer(location, attrib.numElements, gl.FLOAT, false, this.elementsPerVertex * 4, offset * 4);\r\n\t\t\t\toffset += attrib.numElements;\r\n\t\t\t}\r\n\t\t\tif (this.indicesLength > 0) gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\r\n\t\t}\r\n\r\n\t\tunbind (shader: Shader) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tfor (let i = 0; i < this.attributes.length; i++) {\r\n\t\t\t\tlet attrib = this.attributes[i];\r\n\t\t\t\tlet location = shader.getAttributeLocation(attrib.name);\r\n\t\t\t\tgl.disableVertexAttribArray(location);\r\n\t\t\t}\r\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\t\t\tif (this.indicesLength > 0) gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\r\n\t\t}\r\n\r\n\t\tprivate update () {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (this.dirtyVertices) {\r\n\t\t\t\tif (!this.verticesBuffer) {\r\n\t\t\t\t\tthis.verticesBuffer = gl.createBuffer();\r\n\t\t\t\t}\r\n\t\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.verticesBuffer);\r\n\t\t\t\tgl.bufferData(gl.ARRAY_BUFFER, this.vertices.subarray(0, this.verticesLength), gl.DYNAMIC_DRAW);\r\n\t\t\t\tthis.dirtyVertices = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.dirtyIndices) {\r\n\t\t\t\tif (!this.indicesBuffer) {\r\n\t\t\t\t\tthis.indicesBuffer = gl.createBuffer();\r\n\t\t\t\t}\r\n\t\t\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\r\n\t\t\t\tgl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.indices.subarray(0, this.indicesLength), gl.DYNAMIC_DRAW);\r\n\t\t\t\tthis.dirtyIndices = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trestore () {\r\n\t\t\tthis.verticesBuffer = null;\r\n\t\t\tthis.indicesBuffer = null;\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t\tthis.context.removeRestorable(this);\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tgl.deleteBuffer(this.verticesBuffer);\r\n\t\t\tgl.deleteBuffer(this.indicesBuffer);\r\n\t\t}\r\n\t}\r\n\r\n\texport class VertexAttribute {\r\n\t\tconstructor (public name: string, public type: VertexAttributeType, public numElements: number) { }\r\n\t}\r\n\r\n\texport class Position2Attribute extends VertexAttribute {\r\n\t\tconstructor () {\r\n\t\t\tsuper(Shader.POSITION, VertexAttributeType.Float, 2);\r\n\t\t}\r\n\t}\r\n\r\n\texport class Position3Attribute extends VertexAttribute {\r\n\t\tconstructor () {\r\n\t\t\tsuper(Shader.POSITION, VertexAttributeType.Float, 3);\r\n\t\t}\r\n\t}\r\n\r\n\texport class TexCoordAttribute extends VertexAttribute {\r\n\t\tconstructor (unit: number = 0) {\r\n\t\t\tsuper(Shader.TEXCOORDS + (unit == 0? \"\": unit), VertexAttributeType.Float, 2);\r\n\t\t}\r\n\t}\r\n\r\n\texport class ColorAttribute extends VertexAttribute {\r\n\t\tconstructor () {\r\n\t\t\tsuper(Shader.COLOR, VertexAttributeType.Float, 4);\r\n\t\t}\r\n\t}\r\n\r\n\texport class Color2Attribute extends VertexAttribute {\r\n\t\tconstructor () {\r\n\t\t\tsuper(Shader.COLOR2, VertexAttributeType.Float, 4);\r\n\t\t}\r\n\t}\r\n\r\n\texport enum VertexAttributeType {\r\n\t\tFloat\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Color, Vector2, MathUtils, Disposable } from \"../core/Utils\";\r\nimport { Mesh, Position2Attribute, ColorAttribute } from \"./Mesh\";\r\nimport { Shader } from \"./Shader\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\texport class ShapeRenderer implements Disposable {\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate isDrawing = false;\r\n\t\tprivate mesh: Mesh;\r\n\t\tprivate shapeType = ShapeType.Filled;\r\n\t\tprivate color = new Color(1, 1, 1, 1);\r\n\t\tprivate shader: Shader;\r\n\t\tprivate vertexIndex = 0;\r\n\t\tprivate tmp = new Vector2();\r\n\t\tprivate srcBlend: number;\r\n\t\tprivate dstBlend: number;\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext | WebGLRenderingContext, maxVertices: number = 10920) {\r\n\t\t\tif (maxVertices > 10920) throw new Error(\"Can't have more than 10920 triangles per batch: \" + maxVertices);\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t\tthis.mesh = new Mesh(context, [new Position2Attribute(), new ColorAttribute()], maxVertices, 0);\r\n\t\t\tthis.srcBlend = this.context.gl.SRC_ALPHA;\r\n\t\t\tthis.dstBlend = this.context.gl.ONE_MINUS_SRC_ALPHA;\r\n\t\t}\r\n\r\n\t\tbegin (shader: Shader) {\r\n\t\t\tif (this.isDrawing) throw new Error(\"ShapeRenderer.begin() has already been called\");\r\n\t\t\tthis.shader = shader;\r\n\t\t\tthis.vertexIndex = 0;\r\n\t\t\tthis.isDrawing = true;\r\n\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tgl.enable(gl.BLEND);\r\n\t\t\tgl.blendFunc(this.srcBlend, this.dstBlend);\r\n\t\t}\r\n\r\n\t\tsetBlendMode (srcBlend: number, dstBlend: number) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.srcBlend = srcBlend;\r\n\t\t\tthis.dstBlend = dstBlend;\r\n\t\t\tif (this.isDrawing) {\r\n\t\t\t\tthis.flush();\r\n\t\t\t\tgl.blendFunc(this.srcBlend, this.dstBlend);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsetColor (color: Color) {\r\n\t\t\tthis.color.setFromColor(color);\r\n\t\t}\r\n\r\n\t\tsetColorWith (r: number, g: number, b: number, a: number) {\r\n\t\t\tthis.color.set(r, g, b, a);\r\n\t\t}\r\n\r\n\t\tpoint (x: number, y: number, color: Color = null) {\r\n\t\t\tthis.check(ShapeType.Point, 1);\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tthis.vertex(x, y, color);\r\n\t\t}\r\n\r\n\t\tline (x: number, y: number, x2: number, y2: number, color: Color = null) {\r\n\t\t\tthis.check(ShapeType.Line, 2);\r\n\t\t\tlet vertices = this.mesh.getVertices();\r\n\t\t\tlet idx = this.vertexIndex;\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tthis.vertex(x, y, color);\r\n\t\t\tthis.vertex(x2, y2, color);\r\n\t\t}\r\n\r\n\t\ttriangle (filled: boolean, x: number, y: number, x2: number, y2: number, x3: number, y3: number, color: Color = null, color2: Color = null, color3: Color = null) {\r\n\t\t\tthis.check(filled ? ShapeType.Filled : ShapeType.Line, 3);\r\n\t\t\tlet vertices = this.mesh.getVertices();\r\n\t\t\tlet idx = this.vertexIndex;\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tif (color2 === null) color2 = this.color;\r\n\t\t\tif (color3 === null) color3 = this.color;\r\n\t\t\tif (filled) {\r\n\t\t\t\tthis.vertex(x, y, color);\r\n\t\t\t\tthis.vertex(x2, y2, color2);\r\n\t\t\t\tthis.vertex(x3, y3, color3);\r\n\t\t\t} else {\r\n\t\t\t\tthis.vertex(x, y, color);\r\n\t\t\t\tthis.vertex(x2, y2, color2);\r\n\r\n\t\t\t\tthis.vertex(x2, y2, color);\r\n\t\t\t\tthis.vertex(x3, y3, color2);\r\n\r\n\t\t\t\tthis.vertex(x3, y3, color);\r\n\t\t\t\tthis.vertex(x, y, color2);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tquad (filled: boolean, x: number, y: number, x2: number, y2: number, x3: number, y3: number, x4: number, y4: number, color: Color = null, color2: Color = null, color3: Color = null, color4: Color = null) {\r\n\t\t\tthis.check(filled ? ShapeType.Filled : ShapeType.Line, 3);\r\n\t\t\tlet vertices = this.mesh.getVertices();\r\n\t\t\tlet idx = this.vertexIndex;\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tif (color2 === null) color2 = this.color;\r\n\t\t\tif (color3 === null) color3 = this.color;\r\n\t\t\tif (color4 === null) color4 = this.color;\r\n\t\t\tif (filled) {\r\n\t\t\t\tthis.vertex(x, y, color); this.vertex(x2, y2, color2); this.vertex(x3, y3, color3);\r\n\t\t\t\tthis.vertex(x3, y3, color3); this.vertex(x4, y4, color4); this.vertex(x, y, color);\r\n\t\t\t} else {\r\n\t\t\t\tthis.vertex(x, y, color); this.vertex(x2, y2, color2);\r\n\t\t\t\tthis.vertex(x2, y2, color2); this.vertex(x3, y3, color3);\r\n\t\t\t\tthis.vertex(x3, y3, color3); this.vertex(x4, y4, color4);\r\n\t\t\t\tthis.vertex(x4, y4, color4); this.vertex(x, y, color);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trect (filled: boolean, x: number, y: number, width: number, height: number, color: Color = null) {\r\n\t\t\tthis.quad(filled, x, y, x + width, y, x + width, y + height, x, y + height, color, color, color, color);\r\n\t\t}\r\n\r\n\t\trectLine (filled: boolean, x1: number, y1: number, x2: number, y2: number, width: number, color: Color = null) {\r\n\t\t\tthis.check(filled ? ShapeType.Filled : ShapeType.Line, 8);\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tlet t = this.tmp.set(y2 - y1, x1 - x2);\r\n\t\t\tt.normalize();\r\n\t\t\twidth *= 0.5;\r\n\t\t\tlet tx = t.x * width;\r\n\t\t\tlet ty = t.y * width;\r\n\t\t\tif (!filled) {\r\n\t\t\t\tthis.vertex(x1 + tx, y1 + ty, color);\r\n\t\t\t\tthis.vertex(x1 - tx, y1 - ty, color);\r\n\t\t\t\tthis.vertex(x2 + tx, y2 + ty, color);\r\n\t\t\t\tthis.vertex(x2 - tx, y2 - ty, color);\r\n\r\n\t\t\t\tthis.vertex(x2 + tx, y2 + ty, color);\r\n\t\t\t\tthis.vertex(x1 + tx, y1 + ty, color);\r\n\r\n\t\t\t\tthis.vertex(x2 - tx, y2 - ty, color);\r\n\t\t\t\tthis.vertex(x1 - tx, y1 - ty, color);\r\n\t\t\t} else {\r\n\t\t\t\tthis.vertex(x1 + tx, y1 + ty, color);\r\n\t\t\t\tthis.vertex(x1 - tx, y1 - ty, color);\r\n\t\t\t\tthis.vertex(x2 + tx, y2 + ty, color);\r\n\r\n\t\t\t\tthis.vertex(x2 - tx, y2 - ty, color);\r\n\t\t\t\tthis.vertex(x2 + tx, y2 + ty, color);\r\n\t\t\t\tthis.vertex(x1 - tx, y1 - ty, color);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tx (x: number, y: number, size: number) {\r\n\t\t\tthis.line(x - size, y - size, x + size, y + size);\r\n\t\t\tthis.line(x - size, y + size, x + size, y - size);\r\n\t\t}\r\n\r\n\t\tpolygon (polygonVertices: ArrayLike<number>, offset: number, count: number, color: Color = null) {\r\n\t\t\tif (count < 3) throw new Error(\"Polygon must contain at least 3 vertices\");\r\n\t\t\tthis.check(ShapeType.Line, count * 2);\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tlet vertices = this.mesh.getVertices();\r\n\t\t\tlet idx = this.vertexIndex;\r\n\r\n\t\t\toffset <<= 1;\r\n\t\t\tcount <<= 1;\r\n\r\n\t\t\tlet firstX = polygonVertices[offset];\r\n\t\t\tlet firstY = polygonVertices[offset + 1];\r\n\t\t\tlet last = offset + count;\r\n\r\n\t\t\tfor (let i = offset, n = offset + count - 2; i < n; i += 2) {\r\n\t\t\t\tlet x1 = polygonVertices[i];\r\n\t\t\t\tlet y1 = polygonVertices[i+1];\r\n\r\n\t\t\t\tlet x2 = 0;\r\n\t\t\t\tlet y2 = 0;\r\n\r\n\t\t\t\tif (i + 2 >= last) {\r\n\t\t\t\t\tx2 = firstX;\r\n\t\t\t\t\ty2 = firstY;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tx2 = polygonVertices[i + 2];\r\n\t\t\t\t\ty2 = polygonVertices[i + 3];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.vertex(x1, y1, color);\r\n\t\t\t\tthis.vertex(x2, y2, color);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcircle (filled: boolean, x: number, y: number, radius: number, color: Color = null, segments: number = 0) {\r\n\t\t\tif (segments === 0) segments = Math.max(1, (6 * MathUtils.cbrt(radius)) | 0);\r\n\t\t\tif (segments <= 0) throw new Error(\"segments must be > 0.\");\r\n\t\t\tif (color === null) color = this.color;\r\n\t\t\tlet angle = 2 * MathUtils.PI / segments;\r\n\t\t\tlet cos = Math.cos(angle);\r\n\t\t\tlet sin = Math.sin(angle);\r\n\t\t\tlet cx = radius, cy = 0;\r\n\t\t\tif (!filled) {\r\n\t\t\t\tthis.check(ShapeType.Line, segments * 2 + 2);\r\n\t\t\t\tfor (let i = 0; i < segments; i++) {\r\n\t\t\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t\t\t\tlet temp = cx;\r\n\t\t\t\t\tcx = cos * cx - sin * cy;\r\n\t\t\t\t\tcy = sin * temp + cos * cy;\r\n\t\t\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t\t\t}\r\n\t\t\t\t// Ensure the last segment is identical to the first.\r\n\t\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t\t} else {\r\n\t\t\t\tthis.check(ShapeType.Filled, segments * 3 + 3);\r\n\t\t\t\tsegments--;\r\n\t\t\t\tfor (let i = 0; i < segments; i++) {\r\n\t\t\t\t\tthis.vertex(x, y, color);\r\n\t\t\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t\t\t\tlet temp = cx;\r\n\t\t\t\t\tcx = cos * cx - sin * cy;\r\n\t\t\t\t\tcy = sin * temp + cos * cy;\r\n\t\t\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t\t\t}\r\n\t\t\t\t// Ensure the last segment is identical to the first.\r\n\t\t\t\tthis.vertex(x, y, color);\r\n\t\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t\t}\r\n\r\n\t\t\tlet temp = cx;\r\n\t\t\tcx = radius;\r\n\t\t\tcy = 0;\r\n\t\t\tthis.vertex(x + cx, y + cy, color);\r\n\t\t}\r\n\r\n\t\tcurve (x1: number, y1: number, cx1: number, cy1: number, cx2: number, cy2: number, x2: number, y2: number, segments: number, color: Color = null) {\r\n\t\t\tthis.check(ShapeType.Line, segments * 2 + 2);\r\n\t\t\tif (color === null) color = this.color;\r\n\r\n\t\t\t// Algorithm from: http://www.antigrain.com/research/bezier_interpolation/index.html#PAGE_BEZIER_INTERPOLATION\r\n\t\t\tlet subdiv_step = 1 / segments;\r\n\t\t\tlet subdiv_step2 = subdiv_step * subdiv_step;\r\n\t\t\tlet subdiv_step3 = subdiv_step * subdiv_step * subdiv_step;\r\n\r\n\t\t\tlet pre1 = 3 * subdiv_step;\r\n\t\t\tlet pre2 = 3 * subdiv_step2;\r\n\t\t\tlet pre4 = 6 * subdiv_step2;\r\n\t\t\tlet pre5 = 6 * subdiv_step3;\r\n\r\n\t\t\tlet tmp1x = x1 - cx1 * 2 + cx2;\r\n\t\t\tlet tmp1y = y1 - cy1 * 2 + cy2;\r\n\r\n\t\t\tlet tmp2x = (cx1 - cx2) * 3 - x1 + x2;\r\n\t\t\tlet tmp2y = (cy1 - cy2) * 3 - y1 + y2;\r\n\r\n\t\t\tlet fx = x1;\r\n\t\t\tlet fy = y1;\r\n\r\n\t\t\tlet dfx = (cx1 - x1) * pre1 + tmp1x * pre2 + tmp2x * subdiv_step3;\r\n\t\t\tlet dfy = (cy1 - y1) * pre1 + tmp1y * pre2 + tmp2y * subdiv_step3;\r\n\r\n\t\t\tlet ddfx = tmp1x * pre4 + tmp2x * pre5;\r\n\t\t\tlet ddfy = tmp1y * pre4 + tmp2y * pre5;\r\n\r\n\t\t\tlet dddfx = tmp2x * pre5;\r\n\t\t\tlet dddfy = tmp2y * pre5;\r\n\r\n\t\t\twhile (segments-- > 0) {\r\n\t\t\t\tthis.vertex(fx, fy, color);\r\n\t\t\t\tfx += dfx;\r\n\t\t\t\tfy += dfy;\r\n\t\t\t\tdfx += ddfx;\r\n\t\t\t\tdfy += ddfy;\r\n\t\t\t\tddfx += dddfx;\r\n\t\t\t\tddfy += dddfy;\r\n\t\t\t\tthis.vertex(fx, fy, color);\r\n\t\t\t}\r\n\t\t\tthis.vertex(fx, fy, color);\r\n\t\t\tthis.vertex(x2, y2, color);\r\n\t\t}\r\n\r\n\t\tprivate vertex (x: number, y: number, color: Color) {\r\n\t\t\tlet idx = this.vertexIndex;\r\n\t\t\tlet vertices = this.mesh.getVertices();\r\n\t\t\tvertices[idx++] = x;\r\n\t\t\tvertices[idx++] = y;\r\n\t\t\tvertices[idx++] = color.r;\r\n\t\t\tvertices[idx++] = color.g;\r\n\t\t\tvertices[idx++] = color.b;\r\n\t\t\tvertices[idx++] = color.a;\r\n\t\t\tthis.vertexIndex = idx;\r\n\t\t}\r\n\r\n\t\tend () {\r\n\t\t\tif (!this.isDrawing) throw new Error(\"ShapeRenderer.begin() has not been called\");\r\n\t\t\tthis.flush();\r\n\t\t\tthis.context.gl.disable(this.context.gl.BLEND);\r\n\t\t\tthis.isDrawing = false;\r\n\t\t}\r\n\r\n\t\tprivate flush () {\r\n\t\t\tif (this.vertexIndex == 0) return;\r\n\t\t\tthis.mesh.setVerticesLength(this.vertexIndex);\r\n\t\t\tthis.mesh.draw(this.shader, this.shapeType);\r\n\t\t\tthis.vertexIndex = 0;\r\n\t\t}\r\n\r\n\t\tprivate check(shapeType: ShapeType, numVertices: number) {\r\n\t\t\tif (!this.isDrawing) throw new Error(\"ShapeRenderer.begin() has not been called\");\r\n\t\t\tif (this.shapeType == shapeType) {\r\n\t\t\t\tif (this.mesh.maxVertices() - this.mesh.numVertices() < numVertices) this.flush();\r\n\t\t\t\telse return;\r\n\t\t\t} else {\r\n\t\t\t\tthis.flush();\r\n\t\t\t\tthis.shapeType = shapeType;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t\tthis.mesh.dispose();\r\n\t\t}\r\n\t}\r\n\r\n\texport enum ShapeType {\r\n\t\tPoint = 0x0000,\r\n\t\tLine = 0x0001,\r\n\t\tFilled = 0x0004\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Skeleton } from \"../core/Skeleton\";\r\nimport { TextureAtlasRegion } from \"../core/TextureAtlas\";\r\nimport { Color, MathUtils, Disposable } from \"../core/Utils\";\r\nimport { OrthoCamera, PerspectiveCamera, Camera } from \"./Camera\";\r\nimport { GLTexture } from \"./GLTexture\";\r\nimport { PolygonBatcher } from \"./PolygonBatcher\";\r\nimport { Shader } from \"./Shader\";\r\nimport { ShapeRenderer } from \"./ShapeRenderer\";\r\nimport { SkeletonDebugRenderer } from \"./SkeletonDebugRenderer\";\r\nimport { SkeletonRenderer } from \"./SkeletonRenderer\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\texport class SceneRenderer implements Disposable {\r\n\t\tcontext: ManagedWebGLRenderingContext;\r\n\t\tcanvas: HTMLCanvasElement|OffscreenCanvas;\r\n\t\t// camera: OrthoCamera;\r\n\t\torthoCamera: OrthoCamera;\r\n\t\tperspectiveCamera: PerspectiveCamera;\r\n\t\tcamera: Camera;\r\n\t\tbatcher: PolygonBatcher;\r\n\t\tprivate twoColorTint = false;\r\n\t\tprivate batcherShader: Shader;\r\n\t\tprivate shapes: ShapeRenderer;\r\n\t\tprivate shapesShader: Shader;\r\n\t\tprivate activeRenderer: PolygonBatcher | ShapeRenderer | SkeletonDebugRenderer = null;\r\n\t\tskeletonRenderer: SkeletonRenderer;\r\n\t\tskeletonDebugRenderer: SkeletonDebugRenderer;\r\n\t\tprivate QUAD = [\r\n\t\t\t0, 0, 1, 1, 1, 1, 0, 0,\r\n\t\t\t0, 0, 1, 1, 1, 1, 0, 0,\r\n\t\t\t0, 0, 1, 1, 1, 1, 0, 0,\r\n\t\t\t0, 0, 1, 1, 1, 1, 0, 0,\r\n\t\t];\r\n\t\tprivate QUAD_TRIANGLES = [0, 1, 2, 2, 3, 0];\r\n\t\tprivate WHITE = new Color(1, 1, 1, 1);\r\n\r\n\t\tconstructor (canvas: HTMLCanvasElement|OffscreenCanvas, context: ManagedWebGLRenderingContext | WebGLRenderingContext, twoColorTint: boolean = true) {\r\n\t\t\tthis.canvas = canvas;\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t\tthis.twoColorTint = twoColorTint;\r\n\t\t\t// this.camera = new OrthoCamera(canvas.width, canvas.height);\r\n\t\t\tthis.orthoCamera = new OrthoCamera(canvas.width, canvas.height);\r\n\t\t\tthis.perspectiveCamera = new PerspectiveCamera(canvas.width, canvas.height);\r\n\t\t\tthis.camera = this.perspectiveCamera;\r\n\r\n\t\t\tthis.batcherShader = twoColorTint ? Shader.newTwoColoredTextured(this.context) : Shader.newColoredTextured(this.context);\r\n\t\t\tthis.batcher = new PolygonBatcher(this.context, twoColorTint);\r\n\t\t\tthis.shapesShader = Shader.newColored(this.context);\r\n\t\t\tthis.shapes = new ShapeRenderer(this.context);\r\n\t\t\tthis.skeletonRenderer = new SkeletonRenderer(this.context, twoColorTint);\r\n\t\t\tthis.skeletonDebugRenderer = new SkeletonDebugRenderer(this.context);\r\n\t\t}\r\n\r\n\t\tbegin () {\r\n\t\t\tthis.camera.update();\r\n\t\t\tthis.enableRenderer(this.batcher);\r\n\t\t}\r\n\r\n\t\tdrawSkeleton (skeleton: Skeleton, premultipliedAlpha = false, slotRangeStart = -1, slotRangeEnd = -1) {\r\n\t\t\tthis.enableRenderer(this.batcher);\r\n\t\t\tthis.skeletonRenderer.premultipliedAlpha = premultipliedAlpha;\r\n\t\t\tthis.skeletonRenderer.draw(this.batcher, skeleton, slotRangeStart, slotRangeEnd);\r\n\t\t}\r\n\r\n\t\tdrawSkeletonDebug(skeleton: Skeleton, premultipliedAlpha = false, ignoredBones: Array<string> = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.skeletonDebugRenderer.premultipliedAlpha = premultipliedAlpha;\r\n\t\t\tthis.skeletonDebugRenderer.draw(this.shapes, skeleton, ignoredBones);\r\n\t\t}\r\n\r\n\t\tdrawTexture (texture: GLTexture, x: number, y: number, width: number, height: number, color: Color = null) {\r\n\t\t\tthis.enableRenderer(this.batcher);\r\n\t\t\tif (color === null) color = this.WHITE;\r\n\t\t\tlet quad = this.QUAD;\r\n\t\t\tvar i = 0;\r\n\t\t\tquad[i++] = x;\r\n\t\t\tquad[i++] = y;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x + width;\r\n\t\t\tquad[i++] = y;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x + width;\r\n\t\t\tquad[i++] = y + height;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x;\r\n\t\t\tquad[i++] = y + height;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tthis.batcher.draw(texture, quad, this.QUAD_TRIANGLES);\r\n\t\t}\r\n\r\n\t\tdrawTextureUV (texture: GLTexture, x: number, y: number, width: number, height: number, u: number, v: number, u2: number, v2: number, color: Color = null) {\r\n\t\t\tthis.enableRenderer(this.batcher);\r\n\t\t\tif (color === null) color = this.WHITE;\r\n\t\t\tlet quad = this.QUAD;\r\n\t\t\tvar i = 0;\r\n\t\t\tquad[i++] = x;\r\n\t\t\tquad[i++] = y;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = u;\r\n\t\t\tquad[i++] = v;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x + width;\r\n\t\t\tquad[i++] = y;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = u2;\r\n\t\t\tquad[i++] = v;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x + width;\r\n\t\t\tquad[i++] = y + height;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = u2;\r\n\t\t\tquad[i++] = v2;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x;\r\n\t\t\tquad[i++] = y + height;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = u;\r\n\t\t\tquad[i++] = v2;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tthis.batcher.draw(texture, quad, this.QUAD_TRIANGLES);\r\n\t\t}\r\n\r\n\t\tdrawTextureRotated (texture: GLTexture, x: number, y: number, width: number, height: number, pivotX: number, pivotY: number, angle: number, color: Color = null, premultipliedAlpha: boolean = false) {\r\n\t\t\tthis.enableRenderer(this.batcher);\r\n\t\t\tif (color === null) color = this.WHITE;\r\n\t\t\tlet quad = this.QUAD;\r\n\r\n\t\t\t// bottom left and top right corner points relative to origin\r\n\t\t\tlet worldOriginX = x + pivotX;\r\n\t\t\tlet worldOriginY = y + pivotY;\r\n\t\t\tlet fx = -pivotX;\r\n\t\t\tlet fy = -pivotY;\r\n\t\t\tlet fx2 = width - pivotX;\r\n\t\t\tlet fy2 = height - pivotY;\r\n\r\n\t\t\t// construct corner points, start from top left and go counter clockwise\r\n\t\t\tlet p1x = fx;\r\n\t\t\tlet p1y = fy;\r\n\t\t\tlet p2x = fx;\r\n\t\t\tlet p2y = fy2;\r\n\t\t\tlet p3x = fx2;\r\n\t\t\tlet p3y = fy2;\r\n\t\t\tlet p4x = fx2;\r\n\t\t\tlet p4y = fy;\r\n\r\n\t\t\tlet x1 = 0;\r\n\t\t\tlet y1 = 0;\r\n\t\t\tlet x2 = 0;\r\n\t\t\tlet y2 = 0;\r\n\t\t\tlet x3 = 0;\r\n\t\t\tlet y3 = 0;\r\n\t\t\tlet x4 = 0;\r\n\t\t\tlet y4 = 0;\r\n\r\n\t\t\t// rotate\r\n\t\t\tif (angle != 0) {\r\n\t\t\t\tlet cos = MathUtils.cosDeg(angle);\r\n\t\t\t\tlet sin = MathUtils.sinDeg(angle);\r\n\r\n\t\t\t\tx1 = cos * p1x - sin * p1y;\r\n\t\t\t\ty1 = sin * p1x + cos * p1y;\r\n\r\n\t\t\t\tx4 = cos * p2x - sin * p2y;\r\n\t\t\t\ty4 = sin * p2x + cos * p2y;\r\n\r\n\t\t\t\tx3 = cos * p3x - sin * p3y;\r\n\t\t\t\ty3 = sin * p3x + cos * p3y;\r\n\r\n\t\t\t\tx2 = x3 + (x1 - x4);\r\n\t\t\t\ty2 = y3 + (y1 - y4);\r\n\t\t\t} else {\r\n\t\t\t\tx1 = p1x;\r\n\t\t\t\ty1 = p1y;\r\n\r\n\t\t\t\tx4 = p2x;\r\n\t\t\t\ty4 = p2y;\r\n\r\n\t\t\t\tx3 = p3x;\r\n\t\t\t\ty3 = p3y;\r\n\r\n\t\t\t\tx2 = p4x;\r\n\t\t\t\ty2 = p4y;\r\n\t\t\t}\r\n\r\n\t\t\tx1 += worldOriginX;\r\n\t\t\ty1 += worldOriginY;\r\n\t\t\tx2 += worldOriginX;\r\n\t\t\ty2 += worldOriginY;\r\n\t\t\tx3 += worldOriginX;\r\n\t\t\ty3 += worldOriginY;\r\n\t\t\tx4 += worldOriginX;\r\n\t\t\ty4 += worldOriginY;\r\n\r\n\t\t\tvar i = 0;\r\n\t\t\tquad[i++] = x1;\r\n\t\t\tquad[i++] = y1;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x2;\r\n\t\t\tquad[i++] = y2;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x3;\r\n\t\t\tquad[i++] = y3;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 1;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x4;\r\n\t\t\tquad[i++] = y4;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tquad[i++] = 0;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tthis.batcher.draw(texture, quad, this.QUAD_TRIANGLES);\r\n\t\t}\r\n\r\n\t\tdrawRegion (region: TextureAtlasRegion, x: number, y: number, width: number, height: number, color: Color = null, premultipliedAlpha: boolean = false) {\r\n\t\t\tthis.enableRenderer(this.batcher);\r\n\t\t\tif (color === null) color = this.WHITE;\r\n\t\t\tlet quad = this.QUAD;\r\n\t\t\tvar i = 0;\r\n\t\t\tquad[i++] = x;\r\n\t\t\tquad[i++] = y;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = region.u;\r\n\t\t\tquad[i++] = region.v2;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x + width;\r\n\t\t\tquad[i++] = y;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = region.u2;\r\n\t\t\tquad[i++] = region.v2;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x + width;\r\n\t\t\tquad[i++] = y + height;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = region.u2;\r\n\t\t\tquad[i++] = region.v;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tquad[i++] = x;\r\n\t\t\tquad[i++] = y + height;\r\n\t\t\tquad[i++] = color.r;\r\n\t\t\tquad[i++] = color.g;\r\n\t\t\tquad[i++] = color.b;\r\n\t\t\tquad[i++] = color.a;\r\n\t\t\tquad[i++] = region.u;\r\n\t\t\tquad[i++] = region.v;\r\n\t\t\tif (this.twoColorTint) {\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t\tquad[i++] = 0;\r\n\t\t\t}\r\n\t\t\tthis.batcher.draw(<GLTexture>region.texture, quad, this.QUAD_TRIANGLES);\r\n\t\t}\r\n\r\n\t\tline (x: number, y: number, x2: number, y2: number, color: Color = null, color2: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.line(x, y, x2, y2, color);\r\n\t\t}\r\n\r\n\t\ttriangle (filled: boolean, x: number, y: number, x2: number, y2: number, x3: number, y3: number, color: Color = null, color2: Color = null, color3: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.triangle(filled, x, y, x2, y2, x3, y3, color, color2, color3);\r\n\t\t}\r\n\r\n\t\tquad (filled: boolean, x: number, y: number, x2: number, y2: number, x3: number, y3: number, x4: number, y4: number, color: Color = null, color2: Color = null, color3: Color = null, color4: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.quad(filled, x, y, x2, y2, x3, y3, x4, y4, color, color2, color3, color4);\r\n\t\t}\r\n\r\n\t\trect (filled: boolean, x: number, y: number, width: number, height: number, color: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.rect(filled, x, y, width, height, color);\r\n\t\t}\r\n\r\n\t\trectLine (filled: boolean, x1: number, y1: number, x2: number, y2: number, width: number, color: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.rectLine(filled, x1, y1, x2, y2, width, color);\r\n\t\t}\r\n\r\n\t\tpolygon (polygonVertices: ArrayLike<number>, offset: number, count: number, color: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.polygon(polygonVertices, offset, count, color);\r\n\t\t}\r\n\r\n\t\tcircle (filled: boolean, x: number, y: number, radius: number, color: Color = null, segments: number = 0) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.circle(filled, x, y, radius, color, segments);\r\n\t\t}\r\n\r\n\t\tcurve (x1: number, y1: number, cx1: number, cy1: number, cx2: number, cy2: number, x2: number, y2: number, segments: number, color: Color = null) {\r\n\t\t\tthis.enableRenderer(this.shapes);\r\n\t\t\tthis.shapes.curve(x1, y1, cx1, cy1, cx2, cy2, x2, y2, segments, color);\r\n\t\t}\r\n\r\n\t\tend () {\r\n\t\t\tif (this.activeRenderer === this.batcher) this.batcher.end();\r\n\t\t\telse if (this.activeRenderer === this.shapes) this.shapes.end();\r\n\t\t\tthis.activeRenderer = null;\r\n\t\t}\r\n\r\n\t\tresize (resizeMode: ResizeMode) {\r\n\t\t\tlet canvas = this.canvas;\r\n\t\t\tlet w = 0;\r\n\t\t\tlet h = 0;\r\n\t\t\tif (canvas instanceof HTMLCanvasElement) {\r\n\t\t\t\tw = canvas.clientWidth;\r\n\t\t\t\th = canvas.clientHeight;\r\n\t\t\t} else if (canvas instanceof OffscreenCanvas) {\r\n\t\t\t\tw = canvas.width;\r\n\t\t\t\th = canvas.height;\t\t\t\t\r\n\t\t\t}\r\n\t\t\r\n\t\t\tif (canvas.width != w || canvas.height != h) {\r\n\t\t\t\tcanvas.width = w;\r\n\t\t\t\tcanvas.height = h;\r\n\t\t\t}\r\n\t\t\tthis.context.gl.viewport(0, 0, canvas.width, canvas.height);\r\n\r\n\t\t\tif (resizeMode === ResizeMode.Stretch) {\r\n\t\t\t\t// nothing to do, we simply apply the viewport size of the camera\r\n\t\t\t} else if (resizeMode === ResizeMode.Expand) {\r\n\t\t\t\tthis.camera.setViewport(w, h);\r\n\t\t\t} else if (resizeMode === ResizeMode.Fit) {\r\n\t\t\t\tlet sourceWidth = canvas.width, sourceHeight = canvas.height;\r\n\t\t\t\tlet targetWidth = this.camera.viewportWidth, targetHeight = this.camera.viewportHeight;\r\n\t\t\t\tlet targetRatio = targetHeight / targetWidth;\r\n\t\t\t\tlet sourceRatio = sourceHeight / sourceWidth;\r\n\t\t\t\tlet scale = targetRatio < sourceRatio ? targetWidth / sourceWidth : targetHeight / sourceHeight;\r\n\t\t\t\tthis.camera.viewportWidth = sourceWidth * scale;\r\n\t\t\t\tthis.camera.viewportHeight = sourceHeight * scale;\r\n\t\t\t}\r\n\t\t\tthis.camera.update();\r\n\t\t}\r\n\r\n\t\tprivate enableRenderer(renderer: PolygonBatcher | ShapeRenderer | SkeletonDebugRenderer) {\r\n\t\t\tif (this.activeRenderer === renderer) return;\r\n\t\t\tthis.end();\r\n\t\t\tif (renderer instanceof PolygonBatcher) {\r\n\t\t\t\tthis.batcherShader.bind();\r\n\t\t\t\tthis.batcherShader.setUniform4x4f(Shader.MVP_MATRIX, this.camera.projectionView.values);\r\n\t\t\t\tthis.batcherShader.setUniformi(\"u_texture\", 0);\r\n\t\t\t\tthis.batcher.begin(this.batcherShader);\r\n\t\t\t\tthis.activeRenderer = this.batcher;\r\n\t\t\t} else if (renderer instanceof ShapeRenderer) {\r\n\t\t\t\tthis.shapesShader.bind();\r\n\t\t\t\tthis.shapesShader.setUniform4x4f(Shader.MVP_MATRIX, this.camera.projectionView.values);\r\n\t\t\t\tthis.shapes.begin(this.shapesShader);\r\n\t\t\t\tthis.activeRenderer = this.shapes;\r\n\t\t\t} else {\r\n\t\t\t\tthis.activeRenderer = this.skeletonDebugRenderer;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t\tthis.batcher.dispose();\r\n\t\t\tthis.batcherShader.dispose();\r\n\t\t\tthis.shapes.dispose();\r\n\t\t\tthis.shapesShader.dispose();\r\n\t\t\tthis.skeletonDebugRenderer.dispose();\r\n\t\t}\r\n\t}\r\n\r\n\texport enum ResizeMode {\r\n\t\tStretch,\r\n\t\tExpand,\r\n\t\tFit\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { MixBlend, AttachmentTimeline, MixDirection, RotateTimeline, DrawOrderTimeline, Timeline, EventTimeline, Animation } from \"./Animation\";\r\nimport { AnimationStateData } from \"./AnimationStateData\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Slot } from \"./Slot\";\r\nimport { IntSet, Pool, Utils, MathUtils } from \"./Utils\";\r\nimport {Event } from \"./Event\";\r\n\r\n// module spine {\r\n\r\n\t/** Applies animations over time, queues animations for later playback, mixes (crossfading) between animations, and applies\r\n\t * multiple animations on top of each other (layering).\r\n\t *\r\n\t * See [Applying Animations](http://esotericsoftware.com/spine-applying-animations/) in the Spine Runtimes Guide. */\r\n\texport class AnimationState {\r\n\t\tstatic emptyAnimation = new Animation(\"<empty>\", [], 0);\r\n\r\n\t\t/** 1. A previously applied timeline has set this property.\r\n\t\t *\r\n\t \t * Result: Mix from the current pose to the timeline pose. */\r\n\t\tstatic SUBSEQUENT = 0;\r\n\t\t/** 1. This is the first timeline to set this property.\r\n\t\t * 2. The next track entry applied after this one does not have a timeline to set this property.\r\n\t\t *\r\n\t\t * Result: Mix from the setup pose to the timeline pose. */\r\n\t\tstatic FIRST = 1;\r\n\t\t/** 1. This is the first timeline to set this property.\r\n\t\t * 2. The next track entry to be applied does have a timeline to set this property.\r\n\t\t * 3. The next track entry after that one does not have a timeline to set this property.\r\n\t\t *\r\n\t\t * Result: Mix from the setup pose to the timeline pose, but do not mix out. This avoids \"dipping\" when crossfading animations\r\n\t\t * that key the same property. A subsequent timeline will set this property using a mix. */\r\n\t\tstatic HOLD = 2;\r\n\t\t/** 1. This is the first timeline to set this property.\r\n\t\t * 2. The next track entry to be applied does have a timeline to set this property.\r\n\t\t * 3. The next track entry after that one does have a timeline to set this property.\r\n\t\t * 4. timelineHoldMix stores the first subsequent track entry that does not have a timeline to set this property.\r\n\t\t *\r\n\t\t * Result: The same as HOLD except the mix percentage from the timelineHoldMix track entry is used. This handles when more than\r\n\t\t * 2 track entries in a row have a timeline that sets the same property.\r\n\t\t *\r\n\t\t * Eg, A -> B -> C -> D where A, B, and C have a timeline setting same property, but D does not. When A is applied, to avoid\r\n\t\t * \"dipping\" A is not mixed out, however D (the first entry that doesn't set the property) mixing in is used to mix out A\r\n\t\t * (which affects B and C). Without using D to mix out, A would be applied fully until mixing completes, then snap into\r\n\t\t * place. */\r\n\t\tstatic HOLD_MIX = 3;\r\n\r\n\t\tstatic SETUP = 1;\r\n\t\tstatic CURRENT = 2;\r\n\r\n\t\t/** The AnimationStateData to look up mix durations. */\r\n\t\tdata: AnimationStateData;\r\n\r\n\t\t/** The list of tracks that currently have animations, which may contain null entries. */\r\n\t\ttracks = new Array<TrackEntry>();\r\n\r\n\t\t/** Multiplier for the delta time when the animation state is updated, causing time for all animations and mixes to play slower\r\n\t\t * or faster. Defaults to 1.\r\n\t\t *\r\n\t\t * See TrackEntry {@link TrackEntry#timeScale} for affecting a single animation. */\r\n\t\ttimeScale = 1;\r\n\t\tunkeyedState = 0;\r\n\r\n\t\tevents = new Array<Event>();\r\n\t\tlisteners = new Array<AnimationStateListener>();\r\n\t\tqueue = new EventQueue(this);\r\n\t\tpropertyIDs = new IntSet();\r\n\t\tanimationsChanged = false;\r\n\r\n\t\ttrackEntryPool = new Pool<TrackEntry>(() => new TrackEntry());\r\n\r\n\t\tconstructor (data: AnimationStateData) {\r\n\t\t\tthis.data = data;\r\n\t\t}\r\n\r\n\t\t/** Increments each track entry {@link TrackEntry#trackTime()}, setting queued animations as current if needed. */\r\n\t\tupdate (delta: number) {\r\n\t\t\tdelta *= this.timeScale;\r\n\t\t\tlet tracks = this.tracks;\r\n\t\t\tfor (let i = 0, n = tracks.length; i < n; i++) {\r\n\t\t\t\tlet current = tracks[i];\r\n\t\t\t\tif (current == null) continue;\r\n\r\n\t\t\t\tcurrent.animationLast = current.nextAnimationLast;\r\n\t\t\t\tcurrent.trackLast = current.nextTrackLast;\r\n\r\n\t\t\t\tlet currentDelta = delta * current.timeScale;\r\n\r\n\t\t\t\tif (current.delay > 0) {\r\n\t\t\t\t\tcurrent.delay -= currentDelta;\r\n\t\t\t\t\tif (current.delay > 0) continue;\r\n\t\t\t\t\tcurrentDelta = -current.delay;\r\n\t\t\t\t\tcurrent.delay = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet next = current.next;\r\n\t\t\t\tif (next != null) {\r\n\t\t\t\t\t// When the next entry's delay is passed, change to the next entry, preserving leftover time.\r\n\t\t\t\t\tlet nextTime = current.trackLast - next.delay;\r\n\t\t\t\t\tif (nextTime >= 0) {\r\n\t\t\t\t\t\tnext.delay = 0;\r\n\t\t\t\t\t\tnext.trackTime += current.timeScale == 0 ? 0 : (nextTime / current.timeScale + delta) * next.timeScale;\r\n\t\t\t\t\t\tcurrent.trackTime += currentDelta;\r\n\t\t\t\t\t\tthis.setCurrent(i, next, true);\r\n\t\t\t\t\t\twhile (next.mixingFrom != null) {\r\n\t\t\t\t\t\t\tnext.mixTime += delta;\r\n\t\t\t\t\t\t\tnext = next.mixingFrom;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (current.trackLast >= current.trackEnd && current.mixingFrom == null) {\r\n\t\t\t\t\ttracks[i] = null;\r\n\t\t\t\t\tthis.queue.end(current);\r\n\t\t\t\t\tthis.disposeNext(current);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (current.mixingFrom != null && this.updateMixingFrom(current, delta)) {\r\n\t\t\t\t\t// End mixing from entries once all have completed.\r\n\t\t\t\t\tlet from = current.mixingFrom;\r\n\t\t\t\t\tcurrent.mixingFrom = null;\r\n\t\t\t\t\tif (from != null) from.mixingTo = null;\r\n\t\t\t\t\twhile (from != null) {\r\n\t\t\t\t\t\tthis.queue.end(from);\r\n\t\t\t\t\t\tfrom = from.mixingFrom;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcurrent.trackTime += currentDelta;\r\n\t\t\t}\r\n\r\n\t\t\tthis.queue.drain();\r\n\t\t}\r\n\r\n\t\t/** Returns true when all mixing from entries are complete. */\r\n\t\tupdateMixingFrom (to: TrackEntry, delta: number): boolean {\r\n\t\t\tlet from = to.mixingFrom;\r\n\t\t\tif (from == null) return true;\r\n\r\n\t\t\tlet finished = this.updateMixingFrom(from, delta);\r\n\r\n\t\t\tfrom.animationLast = from.nextAnimationLast;\r\n\t\t\tfrom.trackLast = from.nextTrackLast;\r\n\r\n\t\t\t// Require mixTime > 0 to ensure the mixing from entry was applied at least once.\r\n\t\t\tif (to.mixTime > 0 && to.mixTime >= to.mixDuration) {\r\n\t\t\t\t// Require totalAlpha == 0 to ensure mixing is complete, unless mixDuration == 0 (the transition is a single frame).\r\n\t\t\t\tif (from.totalAlpha == 0 || to.mixDuration == 0) {\r\n\t\t\t\t\tto.mixingFrom = from.mixingFrom;\r\n\t\t\t\t\tif (from.mixingFrom != null) from.mixingFrom.mixingTo = to;\r\n\t\t\t\t\tto.interruptAlpha = from.interruptAlpha;\r\n\t\t\t\t\tthis.queue.end(from);\r\n\t\t\t\t}\r\n\t\t\t\treturn finished;\r\n\t\t\t}\r\n\r\n\t\t\tfrom.trackTime += delta * from.timeScale;\r\n\t\t\tto.mixTime += delta;\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t/** Poses the skeleton using the track entry animations. There are no side effects other than invoking listeners, so the\r\n\t\t * animation state can be applied to multiple skeletons to pose them identically.\r\n\t\t * @returns True if any animations were applied. */\r\n\t\tapply (skeleton: Skeleton) : boolean {\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\t\t\tif (this.animationsChanged) this._animationsChanged();\r\n\r\n\t\t\tlet events = this.events;\r\n\t\t\tlet tracks = this.tracks;\r\n\t\t\tlet applied = false;\r\n\r\n\t\t\tfor (let i = 0, n = tracks.length; i < n; i++) {\r\n\t\t\t\tlet current = tracks[i];\r\n\t\t\t\tif (current == null || current.delay > 0) continue;\r\n\t\t\t\tapplied = true;\r\n\t\t\t\tlet blend: MixBlend = i == 0 ? MixBlend.first : current.mixBlend;\r\n\r\n\t\t\t\t// Apply mixing from entries first.\r\n\t\t\t\tlet mix = current.alpha;\r\n\t\t\t\tif (current.mixingFrom != null)\r\n\t\t\t\t\tmix *= this.applyMixingFrom(current, skeleton, blend);\r\n\t\t\t\telse if (current.trackTime >= current.trackEnd && current.next == null)\r\n\t\t\t\t\tmix = 0;\r\n\r\n\t\t\t\t// Apply current entry.\r\n\t\t\t\tlet animationLast = current.animationLast, animationTime = current.getAnimationTime();\r\n\t\t\t\tlet timelineCount = current.animation.timelines.length;\r\n\t\t\t\tlet timelines = current.animation.timelines;\r\n\t\t\t\tif ((i == 0 && mix == 1) || blend == MixBlend.add) {\r\n\t\t\t\t\tfor (let ii = 0; ii < timelineCount; ii++) {\r\n\t\t\t\t\t\t// Fixes issue #302 on IOS9 where mix, blend sometimes became undefined and caused assets\r\n\t\t\t\t\t\t// to sometimes stop rendering when using color correction, as their RGBA values become NaN.\r\n\t\t\t\t\t\t// (https://github.com/pixijs/pixi-spine/issues/302)\r\n\t\t\t\t\t\tUtils.webkit602BugfixHelper(mix, blend);\r\n\t\t\t\t\t\tvar timeline = timelines[ii];\r\n\t\t\t\t\t\tif (timeline instanceof AttachmentTimeline)\r\n\t\t\t\t\t\t\tthis.applyAttachmentTimeline(timeline, skeleton, animationTime, blend, true);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\ttimeline.apply(skeleton, animationLast, animationTime, events, mix, blend, MixDirection.mixIn);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet timelineMode = current.timelineMode;\r\n\r\n\t\t\t\t\tlet firstFrame = current.timelinesRotation.length == 0;\r\n\t\t\t\t\tif (firstFrame) Utils.setArraySize(current.timelinesRotation, timelineCount << 1, null);\r\n\t\t\t\t\tlet timelinesRotation = current.timelinesRotation;\r\n\r\n\t\t\t\t\tfor (let ii = 0; ii < timelineCount; ii++) {\r\n\t\t\t\t\t\tlet timeline = timelines[ii];\r\n\t\t\t\t\t\tlet timelineBlend = timelineMode[ii]  == AnimationState.SUBSEQUENT ? blend : MixBlend.setup;\r\n\t\t\t\t\t\tif (timeline instanceof RotateTimeline) {\r\n\t\t\t\t\t\t\tthis.applyRotateTimeline(timeline, skeleton, animationTime, mix, timelineBlend, timelinesRotation, ii << 1, firstFrame);\r\n\t\t\t\t\t\t} else if (timeline instanceof AttachmentTimeline) {\r\n\t\t\t\t\t\t\tthis.applyAttachmentTimeline(timeline, skeleton, animationTime, blend, true);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// This fixes the WebKit 602 specific issue described at http://esotericsoftware.com/forum/iOS-10-disappearing-graphics-10109\r\n\t\t\t\t\t\t\tUtils.webkit602BugfixHelper(mix, blend);\r\n\t\t\t\t\t\t\ttimeline.apply(skeleton, animationLast, animationTime, events, mix, timelineBlend, MixDirection.mixIn);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.queueEvents(current, animationTime);\r\n\t\t\t\tevents.length = 0;\r\n\t\t\t\tcurrent.nextAnimationLast = animationTime;\r\n\t\t\t\tcurrent.nextTrackLast = current.trackTime;\r\n\t\t\t}\r\n\r\n\t\t\t// Set slots attachments to the setup pose, if needed. This occurs if an animation that is mixing out sets attachments so\r\n\t\t\t// subsequent timelines see any deform, but the subsequent timelines don't set an attachment (eg they are also mixing out or\r\n\t\t\t// the time is before the first key).\r\n\t\t\tvar setupState = this.unkeyedState + AnimationState.SETUP;\r\n\t\t\tvar slots = skeleton.slots;\r\n\t\t\tfor (var i = 0, n = skeleton.slots.length; i < n; i++) {\r\n\t\t\t\tvar slot = slots[i];\r\n\t\t\t\tif (slot.attachmentState == setupState) {\r\n\t\t\t\t\tvar attachmentName = slot.data.attachmentName;\r\n\t\t\t\t\tslot.attachment = (attachmentName == null ? null : skeleton.getAttachment(slot.data.index, attachmentName));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.unkeyedState += 2; // Increasing after each use avoids the need to reset attachmentState for every slot.\r\n\r\n\t\t\tthis.queue.drain();\r\n\t\t\treturn applied;\r\n\t\t}\r\n\r\n\t\tapplyMixingFrom (to: TrackEntry, skeleton: Skeleton, blend: MixBlend) {\r\n\t\t\tlet from = to.mixingFrom;\r\n\t\t\tif (from.mixingFrom != null) this.applyMixingFrom(from, skeleton, blend);\r\n\r\n\t\t\tlet mix = 0;\r\n\t\t\tif (to.mixDuration == 0) { // Single frame mix to undo mixingFrom changes.\r\n\t\t\t\tmix = 1;\r\n\t\t\t\tif (blend == MixBlend.first) blend = MixBlend.setup;\r\n\t\t\t} else {\r\n\t\t\t\tmix = to.mixTime / to.mixDuration;\r\n\t\t\t\tif (mix > 1) mix = 1;\r\n\t\t\t\tif (blend != MixBlend.first) blend = from.mixBlend;\r\n\t\t\t}\r\n\r\n\t\t\tlet events = mix < from.eventThreshold ? this.events : null;\r\n\t\t\tlet attachments = mix < from.attachmentThreshold, drawOrder = mix < from.drawOrderThreshold;\r\n\t\t\tlet animationLast = from.animationLast, animationTime = from.getAnimationTime();\r\n\t\t\tlet timelineCount = from.animation.timelines.length;\r\n\t\t\tlet timelines = from.animation.timelines;\r\n\t\t\tlet alphaHold = from.alpha * to.interruptAlpha, alphaMix = alphaHold * (1 - mix);\r\n\t\t\tif (blend == MixBlend.add) {\r\n\t\t\t\tfor (let i = 0; i < timelineCount; i++)\r\n\t\t\t\t\ttimelines[i].apply(skeleton, animationLast, animationTime, events, alphaMix, blend, MixDirection.mixOut);\r\n\t\t\t} else {\r\n\t\t\t\tlet timelineMode = from.timelineMode;\r\n\t\t\t\tlet timelineHoldMix = from.timelineHoldMix;\r\n\r\n\t\t\t\tlet firstFrame = from.timelinesRotation.length == 0;\r\n\t\t\t\tif (firstFrame) Utils.setArraySize(from.timelinesRotation, timelineCount << 1, null);\r\n\t\t\t\tlet timelinesRotation = from.timelinesRotation;\r\n\r\n\t\t\t\tfrom.totalAlpha = 0;\r\n\t\t\t\tfor (let i = 0; i < timelineCount; i++) {\r\n\t\t\t\t\tlet timeline = timelines[i];\r\n\t\t\t\t\tlet direction = MixDirection.mixOut;\r\n\t\t\t\t\tlet timelineBlend: MixBlend;\r\n\t\t\t\t\tlet alpha = 0;\r\n\t\t\t\t\tswitch (timelineMode[i]) {\r\n\t\t\t\t\tcase AnimationState.SUBSEQUENT:\r\n\t\t\t\t\t\tif (!drawOrder && timeline instanceof DrawOrderTimeline) continue;\r\n\t\t\t\t\t\ttimelineBlend = blend;\r\n\t\t\t\t\t\talpha = alphaMix;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AnimationState.FIRST:\r\n\t\t\t\t\t\ttimelineBlend = MixBlend.setup;\r\n\t\t\t\t\t\talpha = alphaMix;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AnimationState.HOLD:\r\n\t\t\t\t\t\ttimelineBlend = MixBlend.setup;\r\n\t\t\t\t\t\talpha = alphaHold;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\ttimelineBlend = MixBlend.setup;\r\n\t\t\t\t\t\tlet holdMix = timelineHoldMix[i];\r\n\t\t\t\t\t\talpha = alphaHold * Math.max(0, 1 - holdMix.mixTime / holdMix.mixDuration);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfrom.totalAlpha += alpha;\r\n\r\n\t\t\t\t\tif (timeline instanceof RotateTimeline)\r\n\t\t\t\t\t\tthis.applyRotateTimeline(timeline, skeleton, animationTime, alpha, timelineBlend, timelinesRotation, i << 1, firstFrame);\r\n\t\t\t\t\telse if (timeline instanceof AttachmentTimeline)\r\n\t\t\t\t\t\tthis.applyAttachmentTimeline(timeline, skeleton, animationTime, timelineBlend, attachments);\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// This fixes the WebKit 602 specific issue described at http://esotericsoftware.com/forum/iOS-10-disappearing-graphics-10109\r\n\t\t\t\t\t\tUtils.webkit602BugfixHelper(alpha, blend);\r\n\t\t\t\t\t\tif (drawOrder && timeline instanceof DrawOrderTimeline && timelineBlend == MixBlend.setup)\r\n\t\t\t\t\t\t\tdirection = MixDirection.mixIn;\r\n\t\t\t\t\t\ttimeline.apply(skeleton, animationLast, animationTime, events, alpha, timelineBlend, direction);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (to.mixDuration > 0) this.queueEvents(from, animationTime);\r\n\t\t\tthis.events.length = 0;\r\n\t\t\tfrom.nextAnimationLast = animationTime;\r\n\t\t\tfrom.nextTrackLast = from.trackTime;\r\n\r\n\t\t\treturn mix;\r\n\t\t}\r\n\r\n\t\tapplyAttachmentTimeline (timeline: AttachmentTimeline, skeleton: Skeleton, time: number, blend: MixBlend, attachments: boolean) {\r\n\r\n\t\t\tvar slot = skeleton.slots[timeline.slotIndex];\r\n\t\t\tif (!slot.bone.active) return;\r\n\r\n\t\t\tvar frames = timeline.frames;\r\n\t\t\tif (time < frames[0]) { // Time is before first frame.\r\n\t\t\t\tif (blend == MixBlend.setup || blend == MixBlend.first)\r\n\t\t\t\t\tthis.setAttachment(skeleton, slot, slot.data.attachmentName, attachments);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar frameIndex;\r\n\t\t\t\tif (time >= frames[frames.length - 1]) // Time is after last frame.\r\n\t\t\t\t\tframeIndex = frames.length - 1;\r\n\t\t\t\telse\r\n\t\t\t\t\tframeIndex = Animation.binarySearch(frames, time) - 1;\r\n\t\t\t\tthis.setAttachment(skeleton, slot, timeline.attachmentNames[frameIndex], attachments);\r\n\t\t\t}\r\n\r\n\t\t\t// If an attachment wasn't set (ie before the first frame or attachments is false), set the setup attachment later.\r\n\t\t\tif (slot.attachmentState <= this.unkeyedState) slot.attachmentState = this.unkeyedState + AnimationState.SETUP;\r\n\t\t}\r\n\r\n\t\tsetAttachment (skeleton: Skeleton, slot: Slot, attachmentName: string, attachments: boolean) {\r\n\t\t\tslot.attachment = attachmentName == null ? null : skeleton.getAttachment(slot.data.index, attachmentName);\r\n\t\t\tif (attachments) slot.attachmentState = this.unkeyedState + AnimationState.CURRENT;\r\n\t\t}\r\n\r\n\r\n\t\tapplyRotateTimeline (timeline: Timeline, skeleton: Skeleton, time: number, alpha: number, blend: MixBlend,\r\n\t\t\ttimelinesRotation: Array<number>, i: number, firstFrame: boolean) {\r\n\r\n\t\t\tif (firstFrame) timelinesRotation[i] = 0;\r\n\r\n\t\t\tif (alpha == 1) {\r\n\t\t\t\ttimeline.apply(skeleton, 0, time, null, 1, blend, MixDirection.mixIn);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet rotateTimeline = timeline as RotateTimeline;\r\n\t\t\tlet frames = rotateTimeline.frames;\r\n\t\t\tlet bone = skeleton.bones[rotateTimeline.boneIndex];\r\n\t\t\tif (!bone.active) return;\r\n\t\t\tlet r1 = 0, r2 = 0;\r\n\t\t\tif (time < frames[0]) {\r\n\t\t\t\tswitch (blend) {\r\n\t\t\t\t\tcase MixBlend.setup:\r\n\t\t\t\t\t\tbone.rotation = bone.data.rotation;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\tcase MixBlend.first:\r\n\t\t\t\t\t\tr1 = bone.rotation;\r\n\t\t\t\t\t\tr2 = bone.data.rotation;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tr1 = blend == MixBlend.setup ? bone.data.rotation : bone.rotation;\r\n\t\t\t\tif (time >= frames[frames.length - RotateTimeline.ENTRIES]) // Time is after last frame.\r\n\t\t\t\t\tr2 = bone.data.rotation + frames[frames.length + RotateTimeline.PREV_ROTATION];\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Interpolate between the previous frame and the current frame.\r\n\t\t\t\t\tlet frame = Animation.binarySearch(frames, time, RotateTimeline.ENTRIES);\r\n\t\t\t\t\tlet prevRotation = frames[frame + RotateTimeline.PREV_ROTATION];\r\n\t\t\t\t\tlet frameTime = frames[frame];\r\n\t\t\t\t\tlet percent = rotateTimeline.getCurvePercent((frame >> 1) - 1,\r\n\t\t\t\t\t\t1 - (time - frameTime) / (frames[frame + RotateTimeline.PREV_TIME] - frameTime));\r\n\r\n\t\t\t\t\tr2 = frames[frame + RotateTimeline.ROTATION] - prevRotation;\r\n\t\t\t\t\tr2 -= (16384 - ((16384.499999999996 - r2 / 360) | 0)) * 360;\r\n\t\t\t\t\tr2 = prevRotation + r2 * percent + bone.data.rotation;\r\n\t\t\t\t\tr2 -= (16384 - ((16384.499999999996 - r2 / 360) | 0)) * 360;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Mix between rotations using the direction of the shortest route on the first frame while detecting crosses.\r\n\t\t\tlet total = 0, diff = r2 - r1;\r\n\t\t\tdiff -= (16384 - ((16384.499999999996 - diff / 360) | 0)) * 360;\r\n\t\t\tif (diff == 0) {\r\n\t\t\t\ttotal = timelinesRotation[i];\r\n\t\t\t} else {\r\n\t\t\t\tlet lastTotal = 0, lastDiff = 0;\r\n\t\t\t\tif (firstFrame) {\r\n\t\t\t\t\tlastTotal = 0;\r\n\t\t\t\t\tlastDiff = diff;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlastTotal = timelinesRotation[i]; // Angle and direction of mix, including loops.\r\n\t\t\t\t\tlastDiff = timelinesRotation[i + 1]; // Difference between bones.\r\n\t\t\t\t}\r\n\t\t\t\tlet current = diff > 0, dir = lastTotal >= 0;\r\n\t\t\t\t// Detect cross at 0 (not 180).\r\n\t\t\t\tif (MathUtils.signum(lastDiff) != MathUtils.signum(diff) && Math.abs(lastDiff) <= 90) {\r\n\t\t\t\t\t// A cross after a 360 rotation is a loop.\r\n\t\t\t\t\tif (Math.abs(lastTotal) > 180) lastTotal += 360 * MathUtils.signum(lastTotal);\r\n\t\t\t\t\tdir = current;\r\n\t\t\t\t}\r\n\t\t\t\ttotal = diff + lastTotal - lastTotal % 360; // Store loops as part of lastTotal.\r\n\t\t\t\tif (dir != current) total += 360 * MathUtils.signum(lastTotal);\r\n\t\t\t\ttimelinesRotation[i] = total;\r\n\t\t\t}\r\n\t\t\ttimelinesRotation[i + 1] = diff;\r\n\t\t\tr1 += total * alpha;\r\n\t\t\tbone.rotation = r1 - (16384 - ((16384.499999999996 - r1 / 360) | 0)) * 360;\r\n\t\t}\r\n\r\n\t\tqueueEvents (entry: TrackEntry, animationTime: number) {\r\n\t\t\tlet animationStart = entry.animationStart, animationEnd = entry.animationEnd;\r\n\t\t\tlet duration = animationEnd - animationStart;\r\n\t\t\tlet trackLastWrapped = entry.trackLast % duration;\r\n\r\n\t\t\t// Queue events before complete.\r\n\t\t\tlet events = this.events;\r\n\t\t\tlet i = 0, n = events.length;\r\n\t\t\tfor (; i < n; i++) {\r\n\t\t\t\tlet event = events[i];\r\n\t\t\t\tif (event.time < trackLastWrapped) break;\r\n\t\t\t\tif (event.time > animationEnd) continue; // Discard events outside animation start/end.\r\n\t\t\t\tthis.queue.event(entry, event);\r\n\t\t\t}\r\n\r\n\t\t\t// Queue complete if completed a loop iteration or the animation.\r\n\t\t\tlet complete = false;\r\n\t\t\tif (entry.loop)\r\n\t\t\t\tcomplete = duration == 0 || trackLastWrapped > entry.trackTime % duration;\r\n\t\t\telse\r\n\t\t\t\tcomplete = animationTime >= animationEnd && entry.animationLast < animationEnd;\r\n\t\t\tif (complete) this.queue.complete(entry);\r\n\r\n\t\t\t// Queue events after complete.\r\n\t\t\tfor (; i < n; i++) {\r\n\t\t\t\tlet event = events[i];\r\n\t\t\t\tif (event.time < animationStart) continue; // Discard events outside animation start/end.\r\n\t\t\t\tthis.queue.event(entry, events[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Removes all animations from all tracks, leaving skeletons in their current pose.\r\n\t\t *\r\n\t\t * It may be desired to use {@link AnimationState#setEmptyAnimation()} to mix the skeletons back to the setup pose,\r\n\t\t * rather than leaving them in their current pose. */\r\n\t\tclearTracks () {\r\n\t\t\tlet oldDrainDisabled = this.queue.drainDisabled;\r\n\t\t\tthis.queue.drainDisabled = true;\r\n\t\t\tfor (let i = 0, n = this.tracks.length; i < n; i++)\r\n\t\t\t\tthis.clearTrack(i);\r\n\t\t\tthis.tracks.length = 0;\r\n\t\t\tthis.queue.drainDisabled = oldDrainDisabled;\r\n\t\t\tthis.queue.drain();\r\n\t\t}\r\n\r\n\t\t/** Removes all animations from the track, leaving skeletons in their current pose.\r\n\t\t *\r\n\t\t * It may be desired to use {@link AnimationState#setEmptyAnimation()} to mix the skeletons back to the setup pose,\r\n\t\t * rather than leaving them in their current pose. */\r\n\t\tclearTrack (trackIndex: number) {\r\n\t\t\tif (trackIndex >= this.tracks.length) return;\r\n\t\t\tlet current = this.tracks[trackIndex];\r\n\t\t\tif (current == null) return;\r\n\r\n\t\t\tthis.queue.end(current);\r\n\r\n\t\t\tthis.disposeNext(current);\r\n\r\n\t\t\tlet entry = current;\r\n\t\t\twhile (true) {\r\n\t\t\t\tlet from = entry.mixingFrom;\r\n\t\t\t\tif (from == null) break;\r\n\t\t\t\tthis.queue.end(from);\r\n\t\t\t\tentry.mixingFrom = null;\r\n\t\t\t\tentry.mixingTo = null;\r\n\t\t\t\tentry = from;\r\n\t\t\t}\r\n\r\n\t\t\tthis.tracks[current.trackIndex] = null;\r\n\r\n\t\t\tthis.queue.drain();\r\n\t\t}\r\n\r\n\t\tsetCurrent (index: number, current: TrackEntry, interrupt: boolean) {\r\n\t\t\tlet from = this.expandToIndex(index);\r\n\t\t\tthis.tracks[index] = current;\r\n\r\n\t\t\tif (from != null) {\r\n\t\t\t\tif (interrupt) this.queue.interrupt(from);\r\n\t\t\t\tcurrent.mixingFrom = from;\r\n\t\t\t\tfrom.mixingTo = current;\r\n\t\t\t\tcurrent.mixTime = 0;\r\n\r\n\t\t\t\t// Store the interrupted mix percentage.\r\n\t\t\t\tif (from.mixingFrom != null && from.mixDuration > 0)\r\n\t\t\t\t\tcurrent.interruptAlpha *= Math.min(1, from.mixTime / from.mixDuration);\r\n\r\n\t\t\t\tfrom.timelinesRotation.length = 0; // Reset rotation for mixing out, in case entry was mixed in.\r\n\t\t\t}\r\n\r\n\t\t\tthis.queue.start(current);\r\n\t\t}\r\n\r\n\t\t/** Sets an animation by name.\r\n\t \t*\r\n\t \t* {@link #setAnimationWith(}. */\r\n\t\tsetAnimation (trackIndex: number, animationName: string, loop: boolean) {\r\n\t\t\tlet animation = this.data.skeletonData.findAnimation(animationName);\r\n\t\t\tif (animation == null) throw new Error(\"Animation not found: \" + animationName);\r\n\t\t\treturn this.setAnimationWith(trackIndex, animation, loop);\r\n\t\t}\r\n\r\n\t\t/** Sets the current animation for a track, discarding any queued animations. If the formerly current track entry was never\r\n\t\t * applied to a skeleton, it is replaced (not mixed from).\r\n\t\t * @param loop If true, the animation will repeat. If false it will not, instead its last frame is applied if played beyond its\r\n\t\t *           duration. In either case {@link TrackEntry#trackEnd} determines when the track is cleared.\r\n\t\t * @returns A track entry to allow further customization of animation playback. References to the track entry must not be kept\r\n\t\t *         after the {@link AnimationStateListener#dispose()} event occurs. */\r\n\t\tsetAnimationWith (trackIndex: number, animation: Animation, loop: boolean) {\r\n\t\t\tif (animation == null) throw new Error(\"animation cannot be null.\");\r\n\t\t\tlet interrupt = true;\r\n\t\t\tlet current = this.expandToIndex(trackIndex);\r\n\t\t\tif (current != null) {\r\n\t\t\t\tif (current.nextTrackLast == -1) {\r\n\t\t\t\t\t// Don't mix from an entry that was never applied.\r\n\t\t\t\t\tthis.tracks[trackIndex] = current.mixingFrom;\r\n\t\t\t\t\tthis.queue.interrupt(current);\r\n\t\t\t\t\tthis.queue.end(current);\r\n\t\t\t\t\tthis.disposeNext(current);\r\n\t\t\t\t\tcurrent = current.mixingFrom;\r\n\t\t\t\t\tinterrupt = false;\r\n\t\t\t\t} else\r\n\t\t\t\t\tthis.disposeNext(current);\r\n\t\t\t}\r\n\t\t\tlet entry = this.trackEntry(trackIndex, animation, loop, current);\r\n\t\t\tthis.setCurrent(trackIndex, entry, interrupt);\r\n\t\t\tthis.queue.drain();\r\n\t\t\treturn entry;\r\n\t\t}\r\n\r\n\t\t/** Queues an animation by name.\r\n\t\t *\r\n\t\t * See {@link #addAnimationWith()}. */\r\n\t\taddAnimation (trackIndex: number, animationName: string, loop: boolean, delay: number) {\r\n\t\t\tlet animation = this.data.skeletonData.findAnimation(animationName);\r\n\t\t\tif (animation == null) throw new Error(\"Animation not found: \" + animationName);\r\n\t\t\treturn this.addAnimationWith(trackIndex, animation, loop, delay);\r\n\t\t}\r\n\r\n\t\t/** Adds an animation to be played after the current or last queued animation for a track. If the track is empty, it is\r\n\t\t * equivalent to calling {@link #setAnimationWith()}.\r\n\t\t * @param delay If > 0, sets {@link TrackEntry#delay}. If <= 0, the delay set is the duration of the previous track entry\r\n\t\t *           minus any mix duration (from the {@link AnimationStateData}) plus the specified `delay` (ie the mix\r\n\t\t *           ends at (`delay` = 0) or before (`delay` < 0) the previous track entry duration). If the\r\n\t\t *           previous entry is looping, its next loop completion is used instead of its duration.\r\n\t\t * @returns A track entry to allow further customization of animation playback. References to the track entry must not be kept\r\n\t\t *         after the {@link AnimationStateListener#dispose()} event occurs. */\r\n\t\taddAnimationWith (trackIndex: number, animation: Animation, loop: boolean, delay: number) {\r\n\t\t\tif (animation == null) throw new Error(\"animation cannot be null.\");\r\n\r\n\t\t\tlet last = this.expandToIndex(trackIndex);\r\n\t\t\tif (last != null) {\r\n\t\t\t\twhile (last.next != null)\r\n\t\t\t\t\tlast = last.next;\r\n\t\t\t}\r\n\r\n\t\t\tlet entry = this.trackEntry(trackIndex, animation, loop, last);\r\n\r\n\t\t\tif (last == null) {\r\n\t\t\t\tthis.setCurrent(trackIndex, entry, true);\r\n\t\t\t\tthis.queue.drain();\r\n\t\t\t} else {\r\n\t\t\t\tlast.next = entry;\r\n\t\t\t\tif (delay <= 0) {\r\n\t\t\t\t\tlet duration = last.animationEnd - last.animationStart;\r\n\t\t\t\t\tif (duration != 0) {\r\n\t\t\t\t\t\tif (last.loop)\r\n\t\t\t\t\t\t\tdelay += duration * (1 + ((last.trackTime / duration) | 0));\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tdelay += Math.max(duration, last.trackTime);\r\n\t\t\t\t\t\tdelay -= this.data.getMix(last.animation, animation);\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tdelay = last.trackTime;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tentry.delay = delay;\r\n\t\t\treturn entry;\r\n\t\t}\r\n\r\n\t\t/** Sets an empty animation for a track, discarding any queued animations, and sets the track entry's\r\n\t\t * {@link TrackEntry#mixduration}. An empty animation has no timelines and serves as a placeholder for mixing in or out.\r\n\t\t *\r\n\t\t * Mixing out is done by setting an empty animation with a mix duration using either {@link #setEmptyAnimation()},\r\n\t\t * {@link #setEmptyAnimations()}, or {@link #addEmptyAnimation()}. Mixing to an empty animation causes\r\n\t\t * the previous animation to be applied less and less over the mix duration. Properties keyed in the previous animation\r\n\t\t * transition to the value from lower tracks or to the setup pose value if no lower tracks key the property. A mix duration of\r\n\t\t * 0 still mixes out over one frame.\r\n\t\t *\r\n\t\t * Mixing in is done by first setting an empty animation, then adding an animation using\r\n\t\t * {@link #addAnimation()} and on the returned track entry, set the\r\n\t\t * {@link TrackEntry#setMixDuration()}. Mixing from an empty animation causes the new animation to be applied more and\r\n\t\t * more over the mix duration. Properties keyed in the new animation transition from the value from lower tracks or from the\r\n\t\t * setup pose value if no lower tracks key the property to the value keyed in the new animation. */\r\n\t\tsetEmptyAnimation (trackIndex: number, mixDuration: number) {\r\n\t\t\tlet entry = this.setAnimationWith(trackIndex, AnimationState.emptyAnimation, false);\r\n\t\t\tentry.mixDuration = mixDuration;\r\n\t\t\tentry.trackEnd = mixDuration;\r\n\t\t\treturn entry;\r\n\t\t}\r\n\r\n\t\t/** Adds an empty animation to be played after the current or last queued animation for a track, and sets the track entry's\r\n\t\t * {@link TrackEntry#mixDuration}. If the track is empty, it is equivalent to calling\r\n\t\t * {@link #setEmptyAnimation()}.\r\n\t\t *\r\n\t\t * See {@link #setEmptyAnimation()}.\r\n\t\t * @param delay If > 0, sets {@link TrackEntry#delay}. If <= 0, the delay set is the duration of the previous track entry\r\n\t\t *           minus any mix duration plus the specified `delay` (ie the mix ends at (`delay` = 0) or\r\n\t\t *           before (`delay` < 0) the previous track entry duration). If the previous entry is looping, its next\r\n\t\t *           loop completion is used instead of its duration.\r\n\t\t * @return A track entry to allow further customization of animation playback. References to the track entry must not be kept\r\n\t\t *         after the {@link AnimationStateListener#dispose()} event occurs. */\r\n\t\taddEmptyAnimation (trackIndex: number, mixDuration: number, delay: number) {\r\n\t\t\tif (delay <= 0) delay -= mixDuration;\r\n\t\t\tlet entry = this.addAnimationWith(trackIndex, AnimationState.emptyAnimation, false, delay);\r\n\t\t\tentry.mixDuration = mixDuration;\r\n\t\t\tentry.trackEnd = mixDuration;\r\n\t\t\treturn entry;\r\n\t\t}\r\n\r\n\t\t/** Sets an empty animation for every track, discarding any queued animations, and mixes to it over the specified mix\r\n\t \t* duration. */\r\n\t\tsetEmptyAnimations (mixDuration: number) {\r\n\t\t\tlet oldDrainDisabled = this.queue.drainDisabled;\r\n\t\t\tthis.queue.drainDisabled = true;\r\n\t\t\tfor (let i = 0, n = this.tracks.length; i < n; i++) {\r\n\t\t\t\tlet current = this.tracks[i];\r\n\t\t\t\tif (current != null) this.setEmptyAnimation(current.trackIndex, mixDuration);\r\n\t\t\t}\r\n\t\t\tthis.queue.drainDisabled = oldDrainDisabled;\r\n\t\t\tthis.queue.drain();\r\n\t\t}\r\n\r\n\t\texpandToIndex (index: number) {\r\n\t\t\tif (index < this.tracks.length) return this.tracks[index];\r\n\t\t\tUtils.ensureArrayCapacity(this.tracks, index + 1, null);\r\n\t\t\tthis.tracks.length = index + 1;\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** @param last May be null. */\r\n\t\ttrackEntry (trackIndex: number, animation: Animation, loop: boolean, last: TrackEntry) {\r\n\t\t\tlet entry = this.trackEntryPool.obtain();\r\n\t\t\tentry.trackIndex = trackIndex;\r\n\t\t\tentry.animation = animation;\r\n\t\t\tentry.loop = loop;\r\n\t\t\tentry.holdPrevious = false;\r\n\r\n\t\t\tentry.eventThreshold = 0;\r\n\t\t\tentry.attachmentThreshold = 0;\r\n\t\t\tentry.drawOrderThreshold = 0;\r\n\r\n\t\t\tentry.animationStart = 0;\r\n\t\t\tentry.animationEnd = animation.duration;\r\n\t\t\tentry.animationLast = -1;\r\n\t\t\tentry.nextAnimationLast = -1;\r\n\r\n\t\t\tentry.delay = 0;\r\n\t\t\tentry.trackTime = 0;\r\n\t\t\tentry.trackLast = -1;\r\n\t\t\tentry.nextTrackLast = -1;\r\n\t\t\tentry.trackEnd = Number.MAX_VALUE;\r\n\t\t\tentry.timeScale = 1;\r\n\r\n\t\t\tentry.alpha = 1;\r\n\t\t\tentry.interruptAlpha = 1;\r\n\t\t\tentry.mixTime = 0;\r\n\t\t\tentry.mixDuration = last == null ? 0 : this.data.getMix(last.animation, animation);\r\n\t\t\tentry.mixBlend = MixBlend.replace;\r\n\t\t\treturn entry;\r\n\t\t}\r\n\r\n\t\tdisposeNext (entry: TrackEntry) {\r\n\t\t\tlet next = entry.next;\r\n\t\t\twhile (next != null) {\r\n\t\t\t\tthis.queue.dispose(next);\r\n\t\t\t\tnext = next.next;\r\n\t\t\t}\r\n\t\t\tentry.next = null;\r\n\t\t}\r\n\r\n\t\t_animationsChanged () {\r\n\t\t\tthis.animationsChanged = false;\r\n\r\n\t\t\tthis.propertyIDs.clear();\r\n\r\n\t\t\tfor (let i = 0, n = this.tracks.length; i < n; i++) {\r\n\t\t\t\tlet entry = this.tracks[i];\r\n\t\t\t\tif (entry == null) continue;\r\n\t\t\t\twhile (entry.mixingFrom != null)\r\n\t\t\t\t\tentry = entry.mixingFrom;\r\n\r\n\t\t\t\tdo {\r\n\t\t\t\t\tif (entry.mixingFrom == null || entry.mixBlend != MixBlend.add) this.computeHold(entry);\r\n\t\t\t\t\tentry = entry.mixingTo;\r\n\t\t\t\t} while (entry != null)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcomputeHold (entry: TrackEntry) {\r\n\t\t\tlet to = entry.mixingTo;\r\n\t\t\tlet timelines = entry.animation.timelines;\r\n\t\t\tlet timelinesCount = entry.animation.timelines.length;\r\n\t\t\tlet timelineMode = Utils.setArraySize(entry.timelineMode, timelinesCount);\r\n\t\t\tentry.timelineHoldMix.length = 0;\r\n\t\t\tlet timelineDipMix = Utils.setArraySize(entry.timelineHoldMix, timelinesCount);\r\n\t\t\tlet propertyIDs = this.propertyIDs;\r\n\r\n\t\t\tif (to != null && to.holdPrevious) {\r\n\t\t\t\tfor (let i = 0; i < timelinesCount; i++) {\r\n\t\t\t\t\tpropertyIDs.add(timelines[i].getPropertyId());\r\n\t\t\t\t\ttimelineMode[i] = AnimationState.HOLD;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\touter:\r\n\t\t\tfor (let i = 0; i < timelinesCount; i++) {\r\n\t\t\t\tlet timeline = timelines[i];\r\n\t\t\t\tlet id = timeline.getPropertyId();\r\n\t\t\t\tif (!propertyIDs.add(id))\r\n\t\t\t\t\ttimelineMode[i] = AnimationState.SUBSEQUENT;\r\n\t\t\t\telse if (to == null || timeline instanceof AttachmentTimeline || timeline instanceof DrawOrderTimeline\r\n\t\t\t\t\t|| timeline instanceof EventTimeline || !to.animation.hasTimeline(id)) {\r\n\t\t\t\t\ttimelineMode[i] = AnimationState.FIRST;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (let next = to.mixingTo; next != null; next = next.mixingTo) {\r\n\t\t\t\t\t\tif (next.animation.hasTimeline(id)) continue;\r\n\t\t\t\t\t\tif (entry.mixDuration > 0) {\r\n\t\t\t\t\t\t\ttimelineMode[i] = AnimationState.HOLD_MIX;\r\n\t\t\t\t\t\t\ttimelineDipMix[i] = next;\r\n\t\t\t\t\t\t\tcontinue outer;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimelineMode[i] = AnimationState.HOLD;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Returns the track entry for the animation currently playing on the track, or null if no animation is currently playing. */\r\n\t\tgetCurrent (trackIndex: number) {\r\n\t\t\tif (trackIndex >= this.tracks.length) return null;\r\n\t\t\treturn this.tracks[trackIndex];\r\n\t\t}\r\n\r\n\t\t/** Adds a listener to receive events for all track entries. */\r\n\t\taddListener (listener: AnimationStateListener) {\r\n\t\t\tif (listener == null) throw new Error(\"listener cannot be null.\");\r\n\t\t\tthis.listeners.push(listener);\r\n\t\t}\r\n\r\n\t\t/** Removes the listener added with {@link #addListener()}. */\r\n\t\tremoveListener (listener: AnimationStateListener) {\r\n\t\t\tlet index = this.listeners.indexOf(listener);\r\n\t\t\tif (index >= 0) this.listeners.splice(index, 1);\r\n\t\t}\r\n\r\n\t\t/** Removes all listeners added with {@link #addListener()}. */\r\n\t\tclearListeners () {\r\n\t\t\tthis.listeners.length = 0;\r\n\t\t}\r\n\r\n\t\t/** Discards all listener notifications that have not yet been delivered. This can be useful to call from an\r\n\t\t * {@link AnimationStateListener} when it is known that further notifications that may have been already queued for delivery\r\n\t\t * are not wanted because new animations are being set. */\r\n\t\tclearListenerNotifications () {\r\n\t\t\tthis.queue.clear();\r\n\t\t}\r\n\t}\r\n\r\n\t/** Stores settings and other state for the playback of an animation on an {@link AnimationState} track.\r\n\t *\r\n\t * References to a track entry must not be kept after the {@link AnimationStateListener#dispose()} event occurs. */\r\n\texport class TrackEntry {\r\n\t\t/** The animation to apply for this track entry. */\r\n\t\tanimation: Animation;\r\n\r\n\t\t/** The animation queued to start after this animation, or null. `next` makes up a linked list. */\r\n\t\tnext: TrackEntry;\r\n\r\n\t\t/** The track entry for the previous animation when mixing from the previous animation to this animation, or null if no\r\n\t\t * mixing is currently occuring. When mixing from multiple animations, `mixingFrom` makes up a linked list. */\r\n\t\tmixingFrom: TrackEntry;\r\n\r\n\t\t/** The track entry for the next animation when mixing from this animation to the next animation, or null if no mixing is\r\n\t\t * currently occuring. When mixing to multiple animations, `mixingTo` makes up a linked list. */\r\n\t\tmixingTo: TrackEntry;\r\n\r\n\t\t/** The listener for events generated by this track entry, or null.\r\n\t\t *\r\n\t\t * A track entry returned from {@link AnimationState#setAnimation()} is already the current animation\r\n\t\t * for the track, so the track entry listener {@link AnimationStateListener#start()} will not be called. */\r\n\t\tlistener: AnimationStateListener;\r\n\r\n\t\t/** The index of the track where this track entry is either current or queued.\r\n\t\t *\r\n\t\t * See {@link AnimationState#getCurrent()}. */\r\n\t\ttrackIndex: number;\r\n\r\n\t\t/** If true, the animation will repeat. If false it will not, instead its last frame is applied if played beyond its\r\n\t\t * duration. */\r\n\t\tloop: boolean;\r\n\r\n\t\t/** If true, when mixing from the previous animation to this animation, the previous animation is applied as normal instead\r\n\t\t * of being mixed out.\r\n\t\t *\r\n\t\t * When mixing between animations that key the same property, if a lower track also keys that property then the value will\r\n\t\t * briefly dip toward the lower track value during the mix. This happens because the first animation mixes from 100% to 0%\r\n\t\t * while the second animation mixes from 0% to 100%. Setting `holdPrevious` to true applies the first animation\r\n\t\t * at 100% during the mix so the lower track value is overwritten. Such dipping does not occur on the lowest track which\r\n\t\t * keys the property, only when a higher track also keys the property.\r\n\t\t *\r\n\t\t * Snapping will occur if `holdPrevious` is true and this animation does not key all the same properties as the\r\n\t\t * previous animation. */\r\n\t\tholdPrevious: boolean;\r\n\r\n\t\t/** When the mix percentage ({@link #mixTime} / {@link #mixDuration}) is less than the\r\n\t\t * `eventThreshold`, event timelines are applied while this animation is being mixed out. Defaults to 0, so event\r\n\t\t * timelines are not applied while this animation is being mixed out. */\r\n\t\teventThreshold: number;\r\n\r\n\t\t/** When the mix percentage ({@link #mixtime} / {@link #mixDuration}) is less than the\r\n\t\t * `attachmentThreshold`, attachment timelines are applied while this animation is being mixed out. Defaults to\r\n\t\t * 0, so attachment timelines are not applied while this animation is being mixed out. */\r\n\t\tattachmentThreshold: number;\r\n\r\n\t\t/** When the mix percentage ({@link #mixTime} / {@link #mixDuration}) is less than the\r\n\t\t * `drawOrderThreshold`, draw order timelines are applied while this animation is being mixed out. Defaults to 0,\r\n\t\t * so draw order timelines are not applied while this animation is being mixed out. */\r\n\t\tdrawOrderThreshold: number;\r\n\r\n\t\t/** Seconds when this animation starts, both initially and after looping. Defaults to 0.\r\n\t\t *\r\n\t\t * When changing the `animationStart` time, it often makes sense to set {@link #animationLast} to the same\r\n\t\t * value to prevent timeline keys before the start time from triggering. */\r\n\t\tanimationStart: number;\r\n\r\n\t\t/** Seconds for the last frame of this animation. Non-looping animations won't play past this time. Looping animations will\r\n\t\t * loop back to {@link #animationStart} at this time. Defaults to the animation {@link Animation#duration}. */\r\n\t\tanimationEnd: number;\r\n\r\n\r\n\t\t/** The time in seconds this animation was last applied. Some timelines use this for one-time triggers. Eg, when this\r\n\t\t * animation is applied, event timelines will fire all events between the `animationLast` time (exclusive) and\r\n\t\t * `animationTime` (inclusive). Defaults to -1 to ensure triggers on frame 0 happen the first time this animation\r\n\t\t * is applied. */\r\n\t\tanimationLast: number;\r\n\r\n\t\tnextAnimationLast: number;\r\n\r\n\t\t/** Seconds to postpone playing the animation. When this track entry is the current track entry, `delay`\r\n\t\t * postpones incrementing the {@link #trackTime}. When this track entry is queued, `delay` is the time from\r\n\t\t * the start of the previous animation to when this track entry will become the current track entry (ie when the previous\r\n\t\t * track entry {@link TrackEntry#trackTime} >= this track entry's `delay`).\r\n\t\t *\r\n\t\t * {@link #timeScale} affects the delay. */\r\n\t\tdelay: number;\r\n\r\n\t\t/** Current time in seconds this track entry has been the current track entry. The track time determines\r\n\t\t * {@link #animationTime}. The track time can be set to start the animation at a time other than 0, without affecting\r\n\t\t * looping. */\r\n\t\ttrackTime: number;\r\n\r\n\t\ttrackLast: number; nextTrackLast: number;\r\n\r\n\t\t/** The track time in seconds when this animation will be removed from the track. Defaults to the highest possible float\r\n\t\t * value, meaning the animation will be applied until a new animation is set or the track is cleared. If the track end time\r\n\t\t * is reached, no other animations are queued for playback, and mixing from any previous animations is complete, then the\r\n\t\t * properties keyed by the animation are set to the setup pose and the track is cleared.\r\n\t\t *\r\n\t\t * It may be desired to use {@link AnimationState#addEmptyAnimation()} rather than have the animation\r\n\t\t * abruptly cease being applied. */\r\n\t\ttrackEnd: number;\r\n\r\n\t\t/** Multiplier for the delta time when this track entry is updated, causing time for this animation to pass slower or\r\n\t\t * faster. Defaults to 1.\r\n\t\t *\r\n\t\t * {@link #mixTime} is not affected by track entry time scale, so {@link #mixDuration} may need to be adjusted to\r\n\t\t * match the animation speed.\r\n\t\t *\r\n\t\t * When using {@link AnimationState#addAnimation()} with a `delay` <= 0, note the\r\n\t\t * {@link #delay} is set using the mix duration from the {@link AnimationStateData}, assuming time scale to be 1. If\r\n\t\t * the time scale is not 1, the delay may need to be adjusted.\r\n\t\t *\r\n\t\t * See AnimationState {@link AnimationState#timeScale} for affecting all animations. */\r\n\t\ttimeScale: number;\r\n\r\n\t\t/** Values < 1 mix this animation with the skeleton's current pose (usually the pose resulting from lower tracks). Defaults\r\n\t\t * to 1, which overwrites the skeleton's current pose with this animation.\r\n\t\t *\r\n\t\t * Typically track 0 is used to completely pose the skeleton, then alpha is used on higher tracks. It doesn't make sense to\r\n\t\t * use alpha on track 0 if the skeleton pose is from the last frame render. */\r\n\t\talpha: number;\r\n\r\n\t\t/** Seconds from 0 to the {@link #getMixDuration()} when mixing from the previous animation to this animation. May be\r\n\t\t * slightly more than `mixDuration` when the mix is complete. */\r\n\t\tmixTime: number;\r\n\r\n\t\t/** Seconds for mixing from the previous animation to this animation. Defaults to the value provided by AnimationStateData\r\n\t\t * {@link AnimationStateData#getMix()} based on the animation before this animation (if any).\r\n\t\t *\r\n\t\t * A mix duration of 0 still mixes out over one frame to provide the track entry being mixed out a chance to revert the\r\n\t\t * properties it was animating.\r\n\t\t *\r\n\t\t * The `mixDuration` can be set manually rather than use the value from\r\n\t\t * {@link AnimationStateData#getMix()}. In that case, the `mixDuration` can be set for a new\r\n\t\t * track entry only before {@link AnimationState#update(float)} is first called.\r\n\t\t *\r\n\t\t * When using {@link AnimationState#addAnimation()} with a `delay` <= 0, note the\r\n\t\t * {@link #delay} is set using the mix duration from the {@link AnimationStateData}, not a mix duration set\r\n\t\t * afterward. */\r\n\t\tmixDuration: number; interruptAlpha: number; totalAlpha: number;\r\n\r\n\t\t/** Controls how properties keyed in the animation are mixed with lower tracks. Defaults to {@link MixBlend#replace}, which\r\n\t\t * replaces the values from the lower tracks with the animation values. {@link MixBlend#add} adds the animation values to\r\n\t\t * the values from the lower tracks.\r\n\t\t *\r\n\t\t * The `mixBlend` can be set for a new track entry only before {@link AnimationState#apply()} is first\r\n\t\t * called. */\r\n\t\tmixBlend = MixBlend.replace;\r\n\t\ttimelineMode = new Array<number>();\r\n\t\ttimelineHoldMix = new Array<TrackEntry>();\r\n\t\ttimelinesRotation = new Array<number>();\r\n\r\n\t\treset () {\r\n\t\t\tthis.next = null;\r\n\t\t\tthis.mixingFrom = null;\r\n\t\t\tthis.mixingTo = null;\r\n\t\t\tthis.animation = null;\r\n\t\t\tthis.listener = null;\r\n\t\t\tthis.timelineMode.length = 0;\r\n\t\t\tthis.timelineHoldMix.length = 0;\r\n\t\t\tthis.timelinesRotation.length = 0;\r\n\t\t}\r\n\r\n\t\t/** Uses {@link #trackTime} to compute the `animationTime`, which is between {@link #animationStart}\r\n\t\t * and {@link #animationEnd}. When the `trackTime` is 0, the `animationTime` is equal to the\r\n\t\t * `animationStart` time. */\r\n\t\tgetAnimationTime () {\r\n\t\t\tif (this.loop) {\r\n\t\t\t\tlet duration = this.animationEnd - this.animationStart;\r\n\t\t\t\tif (duration == 0) return this.animationStart;\r\n\t\t\t\treturn (this.trackTime % duration) + this.animationStart;\r\n\t\t\t}\r\n\t\t\treturn Math.min(this.trackTime + this.animationStart, this.animationEnd);\r\n\t\t}\r\n\r\n\t\tsetAnimationLast(animationLast: number) {\r\n\t\t\tthis.animationLast = animationLast;\r\n\t\t\tthis.nextAnimationLast = animationLast;\r\n\t\t}\r\n\r\n\t\t/** Returns true if at least one loop has been completed.\r\n\t\t *\r\n\t\t * See {@link AnimationStateListener#complete()}. */\r\n\t\tisComplete () {\r\n\t\t\treturn this.trackTime >= this.animationEnd - this.animationStart;\r\n\t\t}\r\n\r\n\t\t/** Resets the rotation directions for mixing this entry's rotate timelines. This can be useful to avoid bones rotating the\r\n\t\t * long way around when using {@link #alpha} and starting animations on other tracks.\r\n\t\t *\r\n\t\t * Mixing with {@link MixBlend#replace} involves finding a rotation between two others, which has two possible solutions:\r\n\t\t * the short way or the long way around. The two rotations likely change over time, so which direction is the short or long\r\n\t\t * way also changes. If the short way was always chosen, bones would flip to the other side when that direction became the\r\n\t\t * long way. TrackEntry chooses the short way the first time it is applied and remembers that direction. */\r\n\t\tresetRotationDirections () {\r\n\t\t\tthis.timelinesRotation.length = 0;\r\n\t\t}\r\n\t}\r\n\r\n\texport class EventQueue {\r\n\t\tobjects: Array<any> = [];\r\n\t\tdrainDisabled = false;\r\n\t\tanimState: AnimationState;\r\n\r\n\t\tconstructor(animState: AnimationState) {\r\n\t\t\tthis.animState = animState;\r\n\t\t}\r\n\r\n\t\tstart (entry: TrackEntry) {\r\n\t\t\tthis.objects.push(EventType.start);\r\n\t\t\tthis.objects.push(entry);\r\n\t\t\tthis.animState.animationsChanged = true;\r\n\t\t}\r\n\r\n\t\tinterrupt (entry: TrackEntry) {\r\n\t\t\tthis.objects.push(EventType.interrupt);\r\n\t\t\tthis.objects.push(entry);\r\n\t\t}\r\n\r\n\t\tend (entry: TrackEntry) {\r\n\t\t\tthis.objects.push(EventType.end);\r\n\t\t\tthis.objects.push(entry);\r\n\t\t\tthis.animState.animationsChanged = true;\r\n\t\t}\r\n\r\n\t\tdispose (entry: TrackEntry) {\r\n\t\t\tthis.objects.push(EventType.dispose);\r\n\t\t\tthis.objects.push(entry);\r\n\t\t}\r\n\r\n\t\tcomplete (entry: TrackEntry) {\r\n\t\t\tthis.objects.push(EventType.complete);\r\n\t\t\tthis.objects.push(entry);\r\n\t\t}\r\n\r\n\t\tevent (entry: TrackEntry, event: Event) {\r\n\t\t\tthis.objects.push(EventType.event);\r\n\t\t\tthis.objects.push(entry);\r\n\t\t\tthis.objects.push(event);\r\n\t\t}\r\n\r\n\t\tdrain () {\r\n\t\t\tif (this.drainDisabled) return;\r\n\t\t\tthis.drainDisabled = true;\r\n\r\n\t\t\tlet objects = this.objects;\r\n\t\t\tlet listeners = this.animState.listeners;\r\n\r\n\t\t\tfor (let i = 0; i < objects.length; i += 2) {\r\n\t\t\t\tlet type = objects[i] as EventType;\r\n\t\t\t\tlet entry = objects[i + 1] as TrackEntry;\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\tcase EventType.start:\r\n\t\t\t\t\tif (entry.listener != null && entry.listener.start) entry.listener.start(entry);\r\n\t\t\t\t\tfor (let ii = 0; ii < listeners.length; ii++)\r\n\t\t\t\t\t\tif (listeners[ii].start) listeners[ii].start(entry);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase EventType.interrupt:\r\n\t\t\t\t\tif (entry.listener != null && entry.listener.interrupt) entry.listener.interrupt(entry);\r\n\t\t\t\t\tfor (let ii = 0; ii < listeners.length; ii++)\r\n\t\t\t\t\t\tif (listeners[ii].interrupt) listeners[ii].interrupt(entry);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase EventType.end:\r\n\t\t\t\t\tif (entry.listener != null && entry.listener.end) entry.listener.end(entry);\r\n\t\t\t\t\tfor (let ii = 0; ii < listeners.length; ii++)\r\n\t\t\t\t\t\tif (listeners[ii].end) listeners[ii].end(entry);\r\n\t\t\t\t\t// Fall through.\r\n\t\t\t\tcase EventType.dispose:\r\n\t\t\t\t\tif (entry.listener != null && entry.listener.dispose) entry.listener.dispose(entry);\r\n\t\t\t\t\tfor (let ii = 0; ii < listeners.length; ii++)\r\n\t\t\t\t\t\tif (listeners[ii].dispose) listeners[ii].dispose(entry);\r\n\t\t\t\t\tthis.animState.trackEntryPool.free(entry);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase EventType.complete:\r\n\t\t\t\t\tif (entry.listener != null && entry.listener.complete) entry.listener.complete(entry);\r\n\t\t\t\t\tfor (let ii = 0; ii < listeners.length; ii++)\r\n\t\t\t\t\t\tif (listeners[ii].complete) listeners[ii].complete(entry);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase EventType.event:\r\n\t\t\t\t\tlet event = objects[i++ + 2] as Event;\r\n\t\t\t\t\tif (entry.listener != null && entry.listener.event) entry.listener.event(entry, event);\r\n\t\t\t\t\tfor (let ii = 0; ii < listeners.length; ii++)\r\n\t\t\t\t\t\tif (listeners[ii].event) listeners[ii].event(entry, event);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.clear();\r\n\r\n\t\t\tthis.drainDisabled = false;\r\n\t\t}\r\n\r\n\t\tclear () {\r\n\t\t\tthis.objects.length = 0;\r\n\t\t}\r\n\t}\r\n\r\n\texport enum EventType {\r\n\t\tstart, interrupt, end, dispose, complete, event\r\n\t}\r\n\r\n\t/** The interface to implement for receiving TrackEntry events. It is always safe to call AnimationState methods when receiving\r\n\t * events.\r\n\t *\r\n\t * See TrackEntry {@link TrackEntry#listener} and AnimationState\r\n\t * {@link AnimationState#addListener()}. */\r\n\texport interface AnimationStateListener {\r\n\t\t/** Invoked when this entry has been set as the current entry. */\r\n\t\tstart (entry: TrackEntry): void;\r\n\r\n\t\t/** Invoked when another entry has replaced this entry as the current entry. This entry may continue being applied for\r\n\t\t * mixing. */\r\n\t\tinterrupt (entry: TrackEntry): void;\r\n\r\n\t\t/** Invoked when this entry is no longer the current entry and will never be applied again. */\r\n\t\tend (entry: TrackEntry): void;\r\n\r\n\t\t/** Invoked when this entry will be disposed. This may occur without the entry ever being set as the current entry.\r\n\t\t * References to the entry should not be kept after dispose is called, as it may be destroyed or reused. */\r\n\t\tdispose (entry: TrackEntry): void;\r\n\r\n\t\t/** Invoked every time this entry's animation completes a loop. */\r\n\t\tcomplete (entry: TrackEntry): void;\r\n\r\n\t\t/** Invoked when this entry's animation triggers an event. */\r\n\t\tevent (entry: TrackEntry, event: Event): void;\r\n\t}\r\n\r\n\texport abstract class AnimationStateAdapter implements AnimationStateListener {\r\n\t\tstart (entry: TrackEntry) {\r\n\t\t}\r\n\r\n\t\tinterrupt (entry: TrackEntry) {\r\n\t\t}\r\n\r\n\t\tend (entry: TrackEntry) {\r\n\t\t}\r\n\r\n\t\tdispose (entry: TrackEntry) {\r\n\t\t}\r\n\r\n\t\tcomplete (entry: TrackEntry) {\r\n\t\t}\r\n\r\n\t\tevent (entry: TrackEntry, event: Event) {\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { GLTexture } from \"./GLTexture\";\r\nimport { Mesh, Position2Attribute, ColorAttribute, TexCoordAttribute, Color2Attribute } from \"./Mesh\";\r\nimport { Shader } from \"./Shader\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\nimport { Disposable } from \"../core/Utils\";\r\n\r\n// module spine.webgl {\r\n\texport class PolygonBatcher implements Disposable {\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate drawCalls: number;\r\n\t\tprivate isDrawing = false;\r\n\t\tprivate mesh: Mesh;\r\n\t\tprivate shader: Shader = null;\r\n\t\tprivate lastTexture: GLTexture = null;\r\n\t\tprivate verticesLength = 0;\r\n\t\tprivate indicesLength = 0;\r\n\t\tprivate srcBlend: number;\r\n\t\tprivate dstBlend: number;\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext | WebGLRenderingContext, twoColorTint: boolean = true, maxVertices: number = 10920) {\r\n\t\t\tif (maxVertices > 10920) throw new Error(\"Can't have more than 10920 triangles per batch: \" + maxVertices);\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t\tlet attributes = twoColorTint ?\r\n\t\t\t\t\t[new Position2Attribute(), new ColorAttribute(), new TexCoordAttribute(), new Color2Attribute()] :\r\n\t\t\t\t\t[new Position2Attribute(), new ColorAttribute(), new TexCoordAttribute()];\r\n\t\t\tthis.mesh = new Mesh(context, attributes, maxVertices, maxVertices * 3);\r\n\t\t\tthis.srcBlend = this.context.gl.SRC_ALPHA;\r\n\t\t\tthis.dstBlend = this.context.gl.ONE_MINUS_SRC_ALPHA;\r\n\t\t}\r\n\r\n\t\tbegin (shader: Shader) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (this.isDrawing) throw new Error(\"PolygonBatch is already drawing. Call PolygonBatch.end() before calling PolygonBatch.begin()\");\r\n\t\t\tthis.drawCalls = 0;\r\n\t\t\tthis.shader = shader;\r\n\t\t\tthis.lastTexture = null;\r\n\t\t\tthis.isDrawing = true;\r\n\r\n\t\t\tgl.enable(gl.BLEND);\r\n\t\t\tgl.blendFunc(this.srcBlend, this.dstBlend);\r\n\t\t}\r\n\r\n\t\tsetBlendMode (srcBlend: number, dstBlend: number) {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tthis.srcBlend = srcBlend;\r\n\t\t\tthis.dstBlend = dstBlend;\r\n\t\t\tif (this.isDrawing) {\r\n\t\t\t\tthis.flush();\r\n\t\t\t\tgl.blendFunc(this.srcBlend, this.dstBlend);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdraw (texture: GLTexture, vertices: ArrayLike<number>, indices: Array<number>) {\r\n\t\t\tif (texture != this.lastTexture) {\r\n\t\t\t\tthis.flush();\r\n\t\t\t\tthis.lastTexture = texture;\r\n\t\t\t} else if (this.verticesLength + vertices.length > this.mesh.getVertices().length ||\r\n\t\t\t\t\tthis.indicesLength + indices.length > this.mesh.getIndices().length) {\r\n\t\t\t\tthis.flush();\r\n\t\t\t}\r\n\r\n\t\t\tlet indexStart = this.mesh.numVertices();\r\n\t\t\tthis.mesh.getVertices().set(vertices, this.verticesLength);\r\n\t\t\tthis.verticesLength += vertices.length;\r\n\t\t\tthis.mesh.setVerticesLength(this.verticesLength)\r\n\r\n\t\t\tlet indicesArray = this.mesh.getIndices();\r\n\t\t\tfor (let i = this.indicesLength, j = 0; j < indices.length; i++, j++)\r\n\t\t\t\tindicesArray[i] = indices[j] + indexStart;\r\n\t\t\tthis.indicesLength += indices.length;\r\n\t\t\tthis.mesh.setIndicesLength(this.indicesLength);\r\n\t\t}\r\n\r\n\t\tprivate flush () {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (this.verticesLength == 0) return;\r\n\r\n\t\t\tthis.lastTexture.bind();\r\n\t\t\tthis.mesh.draw(this.shader, gl.TRIANGLES);\r\n\r\n\t\t\tthis.verticesLength = 0;\r\n\t\t\tthis.indicesLength = 0;\r\n\t\t\tthis.mesh.setVerticesLength(0);\r\n\t\t\tthis.mesh.setIndicesLength(0);\r\n\t\t\tthis.drawCalls++;\r\n\t\t}\r\n\r\n\t\tend () {\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tif (!this.isDrawing) throw new Error(\"PolygonBatch is not drawing. Call PolygonBatch.begin() before calling PolygonBatch.end()\");\r\n\t\t\tif (this.verticesLength > 0 || this.indicesLength > 0) this.flush();\r\n\t\t\tthis.shader = null;\r\n\t\t\tthis.lastTexture = null;\r\n\t\t\tthis.isDrawing = false;\r\n\r\n\t\t\tgl.disable(gl.BLEND);\r\n\t\t}\r\n\r\n\t\tgetDrawCalls () { return this.drawCalls; }\r\n\r\n\t\tdispose () {\r\n\t\t\tthis.mesh.dispose();\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { BoundingBoxAttachment } from \"./attachments/BoundingBoxAttachment\";\r\nimport { Skeleton } from \"./Skeleton\";\r\nimport { Pool, Utils } from \"./Utils\";\r\n\r\n// module spine {\r\n\t/** Collects each visible {@link BoundingBoxAttachment} and computes the world vertices for its polygon. The polygon vertices are\r\n\t * provided along with convenience methods for doing hit detection. */\r\n\texport class SkeletonBounds {\r\n\r\n\t\t/** The left edge of the axis aligned bounding box. */\r\n\t\tminX = 0;\r\n\r\n\t\t/** The bottom edge of the axis aligned bounding box. */\r\n\t\tminY = 0;\r\n\r\n\t\t/** The right edge of the axis aligned bounding box. */\r\n\t\tmaxX = 0;\r\n\r\n\t\t/** The top edge of the axis aligned bounding box. */\r\n\t\tmaxY = 0;\r\n\r\n\t\t/** The visible bounding boxes. */\r\n\t\tboundingBoxes = new Array<BoundingBoxAttachment>();\r\n\r\n\t\t/** The world vertices for the bounding box polygons. */\r\n\t\tpolygons = new Array<ArrayLike<number>>();\r\n\r\n\t\tprivate polygonPool = new Pool<ArrayLike<number>>(() => {\r\n\t\t\treturn Utils.newFloatArray(16);\r\n\t\t});\r\n\r\n\t\t/** Clears any previous polygons, finds all visible bounding box attachments, and computes the world vertices for each bounding\r\n\t\t * box's polygon.\r\n\t\t * @param updateAabb If true, the axis aligned bounding box containing all the polygons is computed. If false, the\r\n\t\t *           SkeletonBounds AABB methods will always return true. */\r\n\t\tupdate (skeleton: Skeleton, updateAabb: boolean) {\r\n\t\t\tif (skeleton == null) throw new Error(\"skeleton cannot be null.\");\r\n\t\t\tlet boundingBoxes = this.boundingBoxes;\r\n\t\t\tlet polygons = this.polygons;\r\n\t\t\tlet polygonPool = this.polygonPool;\r\n\t\t\tlet slots = skeleton.slots;\r\n\t\t\tlet slotCount = slots.length;\r\n\r\n\t\t\tboundingBoxes.length = 0;\r\n\t\t\tpolygonPool.freeAll(polygons);\r\n\t\t\tpolygons.length = 0;\r\n\r\n\t\t\tfor (let i = 0; i < slotCount; i++) {\r\n\t\t\t\tlet slot = slots[i];\r\n\t\t\t\tif (!slot.bone.active) continue;\r\n\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\tif (attachment instanceof BoundingBoxAttachment) {\r\n\t\t\t\t\tlet boundingBox = attachment as BoundingBoxAttachment;\r\n\t\t\t\t\tboundingBoxes.push(boundingBox);\r\n\r\n\t\t\t\t\tlet polygon = polygonPool.obtain();\r\n\t\t\t\t\tif (polygon.length != boundingBox.worldVerticesLength) {\r\n\t\t\t\t\t\tpolygon = Utils.newFloatArray(boundingBox.worldVerticesLength);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpolygons.push(polygon);\r\n\t\t\t\t\tboundingBox.computeWorldVertices(slot, 0, boundingBox.worldVerticesLength, polygon, 0, 2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (updateAabb) {\r\n\t\t\t\tthis.aabbCompute();\r\n\t\t\t} else {\r\n\t\t\t\tthis.minX = Number.POSITIVE_INFINITY;\r\n\t\t\t\tthis.minY = Number.POSITIVE_INFINITY;\r\n\t\t\t\tthis.maxX = Number.NEGATIVE_INFINITY;\r\n\t\t\t\tthis.maxY = Number.NEGATIVE_INFINITY;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\taabbCompute () {\r\n\t\t\tlet minX = Number.POSITIVE_INFINITY, minY = Number.POSITIVE_INFINITY, maxX = Number.NEGATIVE_INFINITY, maxY = Number.NEGATIVE_INFINITY;\r\n\t\t\tlet polygons = this.polygons;\r\n\t\t\tfor (let i = 0, n = polygons.length; i < n; i++) {\r\n\t\t\t\tlet polygon = polygons[i];\r\n\t\t\t\tlet vertices = polygon;\r\n\t\t\t\tfor (let ii = 0, nn = polygon.length; ii < nn; ii += 2) {\r\n\t\t\t\t\tlet x = vertices[ii];\r\n\t\t\t\t\tlet y = vertices[ii + 1];\r\n\t\t\t\t\tminX = Math.min(minX, x);\r\n\t\t\t\t\tminY = Math.min(minY, y);\r\n\t\t\t\t\tmaxX = Math.max(maxX, x);\r\n\t\t\t\t\tmaxY = Math.max(maxY, y);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.minX = minX;\r\n\t\t\tthis.minY = minY;\r\n\t\t\tthis.maxX = maxX;\r\n\t\t\tthis.maxY = maxY;\r\n\t\t}\r\n\r\n\t\t/** Returns true if the axis aligned bounding box contains the point. */\r\n\t\taabbContainsPoint (x: number, y: number) {\r\n\t\t\treturn x >= this.minX && x <= this.maxX && y >= this.minY && y <= this.maxY;\r\n\t\t}\r\n\r\n\t\t/** Returns true if the axis aligned bounding box intersects the line segment. */\r\n\t\taabbIntersectsSegment (x1: number, y1: number, x2: number, y2: number) {\r\n\t\t\tlet minX = this.minX;\r\n\t\t\tlet minY = this.minY;\r\n\t\t\tlet maxX = this.maxX;\r\n\t\t\tlet maxY = this.maxY;\r\n\t\t\tif ((x1 <= minX && x2 <= minX) || (y1 <= minY && y2 <= minY) || (x1 >= maxX && x2 >= maxX) || (y1 >= maxY && y2 >= maxY))\r\n\t\t\t\treturn false;\r\n\t\t\tlet m = (y2 - y1) / (x2 - x1);\r\n\t\t\tlet y = m * (minX - x1) + y1;\r\n\t\t\tif (y > minY && y < maxY) return true;\r\n\t\t\ty = m * (maxX - x1) + y1;\r\n\t\t\tif (y > minY && y < maxY) return true;\r\n\t\t\tlet x = (minY - y1) / m + x1;\r\n\t\t\tif (x > minX && x < maxX) return true;\r\n\t\t\tx = (maxY - y1) / m + x1;\r\n\t\t\tif (x > minX && x < maxX) return true;\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t/** Returns true if the axis aligned bounding box intersects the axis aligned bounding box of the specified bounds. */\r\n\t\taabbIntersectsSkeleton (bounds: SkeletonBounds) {\r\n\t\t\treturn this.minX < bounds.maxX && this.maxX > bounds.minX && this.minY < bounds.maxY && this.maxY > bounds.minY;\r\n\t\t}\r\n\r\n\t\t/** Returns the first bounding box attachment that contains the point, or null. When doing many checks, it is usually more\r\n\t\t * efficient to only call this method if {@link #aabbContainsPoint(float, float)} returns true. */\r\n\t\tcontainsPoint (x: number, y: number): BoundingBoxAttachment {\r\n\t\t\tlet polygons = this.polygons;\r\n\t\t\tfor (let i = 0, n = polygons.length; i < n; i++)\r\n\t\t\t\tif (this.containsPointPolygon(polygons[i], x, y)) return this.boundingBoxes[i];\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Returns true if the polygon contains the point. */\r\n\t\tcontainsPointPolygon (polygon: ArrayLike<number>, x: number, y: number) {\r\n\t\t\tlet vertices = polygon;\r\n\t\t\tlet nn = polygon.length;\r\n\r\n\t\t\tlet prevIndex = nn - 2;\r\n\t\t\tlet inside = false;\r\n\t\t\tfor (let ii = 0; ii < nn; ii += 2) {\r\n\t\t\t\tlet vertexY = vertices[ii + 1];\r\n\t\t\t\tlet prevY = vertices[prevIndex + 1];\r\n\t\t\t\tif ((vertexY < y && prevY >= y) || (prevY < y && vertexY >= y)) {\r\n\t\t\t\t\tlet vertexX = vertices[ii];\r\n\t\t\t\t\tif (vertexX + (y - vertexY) / (prevY - vertexY) * (vertices[prevIndex] - vertexX) < x) inside = !inside;\r\n\t\t\t\t}\r\n\t\t\t\tprevIndex = ii;\r\n\t\t\t}\r\n\t\t\treturn inside;\r\n\t\t}\r\n\r\n\t\t/** Returns the first bounding box attachment that contains any part of the line segment, or null. When doing many checks, it\r\n\t\t * is usually more efficient to only call this method if {@link #aabbIntersectsSegment()} returns\r\n\t\t * true. */\r\n\t\tintersectsSegment (x1: number, y1: number, x2: number, y2: number) {\r\n\t\t\tlet polygons = this.polygons;\r\n\t\t\tfor (let i = 0, n = polygons.length; i < n; i++)\r\n\t\t\t\tif (this.intersectsSegmentPolygon(polygons[i], x1, y1, x2, y2)) return this.boundingBoxes[i];\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t/** Returns true if the polygon contains any part of the line segment. */\r\n\t\tintersectsSegmentPolygon (polygon: ArrayLike<number>, x1: number, y1: number, x2: number, y2: number) {\r\n\t\t\tlet vertices = polygon;\r\n\t\t\tlet nn = polygon.length;\r\n\r\n\t\t\tlet width12 = x1 - x2, height12 = y1 - y2;\r\n\t\t\tlet det1 = x1 * y2 - y1 * x2;\r\n\t\t\tlet x3 = vertices[nn - 2], y3 = vertices[nn - 1];\r\n\t\t\tfor (let ii = 0; ii < nn; ii += 2) {\r\n\t\t\t\tlet x4 = vertices[ii], y4 = vertices[ii + 1];\r\n\t\t\t\tlet det2 = x3 * y4 - y3 * x4;\r\n\t\t\t\tlet width34 = x3 - x4, height34 = y3 - y4;\r\n\t\t\t\tlet det3 = width12 * height34 - height12 * width34;\r\n\t\t\t\tlet x = (det1 * width34 - width12 * det2) / det3;\r\n\t\t\t\tif (((x >= x3 && x <= x4) || (x >= x4 && x <= x3)) && ((x >= x1 && x <= x2) || (x >= x2 && x <= x1))) {\r\n\t\t\t\t\tlet y = (det1 * height34 - height12 * det2) / det3;\r\n\t\t\t\t\tif (((y >= y3 && y <= y4) || (y >= y4 && y <= y3)) && ((y >= y1 && y <= y2) || (y >= y2 && y <= y1))) return true;\r\n\t\t\t\t}\r\n\t\t\t\tx3 = x4;\r\n\t\t\t\ty3 = y4;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t/** Returns the polygon for the specified bounding box, or null. */\r\n\t\tgetPolygon (boundingBox: BoundingBoxAttachment) {\r\n\t\t\tif (boundingBox == null) throw new Error(\"boundingBox cannot be null.\");\r\n\t\t\tlet index = this.boundingBoxes.indexOf(boundingBox);\r\n\t\t\treturn index == -1 ? null : this.polygons[index];\r\n\t\t}\r\n\r\n\t\t/** The width of the axis aligned bounding box. */\r\n\t\tgetWidth () {\r\n\t\t\treturn this.maxX - this.minX;\r\n\t\t}\r\n\r\n\t\t/** The height of the axis aligned bounding box. */\r\n\t\tgetHeight () {\r\n\t\t\treturn this.maxY - this.minY;\r\n\t\t}\r\n\t}\r\n\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { ClippingAttachment } from \"../core/attachments/ClippingAttachment\";\r\nimport { MeshAttachment } from \"../core/attachments/MeshAttachment\";\r\nimport { PathAttachment } from \"../core/attachments/PathAttachment\";\r\nimport { RegionAttachment } from \"../core/attachments/RegionAttachment\";\r\nimport { Skeleton } from \"../core/Skeleton\";\r\nimport { SkeletonBounds } from \"../core/SkeletonBounds\";\r\nimport { Color, Utils, Disposable } from \"../core/Utils\";\r\nimport { ShapeRenderer } from \"./ShapeRenderer\";\r\nimport { ManagedWebGLRenderingContext } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\texport class SkeletonDebugRenderer implements Disposable {\r\n\t\tboneLineColor = new Color(1, 0, 0, 1);\r\n\t\tboneOriginColor = new Color(0, 1, 0, 1);\r\n\t\tattachmentLineColor = new Color(0, 0, 1, 0.5);\r\n\t\ttriangleLineColor = new Color(1, 0.64, 0, 0.5);\r\n\t\tpathColor = new Color().setFromString(\"FF7F00\");\r\n\t\tclipColor = new Color(0.8, 0, 0, 2);\r\n\t\taabbColor = new Color(0, 1, 0, 0.5);\r\n\t\tdrawBones = true;\r\n\t\tdrawRegionAttachments = true;\r\n\t\tdrawBoundingBoxes = true;\r\n\t\tdrawMeshHull = true;\r\n\t\tdrawMeshTriangles = true;\r\n\t\tdrawPaths = true;\r\n\t\tdrawSkeletonXY = false;\r\n\t\tdrawClipping = true;\r\n\t\tpremultipliedAlpha = false;\r\n\t\tscale = 1;\r\n\t\tboneWidth = 2;\r\n\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate bounds = new SkeletonBounds();\r\n\t\tprivate temp = new Array<number>();\r\n\t\tprivate vertices = Utils.newFloatArray(2 * 1024);\r\n\t\tprivate static LIGHT_GRAY = new Color(192 / 255, 192 / 255, 192 / 255, 1);\r\n\t\tprivate static GREEN = new Color(0, 1, 0, 1);\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext | WebGLRenderingContext) {\r\n\t\t\tthis.context = context instanceof ManagedWebGLRenderingContext? context : new ManagedWebGLRenderingContext(context);\r\n\t\t}\r\n\r\n\t\tdraw (shapes: ShapeRenderer, skeleton: Skeleton, ignoredBones: Array<string> = null) {\r\n\t\t\tlet skeletonX = skeleton.x;\r\n\t\t\tlet skeletonY = skeleton.y;\r\n\t\t\tlet gl = this.context.gl;\r\n\t\t\tlet srcFunc = this.premultipliedAlpha ? gl.ONE : gl.SRC_ALPHA;\r\n\t\t\tshapes.setBlendMode(srcFunc, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n\t\t\tlet bones = skeleton.bones;\r\n\t\t\tif (this.drawBones) {\r\n\t\t\t\tshapes.setColor(this.boneLineColor);\r\n\t\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\t\tlet bone = bones[i];\r\n\t\t\t\t\tif (ignoredBones && ignoredBones.indexOf(bone.data.name) > -1) continue;\r\n\t\t\t\t\tif (bone.parent == null) continue;\r\n\t\t\t\t\tlet x = skeletonX + bone.data.length * bone.a + bone.worldX;\r\n\t\t\t\t\tlet y = skeletonY + bone.data.length * bone.c + bone.worldY;\r\n\t\t\t\t\tshapes.rectLine(true, skeletonX + bone.worldX, skeletonY + bone.worldY, x, y, this.boneWidth * this.scale);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.drawSkeletonXY) shapes.x(skeletonX, skeletonY, 4 * this.scale);\r\n\t\t\t}\r\n\r\n\t\t\tif (this.drawRegionAttachments) {\r\n\t\t\t\tshapes.setColor(this.attachmentLineColor);\r\n\t\t\t\tlet slots = skeleton.slots;\r\n\t\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\t\tlet slot = slots[i];\r\n\t\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\t\tif (attachment instanceof RegionAttachment) {\r\n\t\t\t\t\t\tlet regionAttachment = <RegionAttachment>attachment;\r\n\t\t\t\t\t\tlet vertices = this.vertices;\r\n\t\t\t\t\t\tregionAttachment.computeWorldVertices(slot.bone, vertices, 0, 2);\r\n\t\t\t\t\t\tshapes.line(vertices[0], vertices[1], vertices[2], vertices[3]);\r\n\t\t\t\t\t\tshapes.line(vertices[2], vertices[3], vertices[4], vertices[5]);\r\n\t\t\t\t\t\tshapes.line(vertices[4], vertices[5], vertices[6], vertices[7]);\r\n\t\t\t\t\t\tshapes.line(vertices[6], vertices[7], vertices[0], vertices[1]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.drawMeshHull || this.drawMeshTriangles) {\r\n\t\t\t\tlet slots = skeleton.slots;\r\n\t\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\t\tlet slot = slots[i];\r\n\t\t\t\t\tif (!slot.bone.active) continue;\r\n\t\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\t\tif (!(attachment instanceof MeshAttachment)) continue;\r\n\t\t\t\t\tlet mesh = <MeshAttachment>attachment;\r\n\t\t\t\t\tlet vertices = this.vertices;\r\n\t\t\t\t\tmesh.computeWorldVertices(slot, 0, mesh.worldVerticesLength, vertices, 0, 2);\r\n\t\t\t\t\tlet triangles = mesh.triangles;\r\n\t\t\t\t\tlet hullLength = mesh.hullLength;\r\n\t\t\t\t\tif (this.drawMeshTriangles) {\r\n\t\t\t\t\t\tshapes.setColor(this.triangleLineColor);\r\n\t\t\t\t\t\tfor (let ii = 0, nn = triangles.length; ii < nn; ii += 3) {\r\n\t\t\t\t\t\t\tlet v1 = triangles[ii] * 2, v2 = triangles[ii + 1] * 2, v3 = triangles[ii + 2] * 2;\r\n\t\t\t\t\t\t\tshapes.triangle(false, vertices[v1], vertices[v1 + 1], //\r\n\t\t\t\t\t\t\t\tvertices[v2], vertices[v2 + 1], //\r\n\t\t\t\t\t\t\t\tvertices[v3], vertices[v3 + 1] //\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.drawMeshHull && hullLength > 0) {\r\n\t\t\t\t\t\tshapes.setColor(this.attachmentLineColor);\r\n\t\t\t\t\t\thullLength = (hullLength >> 1) * 2;\r\n\t\t\t\t\t\tlet lastX = vertices[hullLength - 2], lastY = vertices[hullLength - 1];\r\n\t\t\t\t\t\tfor (let ii = 0, nn = hullLength; ii < nn; ii += 2) {\r\n\t\t\t\t\t\t\tlet x = vertices[ii], y = vertices[ii + 1];\r\n\t\t\t\t\t\t\tshapes.line(x, y, lastX, lastY);\r\n\t\t\t\t\t\t\tlastX = x;\r\n\t\t\t\t\t\t\tlastY = y;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.drawBoundingBoxes) {\r\n\t\t\t\tlet bounds = this.bounds;\r\n\t\t\t\tbounds.update(skeleton, true);\r\n\t\t\t\tshapes.setColor(this.aabbColor);\r\n\t\t\t\tshapes.rect(false, bounds.minX, bounds.minY, bounds.getWidth(), bounds.getHeight());\r\n\t\t\t\tlet polygons = bounds.polygons;\r\n\t\t\t\tlet boxes = bounds.boundingBoxes;\r\n\t\t\t\tfor (let i = 0, n = polygons.length; i < n; i++) {\r\n\t\t\t\t\tlet polygon = polygons[i];\r\n\t\t\t\t\tshapes.setColor(boxes[i].color);\r\n\t\t\t\t\tshapes.polygon(polygon, 0, polygon.length);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.drawPaths) {\r\n\t\t\t\tlet slots = skeleton.slots;\r\n\t\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\t\tlet slot = slots[i];\r\n\t\t\t\t\tif (!slot.bone.active) continue;\r\n\t\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\t\tif (!(attachment instanceof PathAttachment)) continue;\r\n\t\t\t\t\tlet path = <PathAttachment>attachment;\r\n\t\t\t\t\tlet nn = path.worldVerticesLength;\r\n\t\t\t\t\tlet world = this.temp = Utils.setArraySize(this.temp, nn, 0);\r\n\t\t\t\t\tpath.computeWorldVertices(slot, 0, nn, world, 0, 2);\r\n\t\t\t\t\tlet color = this.pathColor;\r\n\t\t\t\t\tlet x1 = world[2], y1 = world[3], x2 = 0, y2 = 0;\r\n\t\t\t\t\tif (path.closed) {\r\n\t\t\t\t\t\tshapes.setColor(color);\r\n\t\t\t\t\t\tlet cx1 = world[0], cy1 = world[1], cx2 = world[nn - 2], cy2 = world[nn - 1];\r\n\t\t\t\t\t\tx2 = world[nn - 4];\r\n\t\t\t\t\t\ty2 = world[nn - 3];\r\n\t\t\t\t\t\tshapes.curve(x1, y1, cx1, cy1, cx2, cy2, x2, y2, 32);\r\n\t\t\t\t\t\tshapes.setColor(SkeletonDebugRenderer.LIGHT_GRAY);\r\n\t\t\t\t\t\tshapes.line(x1, y1, cx1, cy1);\r\n\t\t\t\t\t\tshapes.line(x2, y2, cx2, cy2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnn -= 4;\r\n\t\t\t\t\tfor (let ii = 4; ii < nn; ii += 6) {\r\n\t\t\t\t\t\tlet cx1 = world[ii], cy1 = world[ii + 1], cx2 = world[ii + 2], cy2 = world[ii + 3];\r\n\t\t\t\t\t\tx2 = world[ii + 4];\r\n\t\t\t\t\t\ty2 = world[ii + 5];\r\n\t\t\t\t\t\tshapes.setColor(color);\r\n\t\t\t\t\t\tshapes.curve(x1, y1, cx1, cy1, cx2, cy2, x2, y2, 32);\r\n\t\t\t\t\t\tshapes.setColor(SkeletonDebugRenderer.LIGHT_GRAY);\r\n\t\t\t\t\t\tshapes.line(x1, y1, cx1, cy1);\r\n\t\t\t\t\t\tshapes.line(x2, y2, cx2, cy2);\r\n\t\t\t\t\t\tx1 = x2;\r\n\t\t\t\t\t\ty1 = y2;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.drawBones) {\r\n\t\t\t\tshapes.setColor(this.boneOriginColor);\r\n\t\t\t\tfor (let i = 0, n = bones.length; i < n; i++) {\r\n\t\t\t\t\tlet bone = bones[i];\r\n\t\t\t\t\tif (ignoredBones && ignoredBones.indexOf(bone.data.name) > -1) continue;\r\n\t\t\t\t\tshapes.circle(true, skeletonX + bone.worldX, skeletonY + bone.worldY, 3 * this.scale, SkeletonDebugRenderer.GREEN, 8);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.drawClipping) {\r\n\t\t\t\tlet slots = skeleton.slots;\r\n\t\t\t\tshapes.setColor(this.clipColor)\r\n\t\t\t\tfor (let i = 0, n = slots.length; i < n; i++) {\r\n\t\t\t\t\tlet slot = slots[i];\r\n\t\t\t\t\tif (!slot.bone.active) continue;\r\n\t\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\t\tif (!(attachment instanceof ClippingAttachment)) continue;\r\n\t\t\t\t\tlet clip = <ClippingAttachment>attachment;\r\n\t\t\t\t\tlet nn = clip.worldVerticesLength;\r\n\t\t\t\t\tlet world = this.temp = Utils.setArraySize(this.temp, nn, 0);\r\n\t\t\t\t\tclip.computeWorldVertices(slot, 0, nn, world, 0, 2);\r\n\t\t\t\t\tfor (let i = 0, n = world.length; i < n; i+=2) {\r\n\t\t\t\t\t\tlet x = world[i];\r\n\t\t\t\t\t\tlet y = world[i + 1];\r\n\t\t\t\t\t\tlet x2 = world[(i + 2) % world.length];\r\n\t\t\t\t\t\tlet y2 = world[(i + 3) % world.length];\r\n\t\t\t\t\t\tshapes.line(x, y, x2, y2);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdispose () {\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { Pool } from \"./Utils\";\r\n\r\n// module spine {\r\n\texport class Triangulator {\r\n\t\tprivate convexPolygons = new Array<Array<number>>();\r\n\t\tprivate convexPolygonsIndices = new Array<Array<number>>();\r\n\r\n\t\tprivate indicesArray = new Array<number>();\r\n\t\tprivate isConcaveArray = new Array<boolean>();\r\n\t\tprivate triangles = new Array<number>();\r\n\r\n\t\tprivate polygonPool = new Pool<Array<number>>(() => {\r\n\t\t\treturn new Array<number>();\r\n\t\t});\r\n\r\n\t\tprivate polygonIndicesPool = new Pool<Array<number>>(() => {\r\n\t\t\treturn new Array<number>();\r\n\t\t});\r\n\r\n\t\tpublic triangulate (verticesArray: ArrayLike<number>): Array<number> {\r\n\t\t\tlet vertices = verticesArray;\r\n\t\t\tlet vertexCount = verticesArray.length >> 1;\r\n\r\n\t\t\tlet indices = this.indicesArray;\r\n\t\t\tindices.length = 0;\r\n\t\t\tfor (let i = 0; i < vertexCount; i++)\r\n\t\t\t\tindices[i] = i;\r\n\r\n\t\t\tlet isConcave = this.isConcaveArray;\r\n\t\t\tisConcave.length = 0;\r\n\t\t\tfor (let i = 0, n = vertexCount; i < n; ++i)\r\n\t\t\t\tisConcave[i] = Triangulator.isConcave(i, vertexCount, vertices, indices);\r\n\r\n\t\t\tlet triangles = this.triangles;\r\n\t\t\ttriangles.length = 0;\r\n\r\n\t\t\twhile (vertexCount > 3) {\r\n\t\t\t\t// Find ear tip.\r\n\t\t\t\tlet previous = vertexCount - 1, i = 0, next = 1;\r\n\t\t\t\twhile (true) {\r\n\t\t\t\t\touter:\r\n\t\t\t\t\tif (!isConcave[i]) {\r\n\t\t\t\t\t\tlet p1 = indices[previous] << 1, p2 = indices[i] << 1, p3 = indices[next] << 1;\r\n\t\t\t\t\t\tlet p1x = vertices[p1], p1y = vertices[p1 + 1];\r\n\t\t\t\t\t\tlet p2x = vertices[p2], p2y = vertices[p2 + 1];\r\n\t\t\t\t\t\tlet p3x = vertices[p3], p3y = vertices[p3 + 1];\r\n\t\t\t\t\t\tfor (let ii = (next + 1) % vertexCount; ii != previous; ii = (ii + 1) % vertexCount) {\r\n\t\t\t\t\t\t\tif (!isConcave[ii]) continue;\r\n\t\t\t\t\t\t\tlet v = indices[ii] << 1;\r\n\t\t\t\t\t\t\tlet vx = vertices[v], vy = vertices[v + 1];\r\n\t\t\t\t\t\t\tif (Triangulator.positiveArea(p3x, p3y, p1x, p1y, vx, vy)) {\r\n\t\t\t\t\t\t\t\tif (Triangulator.positiveArea(p1x, p1y, p2x, p2y, vx, vy)) {\r\n\t\t\t\t\t\t\t\t\tif (Triangulator.positiveArea(p2x, p2y, p3x, p3y, vx, vy)) break outer;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (next == 0) {\r\n\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\tif (!isConcave[i]) break;\r\n\t\t\t\t\t\t\ti--;\r\n\t\t\t\t\t\t} while (i > 0);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tprevious = i;\r\n\t\t\t\t\ti = next;\r\n\t\t\t\t\tnext = (next + 1) % vertexCount;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Cut ear tip.\r\n\t\t\t\ttriangles.push(indices[(vertexCount + i - 1) % vertexCount]);\r\n\t\t\t\ttriangles.push(indices[i]);\r\n\t\t\t\ttriangles.push(indices[(i + 1) % vertexCount]);\r\n\t\t\t\tindices.splice(i, 1);\r\n\t\t\t\tisConcave.splice(i, 1);\r\n\t\t\t\tvertexCount--;\r\n\r\n\t\t\t\tlet previousIndex = (vertexCount + i - 1) % vertexCount;\r\n\t\t\t\tlet nextIndex = i == vertexCount ? 0 : i;\r\n\t\t\t\tisConcave[previousIndex] = Triangulator.isConcave(previousIndex, vertexCount, vertices, indices);\r\n\t\t\t\tisConcave[nextIndex] = Triangulator.isConcave(nextIndex, vertexCount, vertices, indices);\r\n\t\t\t}\r\n\r\n\t\t\tif (vertexCount == 3) {\r\n\t\t\t\ttriangles.push(indices[2]);\r\n\t\t\t\ttriangles.push(indices[0]);\r\n\t\t\t\ttriangles.push(indices[1]);\r\n\t\t\t}\r\n\r\n\t\t\treturn triangles;\r\n\t\t}\r\n\r\n\t\tdecompose (verticesArray: Array<number>, triangles: Array<number>) : Array<Array<number>> {\r\n\t\t\tlet vertices = verticesArray;\r\n\t\t\tlet convexPolygons = this.convexPolygons;\r\n\t\t\tthis.polygonPool.freeAll(convexPolygons);\r\n\t\t\tconvexPolygons.length = 0;\r\n\r\n\t\t\tlet convexPolygonsIndices = this.convexPolygonsIndices;\r\n\t\t\tthis.polygonIndicesPool.freeAll(convexPolygonsIndices);\r\n\t\t\tconvexPolygonsIndices.length = 0;\r\n\r\n\t\t\tlet polygonIndices = this.polygonIndicesPool.obtain();\r\n\t\t\tpolygonIndices.length = 0;\r\n\r\n\t\t\tlet polygon = this.polygonPool.obtain();\r\n\t\t\tpolygon.length = 0;\r\n\r\n\t\t\t// Merge subsequent triangles if they form a triangle fan.\r\n\t\t\tlet fanBaseIndex = -1, lastWinding = 0;\r\n\t\t\tfor (let i = 0, n = triangles.length; i < n; i += 3) {\r\n\t\t\t\tlet t1 = triangles[i] << 1, t2 = triangles[i + 1] << 1, t3 = triangles[i + 2] << 1;\r\n\t\t\t\tlet x1 = vertices[t1], y1 = vertices[t1 + 1];\r\n\t\t\t\tlet x2 = vertices[t2], y2 = vertices[t2 + 1];\r\n\t\t\t\tlet x3 = vertices[t3], y3 = vertices[t3 + 1];\r\n\r\n\t\t\t\t// If the base of the last triangle is the same as this triangle, check if they form a convex polygon (triangle fan).\r\n\t\t\t\tlet merged = false;\r\n\t\t\t\tif (fanBaseIndex == t1) {\r\n\t\t\t\t\tlet o = polygon.length - 4;\r\n\t\t\t\t\tlet winding1 = Triangulator.winding(polygon[o], polygon[o + 1], polygon[o + 2], polygon[o + 3], x3, y3);\r\n\t\t\t\t\tlet winding2 = Triangulator.winding(x3, y3, polygon[0], polygon[1], polygon[2], polygon[3]);\r\n\t\t\t\t\tif (winding1 == lastWinding && winding2 == lastWinding) {\r\n\t\t\t\t\t\tpolygon.push(x3);\r\n\t\t\t\t\t\tpolygon.push(y3);\r\n\t\t\t\t\t\tpolygonIndices.push(t3);\r\n\t\t\t\t\t\tmerged = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Otherwise make this triangle the new base.\r\n\t\t\t\tif (!merged) {\r\n\t\t\t\t\tif (polygon.length > 0) {\r\n\t\t\t\t\t\tconvexPolygons.push(polygon);\r\n\t\t\t\t\t\tconvexPolygonsIndices.push(polygonIndices);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.polygonPool.free(polygon)\r\n\t\t\t\t\t\tthis.polygonIndicesPool.free(polygonIndices);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpolygon = this.polygonPool.obtain();\r\n\t\t\t\t\tpolygon.length = 0;\r\n\t\t\t\t\tpolygon.push(x1);\r\n\t\t\t\t\tpolygon.push(y1);\r\n\t\t\t\t\tpolygon.push(x2);\r\n\t\t\t\t\tpolygon.push(y2);\r\n\t\t\t\t\tpolygon.push(x3);\r\n\t\t\t\t\tpolygon.push(y3);\r\n\t\t\t\t\tpolygonIndices = this.polygonIndicesPool.obtain();\r\n\t\t\t\t\tpolygonIndices.length = 0;\r\n\t\t\t\t\tpolygonIndices.push(t1);\r\n\t\t\t\t\tpolygonIndices.push(t2);\r\n\t\t\t\t\tpolygonIndices.push(t3);\r\n\t\t\t\t\tlastWinding = Triangulator.winding(x1, y1, x2, y2, x3, y3);\r\n\t\t\t\t\tfanBaseIndex = t1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (polygon.length > 0) {\r\n\t\t\t\tconvexPolygons.push(polygon);\r\n\t\t\t\tconvexPolygonsIndices.push(polygonIndices);\r\n\t\t\t}\r\n\r\n\t\t\t// Go through the list of polygons and try to merge the remaining triangles with the found triangle fans.\r\n\t\t\tfor (let i = 0, n = convexPolygons.length; i < n; i++) {\r\n\t\t\t\tpolygonIndices = convexPolygonsIndices[i];\r\n\t\t\t\tif (polygonIndices.length == 0) continue;\r\n\t\t\t\tlet firstIndex = polygonIndices[0];\r\n\t\t\t\tlet lastIndex = polygonIndices[polygonIndices.length - 1];\r\n\r\n\t\t\t\tpolygon = convexPolygons[i];\r\n\t\t\t\tlet o = polygon.length - 4;\r\n\t\t\t\tlet prevPrevX = polygon[o], prevPrevY = polygon[o + 1];\r\n\t\t\t\tlet prevX = polygon[o + 2], prevY = polygon[o + 3];\r\n\t\t\t\tlet firstX = polygon[0], firstY = polygon[1];\r\n\t\t\t\tlet secondX = polygon[2], secondY = polygon[3];\r\n\t\t\t\tlet winding = Triangulator.winding(prevPrevX, prevPrevY, prevX, prevY, firstX, firstY);\r\n\r\n\t\t\t\tfor (let ii = 0; ii < n; ii++) {\r\n\t\t\t\t\tif (ii == i) continue;\r\n\t\t\t\t\tlet otherIndices = convexPolygonsIndices[ii];\r\n\t\t\t\t\tif (otherIndices.length != 3) continue;\r\n\t\t\t\t\tlet otherFirstIndex = otherIndices[0];\r\n\t\t\t\t\tlet otherSecondIndex = otherIndices[1];\r\n\t\t\t\t\tlet otherLastIndex = otherIndices[2];\r\n\r\n\t\t\t\t\tlet otherPoly = convexPolygons[ii];\r\n\t\t\t\t\tlet x3 = otherPoly[otherPoly.length - 2], y3 = otherPoly[otherPoly.length - 1];\r\n\r\n\t\t\t\t\tif (otherFirstIndex != firstIndex || otherSecondIndex != lastIndex) continue;\r\n\t\t\t\t\tlet winding1 = Triangulator.winding(prevPrevX, prevPrevY, prevX, prevY, x3, y3);\r\n\t\t\t\t\tlet winding2 = Triangulator.winding(x3, y3, firstX, firstY, secondX, secondY);\r\n\t\t\t\t\tif (winding1 == winding && winding2 == winding) {\r\n\t\t\t\t\t\totherPoly.length = 0;\r\n\t\t\t\t\t\totherIndices.length = 0;\r\n\t\t\t\t\t\tpolygon.push(x3);\r\n\t\t\t\t\t\tpolygon.push(y3);\r\n\t\t\t\t\t\tpolygonIndices.push(otherLastIndex);\r\n\t\t\t\t\t\tprevPrevX = prevX;\r\n\t\t\t\t\t\tprevPrevY = prevY;\r\n\t\t\t\t\t\tprevX = x3;\r\n\t\t\t\t\t\tprevY = y3;\r\n\t\t\t\t\t\tii = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove empty polygons that resulted from the merge step above.\r\n\t\t\tfor (let i = convexPolygons.length - 1; i >= 0; i--) {\r\n\t\t\t\tpolygon = convexPolygons[i];\r\n\t\t\t\tif (polygon.length == 0) {\r\n\t\t\t\t\tconvexPolygons.splice(i, 1);\r\n\t\t\t\t\tthis.polygonPool.free(polygon);\r\n\t\t\t\t\tpolygonIndices = convexPolygonsIndices[i]\r\n\t\t\t\t\tconvexPolygonsIndices.splice(i, 1)\r\n\t\t\t\t\tthis.polygonIndicesPool.free(polygonIndices);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn convexPolygons;\r\n\t\t}\r\n\r\n\t\tprivate static isConcave (index: number, vertexCount: number, vertices: ArrayLike<number>, indices: ArrayLike<number>): boolean {\r\n\t\t\tlet previous = indices[(vertexCount + index - 1) % vertexCount] << 1;\r\n\t\t\tlet current = indices[index] << 1;\r\n\t\t\tlet next = indices[(index + 1) % vertexCount] << 1;\r\n\t\t\treturn !this.positiveArea(vertices[previous], vertices[previous + 1], vertices[current], vertices[current + 1], vertices[next],\r\n\t\t\t\tvertices[next + 1]);\r\n\t\t}\r\n\r\n\t\tprivate static positiveArea (p1x: number, p1y: number, p2x: number, p2y: number, p3x: number, p3y: number): boolean {\r\n\t\t\treturn p1x * (p3y - p2y) + p2x * (p1y - p3y) + p3x * (p2y - p1y) >= 0;\r\n\t\t}\r\n\r\n\t\tprivate static winding (p1x: number, p1y: number, p2x: number, p2y: number, p3x: number, p3y: number): number {\r\n\t\t\tlet px = p2x - p1x, py = p2y - p1y;\r\n\t\t\treturn p3x * py - p3y * px + px * p1y - p1x * py >= 0 ? 1 : -1;\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { ClippingAttachment } from \"./attachments/ClippingAttachment\";\r\nimport { Slot } from \"./Slot\";\r\nimport { Triangulator } from \"./Triangulator\";\r\nimport { Utils, Color, ArrayLike } from \"./Utils\";\r\n\r\n// module spine {\r\n\texport class SkeletonClipping {\r\n\t\tprivate triangulator = new Triangulator();\r\n\t\tprivate clippingPolygon = new Array<number>();\r\n\t\tprivate clipOutput = new Array<number>();\r\n\t\tclippedVertices = new Array<number>();\r\n\t\tclippedTriangles = new Array<number>();\r\n\t\tprivate scratch = new Array<number>();\r\n\r\n\t\tprivate clipAttachment: ClippingAttachment;\r\n\t\tprivate clippingPolygons: Array<Array<number>>;\r\n\r\n\t\tclipStart (slot: Slot, clip: ClippingAttachment): number {\r\n\t\t\tif (this.clipAttachment != null) return 0;\r\n\t\t\tthis.clipAttachment = clip;\r\n\r\n\t\t\tlet n = clip.worldVerticesLength;\r\n\t\t\tlet vertices = Utils.setArraySize(this.clippingPolygon, n);\r\n\t\t\tclip.computeWorldVertices(slot, 0, n, vertices, 0, 2);\r\n\t\t\tlet clippingPolygon = this.clippingPolygon;\r\n\t\t\tSkeletonClipping.makeClockwise(clippingPolygon);\r\n\t\t\tlet clippingPolygons = this.clippingPolygons = this.triangulator.decompose(clippingPolygon, this.triangulator.triangulate(clippingPolygon));\r\n\t\t\tfor (let i = 0, n = clippingPolygons.length; i < n; i++) {\r\n\t\t\t\tlet polygon = clippingPolygons[i];\r\n\t\t\t\tSkeletonClipping.makeClockwise(polygon);\r\n\t\t\t\tpolygon.push(polygon[0]);\r\n\t\t\t\tpolygon.push(polygon[1]);\r\n\t\t\t}\r\n\r\n\t\t\treturn clippingPolygons.length;\r\n\t\t}\r\n\r\n\t\tclipEndWithSlot (slot: Slot) {\r\n\t\t\tif (this.clipAttachment != null && this.clipAttachment.endSlot == slot.data) this.clipEnd();\r\n\t\t}\r\n\r\n\t\tclipEnd () {\r\n\t\t\tif (this.clipAttachment == null) return;\r\n\t\t\tthis.clipAttachment = null;\r\n\t\t\tthis.clippingPolygons = null;\r\n\t\t\tthis.clippedVertices.length = 0;\r\n\t\t\tthis.clippedTriangles.length = 0;\r\n\t\t\tthis.clippingPolygon.length = 0;\r\n\t\t}\r\n\r\n\t\tisClipping (): boolean {\r\n\t\t\treturn this.clipAttachment != null;\r\n\t\t}\r\n\r\n\t\tclipTriangles (vertices: ArrayLike<number>, verticesLength: number, triangles: ArrayLike<number>, trianglesLength: number, uvs: ArrayLike<number>,\r\n\t\t\tlight: Color, dark: Color, twoColor: boolean) {\r\n\r\n\t\t\tlet clipOutput = this.clipOutput, clippedVertices = this.clippedVertices;\r\n\t\t\tlet clippedTriangles = this.clippedTriangles;\r\n\t\t\tlet polygons = this.clippingPolygons;\r\n\t\t\tlet polygonsCount = this.clippingPolygons.length;\r\n\t\t\tlet vertexSize = twoColor ? 12 : 8;\r\n\r\n\t\t\tlet index = 0;\r\n\t\t\tclippedVertices.length = 0;\r\n\t\t\tclippedTriangles.length = 0;\r\n\t\t\touter:\r\n\t\t\tfor (let i = 0; i < trianglesLength; i += 3) {\r\n\t\t\t\tlet vertexOffset = triangles[i] << 1;\r\n\t\t\t\tlet x1 = vertices[vertexOffset], y1 = vertices[vertexOffset + 1];\r\n\t\t\t\tlet u1 = uvs[vertexOffset], v1 = uvs[vertexOffset + 1];\r\n\r\n\t\t\t\tvertexOffset = triangles[i + 1] << 1;\r\n\t\t\t\tlet x2 = vertices[vertexOffset], y2 = vertices[vertexOffset + 1];\r\n\t\t\t\tlet u2 = uvs[vertexOffset], v2 = uvs[vertexOffset + 1];\r\n\r\n\t\t\t\tvertexOffset = triangles[i + 2] << 1;\r\n\t\t\t\tlet x3 = vertices[vertexOffset], y3 = vertices[vertexOffset + 1];\r\n\t\t\t\tlet u3 = uvs[vertexOffset], v3 = uvs[vertexOffset + 1];\r\n\r\n\t\t\t\tfor (let p = 0; p < polygonsCount; p++) {\r\n\t\t\t\t\tlet s = clippedVertices.length;\r\n\t\t\t\t\tif (this.clip(x1, y1, x2, y2, x3, y3, polygons[p], clipOutput)) {\r\n\t\t\t\t\t\tlet clipOutputLength = clipOutput.length;\r\n\t\t\t\t\t\tif (clipOutputLength == 0) continue;\r\n\t\t\t\t\t\tlet d0 = y2 - y3, d1 = x3 - x2, d2 = x1 - x3, d4 = y3 - y1;\r\n\t\t\t\t\t\tlet d = 1 / (d0 * d2 + d1 * (y1 - y3));\r\n\r\n\t\t\t\t\t\tlet clipOutputCount = clipOutputLength >> 1;\r\n\t\t\t\t\t\tlet clipOutputItems = this.clipOutput;\r\n\t\t\t\t\t\tlet clippedVerticesItems = Utils.setArraySize(clippedVertices, s + clipOutputCount * vertexSize);\r\n\t\t\t\t\t\tfor (let ii = 0; ii < clipOutputLength; ii += 2) {\r\n\t\t\t\t\t\t\tlet x = clipOutputItems[ii], y = clipOutputItems[ii + 1];\r\n\t\t\t\t\t\t\tclippedVerticesItems[s] = x;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 1] = y;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 2] = light.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 3] = light.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 4] = light.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 5] = light.a;\r\n\t\t\t\t\t\t\tlet c0 = x - x3, c1 = y - y3;\r\n\t\t\t\t\t\t\tlet a = (d0 * c0 + d1 * c1) * d;\r\n\t\t\t\t\t\t\tlet b = (d4 * c0 + d2 * c1) * d;\r\n\t\t\t\t\t\t\tlet c = 1 - a - b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 6] = u1 * a + u2 * b + u3 * c;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 7] = v1 * a + v2 * b + v3 * c;\r\n\t\t\t\t\t\t\tif (twoColor) {\r\n\t\t\t\t\t\t\t\tclippedVerticesItems[s + 8] = dark.r;\r\n\t\t\t\t\t\t\t\tclippedVerticesItems[s + 9] = dark.g;\r\n\t\t\t\t\t\t\t\tclippedVerticesItems[s + 10] = dark.b;\r\n\t\t\t\t\t\t\t\tclippedVerticesItems[s + 11] = dark.a;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ts += vertexSize;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ts = clippedTriangles.length;\r\n\t\t\t\t\t\tlet clippedTrianglesItems = Utils.setArraySize(clippedTriangles, s + 3 * (clipOutputCount - 2));\r\n\t\t\t\t\t\tclipOutputCount--;\r\n\t\t\t\t\t\tfor (let ii = 1; ii < clipOutputCount; ii++) {\r\n\t\t\t\t\t\t\tclippedTrianglesItems[s] = index;\r\n\t\t\t\t\t\t\tclippedTrianglesItems[s + 1] = (index + ii);\r\n\t\t\t\t\t\t\tclippedTrianglesItems[s + 2] = (index + ii + 1);\r\n\t\t\t\t\t\t\ts += 3;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tindex += clipOutputCount + 1;\r\n\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet clippedVerticesItems = Utils.setArraySize(clippedVertices, s + 3 * vertexSize);\r\n\t\t\t\t\t\tclippedVerticesItems[s] = x1;\r\n\t\t\t\t\t\tclippedVerticesItems[s + 1] = y1;\r\n\t\t\t\t\t\tclippedVerticesItems[s + 2] = light.r;\r\n\t\t\t\t\t\tclippedVerticesItems[s + 3] = light.g;\r\n\t\t\t\t\t\tclippedVerticesItems[s + 4] = light.b;\r\n\t\t\t\t\t\tclippedVerticesItems[s + 5] = light.a;\r\n\t\t\t\t\t\tif (!twoColor) {\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 6] = u1;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 7] = v1;\r\n\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 8] = x2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 9] = y2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 10] = light.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 11] = light.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 12] = light.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 13] = light.a;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 14] = u2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 15] = v2;\r\n\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 16] = x3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 17] = y3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 18] = light.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 19] = light.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 20] = light.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 21] = light.a;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 22] = u3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 23] = v3;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 6] = u1;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 7] = v1;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 8] = dark.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 9] = dark.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 10] = dark.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 11] = dark.a;\r\n\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 12] = x2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 13] = y2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 14] = light.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 15] = light.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 16] = light.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 17] = light.a;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 18] = u2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 19] = v2;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 20] = dark.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 21] = dark.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 22] = dark.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 23] = dark.a;\r\n\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 24] = x3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 25] = y3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 26] = light.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 27] = light.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 28] = light.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 29] = light.a;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 30] = u3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 31] = v3;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 32] = dark.r;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 33] = dark.g;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 34] = dark.b;\r\n\t\t\t\t\t\t\tclippedVerticesItems[s + 35] = dark.a;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ts = clippedTriangles.length;\r\n\t\t\t\t\t\tlet clippedTrianglesItems = Utils.setArraySize(clippedTriangles, s + 3);\r\n\t\t\t\t\t\tclippedTrianglesItems[s] = index;\r\n\t\t\t\t\t\tclippedTrianglesItems[s + 1] = (index + 1);\r\n\t\t\t\t\t\tclippedTrianglesItems[s + 2] = (index + 2);\r\n\t\t\t\t\t\tindex += 3;\r\n\t\t\t\t\t\tcontinue outer;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Clips the input triangle against the convex, clockwise clipping area. If the triangle lies entirely within the clipping\r\n\t\t * area, false is returned. The clipping area must duplicate the first vertex at the end of the vertices list. */\r\n\t\tclip (x1: number, y1: number, x2: number, y2: number, x3: number, y3: number, clippingArea: Array<number>, output: Array<number>) {\r\n\t\t\tlet originalOutput = output;\r\n\t\t\tlet clipped = false;\r\n\r\n\t\t\t// Avoid copy at the end.\r\n\t\t\tlet input: Array<number> = null;\r\n\t\t\tif (clippingArea.length % 4 >= 2) {\r\n\t\t\t\tinput = output;\r\n\t\t\t\toutput = this.scratch;\r\n\t\t\t} else\r\n\t\t\t\tinput = this.scratch;\r\n\r\n\t\t\tinput.length = 0;\r\n\t\t\tinput.push(x1);\r\n\t\t\tinput.push(y1);\r\n\t\t\tinput.push(x2);\r\n\t\t\tinput.push(y2);\r\n\t\t\tinput.push(x3);\r\n\t\t\tinput.push(y3);\r\n\t\t\tinput.push(x1);\r\n\t\t\tinput.push(y1);\r\n\t\t\toutput.length = 0;\r\n\r\n\t\t\tlet clippingVertices = clippingArea;\r\n\t\t\tlet clippingVerticesLast = clippingArea.length - 4;\r\n\t\t\tfor (let i = 0;; i += 2) {\r\n\t\t\t\tlet edgeX = clippingVertices[i], edgeY = clippingVertices[i + 1];\r\n\t\t\t\tlet edgeX2 = clippingVertices[i + 2], edgeY2 = clippingVertices[i + 3];\r\n\t\t\t\tlet deltaX = edgeX - edgeX2, deltaY = edgeY - edgeY2;\r\n\r\n\t\t\t\tlet inputVertices = input;\r\n\t\t\t\tlet inputVerticesLength = input.length - 2, outputStart = output.length;\r\n\t\t\t\tfor (let ii = 0; ii < inputVerticesLength; ii += 2) {\r\n\t\t\t\t\tlet inputX = inputVertices[ii], inputY = inputVertices[ii + 1];\r\n\t\t\t\t\tlet inputX2 = inputVertices[ii + 2], inputY2 = inputVertices[ii + 3];\r\n\t\t\t\t\tlet side2 = deltaX * (inputY2 - edgeY2) - deltaY * (inputX2 - edgeX2) > 0;\r\n\t\t\t\t\tif (deltaX * (inputY - edgeY2) - deltaY * (inputX - edgeX2) > 0) {\r\n\t\t\t\t\t\tif (side2) { // v1 inside, v2 inside\r\n\t\t\t\t\t\t\toutput.push(inputX2);\r\n\t\t\t\t\t\t\toutput.push(inputY2);\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// v1 inside, v2 outside\r\n\t\t\t\t\t\tlet c0 = inputY2 - inputY, c2 = inputX2 - inputX;\r\n\t\t\t\t\t\tlet s = c0 * (edgeX2 - edgeX) - c2 * (edgeY2 - edgeY);\r\n\t\t\t\t\t\tif (Math.abs(s) > 0.000001) {\r\n\t\t\t\t\t\t\tlet ua = (c2 * (edgeY - inputY) - c0 * (edgeX - inputX)) / s;\r\n\t\t\t\t\t\t\toutput.push(edgeX + (edgeX2 - edgeX) * ua);\r\n\t\t\t\t\t\t\toutput.push(edgeY + (edgeY2 - edgeY) * ua);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toutput.push(edgeX);\r\n\t\t\t\t\t\t\toutput.push(edgeY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (side2) { // v1 outside, v2 inside\r\n\t\t\t\t\t\tlet c0 = inputY2 - inputY, c2 = inputX2 - inputX;\r\n\t\t\t\t\t\tlet s = c0 * (edgeX2 - edgeX) - c2 * (edgeY2 - edgeY);\r\n\t\t\t\t\t\tif (Math.abs(s) > 0.000001) {\r\n\t\t\t\t\t\t\tlet ua = (c2 * (edgeY - inputY) - c0 * (edgeX - inputX)) / s;\r\n\t\t\t\t\t\t\toutput.push(edgeX + (edgeX2 - edgeX) * ua);\r\n\t\t\t\t\t\t\toutput.push(edgeY + (edgeY2 - edgeY) * ua);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toutput.push(edgeX);\r\n\t\t\t\t\t\t\toutput.push(edgeY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\toutput.push(inputX2);\r\n\t\t\t\t\t\toutput.push(inputY2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tclipped = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (outputStart == output.length) { // All edges outside.\r\n\t\t\t\t\toriginalOutput.length = 0;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toutput.push(output[0]);\r\n\t\t\t\toutput.push(output[1]);\r\n\r\n\t\t\t\tif (i == clippingVerticesLast) break;\r\n\t\t\t\tlet temp = output;\r\n\t\t\t\toutput = input;\r\n\t\t\t\toutput.length = 0;\r\n\t\t\t\tinput = temp;\r\n\t\t\t}\r\n\r\n\t\t\tif (originalOutput != output) {\r\n\t\t\t\toriginalOutput.length = 0;\r\n\t\t\t\tfor (let i = 0, n = output.length - 2; i < n; i++)\r\n\t\t\t\t\toriginalOutput[i] = output[i];\r\n\t\t\t} else\r\n\t\t\t\toriginalOutput.length = originalOutput.length - 2;\r\n\r\n\t\t\treturn clipped;\r\n\t\t}\r\n\r\n\t\tpublic static makeClockwise (polygon: ArrayLike<number>) {\r\n\t\t\tlet vertices = polygon;\r\n\t\t\tlet verticeslength = polygon.length;\r\n\r\n\t\t\tlet area = vertices[verticeslength - 2] * vertices[1] - vertices[0] * vertices[verticeslength - 1], p1x = 0, p1y = 0, p2x = 0, p2y = 0;\r\n\t\t\tfor (let i = 0, n = verticeslength - 3; i < n; i += 2) {\r\n\t\t\t\tp1x = vertices[i];\r\n\t\t\t\tp1y = vertices[i + 1];\r\n\t\t\t\tp2x = vertices[i + 2];\r\n\t\t\t\tp2y = vertices[i + 3];\r\n\t\t\t\tarea += p1x * p2y - p2x * p1y;\r\n\t\t\t}\r\n\t\t\tif (area < 0) return;\r\n\r\n\t\t\tfor (let i = 0, lastX = verticeslength - 2, n = verticeslength >> 1; i < n; i += 2) {\r\n\t\t\t\tlet x = vertices[i], y = vertices[i + 1];\r\n\t\t\t\tlet other = lastX - i;\r\n\t\t\t\tvertices[i] = vertices[other];\r\n\t\t\t\tvertices[i + 1] = vertices[other + 1];\r\n\t\t\t\tvertices[other] = x;\r\n\t\t\t\tvertices[other + 1] = y;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { ClippingAttachment } from \"../core/attachments/ClippingAttachment\";\r\nimport { MeshAttachment } from \"../core/attachments/MeshAttachment\";\r\nimport { RegionAttachment } from \"../core/attachments/RegionAttachment\";\r\nimport { BlendMode } from \"../core/BlendMode\";\r\nimport { Skeleton } from \"../core/Skeleton\";\r\nimport { SkeletonClipping } from \"../core/SkeletonClipping\";\r\nimport { TextureAtlasRegion } from \"../core/TextureAtlas\";\r\nimport { Color, Vector2, Utils, ArrayLike } from \"../core/Utils\";\r\nimport { VertexEffect } from \"../core/VertexEffect\";\r\nimport { GLTexture } from \"./GLTexture\";\r\nimport { PolygonBatcher } from \"./PolygonBatcher\";\r\nimport { ManagedWebGLRenderingContext, WebGLBlendModeConverter } from \"./WebGL\";\r\n\r\n// module spine.webgl {\r\n\tclass Renderable {\r\n\t\tconstructor(public vertices: ArrayLike<number>, public numVertices: number, public numFloats: number) {}\r\n\t};\r\n\r\n\texport class SkeletonRenderer {\r\n\t\tstatic QUAD_TRIANGLES = [0, 1, 2, 2, 3, 0];\r\n\r\n\t\tpremultipliedAlpha = false;\r\n\t\tvertexEffect: VertexEffect = null;\r\n\t\tprivate tempColor = new Color();\r\n\t\tprivate tempColor2 = new Color();\r\n\t\tprivate vertices:ArrayLike<number>;\r\n\t\tprivate vertexSize = 2 + 2 + 4;\r\n\t\tprivate twoColorTint = false;\r\n\t\tprivate renderable: Renderable = new Renderable(null, 0, 0);\r\n\t\tprivate clipper: SkeletonClipping = new SkeletonClipping();\r\n\t\tprivate temp = new Vector2();\r\n\t\tprivate temp2 = new Vector2();\r\n\t\tprivate temp3 = new Color();\r\n\t\tprivate temp4 = new Color();\r\n\r\n\t\tconstructor (context: ManagedWebGLRenderingContext, twoColorTint: boolean = true) {\r\n\t\t\tthis.twoColorTint = twoColorTint;\r\n\t\t\tif (twoColorTint)\r\n\t\t\t\tthis.vertexSize += 4;\r\n\t\t\tthis.vertices = Utils.newFloatArray(this.vertexSize * 1024);\r\n\t\t}\r\n\r\n\t\tdraw (batcher: PolygonBatcher, skeleton: Skeleton, slotRangeStart: number = -1, slotRangeEnd: number = -1) {\r\n\t\t\tlet clipper = this.clipper;\r\n\t\t\tlet premultipliedAlpha = this.premultipliedAlpha;\r\n\t\t\tlet twoColorTint = this.twoColorTint;\r\n\t\t\tlet blendMode: BlendMode = null;\r\n\r\n\t\t\tlet tempPos = this.temp;\r\n\t\t\tlet tempUv = this.temp2;\r\n\t\t\tlet tempLight = this.temp3;\r\n\t\t\tlet tempDark = this.temp4;\r\n\r\n\t\t\tlet renderable: Renderable = this.renderable;\r\n\t\t\tlet uvs: ArrayLike<number> = null;\r\n\t\t\tlet triangles: Array<number> = null;\r\n\t\t\tlet drawOrder = skeleton.drawOrder;\r\n\t\t\tlet attachmentColor: Color = null;\r\n\t\t\tlet skeletonColor = skeleton.color;\r\n\t\t\tlet vertexSize = twoColorTint ? 12 : 8;\r\n\t\t\tlet inRange = false;\r\n\t\t\tif (slotRangeStart == -1) inRange = true;\r\n\t\t\tfor (let i = 0, n = drawOrder.length; i < n; i++) {\r\n\t\t\t\tlet clippedVertexSize = clipper.isClipping() ? 2 : vertexSize;\r\n\t\t\t\tlet slot = drawOrder[i];\r\n\t\t\t\tif (!slot.bone.active) {\r\n\t\t\t\t\tclipper.clipEndWithSlot(slot);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (slotRangeStart >= 0 && slotRangeStart == slot.data.index) {\r\n\t\t\t\t\tinRange = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!inRange) {\r\n\t\t\t\t\tclipper.clipEndWithSlot(slot);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (slotRangeEnd >= 0 && slotRangeEnd == slot.data.index) {\r\n\t\t\t\t\tinRange = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet attachment = slot.getAttachment();\r\n\t\t\t\tlet texture: GLTexture = null;\r\n\t\t\t\tif (attachment instanceof RegionAttachment) {\r\n\t\t\t\t\tlet region = <RegionAttachment>attachment;\r\n\t\t\t\t\trenderable.vertices = this.vertices;\r\n\t\t\t\t\trenderable.numVertices = 4;\r\n\t\t\t\t\trenderable.numFloats = clippedVertexSize << 2;\r\n\t\t\t\t\tregion.computeWorldVertices(slot.bone, renderable.vertices, 0, clippedVertexSize);\r\n\t\t\t\t\ttriangles = SkeletonRenderer.QUAD_TRIANGLES;\r\n\t\t\t\t\tuvs = region.uvs;\r\n\t\t\t\t\ttexture = <GLTexture>(<TextureAtlasRegion>region.region.renderObject).texture;\r\n\t\t\t\t\tattachmentColor = region.color;\r\n\t\t\t\t} else if (attachment instanceof MeshAttachment) {\r\n\t\t\t\t\tlet mesh = <MeshAttachment>attachment;\r\n\t\t\t\t\trenderable.vertices = this.vertices;\r\n\t\t\t\t\trenderable.numVertices = (mesh.worldVerticesLength >> 1);\r\n\t\t\t\t\trenderable.numFloats = renderable.numVertices * clippedVertexSize;\r\n\t\t\t\t\tif (renderable.numFloats > renderable.vertices.length) {\r\n\t\t\t\t\t\trenderable.vertices = this.vertices = Utils.newFloatArray(renderable.numFloats);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmesh.computeWorldVertices(slot, 0, mesh.worldVerticesLength, renderable.vertices, 0, clippedVertexSize);\r\n\t\t\t\t\ttriangles = mesh.triangles;\r\n\t\t\t\t\ttexture = <GLTexture>(<TextureAtlasRegion>mesh.region.renderObject).texture;\r\n\t\t\t\t\tuvs = mesh.uvs;\r\n\t\t\t\t\tattachmentColor = mesh.color;\r\n\t\t\t\t} else if (attachment instanceof ClippingAttachment) {\r\n\t\t\t\t\tlet clip = <ClippingAttachment>(attachment);\r\n\t\t\t\t\tclipper.clipStart(slot, clip);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tclipper.clipEndWithSlot(slot);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (texture != null) {\r\n\t\t\t\t\tlet slotColor = slot.color;\r\n\t\t\t\t\tlet finalColor = this.tempColor;\r\n\t\t\t\t\tfinalColor.r = skeletonColor.r * slotColor.r * attachmentColor.r;\r\n\t\t\t\t\tfinalColor.g = skeletonColor.g * slotColor.g * attachmentColor.g;\r\n\t\t\t\t\tfinalColor.b = skeletonColor.b * slotColor.b * attachmentColor.b;\r\n\t\t\t\t\tfinalColor.a = skeletonColor.a * slotColor.a * attachmentColor.a;\r\n\t\t\t\t\tif (premultipliedAlpha) {\r\n\t\t\t\t\t\tfinalColor.r *= finalColor.a;\r\n\t\t\t\t\t\tfinalColor.g *= finalColor.a;\r\n\t\t\t\t\t\tfinalColor.b *= finalColor.a;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet darkColor = this.tempColor2;\r\n\t\t\t\t\tif (slot.darkColor == null)\r\n\t\t\t\t\t\tdarkColor.set(0, 0, 0, 1.0);\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (premultipliedAlpha) {\r\n\t\t\t\t\t\t\tdarkColor.r = slot.darkColor.r * finalColor.a;\r\n\t\t\t\t\t\t\tdarkColor.g = slot.darkColor.g * finalColor.a;\r\n\t\t\t\t\t\t\tdarkColor.b = slot.darkColor.b * finalColor.a;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdarkColor.setFromColor(slot.darkColor);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdarkColor.a = premultipliedAlpha ? 1.0 : 0.0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet slotBlendMode = slot.data.blendMode;\r\n\t\t\t\t\tif (slotBlendMode != blendMode) {\r\n\t\t\t\t\t\tblendMode = slotBlendMode;\r\n\t\t\t\t\t\tbatcher.setBlendMode(WebGLBlendModeConverter.getSourceGLBlendMode(blendMode, premultipliedAlpha), WebGLBlendModeConverter.getDestGLBlendMode(blendMode));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (clipper.isClipping()) {\r\n\t\t\t\t\t\tclipper.clipTriangles(renderable.vertices, renderable.numFloats, triangles, triangles.length, uvs, finalColor, darkColor, twoColorTint);\r\n\t\t\t\t\t\tlet clippedVertices = new Float32Array(clipper.clippedVertices);\r\n\t\t\t\t\t\tlet clippedTriangles = clipper.clippedTriangles;\r\n\t\t\t\t\t\tif (this.vertexEffect != null) {\r\n\t\t\t\t\t\t\tlet vertexEffect = this.vertexEffect;\r\n\t\t\t\t\t\t\tlet verts = clippedVertices;\r\n\t\t\t\t\t\t\tif (!twoColorTint) {\r\n\t\t\t\t\t\t\t\tfor (let v = 0, n = clippedVertices.length; v < n; v += vertexSize) {\r\n\t\t\t\t\t\t\t\t\ttempPos.x = verts[v];\r\n\t\t\t\t\t\t\t\t\ttempPos.y = verts[v + 1];\r\n\t\t\t\t\t\t\t\t\ttempLight.set(verts[v + 2], verts[v + 3], verts[v + 4], verts[v + 5]);\r\n\t\t\t\t\t\t\t\t\ttempUv.x = verts[v + 6];\r\n\t\t\t\t\t\t\t\t\ttempUv.y = verts[v + 7];\r\n\t\t\t\t\t\t\t\t\ttempDark.set(0, 0, 0, 0);\r\n\t\t\t\t\t\t\t\t\tvertexEffect.transform(tempPos, tempUv, tempLight, tempDark);\r\n\t\t\t\t\t\t\t\t\tverts[v] = tempPos.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 1] = tempPos.y;\r\n\t\t\t\t\t\t\t\t\tverts[v + 2] = tempLight.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 3] = tempLight.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 4] = tempLight.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 5] = tempLight.a;\r\n\t\t\t\t\t\t\t\t\tverts[v + 6] = tempUv.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 7] = tempUv.y\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tfor (let v = 0, n = clippedVertices.length; v < n; v += vertexSize) {\r\n\t\t\t\t\t\t\t\t\ttempPos.x = verts[v];\r\n\t\t\t\t\t\t\t\t\ttempPos.y = verts[v + 1];\r\n\t\t\t\t\t\t\t\t\ttempLight.set(verts[v + 2], verts[v + 3], verts[v + 4], verts[v + 5]);\r\n\t\t\t\t\t\t\t\t\ttempUv.x = verts[v + 6];\r\n\t\t\t\t\t\t\t\t\ttempUv.y = verts[v + 7];\r\n\t\t\t\t\t\t\t\t\ttempDark.set(verts[v + 8], verts[v + 9], verts[v + 10], verts[v + 11]);\r\n\t\t\t\t\t\t\t\t\tvertexEffect.transform(tempPos, tempUv, tempLight, tempDark);\r\n\t\t\t\t\t\t\t\t\tverts[v] = tempPos.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 1] = tempPos.y;\r\n\t\t\t\t\t\t\t\t\tverts[v + 2] = tempLight.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 3] = tempLight.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 4] = tempLight.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 5] = tempLight.a;\r\n\t\t\t\t\t\t\t\t\tverts[v + 6] = tempUv.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 7] = tempUv.y\r\n\t\t\t\t\t\t\t\t\tverts[v + 8] = tempDark.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 9] = tempDark.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 10] = tempDark.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 11] = tempDark.a;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbatcher.draw(texture, clippedVertices, clippedTriangles);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet verts = renderable.vertices;\r\n\t\t\t\t\t\tif (this.vertexEffect != null) {\r\n\t\t\t\t\t\t\tlet vertexEffect = this.vertexEffect;\r\n\t\t\t\t\t\t\tif (!twoColorTint) {\r\n\t\t\t\t\t\t\t\tfor (let v = 0, u = 0, n = renderable.numFloats; v < n; v += vertexSize, u += 2) {\r\n\t\t\t\t\t\t\t\t\ttempPos.x = verts[v];\r\n\t\t\t\t\t\t\t\t\ttempPos.y = verts[v + 1];\r\n\t\t\t\t\t\t\t\t\ttempUv.x = uvs[u];\r\n\t\t\t\t\t\t\t\t\ttempUv.y = uvs[u + 1]\r\n\t\t\t\t\t\t\t\t\ttempLight.setFromColor(finalColor);\r\n\t\t\t\t\t\t\t\t\ttempDark.set(0, 0, 0, 0);\r\n\t\t\t\t\t\t\t\t\tvertexEffect.transform(tempPos, tempUv, tempLight, tempDark);\r\n\t\t\t\t\t\t\t\t\tverts[v] = tempPos.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 1] = tempPos.y;\r\n\t\t\t\t\t\t\t\t\tverts[v + 2] = tempLight.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 3] = tempLight.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 4] = tempLight.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 5] = tempLight.a;\r\n\t\t\t\t\t\t\t\t\tverts[v + 6] = tempUv.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 7] = tempUv.y\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tfor (let v = 0, u = 0, n = renderable.numFloats; v < n; v += vertexSize, u += 2) {\r\n\t\t\t\t\t\t\t\t\ttempPos.x = verts[v];\r\n\t\t\t\t\t\t\t\t\ttempPos.y = verts[v + 1];\r\n\t\t\t\t\t\t\t\t\ttempUv.x = uvs[u];\r\n\t\t\t\t\t\t\t\t\ttempUv.y = uvs[u + 1]\r\n\t\t\t\t\t\t\t\t\ttempLight.setFromColor(finalColor);\r\n\t\t\t\t\t\t\t\t\ttempDark.setFromColor(darkColor);\r\n\t\t\t\t\t\t\t\t\tvertexEffect.transform(tempPos, tempUv, tempLight, tempDark);\r\n\t\t\t\t\t\t\t\t\tverts[v] = tempPos.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 1] = tempPos.y;\r\n\t\t\t\t\t\t\t\t\tverts[v + 2] = tempLight.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 3] = tempLight.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 4] = tempLight.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 5] = tempLight.a;\r\n\t\t\t\t\t\t\t\t\tverts[v + 6] = tempUv.x;\r\n\t\t\t\t\t\t\t\t\tverts[v + 7] = tempUv.y\r\n\t\t\t\t\t\t\t\t\tverts[v + 8] = tempDark.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 9] = tempDark.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 10] = tempDark.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 11] = tempDark.a;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (!twoColorTint) {\r\n\t\t\t\t\t\t\t\tfor (let v = 2, u = 0, n = renderable.numFloats; v < n; v += vertexSize, u += 2) {\r\n\t\t\t\t\t\t\t\t\tverts[v] = finalColor.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 1] = finalColor.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 2] = finalColor.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 3] = finalColor.a;\r\n\t\t\t\t\t\t\t\t\tverts[v + 4] = uvs[u];\r\n\t\t\t\t\t\t\t\t\tverts[v + 5] = uvs[u + 1];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tfor (let v = 2, u = 0, n = renderable.numFloats; v < n; v += vertexSize, u += 2) {\r\n\t\t\t\t\t\t\t\t\tverts[v] = finalColor.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 1] = finalColor.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 2] = finalColor.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 3] = finalColor.a;\r\n\t\t\t\t\t\t\t\t\tverts[v + 4] = uvs[u];\r\n\t\t\t\t\t\t\t\t\tverts[v + 5] = uvs[u + 1];\r\n\t\t\t\t\t\t\t\t\tverts[v + 6] = darkColor.r;\r\n\t\t\t\t\t\t\t\t\tverts[v + 7] = darkColor.g;\r\n\t\t\t\t\t\t\t\t\tverts[v + 8] = darkColor.b;\r\n\t\t\t\t\t\t\t\t\tverts[v + 9] = darkColor.a;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet view = (renderable.vertices as Float32Array).subarray(0, renderable.numFloats);\r\n\t\t\t\t\t\tbatcher.draw(texture, view, triangles);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclipper.clipEndWithSlot(slot);\r\n\t\t\t}\r\n\t\t\tclipper.clipEnd();\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { TimeKeeper, Color } from \"../core/Utils\";\r\nimport { GLTexture } from \"./GLTexture\";\r\nimport { SceneRenderer, ResizeMode } from \"./SceneRenderer\";\r\n\r\n// module spine.webgl {\r\n\texport class LoadingScreen {\r\n\t\tstatic FADE_SECONDS = 1;\r\n\r\n\t\tprivate static loaded = 0;\r\n\t\tprivate static spinnerImg: HTMLImageElement = null;\r\n\t\tprivate static logoImg: HTMLImageElement = null;\r\n\r\n\t\tprivate renderer: SceneRenderer;\r\n\t\tprivate logo: GLTexture = null;\r\n\t\tprivate spinner: GLTexture = null;\r\n\t\tprivate angle = 0;\r\n\t\tprivate fadeOut = 0;\r\n\t\tprivate timeKeeper = new TimeKeeper();\r\n\t\tbackgroundColor = new Color(0.135, 0.135, 0.135, 1);\r\n\t\tprivate tempColor = new Color();\r\n\t\tprivate firstDraw = 0;\r\n\r\n\t\tprivate static SPINNER_DATA = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKMAAACjCAYAAADmbK6AAAAACXBIWXMAAAsTAAALEwEAmpwYAAALB2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNS41IChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTYtMDktMDhUMTQ6MjU6MTIrMDI6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTgtMTEtMTVUMTY6NDA6NTkrMDE6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE4LTExLTE1VDE2OjQwOjU5KzAxOjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpmZDhlNTljMC02NGJjLTIxNGQtODAyZi1jZDlhODJjM2ZjMGMiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDpmYmNmZWJlYS03MjY2LWE0NGQtOTI4NS0wOTJmNGNhYzk4ZWEiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHRpZmY6T3JpZW50YXRpb249IjEiIHRpZmY6WFJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpZUmVzb2x1dGlvbj0iNzIwMDAwLzEwMDAwIiB0aWZmOlJlc29sdXRpb25Vbml0PSIyIiBleGlmOkNvbG9yU3BhY2U9IjY1NTM1IiBleGlmOlBpeGVsWERpbWVuc2lvbj0iMjk3IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iMjQyIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiIHN0RXZ0OndoZW49IjIwMTYtMDktMDhUMTQ6MjU6MTIrMDI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1LjUgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiNThlMTlkNi0xYTRjLTQyNDEtODU0ZC01MDVlZjYxMjRhODQiIHN0RXZ0OndoZW49IjIwMTgtMTEtMTVUMTY6NDA6MjMrMDE6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjQ3YzYzYzIwLWJkYjgtYzM0YS1hYzMyLWQ5MDdjOWEyOTA0MCIgc3RFdnQ6d2hlbj0iMjAxOC0xMS0xNVQxNjo0MDo1OSswMTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY29udmVydGVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJmcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvcG5nIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJkZXJpdmVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJjb252ZXJ0ZWQgZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ZmQ4ZTU5YzAtNjRiYy0yMTRkLTgwMmYtY2Q5YTgyYzNmYzBjIiBzdEV2dDp3aGVuPSIyMDE4LTExLTE1VDE2OjQwOjU5KzAxOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo0N2M2M2MyMC1iZGI4LWMzNGEtYWMzMi1kOTA3YzlhMjkwNDAiIHN0UmVmOmRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo2OWRmZjljYy01YzFiLWE5NDctOTc3OS03ODgxZjM0ODk3MDMiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiLz4gPHBob3Rvc2hvcDpEb2N1bWVudEFu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\";\r\n\r\n\t\tprivate static SPINE_LOGO_DATA = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKUAAABsCAYAAAALzHKmAAAACXBIWXMAAAsTAAALEwEAmpwYAAALB2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNS41IChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTYtMDktMDhUMTQ6MjU6MTIrMDI6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTgtMTEtMTVUMTY6NDA6NTkrMDE6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE4LTExLTE1VDE2OjQwOjU5KzAxOjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowMTdhZGQ3Ni04OTZlLThlNGUtYmM5MS00ZjEyNjI1YjA3MjgiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDplMTViNGE2ZS1hMDg3LWEzNDktODdhOS1mNDYzYjE2MzQ0Y2MiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHRpZmY6T3JpZW50YXRpb249IjEiIHRpZmY6WFJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpZUmVzb2x1dGlvbj0iNzIwMDAwLzEwMDAwIiB0aWZmOlJlc29sdXRpb25Vbml0PSIyIiBleGlmOkNvbG9yU3BhY2U9IjY1NTM1IiBleGlmOlBpeGVsWERpbWVuc2lvbj0iMjk3IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iMjQyIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiIHN0RXZ0OndoZW49IjIwMTYtMDktMDhUMTQ6MjU6MTIrMDI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1LjUgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiNThlMTlkNi0xYTRjLTQyNDEtODU0ZC01MDVlZjYxMjRhODQiIHN0RXZ0OndoZW49IjIwMTgtMTEtMTVUMTY6NDA6MjMrMDE6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjJlNjJiMWM2LWIxYzQtNDk0MC04MDMxLWU4ZDkyNTBmODJjNSIgc3RFdnQ6d2hlbj0iMjAxOC0xMS0xNVQxNjo0MDo1OSswMTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY29udmVydGVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJmcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvcG5nIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJkZXJpdmVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJjb252ZXJ0ZWQgZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MDE3YWRkNzYtODk2ZS04ZTRlLWJjOTEtNGYxMjYyNWIwNzI4IiBzdEV2dDp3aGVuPSIyMDE4LTExLTE1VDE2OjQwOjU5KzAxOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoyZTYyYjFjNi1iMWM0LTQ5NDAtODAzMS1lOGQ5MjUwZjgyYzUiIHN0UmVmOmRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo2OWRmZjljYy01YzFiLWE5NDctOTc3OS03ODgxZjM0ODk3MDMiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiLz4gPHBob3Rvc2hvcDpEb2N1bWVudEFu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\"\r\n\r\n\t\tconstructor (renderer: SceneRenderer) {\r\n\t\t\tthis.renderer = renderer;\r\n\r\n\t\t\tthis.timeKeeper.maxDelta = 9;\r\n\r\n\t\t\tif (LoadingScreen.logoImg === null) {\r\n\t\t\t\t// thank you Apple Inc.\r\n\t\t\t\tlet isSafari = navigator.userAgent.indexOf(\"Safari\") > -1;\r\n\r\n\t\t\t\tLoadingScreen.logoImg = new Image();\r\n\t\t\t\tLoadingScreen.logoImg.src = LoadingScreen.SPINE_LOGO_DATA;\r\n\t\t\t\tif (!isSafari) LoadingScreen.logoImg.crossOrigin = \"anonymous\";\r\n\t\t\t\tLoadingScreen.logoImg.onload = (ev) => {\r\n\t\t\t\t\tLoadingScreen.loaded++;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tLoadingScreen.spinnerImg = new Image();\r\n\t\t\t\tLoadingScreen.spinnerImg.src = LoadingScreen.SPINNER_DATA;\r\n\t\t\t\tif (!isSafari) LoadingScreen.spinnerImg.crossOrigin = \"anonymous\";\r\n\t\t\t\tLoadingScreen.spinnerImg.onload = (ev) => {\r\n\t\t\t\t\tLoadingScreen.loaded++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdraw (complete = false) {\r\n\t\t\tif (complete && this.fadeOut > LoadingScreen.FADE_SECONDS) return;\r\n\r\n\t\t\tthis.timeKeeper.update();\r\n\t\t\tlet a = Math.abs(Math.sin(this.timeKeeper.totalTime + 0.75));\r\n\t\t\tthis.angle -= this.timeKeeper.delta / 1.4 * 360 * (1 + 1.5 * Math.pow(a, 5));\r\n\r\n\t\t\tlet renderer = this.renderer;\r\n\t\t\tlet canvas = renderer.canvas;\r\n\t\t\tlet gl = renderer.context.gl;\r\n\r\n\t\t\trenderer.resize(ResizeMode.Stretch);\r\n\r\n\t\t\tlet cam = renderer.camera;\r\n\t\t\t// let oldX = cam.position.x;\r\n\t\t\t// let oldY = cam.position.y;\r\n\t\t\t// let oldZ = cam.position.z;\r\n\t\t\t// cam.position.set(canvas.width / 2, canvas.height / 2, 0);\r\n\t\t\t// cam.viewportWidth = canvas.width;\r\n\t\t\t// cam.viewportHeight = canvas.height;\r\n\r\n\t\t\tif (!complete) {\r\n\t\t\t\tgl.clearColor(this.backgroundColor.r, this.backgroundColor.g, this.backgroundColor.b, this.backgroundColor.a);\r\n\t\t\t\tgl.clear(gl.COLOR_BUFFER_BIT);\r\n\t\t\t\tthis.tempColor.a = 1;\r\n\t\t\t} else {\r\n\t\t\t\tthis.fadeOut += this.timeKeeper.delta * (this.timeKeeper.totalTime < 1 ? 2 : 1);\r\n\t\t\t\tif (this.fadeOut > LoadingScreen.FADE_SECONDS) {\r\n\t\t\t\t\t// cam.position.set(oldX, oldY, oldZ);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\ta = 1 - this.fadeOut / LoadingScreen.FADE_SECONDS;\r\n\t\t\t\tthis.tempColor.setFromColor(this.backgroundColor);\r\n\t\t\t\tthis.tempColor.a = 1 - (a - 1) * (a - 1);\r\n\t\t\t\trenderer.begin();\r\n\t\t\t\tlet x = canvas.width / 2;\r\n\t\t\t\trenderer.quad(true, \r\n\t\t\t\t\t0-x, 0, \r\n\t\t\t\t\tcanvas.width-x, 0, \r\n\t\t\t\t\tcanvas.width-x, canvas.height, \r\n\t\t\t\t\t0-x, canvas.height,\r\n\t\t\t\t\tthis.tempColor, this.tempColor, this.tempColor, this.tempColor);\r\n\t\t\t\t// renderer.quad(true, \r\n\t\t\t\t// \t0, 0, \r\n\t\t\t\t// \tcanvas.width, 0, \r\n\t\t\t\t// \tcanvas.width, canvas.height, \r\n\t\t\t\t// \t0, canvas.height,\r\n\t\t\t\t// \tthis.tempColor, this.tempColor, this.tempColor, this.tempColor);\r\n\t\t\t\trenderer.end();\r\n\t\t\t}\r\n\t\t\tthis.tempColor.set(1, 1, 1, this.tempColor.a);\r\n\r\n\t\t\tif (LoadingScreen.loaded != 2) return;\r\n\t\t\tif (this.logo === null) {\r\n\t\t\t\tthis.logo = new GLTexture(renderer.context, LoadingScreen.logoImg);\r\n\t\t\t\tthis.spinner = new GLTexture(renderer.context, LoadingScreen.spinnerImg);\r\n\t\t\t}\r\n\t\t\tthis.logo.update(false);\r\n\t\t\tthis.spinner.update(false);\r\n\r\n\t\t\tlet logoWidth = this.logo.getImage().width;\r\n\t\t\tlet logoHeight = this.logo.getImage().height;\r\n\t\t\tlet spinnerWidth = this.spinner.getImage().width;\r\n\t\t\tlet spinnerHeight = this.spinner.getImage().height;\r\n\r\n\t\t\trenderer.batcher.setBlendMode(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n\t\t\trenderer.begin();\r\n\t\t\trenderer.drawTexture(this.logo,\r\n\t\t\t\t// (canvas.width - logoWidth) / 2,\r\n\t\t\t\t(-logoWidth) / 2,\r\n\t\t\t\t(canvas.height - logoHeight) / 2,\r\n\t\t\t\tlogoWidth, logoHeight,\r\n\t\t\t\tthis.tempColor\r\n\t\t\t);\r\n\t\t\trenderer.drawTextureRotated(\r\n\t\t\t\tthis.spinner, \r\n\t\t\t\t// (canvas.width - spinnerWidth) / 2, \r\n\t\t\t\t(-spinnerWidth) / 2, \r\n\t\t\t\t(canvas.height - spinnerHeight) / 2, \r\n\t\t\t\tspinnerWidth, spinnerHeight, \r\n\t\t\t\tspinnerWidth / 2, spinnerHeight / 2,\r\n\t\t\t\tthis.angle, \r\n\t\t\t\tthis.tempColor\r\n\t\t\t);\r\n\t\t\trenderer.end();\r\n\r\n\t\t\t// cam.position.set(oldX, oldY, oldZ);\r\n\t\t}\r\n\t}\r\n// }\r\n","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { SkeletonData } from \"./SkeletonData\";\r\nimport {Animation } from \"./Animation\";\r\nimport {Map } from \"./Utils\";\r\n\r\n// module spine {\r\n\r\n\t/** Stores mix (crossfade) durations to be applied when {@link AnimationState} animations are changed. */\r\n\texport class AnimationStateData {\r\n\t\t/** The SkeletonData to look up animations when they are specified by name. */\r\n\t\tskeletonData: SkeletonData;\r\n\r\n\t\tanimationToMixTime: Map<number> = { };\r\n\r\n\t\t/** The mix duration to use when no mix duration has been defined between two animations. */\r\n\t\tdefaultMix = 0;\r\n\r\n\t\tconstructor (skeletonData: SkeletonData) {\r\n\t\t\tif (skeletonData == null) throw new Error(\"skeletonData cannot be null.\");\r\n\t\t\tthis.skeletonData = skeletonData;\r\n\t\t}\r\n\r\n\t\t/** Sets a mix duration by animation name.\r\n\t\t *\r\n\t\t * See {@link #setMixWith()}. */\r\n\t\tsetMix (fromName: string, toName: string, duration: number) {\r\n\t\t\tlet from = this.skeletonData.findAnimation(fromName);\r\n\t\t\tif (from == null) throw new Error(\"Animation not found: \" + fromName);\r\n\t\t\tlet to = this.skeletonData.findAnimation(toName);\r\n\t\t\tif (to == null) throw new Error(\"Animation not found: \" + toName);\r\n\t\t\tthis.setMixWith(from, to, duration);\r\n\t\t}\r\n\r\n\t\t/** Sets the mix duration when changing from the specified animation to the other.\r\n\t\t *\r\n\t\t * See {@link TrackEntry#mixDuration}. */\r\n\t\tsetMixWith (from: Animation, to: Animation, duration: number) {\r\n\t\t\tif (from == null) throw new Error(\"from cannot be null.\");\r\n\t\t\tif (to == null) throw new Error(\"to cannot be null.\");\r\n\t\t\tlet key = from.name + \".\" + to.name;\r\n\t\t\tthis.animationToMixTime[key] = duration;\r\n\t\t}\r\n\r\n\t\t/** Returns the mix duration to use when changing from the specified animation to the other, or the {@link #defaultMix} if\r\n\t \t* no mix duration has been set. */\r\n\t\tgetMix (from: Animation, to: Animation) {\r\n\t\t\tlet key = from.name + \".\" + to.name;\r\n\t\t\tlet value = this.animationToMixTime[key];\r\n\t\t\treturn value === undefined ? this.defaultMix : value;\r\n\t\t}\r\n\t}\r\n// }\r\n","import { Vector2 } from \"../core/Utils\";\r\nimport { Vector3 } from \"../webgl/Vector3\";\r\nimport { Actor } from \"./Actor\";\r\nimport { BoundingBox } from \"./Player\";\r\n\r\n    export class ActionName {\r\n        static PLAY_ANIMATION = \"PLAY_ANIMATION\";\r\n        static WANDER = \"WANDER\";\r\n        static WALK_TO = \"WALK_TO\";\r\n        static PACE_AROUND = \"PACE_AROUND\";\r\n    }\r\n\r\n    export interface ActorAction {\r\n        SetAnimation(actor: Actor, animation: string, viewport: BoundingBox): void;\r\n        GetAnimations(): string[]\r\n        UpdatePhysics(actor: Actor, deltaSecs: number, viewport: BoundingBox): void\r\n    }\r\n\r\n    export function ParseActionNameToAction(actionName: string, actionData: any): ActorAction {\r\n        switch (actionName) {\r\n            case ActionName.PLAY_ANIMATION:\r\n                return new PlayAnimationAction(actionData);\r\n            case ActionName.WANDER:\r\n                return new WanderAction(actionData);\r\n            case ActionName.WALK_TO:\r\n                return new WalkToAction(actionData);\r\n            case ActionName.PACE_AROUND:\r\n                return new PaceAroundAction(actionData);\r\n            default:\r\n                console.log(\"Unknown action name \", actionName);\r\n                return null;\r\n        }\r\n    }\r\n\r\n    function setActorYPositionByAnimation(actor: Actor, animation:string, viewport: BoundingBox) {\r\n        const startPosYScaled = actor.config.startPosY * viewport.height;\r\n        actor.setPositionY(startPosYScaled);\r\n        let isSitting = animation.toLowerCase().includes(\"sit\")\r\n\r\n        if (actor.canvasBB.y < 0) {\r\n            // There is some sprite above the axis\r\n            if (actor.IsEnemySprite()) {\r\n                actor.setPositionY(startPosYScaled - actor.canvasBB.y);\r\n            } else if (isSitting) {\r\n                actor.setPositionY(startPosYScaled - actor.canvasBB.y);\r\n            }\r\n        } else if(actor.canvasBB.y > 0) {\r\n            // There is some sprite below the axis\r\n            if (actor.IsEnemySprite()) {\r\n                actor.setPositionY(startPosYScaled - actor.canvasBB.y);\r\n            }   \r\n        }\r\n    }\r\n\r\n    export class PlayAnimationAction implements ActorAction {\r\n        public actionData: any\r\n        public startPosition: Vector2\r\n        public endPosition: Vector2\r\n        public currentAnimation: string\r\n\r\n        constructor(actionData: any) {\r\n            this.actionData = actionData\r\n            this.currentAnimation = null;\r\n            this.endPosition = null;\r\n        }\r\n\r\n        getRandomPosition(currentPos: Vector2, viewport: BoundingBox): Vector2 {\r\n            let half = viewport.width / 2;\r\n            let rand = Math.random();\r\n            return new Vector2(rand * viewport.width - half, currentPos.y);\r\n        }\r\n\r\n        SetAnimation(actor: Actor, animation: string, viewport: BoundingBox) {\r\n            setActorYPositionByAnimation(actor, animation, viewport)\r\n            \r\n            this.currentAnimation = animation;\r\n            if (this.currentAnimation.includes(\"Move\")) {\r\n                this.startPosition = null;\r\n                this.endPosition = null;\r\n            }\r\n        }\r\n\r\n        GetAnimations(): string[] {\r\n            return this.actionData[\"animations\"];\r\n        }\r\n\r\n        UpdatePhysics(actor: Actor, deltaSecs: number, viewport: BoundingBox) {\r\n            if (!this.currentAnimation.includes(\"Move\")) {\r\n                actor.setVelocity(0, 0, 0);\r\n            } else {\r\n                if (this.endPosition == null) {\r\n                    this.startPosition = actor.getPosition();\r\n                    this.endPosition = this.getRandomPosition(actor.getPosition(), viewport);\r\n                }\r\n\r\n                let dir = this.endPosition.subtract(actor.getPosition());\r\n                if (dir.length() < 5) {\r\n                    // We have reached the target position. Find a new destination\r\n                    actor.setPosition(this.endPosition.x, this.endPosition.y, 0);\r\n                    this.startPosition = actor.getPosition();\r\n                    this.endPosition = this.getRandomPosition(actor.getPosition(), viewport);\r\n                }\r\n                dir.normalize();\r\n                actor.setVelocity(\r\n                    dir.x * actor.getMovementSpeedX() * deltaSecs,\r\n                    dir.y * actor.getMovementSpeedY() * deltaSecs,\r\n                    0\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    export class WanderAction implements ActorAction {\r\n        public actionData: any\r\n        public startPosition: Vector2 = null;\r\n        public endPosition: Vector2 = null;\r\n\r\n        constructor(actionData: any) {\r\n            this.actionData = actionData\r\n            this.startPosition = null;\r\n            this.endPosition = null;\r\n        }\r\n\r\n        getRandomPosition(currentPos: Vector2, viewport: BoundingBox): Vector2 {\r\n            let half = viewport.width / 2;\r\n            return new Vector2(Math.random() * viewport.width - half, currentPos.y);\r\n        }\r\n\r\n        SetAnimation(actor: Actor, animation: string, viewport: BoundingBox) {\r\n            // TODO: Figure out what this for walking, wander, pace-around actions\r\n            // I know for playAnimation it is used to reset from a sit position\r\n            // actor.setPositionY(actor.config.startPosY * viewport.height);\r\n            setActorYPositionByAnimation(actor, animation, viewport)\r\n        }\r\n\r\n        GetAnimations(): string[] {\r\n            return [this.actionData[\"wander_animation\"]];\r\n        }\r\n\r\n        UpdatePhysics(actor: Actor, deltaSecs: number, viewport: BoundingBox) {\r\n            if (this.endPosition == null) {\r\n                this.startPosition = actor.getPosition();\r\n                this.endPosition = this.getRandomPosition(actor.getPosition(), viewport);\r\n            }\r\n\r\n            let dir = this.endPosition.subtract(actor.getPosition());\r\n            if (dir.length() < 5) {\r\n                // We have reached the target position. Find a new destination\r\n                actor.setPosition(this.endPosition.x, this.endPosition.y, 0);\r\n                this.startPosition = actor.getPosition();\r\n                this.endPosition = this.getRandomPosition(actor.getPosition(), viewport);\r\n            }\r\n            dir.normalize();\r\n            actor.setVelocity(\r\n                dir.x * actor.getMovementSpeedX() * deltaSecs,\r\n                dir.y * actor.getMovementSpeedY() * deltaSecs,\r\n                0\r\n            );\r\n        }\r\n    }\r\n\r\n\r\n    export class WalkToAction implements ActorAction {\r\n        public actionData: any\r\n        public startPosition: Vector2 = null;\r\n        public endPosition: Vector2 = null;\r\n        public startDir: Vector2 = null;\r\n        public reachedDestination: boolean;\r\n\r\n        constructor(actionData: any) {\r\n            this.actionData = actionData;\r\n            this.startPosition = null;\r\n            this.endPosition = null;\r\n            this.startDir = null;\r\n            this.reachedDestination = false;\r\n        }\r\n\r\n        SetAnimation(actor: Actor, animation: string, viewport: BoundingBox) {\r\n            setActorYPositionByAnimation(actor, animation, viewport);\r\n        }\r\n\r\n        GetAnimations(): string[] {\r\n            if (this.reachedDestination) {\r\n                return [this.actionData[\"walk_to_final_animation\"]];\r\n            } else {\r\n                return [this.actionData[\"walk_to_animation\"]];\r\n            }\r\n        }\r\n\r\n        UpdatePhysics(actor: Actor, deltaSecs: number, viewport: BoundingBox) {\r\n            if (this.reachedDestination) {\r\n                return;\r\n            }\r\n\r\n            if (this.endPosition == null) {\r\n                this.startPosition = actor.getPosition();\r\n                let target = new Vector2(\r\n                    this.actionData[\"target_pos\"][\"x\"],\r\n                    this.actionData[\"target_pos\"][\"y\"],\r\n                );\r\n                this.endPosition = new Vector2(\r\n                    target.x * viewport.width - (viewport.width / 2),\r\n                    0,\r\n                );\r\n                this.startDir = this.endPosition.subtract(this.startPosition);\r\n                if (this.startDir.length() < 10) {\r\n                    this.reachedDestination = true;\r\n                }\r\n                this.startDir = this.startDir.normalize()\r\n            }\r\n\r\n            let dir = this.endPosition.subtract(actor.getPosition()).normalize();\r\n            let angle = this.startDir.angle(dir);\r\n            let reached = Math.abs(Math.PI - angle) < 0.001;\r\n            if (reached || this.reachedDestination) {\r\n                // We have reached the target destination\r\n                actor.setPosition(this.endPosition.x, this.endPosition.y, 0);\r\n                this.startPosition = actor.getPosition();\r\n                actor.setVelocity(0, 0, 0);\r\n                this.reachedDestination = true;\r\n                actor.InitAnimationState();\r\n            } else {\r\n                actor.setVelocity(\r\n                    dir.x * actor.getMovementSpeedX() * deltaSecs,\r\n                    dir.y * actor.getMovementSpeedY() * deltaSecs,\r\n                    0\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    export class PaceAroundAction implements ActorAction {\r\n        public actionData: any\r\n        public startPosition: Vector3 = null;\r\n        public endPosition: Vector3 = null;\r\n        public reachedDestination: boolean;\r\n\r\n        constructor(actionData: any) {\r\n            this.actionData = actionData;\r\n            this.startPosition = null;\r\n            this.endPosition = null;\r\n            this.reachedDestination = false;\r\n        }\r\n\r\n        SetAnimation(actor: Actor, animation: string, viewport: BoundingBox) {\r\n            setActorYPositionByAnimation(actor, animation, viewport);\r\n        }\r\n\r\n        GetAnimations(): string[] {\r\n            return [this.actionData[\"pace_around_animation\"]];\r\n        }\r\n\r\n        UpdatePhysics(actor: Actor, deltaSecs: number, viewport: BoundingBox) {\r\n            if (this.reachedDestination) {\r\n                this.reachedDestination = false;\r\n\r\n                // Swap the positions\r\n                let tempPosition = this.startPosition;\r\n                this.startPosition = this.endPosition;\r\n                this.endPosition = tempPosition;\r\n                return;\r\n            }\r\n\r\n            if (this.endPosition == null) {\r\n                // TODO: Make the z range configurable\r\n                let z1 = Math.random() * 40;\r\n                let z2 = Math.random() * 40;\r\n                let start = new Vector3(\r\n                    this.actionData[\"pace_start_pos\"][\"x\"],\r\n                    this.actionData[\"pace_start_pos\"][\"y\"],\r\n                    z1\r\n                )\r\n                let target = new Vector3(\r\n                    this.actionData[\"pace_end_pos\"][\"x\"],\r\n                    this.actionData[\"pace_end_pos\"][\"y\"],\r\n                    z2\r\n                );\r\n                this.startPosition = new Vector3(\r\n                    start.x * viewport.width - (viewport.width / 2),\r\n                    start.y * viewport.height,\r\n                    start.z\r\n                )\r\n                this.endPosition = new Vector3(\r\n                    target.x * viewport.width - (viewport.width / 2),\r\n                    target.y * viewport.height,\r\n                    target.z\r\n                );\r\n                let temp = this.endPosition.copy();\r\n                if (temp.sub(actor.getPosition3()).length() < 10) {\r\n                    this.reachedDestination = true;\r\n                }\r\n            }\r\n            // TODO: Figure out a better way of handling if we have reached an end position.\r\n            let dir = this.endPosition.copy().sub(actor.getPosition3()).normalize();\r\n            let dist_to = this.endPosition.copy().sub(actor.getPosition3()).length();\r\n            if (dist_to < 10 || this.reachedDestination) {\r\n                // We have reached the target destination\r\n                actor.setPosition(this.endPosition.x, this.endPosition.y, this.endPosition.z);\r\n                actor.setVelocity(0, 0, 0);\r\n                this.reachedDestination = true;\r\n            } else {\r\n                actor.setVelocity(\r\n                    dir.x * actor.getMovementSpeedX() * deltaSecs,\r\n                    dir.y * actor.getMovementSpeedY() * deltaSecs,\r\n                    dir.z * actor.getMovementSpeedZ() * deltaSecs\r\n                )\r\n            }\r\n        }\r\n    }","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport { AnimationStateListener, AnimationState, TrackEntry } from \"../core/AnimationState\"\r\nimport { AnimationStateData } from \"../core/AnimationStateData\"\r\nimport { Skeleton } from \"../core/Skeleton\"\r\nimport { Vector2, TimeKeeper, Map } from \"../core/Utils\"\r\nimport { Vector3 } from \"../webgl/Vector3\"\r\nimport { ActorAction, ParseActionNameToAction } from \"./Action\"\r\nimport { SpinePlayer, BoundingBox } from \"./Player\"\r\nimport { Event } from \"../core/Event\"\r\nimport { OffscreenRender } from \"./Utils\"\r\n\r\n// // module spine {\r\n\r\n    export interface ActorUpdateConfig {\r\n        start_pos: Vector2\r\n        dest_pos: Vector2\r\n        loop_positions: boolean\r\n        wander: boolean\r\n        animation: string\r\n    }\r\n\r\n\texport interface SpineActorConfig {\r\n\t\t/* the URL of the skeleton .json file */\r\n\t\tjsonUrl?: string\r\n\r\n\t\t/* the URL of the skeleton .skel file */\r\n\t\tskelUrl: string\r\n\r\n\t\t/* the URL of the skeleton .atlas file. Atlas page images are automatically resolved. */\r\n\t\tatlasUrl: string\r\n\r\n\t\t/* Raw data URIs, mapping from a path to base 64 encoded raw data. When the player\r\n\t\t   resolves a path of the `jsonUrl`, `skelUrl`, `atlasUrl`, or the image paths\r\n\t\t   referenced in the atlas, it will first look for that path in this array of\r\n\t\t   raw data URIs. This allows embedding of resources directly in HTML/JS. */\r\n\t\trawDataURIs?: Map<string>\r\n\r\n\t\t/* Optional: the default mix time used to switch between two animations. */\r\n\t\tdefaultMix?: number\r\n\r\n\t\t/* Optional: the name of the skin to be set. Default: the default skin. */\r\n\t\tskin?: string\r\n\r\n\t\t/* Optional: list of skin names from which the user can choose. */\r\n\t\tskins?: string[]\r\n\r\n\t\t/* Optional: whether the skeleton uses premultiplied alpha. Default: true. */\r\n\t\tpremultipliedAlpha: boolean\r\n\r\n\t\t/** Optional: Animation play speed. 0 to 3.0 */\r\n\t\tanimationPlaySpeed: number,\r\n\r\n\t\tconfigScaleX: number\r\n\t\tconfigScaleY: number\r\n\t\tscaleX: number\r\n\t\tscaleY: number\r\n\t\tmaxSizePx: number\r\n\t\tstartPosX : number\r\n\t\tstartPosY : number\r\n\t\t// Specify extra offset in Pixel for X and Y to fit the chibi on the screen\r\n\t\textraOffsetX: number,\r\n\t\textraOffsetY: number,\r\n\r\n\t\tdefaultMovementSpeedPxX: number,\r\n\t\tdefaultMovementSpeedPxY: number,\r\n\t\tdefaultMovementSpeedPxZ: number,\r\n\t\tmovementSpeedPxX: number,\r\n\t\tmovementSpeedPxY: number,\r\n\t\tmovementSpeedPxZ: number,\r\n\r\n\t\t// Unused?\r\n\t\tdefaultScaleX?: number\r\n\t\tdefaultScaleY?: number\r\n\r\n\t\t/* Optional: the background image. Default: none. */\r\n\t\tbackgroundImage?: {\r\n\t\t\t/* The URL of the background image */\r\n\t\t\turl: string\r\n\r\n\t\t\t/* Optional: the position and size of the background image in world coordinates. Default: viewport. */\r\n\t\t\tx: number\r\n\t\t\ty: number\r\n\t\t\twidth: number\r\n\t\t\theight: number\r\n\t\t}\r\n\r\n\t\t// /* Optional: the background color used in fullscreen mode. Must be given in the format #rrggbbaa. Default: backgroundColor. */\r\n\t\t// fullScreenBackgroundColor: string\r\n\r\n\t\t// /* Optional: list of bone names that the user can control by dragging. */\r\n\t\t// controlBones: string[]\r\n\r\n\t\t/* Optional: callback when the widget and its assets have been successfully loaded. */\r\n\t\tsuccess?: (widget: SpinePlayer, actor: Actor) => void\r\n\r\n\t\t/* Optional: callback when the widget could not be loaded. */\r\n\t\terror?: (widget: SpinePlayer, actor: Actor, msg: string) => void\r\n\r\n\t\t/** Optional: Callbacks for the animations */\r\n\t\tanimation_listener?: AnimationStateListener\r\n\r\n\t\t/** char_002_amiya, enemy_1526_sfsui, etc */\r\n\t\tchibiId: string,\r\n\t\tuserDisplayName: string,\r\n\r\n\t\t/** Required: action name */\r\n\t\taction: string\r\n\t\t/** Required: A json object of the action data */\r\n\t\taction_data: any\r\n\t}\r\n\r\n\r\n\texport class Actor {\r\n\t\tpublic loaded: boolean;\r\n\t\tpublic skeleton: Skeleton;\r\n\t\tpublic animationState: AnimationState;\r\n\t\tpublic time = new TimeKeeper();\r\n\t\tpublic paused = false;\r\n\t\tpublic playTime = 0;\r\n\t\tpublic speed = 1;\r\n\t\tpublic config: SpineActorConfig;\r\n\t\tpublic lastAnimation: string = null;\r\n\t\t// public animations: string[]\r\n\r\n\t\tpublic viewport: BoundingBox = null;\r\n\t\tpublic canvasBB: BoundingBox = null;\r\n\t\tpublic canvasBBCalculated:number = 0;\r\n\t\tprivate offscreenRender: OffscreenRender = null;\r\n\r\n\t\t// Velocity is in world coordinates (pixels/second)\r\n\t\t// TODO: Abstract out this position/movement/speed data into a seperate class\r\n\t\t// TODO: Create our own vector3 class\r\n\t\tprivate movementSpeed: Vector3 = new Vector3();\r\n\t\t// Position is in world coordinates (with dimensions same as viewport)\r\n\t\t//   x-axis is 0 in center of the screen\r\n\t\t//   and y-axis is 0 at the bottom of the screen.\r\n\t\t// We use these coordinates compared to top-left corner.\r\n\t\tprivate position: Vector3 = new Vector3();\r\n\t\tpublic scale: Vector2 = new Vector2(1,1);\r\n\t\tprivate velocity: Vector3 = new Vector3(0, 0, 0);\r\n\t\tpublic startPosition: Vector2 = null;\r\n\t\tpublic currentAction: ActorAction = null;\r\n\r\n\t\t// Actor loading retry logic\r\n\t\tpublic load_attempts: number = 0;\r\n\t\tpublic max_load_attempts: number = 10;\r\n\t\tpublic load_perma_failed: boolean = false;\r\n\t\t// Record the timestamp when the actor was first loaded. We use this\r\n\t\t// to keep a stable sort order when rendering actors. Actors created\r\n\t\t// first should be rendered first, newer actors are rendered on top.\r\n\t\tpublic loadedWhen: number = new Date().getTime();\r\n\t\t\r\n\r\n\t\tconstructor(config: SpineActorConfig, viewport: BoundingBox, offscreenRender: OffscreenRender) {\r\n\t\t\tthis.offscreenRender = offscreenRender;\r\n\t\t\tthis.loadedWhen = new Date().getTime();\r\n\t\t\tthis.viewport = viewport;\r\n\t\t\tthis.ResetWithConfig(config);\r\n\t\t\tlet x = Math.random()*viewport.width - (viewport.width/2)\r\n\t\t\tlet z = 0;\r\n\t\t\tthis.position = new Vector3(x, 0, z);\r\n\r\n\t\t\tif (config.startPosX != null || config.startPosY != null) {\r\n\t\t\t\tthis.position = new Vector3(\r\n\t\t\t\t\t(config.startPosX* viewport.width) - (viewport.width/2),\r\n\t\t\t\t\t(config.startPosY * viewport.height),\r\n\t\t\t\t\tz\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\tpublic getRenderingBoundingBox(): BoundingBox {\r\n\t\t\tif (this.canvasBB) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: this.canvasBB.x,\r\n\t\t\t\t\ty: this.canvasBB.y,\r\n\t\t\t\t\twidth: this.canvasBB.width,\r\n\t\t\t\t\theight: this.canvasBB.height\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: 0,\r\n\t\t\t\t\ty: 0,\r\n\t\t\t\t\twidth: this.viewport.width/10,\r\n\t\t\t\t\theight: this.viewport.height/10,\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic getPosition(): Vector2 {\r\n\t\t\treturn new Vector2(\r\n\t\t\t\tthis.position.x,\r\n\t\t\t\tthis.position.y\r\n\t\t\t);\r\n\t\t}\r\n\t\tpublic getPosition3(): Vector3 {\r\n\t\t\treturn new Vector3(\r\n\t\t\t\tthis.position.x,\r\n\t\t\t\tthis.position.y,\r\n\t\t\t\tthis.position.z\r\n\t\t\t);\r\n\t\t}\r\n\t\tpublic getPositionX(): number {\r\n\t\t\treturn this.position.x;\r\n\t\t}\r\n\t\tpublic getPositionY(): number {\r\n\t\t\treturn this.position.y;\r\n\t\t}\r\n\t\tpublic getPositionZ(): number {\r\n\t\t\treturn this.position.z;\r\n\t\t}\r\n\t\tpublic setPositionX(x: number) {\r\n\t\t\tthis.position.x = x;\r\n\t\t}\r\n\t\tpublic setPositionY(y: number) {\r\n\t\t\tthis.position.y = y;\r\n\t\t}\r\n\t\tpublic setPositionZ(z: number) {\r\n\t\t\tthis.position.z = z;\r\n\t\t}\r\n\t\tpublic setPosition(x: number, y: number, z ?:number) {\r\n\t\t\tthis.position.x = x;\r\n\t\t\tthis.position.y = y;\r\n\t\t\tthis.position.z = z !== undefined ? z : 0;\r\n\t\t}\r\n\r\n\t\tpublic getMovmentSpeed(): Vector2 {\r\n\t\t\treturn new Vector2(\r\n\t\t\t\tthis.movementSpeed.x,\r\n\t\t\t\tthis.movementSpeed.y\r\n\t\t\t);\r\n\t\t}\r\n\t\tpublic getMovmentSpeed3(): Vector3 {\r\n\t\t\treturn new Vector3(\r\n\t\t\t\tthis.movementSpeed.x,\r\n\t\t\t\tthis.movementSpeed.y,\r\n\t\t\t\tthis.movementSpeed.z\r\n\t\t\t);\r\n\t\t}\r\n\t\tpublic getMovementSpeedX(): number {\r\n\t\t\treturn this.movementSpeed.x;\r\n\t\t}\r\n\t\tpublic getMovementSpeedY(): number {\r\n\t\t\treturn this.movementSpeed.y;\r\n\t\t}\r\n\t\tpublic getMovementSpeedZ(): number {\r\n\t\t\treturn this.movementSpeed.z;\r\n\t\t}\r\n\t\tpublic setMovementSpeedX(x: number) {\r\n\t\t\tthis.movementSpeed.x = x;\r\n\t\t}\r\n\t\tpublic setMovementSpeedY(y: number) {\r\n\t\t\tthis.movementSpeed.y = y;\r\n\t\t}\r\n\t\tpublic setMovementSpeedZ(z: number) {\r\n\t\t\tthis.movementSpeed.z = z;\r\n\t\t}\r\n\t\tpublic setMovementSpeed(x: number, y: number, z ?: number) {\t\t\t\r\n\t\t\tthis.movementSpeed.x = x;\r\n\t\t\tthis.movementSpeed.y = y;\r\n\t\t\tthis.movementSpeed.z = z !== undefined ? z : this.config.defaultMovementSpeedPxZ;\r\n\t\t}\r\n\r\n\t\tpublic getVelocity(): Vector2 {\r\n\t\t\treturn new Vector2(\r\n\t\t\t\tthis.velocity.x,\r\n\t\t\t\tthis.velocity.y\r\n\t\t\t)\r\n\t\t}\r\n\t\tpublic getVelocity3(): Vector3 {\r\n\t\t\treturn new Vector3(\r\n\t\t\t\tthis.velocity.x,\r\n\t\t\t\tthis.velocity.y,\r\n\t\t\t\tthis.velocity.z\r\n\t\t\t)\r\n\t\t}\r\n\t\tpublic setVelocity(x?: number, y ?: number, z ?: number) {\r\n\t\t\tthis.velocity = new Vector3(\r\n\t\t\t\tx != undefined ? x : this.velocity.x,\r\n\t\t\t\ty != undefined ? y : this.velocity.y,\r\n\t\t\t\tz != undefined ? z : this.velocity.z\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tpublic InitAnimations() {\r\n\t\t\tthis.initAnimationsInternal(this.currentAction.GetAnimations());\r\n\t\t}\r\n\r\n\t\tpublic GetAnimations(): string[] {\r\n\t\t\treturn this.currentAction.GetAnimations()\r\n\t\t}\r\n\r\n\t\tpublic ResetWithConfig(config: SpineActorConfig) {\r\n\t\t\tthis.load_attempts = 0;\r\n\t\t\tthis.load_perma_failed = false;\r\n\r\n\t\t\tthis.loaded = false;\r\n\t\t\tthis.canvasBBCalculated = 0;\r\n\t\t\tthis.skeleton = null;\r\n\t\t\tthis.animationState = null;\r\n\t\t\tthis.time = new TimeKeeper();\r\n\t\t\tthis.paused = false;\r\n\t\t\tthis.playTime = 0;\r\n\t\t\tthis.speed = 1;\r\n\t\t\tthis.config = config;\r\n\r\n\t\t\t// Update movement speed from config\r\n\t\t\tif (config.movementSpeedPxX !== null \r\n\t\t\t\t&& config.movementSpeedPxY !== null\r\n\t\t\t\t&& config.movementSpeedPxZ !== null) {\r\n\t\t\t\tthis.movementSpeed = new Vector3(\r\n\t\t\t\t\tconfig.movementSpeedPxX, \r\n\t\t\t\t\tconfig.movementSpeedPxY,\r\n\t\t\t\t\tconfig.movementSpeedPxZ,\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthis.movementSpeed = new Vector3(\r\n\t\t\t\t\tconfig.defaultMovementSpeedPxX + Math.random()*config.defaultMovementSpeedPxX/2,\r\n\t\t\t\t\tconfig.defaultMovementSpeedPxY,\r\n\t\t\t\t\tconfig.defaultMovementSpeedPxZ,\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// current bearing should be kept the same, event as we change\r\n\t\t\t// the configuration/animation\r\n\t\t\tthis.scale.x = Math.sign(this.scale.x) * config.scaleX;\r\n\t\t\tthis.scale.y = Math.sign(this.scale.y) * config.scaleY;\r\n\r\n\t\t\tthis.currentAction = ParseActionNameToAction(\r\n\t\t\t\tthis.config.action,\r\n\t\t\t\tthis.config.action_data\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tpublic UpdatePhysics(deltaSecs: number, viewport: BoundingBox) {\r\n\t\t\tthis.currentAction.UpdatePhysics(this, deltaSecs, viewport);\r\n\t\t\tthis.position.x += this.velocity.x;\r\n\t\t\tthis.position.y += this.velocity.y;\r\n\t\t\tthis.position.z += this.velocity.z;\r\n\r\n\t\t\t// Make the Actor face right or left depending on velocity\r\n\t\t\tif (this.velocity.x != 0) {\r\n\t\t\t\tif (this.velocity.x > 0) {\r\n\t\t\t\t\tthis.scale.x = this.config.scaleX;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.scale.x = -this.config.scaleX;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.setSkeletonMovementData(viewport);\r\n\t\t}\r\n\r\n\t\tpublic InitAnimationState() {\r\n\t\t\tlet skeletonData = this.skeleton.data;\r\n\t\t\tlet stateData = new AnimationStateData(skeletonData);\r\n\t\t\tstateData.defaultMix = this.config.defaultMix;\r\n\t\t\tthis.animationState = new AnimationState(stateData);\r\n\t\t\tif (this.config.animation_listener) {\r\n\t\t\t\tthis.animationState.clearListeners();\r\n\t\t\t\tthis.animationState.addListener(this.config.animation_listener);\r\n\t\t\t}\r\n\t\t\tif(this.GetAnimations()) {\r\n\t\t\t\t// TODO: Verify all the animations are found in the skeleton data\r\n\t\t\t\tif (this.animationState) {\r\n\t\t\t\t\tif (!this.animationState.getCurrent(0)) {\r\n\t\t\t\t\t\tthis.InitAnimations();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic GetUsernameHeaderHeight() {\r\n\t\t\tlet renderBB = this.getRenderingBoundingBox();\r\n\t\t\treturn renderBB.height + renderBB.y + 20;\r\n\t\t}\r\n\t\tpublic IsEnemySprite(): boolean {\r\n\t\t\treturn this.config.chibiId.startsWith(\"enemy_\");\r\n\t\t}\r\n\t\tpublic IsOperatorSitting(): boolean {\r\n\t\t\tlet animations = this.GetAnimations();\r\n\t\t\treturn (\r\n\t\t\t\t!this.IsEnemySprite()\r\n\t\t\t\t&& animations[0].toLowerCase().includes(\"sit\") \r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Privates\r\n\t\t// ---------------------------------------------------------------------\r\n\r\n\t\tprivate setSkeletonMovementData(viewport: BoundingBox) {\r\n\t\t\tthis.skeleton.x = this.position.x + this.config.extraOffsetX;\r\n\t\t\tthis.skeleton.y = this.position.y + this.config.extraOffsetY;\r\n\t\t\tthis.skeleton.scaleX = this.scale.x;\r\n\t\t\tthis.skeleton.scaleY = this.scale.y;\r\n\t\t}\r\n\r\n\t\tprivate recordAnimation(animation: string) {\r\n\t\t\tthis.currentAction.SetAnimation(this, animation, this.viewport);\r\n\t\t\tthis.lastAnimation = animation;\r\n\t\t}\r\n\r\n\t\tprivate initAnimationsInternal(animations: string[]) {\r\n\t\t\tthis.setAnimationState(animations);\r\n\t\t\tthis.recordAnimation(animations[0]);\r\n\t\t\t\t\t\t\r\n\t\t\t// Resize very large chibis to more reasonable sizes\r\n\t\t\tlet width = this.canvasBB.width;\r\n\t\t\tlet height = this.canvasBB.height;\r\n\t\t\tif (width > this.config.maxSizePx || height > this.config.maxSizePx) {\r\n\t\t\t\tconsole.log(\"Resizing actor\", this.config.chibiId, \"to\", this.config.maxSizePx);\r\n\t\t\t\tlet ratio = width / height;\r\n\r\n\t\t\t\tlet xNew = 0;\r\n\t\t\t\tlet yNew = 0;\r\n\t\t\t\tif (height > width) {\r\n\t\t\t\t\txNew = ratio * this.config.maxSizePx;\r\n\t\t\t\t\tyNew = this.config.maxSizePx;\r\n\t\t\t\t} else {\r\n\t\t\t\t\txNew = this.config.maxSizePx;\r\n\t\t\t\t\tyNew = this.config.maxSizePx / ratio;\r\n\t\t\t\t}\r\n\t\t\t\tlet newScaleX = (xNew * this.config.scaleX) / width;\r\n\t\t\t\tlet newScaleY = (yNew * this.config.scaleY) / height;\r\n\t\t\t\t\r\n\t\t\t\t// TODO: setting defaultScale is a bug. We need to save it only once\r\n\t\t\t\tthis.config.defaultScaleX = this.config.scaleX;\r\n\t\t\t\tthis.config.defaultScaleY = this.config.scaleY;\r\n\t\t\t\tthis.config.scaleX = newScaleX;\r\n\t\t\t\tthis.config.scaleY = newScaleY;\r\n\t\t\t\tthis.scale.x = Math.sign(this.scale.x) * this.config.scaleX;\r\n\t\t\t\tthis.scale.y = Math.sign(this.scale.y) * this.config.scaleY;\r\n\t\t\t\tthis.skeleton.scaleX = this.scale.x;\r\n\t\t\t\tthis.skeleton.scaleY = this.scale.y;\r\n\r\n\t\t\t\tthis.setAnimationState(animations);\r\n\t\t\t\tthis.recordAnimation(animations[0]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate setAnimationState(animations: string[]) {\r\n\t\t\tlet animation = animations[0];\r\n\t\t\tthis.canvasBB = this.getCanvasBoundingBox(animations);\r\n\t\t\tthis.animationState.timeScale = this.config.animationPlaySpeed;\r\n\t\t\tthis.animationState.clearTracks();\r\n\t\t\tthis.skeleton.setToSetupPose();\r\n\t\t\t\r\n\t\t\tthis.animationState.setAnimation(0, animation, true);\r\n\t\t\tlet lastTrackEntry = null;\r\n\t\t\tfor (let i = 1; i < animations.length; i++) {\r\n\t\t\t\tlastTrackEntry = this.animationState.addAnimation(0, animations[i], false, 0);\r\n\t\t\t}\r\n\r\n\t\t\tif (lastTrackEntry) {\r\n\t\t\t\tthis.animationState.addListener({\r\n\t\t\t\t\tstart: (\r\n\t\t\t\t\t\t(trackEntry: TrackEntry) => {\r\n\t\t\t\t\t\t\tthis.recordAnimation(trackEntry.animation.name,)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t).bind(this),\r\n\t\t\t\t\tinterrupt: function (trackEntry) { },\r\n\t\t\t\t\tend: function (trackEntry) {},\r\n\t\t\t\t\tcomplete: (\r\n\t\t\t\t\t\t(trackEntry: TrackEntry) => { \r\n\t\t\t\t\t\t\t// Loop through all the animations\r\n\t\t\t\t\t\t\tif (trackEntry.next == null) {\r\n\t\t\t\t\t\t\t\tthis.animationState.setAnimation(0, animation, true);\r\n\t\t\t\t\t\t\t\tfor (let i = 1; i < animations.length; i++) {\r\n\t\t\t\t\t\t\t\t\tlastTrackEntry = this.animationState.addAnimation(0, animations[i], false, 0);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t).bind(this),\r\n\t\t\t\t\tdispose: function (trackEntry) {},\r\n\t\t\t\t\tevent: function (entry: TrackEntry, event: Event): void {}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate getCanvasBoundingBox(animations: string[]) : BoundingBox {\r\n\t\t\tlet defaultAnimationName = animations[0];\r\n\r\n\t\t\tlet savedX = this.skeleton.x;\r\n\t\t\tlet savedY = this.skeleton.y;\r\n\t\t\tlet savedZ = this.getPositionZ();\r\n\t\t\tlet savedScaleX = this.skeleton.scaleX;\r\n\t\t\tlet savedScaleY = this.skeleton.scaleY;\r\n\r\n\t\t\tlet animation = this.skeleton.data.findAnimation(defaultAnimationName);\r\n\t\t\tthis.animationState.clearTracks();\r\n\t\t\tthis.skeleton.setToSetupPose();\r\n\t\t\tthis.animationState.setAnimationWith(0, animation, true);\r\n\t\t\tthis.skeleton.x = 0;\r\n\t\t\tthis.skeleton.y = 0;\r\n\t\t\tthis.setPositionZ(0);\r\n\t\t\tthis.skeleton.scaleX = Math.abs(this.config.scaleX);\r\n\t\t\tthis.skeleton.scaleY = Math.abs(this.config.scaleY);\r\n\t\t\tthis.animationState.update(0);\r\n\t\t\tthis.animationState.apply(this.skeleton);\r\n\t\t\tthis.skeleton.updateWorldTransform();\r\n\r\n\t\t\tlet offset = new Vector2();\r\n\t\t\tlet size =   new Vector2();\r\n\t\t\tthis.skeleton.getBounds(offset, size);\r\n\t\t\tlet defaultBB = {x: offset.x, y: offset.y, width: size.x, height: size.y};\r\n\t\t\tlet bb = this.offscreenRender.getBoundingBox(this, defaultBB);\r\n\r\n\t\t\tthis.skeleton.x = savedX;\r\n\t\t\tthis.skeleton.y = savedY;\r\n\t\t\tthis.setPositionZ(savedZ);\r\n\t\t\tthis.skeleton.scaleX = savedScaleX;\r\n\t\t\tthis.skeleton.scaleY = savedScaleY;\r\n\r\n\t\t\treturn bb;\r\n\t\t}\r\n\t}\r\n//  }\r\n","import { Color, Vector2 } from \"../core/Utils\";\r\nimport { PerspectiveCamera, Camera } from \"../webgl/Camera\";\r\nimport { M00 } from \"../webgl/Matrix4\";\r\nimport { SceneRenderer, ResizeMode } from \"../webgl/SceneRenderer\";\r\nimport { Vector3 } from \"../webgl/Vector3\";\r\nimport { ManagedWebGLRenderingContext } from \"../webgl/WebGL\";\r\nimport { Actor } from \"./Actor\";\r\nimport { BoundingBox } from \"./Player\";\r\n\r\nexport class OffscreenRender {\r\n    public defaultOffscreenCanvasWidth = 800;\r\n    public defaultOffscreenCanvasHeight = 800;\r\n    public offscreenCanvas: OffscreenCanvas|HTMLCanvasElement;\r\n    public offscreenContext: ManagedWebGLRenderingContext;\r\n    public offscreenSceneRenderer: SceneRenderer;\r\n\r\n    public constructor(canvas: HTMLCanvasElement|null = null) {\r\n        try {\r\n            var webglConfig = { alpha: true};\r\n            \r\n            if (canvas !== null) {\r\n                this.offscreenCanvas = canvas;\r\n            } else {\r\n                this.offscreenCanvas = new OffscreenCanvas(\r\n                    this.defaultOffscreenCanvasWidth, \r\n                    this.defaultOffscreenCanvasHeight\r\n                );\r\n            }\r\n            this.offscreenContext = new ManagedWebGLRenderingContext(this.offscreenCanvas, webglConfig);\r\n            this.offscreenSceneRenderer = new SceneRenderer(this.offscreenCanvas, this.offscreenContext, true);\r\n        } catch (e) {\r\n            // this.showError(\"Sorry, your browser does not support WebGL.<br><br>Please use the latest version of Firefox, Chrome, Edge, or Safari.\");\r\n            console.log(\"Sorry, your browser does not support WebGL.<br><br>Please use the latest version of Firefox, Chrome, Edge, or Safari.\");\r\n        }\r\n    }\r\n\r\n    public getBoundingBox(actor: Actor, defaultBB: BoundingBox): BoundingBox {\r\n        let ctx = this.offscreenContext;\r\n        let gl = ctx.gl;\r\n\r\n        // Clear the viewport\r\n        let bg = new Color().setFromString(\"#00000000\");\r\n        gl.clearColor(bg.r, bg.g, bg.b, bg.a);\r\n        gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n        // Resize the canvas. Offcanvas should be square which is twice the size\r\n        // of the maximum sized sprite. This way we can guarantee that the full\r\n        // sprite will be rendered in the offcanvas for us to collect the \r\n        // width/height information\r\n        this.offscreenCanvas.width = defaultBB.width + (2 * Math.abs(defaultBB.x));\r\n        this.offscreenCanvas.height = defaultBB.height + defaultBB.height + (2*Math.abs(defaultBB.y));\r\n        this.offscreenSceneRenderer.resize(ResizeMode.Expand);\r\n\r\n        let viewport = {\r\n            x: 0,\r\n            y: 0,\r\n            width: this.offscreenCanvas.width,\r\n            height: this.offscreenCanvas.height,\r\n        };\r\n\r\n        // Update the camera\r\n        updateCameraSettings(this.offscreenSceneRenderer.camera, actor, viewport);\r\n        // Center the camera so that is the chibi is rendered below the ground\r\n        // we can still detect that in the bounding box.\r\n        this.offscreenSceneRenderer.camera.position.y = 0;        \r\n\r\n        // Draw skeleton \r\n        this.offscreenSceneRenderer.begin();\r\n        this.offscreenSceneRenderer.drawSkeleton(actor.skeleton, actor.config.premultipliedAlpha);\r\n        this.offscreenSceneRenderer.end();\r\n\r\n        // // Dump to file\r\n        // if (this.offscreenCanvas instanceof OffscreenCanvas) {\r\n        //     this.offscreenCanvas.convertToBlob({ type: \"image/png\" })\r\n        //     .then(function (blob) {\r\n        //         var url = window.URL.createObjectURL(blob);\r\n        //         var a = document.createElement('a');\r\n        //         a.href = url;\r\n        //         a.download = \"screenshot.png\";\r\n        //         a.click();\r\n        //         window.URL.revokeObjectURL(url);\r\n        //     })\r\n        // }\r\n\r\n        let w = this.offscreenCanvas.width;\r\n        let h = this.offscreenCanvas.height;\r\n        let pixels = new Uint8Array(w * h * 4);\r\n        gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n\r\n        let minX = Number.POSITIVE_INFINITY;\r\n        let minY = Number.POSITIVE_INFINITY;\r\n        let maxX = Number.NEGATIVE_INFINITY;\r\n        let maxY = Number.NEGATIVE_INFINITY;\r\n        for (let col = 0; col < w; col++) {\r\n            for (let row = 0; row < h; row++) {\r\n                let i = (row * w + col) * 4;\r\n                if (pixels[i+3] == 255) {\r\n                    // console.log(row, col, pixels[i], pixels[i + 1], pixels[i + 2], pixels[i + 3]);\r\n                    minX = Math.min(minX, col);\r\n                    minY = Math.min(minY, row);\r\n                    maxX = Math.max(maxX, col);\r\n                    maxY = Math.max(maxY, row);\r\n                }\r\n            }\r\n        }\r\n\r\n        let offset = new Vector2();\r\n        let size = new Vector2();\r\n        offset.x = -(w/2  - minX);\r\n        offset.y = minY - h/2;\r\n        size.x = maxX - minX;\r\n        size.y = maxY - minY;\r\n\r\n        actor.canvasBBCalculated += 1;\r\n        // console.log(\"actor canvasBBCalculated\", actor.config.userDisplayName, actor.canvasBBCalculated);\r\n        // console.log(offset, size, minX, maxX, minY, maxY);\r\n        return {\r\n            x: offset.x,\r\n            y: offset.y,\r\n            width: size.x,\r\n            height: size.y\r\n        }\r\n    }\r\n}\r\n\r\nexport function getPerspectiveCameraZOffset(viewport: BoundingBox, near: number, far: number, fovY:number): number {\r\n    let width = viewport.width;\r\n    let height = viewport.height;\r\n    let cam = new PerspectiveCamera(width, height);\r\n    cam.near = near;\r\n    cam.far = far;\r\n    cam.fov = fovY;\r\n    cam.zoom = 1;\r\n    cam.position.x = 0.0;\r\n    cam.position.y = 0.0;\r\n    cam.position.z = 0.0;\r\n    cam.update();\r\n\r\n    let a = cam.projectionView.values[M00];\r\n    let w = -a * (width/2);\r\n    return w;\r\n}\r\n\r\nexport function configurePerspectiveCamera(cam: Camera, near: number, far: number, viewport: BoundingBox) {\r\n    cam.near = near;\r\n    cam.far = far;\r\n    cam.zoom = 1;\r\n    cam.position.x = 0;\r\n    cam.position.y = viewport.height/2;\r\n    // TODO: Negative so that the view is not flipped?\r\n    cam.position.z = -getPerspectiveCameraZOffset(\r\n        viewport, cam.near, cam.far, cam.fov\r\n    );\r\n    cam.direction = new Vector3(0, 0, -1);\r\n    cam.update();\r\n}\r\n\r\nexport function updateCameraSettings(cam :Camera, actor: Actor, viewport: BoundingBox) {\r\n    // let cam = this.sceneRenderer.camera;\r\n    cam.position.x = 0;\r\n    cam.position.y = viewport.height/2;\r\n    // TODO: Negative so that the view is not flipped?\r\n    cam.position.z = -getPerspectiveCameraZOffset(viewport, cam.near, cam.far, cam.fov);\r\n    cam.position.z += actor.getPositionZ();\r\n    cam.direction = new Vector3(0, 0, -1);\r\n    // let origin = new Vector3(0,0,0);\r\n    // let pos = new Vector3(0,0,cam.position.z)\r\n    // let dir = origin.sub(pos).normalize();\r\n    // cam.direction = dir;\r\n    cam.update();\r\n}\r\n\r\nexport function isContained(dom: HTMLElement, needle: HTMLElement): boolean {\r\n    if (dom === needle) return true;\r\n    let findRecursive = (dom: HTMLElement, needle: HTMLElement) => {\r\n        for(var i = 0; i < dom.children.length; i++) {\r\n            let child = dom.children[i] as HTMLElement;\r\n            if (child === needle) return true;\r\n            if (findRecursive(child, needle)) return true;\r\n        }\r\n        return false;\r\n    };\r\n    return findRecursive(dom, needle);\r\n}\r\n\r\nexport function findWithId(dom: HTMLElement, id: string): HTMLElement[] {\r\n    let found = new Array<HTMLElement>()\r\n    let findRecursive = (dom: HTMLElement, id: string, found: HTMLElement[]) => {\r\n        for(var i = 0; i < dom.children.length; i++) {\r\n            let child = dom.children[i] as HTMLElement;\r\n            if (child.id === id) found.push(child);\r\n            findRecursive(child, id, found);\r\n        }\r\n    };\r\n    findRecursive(dom, id, found);\r\n    return found;\r\n}\r\n\r\nexport function findWithClass(dom: HTMLElement, className: string): HTMLElement[] {\r\n    let found = new Array<HTMLElement>()\r\n    let findRecursive = (dom: HTMLElement, className: string, found: HTMLElement[]) => {\r\n        for(var i = 0; i < dom.children.length; i++) {\r\n            let child = dom.children[i] as HTMLElement;\r\n            if (child.classList.contains(className)) found.push(child);\r\n            findRecursive(child, className, found);\r\n        }\r\n    };\r\n    findRecursive(dom, className, found);\r\n    return found;\r\n}\r\n\r\nexport function createElement(html: string): HTMLElement {\r\n    let dom = document.createElement(\"div\");\r\n    dom.innerHTML = html;\r\n    return dom.children[0] as HTMLElement;\r\n}\r\n\r\nexport function removeClass(elements: HTMLCollection, clazz: string) {\r\n    for (var i = 0; i < elements.length; i++) {\r\n        elements[i].classList.remove(clazz);\r\n    }\r\n}\r\n\r\nexport function escapeHtml(str: string) {\r\n    if (!str) return \"\";\r\n    return str\r\n         .replace(/&/g, \"&amp;\")\r\n         .replace(/</g, \"&lt;\")\r\n         .replace(/>/g, \"&gt;\")\r\n         .replace(/\"/g, \"&#34;\")\r\n         .replace(/'/g, \"&#39;\");\r\n }\r\n\r\nexport function isAlphanumeric(str: string): boolean {\r\n    return /^[a-zA-Z0-9_-]{1,100}$/.test(str)\r\n}","/******************************************************************************\r\n * Spine Runtimes License Agreement\r\n * Last updated January 1, 2020. Replaces all prior versions.\r\n *\r\n * Copyright (c) 2013-2020, Esoteric Software LLC\r\n *\r\n * Integration of the Spine Runtimes into software or otherwise creating\r\n * derivative works of the Spine Runtimes is permitted under the terms and\r\n * conditions of Section 2 of the Spine Editor License Agreement:\r\n * http://esotericsoftware.com/spine-editor-license\r\n *\r\n * Otherwise, it is permitted to integrate the Spine Runtimes into software\r\n * or otherwise create derivative works of the Spine Runtimes (collectively,\r\n * \"Products\"), provided that each user of the Products must obtain their own\r\n * Spine Editor license and redistribution of the Products in any form must\r\n * include this license and copyright notice.\r\n *\r\n * THE SPINE RUNTIMES ARE PROVIDED BY ESOTERIC SOFTWARE LLC \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL ESOTERIC SOFTWARE LLC BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES,\r\n * BUSINESS INTERRUPTION, OR LOSS OF USE, DATA, OR PROFITS) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n * THE SPINE RUNTIMES, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *****************************************************************************/\r\n\r\nimport {AssetManager } from \"../webgl/AssetManager\";\r\nimport { AtlasAttachmentLoader } from \"../core/AtlasAttachmentLoader\"\r\nimport { Skeleton } from \"../core/Skeleton\"\r\nimport { SkeletonBinary } from \"../core/SkeletonBinary\"\r\nimport { SkeletonData } from \"../core/SkeletonData\"\r\nimport { SkeletonJson } from \"../core/SkeletonJson\"\r\nimport { Vector2, Color } from \"../core/Utils\"\r\nimport { Input } from \"../webgl/Input\"\r\nimport { LoadingScreen } from \"../webgl/LoadingScreen\"\r\nimport { ResizeMode, SceneRenderer } from \"../webgl/SceneRenderer\"\r\nimport { Vector3 } from \"../webgl/Vector3\"\r\nimport { ManagedWebGLRenderingContext } from \"../webgl/WebGL\"\r\nimport { Actor, SpineActorConfig } from \"./Actor\"\r\nimport { createElement, findWithClass, OffscreenRender, escapeHtml, isAlphanumeric, findWithId, configurePerspectiveCamera, updateCameraSettings } from \"./Utils\";\r\nimport { Camera } from \"../webgl/Camera\";\r\n\r\n// // module spine {\r\n\texport interface Viewport {\r\n\t\tx: number,\r\n\t\ty: number,\r\n\t\twidth: number,\r\n\t\theight: number,\r\n\t\tpadLeft: string | number\r\n\t\tpadRight: string | number\r\n\t\tpadTop: string | number\r\n\t\tpadBottom: string | number\r\n\t\tdebugRender: boolean\r\n\t}\r\n\r\n\texport interface BoundingBox {\r\n\t\tx: number,\r\n\t\ty: number,\r\n\t\twidth: number,\r\n\t\theight: number,\r\n\t}\r\n\r\n\texport interface SpinePlayerConfig {\r\n\t\t/* Optional: whether to show the player controls. Default: true. */\r\n\t\tshowControls: boolean\r\n\r\n\t\t/* Optional: the position and size of the viewport in world coordinates of the skeleton. Default: the setup pose bounding box. */\r\n\t\tviewport: Viewport\r\n\r\n\t\t/* Optional: whether the canvas should be transparent. Default: false. */\r\n\t\talpha: boolean\r\n\r\n\t\t/* Optional: the background color. Must be given in the format #rrggbbaa. Default: #000000ff. */\r\n\t\tbackgroundColor: string\r\n\r\n\t\ttextSize: number,\r\n\t\ttextFont: string,\r\n\r\n\t\t/* Optional: the background image. Default: none. */\r\n\t\tbackgroundImage: {\r\n\t\t\t/* The URL of the background image */\r\n\t\t\turl: string\r\n\r\n\t\t\t/* Optional: the position and size of the background image in world coordinates. Default: viewport. */\r\n\t\t\tx: number\r\n\t\t\ty: number\r\n\t\t\twidth: number\r\n\t\t\theight: number\r\n\t\t} | undefined\r\n\r\n\t\t/* Optional: the background color used in fullscreen mode. Must be given in the format #rrggbbaa. Default: backgroundColor. */\r\n\t\tfullScreenBackgroundColor: string | undefined\r\n\r\n\t\t/** Optional: \r\n\t\t *  How often to send back runtime debug information to the server.\r\n\t\t *  This is to help debug performance issues. Default: 60 seconds.\r\n\t\t */\r\n\t\truntimeDebugInfoDumpIntervalSec: number\r\n\r\n\t\t// Camera Near and Far customization\r\n\t\tcameraPerspectiveNear: number\r\n\t\tcameraPerspectiveFar: number\r\n\r\n\t\t// The extra scaling to be applied to the all the chibis\r\n\t\tchibiScale: number\r\n\t}\r\n\r\n\tclass Slider {\r\n\t\tprivate slider: HTMLElement;\r\n\t\tprivate value: HTMLElement;\r\n\t\tprivate knob: HTMLElement;\r\n\t\tpublic change: (percentage: number) => void;\r\n\r\n\t\tconstructor(public snaps = 0, public snapPercentage = 0.1, public big = false) { }\r\n\r\n\t\trender(): HTMLElement {\r\n\t\t\tthis.slider = createElement(/*html*/`\r\n\t\t\t\t<div class=\"spine-player-slider ${this.big ? \"big\": \"\"}\">\r\n\t\t\t\t\t<div class=\"spine-player-slider-value\"></div>\r\n\t\t\t\t\t<!--<div class=\"spine-player-slider-knob\"></div>-->\r\n\t\t\t\t</div>\r\n\t\t\t`);\r\n\t\t\tthis.value = findWithClass(this.slider, \"spine-player-slider-value\")[0];\r\n\t\t\t// this.knob = findWithClass(this.slider, \"spine-player-slider-knob\")[0];\r\n\t\t\tthis.setValue(0);\r\n\r\n\t\t\tlet input = new Input(this.slider);\r\n\t\t\tvar dragging = false;\r\n\t\t\tinput.addListener({\r\n\t\t\t\tdown: (x, y) => {\r\n\t\t\t\t\tdragging = true;\r\n\t\t\t\t\tthis.value.classList.add(\"hovering\");\r\n\t\t\t\t},\r\n\t\t\t\tup: (x, y) => {\r\n\t\t\t\t\tdragging = false;\r\n\t\t\t\t\tlet percentage = x / this.slider.clientWidth;\r\n\t\t\t\t\tpercentage = percentage = Math.max(0, Math.min(percentage, 1));\r\n\t\t\t\t\tthis.setValue(x / this.slider.clientWidth);\r\n\t\t\t\t\tif (this.change) this.change(percentage);\r\n\t\t\t\t\tthis.value.classList.remove(\"hovering\");\r\n\t\t\t\t},\r\n\t\t\t\tmoved: (x, y) => {\r\n\t\t\t\t\tif (dragging) {\r\n\t\t\t\t\t\tlet percentage = x / this.slider.clientWidth;\r\n\t\t\t\t\t\tpercentage = Math.max(0, Math.min(percentage, 1));\r\n\t\t\t\t\t\tpercentage = this.setValue(x / this.slider.clientWidth);\r\n\t\t\t\t\t\tif (this.change) this.change(percentage);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tdragged: (x, y) => {\r\n\t\t\t\t\tlet percentage = x / this.slider.clientWidth;\r\n\t\t\t\t\tpercentage = Math.max(0, Math.min(percentage, 1));\r\n\t\t\t\t\tpercentage = this.setValue(x / this.slider.clientWidth);\r\n\t\t\t\t\tif (this.change) this.change(percentage);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\r\n\t\t\treturn this.slider;\r\n\t\t}\r\n\r\n\t\tsetValue(percentage: number): number {\r\n\t\t\tpercentage = Math.max(0, Math.min(1, percentage));\r\n\t\t\tif (this.snaps > 0) {\r\n\t\t\t\tlet modulo = percentage % (1 / this.snaps);\r\n\t\t\t\t// floor\r\n\t\t\t\tif (modulo < (1 / this.snaps) * this.snapPercentage) {\r\n\t\t\t\t\tpercentage = percentage - modulo;\r\n\t\t\t\t} else if (modulo > (1 / this.snaps) - (1 / this.snaps) * this.snapPercentage) {\r\n\t\t\t\t\tpercentage = percentage - modulo + (1 / this.snaps);\r\n\t\t\t\t}\r\n\t\t\t\tpercentage = Math.max(0, Math.min(1, percentage));\r\n\t\t\t}\r\n\t\t\tthis.value.style.width = \"\" + (percentage * 100) + \"%\";\r\n\t\t\t// this.knob.style.left = \"\" + (-8 + percentage * this.slider.clientWidth) + \"px\";\r\n\t\t\treturn percentage;\r\n\t\t}\r\n\t}\r\n\r\n\ttype RenderCallbackFn = (context: ManagedWebGLRenderingContext) => void;\r\n\ttype RemoveCallbackFn = () => void;\r\n\r\n\texport class SpinePlayer {\r\n\t\tstatic HOVER_COLOR_INNER = new Color(0.478, 0, 0, 0.25);\r\n\t\tstatic HOVER_COLOR_OUTER = new Color(1, 1, 1, 1);\r\n\t\tstatic NON_HOVER_COLOR_INNER = new Color(0.478, 0, 0, 0.5);\r\n\t\tstatic NON_HOVER_COLOR_OUTER = new Color(1, 0, 0, 0.8);\r\n\r\n\t\t// private average_width = 0;\r\n\t\t// private average_height = 0;\r\n\t\t// private average_count = 0;\r\n\r\n\t\tprivate sceneRenderer: SceneRenderer;\r\n\t\tprivate dom: HTMLElement;\r\n\t\tprivate playerControls: HTMLElement;\r\n\t\tprivate canvas: HTMLCanvasElement;\r\n\t\tprivate textCanvas: HTMLCanvasElement;\r\n\t\tprivate textCanvasContext: CanvasRenderingContext2D;\r\n\t\tprivate timelineSlider: Slider;\r\n\t\tprivate playButton: HTMLElement;\r\n\r\n\t\tprivate context: ManagedWebGLRenderingContext;\r\n\t\tprivate loadingScreen: LoadingScreen;\r\n\t\tprivate assetManager: AssetManager;\r\n\t\tprivate paused = false;\r\n\t\tprivate actors = new Map<string, Actor>();\r\n\t\tprivate playerConfig: SpinePlayerConfig = null;\r\n\t\t\r\n\t\tprivate parent: HTMLElement;\r\n\r\n\t\tprivate stopRequestAnimationFrame = false;\r\n\t\tprivate lastRequestAnimationFrameId = 0;\r\n\t\tprivate windowFpsFrameCount:number = 0;\r\n\t\tprivate webSocket: WebSocket = null;\r\n\t\tprivate renderCallbacks: RenderCallbackFn[] = [];\r\n\t\tprivate actorQueue: {actorName: string, config: SpineActorConfig}[] = [];\r\n\t\tprivate actorQueueIndex: any = null;\r\n\r\n\t\t// private offCanvas: HTMLCanvasElement|null;\r\n\t\tprivate offscreenRender: OffscreenRender = null;\r\n\r\n\t\tconstructor(parent: HTMLElement | string, playerConfig: SpinePlayerConfig) {\r\n\t\t\tif (typeof parent === \"string\") {\r\n\t\t\t\tthis.parent = document.getElementById(parent);\r\n\t\t\t} else  {\r\n\t\t\t\tthis.parent = parent;\r\n\t\t\t}\r\n\t\t\t// this.playerConfig = null;\r\n\t\t\tthis.playerConfig = this.validatePlayerConfig(playerConfig);\r\n\t\t\tthis.parent.appendChild(this.setupDom());\r\n\t\t}\r\n\r\n\t\tsetWebsocket(webSocket: WebSocket) {\r\n\t\t\tthis.webSocket = webSocket;\r\n\t\t}\r\n\r\n\t\tvalidatePlayerConfig(config: SpinePlayerConfig): SpinePlayerConfig {\r\n\t\t\tif (!config) throw new Error(\"Please pass a configuration to new.SpinePlayer().\");\r\n\t\t\tif (!config.alpha) config.alpha = false;\r\n\t\t\tif (!config.backgroundColor) config.backgroundColor = \"#000000\";\r\n\t\t\tif (!config.fullScreenBackgroundColor) config.fullScreenBackgroundColor = config.backgroundColor;\r\n\t\t\tif (typeof config.showControls === \"undefined\")\r\n\t\t\t\tconfig.showControls = true;\r\n\t\t\tif (!config.runtimeDebugInfoDumpIntervalSec) config.runtimeDebugInfoDumpIntervalSec = 60;\r\n\t\t\tif (!config.textSize) config.textSize = 14;\r\n\t\t\tif (!config.textFont) config.textFont = \"lato\";\r\n\t\t\tif (!config.cameraPerspectiveNear) config.cameraPerspectiveNear = 1.0;\r\n\t\t\tif (!config.cameraPerspectiveFar) config.cameraPerspectiveFar = 1000.0;\r\n\t\t\treturn config;\r\n\t\t}\r\n\r\n\t\tvalidateActorConfig(config: SpineActorConfig): SpineActorConfig {\r\n\t\t\tif (!config) throw new Error(\"Please pass a configuration to new.SpinePlayer().\");\r\n\t\t\tif (!config.jsonUrl && !config.skelUrl) throw new Error(\"Please specify the URL of the skeleton JSON or .skel file.\");\r\n\t\t\tif (!config.atlasUrl) throw new Error(\"Please specify the URL of the atlas file.\");\r\n\t\t\t// if (!config.alpha) config.alpha = false;\r\n\t\t\t// if (!config.backgroundColor) config.backgroundColor = \"#000000\";\r\n\t\t\t// if (!config.fullScreenBackgroundColor) config.fullScreenBackgroundColor = config.backgroundColor;\r\n\t\t\tif (typeof config.premultipliedAlpha === \"undefined\") config.premultipliedAlpha = true;\r\n\t\t\tif (!config.scaleX) config.scaleX = 1;\r\n\t\t\tif (!config.scaleY) config.scaleY = 1;\r\n\t\t\tif (!config.extraOffsetX) config.extraOffsetX = 0;\r\n\t\t\tif (!config.extraOffsetY) config.extraOffsetY = 0;\r\n\t\t\tif (!config.success) config.success = (widget, actor) => {};\r\n\t\t\tif (!config.error) config.error = (widget, actor, msg) => {};\r\n\t\t\tif (!config.animation_listener) {\r\n\t\t\t\tconfig.animation_listener = {\r\n\t\t\t\t\tevent: function(trackIndex, event) {\r\n\t\t\t\t\t\t// console.log(\"Event on track \" + trackIndex + \": \" + JSON.stringify(event));\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: function(trackIndex) {\r\n\t\t\t\t\t\t// console.log(\"Animation on track \" + trackIndex + \" completed\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstart: function(trackIndex) {\r\n\t\t\t\t\t\t// console.log(\"Animation on track \" + trackIndex + \" started\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tend: function(trackIndex) {\r\n\t\t\t\t\t\t// console.log(\"Animation on track \" + trackIndex + \" ended\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tinterrupt: function(trackIndex) {\r\n\t\t\t\t\t\t// console.log(\"Animation on track \" + trackIndex + \" ended\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdispose: function(trackIndex) {\r\n\t\t\t\t\t\t// console.log(\"Animation on track \" + trackIndex + \" ended\");\r\n\t\t\t\t\t},\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (config.skins && config.skin) {\r\n\t\t\t\tif (config.skins.indexOf(config.skin) < 0) {\r\n\t\t\t\t\tthrow new Error(\"Default skin '\" + \r\n\t\t\t\t\t\tconfig.skin + \r\n\t\t\t\t\t\t\"' is not contained in the list of selectable skins \" + \r\n\t\t\t\t\t\tescapeHtml(JSON.stringify(config.skins)) + \r\n\t\t\t\t\t\t\".\"\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (typeof config.defaultMix === \"undefined\")\r\n\t\t\t\tconfig.defaultMix = 0.25;\r\n\r\n\t\t\tif (config.configScaleX == undefined) {config.configScaleX = 1.0;}\r\n\t\t\tif (config.configScaleY == undefined) {config.configScaleY = 1.0;}\r\n\t\t\tif (config.scaleX == undefined) {config.scaleX = 0.45;}\r\n\t\t\tif (config.scaleY == undefined) {config.scaleY = 0.45;}\r\n\t\t\tif (config.maxSizePx == undefined) {config.maxSizePx = 350;}\r\n\t\t\tif (config.startPosX == undefined) {config.startPosX = null;}\r\n\t\t\tif (config.startPosY == undefined) {config.startPosY = null;}\r\n\t\t\tif (config.extraOffsetX == undefined) {config.extraOffsetX = 0;}\r\n\t\t\tif (config.extraOffsetY == undefined) {config.extraOffsetY = 0;}\r\n\t\t\tif (config.defaultMovementSpeedPxX == undefined) {config.defaultMovementSpeedPxX = 80;}\r\n\t\t\tif (config.defaultMovementSpeedPxY == undefined) {config.defaultMovementSpeedPxY = 80;}\r\n\t\t\tif (config.defaultMovementSpeedPxZ == undefined) {config.defaultMovementSpeedPxZ = 80;}\r\n\t\t\tif (config.movementSpeedPxX == undefined) {config.movementSpeedPxX = null;}\r\n\t\t\tif (config.movementSpeedPxY == undefined) {config.movementSpeedPxY = null;}\r\n\t\t\tif (config.movementSpeedPxZ == undefined) {config.movementSpeedPxZ = config.defaultMovementSpeedPxZ;}\r\n\r\n\t\t\tif (config.chibiId == undefined) {config.chibiId = crypto.randomUUID();}\r\n\t\t\tif (config.userDisplayName == undefined) {config.userDisplayName = crypto.randomUUID();}\r\n\t\t\tif (!isAlphanumeric(config.chibiId)) {\r\n\t\t\t\tthrow Error(\"ChibiId is not valid\");\r\n\t\t\t}\r\n\t\t\tif (!isAlphanumeric(config.userDisplayName)) {\r\n\t\t\t\tthrow Error(\"userDisplayName is not valid\");\r\n\t\t\t}\r\n\t\t\tif (config.action == undefined) {\r\n\t\t\t\tthrow Error(\"config.action must be set\");\r\n\t\t\t}\r\n\r\n\t\t\treturn config;\r\n\t\t}\r\n\r\n\t\tshowError(actor: Actor, error: string) {\r\n\t\t\tlet errorDom = findWithClass(this.dom, \"spine-player-error\")[0];\r\n\t\t\terrorDom.classList.remove(\"spine-player-hidden\");\r\n\t\t\terrorDom.innerHTML = `<p style=\"text-align: center; align-self: center;\">${error}</p>`;\r\n\r\n\t\t\t// this.playerConfig.error(this, error);\r\n\t\t\tactor.config.error(this, actor, error);\r\n\t\t}\r\n\r\n\t\thideError() {\r\n\t\t\tlet errorDom = findWithClass(this.dom, \"spine-player-error\")[0];\r\n\t\t\terrorDom.classList.add(\"spine-player-hidden\");\r\n\t\t}\r\n\r\n\t\tsetupDom(): HTMLElement {\r\n\t\t\tlet dom = this.dom = createElement(/*html*/`\r\n\t\t\t\t<div class=\"spine-player\">\r\n\t\t\t\t\t<div class=\"spine-player-error spine-player-hidden\"></div>\r\n\t\t\t\t\t<canvas id=\"spine-canvas\" class=\"spine-player-canvas\"></canvas>\r\n\t\t\t\t\t<canvas id=\"spine-text\" class=\"spine-player-text-canvas\"></canvas>\r\n\t\t\t\t\t<div class=\"spine-player-controls spine-player-popup-parent spine-player-controls-hidden\">\r\n\t\t\t\t\t\t<div class=\"spine-player-timeline\">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"spine-player-buttons\">\r\n\t\t\t\t\t\t\t<button id=\"spine-player-button-play-pause\" class=\"spine-player-button spine-player-button-icon-pause\"></button>\r\n\t\t\t\t\t\t\t<div class=\"spine-player-button-spacer\"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t`)\r\n\r\n\t\t\ttry {\r\n\t\t\t\t// Setup the scene renderer and OpenGL context\r\n\t\t\t\t// this.canvas = findWithClass(dom, \"spine-player-canvas\")[0] as HTMLCanvasElement;\r\n\t\t\t\tthis.canvas = findWithId(dom, \"spine-canvas\")[0] as HTMLCanvasElement;\r\n\t\t\t\tthis.textCanvas = findWithId(dom, \"spine-text\")[0] as HTMLCanvasElement;\r\n\t\t\t\tthis.textCanvasContext = this.textCanvas.getContext(\"2d\");\r\n\t\t\t\t// var webglConfig = { alpha: config.alpha };\r\n\t\t\t\tvar webglConfig = { alpha: this.playerConfig.alpha};\r\n\t\t\t\tthis.context = new ManagedWebGLRenderingContext(this.canvas, webglConfig);\r\n\t\t\t\t// Setup the scene renderer and loading screen\r\n\t\t\t\tthis.sceneRenderer = new SceneRenderer(this.canvas, this.context, true);\r\n\t\t\t\tthis.loadingScreen = new LoadingScreen(this.sceneRenderer);\r\n\r\n\t\t\t\t// // <canvas id=\"spine-canvas-off\" class=\"spine-player-canvas-off\"></canvas>\r\n\t\t\t\t// let offCanvas = findWithId(dom, \"spine-canvas-off\")[0] as HTMLCanvasElement;\r\n\t\t\t\t// this.offscreenRender = new OffscreenRender(this.playerConfig.chibiScale, offCanvas);\r\n\t\t\t\tthis.offscreenRender = new OffscreenRender();\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// this.showError(\"Sorry, your browser does not support WebGL.<br><br>Please use the latest version of Firefox, Chrome, Edge, or Safari.\");\r\n\t\t\t\tconsole.log(\"Sorry, your browser does not support WebGL.<br><br>Please use the latest version of Firefox, Chrome, Edge, or Safari.\");\r\n\t\t\t\treturn dom;\r\n\t\t\t}\r\n\r\n\t\t\t// configure the camera\r\n\t\t\tconfigurePerspectiveCamera(\r\n\t\t\t\tthis.sceneRenderer.camera,\r\n\t\t\t\tthis.playerConfig.cameraPerspectiveNear,\r\n    \t\t\tthis.playerConfig.cameraPerspectiveFar,\r\n\t\t\t\tthis.playerConfig.viewport\r\n\t\t\t);\r\n\r\n\t\t\t// Load the assets\r\n\t\t\tthis.assetManager = new AssetManager(\r\n\t\t\t\t[this.context, this.offscreenRender.offscreenContext]\r\n\t\t\t);\r\n\r\n\t\t\t// Setup rendering loop\r\n\t\t\tthis.lastRequestAnimationFrameId = requestAnimationFrame(() => this.drawFrame());\r\n\r\n\t\t\t// Setup FPS counter\r\n\t\t\tperformance.mark('fps_window_start');\r\n\t\t\tthis.windowFpsFrameCount = 0;\r\n\t\t\tif (this.playerConfig.runtimeDebugInfoDumpIntervalSec > 0) {\r\n\t\t\t\tsetInterval(() => this.callbackSendRuntimeUpdateInfo(), 1000* this.playerConfig.runtimeDebugInfoDumpIntervalSec);\r\n\t\t\t}\r\n\r\n\t\t\t// Setup the event listeners for UI elements\r\n\t\t\tthis.playerControls = findWithClass(dom, \"spine-player-controls\")[0];\r\n\t\t\tlet timeline = findWithClass(dom, \"spine-player-timeline\")[0];\r\n\t\t\tthis.timelineSlider = new Slider();\r\n\t\t\ttimeline.appendChild(this.timelineSlider.render());\r\n\t\t\tthis.playButton = findWithId(dom, \"spine-player-button-play-pause\")[0];\r\n\r\n\t\t\tthis.playButton.onclick = () => {\r\n\t\t\t\tif (this.paused) this.play()\r\n\t\t\t\telse this.pause();\r\n\t\t\t}\r\n\r\n\t\t\t// Register a global resize handler to redraw and avoid flicker\r\n\t\t\twindow.onresize = () => {\r\n\t\t\t\tthis.drawFrame(false);\r\n\t\t\t}\r\n\r\n\t\t\t// Setup the input processor and controllable bones\r\n\t\t\tthis.setupInput();\r\n\r\n\t\t\treturn dom;\r\n\t\t}\r\n\r\n\t\tcallbackSendRuntimeUpdateInfo() {\r\n\t\t\tperformance.mark('fps_window_end');\r\n\t\t\tconst totalTime = performance.measure('fps_window_time', 'fps_window_start', 'fps_window_end')\r\n\t\t\tconst averageFps = this.windowFpsFrameCount / (totalTime.duration  / 1000);\r\n\r\n\t\t\tif (this.webSocket != null) {\r\n\t\t\t\tconst payload = JSON.stringify(\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype_name: \"RUNTIME_DEBUG_UPDATE\",\r\n\t\t\t\t\t\taverage_fps: averageFps, \r\n\t\t\t\t\t}\r\n\t\t\t\t)\r\n\t\t\t\tthis.webSocket.send(payload);\r\n\t\t\t}\r\n\r\n\t\t\tperformance.mark('fps_window_start');\r\n\t\t\tthis.windowFpsFrameCount = 0;\r\n\t\t}\r\n\r\n\t\taddActorToUpdateQueue(actorName: string, config: SpineActorConfig) {\r\n\t\t\tthis.actorQueue.push({actorName: actorName, config: config});\r\n\t\t\tif (this.actorQueueIndex == null) {\r\n\t\t\t\tthis.actorQueueIndex = setTimeout(() => this.consumeActorUpdateQueue(), 100);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate consumeActorUpdateQueue() {\r\n\t\t\tconsole.log(\"actorUpdateQueue: \", this.actorQueue.length);\r\n\t\t\tif (this.actorQueue.length == 0) {\r\n\t\t\t\tthis.actorQueueIndex = null;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!this.assetManager.isLoadingComplete()) {\r\n\t\t\t\tthis.actorQueueIndex = setTimeout(() => this.consumeActorUpdateQueue(), 100);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet task = this.actorQueue.shift();\r\n\t\t\tthis.changeOrAddActor(task.actorName, task.config);\r\n\t\t\tthis.actorQueueIndex = setTimeout(() => this.consumeActorUpdateQueue(), 100);\r\n\t\t}\r\n\r\n\t\tchangeOrAddActor(actorName: string, config: SpineActorConfig) {\r\n\t\t\tif (this.actors.has(actorName)) {\r\n\t\t\t\tlet actor = this.actors.get(actorName);\r\n\t\t\t\tactor.ResetWithConfig(config);\r\n\t\t\t\tthis.setupActor(actor);\r\n\t\t\t} else {\r\n\t\t\t\tlet actor = new Actor(config, this.playerConfig.viewport, this.offscreenRender);\r\n\t\t\t\tthis.setupActor(actor);\r\n\t\t\t\tthis.actors.set(actorName, actor);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic getActor(actorName: string) : Actor {\r\n\t\t\treturn this.actors.get(actorName);\r\n\t\t}\r\n\r\n\t\tpublic getActorNames() : Array<string> {\r\n\t\t\treturn Array.from(this.actors.keys());\r\n\t\t}\r\n\r\n\t\tremoveActor(actorName: string) {\r\n\t\t\tthis.actors.delete(actorName)\r\n\t\t}\r\n\r\n\t\tsetupActor(actor: Actor) {\r\n\t\t\tlet config = actor.config;\r\n\r\n\t\t\ttry {\r\n\t\t\t\t// Validate the configuration\r\n\t\t\t\t// this.config = this.validatePlayerConfig(config);\r\n\t\t\t\tactor.config = this.validateActorConfig(actor.config);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis.showError(actor, e);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Load the assets\r\n\t\t\tif (config.rawDataURIs) {\r\n\t\t\t\tfor (let path in config.rawDataURIs) {\r\n\t\t\t\t\tlet data = config.rawDataURIs[path];\r\n\t\t\t\t\tthis.assetManager.setRawDataURI(path, data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (config.jsonUrl) {\r\n\t\t\t\tthis.assetManager.loadText(config.jsonUrl);\r\n\t\t\t} else {\r\n\t\t\t\tthis.assetManager.loadBinary(config.skelUrl);\r\n\t\t\t}\r\n\t\t\tthis.assetManager.loadTextureAtlas(config.atlasUrl);\r\n\t\t\tif (config.backgroundImage && config.backgroundImage.url) {\r\n\t\t\t\tthis.assetManager.loadTexture(config.backgroundImage.url);\r\n\t\t\t}\r\n\r\n\t\t\t// Setup rendering loop\r\n\t\t\t// this.lastRequestAnimationFrameId = requestAnimationFrame(() => this.drawFrame());\r\n\t\t}\r\n\r\n\t\tupdateCameraSettings(cam: Camera, actor: Actor, viewport: BoundingBox) {\r\n\t\t\tupdateCameraSettings(cam, actor, viewport)\r\n\t\t}\r\n\r\n\t\tdrawText(text: string, xpx: number, ypx: number) {\r\n\t\t\tlet viewport = this.playerConfig.viewport;\r\n\t\t\t// TODO: I don't understand why this is worldToScreen.\r\n\t\t\tlet tt = this.sceneRenderer.camera.worldToScreen(\r\n\t\t\t\tnew Vector3(xpx,ypx,0)\r\n\t\t\t);\r\n\t\t\tlet textpos = new Vector2(tt.x, tt.y);\r\n\t\t\ttextpos.y = viewport.height - textpos.y;\r\n\t\t\txpx = textpos.x;\r\n\t\t\typx = textpos.y;\r\n\r\n\t\t\tlet ctx = this.textCanvasContext;\r\n\t\t\tctx.save();\r\n\t\t\tctx.translate(xpx, ypx);\r\n\r\n\t\t\tctx.font = this.playerConfig.textSize + \"px \" + this.playerConfig.textFont;\r\n\t\t\tctx.textBaseline = \"bottom\";\r\n\t\t\tlet data = ctx.measureText(text);\r\n\t\t\tlet height = data.actualBoundingBoxAscent - data.actualBoundingBoxDescent;\r\n\t\t\tlet width = data.width;\r\n\r\n\t\t\tctx.beginPath();\r\n\t\t\tlet pad = 5;\r\n\t\t\tctx.fillStyle = \"black\";\r\n\t\t\tctx.fillRect(-width/2 - pad, pad, width + 2*pad, -height - 2*pad);\r\n\t\t\tctx.fill();\r\n\r\n\t\t\tctx.fillStyle = \"white\";\r\n\t\t\tctx.fillText(text, -width/2, 0);\r\n\t\t\tctx.restore();\r\n\t\t}\r\n\r\n\t\tdrawFrame (requestNextFrame = true) {\r\n\t\t\tif (requestNextFrame && !this.stopRequestAnimationFrame) {\r\n\t\t\t\tthis.lastRequestAnimationFrameId = requestAnimationFrame(() => this.drawFrame());\r\n\t\t\t}\r\n\t\t\tlet ctx = this.context;\r\n\t\t\tlet gl = ctx.gl;\r\n\r\n\t\t\t// Clear the viewport\r\n\t\t\tvar doc = document as any;\r\n\t\t\tvar isFullscreen = doc.fullscreenElement || doc.webkitFullscreenElement || doc.mozFullScreenElement || doc.msFullscreenElement;\r\n\t\t\t// let bg = new Color().setFromString(isFullscreen ? this.config.fullScreenBackgroundColor : this.config.backgroundColor);\r\n\t\t\tlet bg = new Color().setFromString(\r\n\t\t\t\tisFullscreen ? \r\n\t\t\t\tthis.playerConfig.fullScreenBackgroundColor :\r\n\t\t\t\tthis.playerConfig.backgroundColor\r\n\t\t\t);\r\n\t\t\tgl.clearColor(bg.r, bg.g, bg.b, bg.a);\r\n\t\t\tgl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n\t\t\t// Clear the Text Canvas\r\n\t\t\tthis.textCanvas.width = this.textCanvas.clientWidth;\r\n\t\t\tthis.textCanvas.height = this.textCanvas.clientHeight;\r\n\t\t\tthis.textCanvasContext.clearRect(0,0, this.textCanvas.width, this.textCanvas.height);\r\n\r\n\t\t\t// // Display loading screen\r\n\t\t\t// this.loadingScreen.backgroundColor.setFromColor(bg);\r\n\t\t\t// this.loadingScreen.draw(this.assetManager.isLoadingComplete());\r\n\r\n\t\t\t// Resize the canvas\r\n\t\t\tthis.sceneRenderer.resize(ResizeMode.Expand);\r\n\r\n\t\t\t// Order the actors to draw based on their z-order\r\n\t\t\tlet actorsZOrder = Array.from(this.actors.keys()).sort((a:string,b:string ) => {\r\n\t\t\t\tlet a1 = this.actors.get(a);\r\n\t\t\t\tlet a2 = this.actors.get(b);\r\n\t\t\t\tlet r = a2.getPositionZ() - a1.getPositionZ()\r\n\t\t\t\t// To ensure stable sort\r\n\t\t\t\tif (r == 0) {return a1.loadedWhen - a2.loadedWhen;}\r\n\t\t\t\treturn r;\r\n\t\t\t});\r\n\r\n\t\t\tlet all_actors_loaded = true;\r\n\t\t\tfor (let key of actorsZOrder) {\r\n\t\t\t\tlet actor = this.actors.get(key);\r\n\t\t\t\tif (actor.load_perma_failed) {\r\n\t\t\t\t\t// Permanant failure trying to load this actor. Just skip it.\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Have we finished loading the asset? Then set things up\r\n\t\t\t\t// if (this.assetManager.isLoadingComplete() && this.skeleton == null) this.loadSkeleton();\r\n\t\t\t\tif (this.assetManager.isLoadingComplete() \r\n\t\t\t\t\t&& actor.skeleton == null) {\r\n\t\t\t\t\tthis.loadSkeleton(actor);\r\n\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t// // Resize the canvas\r\n\t\t\t\t// this.sceneRenderer.resize(webgl.ResizeMode.Expand);\r\n\r\n\t\t\t\t// Update and draw the skeleton\r\n\t\t\t\tif (!actor.loaded) {\r\n\t\t\t\t\tall_actors_loaded = false;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet viewport = this.playerConfig.viewport;\r\n\r\n\t\t\t\t// Update animation and skeleton based on user selections\r\n\t\t\t\t// if (!actor.paused && actor.config.animations.length > 0) {\r\n\t\t\t\tif (!actor.paused && actor.GetAnimations().length > 0) {\r\n\t\t\t\t\tactor.time.update();\r\n\t\t\t\t\tlet delta = actor.time.delta * actor.speed;\r\n\r\n\t\t\t\t\tlet animationDuration = actor.animationState.getCurrent(0).animation.duration;\r\n\t\t\t\t\tactor.playTime += delta;\r\n\t\t\t\t\twhile (actor.playTime >= animationDuration && animationDuration != 0) {\r\n\t\t\t\t\t\tactor.playTime -= animationDuration;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tactor.playTime = Math.max(0, Math.min(actor.playTime, animationDuration));\r\n\t\t\t\t\tthis.timelineSlider.setValue(actor.playTime / animationDuration);\r\n\r\n\t\t\t\t\tactor.UpdatePhysics(delta, viewport);\r\n\t\t\t\t\tactor.skeleton.setToSetupPose();\t\t\t\t\t\r\n\t\t\t\t\tactor.animationState.update(delta);\r\n\t\t\t\t\tactor.animationState.apply(actor.skeleton);\r\n\t\t\t\t}\r\n\t\t\t\tactor.skeleton.updateWorldTransform();\r\n\r\n\t\t\t\t// Update the camera\r\n\t\t\t\tthis.updateCameraSettings(this.sceneRenderer.camera, actor, viewport);\r\n\r\n\t\t\t\tthis.sceneRenderer.begin();\r\n\t\t\t\t// // Draw background image if given\r\n\t\t\t\tif (actor.config.backgroundImage && actor.config.backgroundImage.url) {\r\n\t\t\t\t\tlet bgImage = this.assetManager.get(actor.config.backgroundImage.url);\r\n\t\t\t\t\tif (!(actor.config.backgroundImage.hasOwnProperty(\"x\") && actor.config.backgroundImage.hasOwnProperty(\"y\") && actor.config.backgroundImage.hasOwnProperty(\"width\") && actor.config.backgroundImage.hasOwnProperty(\"height\"))) {\r\n\t\t\t\t\t\tthis.sceneRenderer.drawTexture(bgImage, viewport.x, viewport.y, viewport.width, viewport.height);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.sceneRenderer.drawTexture(bgImage, actor.config.backgroundImage.x, actor.config.backgroundImage.y, actor.config.backgroundImage.width, actor.config.backgroundImage.height);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// Draw skeleton \r\n\t\t\t\tthis.sceneRenderer.drawSkeleton(actor.skeleton, actor.config.premultipliedAlpha);\r\n\r\n\t\t\t\t// Render the user's name above the chibi\r\n\t\t\t\t// TODO: Need to figure out if the actor.animViewport.y has any breaking changes\r\n\t\t\t\t// The subtraction of animViewport is to account for the fact the \r\n\t\t\t\t// character could be sitting and we offset the actors.postion.y \r\n\t\t\t\t// to make them \"sit\" in the air.\r\n\t\t\t\tthis.drawText(\r\n\t\t\t\t\tactor.config.userDisplayName,\r\n\t\t\t\t\tactor.getPositionX(),\r\n\t\t\t\t\tactor.getPositionY() + actor.GetUsernameHeaderHeight(),\r\n\t\t\t\t)\r\n\t\t\t\tthis.sceneRenderer.end();\r\n\r\n\t\t\t\t// Render the debug output with a fixed camera.\r\n\t\t\t\tif (this.playerConfig.viewport.debugRender) {\r\n\t\t\t\t\tthis.sceneRenderer.begin();\r\n\r\n\t\t\t\t\tlet actor_pos = actor.getPosition();\r\n\t\t\t\t\tlet renderBB = actor.getRenderingBoundingBox();\r\n\t\t\t\t\tthis.sceneRenderer.rect(\r\n\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t\tactor_pos.x + renderBB.x,\r\n\t\t\t\t\t\tactor_pos.y + renderBB.y,\r\n\t\t\t\t\t\trenderBB.width,\r\n\t\t\t\t\t\trenderBB.height,\r\n\t\t\t\t\t\tColor.RED\r\n\t\t\t\t\t)\r\n\r\n\t\t\t\t\tthis.sceneRenderer.rect(\r\n\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t\t0,0, actor.config.maxSizePx, actor.config.maxSizePx,\r\n\t\t\t\t\t\tColor.ORANGE\r\n\t\t\t\t\t)\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.sceneRenderer.circle(true, actor_pos.x, actor_pos.y, 10, Color.RED);\r\n\t\t\t\t\tthis.sceneRenderer.circle(true, 0,0, 10, Color.BLUE);\r\n\t\t\t\t\t// this.sceneRenderer.circle(true, actor_pos.x, actor_pos.y + actor.defaultBB.height, 5, Color.BLUE);\r\n\r\n\t\t\t\t\tthis.sceneRenderer.end();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.broadcastRenderCallback();\r\n\r\n\t\t\tif (all_actors_loaded) {\r\n\t\t\t\tthis.assetManager.clearErrors();\r\n\t\t\t\tthis.hideError();\r\n\t\t\t}\r\n\t\t\tthis.windowFpsFrameCount += 1;\r\n\t\t}\r\n\r\n\r\n\t\tpublic registerRenderCallback(callback: RenderCallbackFn) : RemoveCallbackFn{\r\n\t\t\tthis.renderCallbacks.push(callback);\r\n\t\t\treturn () => {\r\n\t\t\t\tthis.renderCallbacks = this.renderCallbacks.filter(c => c !== callback);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tbroadcastRenderCallback() {\r\n\t\t\tfor (let i = 0; i < this.renderCallbacks.length; i++) {\r\n\t\t\t\tthis.renderCallbacks[i](this.context);;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tscale(sourceWidth: number, sourceHeight: number, targetWidth: number, targetHeight: number): Vector2 {\r\n\t\t\tlet targetRatio = targetHeight / targetWidth;\r\n\t\t\tlet sourceRatio = sourceHeight / sourceWidth;\r\n\t\t\tlet scale = targetRatio > sourceRatio ? targetWidth / sourceWidth : targetHeight / sourceHeight;\r\n\t\t\tlet temp = new Vector2();\r\n\t\t\ttemp.x = sourceWidth * scale;\r\n\t\t\ttemp.y = sourceHeight * scale;\r\n\t\t\treturn temp;\r\n\t\t}\r\n\r\n\t\tloadSkeleton (actor: Actor) {\r\n\t\t\tif (actor.loaded || actor.load_perma_failed) return;\r\n\r\n\t\t\tif (this.assetManager.hasErrors()) {\r\n\t\t\t\tthis.showError(actor, \"Error: assets could not be loaded.<br><br>\" + escapeHtml(JSON.stringify(this.assetManager.getErrors())));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet atlas = this.assetManager.get(actor.config.atlasUrl);\r\n\t\t\tlet skeletonData: SkeletonData;\r\n\t\t\tif (actor.config.jsonUrl) {\r\n\t\t\t\tlet jsonText = this.assetManager.get(actor.config.jsonUrl);\r\n\t\t\t\tlet json = new SkeletonJson(new AtlasAttachmentLoader(atlas));\r\n\t\t\t\ttry {\r\n\t\t\t\t\tskeletonData = json.readSkeletonData(jsonText);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tthis.showError(actor, \"Error: could not load skeleton .json.<br><br>\" + escapeHtml(JSON.stringify(e)));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet binaryData = this.assetManager.get(actor.config.skelUrl);\r\n\t\t\t\tlet binary = new SkeletonBinary(new AtlasAttachmentLoader(atlas));\r\n\t\t\t\ttry {\r\n\t\t\t\t\tskeletonData = binary.readSkeletonData(binaryData);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tthis.showError(actor, \"Error: could not load skeleton .skel.<br><br>\" + escapeHtml(JSON.stringify(e)));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tactor.skeleton = new Skeleton(skeletonData);\r\n\t\t\t\r\n\t\t\t// Setup skin\r\n\t\t\tif (!actor.config.skin) {\r\n\t\t\t\tif (skeletonData.skins.length > 0) {\r\n\t\t\t\t\tactor.config.skin = skeletonData.skins[0].name;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (actor.config.skins && actor.config.skin.length > 0) {\r\n\t\t\t\tactor.config.skins.forEach(skin => {\r\n\t\t\t\t\tif (!actor.skeleton.data.findSkin(skin)) {\r\n\t\t\t\t\t\tthis.showError(actor, `Error: skin '${skin}' in selectable skin list does not exist in skeleton.`);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (actor.config.skin) {\r\n\t\t\t\tif (!actor.skeleton.data.findSkin(actor.config.skin)) {\r\n\t\t\t\t\tthis.showError(actor, `Error: skin '${actor.config.skin}' does not exist in skeleton.`);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tactor.skeleton.setSkinByName(actor.config.skin);\r\n\t\t\t\tactor.skeleton.setSlotsToSetupPose();\r\n\t\t\t}\r\n\t\t\tactor.InitAnimationState();\r\n\r\n\t\t\tactor.config.success(this, actor);\r\n\t\t\tactor.loaded = true;\r\n\t\t}\r\n\r\n\t\tprivate cancelId: any = 0;\r\n\t\tprivate setupInput () {\r\n\t\t\tlet canvas = this.canvas;\r\n\t\t\tlet input = new Input(canvas);\r\n\t\t\tinput.addListener({\r\n\t\t\t\tdown: (x, y) => {},\r\n\t\t\t\tdragged: (x, y) => {},\r\n\t\t\t\tmoved: (x, y) => {},\r\n\t\t\t\tup: (x, y) => {\r\n\t\t\t\t\tif (!this.playerConfig.showControls) return;\r\n\t\t\t\t\tif (this.paused) {\r\n\t\t\t\t\t\tthis.play()\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.pause()\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t});\r\n\r\n\t\t\t// For the manual hover to work, we need to disable\r\n\t\t\t// hidding the controls if the mouse/touch entered\r\n\t\t\t// the clickable area of a child of the controls.\r\n\t\t\t// For this we need to register a mouse handler on\r\n\t\t\t// the document and see if we are within the canvas\r\n\t\t\t// area :/\r\n\t\t\tvar mouseOverControls = true;\r\n\t\t\tvar mouseOverCanvas = false;\r\n\t\t\tdocument.addEventListener(\"mousemove\", (ev: UIEvent) => {\r\n\t\t\t\tif (ev instanceof MouseEvent) {\r\n\t\t\t\t\thandleHover(ev.clientX, ev.clientY);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tdocument.addEventListener(\"touchmove\", (ev: UIEvent) => {\r\n\t\t\t\tif (ev instanceof TouchEvent) {\r\n\t\t\t\t\tvar touches = ev.changedTouches;\r\n\t\t\t\t\tif (touches.length > 0) {\r\n\t\t\t\t\t\tvar touch = touches[0];\r\n\t\t\t\t\t\thandleHover(touch.clientX, touch.clientY);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tlet handleHover = (mouseX: number, mouseY: number) => {\r\n\t\t\t\t// if (!this.config.showControls) return;\r\n\t\t\t\tif (!this.playerConfig.showControls) return;\r\n\r\n\t\t\t\tlet popup = findWithClass(this.dom, \"spine-player-popup\");\r\n\t\t\t\tmouseOverControls = overlap(mouseX, mouseY, this.playerControls.getBoundingClientRect());\r\n\t\t\t\tmouseOverCanvas = overlap(mouseX, mouseY, this.canvas.getBoundingClientRect());\r\n\t\t\t\tclearTimeout(this.cancelId);\r\n\t\t\t\tlet hide = popup.length == 0 && !mouseOverControls && !mouseOverCanvas && !this.paused;\r\n\t\t\t\tif (hide) {\r\n\t\t\t\t\tthis.playerControls.classList.add(\"spine-player-controls-hidden\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.playerControls.classList.remove(\"spine-player-controls-hidden\");\r\n\t\t\t\t}\r\n\t\t\t\tif (!mouseOverControls && popup.length == 0 && !this.paused) {\r\n\t\t\t\t\tlet remove = () => {\r\n\t\t\t\t\t\tif (!this.paused) this.playerControls.classList.add(\"spine-player-controls-hidden\");\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.cancelId = setTimeout(remove, 1000);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet overlap = (mouseX: number, mouseY: number, rect: DOMRect | ClientRect): boolean => {\r\n\t\t\t\tlet x = mouseX - rect.left;\r\n\t\t\t\tlet y = mouseY - rect.top;\r\n\t\t\t\treturn x >= 0 && x <= rect.width && y >= 0 && y <= rect.height;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate play () {\r\n\t\t\tthis.paused = false;\r\n\t\t\tlet remove = () => {\r\n\t\t\t\tif (!this.paused) this.playerControls.classList.add(\"spine-player-controls-hidden\");\r\n\t\t\t};\r\n\t\t\tthis.cancelId = setTimeout(remove, 1000);\r\n\t\t\tthis.playButton.classList.remove(\"spine-player-button-icon-play\");\r\n\t\t\tthis.playButton.classList.add(\"spine-player-button-icon-pause\");\r\n\r\n\t\t\tfor(let [key,actor] of this.actors) {\r\n\t\t\t\tactor.paused = false;\r\n\t\t\t\tif (actor.animationState) {\r\n\t\t\t\t\tif (!actor.animationState.getCurrent(0)) {\r\n\t\t\t\t\t\tactor.InitAnimations();\r\n\t\t\t\t\t\t// this.setAnimations(actor, actor.GetAnimations());\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate pause () {\r\n\t\t\tthis.paused = true;\r\n\t\t\tthis.playerControls.classList.remove(\"spine-player-controls-hidden\");\r\n\t\t\tclearTimeout(this.cancelId);\r\n\r\n\t\t\tthis.playButton.classList.remove(\"spine-player-button-icon-pause\");\r\n\t\t\tthis.playButton.classList.add(\"spine-player-button-icon-play\");\r\n\r\n\t\t\tfor(let [key, actor] of this.actors) {\r\n\t\t\t\tactor.paused = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Exposed only for testing.\r\n\t\tpublic getSceneRenderer() : SceneRenderer {\r\n\t\t\treturn this.sceneRenderer;\r\n\t\t}\r\n\t}\r\n\r\n//  }\r\n","\r\nimport { Actor, SpineActorConfig } from \"../player/Actor\";\r\nimport { SpinePlayer, SpinePlayerConfig } from \"../player/Player\";\r\n\r\nexport interface RuntimeConfig {\r\n    width: number,\r\n    height: number\r\n    debugMode: boolean\r\n    chibiScale: number\r\n}\r\n\r\nexport class Runtime {\r\n    public socket: WebSocket;\r\n    public spinePlayer: SpinePlayer;\r\n    public spinePlayerConfig: SpinePlayerConfig;\r\n    public actorConfig: SpineActorConfig;\r\n    public defaultBackoffTimeMsec: number;\r\n    public backoffTimeMsec: number;\r\n    public backOffMaxtimeMsec: number;\r\n    public channelName: string;\r\n    public runtimeConfig: RuntimeConfig;\r\n\r\n    constructor(channelName: string, config: RuntimeConfig) {\r\n        this.runtimeConfig = config;\r\n        const { width, height, debugMode, chibiScale } = config;\r\n\r\n        // TODO: Make the fonts configurable\r\n        let font = new FontFace(\"lato\", \"url(/public/fonts/Lato/Lato-Black.ttf)\");\r\n        font.load().then(() => { document.fonts.add(font); })\r\n\r\n        this.channelName = channelName;\r\n        this.socket = null;\r\n        this.spinePlayer = null;\r\n        this.defaultBackoffTimeMsec = 15 * 1000; // 15 seconds\r\n        this.backoffTimeMsec = 15 * 1000; // 15 seconds\r\n        this.backOffMaxtimeMsec = 5 * 60 * 1000; // 5 minutes\r\n        this.openWebSocket(this.channelName);\r\n\r\n        if (this.spinePlayer == null) {\r\n            this.spinePlayerConfig = {\r\n                backgroundColor: \"#00000000\",\r\n                alpha: true,\r\n                showControls: true,\r\n                viewport: {\r\n                    x: 0,\r\n                    y: 0,\r\n                    width: width,\r\n                    height: height,\r\n                    padLeft: 0,\r\n                    padRight: 0,\r\n                    padTop: 0,\r\n                    padBottom: 0,\r\n                    debugRender: debugMode,\r\n                },\r\n                fullScreenBackgroundColor: null,\r\n                backgroundImage: null,\r\n                textSize: 14,\r\n                textFont: \"lato\",\r\n                runtimeDebugInfoDumpIntervalSec: 60,\r\n                chibiScale: this.runtimeConfig.chibiScale,\r\n\r\n                cameraPerspectiveNear: 1,\r\n                cameraPerspectiveFar: 2000,\r\n            };\r\n\r\n            console.log(\"Creating a new spine player\");\r\n            this.spinePlayer = new SpinePlayer(\"container\", this.spinePlayerConfig);\r\n        }\r\n    }\r\n\r\n    openWebSocket(channelName: string) {\r\n        const protocolPrefix = (window.location.protocol === 'https:') ? 'wss:' : 'ws:';\r\n        const websocketPath = protocolPrefix + '//' + location.host + `/ws/?channelName=${channelName}`;\r\n\r\n        console.log(\"Openning websocket\");\r\n        this.socket = new WebSocket(websocketPath);\r\n        this.socket.addEventListener(\"open\", (event) => {\r\n            console.log(\"Socket opened\");\r\n            this.backoffTimeMsec = this.defaultBackoffTimeMsec;\r\n            this.spinePlayer.setWebsocket(this.socket);\r\n        });\r\n        this.socket.addEventListener(\"message\",\r\n            this.messageHandler.bind(this)\r\n        );\r\n        this.socket.addEventListener(\"close\", (event) => {\r\n            console.log(\"Close received: \", event);\r\n            this.spinePlayer.setWebsocket(null);\r\n\r\n            // if (event.code >= 1000 && event.code <= 1002) {\r\n            //     return\r\n            // }\r\n            this.backoffTimeMsec *= 2;\r\n            if (this.backoffTimeMsec < this.backOffMaxtimeMsec) {\r\n                console.log(\"Retrying in \" + this.backoffTimeMsec + \"ms\");\r\n                setTimeout(() => this.openWebSocket(this.channelName), this.backoffTimeMsec);\r\n            }\r\n        });\r\n        this.socket.addEventListener(\"error\", (event) => {\r\n            console.log(\"Error received: \", event);\r\n        });\r\n    }\r\n\r\n    messageHandler(event: MessageEvent) {\r\n        let requestData = JSON.parse(event.data)\r\n        console.log(\"Message received: \", requestData);\r\n\r\n        if (requestData[\"type_name\"] == \"SET_OPERATOR\") {\r\n            this.swapCharacter(requestData)\r\n        } else if (requestData[\"type_name\"] == \"REMOVE_OPERATOR\") {\r\n            this.removeCharacter(requestData);\r\n        }\r\n    }\r\n\r\n    swapCharacter(requestData: any) {\r\n        let username = requestData[\"user_name\"];\r\n        let startPosX = null;\r\n        let startPosY = null;\r\n        if (requestData[\"start_pos\"] != null) {\r\n            startPosX = requestData[\"start_pos\"][\"x\"];\r\n            startPosY = requestData[\"start_pos\"][\"y\"];\r\n        }\r\n        let configScaleX = 1;\r\n        let configScaleY = 1;\r\n        if (requestData[\"sprite_scale\"] != null) {\r\n            configScaleX = requestData[\"sprite_scale\"][\"x\"];\r\n            configScaleY = requestData[\"sprite_scale\"][\"y\"];\r\n        }\r\n        let configMaxPixelSize = 350;\r\n        if (requestData[\"max_sprite_pixel_size\"] != null) {\r\n            configMaxPixelSize = requestData[\"max_sprite_pixel_size\"];\r\n        }\r\n\r\n        let referenceMovementSpeedPx = 80;\r\n        let referenceMovementSpeedPy = 80;\r\n        let referenceMovementSpeedPz = 80;\r\n        if (requestData[\"movement_speed_px\"] != null) {\r\n            referenceMovementSpeedPx = requestData[\"movement_speed_px\"];\r\n        }\r\n        if (requestData[\"movement_speed_py\"] != null) {\r\n            referenceMovementSpeedPx = requestData[\"movement_speed_py\"];\r\n        }\r\n        if (requestData[\"movement_speed_pz\"] != null) {\r\n            referenceMovementSpeedPz = requestData[\"movement_speed_pz\"];\r\n        }\r\n        let movementSpeedPxX = null;\r\n        let movementSpeedPxY = null;\r\n        let movementSpeedPxZ = referenceMovementSpeedPz;\r\n        if (requestData[\"movement_speed\"] != null) {\r\n            movementSpeedPxX = Math.floor(requestData[\"movement_speed\"][\"x\"] * referenceMovementSpeedPx);\r\n            movementSpeedPxY = Math.floor(requestData[\"movement_speed\"][\"y\"] * referenceMovementSpeedPy);\r\n            // movementSpeedPxZ = Math.floor(requestData[\"movement_speed\"][\"z\"] * referenceMovementSpeedPz);\r\n        }\r\n        let defaultMovementSpeedPxX = referenceMovementSpeedPx;\r\n        let defaultMovementSpeedPxY = referenceMovementSpeedPy;\r\n        let defaultMovementSpeedPxZ = referenceMovementSpeedPz;\r\n\r\n        this.actorConfig = {\r\n            chibiId: requestData[\"operator_id\"],\r\n            userDisplayName: requestData['user_name_display'],\r\n            skelUrl: requestData[\"skel_file\"],\r\n            atlasUrl: requestData[\"atlas_file\"],\r\n\r\n            startPosX: startPosX,\r\n            startPosY: startPosY,\r\n            defaultMovementSpeedPxX: defaultMovementSpeedPxX,\r\n            defaultMovementSpeedPxY: defaultMovementSpeedPxY,\r\n            defaultMovementSpeedPxZ: defaultMovementSpeedPxZ,\r\n            movementSpeedPxX: movementSpeedPxX,\r\n            movementSpeedPxY: movementSpeedPxY,\r\n            movementSpeedPxZ: movementSpeedPxZ,\r\n\r\n            configScaleX: configScaleX,\r\n            configScaleY: configScaleY,\r\n            scaleX: 0.45 * this.runtimeConfig.chibiScale * configScaleX,\r\n            scaleY: 0.45 * this.runtimeConfig.chibiScale * configScaleY,\r\n            maxSizePx: configMaxPixelSize,\r\n            premultipliedAlpha: true,\r\n            animationPlaySpeed: requestData[\"animation_speed\"] ? requestData[\"animation_speed\"] : 1.0,\r\n            extraOffsetX: 0,\r\n            extraOffsetY: 0,\r\n\r\n            action: requestData[\"action\"],\r\n            action_data: requestData[\"action_data\"],\r\n\r\n            success: (widget, actor) => {\r\n                // console.log(\"Successfully loaded actor\");\r\n            },\r\n            error: (widget, actor: Actor, error) => {\r\n                actor.load_attempts += 1;\r\n                if (actor.load_attempts > actor.max_load_attempts) {\r\n                    actor.load_perma_failed = true;\r\n                }\r\n                console.log(this);\r\n                console.log(error);\r\n            }\r\n        };\r\n\r\n        this.spinePlayer.addActorToUpdateQueue(username, this.actorConfig);\r\n    }\r\n\r\n    removeCharacter(requestData: any) {\r\n        if (this.spinePlayer) {\r\n            this.spinePlayer.removeActor(requestData[\"user_name\"]);\r\n        }\r\n    }\r\n}\r\n","\r\nexport function setContainerSizeFromQuery(searchParams: URLSearchParams) {\r\n    let containerWidth = searchParams.has('width')\r\n        ? Number.parseInt(searchParams.get('width'))\r\n        : 1920;\r\n    let containerHeight = searchParams.has('height')\r\n        ? Number.parseInt(searchParams.get('height'))\r\n        : 1080;\r\n    let container = document.getElementById(\"container\")\r\n    if (!Number.isInteger(containerWidth)) {\r\n        containerWidth = 1920;\r\n    }\r\n    if (!Number.isInteger(containerHeight)) {\r\n        containerHeight = 1080;\r\n    }\r\n    containerWidth = Math.max(containerWidth, 0)\r\n    containerHeight = Math.max(containerHeight, 0)\r\n\r\n    // const windowWidth = window.screen.availWidth;\r\n    // const windowHeight = window.screen.availHeight;\r\n    // containerWidth = Math.min(containerWidth, windowWidth);\r\n    // containerHeight = Math.min(containerHeight, windowHeight);\r\n\r\n    console.log(containerWidth, containerHeight);\r\n    container.style.width = `${containerWidth}px`\r\n    container.style.height = `${containerHeight}px`\r\n    return [containerWidth, containerHeight];\r\n}\r\n\r\nexport function getRuntimeConfigFromQueryParams(searchParams: URLSearchParams) {\r\n    const debugMode = searchParams.get('debug') === 'true';\r\n    const scale = Math.max(Math.min((parseFloat(searchParams.get('scale')) || 1), 3), 0.1);\r\n    const [containerWidth, containerHeight] = setContainerSizeFromQuery(searchParams);\r\n    return {\r\n        width: containerWidth,\r\n        height: containerHeight,\r\n        debugMode: debugMode,\r\n        chibiScale: scale\r\n    }\r\n}"],"names":["Texture","_image","constructor","image","this","getImage","filterFromString","text","toLowerCase","TextureFilter","Nearest","Linear","MipMap","MipMapNearestNearest","MipMapLinearNearest","MipMapNearestLinear","MipMapLinearLinear","Error","wrapFromString","TextureWrap","MirroredRepeat","ClampToEdge","Repeat","BlendMode","TransformMode","PositionMode","SpacingMode","RotateMode","MixBlend","MixDirection","TimelineType","TextureRegion","renderObject","u","v","u2","v2","width","height","rotate","offsetX","offsetY","originalWidth","originalHeight","FakeTexture","setFilters","minFilter","magFilter","setWraps","uWrap","vWrap","dispose","TextureAtlas","pages","Array","regions","atlasText","textureLoader","load","reader","TextureAtlasReader","tuple","page","line","readLine","trim","length","region","TextureAtlasRegion","name","rotateValue","readValue","toLocaleLowerCase","degrees","parseFloat","readTuple","x","parseInt","y","Math","abs","index","texture","push","TextureAtlasPage","direction","findRegion","i","lines","split","colon","indexOf","substring","lastMatch","comma","substr","pathPrefix","assets","errors","toLoad","loaded","rawDataUris","encodePath","path","parts","encodeURIComponent","join","downloadText","url","success","error","data","textData","atob","request","XMLHttpRequest","overrideMimeType","open","onload","status","responseText","onerror","send","base64ToArrayBuffer","base64","binaryString","bytes","Uint8Array","charCodeAt","downloadBinary","data64","binaryData","console","log","responseType","response","setRawDataURI","loadBinary","state","loadText","loadTexture","storagePath","img","Image","crossOrigin","ev","src","loadTextureAtlas","parent","lastIndexOf","atlasData","pagesLoaded","count","atlasPages","document","createElement","e","ex","message","atlasPage","pageLoadError","imagePath","atlas","get","errorMessage","remove","asset","removeAll","key","isLoadingComplete","getToLoad","getLoaded","hasErrors","Object","keys","getErrors","clearErrors","ManagedWebGLRenderingContext","canvas","gl","restorables","canvasOrContext","contextConfig","alpha","HTMLCanvasElement","OffscreenCanvas","getContext","addEventListener","preventDefault","n","restore","addRestorable","restorable","removeRestorable","splice","WebGLBlendModeConverter","static","getDestGLBlendMode","blendMode","Normal","ONE_MINUS_SRC_ALPHA","Additive","ONE","Multiply","Screen","getSourceGLBlendMode","premultipliedAlpha","SRC_ALPHA","DST_COLOR","GLTexture","context","boundUnit","useMipMaps","super","bind","texParameteri","TEXTURE_2D","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","validateMagFilter","TEXTURE_WRAP_S","TEXTURE_WRAP_T","update","createTexture","DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","texImage2D","RGBA","UNSIGNED_BYTE","LINEAR","LINEAR_MIPMAP_LINEAR","CLAMP_TO_EDGE","generateMipmap","unit","activeTexture","TEXTURE0","bindTexture","unbind","deleteTexture","AssetManager","altTextures","WebGLRenderingContext","ctx","IntSet","array","add","value","contains","undefined","clear","Color","r","g","b","a","set","clamp","setFromColor","c","setFromString","hex","charAt","rgba8888ToColor","color","rgb888ToColor","MathUtils","PI","radiansToDegrees","degreesToRadians","min","max","cosDeg","cos","degRad","sinDeg","sin","signum","toInt","floor","ceil","cbrt","pow","randomTriangular","randomTriangularWith","mode","random","d","sqrt","Utils","arrayCopy","source","sourceStart","dest","destStart","numElements","j","setArraySize","size","oldSize","ensureArrayCapacity","newArray","defaultValue","newFloatArray","SUPPORTS_TYPED_ARRAYS","Float32Array","newShortArray","Int16Array","toFloatArray","toSinglePrecision","fround","webkit602BugfixHelper","blend","element","identity","Pool","items","instantiator","obtain","pop","free","item","reset","freeAll","Vector2","subtract","other","normalize","len","normalize_new","angle","dot","len_a","len_b","acos","TimeKeeper","maxDelta","framesPerSecond","delta","totalTime","lastTime","Date","now","frameCount","frameTime","Attachment","VertexAttachment","id","nextID","bones","vertices","worldVerticesLength","deformAttachment","computeWorldVertices","slot","start","worldVertices","offset","stride","skeleton","bone","deformArray","deform","worldX","worldY","w","vx","vy","skip","skeletonBones","wx","wy","weight","f","copyTo","attachment","BoundingBoxAttachment","copy","ClippingAttachment","endSlot","MeshAttachment","regionUVs","uvs","triangles","hullLength","edges","parentMesh","tempColor","updateUVs","textureWidth","textureHeight","getParentMesh","setParentMesh","newLinkedMesh","PathAttachment","lengths","closed","constantSpeed","PointAttachment","rotation","computeWorldPosition","point","computeWorldRotation","atan2","radDeg","RegionAttachment","scaleX","scaleY","rendererObject","updateOffset","regionScaleX","regionScaleY","localX","localY","localX2","localY2","radians","localXCos","localXSin","localYCos","localYSin","localX2Cos","localX2Sin","localY2Cos","localY2Sin","OX1","OY1","OX2","OY2","OX3","OY3","OX4","OY4","setRegion","vertexOffset","AtlasAttachmentLoader","newRegionAttachment","skin","newMeshAttachment","newBoundingBoxAttachment","newPathAttachment","newPointAttachment","newClippingAttachment","BoneData","shearX","shearY","transformMode","skinRequired","Bone","children","ax","ay","arotation","ascaleX","ascaleY","ashearX","ashearY","appliedValid","sorted","active","setToSetupPose","isActive","updateWorldTransformWith","updateWorldTransform","rotationY","sx","sy","pa","pb","pc","pd","la","lb","lc","ld","OnlyTranslation","NoRotationOrReflection","s","prx","rx","ry","sign","NoScale","NoScaleOrReflection","za","zc","zb","zd","getWorldRotationX","getWorldRotationY","getWorldScaleX","getWorldScaleY","updateAppliedTransform","pid","dx","dy","ia","ib","ic","ra","rb","rc","rd","det","worldToLocal","world","invDet","localToWorld","local","worldToLocalRotation","worldRotation","localToWorldRotation","localRotation","rotateWorld","IkConstraint","target","bendDirection","compress","stretch","mix","softness","findBone","apply","apply1","uniform","apply2","targetX","targetY","p","rotationIK","tx","ty","ps","dd","child","bendDir","px","py","psx","psy","csx","os1","os2","s2","cx","cy","cwx","cwy","pp","a1","a2","l1","l2","td","sd","outer","aa","bb","ta","c1","c2","q","r0","r1","minAngle","minX","minDist","minY","maxAngle","maxX","maxDist","maxY","os","ConstraintData","order","PathConstraintData","positionMode","spacingMode","rotateMode","offsetRotation","position","spacing","rotateMix","translateMix","PathConstraint","spaces","positions","curves","segments","findSlot","getAttachment","percentSpacing","Percent","tangents","Tangent","scale","ChainScale","boneCount","spacesCount","lengthSpacing","Length","setupLength","epsilon","computeWorldPositions","boneX","boneY","tip","Chain","PI2","percentPosition","out","verticesLength","curveCount","prevCurve","NONE","pathLength","o","curve","space","BEFORE","addBeforePosition","AFTER","addAfterPosition","prev","addCurvePosition","x1","y1","cx1","cy1","cx2","cy2","x2","y2","tmpx","tmpy","dddfx","dddfy","ddfx","ddfy","dfx","dfy","curveLength","segment","ii","temp","isNaN","tt","ttt","uu","uuu","ut","ut3","uut3","utt3","Slot","darkColor","attachmentTime","attachmentState","getSkeleton","setAttachment","time","setAttachmentTime","getAttachmentTime","attachmentName","TransformConstraint","scaleMix","shearMix","relative","applyRelativeLocal","applyAbsoluteLocal","applyRelativeWorld","applyAbsoluteWorld","tb","tc","degRadReflect","offsetShearY","modified","ts","offsetScaleX","offsetScaleY","by","Skeleton","slots","drawOrder","ikConstraints","transformConstraints","pathConstraints","_updateCache","updateCacheReset","boneData","slotData","ikConstraintData","transformConstraintData","pathConstraintData","updateCache","skinBones","ikCount","transformCount","pathCount","constraintCount","constraint","sortIkConstraint","sortTransformConstraint","sortPathConstraint","sortBone","constraints","constrained","sortReset","slotIndex","slotBone","sortPathConstraintAttachment","defaultSkin","skins","sortPathConstraintAttachmentWith","attachments","pathBones","boneIndex","setBonesToSetupPose","setSlotsToSetupPose","getRootBone","boneName","findBoneIndex","slotName","findSlotIndex","setSkinByName","skinName","findSkin","setSkin","newSkin","attachAll","getAttachmentByName","findIkConstraint","constraintName","ikConstraint","findTransformConstraint","findPathConstraint","getBounds","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","mesh","nn","Animation","timelines","timelineIds","duration","getPropertyId","hasTimeline","loop","events","binarySearch","values","step","low","high","current","linearSearch","last","CurveTimeline","BEZIER_SIZE","getFrameCount","setLinear","frameIndex","setStepped","STEPPED","getCurveType","type","BEZIER","setCurve","getCurvePercent","percent","prevX","prevY","RotateTimeline","frames","setFrame","ROTATION","setup","first","ENTRIES","PREV_ROTATION","replace","frame","prevRotation","PREV_TIME","TranslateTimeline","translate","X","Y","PREV_X","PREV_Y","ScaleTimeline","bx","mixOut","ShearTimeline","shear","ColorTimeline","R","G","B","A","PREV_R","PREV_G","PREV_B","PREV_A","TwoColorTimeline","twoColor","r2","g2","b2","R2","G2","B2","light","dark","setupLight","setupDark","PREV_R2","PREV_G2","PREV_B2","AttachmentTimeline","attachmentNames","zeros","DeformTimeline","frameVertices","firedEvents","slotAttachment","vertexCount","vertexAttachment","setupVertices","lastVertices","prevVertices","nextVertices","EventTimeline","event","MAX_VALUE","DrawOrderTimeline","drawOrders","drawOrderToSetupIndex","IkConstraintTimeline","ikConstraintIndex","MIX","SOFTNESS","BEND_DIRECTION","COMPRESS","STRETCH","PREV_MIX","PREV_SOFTNESS","PREV_BEND_DIRECTION","PREV_COMPRESS","PREV_STRETCH","mixIn","TransformConstraintTimeline","transformConstraintIndex","transformConstraint","ROTATE","TRANSLATE","SCALE","SHEAR","PREV_ROTATE","PREV_TRANSLATE","PREV_SCALE","PREV_SHEAR","PathConstraintPositionTimeline","pathConstraintIndex","pathConstraintPosition","VALUE","PREV_VALUE","PathConstraintSpacingTimeline","pathConstraintSpacing","PathConstraintMixTimeline","pathConstraintMix","AttachmentType","Event","intValue","floatValue","stringValue","volume","balance","EventData","audioPath","IkConstraintData","SkeletonData","animations","version","hash","fps","imagesPath","findEvent","eventDataName","findAnimation","animationName","animation","findPathConstraintIndex","pathConstraintName","SkinEntry","Skin","addSkin","contained","getAttachments","copySkin","dictionary","removeAttachment","entries","slotAttachments","getAttachmentsForSlot","oldSkin","SlotData","TransformConstraintData","SkeletonBinary","Fixed","attachmentLoader","linkedMeshes","readSkeletonData","binary","skeletonData","input","BinaryInput","readString","readFloat","nonessential","readBoolean","readInt","strings","TransformModeValues","readInt32","readStringRef","BlendModeValues","readByte","PositionModeValues","SpacingModeValues","RotateModeValues","readSkin","linkedMesh","inheritDeform","readAnimation","slotCount","readAttachment","typeIndex","AttachmentTypeValues","Region","BoundingBox","readVertices","box","Mesh","readFloatArray","readShortArray","LinkedMesh","Path","Point","Clipping","endSlotIndex","clip","Vertices","weights","bonesArray","readShort","tempColor1","tempColor2","timelineType","SLOT_ATTACHMENT","timeline","SLOT_COLOR","readCurve","SLOT_TWO_COLOR","BONE_ROTATE","BONE_TRANSLATE","BONE_SCALE","BONE_SHEAR","timelineScale","PATH_POSITION","PATH_SPACING","PATH_MIX","iii","nnn","weighted","deformLength","end","vn","drawOrderCount","offsetCount","unchanged","originalIndex","unchangedIndex","eventCount","eventData","CURVE_STEPPED","CURVE_BEZIER","buffer","DataView","getInt8","getInt16","getInt32","optimizePositive","result","byteCount","chars","String","fromCharCode","getFloat32","SkeletonJson","json","root","JSON","parse","skeletonMap","spine","images","boneMap","parentName","getValue","transformModeFromString","slotMap","blendModeFromString","ik","constraintMap","targetName","transform","positionModeFromString","spacingModeFromString","rotateModeFromString","skinMap","entryName","eventName","eventMap","animationMap","map","scaledVertices","timelineName","timelineMap","valueMap","deformName","deformMap","verticesValue","drawOrderNode","draworder","drawOrderMap","offsets","offsetMap","hasOwnProperty","prop","str","Input","lastX","lastY","buttonDown","currTouch","touchesPool","Touch","listeners","setupCallbacks","mouseMove","MouseEvent","rect","getBoundingClientRect","clientX","left","clientY","top","dragged","moved","mouseUp","up","removeEventListener","down","touches","changedTouches","touch","identifier","addListener","listener","removeListener","idx","Vector3","z","setFrom","sub","cross","multiply","matrix","l_mat","M30","M31","M32","M33","M00","M01","M02","M03","M10","M11","M12","M13","M20","M21","M22","M23","project","l_w","distance","Matrix4","transpose","t","invert","l_det","inv_det","determinant","projection","front","back","fovy","aspectRatio","fovy_rad","tan","right","ortho2d","ortho","bottom","near","far","x_orth","y_orth","z_orth","tz","m","multiplyLeft","lookAt","initTemps","xAxis","yAxis","zAxis","val","tmpMatrix","OrthoCamera","fov","zoom","viewportWidth","viewportHeight","projectionView","inverseProjectionView","view","is_perspective","tmp","screenToWorld","screenCoords","screenWidth","screenHeight","worldToScreen","worldCoords","setViewport","PerspectiveCamera","if_throw","ret","Shader","vertexShader","fragmentShader","vs","vsSource","fs","fsSource","program","tmp2x2","tmp3x3","tmp4x4","getProgram","getVertexShader","getFragmentShader","getVertexShaderSource","getFragmentSource","compile","compileShader","VERTEX_SHADER","FRAGMENT_SHADER","compileProgram","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","isContextLost","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","useProgram","setUniformi","uniform1i","getUniformLocation","setUniformf","uniform1f","setUniform2f","value2","uniform2f","setUniform3f","value3","uniform3f","setUniform4f","value4","uniform4f","setUniform2x2f","uniformMatrix2fv","setUniform3x3f","uniformMatrix3fv","setUniform4x4f","uniformMatrix4fv","location","getAttributeLocation","attribute","getAttribLocation","newColoredTextured","POSITION","COLOR","TEXCOORDS","MVP_MATRIX","newTwoColoredTextured","COLOR2","newColored","attributes","verticesBuffer","dirtyVertices","indices","indicesBuffer","indicesLength","dirtyIndices","elementsPerVertex","getAttributes","maxVertices","numVertices","setVerticesLength","getVertices","maxIndices","numIndices","setIndicesLength","getIndices","getVertexSizeInFloats","Uint16Array","setVertices","setIndices","draw","primitiveType","drawWithOffset","drawElements","UNSIGNED_SHORT","drawArrays","bindBuffer","ARRAY_BUFFER","attrib","enableVertexAttribArray","vertexAttribPointer","FLOAT","ELEMENT_ARRAY_BUFFER","disableVertexAttribArray","createBuffer","bufferData","subarray","DYNAMIC_DRAW","deleteBuffer","VertexAttribute","Position2Attribute","VertexAttributeType","Float","TexCoordAttribute","ColorAttribute","Color2Attribute","ShapeType","ResizeMode","EventType","PolygonBatcher","drawCalls","isDrawing","lastTexture","srcBlend","dstBlend","twoColorTint","begin","enable","BLEND","blendFunc","setBlendMode","flush","indexStart","indicesArray","TRIANGLES","disable","getDrawCalls","ShapeRenderer","shapeType","Filled","vertexIndex","setColor","setColorWith","check","vertex","Line","triangle","filled","x3","y3","color2","color3","quad","x4","y4","color4","rectLine","polygon","polygonVertices","firstX","firstY","circle","radius","subdiv_step","subdiv_step2","subdiv_step3","pre1","pre2","pre4","pre5","tmp1x","tmp1y","tmp2x","tmp2y","fx","fy","SkeletonBounds","boundingBoxes","polygons","polygonPool","updateAabb","boundingBox","aabbCompute","aabbContainsPoint","aabbIntersectsSegment","aabbIntersectsSkeleton","bounds","containsPoint","containsPointPolygon","prevIndex","inside","vertexY","vertexX","intersectsSegment","intersectsSegmentPolygon","width12","height12","det1","det2","width34","height34","det3","getPolygon","getWidth","getHeight","SkeletonDebugRenderer","boneLineColor","boneOriginColor","attachmentLineColor","triangleLineColor","pathColor","clipColor","aabbColor","drawBones","drawRegionAttachments","drawBoundingBoxes","drawMeshHull","drawMeshTriangles","drawPaths","drawSkeletonXY","drawClipping","boneWidth","shapes","ignoredBones","skeletonX","skeletonY","srcFunc","regionAttachment","v1","v3","boxes","LIGHT_GRAY","GREEN","Triangulator","convexPolygons","convexPolygonsIndices","isConcaveArray","polygonIndicesPool","triangulate","verticesArray","isConcave","previous","next","p1","p2","p3","p1x","p1y","p2x","p2y","p3x","p3y","positiveArea","previousIndex","nextIndex","decompose","polygonIndices","fanBaseIndex","lastWinding","t1","t2","t3","merged","winding1","winding","winding2","firstIndex","lastIndex","prevPrevX","prevPrevY","secondX","secondY","otherIndices","otherFirstIndex","otherSecondIndex","otherLastIndex","otherPoly","SkeletonClipping","triangulator","clippingPolygon","clipOutput","clippedVertices","clippedTriangles","scratch","clipAttachment","clippingPolygons","clipStart","makeClockwise","clipEndWithSlot","clipEnd","isClipping","clipTriangles","trianglesLength","polygonsCount","vertexSize","u1","u3","clippedVerticesItems","clippedTrianglesItems","clipOutputLength","d0","d1","d2","d4","clipOutputCount","clipOutputItems","c0","clippingArea","output","originalOutput","clipped","clippingVertices","clippingVerticesLast","edgeX","edgeY","edgeX2","edgeY2","deltaX","deltaY","inputVertices","inputVerticesLength","outputStart","inputX","inputY","inputX2","inputY2","side2","ua","verticeslength","area","Renderable","numFloats","SkeletonRenderer","vertexEffect","renderable","clipper","temp2","temp3","temp4","batcher","slotRangeStart","slotRangeEnd","tempPos","tempUv","tempLight","tempDark","attachmentColor","skeletonColor","inRange","clippedVertexSize","QUAD_TRIANGLES","slotColor","finalColor","slotBlendMode","verts","SceneRenderer","orthoCamera","perspectiveCamera","camera","batcherShader","shapesShader","activeRenderer","skeletonRenderer","skeletonDebugRenderer","QUAD","WHITE","enableRenderer","drawSkeleton","drawSkeletonDebug","drawTexture","drawTextureUV","drawTextureRotated","pivotX","pivotY","worldOriginX","worldOriginY","fx2","fy2","p4x","p4y","drawRegion","resize","resizeMode","h","clientWidth","clientHeight","viewport","Stretch","Expand","Fit","sourceWidth","sourceHeight","targetWidth","targetHeight","renderer","LoadingScreen","logo","spinner","fadeOut","timeKeeper","backgroundColor","firstDraw","logoImg","isSafari","navigator","userAgent","SPINE_LOGO_DATA","spinnerImg","SPINNER_DATA","complete","FADE_SECONDS","clearColor","COLOR_BUFFER_BIT","logoWidth","logoHeight","spinnerWidth","spinnerHeight","AnimationState","tracks","timeScale","unkeyedState","queue","EventQueue","propertyIDs","animationsChanged","trackEntryPool","TrackEntry","animationLast","nextAnimationLast","trackLast","nextTrackLast","currentDelta","delay","nextTime","trackTime","setCurrent","mixingFrom","mixTime","trackEnd","disposeNext","updateMixingFrom","from","mixingTo","drain","to","finished","mixDuration","totalAlpha","interruptAlpha","_animationsChanged","applied","mixBlend","applyMixingFrom","animationTime","getAnimationTime","timelineCount","applyAttachmentTimeline","timelineMode","firstFrame","timelinesRotation","timelineBlend","SUBSEQUENT","applyRotateTimeline","queueEvents","setupState","SETUP","eventThreshold","attachmentThreshold","drawOrderThreshold","alphaHold","alphaMix","timelineHoldMix","FIRST","HOLD","holdMix","CURRENT","rotateTimeline","total","diff","lastTotal","lastDiff","dir","entry","animationStart","animationEnd","trackLastWrapped","clearTracks","oldDrainDisabled","drainDisabled","clearTrack","trackIndex","interrupt","expandToIndex","setAnimation","setAnimationWith","trackEntry","addAnimation","addAnimationWith","getMix","setEmptyAnimation","emptyAnimation","addEmptyAnimation","setEmptyAnimations","holdPrevious","computeHold","timelinesCount","timelineDipMix","HOLD_MIX","getCurrent","clearListeners","clearListenerNotifications","setAnimationLast","isComplete","resetRotationDirections","objects","animState","AnimationStateData","animationToMixTime","defaultMix","setMix","fromName","toName","setMixWith","ActionName","setActorYPositionByAnimation","actor","startPosYScaled","config","startPosY","setPositionY","isSitting","includes","canvasBB","IsEnemySprite","PlayAnimationAction","actionData","startPosition","endPosition","currentAnimation","getRandomPosition","currentPos","half","rand","SetAnimation","GetAnimations","UpdatePhysics","deltaSecs","getPosition","setPosition","setVelocity","getMovementSpeedX","getMovementSpeedY","WanderAction","WalkToAction","startDir","reachedDestination","InitAnimationState","PaceAroundAction","tempPosition","z1","z2","getPosition3","getMovementSpeedZ","Actor","animationState","paused","playTime","speed","lastAnimation","canvasBBCalculated","offscreenRender","movementSpeed","velocity","currentAction","load_attempts","max_load_attempts","load_perma_failed","loadedWhen","getTime","ResetWithConfig","startPosX","getRenderingBoundingBox","getPositionX","getPositionY","getPositionZ","setPositionX","setPositionZ","getMovmentSpeed","getMovmentSpeed3","setMovementSpeedX","setMovementSpeedY","setMovementSpeedZ","setMovementSpeed","defaultMovementSpeedPxZ","getVelocity","getVelocity3","InitAnimations","initAnimationsInternal","movementSpeedPxX","movementSpeedPxY","movementSpeedPxZ","defaultMovementSpeedPxX","defaultMovementSpeedPxY","actionName","PLAY_ANIMATION","WANDER","WALK_TO","PACE_AROUND","ParseActionNameToAction","action","action_data","setSkeletonMovementData","stateData","animation_listener","GetUsernameHeaderHeight","renderBB","chibiId","startsWith","IsOperatorSitting","extraOffsetX","extraOffsetY","recordAnimation","setAnimationState","maxSizePx","ratio","xNew","yNew","newScaleX","newScaleY","defaultScaleX","defaultScaleY","getCanvasBoundingBox","animationPlaySpeed","lastTrackEntry","defaultAnimationName","savedX","savedY","savedZ","savedScaleX","savedScaleY","defaultBB","getBoundingBox","OffscreenRender","defaultOffscreenCanvasWidth","defaultOffscreenCanvasHeight","offscreenCanvas","offscreenContext","offscreenSceneRenderer","bg","updateCameraSettings","pixels","readPixels","col","row","getPerspectiveCameraZOffset","fovY","cam","findWithId","dom","found","findRecursive","findWithClass","className","classList","html","innerHTML","escapeHtml","isAlphanumeric","test","Slider","snaps","snapPercentage","big","slider","knob","change","render","setValue","dragging","percentage","modulo","style","SpinePlayer","sceneRenderer","playerControls","textCanvas","textCanvasContext","timelineSlider","playButton","loadingScreen","assetManager","actors","Map","playerConfig","stopRequestAnimationFrame","lastRequestAnimationFrameId","windowFpsFrameCount","webSocket","renderCallbacks","actorQueue","actorQueueIndex","getElementById","validatePlayerConfig","appendChild","setupDom","setWebsocket","fullScreenBackgroundColor","showControls","runtimeDebugInfoDumpIntervalSec","textSize","textFont","cameraPerspectiveNear","cameraPerspectiveFar","validateActorConfig","jsonUrl","skelUrl","atlasUrl","widget","msg","stringify","configScaleX","configScaleY","crypto","randomUUID","userDisplayName","showError","errorDom","hideError","webglConfig","requestAnimationFrame","drawFrame","performance","mark","setInterval","callbackSendRuntimeUpdateInfo","onclick","play","pause","window","onresize","setupInput","measure","averageFps","payload","type_name","average_fps","addActorToUpdateQueue","actorName","setTimeout","consumeActorUpdateQueue","task","shift","changeOrAddActor","has","setupActor","getActor","getActorNames","removeActor","delete","rawDataURIs","backgroundImage","drawText","xpx","ypx","textpos","save","font","textBaseline","measureText","actualBoundingBoxAscent","actualBoundingBoxDescent","beginPath","fillStyle","fillRect","fill","fillText","requestNextFrame","doc","isFullscreen","fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement","clearRect","actorsZOrder","sort","all_actors_loaded","loadSkeleton","animationDuration","bgImage","debugRender","actor_pos","RED","ORANGE","BLUE","broadcastRenderCallback","registerRenderCallback","callback","filter","jsonText","forEach","cancelId","mouseOverControls","mouseOverCanvas","handleHover","TouchEvent","mouseX","mouseY","popup","overlap","clearTimeout","getSceneRenderer","Runtime","socket","spinePlayer","spinePlayerConfig","actorConfig","defaultBackoffTimeMsec","backoffTimeMsec","backOffMaxtimeMsec","channelName","runtimeConfig","debugMode","chibiScale","FontFace","then","fonts","openWebSocket","padLeft","padRight","padTop","padBottom","websocketPath","protocol","host","WebSocket","messageHandler","requestData","swapCharacter","removeCharacter","username","configMaxPixelSize","referenceMovementSpeedPx","referenceMovementSpeedPz","getRuntimeConfigFromQueryParams","searchParams","containerWidth","containerHeight","container","isInteger","setContainerSizeFromQuery"],"sourceRoot":""}