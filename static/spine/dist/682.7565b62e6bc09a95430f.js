"use strict";(self.webpackChunkspine=self.webpackChunkspine||[]).push([[682],{244:(t,e,s)=>{s.d(e,{v:()=>_e});class i{_image;constructor(t){this._image=t}getImage(){return this._image}static filterFromString(t){switch(t.toLowerCase()){case"nearest":return n.Nearest;case"linear":return n.Linear;case"mipmap":return n.MipMap;case"mipmapnearestnearest":return n.MipMapNearestNearest;case"mipmaplinearnearest":return n.MipMapLinearNearest;case"mipmapnearestlinear":return n.MipMapNearestLinear;case"mipmaplinearlinear":return n.MipMapLinearLinear;default:throw new Error(`Unknown texture filter ${t}`)}}static wrapFromString(t){switch(t.toLowerCase()){case"mirroredtepeat":return a.MirroredRepeat;case"clamptoedge":return a.ClampToEdge;case"repeat":return a.Repeat;default:throw new Error(`Unknown texture wrap ${t}`)}}}var n,a,r,o,l,h,c,d,u,m;!function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(n||(n={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(a||(a={}));class g{renderObject;u=0;v=0;u2=0;v2=0;width=0;height=0;rotate=!1;offsetX=0;offsetY=0;originalWidth=0;originalHeight=0}class f extends i{setFilters(t,e){}setWraps(t,e){}dispose(){}}class p{pages=new Array;regions=new Array;constructor(t,e){this.load(t,e)}load(t,e){if(null==e)throw new Error("textureLoader cannot be null.");let s=new w(t),n=new Array(4),r=null;for(;;){let t=s.readLine();if(null==t)break;if(t=t.trim(),0==t.length)r=null;else if(r){let e=new b;e.name=t,e.page=r;let i=s.readValue();"true"==i.toLocaleLowerCase()?e.degrees=90:"false"==i.toLocaleLowerCase()?e.degrees=0:e.degrees=parseFloat(i),e.rotate=90==e.degrees,s.readTuple(n);let a=parseInt(n[0]),o=parseInt(n[1]);s.readTuple(n);let l=parseInt(n[0]),h=parseInt(n[1]);e.u=a/r.width,e.v=o/r.height,e.rotate?(e.u2=(a+h)/r.width,e.v2=(o+l)/r.height):(e.u2=(a+l)/r.width,e.v2=(o+h)/r.height),e.x=a,e.y=o,e.width=Math.abs(l),e.height=Math.abs(h),4==s.readTuple(n)&&4==s.readTuple(n)&&s.readTuple(n),e.originalWidth=parseInt(n[0]),e.originalHeight=parseInt(n[1]),s.readTuple(n),e.offsetX=parseInt(n[0]),e.offsetY=parseInt(n[1]),e.index=parseInt(s.readValue()),e.texture=r.texture,this.regions.push(e)}else{r=new x,r.name=t,2==s.readTuple(n)&&(r.width=parseInt(n[0]),r.height=parseInt(n[1]),s.readTuple(n)),s.readTuple(n),r.minFilter=i.filterFromString(n[0]),r.magFilter=i.filterFromString(n[1]);let o=s.readValue();r.uWrap=a.ClampToEdge,r.vWrap=a.ClampToEdge,"x"==o?r.uWrap=a.Repeat:"y"==o?r.vWrap=a.Repeat:"xy"==o&&(r.uWrap=r.vWrap=a.Repeat),r.texture=e(t),r.texture.setFilters(r.minFilter,r.magFilter),r.texture.setWraps(r.uWrap,r.vWrap),r.width=r.texture.getImage().width,r.height=r.texture.getImage().height,this.pages.push(r)}}}findRegion(t){for(let e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}dispose(){for(let t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()}}class w{lines;index=0;constructor(t){this.lines=t.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readValue(){let t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()}readTuple(t){let e=this.readLine(),s=e.indexOf(":");if(-1==s)throw new Error("Invalid line: "+e);let i=0,n=s+1;for(;i<3;i++){let s=e.indexOf(",",n);if(-1==s)break;t[i]=e.substr(n,s-n).trim(),n=s+1}return t[i]=e.substring(n).trim(),i+1}}class x{name;minFilter;magFilter;uWrap;vWrap;texture;width;height}class b extends g{page;name;x;y;index;degrees;texture}class y{pathPrefix;textureLoader;assets={};errors={};toLoad=0;loaded=0;rawDataUris={};constructor(t,e=""){this.textureLoader=t,this.pathPrefix=e}encodePath(t){let e=t.split("/");for(let t=0;t<e.length;t++)e[t]=encodeURIComponent(e[t]);return e.join("/")}downloadText(t,e,s){if(this.rawDataUris[t]){let s=this.rawDataUris[t],i=atob(s);return void e(i)}let i=new XMLHttpRequest;i.overrideMimeType("text/html"),i.open("GET",this.encodePath(t),!0),i.onload=()=>{200==i.status?0==i.responseText.length?s(i.status,i.responseText):e(i.responseText):s(i.status,i.responseText)},i.onerror=()=>{s(i.status,i.responseText)},i.send()}base64ToArrayBuffer(t){for(var e=atob(t),s=new Uint8Array(e.length),i=0;i<e.length;i++)s[i]=e.charCodeAt(i);return s}downloadBinary(t,e,s){if(this.rawDataUris[t]){let s=this.rawDataUris[t],i=this.base64ToArrayBuffer(s);return console.log(t,s),void e(i)}let i=new XMLHttpRequest;i.open("GET",this.encodePath(t),!0),i.responseType="arraybuffer",i.onload=()=>{200==i.status?null==i.response?s(i.status,i.responseText):e(new Uint8Array(i.response)):s(i.status,i.response)},i.onerror=()=>{s(i.status,i.response)},i.send()}setRawDataURI(t,e){this.rawDataUris[this.pathPrefix+t]=e}loadBinary(t,e=null,s=null){t=this.pathPrefix+t,this.toLoad++,this.downloadBinary(t,(s=>{this.assets[t]=s,e&&e(t,s),this.toLoad--,this.loaded++}),((e,i)=>{this.errors[t]=`Couldn't load binary ${t}: status ${status}, ${i}`,s&&s(t,`Couldn't load binary ${t}: status ${status}, ${i}`),this.toLoad--,this.loaded++}))}loadText(t,e=null,s=null){t=this.pathPrefix+t,this.toLoad++,this.downloadText(t,(s=>{this.assets[t]=s,e&&e(t,s),this.toLoad--,this.loaded++}),((e,i)=>{this.errors[t]=`Couldn't load text ${t}: status ${status}, ${i}`,s&&s(t,`Couldn't load text ${t}: status ${status}, ${i}`),this.toLoad--,this.loaded++}))}loadTexture(t,e=null,s=null){let i=t=this.pathPrefix+t;this.toLoad++;let n=new Image;if(n.crossOrigin="anonymous",n.onload=s=>{let a=this.textureLoader(n);this.assets[i]=a,this.toLoad--,this.loaded++,e&&e(t,n)},n.onerror=e=>{this.errors[t]=`Couldn't load image ${t}`,this.toLoad--,this.loaded++,s&&s(t,`Couldn't load image ${t}`)},this.rawDataUris[t]){let e=this.rawDataUris[t];n.src="data:image/png;base64,"+e}else n.src=this.encodePath(t)}loadTextureAtlas(t,e=null,s=null){let i=t.lastIndexOf("/")>=0?t.substring(0,t.lastIndexOf("/")):"";t=this.pathPrefix+t,this.toLoad++,this.downloadText(t,(n=>{let a={count:0},r=new Array;try{new p(n,(t=>{r.push(""==i?t:i+"/"+t);let e=document.createElement("img");return e.width=16,e.height=16,new f(e)}))}catch(e){let i=e;return this.errors[t]=`Couldn't load texture atlas ${t}: ${i.message}`,s&&s(t,`Couldn't load texture atlas ${t}: ${i.message}`),this.toLoad--,void this.loaded++}for(let o of r){let l=!1;this.loadTexture(o,((o,h)=>{if(a.count++,a.count==r.length)if(l)this.errors[t]=`Couldn't load texture atlas page ${o}} of atlas ${t}`,s&&s(t,`Couldn't load texture atlas page ${o} of atlas ${t}`),this.toLoad--,this.loaded++;else try{let s=new p(n,(t=>this.get(""==i?t:i+"/"+t)));this.assets[t]=s,e&&e(t,s),this.toLoad--,this.loaded++}catch(e){let i=e;this.errors[t]=`Couldn't load texture atlas ${t}: ${i.message}`,s&&s(t,`Couldn't load texture atlas ${t}: ${i.message}`),this.toLoad--,this.loaded++}}),((e,i)=>{l=!0,a.count++,a.count==r.length&&(this.errors[t]=`Couldn't load texture atlas page ${e}} of atlas ${t}`,s&&s(t,`Couldn't load texture atlas page ${e} of atlas ${t}`),this.toLoad--,this.loaded++)}))}}),((e,i)=>{this.errors[t]=`Couldn't load texture atlas ${t}: status ${status}, ${i}`,s&&s(t,`Couldn't load texture atlas ${t}: status ${status}, ${i}`),this.toLoad--,this.loaded++}))}get(t){return t=this.pathPrefix+t,this.assets[t]}remove(t){t=this.pathPrefix+t;let e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null}removeAll(){for(let t in this.assets){let e=this.assets[t];e.dispose&&e.dispose()}this.assets={}}isLoadingComplete(){return 0==this.toLoad}getToLoad(){return this.toLoad}getLoaded(){return this.loaded}dispose(){this.removeAll()}hasErrors(){return Object.keys(this.errors).length>0}getErrors(){return this.errors}clearErrors(){this.errors={}}}!function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(r||(r={}));class v{canvas;gl;restorables=new Array;constructor(t,e={alpha:"true"}){if(t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas){let s=t;this.gl=s.getContext("webgl2",e)||s.getContext("webgl",e),this.canvas=s,s.addEventListener("webglcontextlost",(t=>{t&&t.preventDefault()})),s.addEventListener("webglcontextrestored",(t=>{for(let t=0,e=this.restorables.length;t<e;t++)this.restorables[t].restore()}))}else this.gl=t,this.canvas=this.gl.canvas}addRestorable(t){this.restorables.push(t)}removeRestorable(t){let e=this.restorables.indexOf(t);e>-1&&this.restorables.splice(e,1)}}class A{static ZERO=0;static ONE=1;static SRC_COLOR=768;static ONE_MINUS_SRC_COLOR=769;static SRC_ALPHA=770;static ONE_MINUS_SRC_ALPHA=771;static DST_ALPHA=772;static ONE_MINUS_DST_ALPHA=773;static DST_COLOR=774;static getDestGLBlendMode(t){switch(t){case r.Normal:return A.ONE_MINUS_SRC_ALPHA;case r.Additive:return A.ONE;case r.Multiply:case r.Screen:return A.ONE_MINUS_SRC_ALPHA;default:throw new Error("Unknown blend mode: "+t)}}static getSourceGLBlendMode(t,e=!1){switch(t){case r.Normal:case r.Additive:return e?A.ONE:A.SRC_ALPHA;case r.Multiply:return A.DST_COLOR;case r.Screen:return A.ONE;default:throw new Error("Unknown blend mode: "+t)}}}class E extends i{context;texture=null;boundUnit=0;useMipMaps=!1;static DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL=!1;constructor(t,e,s=!1){super(e),this.context=t instanceof v?t:new v(t),this.useMipMaps=s,this.restore(),this.context.addRestorable(this)}setFilters(t,e){let s=this.context.gl;this.bind(),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,E.validateMagFilter(e))}static validateMagFilter(t){switch(t){case n.MipMap:case n.MipMapLinearLinear:case n.MipMapLinearNearest:case n.MipMapNearestLinear:case n.MipMapNearestNearest:return n.Linear;default:return t}}setWraps(t,e){let s=this.context.gl;this.bind(),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,e)}update(t){let e=this.context.gl;this.texture||(this.texture=this.context.gl.createTexture()),this.bind(),E.DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._image),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t&&e.generateMipmap(e.TEXTURE_2D)}restore(){this.texture=null,this.update(this.useMipMaps)}bind(t=0){let e=this.context.gl;this.boundUnit=t,e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)}unbind(){let t=this.context.gl;t.activeTexture(t.TEXTURE0+this.boundUnit),t.bindTexture(t.TEXTURE_2D,null)}dispose(){this.context.removeRestorable(this),this.context.gl.deleteTexture(this.texture)}}class S extends y{altTextures=[];constructor(t,e=""){super((e=>{if(t instanceof v||t instanceof WebGLRenderingContext)return new E(t,e);{let s=t;for(let t=1;t<s.length;t++)this.altTextures.push(new E(s[t],e));return new E(s[0],e)}}),e)}dispose(){super.dispose();for(let t=0;t<this.altTextures.length;t++)this.altTextures[t].dispose();this.altTextures=[]}}class M{array=new Array;add(t){let e=this.contains(t);return this.array[0|t]=0|t,!e}contains(t){return null!=this.array[0|t]}remove(t){this.array[0|t]=void 0}clear(){this.array.length=0}}class I{r;g;b;a;static WHITE=new I(1,1,1,1);static RED=new I(1,0,0,1);static GREEN=new I(0,1,0,1);static BLUE=new I(0,0,1,1);static MAGENTA=new I(1,0,1,1);static ORANGE=new I(1,.5,.1,1);constructor(t=0,e=0,s=0,i=0){this.r=t,this.g=e,this.b=s,this.a=i}set(t,e,s,i){return this.r=t,this.g=e,this.b=s,this.a=i,this.clamp(),this}setFromColor(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}setFromString(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this}add(t,e,s,i){return this.r+=t,this.g+=e,this.b+=s,this.a+=i,this.clamp(),this}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}static rgb888ToColor(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}}class R{static PI=3.1415927;static PI2=2*R.PI;static radiansToDegrees=180/R.PI;static radDeg=R.radiansToDegrees;static degreesToRadians=R.PI/180;static degRad=R.degreesToRadians;static clamp(t,e,s){return t<e?e:t>s?s:t}static cosDeg(t){return Math.cos(t*R.degRad)}static sinDeg(t){return Math.sin(t*R.degRad)}static signum(t){return t>0?1:t<0?-1:0}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}static cbrt(t){let e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}static randomTriangular(t,e){return R.randomTriangularWith(t,e,.5*(t+e))}static randomTriangularWith(t,e,s){let i=Math.random(),n=e-t;return i<=(s-t)/n?t+Math.sqrt(i*n*(s-t)):e-Math.sqrt((1-i)*n*(e-s))}}class T{static SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array;static arrayCopy(t,e,s,i,n){for(let a=e,r=i;a<e+n;a++,r++)s[r]=t[a]}static setArraySize(t,e,s=0){let i=t.length;if(i==e)return t;if(t.length=e,i<e)for(let n=i;n<e;n++)t[n]=s;return t}static ensureArrayCapacity(t,e,s=0){return t.length>=e?t:T.setArraySize(t,e,s)}static newArray(t,e){let s=new Array(t);for(let i=0;i<t;i++)s[i]=e;return s}static newFloatArray(t){if(T.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);{let e=new Array(t);for(let t=0;t<e.length;t++)e[t]=0;return e}}static newShortArray(t){if(T.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);{let e=new Array(t);for(let t=0;t<e.length;t++)e[t]=0;return e}}static toFloatArray(t){return T.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t}static toSinglePrecision(t){return T.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t}static webkit602BugfixHelper(t,e){}static contains(t,e,s=!0){for(var i=0;i<t.length;i++)if(t[i]==e)return!0;return!1}}class C{items=new Array;instantiator;constructor(t){this.instantiator=t}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(t){t.reset&&t.reset(),this.items.push(t)}freeAll(t){for(let e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]}clear(){this.items.length=0}}class P{x;y;constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}length(){let t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}subtract(t){return new P(this.x-t.x,this.y-t.y)}normalize(){let t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}normalize_new(){let t=this.length();return new P(this.x/t,this.y/t)}angle(t){let e=this.x*t.x+this.y*t.y,s=Math.sqrt(this.x*this.x+this.y*this.y),i=Math.sqrt(t.x*t.x+t.y*t.y);return Math.acos(e/(s*i))}}class k{maxDelta=.064;framesPerSecond=0;delta=0;totalTime=0;lastTime=Date.now()/1e3;frameCount=0;frameTime=0;update(){let t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)}}class V{name;constructor(t){if(null==t)throw new Error("name cannot be null.");this.name=t}}class N extends V{static nextID=0;id=(65535&N.nextID++)<<11;bones;vertices;worldVerticesLength=0;deformAttachment=this;constructor(t){super(t)}computeWorldVertices(t,e,s,i,n,a){s=n+(s>>1)*a;let r=t.bone.skeleton,o=t.deform,l=this.vertices,h=this.bones;if(null==h){o.length>0&&(l=o);let r=t.bone,h=r.worldX,c=r.worldY,d=r.a,u=r.b,m=r.c,g=r.d;for(let t=e,r=n;r<s;t+=2,r+=a){let e=l[t],s=l[t+1];i[r]=e*d+s*u+h,i[r+1]=e*m+s*g+c}return}let c=0,d=0;for(let t=0;t<e;t+=2){let t=h[c];c+=t+1,d+=t}let u=r.bones;if(0==o.length)for(let t=n,e=3*d;t<s;t+=a){let s=0,n=0,a=h[c++];for(a+=c;c<a;c++,e+=3){let t=u[h[c]],i=l[e],a=l[e+1],r=l[e+2];s+=(i*t.a+a*t.b+t.worldX)*r,n+=(i*t.c+a*t.d+t.worldY)*r}i[t]=s,i[t+1]=n}else{let t=o;for(let e=n,r=3*d,o=d<<1;e<s;e+=a){let s=0,n=0,a=h[c++];for(a+=c;c<a;c++,r+=3,o+=2){let e=u[h[c]],i=l[r]+t[o],a=l[r+1]+t[o+1],d=l[r+2];s+=(i*e.a+a*e.b+e.worldX)*d,n+=(i*e.c+a*e.d+e.worldY)*d}i[e]=s,i[e+1]=n}}}copyTo(t){null!=this.bones?(t.bones=new Array(this.bones.length),T.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=T.newFloatArray(this.vertices.length),T.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment}}class O extends N{color=new I(1,1,1,1);constructor(t){super(t)}copy(){let t=new O(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}class L extends N{endSlot;color=new I(.2275,.2275,.8078,1);constructor(t){super(t)}copy(){let t=new L(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}class Y extends N{region;path;regionUVs;uvs;triangles;color=new I(1,1,1,1);width;height;hullLength;edges;parentMesh;tempColor=new I(0,0,0,0);constructor(t){super(t)}updateUVs(){let t=this.regionUVs;null!=this.uvs&&this.uvs.length==t.length||(this.uvs=T.newFloatArray(t.length));let e=this.uvs,s=this.uvs.length,i=this.region.u,n=this.region.v,a=0,r=0;if(this.region instanceof b){let o=this.region,l=o.texture.getImage().width,h=o.texture.getImage().height;switch(o.degrees){case 90:i-=(o.originalHeight-o.offsetY-o.height)/l,n-=(o.originalWidth-o.offsetX-o.width)/h,a=o.originalHeight/l,r=o.originalWidth/h;for(let o=0;o<s;o+=2)e[o]=i+t[o+1]*a,e[o+1]=n+(1-t[o])*r;return;case 180:i-=(o.originalWidth-o.offsetX-o.width)/l,n-=o.offsetY/h,a=o.originalWidth/l,r=o.originalHeight/h;for(let o=0;o<s;o+=2)e[o]=i+(1-t[o])*a,e[o+1]=n+(1-t[o+1])*r;return;case 270:i-=o.offsetY/l,n-=o.offsetX/h,a=o.originalHeight/l,r=o.originalWidth/h;for(let o=0;o<s;o+=2)e[o]=i+(1-t[o+1])*a,e[o+1]=n+t[o]*r;return}i-=o.offsetX/l,n-=(o.originalHeight-o.offsetY-o.height)/h,a=o.originalWidth/l,r=o.originalHeight/h}else null==this.region?(i=n=0,a=r=1):(a=this.region.u2-i,r=this.region.v2-n);for(let o=0;o<s;o+=2)e[o]=i+t[o]*a,e[o+1]=n+t[o+1]*r}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(null!=this.parentMesh)return this.newLinkedMesh();let t=new Y(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Array(this.regionUVs.length),T.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),T.arrayCopy(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),T.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,null!=this.edges&&(t.edges=new Array(this.edges.length),T.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}newLinkedMesh(){let t=new Y(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t}}class D extends N{lengths;closed=!1;constantSpeed=!1;color=new I(1,1,1,1);constructor(t){super(t)}copy(){let t=new D(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),T.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}class F extends N{x;y;rotation;color=new I(.38,.94,0,1);constructor(t){super(t)}computeWorldPosition(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e}computeWorldRotation(t){let e=R.cosDeg(this.rotation),s=R.sinDeg(this.rotation),i=e*t.a+s*t.b,n=e*t.c+s*t.d;return Math.atan2(n,i)*R.radDeg}copy(){let t=new F(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}class B extends V{static OX1=0;static OY1=1;static OX2=2;static OY2=3;static OX3=4;static OY3=5;static OX4=6;static OY4=7;static X1=0;static Y1=1;static C1R=2;static C1G=3;static C1B=4;static C1A=5;static U1=6;static V1=7;static X2=8;static Y2=9;static C2R=10;static C2G=11;static C2B=12;static C2A=13;static U2=14;static V2=15;static X3=16;static Y3=17;static C3R=18;static C3G=19;static C3B=20;static C3A=21;static U3=22;static V3=23;static X4=24;static Y4=25;static C4R=26;static C4G=27;static C4B=28;static C4A=29;static U4=30;static V4=31;x=0;y=0;scaleX=1;scaleY=1;rotation=0;width=0;height=0;color=new I(1,1,1,1);path;rendererObject;region;offset=T.newFloatArray(8);uvs=T.newFloatArray(8);tempColor=new I(1,1,1,1);constructor(t){super(t)}updateOffset(){let t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,s=-this.width/2*this.scaleX+this.region.offsetX*t,i=-this.height/2*this.scaleY+this.region.offsetY*e,n=s+this.region.width*t,a=i+this.region.height*e,r=this.rotation*Math.PI/180,o=Math.cos(r),l=Math.sin(r),h=s*o+this.x,c=s*l,d=i*o+this.y,u=i*l,m=n*o+this.x,g=n*l,f=a*o+this.y,p=a*l,w=this.offset;w[B.OX1]=h-u,w[B.OY1]=d+c,w[B.OX2]=h-p,w[B.OY2]=f+c,w[B.OX3]=m-p,w[B.OY3]=f+g,w[B.OX4]=m-u,w[B.OY4]=d+g}setRegion(t){this.region=t;let e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,s,i){let n=this.offset,a=t.worldX,r=t.worldY,o=t.a,l=t.b,h=t.c,c=t.d,d=0,u=0;d=n[B.OX1],u=n[B.OY1],e[s]=d*o+u*l+a,e[s+1]=d*h+u*c+r,s+=i,d=n[B.OX2],u=n[B.OY2],e[s]=d*o+u*l+a,e[s+1]=d*h+u*c+r,s+=i,d=n[B.OX3],u=n[B.OY3],e[s]=d*o+u*l+a,e[s+1]=d*h+u*c+r,s+=i,d=n[B.OX4],u=n[B.OY4],e[s]=d*o+u*l+a,e[s+1]=d*h+u*c+r}copy(){let t=new B(this.name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,T.arrayCopy(this.uvs,0,t.uvs,0,8),T.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t}}class X{atlas;constructor(t){this.atlas=t}newRegionAttachment(t,e,s){let i=this.atlas.findRegion(s);if(null==i)throw new Error("Region not found in atlas: "+s+" (region attachment: "+e+")");i.renderObject=i;let n=new B(e);return n.setRegion(i),n}newMeshAttachment(t,e,s){let i=this.atlas.findRegion(s);if(null==i)throw new Error("Region not found in atlas: "+s+" (mesh attachment: "+e+")");i.renderObject=i;let n=new Y(e);return n.region=i,n}newBoundingBoxAttachment(t,e){return new O(e)}newPathAttachment(t,e){return new D(e)}newPointAttachment(t,e){return new F(e)}newClippingAttachment(t,e){return new L(e)}}class _{index;name;parent;length;x=0;y=0;rotation=0;scaleX=1;scaleY=1;shearX=0;shearY=0;transformMode=o.Normal;skinRequired=!1;color=new I;constructor(t,e,s){if(t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=s}}!function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(o||(o={}));class W{data;skeleton;parent;children=new Array;x=0;y=0;rotation=0;scaleX=0;scaleY=0;shearX=0;shearY=0;ax=0;ay=0;arotation=0;ascaleX=0;ascaleY=0;ashearX=0;ashearY=0;appliedValid=!1;a=0;b=0;c=0;d=0;worldY=0;worldX=0;sorted=!1;active=!1;constructor(t,e,s){if(null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=s,this.setToSetupPose()}isActive(){return this.active}update(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,s,i,n,a,r){this.ax=t,this.ay=e,this.arotation=s,this.ascaleX=i,this.ascaleY=n,this.ashearX=a,this.ashearY=r,this.appliedValid=!0;let l=this.parent;if(null==l){let o=this.skeleton,l=s+90+r,h=o.scaleX,c=o.scaleY;return this.a=R.cosDeg(s+a)*i*h,this.b=R.cosDeg(l)*n*h,this.c=R.sinDeg(s+a)*i*c,this.d=R.sinDeg(l)*n*c,this.worldX=t*h+o.x,void(this.worldY=e*c+o.y)}let h=l.a,c=l.b,d=l.c,u=l.d;switch(this.worldX=h*t+c*e+l.worldX,this.worldY=d*t+u*e+l.worldY,this.data.transformMode){case o.Normal:{let t=s+90+r,e=R.cosDeg(s+a)*i,o=R.cosDeg(t)*n,l=R.sinDeg(s+a)*i,m=R.sinDeg(t)*n;return this.a=h*e+c*l,this.b=h*o+c*m,this.c=d*e+u*l,void(this.d=d*o+u*m)}case o.OnlyTranslation:{let t=s+90+r;this.a=R.cosDeg(s+a)*i,this.b=R.cosDeg(t)*n,this.c=R.sinDeg(s+a)*i,this.d=R.sinDeg(t)*n;break}case o.NoRotationOrReflection:{let t=h*h+d*d,e=0;t>1e-4?(t=Math.abs(h*u-c*d)/t,c=d*t,u=h*t,e=Math.atan2(d,h)*R.radDeg):(h=0,d=0,e=90-Math.atan2(u,c)*R.radDeg);let o=s+a-e,l=s+r-e+90,m=R.cosDeg(o)*i,g=R.cosDeg(l)*n,f=R.sinDeg(o)*i,p=R.sinDeg(l)*n;return this.a=h*m-c*f,this.b=h*g-c*p,this.c=d*m+u*f,this.d=d*g+u*p,this.a*=Math.sign(this.skeleton.scaleX),this.b*=Math.sign(this.skeleton.scaleX),this.c*=Math.sign(this.skeleton.scaleY),void(this.d*=Math.sign(this.skeleton.scaleY))}case o.NoScale:case o.NoScaleOrReflection:{let t=R.cosDeg(s),e=R.sinDeg(s),l=(h*t+c*e)/this.skeleton.scaleX,m=(d*t+u*e)/this.skeleton.scaleY,g=Math.sqrt(l*l+m*m);g>1e-5&&(g=1/g),l*=g,m*=g,g=Math.sqrt(l*l+m*m),this.data.transformMode==o.NoScale&&h*u-c*d<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(g=-g);let f=Math.PI/2+Math.atan2(m,l),p=Math.cos(f)*g,w=Math.sin(f)*g,x=R.cosDeg(a)*i,b=R.cosDeg(90+r)*n,y=R.sinDeg(a)*i,v=R.sinDeg(90+r)*n;this.a=l*x+p*y,this.b=l*b+p*v,this.c=m*x+w*y,this.d=m*b+w*v;break}}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY}setToSetupPose(){let t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.c,this.a)*R.radDeg}getWorldRotationY(){return Math.atan2(this.d,this.b)*R.radDeg}getWorldScaleX(){return Math.sqrt(this.a*this.a+this.c*this.c)}getWorldScaleY(){return Math.sqrt(this.b*this.b+this.d*this.d)}updateAppliedTransform(){this.appliedValid=!0;let t=this.parent;if(null==t)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*R.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*R.radDeg);let e=t.a,s=t.b,i=t.c,n=t.d,a=1/(e*n-s*i),r=this.worldX-t.worldX,o=this.worldY-t.worldY;this.ax=r*n*a-o*s*a,this.ay=o*e*a-r*i*a;let l=a*n,h=a*e,c=a*s,d=a*i,u=l*this.a-c*this.c,m=l*this.b-c*this.d,g=h*this.c-d*this.a,f=h*this.d-d*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(u*u+g*g),this.ascaleX>1e-4){let t=u*f-m*g;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(u*m+g*f,t)*R.radDeg,this.arotation=Math.atan2(g,u)*R.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(m*m+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,m)*R.radDeg}worldToLocal(t){let e=this.a,s=this.b,i=this.c,n=this.d,a=1/(e*n-s*i),r=t.x-this.worldX,o=t.y-this.worldY;return t.x=r*n*a-o*s*a,t.y=o*e*a-r*i*a,t}localToWorld(t){let e=t.x,s=t.y;return t.x=e*this.a+s*this.b+this.worldX,t.y=e*this.c+s*this.d+this.worldY,t}worldToLocalRotation(t){let e=R.sinDeg(t),s=R.cosDeg(t);return Math.atan2(this.a*e-this.c*s,this.d*s-this.b*e)*R.radDeg+this.rotation-this.shearX}localToWorldRotation(t){t-=this.rotation-this.shearX;let e=R.sinDeg(t),s=R.cosDeg(t);return Math.atan2(s*this.c+e*this.d,s*this.a+e*this.b)*R.radDeg}rotateWorld(t){let e=this.a,s=this.b,i=this.c,n=this.d,a=R.cosDeg(t),r=R.sinDeg(t);this.a=a*e-r*i,this.b=a*s-r*n,this.c=r*e+a*i,this.d=r*s+a*n,this.appliedValid=!1}}class U{data;bones;target;bendDirection=0;compress=!1;stretch=!1;mix=1;softness=0;active=!1;constructor(t,e){if(null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){let t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}}apply1(t,e,s,i,n,a,r){t.appliedValid||t.updateAppliedTransform();let l=t.parent,h=l.a,c=l.b,d=l.c,u=l.d,m=-t.ashearX-t.arotation,g=0,f=0;switch(t.data.transformMode){case o.OnlyTranslation:g=e-t.worldX,f=s-t.worldY;break;case o.NoRotationOrReflection:m+=Math.atan2(d,h)*R.radDeg;let i=Math.abs(h*u-c*d)/(h*h+d*d);c=-d*i,u=h*i;default:let n=e-l.worldX,a=s-l.worldY,r=h*u-c*d;g=(n*u-a*c)/r-t.ax,f=(a*h-n*d)/r-t.ay}m+=Math.atan2(f,g)*R.radDeg,t.ascaleX<0&&(m+=180),m>180?m-=360:m<-180&&(m+=360);let p=t.ascaleX,w=t.ascaleY;if(i||n){switch(t.data.transformMode){case o.NoScale:case o.NoScaleOrReflection:g=e-t.worldX,f=s-t.worldY}let l=t.data.length*p,h=Math.sqrt(g*g+f*f);if(i&&h<l||n&&h>l&&l>1e-4){let t=(h/l-1)*r+1;p*=t,a&&(w*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+m*r,p,w,t.ashearX,t.ashearY)}apply2(t,e,s,i,n,a,r,o){if(0==o)return void e.updateWorldTransform();t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();let l=t.ax,h=t.ay,c=t.ascaleX,d=c,u=t.ascaleY,m=e.ascaleX,g=0,f=0,p=0;c<0?(c=-c,g=180,p=-1):(g=0,p=1),u<0&&(u=-u,p=-p),m<0?(m=-m,f=180):f=0;let w=e.ax,x=0,b=0,y=0,v=t.a,A=t.b,E=t.c,S=t.d,M=Math.abs(c-u)<=1e-4;M?(x=e.ay,b=v*w+A*x+t.worldX,y=E*w+S*x+t.worldY):(x=0,b=v*w+t.worldX,y=E*w+t.worldY);let I=t.parent;v=I.a,A=I.b,E=I.c,S=I.d;let T,C,P=1/(v*S-A*E),k=b-I.worldX,V=y-I.worldY,N=(k*S-V*A)*P-l,O=(V*v-k*E)*P-h,L=Math.sqrt(N*N+O*O),Y=e.data.length*m;if(L<1e-4)return this.apply1(t,s,i,!1,a,!1,o),void e.updateWorldTransformWith(w,x,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);k=s-I.worldX,V=i-I.worldY;let D=(k*S-V*A)*P-l,F=(V*v-k*E)*P-h,B=D*D+F*F;if(0!=r){r*=c*(m+1)/2;let t=Math.sqrt(B),e=t-L-Y*c+r;if(e>0){let s=Math.min(1,e/(2*r))-1;s=(e-r*(1-s*s))/t,D-=s*D,F-=s*F,B=D*D+F*F}}t:if(M){Y*=c;let t=(B-L*L-Y*Y)/(2*L*Y);t<-1?t=-1:t>1&&(t=1,a&&(d*=(Math.sqrt(B)/(L+Y)-1)*o+1)),C=Math.acos(t)*n,v=L+Y*t,A=Y*Math.sin(C),T=Math.atan2(F*v-D*A,D*v+F*A)}else{v=c*Y,A=u*Y;let t=v*v,e=A*A,s=Math.atan2(F,D);E=e*L*L+t*B-t*e;let i=-2*e*L,a=e-t;if(S=i*i-4*a*E,S>=0){let t=Math.sqrt(S);i<0&&(t=-t),t=-(i+t)/2;let e=t/a,r=E/t,o=Math.abs(e)<Math.abs(r)?e:r;if(o*o<=B){V=Math.sqrt(B-o*o)*n,T=s-Math.atan2(V,o),C=Math.atan2(V/u,(o-L)/c);break t}}let r=R.PI,o=L-v,l=o*o,h=0,d=0,m=L+v,g=m*m,f=0;E=-v*L/(t-e),E>=-1&&E<=1&&(E=Math.acos(E),k=v*Math.cos(E)+L,V=A*Math.sin(E),S=k*k+V*V,S<l&&(r=E,l=S,o=k,h=V),S>g&&(d=E,g=S,m=k,f=V)),B<=(l+g)/2?(T=s-Math.atan2(h*n,o),C=r*n):(T=s-Math.atan2(f*n,m),C=d*n)}let X=Math.atan2(x,w)*p,_=t.arotation;T=(T-X)*R.radDeg+g-_,T>180?T-=360:T<-180&&(T+=360),t.updateWorldTransformWith(l,h,_+T*o,d,t.ascaleY,0,0),_=e.arotation,C=((C+X)*R.radDeg-e.ashearX)*p+f-_,C>180?C-=360:C<-180&&(C+=360),e.updateWorldTransformWith(w,x,_+C*o,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}}class G{name;order;skinRequired;constructor(t,e,s){this.name=t,this.order=e,this.skinRequired=s}}class Z extends G{bones=new Array;target;positionMode;spacingMode;rotateMode;offsetRotation;position;spacing;rotateMix;translateMix;constructor(t){super(t,0,!1)}}!function(t){t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent"}(l||(l={})),function(t){t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent"}(h||(h={})),function(t){t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale"}(c||(c={}));class z{static NONE=-1;static BEFORE=-2;static AFTER=-3;static epsilon=1e-5;data;bones;target;position=0;spacing=0;rotateMix=0;translateMix=0;spaces=new Array;positions=new Array;world=new Array;curves=new Array;lengths=new Array;segments=new Array;active=!1;constructor(t,e){if(null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let s=0,i=t.bones.length;s<i;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}isActive(){return this.active}apply(){this.update()}update(){let t=this.target.getAttachment();if(!(t instanceof D))return;let e=this.rotateMix,s=this.translateMix,i=e>0;if(!(s>0||i))return;let n=this.data,a=n.spacingMode==h.Percent,r=n.rotateMode,o=r==c.Tangent,d=r==c.ChainScale,u=this.bones.length,m=o?u:u+1,g=this.bones,f=T.setArraySize(this.spaces,m),p=null,w=this.spacing;if(d||!a){d&&(p=T.setArraySize(this.lengths,u));let t=n.spacingMode==h.Length;for(let e=0,s=m-1;e<s;){let s=g[e],i=s.data.length;if(i<z.epsilon)d&&(p[e]=0),f[++e]=0;else if(a){if(d){let t=i*s.a,n=i*s.c,a=Math.sqrt(t*t+n*n);p[e]=a}f[++e]=w}else{let n=i*s.a,a=i*s.c,r=Math.sqrt(n*n+a*a);d&&(p[e]=r),f[++e]=(t?i+w:w)*r/i}}}else for(let t=1;t<m;t++)f[t]=w;let x=this.computeWorldPositions(t,m,o,n.positionMode==l.Percent,a),b=x[0],y=x[1],v=n.offsetRotation,A=!1;if(0==v)A=r==c.Chain;else{A=!1;let t=this.target.bone;v*=t.a*t.d-t.b*t.c>0?R.degRad:-R.degRad}for(let t=0,n=3;t<u;t++,n+=3){let a=g[t];a.worldX+=(b-a.worldX)*s,a.worldY+=(y-a.worldY)*s;let r=x[n],l=x[n+1],h=r-b,c=l-y;if(d){let s=p[t];if(0!=s){let t=(Math.sqrt(h*h+c*c)/s-1)*e+1;a.a*=t,a.c*=t}}if(b=r,y=l,i){let s=a.a,i=a.b,r=a.c,l=a.d,d=0,u=0,m=0;if(d=o?x[n-1]:0==f[t+1]?x[n+2]:Math.atan2(c,h),d-=Math.atan2(r,s),A){u=Math.cos(d),m=Math.sin(d);let t=a.data.length;b+=(t*(u*s-m*r)-h)*e,y+=(t*(m*s+u*r)-c)*e}else d+=v;d>R.PI?d-=R.PI2:d<-R.PI&&(d+=R.PI2),d*=e,u=Math.cos(d),m=Math.sin(d),a.a=u*s-m*r,a.b=u*i-m*l,a.c=m*s+u*r,a.d=m*i+u*l}a.appliedValid=!1}}computeWorldPositions(t,e,s,i,n){let a=this.target,r=this.position,o=this.spaces,l=T.setArraySize(this.positions,3*e+2),h=null,c=t.closed,d=t.worldVerticesLength,u=d/6,m=z.NONE;if(!t.constantSpeed){let g=t.lengths;u-=c?1:2;let f=g[u];if(i&&(r*=f),n)for(let t=1;t<e;t++)o[t]*=f;h=T.setArraySize(this.world,8);for(let i=0,n=0,p=0;i<e;i++,n+=3){let e=o[i];r+=e;let w=r;if(c)w%=f,w<0&&(w+=f),p=0;else{if(w<0){m!=z.BEFORE&&(m=z.BEFORE,t.computeWorldVertices(a,2,4,h,0,2)),this.addBeforePosition(w,h,0,l,n);continue}if(w>f){m!=z.AFTER&&(m=z.AFTER,t.computeWorldVertices(a,d-6,4,h,0,2)),this.addAfterPosition(w-f,h,0,l,n);continue}}for(;;p++){let t=g[p];if(!(w>t)){if(0==p)w/=t;else{let e=g[p-1];w=(w-e)/(t-e)}break}}p!=m&&(m=p,c&&p==u?(t.computeWorldVertices(a,d-4,4,h,0,2),t.computeWorldVertices(a,0,4,h,4,2)):t.computeWorldVertices(a,6*p+2,8,h,0,2)),this.addCurvePosition(w,h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],l,n,s||i>0&&0==e)}return l}c?(d+=2,h=T.setArraySize(this.world,d),t.computeWorldVertices(a,2,d-4,h,0,2),t.computeWorldVertices(a,0,2,h,d-4,2),h[d-2]=h[0],h[d-1]=h[1]):(u--,d-=4,h=T.setArraySize(this.world,d),t.computeWorldVertices(a,2,d,h,0,2));let g=T.setArraySize(this.curves,u),f=0,p=h[0],w=h[1],x=0,b=0,y=0,v=0,A=0,E=0,S=0,M=0,I=0,R=0,C=0,P=0,k=0,V=0;for(let t=0,e=2;t<u;t++,e+=6)x=h[e],b=h[e+1],y=h[e+2],v=h[e+3],A=h[e+4],E=h[e+5],S=.1875*(p-2*x+y),M=.1875*(w-2*b+v),I=.09375*(3*(x-y)-p+A),R=.09375*(3*(b-v)-w+E),C=2*S+I,P=2*M+R,k=.75*(x-p)+S+.16666667*I,V=.75*(b-w)+M+.16666667*R,f+=Math.sqrt(k*k+V*V),k+=C,V+=P,C+=I,P+=R,f+=Math.sqrt(k*k+V*V),k+=C,V+=P,f+=Math.sqrt(k*k+V*V),k+=C+I,V+=P+R,f+=Math.sqrt(k*k+V*V),g[t]=f,p=A,w=E;if(r*=i?f:f/t.lengths[u-1],n)for(let t=1;t<e;t++)o[t]*=f;let N=this.segments,O=0;for(let t=0,i=0,n=0,a=0;t<e;t++,i+=3){let e=o[t];r+=e;let u=r;if(c)u%=f,u<0&&(u+=f),n=0;else{if(u<0){this.addBeforePosition(u,h,0,l,i);continue}if(u>f){this.addAfterPosition(u-f,h,d-4,l,i);continue}}for(;;n++){let t=g[n];if(!(u>t)){if(0==n)u/=t;else{let e=g[n-1];u=(u-e)/(t-e)}break}}if(n!=m){m=n;let t=6*n;for(p=h[t],w=h[t+1],x=h[t+2],b=h[t+3],y=h[t+4],v=h[t+5],A=h[t+6],E=h[t+7],S=.03*(p-2*x+y),M=.03*(w-2*b+v),I=.006*(3*(x-y)-p+A),R=.006*(3*(b-v)-w+E),C=2*S+I,P=2*M+R,k=.3*(x-p)+S+.16666667*I,V=.3*(b-w)+M+.16666667*R,O=Math.sqrt(k*k+V*V),N[0]=O,t=1;t<8;t++)k+=C,V+=P,C+=I,P+=R,O+=Math.sqrt(k*k+V*V),N[t]=O;k+=C,V+=P,O+=Math.sqrt(k*k+V*V),N[8]=O,k+=C+I,V+=P+R,O+=Math.sqrt(k*k+V*V),N[9]=O,a=0}for(u*=O;;a++){let t=N[a];if(!(u>t)){if(0==a)u/=t;else{let e=N[a-1];u=a+(u-e)/(t-e)}break}}this.addCurvePosition(.1*u,p,w,x,b,y,v,A,E,l,i,s||t>0&&0==e)}return l}addBeforePosition(t,e,s,i,n){let a=e[s],r=e[s+1],o=e[s+2]-a,l=e[s+3]-r,h=Math.atan2(l,o);i[n]=a+t*Math.cos(h),i[n+1]=r+t*Math.sin(h),i[n+2]=h}addAfterPosition(t,e,s,i,n){let a=e[s+2],r=e[s+3],o=a-e[s],l=r-e[s+1],h=Math.atan2(l,o);i[n]=a+t*Math.cos(h),i[n+1]=r+t*Math.sin(h),i[n+2]=h}addCurvePosition(t,e,s,i,n,a,r,o,l,h,c,d){if(0==t||isNaN(t))return h[c]=e,h[c+1]=s,void(h[c+2]=Math.atan2(n-s,i-e));let u=t*t,m=u*t,g=1-t,f=g*g,p=f*g,w=g*t,x=3*w,b=g*x,y=x*t,v=e*p+i*b+a*y+o*m,A=s*p+n*b+r*y+l*m;h[c]=v,h[c+1]=A,d&&(h[c+2]=t<.001?Math.atan2(n-s,i-e):Math.atan2(A-(s*f+n*w*2+r*u),v-(e*f+i*w*2+a*u)))}}class j{data;bone;color;darkColor;attachment;attachmentTime;attachmentState;deform=new Array;constructor(t,e){if(null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new I,this.darkColor=null==t.darkColor?null:new I,this.setToSetupPose()}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}}class H{data;bones;target;rotateMix=0;translateMix=0;scaleMix=0;shearMix=0;temp=new P;active=!1;constructor(t,e){if(null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(let s=0;s<t.bones.length;s++)this.bones.push(e.findBone(t.bones[s].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}applyAbsoluteWorld(){let t=this.rotateMix,e=this.translateMix,s=this.scaleMix,i=this.shearMix,n=this.target,a=n.a,r=n.b,o=n.c,l=n.d,h=a*l-r*o>0?R.degRad:-R.degRad,c=this.data.offsetRotation*h,d=this.data.offsetShearY*h,u=this.bones;for(let h=0,m=u.length;h<m;h++){let m=u[h],g=!1;if(0!=t){let e=m.a,s=m.b,i=m.c,n=m.d,r=Math.atan2(o,a)-Math.atan2(i,e)+c;r>R.PI?r-=R.PI2:r<-R.PI&&(r+=R.PI2),r*=t;let l=Math.cos(r),h=Math.sin(r);m.a=l*e-h*i,m.b=l*s-h*n,m.c=h*e+l*i,m.d=h*s+l*n,g=!0}if(0!=e){let t=this.temp;n.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.worldX+=(t.x-m.worldX)*e,m.worldY+=(t.y-m.worldY)*e,g=!0}if(s>0){let t=Math.sqrt(m.a*m.a+m.c*m.c),e=Math.sqrt(a*a+o*o);t>1e-5&&(t=(t+(e-t+this.data.offsetScaleX)*s)/t),m.a*=t,m.c*=t,t=Math.sqrt(m.b*m.b+m.d*m.d),e=Math.sqrt(r*r+l*l),t>1e-5&&(t=(t+(e-t+this.data.offsetScaleY)*s)/t),m.b*=t,m.d*=t,g=!0}if(i>0){let t=m.b,e=m.d,s=Math.atan2(e,t),n=Math.atan2(l,r)-Math.atan2(o,a)-(s-Math.atan2(m.c,m.a));n>R.PI?n-=R.PI2:n<-R.PI&&(n+=R.PI2),n=s+(n+d)*i;let h=Math.sqrt(t*t+e*e);m.b=Math.cos(n)*h,m.d=Math.sin(n)*h,g=!0}g&&(m.appliedValid=!1)}}applyRelativeWorld(){let t=this.rotateMix,e=this.translateMix,s=this.scaleMix,i=this.shearMix,n=this.target,a=n.a,r=n.b,o=n.c,l=n.d,h=a*l-r*o>0?R.degRad:-R.degRad,c=this.data.offsetRotation*h,d=this.data.offsetShearY*h,u=this.bones;for(let h=0,m=u.length;h<m;h++){let m=u[h],g=!1;if(0!=t){let e=m.a,s=m.b,i=m.c,n=m.d,r=Math.atan2(o,a)+c;r>R.PI?r-=R.PI2:r<-R.PI&&(r+=R.PI2),r*=t;let l=Math.cos(r),h=Math.sin(r);m.a=l*e-h*i,m.b=l*s-h*n,m.c=h*e+l*i,m.d=h*s+l*n,g=!0}if(0!=e){let t=this.temp;n.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.worldX+=t.x*e,m.worldY+=t.y*e,g=!0}if(s>0){let t=(Math.sqrt(a*a+o*o)-1+this.data.offsetScaleX)*s+1;m.a*=t,m.c*=t,t=(Math.sqrt(r*r+l*l)-1+this.data.offsetScaleY)*s+1,m.b*=t,m.d*=t,g=!0}if(i>0){let t=Math.atan2(l,r)-Math.atan2(o,a);t>R.PI?t-=R.PI2:t<-R.PI&&(t+=R.PI2);let e=m.b,s=m.d;t=Math.atan2(s,e)+(t-R.PI/2+d)*i;let n=Math.sqrt(e*e+s*s);m.b=Math.cos(t)*n,m.d=Math.sin(t)*n,g=!0}g&&(m.appliedValid=!1)}}applyAbsoluteLocal(){let t=this.rotateMix,e=this.translateMix,s=this.scaleMix,i=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();let a=this.bones;for(let r=0,o=a.length;r<o;r++){let o=a[r];o.appliedValid||o.updateAppliedTransform();let l=o.arotation;if(0!=t){let e=n.arotation-l+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),l+=e*t}let h=o.ax,c=o.ay;0!=e&&(h+=(n.ax-h+this.data.offsetX)*e,c+=(n.ay-c+this.data.offsetY)*e);let d=o.ascaleX,u=o.ascaleY;0!=s&&(d>1e-5&&(d=(d+(n.ascaleX-d+this.data.offsetScaleX)*s)/d),u>1e-5&&(u=(u+(n.ascaleY-u+this.data.offsetScaleY)*s)/u));let m=o.ashearY;if(0!=i){let t=n.ashearY-m+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),o.shearY+=t*i}o.updateWorldTransformWith(h,c,l,d,u,o.ashearX,m)}}applyRelativeLocal(){let t=this.rotateMix,e=this.translateMix,s=this.scaleMix,i=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();let a=this.bones;for(let r=0,o=a.length;r<o;r++){let o=a[r];o.appliedValid||o.updateAppliedTransform();let l=o.arotation;0!=t&&(l+=(n.arotation+this.data.offsetRotation)*t);let h=o.ax,c=o.ay;0!=e&&(h+=(n.ax+this.data.offsetX)*e,c+=(n.ay+this.data.offsetY)*e);let d=o.ascaleX,u=o.ascaleY;0!=s&&(d>1e-5&&(d*=(n.ascaleX-1+this.data.offsetScaleX)*s+1),u>1e-5&&(u*=(n.ascaleY-1+this.data.offsetScaleY)*s+1));let m=o.ashearY;0!=i&&(m+=(n.ashearY+this.data.offsetShearY)*i),o.updateWorldTransformWith(h,c,l,d,u,o.ashearX,m)}}}class Q{data;bones;slots;drawOrder;ikConstraints;transformConstraints;pathConstraints;_updateCache=new Array;updateCacheReset=new Array;skin;color;time=0;scaleX=1;scaleY=1;x=0;y=0;constructor(t){if(null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){let s,i=t.bones[e];if(null==i.parent)s=new W(i,this,null);else{let t=this.bones[i.parent.index];s=new W(i,this,t),t.children.push(s)}this.bones.push(s)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){let s=t.slots[e],i=this.bones[s.boneData.index],n=new j(s,i);this.slots.push(n),this.drawOrder.push(n)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){let s=t.ikConstraints[e];this.ikConstraints.push(new U(s,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){let s=t.transformConstraints[e];this.transformConstraints.push(new H(s,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){let s=t.pathConstraints[e];this.pathConstraints.push(new z(s,this))}this.color=new I(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0,this.updateCacheReset.length=0;let t=this.bones;for(let e=0,s=t.length;e<s;e++){let s=t[e];s.sorted=s.data.skinRequired,s.active=!s.sorted}if(null!=this.skin){let t=this.skin.bones;for(let e=0,s=this.skin.bones.length;e<s;e++){let s=this.bones[t[e].index];do{s.sorted=!1,s.active=!0,s=s.parent}while(null!=s)}}let e=this.ikConstraints,s=this.transformConstraints,i=this.pathConstraints,n=e.length,a=s.length,r=i.length,o=n+a+r;t:for(let t=0;t<o;t++){for(let s=0;s<n;s++){let i=e[s];if(i.data.order==t){this.sortIkConstraint(i);continue t}}for(let e=0;e<a;e++){let i=s[e];if(i.data.order==t){this.sortTransformConstraint(i);continue t}}for(let e=0;e<r;e++){let s=i[e];if(s.data.order==t){this.sortPathConstraint(s);continue t}}}for(let e=0,s=t.length;e<s;e++)this.sortBone(t[e])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&T.contains(this.skin.constraints,t.data,!0)),!t.active)return;let e=t.target;this.sortBone(e);let s=t.bones,i=s[0];if(this.sortBone(i),s.length>1){let t=s[s.length-1];this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}this._updateCache.push(t),this.sortReset(i.children),s[s.length-1].sorted=!0}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&T.contains(this.skin.constraints,t.data,!0)),!t.active)return;let e=t.target,s=e.data.index,i=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,s,i),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,i);for(let t=0,e=this.data.skins.length;t<e;t++)this.sortPathConstraintAttachment(this.data.skins[t],s,i);let n=e.getAttachment();n instanceof D&&this.sortPathConstraintAttachmentWith(n,i);let a=t.bones,r=a.length;for(let t=0;t<r;t++)this.sortBone(a[t]);this._updateCache.push(t);for(let t=0;t<r;t++)this.sortReset(a[t].children);for(let t=0;t<r;t++)a[t].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&T.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);let e=t.bones,s=e.length;if(t.data.local)for(let t=0;t<s;t++){let s=e[t];this.sortBone(s.parent),this._updateCache.indexOf(s)>-1||this.updateCacheReset.push(s)}else for(let t=0;t<s;t++)this.sortBone(e[t]);this._updateCache.push(t);for(let t=0;t<s;t++)this.sortReset(e[t].children);for(let t=0;t<s;t++)e[t].sorted=!0}sortPathConstraintAttachment(t,e,s){let i=t.attachments[e];if(i)for(let t in i)this.sortPathConstraintAttachmentWith(i[t],s)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof D))return;let s=t.bones;if(null==s)this.sortBone(e);else{let t=this.bones,e=0;for(;e<s.length;){let i=s[e++];for(let n=e+i;e<n;e++){let i=s[e];this.sortBone(t[i])}}}}sortBone(t){if(t.sorted)return;let e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,s=t.length;e<s;e++){let s=t[e];s.active&&(s.sorted&&this.sortReset(s.children),s.sorted=!1)}}updateWorldTransform(){let t=this.updateCacheReset;for(let e=0,s=t.length;e<s;e++){let s=t[e];s.ax=s.x,s.ay=s.y,s.arotation=s.rotation,s.ascaleX=s.scaleX,s.ascaleY=s.scaleY,s.ashearX=s.shearX,s.ashearY=s.shearY,s.appliedValid=!0}let e=this._updateCache;for(let t=0,s=e.length;t<s;t++)e[t].update()}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){let t=this.bones;for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose();let e=this.ikConstraints;for(let t=0,s=e.length;t<s;t++){let s=e[t];s.mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch}let s=this.transformConstraints;for(let t=0,e=s.length;t<e;t++){let e=s[t],i=e.data;e.rotateMix=i.rotateMix,e.translateMix=i.translateMix,e.scaleMix=i.scaleMix,e.shearMix=i.shearMix}let i=this.pathConstraints;for(let t=0,e=i.length;t<e;t++){let e=i[t],s=e.data;e.position=s.position,e.spacing=s.spacing,e.rotateMix=s.rotateMix,e.translateMix=s.translateMix}}setSlotsToSetupPose(){let t=this.slots;T.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(null==t)throw new Error("boneName cannot be null.");let e=this.bones;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.data.name==t)return i}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");let e=this.bones;for(let s=0,i=e.length;s<i;s++)if(e[s].data.name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");let e=this.slots;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.data.name==t)return i}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");let e=this.slots;for(let s=0,i=e.length;s<i;s++)if(e[s].data.name==t)return s;return-1}setSkinByName(t){let e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else{let e=this.slots;for(let s=0,i=e.length;s<i;s++){let i=e[s],n=i.data.attachmentName;if(null!=n){let e=t.getAttachment(s,n);null!=e&&i.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}getAttachment(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){let s=this.skin.getAttachment(t,e);if(null!=s)return s}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(null==t)throw new Error("slotName cannot be null.");let s=this.slots;for(let i=0,n=s.length;i<n;i++){let n=s[i];if(n.data.name==t){let s=null;if(null!=e&&(s=this.getAttachment(i,e),null==s))throw new Error("Attachment not found: "+e+", for slot: "+t);return void n.setAttachment(s)}}throw new Error("Slot not found: "+t)}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");let e=this.ikConstraints;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.data.name==t)return i}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");let e=this.transformConstraints;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.data.name==t)return i}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");let e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.data.name==t)return i}return null}getBounds(t,e,s=new Array(2)){if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");let i=this.drawOrder,n=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let t=0,e=i.length;t<e;t++){let e=i[t];if(!e.bone.active)continue;let l=0,h=null,c=e.getAttachment();if(c instanceof B)l=8,h=T.setArraySize(s,l,0),c.computeWorldVertices(e.bone,h,0,2);else if(c instanceof Y){let t=c;l=t.worldVerticesLength,h=T.setArraySize(s,l,0),t.computeWorldVertices(e,0,l,h,0,2)}if(null!=h)for(let t=0,e=h.length;t<e;t+=2){let e=h[t],s=h[t+1];n=Math.min(n,e),a=Math.min(a,s),r=Math.max(r,e),o=Math.max(o,s)}}t.set(n,a),e.set(r-n,o-a)}update(t){this.time+=t}}class J{name;timelines;timelineIds;duration;constructor(t,e,s){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var i=0;i<e.length;i++)this.timelineIds[e[i].getPropertyId()]=!0;this.duration=s}hasTimeline(t){return 1==this.timelineIds[t]}apply(t,e,s,i,n,a,r,o){if(null==t)throw new Error("skeleton cannot be null.");i&&0!=this.duration&&(s%=this.duration,e>0&&(e%=this.duration));let l=this.timelines;for(let i=0,h=l.length;i<h;i++)l[i].apply(t,e,s,n,a,r,o)}static binarySearch(t,e,s=1){let i=0,n=t.length/s-2;if(0==n)return s;let a=n>>>1;for(;;){if(t[(a+1)*s]<=e?i=a+1:n=a,i==n)return(i+1)*s;a=i+n>>>1}}static linearSearch(t,e,s){for(let i=0,n=t.length-s;i<=n;i+=s)if(t[i]>e)return i;return-1}}!function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(d||(d={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(u||(u={})),function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(m||(m={}));class q{static LINEAR=0;static STEPPED=1;static BEZIER=2;static BEZIER_SIZE=19;curves;constructor(t){if(t<=0)throw new Error("frameCount must be > 0: "+t);this.curves=T.newFloatArray((t-1)*q.BEZIER_SIZE)}getFrameCount(){return this.curves.length/q.BEZIER_SIZE+1}setLinear(t){this.curves[t*q.BEZIER_SIZE]=q.LINEAR}setStepped(t){this.curves[t*q.BEZIER_SIZE]=q.STEPPED}getCurveType(t){let e=t*q.BEZIER_SIZE;if(e==this.curves.length)return q.LINEAR;let s=this.curves[e];return s==q.LINEAR?q.LINEAR:s==q.STEPPED?q.STEPPED:q.BEZIER}setCurve(t,e,s,i,n){let a=.03*(2*-e+i),r=.03*(2*-s+n),o=.006*(3*(e-i)+1),l=.006*(3*(s-n)+1),h=2*a+o,c=2*r+l,d=.3*e+a+.16666667*o,u=.3*s+r+.16666667*l,m=t*q.BEZIER_SIZE,g=this.curves;g[m++]=q.BEZIER;let f=d,p=u;for(let t=m+q.BEZIER_SIZE-1;m<t;m+=2)g[m]=f,g[m+1]=p,d+=h,u+=c,h+=o,c+=l,f+=d,p+=u}getCurvePercent(t,e){e=R.clamp(e,0,1);let s=this.curves,i=t*q.BEZIER_SIZE,n=s[i];if(n==q.LINEAR)return e;if(n==q.STEPPED)return 0;i++;let a=0;for(let t=i,n=i+q.BEZIER_SIZE-1;i<n;i+=2)if(a=s[i],a>=e){let n,r;return i==t?(n=0,r=0):(n=s[i-2],r=s[i-1]),r+(s[i+1]-r)*(e-n)/(a-n)}let r=s[i-1];return r+(1-r)*(e-a)/(1-a)}}class K extends q{static ENTRIES=2;static PREV_TIME=-2;static PREV_ROTATION=-1;static ROTATION=1;boneIndex;frames;constructor(t){super(t),this.frames=T.newFloatArray(t<<1)}getPropertyId(){return(m.rotate<<24)+this.boneIndex}setFrame(t,e,s){t<<=1,this.frames[t]=e,this.frames[t+K.ROTATION]=s}apply(t,e,s,i,n,a,r){let o=this.frames,l=t.bones[this.boneIndex];if(!l.active)return;if(s<o[0]){switch(a){case d.setup:return void(l.rotation=l.data.rotation);case d.first:let t=l.data.rotation-l.rotation;l.rotation+=(t-360*(16384-(16384.499999999996-t/360|0)))*n}return}if(s>=o[o.length-K.ENTRIES]){let t=o[o.length+K.PREV_ROTATION];switch(a){case d.setup:l.rotation=l.data.rotation+t*n;break;case d.first:case d.replace:t+=l.data.rotation-l.rotation,t-=360*(16384-(16384.499999999996-t/360|0));case d.add:l.rotation+=t*n}return}let h=J.binarySearch(o,s,K.ENTRIES),c=o[h+K.PREV_ROTATION],u=o[h],m=this.getCurvePercent((h>>1)-1,1-(s-u)/(o[h+K.PREV_TIME]-u)),g=o[h+K.ROTATION]-c;switch(g=c+(g-360*(16384-(16384.499999999996-g/360|0)))*m,a){case d.setup:l.rotation=l.data.rotation+(g-360*(16384-(16384.499999999996-g/360|0)))*n;break;case d.first:case d.replace:g+=l.data.rotation-l.rotation;case d.add:l.rotation+=(g-360*(16384-(16384.499999999996-g/360|0)))*n}}}class $ extends q{static ENTRIES=3;static PREV_TIME=-3;static PREV_X=-2;static PREV_Y=-1;static X=1;static Y=2;boneIndex;frames;constructor(t){super(t),this.frames=T.newFloatArray(t*$.ENTRIES)}getPropertyId(){return(m.translate<<24)+this.boneIndex}setFrame(t,e,s,i){t*=$.ENTRIES,this.frames[t]=e,this.frames[t+$.X]=s,this.frames[t+$.Y]=i}apply(t,e,s,i,n,a,r){let o=this.frames,l=t.bones[this.boneIndex];if(!l.active)return;if(s<o[0]){switch(a){case d.setup:return l.x=l.data.x,void(l.y=l.data.y);case d.first:l.x+=(l.data.x-l.x)*n,l.y+=(l.data.y-l.y)*n}return}let h=0,c=0;if(s>=o[o.length-$.ENTRIES])h=o[o.length+$.PREV_X],c=o[o.length+$.PREV_Y];else{let t=J.binarySearch(o,s,$.ENTRIES);h=o[t+$.PREV_X],c=o[t+$.PREV_Y];let e=o[t],i=this.getCurvePercent(t/$.ENTRIES-1,1-(s-e)/(o[t+$.PREV_TIME]-e));h+=(o[t+$.X]-h)*i,c+=(o[t+$.Y]-c)*i}switch(a){case d.setup:l.x=l.data.x+h*n,l.y=l.data.y+c*n;break;case d.first:case d.replace:l.x+=(l.data.x+h-l.x)*n,l.y+=(l.data.y+c-l.y)*n;break;case d.add:l.x+=h*n,l.y+=c*n}}}class tt extends ${constructor(t){super(t)}getPropertyId(){return(m.scale<<24)+this.boneIndex}apply(t,e,s,i,n,a,r){let o=this.frames,l=t.bones[this.boneIndex];if(!l.active)return;if(s<o[0]){switch(a){case d.setup:return l.scaleX=l.data.scaleX,void(l.scaleY=l.data.scaleY);case d.first:l.scaleX+=(l.data.scaleX-l.scaleX)*n,l.scaleY+=(l.data.scaleY-l.scaleY)*n}return}let h=0,c=0;if(s>=o[o.length-tt.ENTRIES])h=o[o.length+tt.PREV_X]*l.data.scaleX,c=o[o.length+tt.PREV_Y]*l.data.scaleY;else{let t=J.binarySearch(o,s,tt.ENTRIES);h=o[t+tt.PREV_X],c=o[t+tt.PREV_Y];let e=o[t],i=this.getCurvePercent(t/tt.ENTRIES-1,1-(s-e)/(o[t+tt.PREV_TIME]-e));h=(h+(o[t+tt.X]-h)*i)*l.data.scaleX,c=(c+(o[t+tt.Y]-c)*i)*l.data.scaleY}if(1==n)a==d.add?(l.scaleX+=h-l.data.scaleX,l.scaleY+=c-l.data.scaleY):(l.scaleX=h,l.scaleY=c);else{let t=0,e=0;if(r==u.mixOut)switch(a){case d.setup:t=l.data.scaleX,e=l.data.scaleY,l.scaleX=t+(Math.abs(h)*R.signum(t)-t)*n,l.scaleY=e+(Math.abs(c)*R.signum(e)-e)*n;break;case d.first:case d.replace:t=l.scaleX,e=l.scaleY,l.scaleX=t+(Math.abs(h)*R.signum(t)-t)*n,l.scaleY=e+(Math.abs(c)*R.signum(e)-e)*n;break;case d.add:t=l.scaleX,e=l.scaleY,l.scaleX=t+(Math.abs(h)*R.signum(t)-l.data.scaleX)*n,l.scaleY=e+(Math.abs(c)*R.signum(e)-l.data.scaleY)*n}else switch(a){case d.setup:t=Math.abs(l.data.scaleX)*R.signum(h),e=Math.abs(l.data.scaleY)*R.signum(c),l.scaleX=t+(h-t)*n,l.scaleY=e+(c-e)*n;break;case d.first:case d.replace:t=Math.abs(l.scaleX)*R.signum(h),e=Math.abs(l.scaleY)*R.signum(c),l.scaleX=t+(h-t)*n,l.scaleY=e+(c-e)*n;break;case d.add:t=R.signum(h),e=R.signum(c),l.scaleX=Math.abs(l.scaleX)*t+(h-Math.abs(l.data.scaleX)*t)*n,l.scaleY=Math.abs(l.scaleY)*e+(c-Math.abs(l.data.scaleY)*e)*n}}}}class et extends ${constructor(t){super(t)}getPropertyId(){return(m.shear<<24)+this.boneIndex}apply(t,e,s,i,n,a,r){let o=this.frames,l=t.bones[this.boneIndex];if(!l.active)return;if(s<o[0]){switch(a){case d.setup:return l.shearX=l.data.shearX,void(l.shearY=l.data.shearY);case d.first:l.shearX+=(l.data.shearX-l.shearX)*n,l.shearY+=(l.data.shearY-l.shearY)*n}return}let h=0,c=0;if(s>=o[o.length-et.ENTRIES])h=o[o.length+et.PREV_X],c=o[o.length+et.PREV_Y];else{let t=J.binarySearch(o,s,et.ENTRIES);h=o[t+et.PREV_X],c=o[t+et.PREV_Y];let e=o[t],i=this.getCurvePercent(t/et.ENTRIES-1,1-(s-e)/(o[t+et.PREV_TIME]-e));h+=(o[t+et.X]-h)*i,c+=(o[t+et.Y]-c)*i}switch(a){case d.setup:l.shearX=l.data.shearX+h*n,l.shearY=l.data.shearY+c*n;break;case d.first:case d.replace:l.shearX+=(l.data.shearX+h-l.shearX)*n,l.shearY+=(l.data.shearY+c-l.shearY)*n;break;case d.add:l.shearX+=h*n,l.shearY+=c*n}}}class st extends q{static ENTRIES=5;static PREV_TIME=-5;static PREV_R=-4;static PREV_G=-3;static PREV_B=-2;static PREV_A=-1;static R=1;static G=2;static B=3;static A=4;slotIndex;frames;constructor(t){super(t),this.frames=T.newFloatArray(t*st.ENTRIES)}getPropertyId(){return(m.color<<24)+this.slotIndex}setFrame(t,e,s,i,n,a){t*=st.ENTRIES,this.frames[t]=e,this.frames[t+st.R]=s,this.frames[t+st.G]=i,this.frames[t+st.B]=n,this.frames[t+st.A]=a}apply(t,e,s,i,n,a,r){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames;if(s<l[0]){switch(a){case d.setup:return void o.color.setFromColor(o.data.color);case d.first:let t=o.color,e=o.data.color;t.add((e.r-t.r)*n,(e.g-t.g)*n,(e.b-t.b)*n,(e.a-t.a)*n)}return}let h=0,c=0,u=0,m=0;if(s>=l[l.length-st.ENTRIES]){let t=l.length;h=l[t+st.PREV_R],c=l[t+st.PREV_G],u=l[t+st.PREV_B],m=l[t+st.PREV_A]}else{let t=J.binarySearch(l,s,st.ENTRIES);h=l[t+st.PREV_R],c=l[t+st.PREV_G],u=l[t+st.PREV_B],m=l[t+st.PREV_A];let e=l[t],i=this.getCurvePercent(t/st.ENTRIES-1,1-(s-e)/(l[t+st.PREV_TIME]-e));h+=(l[t+st.R]-h)*i,c+=(l[t+st.G]-c)*i,u+=(l[t+st.B]-u)*i,m+=(l[t+st.A]-m)*i}if(1==n)o.color.set(h,c,u,m);else{let t=o.color;a==d.setup&&t.setFromColor(o.data.color),t.add((h-t.r)*n,(c-t.g)*n,(u-t.b)*n,(m-t.a)*n)}}}class it extends q{static ENTRIES=8;static PREV_TIME=-8;static PREV_R=-7;static PREV_G=-6;static PREV_B=-5;static PREV_A=-4;static PREV_R2=-3;static PREV_G2=-2;static PREV_B2=-1;static R=1;static G=2;static B=3;static A=4;static R2=5;static G2=6;static B2=7;slotIndex;frames;constructor(t){super(t),this.frames=T.newFloatArray(t*it.ENTRIES)}getPropertyId(){return(m.twoColor<<24)+this.slotIndex}setFrame(t,e,s,i,n,a,r,o,l){t*=it.ENTRIES,this.frames[t]=e,this.frames[t+it.R]=s,this.frames[t+it.G]=i,this.frames[t+it.B]=n,this.frames[t+it.A]=a,this.frames[t+it.R2]=r,this.frames[t+it.G2]=o,this.frames[t+it.B2]=l}apply(t,e,s,i,n,a,r){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames;if(s<l[0]){switch(a){case d.setup:return o.color.setFromColor(o.data.color),void o.darkColor.setFromColor(o.data.darkColor);case d.first:let t=o.color,e=o.darkColor,s=o.data.color,i=o.data.darkColor;t.add((s.r-t.r)*n,(s.g-t.g)*n,(s.b-t.b)*n,(s.a-t.a)*n),e.add((i.r-e.r)*n,(i.g-e.g)*n,(i.b-e.b)*n,0)}return}let h=0,c=0,u=0,m=0,g=0,f=0,p=0;if(s>=l[l.length-it.ENTRIES]){let t=l.length;h=l[t+it.PREV_R],c=l[t+it.PREV_G],u=l[t+it.PREV_B],m=l[t+it.PREV_A],g=l[t+it.PREV_R2],f=l[t+it.PREV_G2],p=l[t+it.PREV_B2]}else{let t=J.binarySearch(l,s,it.ENTRIES);h=l[t+it.PREV_R],c=l[t+it.PREV_G],u=l[t+it.PREV_B],m=l[t+it.PREV_A],g=l[t+it.PREV_R2],f=l[t+it.PREV_G2],p=l[t+it.PREV_B2];let e=l[t],i=this.getCurvePercent(t/it.ENTRIES-1,1-(s-e)/(l[t+it.PREV_TIME]-e));h+=(l[t+it.R]-h)*i,c+=(l[t+it.G]-c)*i,u+=(l[t+it.B]-u)*i,m+=(l[t+it.A]-m)*i,g+=(l[t+it.R2]-g)*i,f+=(l[t+it.G2]-f)*i,p+=(l[t+it.B2]-p)*i}if(1==n)o.color.set(h,c,u,m),o.darkColor.set(g,f,p,1);else{let t=o.color,e=o.darkColor;a==d.setup&&(t.setFromColor(o.data.color),e.setFromColor(o.data.darkColor)),t.add((h-t.r)*n,(c-t.g)*n,(u-t.b)*n,(m-t.a)*n),e.add((g-e.r)*n,(f-e.g)*n,(p-e.b)*n,0)}}}class nt{slotIndex;frames;attachmentNames;constructor(t){this.frames=T.newFloatArray(t),this.attachmentNames=new Array(t)}getPropertyId(){return(m.attachment<<24)+this.slotIndex}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.attachmentNames[t]=s}apply(t,e,s,i,n,a,r){let o=t.slots[this.slotIndex];if(!o.bone.active)return;if(r==u.mixOut)return void(a==d.setup&&this.setAttachment(t,o,o.data.attachmentName));let l=this.frames;if(s<l[0])return void(a!=d.setup&&a!=d.first||this.setAttachment(t,o,o.data.attachmentName));let h=0;h=s>=l[l.length-1]?l.length-1:J.binarySearch(l,s,1)-1;let c=this.attachmentNames[h];t.slots[this.slotIndex].setAttachment(null==c?null:t.getAttachment(this.slotIndex,c))}setAttachment(t,e,s){e.attachment=null==s?null:t.getAttachment(this.slotIndex,s)}}let at=null;class rt extends q{slotIndex;attachment;frames;frameVertices;constructor(t){super(t),this.frames=T.newFloatArray(t),this.frameVertices=new Array(t),null==at&&(at=T.newFloatArray(64))}getPropertyId(){return(m.deform<<27)+ +this.attachment.id+this.slotIndex}setFrame(t,e,s){this.frames[t]=e,this.frameVertices[t]=s}apply(t,e,s,i,n,a,r){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=o.getAttachment();if(!(l instanceof N)||l.deformAttachment!=this.attachment)return;let h=o.deform;0==h.length&&(a=d.setup);let c=this.frameVertices,u=c[0].length,m=this.frames;if(s<m[0]){let t=l;switch(a){case d.setup:return void(h.length=0);case d.first:if(1==n){h.length=0;break}let e=T.setArraySize(h,u);if(null==t.bones){let s=t.vertices;for(var g=0;g<u;g++)e[g]+=(s[g]-e[g])*n}else for(n=1-n,g=0;g<u;g++)e[g]*=n}return}let f=T.setArraySize(h,u);if(s>=m[m.length-1]){let t=c[m.length-1];if(1==n)if(a==d.add){let e=l;if(null==e.bones){let s=e.vertices;for(let e=0;e<u;e++)f[e]+=t[e]-s[e]}else for(let e=0;e<u;e++)f[e]+=t[e]}else T.arrayCopy(t,0,f,0,u);else switch(a){case d.setup:{let e=l;if(null==e.bones){let s=e.vertices;for(let e=0;e<u;e++){let i=s[e];f[e]=i+(t[e]-i)*n}}else for(let e=0;e<u;e++)f[e]=t[e]*n;break}case d.first:case d.replace:for(let e=0;e<u;e++)f[e]+=(t[e]-f[e])*n;break;case d.add:let e=l;if(null==e.bones){let s=e.vertices;for(let e=0;e<u;e++)f[e]+=(t[e]-s[e])*n}else for(let e=0;e<u;e++)f[e]+=t[e]*n}return}let p=J.binarySearch(m,s),w=c[p-1],x=c[p],b=m[p],y=this.getCurvePercent(p-1,1-(s-b)/(m[p-1]-b));if(1==n)if(a==d.add){let t=l;if(null==t.bones){let e=t.vertices;for(let t=0;t<u;t++){let s=w[t];f[t]+=s+(x[t]-s)*y-e[t]}}else for(let t=0;t<u;t++){let e=w[t];f[t]+=e+(x[t]-e)*y}}else for(let t=0;t<u;t++){let e=w[t];f[t]=e+(x[t]-e)*y}else switch(a){case d.setup:{let t=l;if(null==t.bones){let e=t.vertices;for(let t=0;t<u;t++){let s=w[t],i=e[t];f[t]=i+(s+(x[t]-s)*y-i)*n}}else for(let t=0;t<u;t++){let e=w[t];f[t]=(e+(x[t]-e)*y)*n}break}case d.first:case d.replace:for(let t=0;t<u;t++){let e=w[t];f[t]+=(e+(x[t]-e)*y-f[t])*n}break;case d.add:let t=l;if(null==t.bones){let e=t.vertices;for(let t=0;t<u;t++){let s=w[t];f[t]+=(s+(x[t]-s)*y-e[t])*n}}else for(let t=0;t<u;t++){let e=w[t];f[t]+=(e+(x[t]-e)*y)*n}}}}class ot{frames;events;constructor(t){this.frames=T.newFloatArray(t),this.events=new Array(t)}getPropertyId(){return m.event<<24}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,s,i,n,a,r){if(null==i)return;let o=this.frames,l=this.frames.length;if(e>s)this.apply(t,e,Number.MAX_VALUE,i,n,a,r),e=-1;else if(e>=o[l-1])return;if(s<o[0])return;let h=0;if(e<o[0])h=0;else{h=J.binarySearch(o,e);let t=o[h];for(;h>0&&o[h-1]==t;)h--}for(;h<l&&s>=o[h];h++)i.push(this.events[h])}}class lt{frames;drawOrders;constructor(t){this.frames=T.newFloatArray(t),this.drawOrders=new Array(t)}getPropertyId(){return m.drawOrder<<24}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.drawOrders[t]=s}apply(t,e,s,i,n,a,r){let o=t.drawOrder,l=t.slots;if(r==u.mixOut)return void(a==d.setup&&T.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let h=this.frames;if(s<h[0])return void(a!=d.setup&&a!=d.first||T.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let c=0;c=s>=h[h.length-1]?h.length-1:J.binarySearch(h,s)-1;let m=this.drawOrders[c];if(null==m)T.arrayCopy(l,0,o,0,l.length);else for(let t=0,e=m.length;t<e;t++)o[t]=l[m[t]]}}class ht extends q{static ENTRIES=6;static PREV_TIME=-6;static PREV_MIX=-5;static PREV_SOFTNESS=-4;static PREV_BEND_DIRECTION=-3;static PREV_COMPRESS=-2;static PREV_STRETCH=-1;static MIX=1;static SOFTNESS=2;static BEND_DIRECTION=3;static COMPRESS=4;static STRETCH=5;ikConstraintIndex;frames;constructor(t){super(t),this.frames=T.newFloatArray(t*ht.ENTRIES)}getPropertyId(){return(m.ikConstraint<<24)+this.ikConstraintIndex}setFrame(t,e,s,i,n,a,r){t*=ht.ENTRIES,this.frames[t]=e,this.frames[t+ht.MIX]=s,this.frames[t+ht.SOFTNESS]=i,this.frames[t+ht.BEND_DIRECTION]=n,this.frames[t+ht.COMPRESS]=a?1:0,this.frames[t+ht.STRETCH]=r?1:0}apply(t,e,s,i,n,a,r){let o=this.frames,l=t.ikConstraints[this.ikConstraintIndex];if(!l.active)return;if(s<o[0]){switch(a){case d.setup:return l.mix=l.data.mix,l.softness=l.data.softness,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,void(l.stretch=l.data.stretch);case d.first:l.mix+=(l.data.mix-l.mix)*n,l.softness+=(l.data.softness-l.softness)*n,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch}return}if(s>=o[o.length-ht.ENTRIES])return void(a==d.setup?(l.mix=l.data.mix+(o[o.length+ht.PREV_MIX]-l.data.mix)*n,l.softness=l.data.softness+(o[o.length+ht.PREV_SOFTNESS]-l.data.softness)*n,r==u.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=o[o.length+ht.PREV_BEND_DIRECTION],l.compress=0!=o[o.length+ht.PREV_COMPRESS],l.stretch=0!=o[o.length+ht.PREV_STRETCH])):(l.mix+=(o[o.length+ht.PREV_MIX]-l.mix)*n,l.softness+=(o[o.length+ht.PREV_SOFTNESS]-l.softness)*n,r==u.mixIn&&(l.bendDirection=o[o.length+ht.PREV_BEND_DIRECTION],l.compress=0!=o[o.length+ht.PREV_COMPRESS],l.stretch=0!=o[o.length+ht.PREV_STRETCH])));let h=J.binarySearch(o,s,ht.ENTRIES),c=o[h+ht.PREV_MIX],m=o[h+ht.PREV_SOFTNESS],g=o[h],f=this.getCurvePercent(h/ht.ENTRIES-1,1-(s-g)/(o[h+ht.PREV_TIME]-g));a==d.setup?(l.mix=l.data.mix+(c+(o[h+ht.MIX]-c)*f-l.data.mix)*n,l.softness=l.data.softness+(m+(o[h+ht.SOFTNESS]-m)*f-l.data.softness)*n,r==u.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=o[h+ht.PREV_BEND_DIRECTION],l.compress=0!=o[h+ht.PREV_COMPRESS],l.stretch=0!=o[h+ht.PREV_STRETCH])):(l.mix+=(c+(o[h+ht.MIX]-c)*f-l.mix)*n,l.softness+=(m+(o[h+ht.SOFTNESS]-m)*f-l.softness)*n,r==u.mixIn&&(l.bendDirection=o[h+ht.PREV_BEND_DIRECTION],l.compress=0!=o[h+ht.PREV_COMPRESS],l.stretch=0!=o[h+ht.PREV_STRETCH]))}}class ct extends q{static ENTRIES=5;static PREV_TIME=-5;static PREV_ROTATE=-4;static PREV_TRANSLATE=-3;static PREV_SCALE=-2;static PREV_SHEAR=-1;static ROTATE=1;static TRANSLATE=2;static SCALE=3;static SHEAR=4;transformConstraintIndex;frames;constructor(t){super(t),this.frames=T.newFloatArray(t*ct.ENTRIES)}getPropertyId(){return(m.transformConstraint<<24)+this.transformConstraintIndex}setFrame(t,e,s,i,n,a){t*=ct.ENTRIES,this.frames[t]=e,this.frames[t+ct.ROTATE]=s,this.frames[t+ct.TRANSLATE]=i,this.frames[t+ct.SCALE]=n,this.frames[t+ct.SHEAR]=a}apply(t,e,s,i,n,a,r){let o=this.frames,l=t.transformConstraints[this.transformConstraintIndex];if(!l.active)return;if(s<o[0]){let t=l.data;switch(a){case d.setup:return l.rotateMix=t.rotateMix,l.translateMix=t.translateMix,l.scaleMix=t.scaleMix,void(l.shearMix=t.shearMix);case d.first:l.rotateMix+=(t.rotateMix-l.rotateMix)*n,l.translateMix+=(t.translateMix-l.translateMix)*n,l.scaleMix+=(t.scaleMix-l.scaleMix)*n,l.shearMix+=(t.shearMix-l.shearMix)*n}return}let h=0,c=0,u=0,m=0;if(s>=o[o.length-ct.ENTRIES]){let t=o.length;h=o[t+ct.PREV_ROTATE],c=o[t+ct.PREV_TRANSLATE],u=o[t+ct.PREV_SCALE],m=o[t+ct.PREV_SHEAR]}else{let t=J.binarySearch(o,s,ct.ENTRIES);h=o[t+ct.PREV_ROTATE],c=o[t+ct.PREV_TRANSLATE],u=o[t+ct.PREV_SCALE],m=o[t+ct.PREV_SHEAR];let e=o[t],i=this.getCurvePercent(t/ct.ENTRIES-1,1-(s-e)/(o[t+ct.PREV_TIME]-e));h+=(o[t+ct.ROTATE]-h)*i,c+=(o[t+ct.TRANSLATE]-c)*i,u+=(o[t+ct.SCALE]-u)*i,m+=(o[t+ct.SHEAR]-m)*i}if(a==d.setup){let t=l.data;l.rotateMix=t.rotateMix+(h-t.rotateMix)*n,l.translateMix=t.translateMix+(c-t.translateMix)*n,l.scaleMix=t.scaleMix+(u-t.scaleMix)*n,l.shearMix=t.shearMix+(m-t.shearMix)*n}else l.rotateMix+=(h-l.rotateMix)*n,l.translateMix+=(c-l.translateMix)*n,l.scaleMix+=(u-l.scaleMix)*n,l.shearMix+=(m-l.shearMix)*n}}class dt extends q{static ENTRIES=2;static PREV_TIME=-2;static PREV_VALUE=-1;static VALUE=1;pathConstraintIndex;frames;constructor(t){super(t),this.frames=T.newFloatArray(t*dt.ENTRIES)}getPropertyId(){return(m.pathConstraintPosition<<24)+this.pathConstraintIndex}setFrame(t,e,s){t*=dt.ENTRIES,this.frames[t]=e,this.frames[t+dt.VALUE]=s}apply(t,e,s,i,n,a,r){let o=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(!l.active)return;if(s<o[0]){switch(a){case d.setup:return void(l.position=l.data.position);case d.first:l.position+=(l.data.position-l.position)*n}return}let h=0;if(s>=o[o.length-dt.ENTRIES])h=o[o.length+dt.PREV_VALUE];else{let t=J.binarySearch(o,s,dt.ENTRIES);h=o[t+dt.PREV_VALUE];let e=o[t],i=this.getCurvePercent(t/dt.ENTRIES-1,1-(s-e)/(o[t+dt.PREV_TIME]-e));h+=(o[t+dt.VALUE]-h)*i}a==d.setup?l.position=l.data.position+(h-l.data.position)*n:l.position+=(h-l.position)*n}}class ut extends dt{constructor(t){super(t)}getPropertyId(){return(m.pathConstraintSpacing<<24)+this.pathConstraintIndex}apply(t,e,s,i,n,a,r){let o=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(!l.active)return;if(s<o[0]){switch(a){case d.setup:return void(l.spacing=l.data.spacing);case d.first:l.spacing+=(l.data.spacing-l.spacing)*n}return}let h=0;if(s>=o[o.length-ut.ENTRIES])h=o[o.length+ut.PREV_VALUE];else{let t=J.binarySearch(o,s,ut.ENTRIES);h=o[t+ut.PREV_VALUE];let e=o[t],i=this.getCurvePercent(t/ut.ENTRIES-1,1-(s-e)/(o[t+ut.PREV_TIME]-e));h+=(o[t+ut.VALUE]-h)*i}a==d.setup?l.spacing=l.data.spacing+(h-l.data.spacing)*n:l.spacing+=(h-l.spacing)*n}}class mt extends q{static ENTRIES=3;static PREV_TIME=-3;static PREV_ROTATE=-2;static PREV_TRANSLATE=-1;static ROTATE=1;static TRANSLATE=2;pathConstraintIndex;frames;constructor(t){super(t),this.frames=T.newFloatArray(t*mt.ENTRIES)}getPropertyId(){return(m.pathConstraintMix<<24)+this.pathConstraintIndex}setFrame(t,e,s,i){t*=mt.ENTRIES,this.frames[t]=e,this.frames[t+mt.ROTATE]=s,this.frames[t+mt.TRANSLATE]=i}apply(t,e,s,i,n,a,r){let o=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(!l.active)return;if(s<o[0]){switch(a){case d.setup:return l.rotateMix=l.data.rotateMix,void(l.translateMix=l.data.translateMix);case d.first:l.rotateMix+=(l.data.rotateMix-l.rotateMix)*n,l.translateMix+=(l.data.translateMix-l.translateMix)*n}return}let h=0,c=0;if(s>=o[o.length-mt.ENTRIES])h=o[o.length+mt.PREV_ROTATE],c=o[o.length+mt.PREV_TRANSLATE];else{let t=J.binarySearch(o,s,mt.ENTRIES);h=o[t+mt.PREV_ROTATE],c=o[t+mt.PREV_TRANSLATE];let e=o[t],i=this.getCurvePercent(t/mt.ENTRIES-1,1-(s-e)/(o[t+mt.PREV_TIME]-e));h+=(o[t+mt.ROTATE]-h)*i,c+=(o[t+mt.TRANSLATE]-c)*i}a==d.setup?(l.rotateMix=l.data.rotateMix+(h-l.data.rotateMix)*n,l.translateMix=l.data.translateMix+(c-l.data.translateMix)*n):(l.rotateMix+=(h-l.rotateMix)*n,l.translateMix+=(c-l.translateMix)*n)}}var gt;!function(t){t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping"}(gt||(gt={}));class ft{data;intValue;floatValue;stringValue;time;volume;balance;constructor(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}}class pt{name;intValue;floatValue;stringValue;audioPath;volume;balance;constructor(t){this.name=t}}class wt extends G{bones=new Array;target;bendDirection=1;compress=!1;stretch=!1;uniform=!1;mix=1;softness=0;constructor(t){super(t,0,!1)}}class xt{name;bones=new Array;slots=new Array;skins=new Array;defaultSkin;events=new Array;animations=new Array;ikConstraints=new Array;transformConstraints=new Array;pathConstraints=new Array;x;y;width;height;version;hash;fps=0;imagesPath;audioPath;findBone(t){if(null==t)throw new Error("boneName cannot be null.");let e=this.bones;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");let e=this.bones;for(let s=0,i=e.length;s<i;s++)if(e[s].name==t)return s;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");let e=this.slots;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");let e=this.slots;for(let s=0,i=e.length;s<i;s++)if(e[s].name==t)return s;return-1}findSkin(t){if(null==t)throw new Error("skinName cannot be null.");let e=this.skins;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findEvent(t){if(null==t)throw new Error("eventDataName cannot be null.");let e=this.events;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findAnimation(t){if(null==t)throw new Error("animationName cannot be null.");let e=this.animations;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");let e=this.ikConstraints;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");let e=this.transformConstraints;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");let e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(i.name==t)return i}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");let e=this.pathConstraints;for(let s=0,i=e.length;s<i;s++)if(e[s].name==t)return s;return-1}}class bt{slotIndex;name;attachment;constructor(t,e,s){this.slotIndex=t,this.name=e,this.attachment=s}}class yt{name;attachments=new Array;bones=Array();constraints=new Array;constructor(t){if(null==t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,s){if(null==s)throw new Error("attachment cannot be null.");let i=this.attachments;t>=i.length&&(i.length=t+1),i[t]||(i[t]={}),i[t][e]=s}addSkin(t){for(let e=0;e<t.bones.length;e++){let s=t.bones[e],i=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==s){i=!0;break}i||this.bones.push(s)}for(let e=0;e<t.constraints.length;e++){let s=t.constraints[e],i=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==s){i=!0;break}i||this.constraints.push(s)}let e=t.getAttachments();for(let t=0;t<e.length;t++){var s=e[t];this.setAttachment(s.slotIndex,s.name,s.attachment)}}copySkin(t){for(let e=0;e<t.bones.length;e++){let s=t.bones[e],i=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==s){i=!0;break}i||this.bones.push(s)}for(let e=0;e<t.constraints.length;e++){let s=t.constraints[e],i=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==s){i=!0;break}i||this.constraints.push(s)}let e=t.getAttachments();for(let t=0;t<e.length;t++){var s=e[t];null!=s.attachment&&(s.attachment instanceof Y?(s.attachment=s.attachment.newLinkedMesh(),this.setAttachment(s.slotIndex,s.name,s.attachment)):(s.attachment=s.attachment.copy(),this.setAttachment(s.slotIndex,s.name,s.attachment)))}}getAttachment(t,e){let s=this.attachments[t];return s?s[e]:null}removeAttachment(t,e){let s=this.attachments[t];s&&(s[e]=null)}getAttachments(){let t=new Array;for(var e=0;e<this.attachments.length;e++){let s=this.attachments[e];if(s)for(let i in s){let n=s[i];n&&t.push(new bt(e,i,n))}}return t}getAttachmentsForSlot(t,e){let s=this.attachments[t];if(s)for(let i in s){let n=s[i];n&&e.push(new bt(t,i,n))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let s=0;for(let i=0;i<t.slots.length;i++){let n=t.slots[i],a=n.getAttachment();if(a&&s<e.attachments.length){let t=e.attachments[s];for(let e in t)if(a==t[e]){let t=this.getAttachment(s,e);null!=t&&n.setAttachment(t);break}}s++}}}class vt{index;name;boneData;color=new I(1,1,1,1);darkColor;attachmentName;blendMode;constructor(t,e,s){if(t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==s)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=s}}class At extends G{bones=new Array;target;rotateMix=0;translateMix=0;scaleMix=0;shearMix=0;offsetRotation=0;offsetX=0;offsetY=0;offsetScaleX=0;offsetScaleY=0;offsetShearY=0;relative=!1;local=!1;constructor(t){super(t,0,!1)}}class Et{static AttachmentTypeValues=[0,1,2,3,4,5,6];static TransformModeValues=[o.Normal,o.OnlyTranslation,o.NoRotationOrReflection,o.NoScale,o.NoScaleOrReflection];static PositionModeValues=[l.Fixed,l.Percent];static SpacingModeValues=[h.Length,h.Fixed,h.Percent];static RotateModeValues=[c.Tangent,c.Chain,c.ChainScale];static BlendModeValues=[r.Normal,r.Additive,r.Multiply,r.Screen];static BONE_ROTATE=0;static BONE_TRANSLATE=1;static BONE_SCALE=2;static BONE_SHEAR=3;static SLOT_ATTACHMENT=0;static SLOT_COLOR=1;static SLOT_TWO_COLOR=2;static PATH_POSITION=0;static PATH_SPACING=1;static PATH_MIX=2;static CURVE_LINEAR=0;static CURVE_STEPPED=1;static CURVE_BEZIER=2;scale=1;attachmentLoader;linkedMeshes=new Array;constructor(t){this.attachmentLoader=t}readSkeletonData(t){let e=this.scale,s=new xt;s.name="";let i=new St(t);if(s.hash=i.readString(),s.version=i.readString(),"3.8.75"==s.version)throw new Error("Unsupported skeleton data, please export with a newer version of Spine.");s.x=i.readFloat(),s.y=i.readFloat(),s.width=i.readFloat(),s.height=i.readFloat();let n=i.readBoolean();n&&(s.fps=i.readFloat(),s.imagesPath=i.readString(),s.audioPath=i.readString());let a=0;a=i.readInt(!0);for(let t=0;t<a;t++)i.strings.push(i.readString());a=i.readInt(!0);for(let t=0;t<a;t++){let a=i.readString(),r=0==t?null:s.bones[i.readInt(!0)],o=new _(t,a,r);o.rotation=i.readFloat(),o.x=i.readFloat()*e,o.y=i.readFloat()*e,o.scaleX=i.readFloat(),o.scaleY=i.readFloat(),o.shearX=i.readFloat(),o.shearY=i.readFloat(),o.length=i.readFloat()*e,o.transformMode=Et.TransformModeValues[i.readInt(!0)],o.skinRequired=i.readBoolean(),n&&I.rgba8888ToColor(o.color,i.readInt32()),s.bones.push(o)}a=i.readInt(!0);for(let t=0;t<a;t++){let e=i.readString(),n=s.bones[i.readInt(!0)],a=new vt(t,e,n);I.rgba8888ToColor(a.color,i.readInt32());let r=i.readInt32();-1!=r&&I.rgb888ToColor(a.darkColor=new I,r),a.attachmentName=i.readStringRef(),a.blendMode=Et.BlendModeValues[i.readInt(!0)],s.slots.push(a)}a=i.readInt(!0);for(let t,n=0;n<a;n++){let n=new wt(i.readString());n.order=i.readInt(!0),n.skinRequired=i.readBoolean(),t=i.readInt(!0);for(let e=0;e<t;e++)n.bones.push(s.bones[i.readInt(!0)]);n.target=s.bones[i.readInt(!0)],n.mix=i.readFloat(),n.softness=i.readFloat()*e,n.bendDirection=i.readByte(),n.compress=i.readBoolean(),n.stretch=i.readBoolean(),n.uniform=i.readBoolean(),s.ikConstraints.push(n)}a=i.readInt(!0);for(let t,n=0;n<a;n++){let n=new At(i.readString());n.order=i.readInt(!0),n.skinRequired=i.readBoolean(),t=i.readInt(!0);for(let e=0;e<t;e++)n.bones.push(s.bones[i.readInt(!0)]);n.target=s.bones[i.readInt(!0)],n.local=i.readBoolean(),n.relative=i.readBoolean(),n.offsetRotation=i.readFloat(),n.offsetX=i.readFloat()*e,n.offsetY=i.readFloat()*e,n.offsetScaleX=i.readFloat(),n.offsetScaleY=i.readFloat(),n.offsetShearY=i.readFloat(),n.rotateMix=i.readFloat(),n.translateMix=i.readFloat(),n.scaleMix=i.readFloat(),n.shearMix=i.readFloat(),s.transformConstraints.push(n)}a=i.readInt(!0);for(let t,n=0;n<a;n++){let n=new Z(i.readString());n.order=i.readInt(!0),n.skinRequired=i.readBoolean(),t=i.readInt(!0);for(let e=0;e<t;e++)n.bones.push(s.bones[i.readInt(!0)]);n.target=s.slots[i.readInt(!0)],n.positionMode=Et.PositionModeValues[i.readInt(!0)],n.spacingMode=Et.SpacingModeValues[i.readInt(!0)],n.rotateMode=Et.RotateModeValues[i.readInt(!0)],n.offsetRotation=i.readFloat(),n.position=i.readFloat(),n.positionMode==l.Fixed&&(n.position*=e),n.spacing=i.readFloat(),n.spacingMode!=h.Length&&n.spacingMode!=h.Fixed||(n.spacing*=e),n.rotateMix=i.readFloat(),n.translateMix=i.readFloat(),s.pathConstraints.push(n)}let r=this.readSkin(i,s,!0,n);null!=r&&(s.defaultSkin=r,s.skins.push(r));{let t=s.skins.length;for(T.setArraySize(s.skins,a=t+i.readInt(!0));t<a;t++)s.skins[t]=this.readSkin(i,s,!1,n)}a=this.linkedMeshes.length;for(let t=0;t<a;t++){let e=this.linkedMeshes[t],i=null==e.skin?s.defaultSkin:s.findSkin(e.skin);if(null==i)throw new Error("Skin not found: "+e.skin);let n=i.getAttachment(e.slotIndex,e.parent);if(null==n)throw new Error("Parent mesh not found: "+e.parent);e.mesh.deformAttachment=e.inheritDeform?n:e.mesh,e.mesh.setParentMesh(n),e.mesh.updateUVs()}this.linkedMeshes.length=0,a=i.readInt(!0);for(let t=0;t<a;t++){let t=new pt(i.readStringRef());t.intValue=i.readInt(!1),t.floatValue=i.readFloat(),t.stringValue=i.readString(),t.audioPath=i.readString(),null!=t.audioPath&&(t.volume=i.readFloat(),t.balance=i.readFloat()),s.events.push(t)}a=i.readInt(!0);for(let t=0;t<a;t++)s.animations.push(this.readAnimation(i,i.readString(),s));return s}readSkin(t,e,s,i){let n=null,a=0;if(s){if(a=t.readInt(!0),0==a)return null;n=new yt("default")}else{n=new yt(t.readStringRef()),n.bones.length=t.readInt(!0);for(let s=0,i=n.bones.length;s<i;s++)n.bones[s]=e.bones[t.readInt(!0)];for(let s=0,i=t.readInt(!0);s<i;s++)n.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let s=0,i=t.readInt(!0);s<i;s++)n.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let s=0,i=t.readInt(!0);s<i;s++)n.constraints.push(e.pathConstraints[t.readInt(!0)]);a=t.readInt(!0)}for(let s=0;s<a;s++){let s=t.readInt(!0);for(let a=0,r=t.readInt(!0);a<r;a++){let a=t.readStringRef(),r=this.readAttachment(t,e,n,s,a,i);null!=r&&n.setAttachment(s,a,r)}}return n}readAttachment(t,e,s,i,n,a){let r=this.scale,o=t.readStringRef();null==o&&(o=n);let l=t.readByte();switch(Et.AttachmentTypeValues[l]){case gt.Region:{let e=t.readStringRef(),i=t.readFloat(),n=t.readFloat(),a=t.readFloat(),l=t.readFloat(),h=t.readFloat(),c=t.readFloat(),d=t.readFloat(),u=t.readInt32();null==e&&(e=o);let m=this.attachmentLoader.newRegionAttachment(s,o,e);return null==m?null:(m.path=e,m.x=n*r,m.y=a*r,m.scaleX=l,m.scaleY=h,m.rotation=i,m.width=c*r,m.height=d*r,I.rgba8888ToColor(m.color,u),m.updateOffset(),m)}case gt.BoundingBox:{let e=t.readInt(!0),i=this.readVertices(t,e),n=a?t.readInt32():0,r=this.attachmentLoader.newBoundingBoxAttachment(s,o);return null==r?null:(r.worldVerticesLength=e<<1,r.vertices=i.vertices,r.bones=i.bones,a&&I.rgba8888ToColor(r.color,n),r)}case gt.Mesh:{let e=t.readStringRef(),i=t.readInt32(),n=t.readInt(!0),l=this.readFloatArray(t,n<<1,1),h=this.readShortArray(t),c=this.readVertices(t,n),d=t.readInt(!0),u=null,m=0,g=0;a&&(u=this.readShortArray(t),m=t.readFloat(),g=t.readFloat()),null==e&&(e=o);let f=this.attachmentLoader.newMeshAttachment(s,o,e);return null==f?null:(f.path=e,I.rgba8888ToColor(f.color,i),f.bones=c.bones,f.vertices=c.vertices,f.worldVerticesLength=n<<1,f.triangles=h,f.regionUVs=l,f.updateUVs(),f.hullLength=d<<1,a&&(f.edges=u,f.width=m*r,f.height=g*r),f)}case gt.LinkedMesh:{let e=t.readStringRef(),n=t.readInt32(),l=t.readStringRef(),h=t.readStringRef(),c=t.readBoolean(),d=0,u=0;a&&(d=t.readFloat(),u=t.readFloat()),null==e&&(e=o);let m=this.attachmentLoader.newMeshAttachment(s,o,e);return null==m?null:(m.path=e,I.rgba8888ToColor(m.color,n),a&&(m.width=d*r,m.height=u*r),this.linkedMeshes.push(new Mt(m,l,i,h,c)),m)}case gt.Path:{let e=t.readBoolean(),i=t.readBoolean(),n=t.readInt(!0),l=this.readVertices(t,n),h=T.newArray(n/3,0);for(let e=0,s=h.length;e<s;e++)h[e]=t.readFloat()*r;let c=a?t.readInt32():0,d=this.attachmentLoader.newPathAttachment(s,o);return null==d?null:(d.closed=e,d.constantSpeed=i,d.worldVerticesLength=n<<1,d.vertices=l.vertices,d.bones=l.bones,d.lengths=h,a&&I.rgba8888ToColor(d.color,c),d)}case gt.Point:{let e=t.readFloat(),i=t.readFloat(),n=t.readFloat(),l=a?t.readInt32():0,h=this.attachmentLoader.newPointAttachment(s,o);return null==h?null:(h.x=i*r,h.y=n*r,h.rotation=e,a&&I.rgba8888ToColor(h.color,l),h)}case gt.Clipping:{let i=t.readInt(!0),n=t.readInt(!0),r=this.readVertices(t,n),l=a?t.readInt32():0,h=this.attachmentLoader.newClippingAttachment(s,o);return null==h?null:(h.endSlot=e.slots[i],h.worldVerticesLength=n<<1,h.vertices=r.vertices,h.bones=r.bones,a&&I.rgba8888ToColor(h.color,l),h)}}return null}readVertices(t,e){let s=e<<1,i=new It,n=this.scale;if(!t.readBoolean())return i.vertices=this.readFloatArray(t,s,n),i;let a=new Array,r=new Array;for(let s=0;s<e;s++){let e=t.readInt(!0);r.push(e);for(let s=0;s<e;s++)r.push(t.readInt(!0)),a.push(t.readFloat()*n),a.push(t.readFloat()*n),a.push(t.readFloat())}return i.vertices=T.toFloatArray(a),i.bones=r,i}readFloatArray(t,e,s){let i=new Array(e);if(1==s)for(let s=0;s<e;s++)i[s]=t.readFloat();else for(let n=0;n<e;n++)i[n]=t.readFloat()*s;return i}readShortArray(t){let e=t.readInt(!0),s=new Array(e);for(let i=0;i<e;i++)s[i]=t.readShort();return s}readAnimation(t,e,s){let i=new Array,n=this.scale,a=0,r=new I,o=new I;for(let e=0,s=t.readInt(!0);e<s;e++){let e=t.readInt(!0);for(let s=0,n=t.readInt(!0);s<n;s++){let s=t.readByte(),n=t.readInt(!0);switch(s){case Et.SLOT_ATTACHMENT:{let s=new nt(n);s.slotIndex=e;for(let e=0;e<n;e++)s.setFrame(e,t.readFloat(),t.readStringRef());i.push(s),a=Math.max(a,s.frames[n-1]);break}case Et.SLOT_COLOR:{let s=new st(n);s.slotIndex=e;for(let e=0;e<n;e++){let i=t.readFloat();I.rgba8888ToColor(r,t.readInt32()),s.setFrame(e,i,r.r,r.g,r.b,r.a),e<n-1&&this.readCurve(t,e,s)}i.push(s),a=Math.max(a,s.frames[(n-1)*st.ENTRIES]);break}case Et.SLOT_TWO_COLOR:{let s=new it(n);s.slotIndex=e;for(let e=0;e<n;e++){let i=t.readFloat();I.rgba8888ToColor(r,t.readInt32()),I.rgb888ToColor(o,t.readInt32()),s.setFrame(e,i,r.r,r.g,r.b,r.a,o.r,o.g,o.b),e<n-1&&this.readCurve(t,e,s)}i.push(s),a=Math.max(a,s.frames[(n-1)*it.ENTRIES]);break}}}}for(let e=0,s=t.readInt(!0);e<s;e++){let e=t.readInt(!0);for(let s=0,r=t.readInt(!0);s<r;s++){let s=t.readByte(),r=t.readInt(!0);switch(s){case Et.BONE_ROTATE:{let s=new K(r);s.boneIndex=e;for(let e=0;e<r;e++)s.setFrame(e,t.readFloat(),t.readFloat()),e<r-1&&this.readCurve(t,e,s);i.push(s),a=Math.max(a,s.frames[(r-1)*K.ENTRIES]);break}case Et.BONE_TRANSLATE:case Et.BONE_SCALE:case Et.BONE_SHEAR:{let o,l=1;s==Et.BONE_SCALE?o=new tt(r):s==Et.BONE_SHEAR?o=new et(r):(o=new $(r),l=n),o.boneIndex=e;for(let e=0;e<r;e++)o.setFrame(e,t.readFloat(),t.readFloat()*l,t.readFloat()*l),e<r-1&&this.readCurve(t,e,o);i.push(o),a=Math.max(a,o.frames[(r-1)*$.ENTRIES]);break}}}}for(let e=0,s=t.readInt(!0);e<s;e++){let e=t.readInt(!0),s=t.readInt(!0),r=new ht(s);r.ikConstraintIndex=e;for(let e=0;e<s;e++)r.setFrame(e,t.readFloat(),t.readFloat(),t.readFloat()*n,t.readByte(),t.readBoolean(),t.readBoolean()),e<s-1&&this.readCurve(t,e,r);i.push(r),a=Math.max(a,r.frames[(s-1)*ht.ENTRIES])}for(let e=0,s=t.readInt(!0);e<s;e++){let e=t.readInt(!0),s=t.readInt(!0),n=new ct(s);n.transformConstraintIndex=e;for(let e=0;e<s;e++)n.setFrame(e,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()),e<s-1&&this.readCurve(t,e,n);i.push(n),a=Math.max(a,n.frames[(s-1)*ct.ENTRIES])}for(let e=0,r=t.readInt(!0);e<r;e++){let e=t.readInt(!0),r=s.pathConstraints[e];for(let s=0,o=t.readInt(!0);s<o;s++){let s=t.readByte(),o=t.readInt(!0);switch(s){case Et.PATH_POSITION:case Et.PATH_SPACING:{let c,d=1;s==Et.PATH_SPACING?(c=new ut(o),r.spacingMode!=h.Length&&r.spacingMode!=h.Fixed||(d=n)):(c=new dt(o),r.positionMode==l.Fixed&&(d=n)),c.pathConstraintIndex=e;for(let e=0;e<o;e++)c.setFrame(e,t.readFloat(),t.readFloat()*d),e<o-1&&this.readCurve(t,e,c);i.push(c),a=Math.max(a,c.frames[(o-1)*dt.ENTRIES]);break}case Et.PATH_MIX:{let s=new mt(o);s.pathConstraintIndex=e;for(let e=0;e<o;e++)s.setFrame(e,t.readFloat(),t.readFloat(),t.readFloat()),e<o-1&&this.readCurve(t,e,s);i.push(s),a=Math.max(a,s.frames[(o-1)*mt.ENTRIES]);break}}}}for(let e=0,r=t.readInt(!0);e<r;e++){let e=s.skins[t.readInt(!0)];for(let s=0,r=t.readInt(!0);s<r;s++){let s=t.readInt(!0);for(let r=0,o=t.readInt(!0);r<o;r++){let r=e.getAttachment(s,t.readStringRef()),o=null!=r.bones,l=r.vertices,h=o?l.length/3*2:l.length,c=t.readInt(!0),d=new rt(c);d.slotIndex=s,d.attachment=r;for(let e=0;e<c;e++){let s,i=t.readFloat(),a=t.readInt(!0);if(0==a)s=o?T.newFloatArray(h):l;else{s=T.newFloatArray(h);let e=t.readInt(!0);if(a+=e,1==n)for(let i=e;i<a;i++)s[i]=t.readFloat();else for(let i=e;i<a;i++)s[i]=t.readFloat()*n;if(!o)for(let t=0,e=s.length;t<e;t++)s[t]+=l[t]}d.setFrame(e,i,s),e<c-1&&this.readCurve(t,e,d)}i.push(d),a=Math.max(a,d.frames[c-1])}}}let c=t.readInt(!0);if(c>0){let e=new lt(c),n=s.slots.length;for(let s=0;s<c;s++){let i=t.readFloat(),a=t.readInt(!0),r=T.newArray(n,0);for(let t=n-1;t>=0;t--)r[t]=-1;let o=T.newArray(n-a,0),l=0,h=0;for(let e=0;e<a;e++){let e=t.readInt(!0);for(;l!=e;)o[h++]=l++;r[l+t.readInt(!0)]=l++}for(;l<n;)o[h++]=l++;for(let t=n-1;t>=0;t--)-1==r[t]&&(r[t]=o[--h]);e.setFrame(s,i,r)}i.push(e),a=Math.max(a,e.frames[c-1])}let d=t.readInt(!0);if(d>0){let e=new ot(d);for(let i=0;i<d;i++){let n=t.readFloat(),a=s.events[t.readInt(!0)],r=new ft(n,a);r.intValue=t.readInt(!1),r.floatValue=t.readFloat(),r.stringValue=t.readBoolean()?t.readString():a.stringValue,null!=r.data.audioPath&&(r.volume=t.readFloat(),r.balance=t.readFloat()),e.setFrame(i,r)}i.push(e),a=Math.max(a,e.frames[d-1])}return new J(e,i,a)}readCurve(t,e,s){switch(t.readByte()){case Et.CURVE_STEPPED:s.setStepped(e);break;case Et.CURVE_BEZIER:this.setCurve(s,e,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}}setCurve(t,e,s,i,n,a){t.setCurve(e,s,i,n,a)}}class St{strings;index;buffer;constructor(t,e=new Array,s=0,i=new DataView(t.buffer)){this.strings=e,this.index=s,this.buffer=i}readByte(){return this.buffer.getInt8(this.index++)}readShort(){let t=this.buffer.getInt16(this.index);return this.index+=2,t}readInt32(){let t=this.buffer.getInt32(this.index);return this.index+=4,t}readInt(t){let e=this.readByte(),s=127&e;return 128&e&&(e=this.readByte(),s|=(127&e)<<7,128&e&&(e=this.readByte(),s|=(127&e)<<14,128&e&&(e=this.readByte(),s|=(127&e)<<21,128&e&&(e=this.readByte(),s|=(127&e)<<28)))),t?s:s>>>1^-(1&s)}readStringRef(){let t=this.readInt(!0);return 0==t?null:this.strings[t-1]}readString(){let t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;let e="";for(let s=0;s<t;){let t=this.readByte();switch(t>>4){case 12:case 13:e+=String.fromCharCode((31&t)<<6|63&this.readByte()),s+=2;break;case 14:e+=String.fromCharCode((15&t)<<12|(63&this.readByte())<<6|63&this.readByte()),s+=3;break;default:e+=String.fromCharCode(t),s++}}return e}readFloat(){let t=this.buffer.getFloat32(this.index);return this.index+=4,t}readBoolean(){return 0!=this.readByte()}}class Mt{parent;skin;slotIndex;mesh;inheritDeform;constructor(t,e,s,i,n){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=i,this.inheritDeform=n}}class It{bones;vertices;constructor(t=null,e=null){this.bones=t,this.vertices=e}}class Rt{attachmentLoader;scale=1;linkedMeshes=new Array;constructor(t){this.attachmentLoader=t}readSkeletonData(t){let e=this.scale,s=new xt,i="string"==typeof t?JSON.parse(t):t,n=i.skeleton;if(null!=n){if(s.hash=n.hash,s.version=n.spine,"3.8.75"==s.version)throw new Error("Unsupported skeleton data, please export with a newer version of Spine.");s.x=n.x,s.y=n.y,s.width=n.width,s.height=n.height,s.fps=n.fps,s.imagesPath=n.images}if(i.bones)for(let t=0;t<i.bones.length;t++){let n=i.bones[t],a=null,r=this.getValue(n,"parent",null);if(null!=r&&(a=s.findBone(r),null==a))throw new Error("Parent bone not found: "+r);let o=new _(s.bones.length,n.name,a);o.length=this.getValue(n,"length",0)*e,o.x=this.getValue(n,"x",0)*e,o.y=this.getValue(n,"y",0)*e,o.rotation=this.getValue(n,"rotation",0),o.scaleX=this.getValue(n,"scaleX",1),o.scaleY=this.getValue(n,"scaleY",1),o.shearX=this.getValue(n,"shearX",0),o.shearY=this.getValue(n,"shearY",0),o.transformMode=Rt.transformModeFromString(this.getValue(n,"transform","normal")),o.skinRequired=this.getValue(n,"skin",!1),s.bones.push(o)}if(i.slots)for(let t=0;t<i.slots.length;t++){let e=i.slots[t],n=e.name,a=e.bone,r=s.findBone(a);if(null==r)throw new Error("Slot bone not found: "+a);let o=new vt(s.slots.length,n,r),l=this.getValue(e,"color",null);null!=l&&o.color.setFromString(l);let h=this.getValue(e,"dark",null);null!=h&&(o.darkColor=new I(1,1,1,1),o.darkColor.setFromString(h)),o.attachmentName=this.getValue(e,"attachment",null),o.blendMode=Rt.blendModeFromString(this.getValue(e,"blend","normal")),s.slots.push(o)}if(i.ik)for(let t=0;t<i.ik.length;t++){let n=i.ik[t],a=new wt(n.name);a.order=this.getValue(n,"order",0),a.skinRequired=this.getValue(n,"skin",!1);for(let t=0;t<n.bones.length;t++){let e=n.bones[t],i=s.findBone(e);if(null==i)throw new Error("IK bone not found: "+e);a.bones.push(i)}let r=n.target;if(a.target=s.findBone(r),null==a.target)throw new Error("IK target bone not found: "+r);a.mix=this.getValue(n,"mix",1),a.softness=this.getValue(n,"softness",0)*e,a.bendDirection=this.getValue(n,"bendPositive",!0)?1:-1,a.compress=this.getValue(n,"compress",!1),a.stretch=this.getValue(n,"stretch",!1),a.uniform=this.getValue(n,"uniform",!1),s.ikConstraints.push(a)}if(i.transform)for(let t=0;t<i.transform.length;t++){let n=i.transform[t],a=new At(n.name);a.order=this.getValue(n,"order",0),a.skinRequired=this.getValue(n,"skin",!1);for(let t=0;t<n.bones.length;t++){let e=n.bones[t],i=s.findBone(e);if(null==i)throw new Error("Transform constraint bone not found: "+e);a.bones.push(i)}let r=n.target;if(a.target=s.findBone(r),null==a.target)throw new Error("Transform constraint target bone not found: "+r);a.local=this.getValue(n,"local",!1),a.relative=this.getValue(n,"relative",!1),a.offsetRotation=this.getValue(n,"rotation",0),a.offsetX=this.getValue(n,"x",0)*e,a.offsetY=this.getValue(n,"y",0)*e,a.offsetScaleX=this.getValue(n,"scaleX",0),a.offsetScaleY=this.getValue(n,"scaleY",0),a.offsetShearY=this.getValue(n,"shearY",0),a.rotateMix=this.getValue(n,"rotateMix",1),a.translateMix=this.getValue(n,"translateMix",1),a.scaleMix=this.getValue(n,"scaleMix",1),a.shearMix=this.getValue(n,"shearMix",1),s.transformConstraints.push(a)}if(i.path)for(let t=0;t<i.path.length;t++){let n=i.path[t],a=new Z(n.name);a.order=this.getValue(n,"order",0),a.skinRequired=this.getValue(n,"skin",!1);for(let t=0;t<n.bones.length;t++){let e=n.bones[t],i=s.findBone(e);if(null==i)throw new Error("Transform constraint bone not found: "+e);a.bones.push(i)}let r=n.target;if(a.target=s.findSlot(r),null==a.target)throw new Error("Path target slot not found: "+r);a.positionMode=Rt.positionModeFromString(this.getValue(n,"positionMode","percent")),a.spacingMode=Rt.spacingModeFromString(this.getValue(n,"spacingMode","length")),a.rotateMode=Rt.rotateModeFromString(this.getValue(n,"rotateMode","tangent")),a.offsetRotation=this.getValue(n,"rotation",0),a.position=this.getValue(n,"position",0),a.positionMode==l.Fixed&&(a.position*=e),a.spacing=this.getValue(n,"spacing",0),a.spacingMode!=h.Length&&a.spacingMode!=h.Fixed||(a.spacing*=e),a.rotateMix=this.getValue(n,"rotateMix",1),a.translateMix=this.getValue(n,"translateMix",1),s.pathConstraints.push(a)}if(i.skins)for(let t=0;t<i.skins.length;t++){let e=i.skins[t],n=new yt(e.name);if(e.bones)for(let i=0;i<e.bones.length;i++){let a=s.findBone(e.bones[i]);if(null==a)throw new Error("Skin bone not found: "+e.bones[t]);n.bones.push(a)}if(e.ik)for(let i=0;i<e.ik.length;i++){let a=s.findIkConstraint(e.ik[i]);if(null==a)throw new Error("Skin IK constraint not found: "+e.ik[t]);n.constraints.push(a)}if(e.transform)for(let i=0;i<e.transform.length;i++){let a=s.findTransformConstraint(e.transform[i]);if(null==a)throw new Error("Skin transform constraint not found: "+e.transform[t]);n.constraints.push(a)}if(e.path)for(let i=0;i<e.path.length;i++){let a=s.findPathConstraint(e.path[i]);if(null==a)throw new Error("Skin path constraint not found: "+e.path[t]);n.constraints.push(a)}for(let t in e.attachments){let i=s.findSlot(t);if(null==i)throw new Error("Slot not found: "+t);let a=e.attachments[t];for(let t in a){let e=this.readAttachment(a[t],n,i.index,t,s);null!=e&&n.setAttachment(i.index,t,e)}}s.skins.push(n),"default"==n.name&&(s.defaultSkin=n)}for(let t=0,e=this.linkedMeshes.length;t<e;t++){let e=this.linkedMeshes[t],i=null==e.skin?s.defaultSkin:s.findSkin(e.skin);if(null==i)throw new Error("Skin not found: "+e.skin);let n=i.getAttachment(e.slotIndex,e.parent);if(null==n)throw new Error("Parent mesh not found: "+e.parent);e.mesh.deformAttachment=e.inheritDeform?n:e.mesh,e.mesh.setParentMesh(n),e.mesh.updateUVs()}if(this.linkedMeshes.length=0,i.events)for(let t in i.events){let e=i.events[t],n=new pt(t);n.intValue=this.getValue(e,"int",0),n.floatValue=this.getValue(e,"float",0),n.stringValue=this.getValue(e,"string",""),n.audioPath=this.getValue(e,"audio",null),null!=n.audioPath&&(n.volume=this.getValue(e,"volume",1),n.balance=this.getValue(e,"balance",0)),s.events.push(n)}if(i.animations)for(let t in i.animations){let e=i.animations[t];this.readAnimation(e,t,s)}return s}readAttachment(t,e,s,i,n){let a=this.scale;switch(i=this.getValue(t,"name",i),this.getValue(t,"type","region")){case"region":{let s=this.getValue(t,"path",i),n=this.attachmentLoader.newRegionAttachment(e,i,s);if(null==n)return null;n.path=s,n.x=this.getValue(t,"x",0)*a,n.y=this.getValue(t,"y",0)*a,n.scaleX=this.getValue(t,"scaleX",1),n.scaleY=this.getValue(t,"scaleY",1),n.rotation=this.getValue(t,"rotation",0),n.width=t.width*a,n.height=t.height*a;let r=this.getValue(t,"color",null);return null!=r&&n.color.setFromString(r),n.updateOffset(),n}case"boundingbox":{let s=this.attachmentLoader.newBoundingBoxAttachment(e,i);if(null==s)return null;this.readVertices(t,s,t.vertexCount<<1);let n=this.getValue(t,"color",null);return null!=n&&s.color.setFromString(n),s}case"mesh":case"linkedmesh":{let n=this.getValue(t,"path",i),r=this.attachmentLoader.newMeshAttachment(e,i,n);if(null==r)return null;r.path=n;let o=this.getValue(t,"color",null);null!=o&&r.color.setFromString(o),r.width=this.getValue(t,"width",0)*a,r.height=this.getValue(t,"height",0)*a;let l=this.getValue(t,"parent",null);if(null!=l)return this.linkedMeshes.push(new Tt(r,this.getValue(t,"skin",null),s,l,this.getValue(t,"deform",!0))),r;let h=t.uvs;return this.readVertices(t,r,h.length),r.triangles=t.triangles,r.regionUVs=h,r.updateUVs(),r.edges=this.getValue(t,"edges",null),r.hullLength=2*this.getValue(t,"hull",0),r}case"path":{let s=this.attachmentLoader.newPathAttachment(e,i);if(null==s)return null;s.closed=this.getValue(t,"closed",!1),s.constantSpeed=this.getValue(t,"constantSpeed",!0);let n=t.vertexCount;this.readVertices(t,s,n<<1);let r=T.newArray(n/3,0);for(let e=0;e<t.lengths.length;e++)r[e]=t.lengths[e]*a;s.lengths=r;let o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}case"point":{let s=this.attachmentLoader.newPointAttachment(e,i);if(null==s)return null;s.x=this.getValue(t,"x",0)*a,s.y=this.getValue(t,"y",0)*a,s.rotation=this.getValue(t,"rotation",0);let n=this.getValue(t,"color",null);return null!=n&&s.color.setFromString(n),s}case"clipping":{let s=this.attachmentLoader.newClippingAttachment(e,i);if(null==s)return null;let a=this.getValue(t,"end",null);if(null!=a){let t=n.findSlot(a);if(null==t)throw new Error("Clipping end slot not found: "+a);s.endSlot=t}let r=t.vertexCount;this.readVertices(t,s,r<<1);let o=this.getValue(t,"color",null);return null!=o&&s.color.setFromString(o),s}}return null}readVertices(t,e,s){let i=this.scale;e.worldVerticesLength=s;let n=t.vertices;if(s==n.length){let t=T.toFloatArray(n);if(1!=i)for(let e=0,s=n.length;e<s;e++)t[e]*=i;return void(e.vertices=t)}let a=new Array,r=new Array;for(let t=0,e=n.length;t<e;){let e=n[t++];r.push(e);for(let s=t+4*e;t<s;t+=4)r.push(n[t]),a.push(n[t+1]*i),a.push(n[t+2]*i),a.push(n[t+3])}e.bones=r,e.vertices=T.toFloatArray(a)}readAnimation(t,e,s){let i=this.scale,n=new Array,a=0;if(t.slots)for(let e in t.slots){let i=t.slots[e],r=s.findSlotIndex(e);if(-1==r)throw new Error("Slot not found: "+e);for(let t in i){let s=i[t];if("attachment"==t){let t=new nt(s.length);t.slotIndex=r;let e=0;for(let i=0;i<s.length;i++){let n=s[i];t.setFrame(e++,this.getValue(n,"time",0),n.name)}n.push(t),a=Math.max(a,t.frames[t.getFrameCount()-1])}else if("color"==t){let t=new st(s.length);t.slotIndex=r;let e=0;for(let i=0;i<s.length;i++){let n=s[i],a=new I;a.setFromString(n.color),t.setFrame(e,this.getValue(n,"time",0),a.r,a.g,a.b,a.a),this.readCurve(n,t,e),e++}n.push(t),a=Math.max(a,t.frames[(t.getFrameCount()-1)*st.ENTRIES])}else{if("twoColor"!=t)throw new Error("Invalid timeline type for a slot: "+t+" ("+e+")");{let t=new it(s.length);t.slotIndex=r;let e=0;for(let i=0;i<s.length;i++){let n=s[i],a=new I,r=new I;a.setFromString(n.light),r.setFromString(n.dark),t.setFrame(e,this.getValue(n,"time",0),a.r,a.g,a.b,a.a,r.r,r.g,r.b),this.readCurve(n,t,e),e++}n.push(t),a=Math.max(a,t.frames[(t.getFrameCount()-1)*it.ENTRIES])}}}}if(t.bones)for(let e in t.bones){let r=t.bones[e],o=s.findBoneIndex(e);if(-1==o)throw new Error("Bone not found: "+e);for(let t in r){let s=r[t];if("rotate"===t){let t=new K(s.length);t.boneIndex=o;let e=0;for(let i=0;i<s.length;i++){let n=s[i];t.setFrame(e,this.getValue(n,"time",0),this.getValue(n,"angle",0)),this.readCurve(n,t,e),e++}n.push(t),a=Math.max(a,t.frames[(t.getFrameCount()-1)*K.ENTRIES])}else{if("translate"!==t&&"scale"!==t&&"shear"!==t)throw new Error("Invalid timeline type for a bone: "+t+" ("+e+")");{let e=null,r=1,l=0;"scale"===t?(e=new tt(s.length),l=1):"shear"===t?e=new et(s.length):(e=new $(s.length),r=i),e.boneIndex=o;let h=0;for(let t=0;t<s.length;t++){let i=s[t],n=this.getValue(i,"x",l),a=this.getValue(i,"y",l);e.setFrame(h,this.getValue(i,"time",0),n*r,a*r),this.readCurve(i,e,h),h++}n.push(e),a=Math.max(a,e.frames[(e.getFrameCount()-1)*$.ENTRIES])}}}}if(t.ik)for(let e in t.ik){let r=t.ik[e],o=s.findIkConstraint(e),l=new ht(r.length);l.ikConstraintIndex=s.ikConstraints.indexOf(o);let h=0;for(let t=0;t<r.length;t++){let e=r[t];l.setFrame(h,this.getValue(e,"time",0),this.getValue(e,"mix",1),this.getValue(e,"softness",0)*i,this.getValue(e,"bendPositive",!0)?1:-1,this.getValue(e,"compress",!1),this.getValue(e,"stretch",!1)),this.readCurve(e,l,h),h++}n.push(l),a=Math.max(a,l.frames[(l.getFrameCount()-1)*ht.ENTRIES])}if(t.transform)for(let e in t.transform){let i=t.transform[e],r=s.findTransformConstraint(e),o=new ct(i.length);o.transformConstraintIndex=s.transformConstraints.indexOf(r);let l=0;for(let t=0;t<i.length;t++){let e=i[t];o.setFrame(l,this.getValue(e,"time",0),this.getValue(e,"rotateMix",1),this.getValue(e,"translateMix",1),this.getValue(e,"scaleMix",1),this.getValue(e,"shearMix",1)),this.readCurve(e,o,l),l++}n.push(o),a=Math.max(a,o.frames[(o.getFrameCount()-1)*ct.ENTRIES])}if(t.path)for(let e in t.path){let r=t.path[e],o=s.findPathConstraintIndex(e);if(-1==o)throw new Error("Path constraint not found: "+e);let c=s.pathConstraints[o];for(let t in r){let e=r[t];if("position"===t||"spacing"===t){let s=null,r=1;"spacing"===t?(s=new ut(e.length),c.spacingMode!=h.Length&&c.spacingMode!=h.Fixed||(r=i)):(s=new dt(e.length),c.positionMode==l.Fixed&&(r=i)),s.pathConstraintIndex=o;let d=0;for(let i=0;i<e.length;i++){let n=e[i];s.setFrame(d,this.getValue(n,"time",0),this.getValue(n,t,0)*r),this.readCurve(n,s,d),d++}n.push(s),a=Math.max(a,s.frames[(s.getFrameCount()-1)*dt.ENTRIES])}else if("mix"===t){let t=new mt(e.length);t.pathConstraintIndex=o;let s=0;for(let i=0;i<e.length;i++){let n=e[i];t.setFrame(s,this.getValue(n,"time",0),this.getValue(n,"rotateMix",1),this.getValue(n,"translateMix",1)),this.readCurve(n,t,s),s++}n.push(t),a=Math.max(a,t.frames[(t.getFrameCount()-1)*mt.ENTRIES])}}}if(t.deform)for(let e in t.deform){let r=t.deform[e],o=s.findSkin(e);if(null==o)throw new Error("Skin not found: "+e);for(let t in r){let e=r[t],l=s.findSlotIndex(t);if(-1==l)throw new Error("Slot not found: "+e.name);for(let t in e){let s=e[t],r=o.getAttachment(l,t);if(null==r)throw new Error("Deform attachment not found: "+s.name);let h=null!=r.bones,c=r.vertices,d=h?c.length/3*2:c.length,u=new rt(s.length);u.slotIndex=l,u.attachment=r;let m=0;for(let t=0;t<s.length;t++){let e,n=s[t],a=this.getValue(n,"vertices",null);if(null==a)e=h?T.newFloatArray(d):c;else{e=T.newFloatArray(d);let t=this.getValue(n,"offset",0);if(T.arrayCopy(a,0,e,t,a.length),1!=i)for(let s=t,n=s+a.length;s<n;s++)e[s]*=i;if(!h)for(let t=0;t<d;t++)e[t]+=c[t]}u.setFrame(m,this.getValue(n,"time",0),e),this.readCurve(n,u,m),m++}n.push(u),a=Math.max(a,u.frames[u.getFrameCount()-1])}}}let r=t.drawOrder;if(null==r&&(r=t.draworder),null!=r){let t=new lt(r.length),e=s.slots.length,i=0;for(let n=0;n<r.length;n++){let a=r[n],o=null,l=this.getValue(a,"offsets",null);if(null!=l){o=T.newArray(e,-1);let t=T.newArray(e-l.length,0),i=0,n=0;for(let e=0;e<l.length;e++){let a=l[e],r=s.findSlotIndex(a.slot);if(-1==r)throw new Error("Slot not found: "+a.slot);for(;i!=r;)t[n++]=i++;o[i+a.offset]=i++}for(;i<e;)t[n++]=i++;for(let s=e-1;s>=0;s--)-1==o[s]&&(o[s]=t[--n])}t.setFrame(i++,this.getValue(a,"time",0),o)}n.push(t),a=Math.max(a,t.frames[t.getFrameCount()-1])}if(t.events){let e=new ot(t.events.length),i=0;for(let n=0;n<t.events.length;n++){let a=t.events[n],r=s.findEvent(a.name);if(null==r)throw new Error("Event not found: "+a.name);let o=new ft(T.toSinglePrecision(this.getValue(a,"time",0)),r);o.intValue=this.getValue(a,"int",r.intValue),o.floatValue=this.getValue(a,"float",r.floatValue),o.stringValue=this.getValue(a,"string",r.stringValue),null!=o.data.audioPath&&(o.volume=this.getValue(a,"volume",1),o.balance=this.getValue(a,"balance",0)),e.setFrame(i++,o)}n.push(e),a=Math.max(a,e.frames[e.getFrameCount()-1])}if(isNaN(a))throw new Error("Error while parsing animation, duration is NaN");s.animations.push(new J(e,n,a))}readCurve(t,e,s){if(t.hasOwnProperty("curve"))if("stepped"==t.curve)e.setStepped(s);else{let i=t.curve;e.setCurve(s,i,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}}getValue(t,e,s){return void 0!==t[e]?t[e]:s}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return r.Normal;if("additive"==t)return r.Additive;if("multiply"==t)return r.Multiply;if("screen"==t)return r.Screen;throw new Error(`Unknown blend mode: ${t}`)}static positionModeFromString(t){if("fixed"==(t=t.toLowerCase()))return l.Fixed;if("percent"==t)return l.Percent;throw new Error(`Unknown position mode: ${t}`)}static spacingModeFromString(t){if("length"==(t=t.toLowerCase()))return h.Length;if("fixed"==t)return h.Fixed;if("percent"==t)return h.Percent;throw new Error(`Unknown position mode: ${t}`)}static rotateModeFromString(t){if("tangent"==(t=t.toLowerCase()))return c.Tangent;if("chain"==t)return c.Chain;if("chainscale"==t)return c.ChainScale;throw new Error(`Unknown rotate mode: ${t}`)}static transformModeFromString(t){if("normal"==(t=t.toLowerCase()))return o.Normal;if("onlytranslation"==t)return o.OnlyTranslation;if("norotationorreflection"==t)return o.NoRotationOrReflection;if("noscale"==t)return o.NoScale;if("noscaleorreflection"==t)return o.NoScaleOrReflection;throw new Error(`Unknown transform mode: ${t}`)}}class Tt{parent;skin;slotIndex;mesh;inheritDeform;constructor(t,e,s,i,n){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=i,this.inheritDeform=n}}class Ct{element;lastX=0;lastY=0;buttonDown=!1;currTouch=null;touchesPool=new C((()=>new Pt(0,0,0)));listeners=new Array;constructor(t){this.element=t,this.setupCallbacks(t)}setupCallbacks(t){let e=e=>{if(e instanceof MouseEvent){let s=t.getBoundingClientRect(),i=e.clientX-s.left,n=e.clientY-s.top,a=this.listeners;for(let t=0;t<a.length;t++)this.buttonDown?a[t].dragged&&a[t].dragged(i,n):a[t].moved&&a[t].moved(i,n);this.lastX=i,this.lastY=n}},s=i=>{if(i instanceof MouseEvent){let n=t.getBoundingClientRect(),a=i.clientX-n.left,r=i.clientY-n.top,o=this.listeners;for(let t=0;t<o.length;t++)o[t].up&&o[t].up(a,r);this.lastX=a,this.lastY=r,this.buttonDown=!1,document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s)}};t.addEventListener("mousedown",(i=>{if(i instanceof MouseEvent){let n=t.getBoundingClientRect(),a=i.clientX-n.left,r=i.clientY-n.top,o=this.listeners;for(let t=0;t<o.length;t++)o[t].down&&o[t].down(a,r);this.lastX=a,this.lastY=r,this.buttonDown=!0,document.addEventListener("mousemove",e),document.addEventListener("mouseup",s)}}),!0),t.addEventListener("mousemove",e,!0),t.addEventListener("mouseup",s,!0),t.addEventListener("touchstart",(e=>{if(null!=this.currTouch)return;for(var s=e.changedTouches,i=0;i<s.length;i++){var n=s[i];let e=t.getBoundingClientRect(),a=n.clientX-e.left,r=n.clientY-e.top;this.currTouch=this.touchesPool.obtain(),this.currTouch.identifier=n.identifier,this.currTouch.x=a,this.currTouch.y=r;break}let a=this.listeners;for(let t=0;t<a.length;t++)a[t].down&&a[t].down(this.currTouch.x,this.currTouch.y);this.lastX=this.currTouch.x,this.lastY=this.currTouch.y,this.buttonDown=!0,e.preventDefault()}),!1),t.addEventListener("touchend",(e=>{for(var s=e.changedTouches,i=0;i<s.length;i++){var n=s[i];if(this.currTouch.identifier===n.identifier){let e=t.getBoundingClientRect(),s=this.currTouch.x=n.clientX-e.left,i=this.currTouch.y=n.clientY-e.top;this.touchesPool.free(this.currTouch);let a=this.listeners;for(let t=0;t<a.length;t++)a[t].up&&a[t].up(s,i);this.lastX=s,this.lastY=i,this.buttonDown=!1,this.currTouch=null;break}}e.preventDefault()}),!1),t.addEventListener("touchcancel",(e=>{for(var s=e.changedTouches,i=0;i<s.length;i++){var n=s[i];if(this.currTouch.identifier===n.identifier){let e=t.getBoundingClientRect(),s=this.currTouch.x=n.clientX-e.left,i=this.currTouch.y=n.clientY-e.top;this.touchesPool.free(this.currTouch);let a=this.listeners;for(let t=0;t<a.length;t++)a[t].up&&a[t].up(s,i);this.lastX=s,this.lastY=i,this.buttonDown=!1,this.currTouch=null;break}}e.preventDefault()}),!1),t.addEventListener("touchmove",(e=>{if(null!=this.currTouch){for(var s=e.changedTouches,i=0;i<s.length;i++){var n=s[i];if(this.currTouch.identifier===n.identifier){let e=t.getBoundingClientRect(),s=n.clientX-e.left,i=n.clientY-e.top,a=this.listeners;for(let t=0;t<a.length;t++)a[t].dragged&&a[t].dragged(s,i);this.lastX=this.currTouch.x=s,this.lastY=this.currTouch.y=i;break}}e.preventDefault()}}),!1)}addListener(t){this.listeners.push(t)}removeListener(t){let e=this.listeners.indexOf(t);e>-1&&this.listeners.splice(e,1)}}class Pt{identifier;x;y;constructor(t,e,s){this.identifier=t,this.x=e,this.y=s}}class kt{x=0;y=0;z=0;w=0;constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.z=s}setFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}set(t,e,s){return this.x=t,this.y=e,this.z=s,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}normalize(){let t=this.length();return 0==t||(t=1/t,this.x*=t,this.y*=t,this.z*=t),this}cross(t){return this.set(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}multiply(t){let e=t.values;return this.w=this.x*e[Gt]+this.y*e[Zt]+this.z*e[zt]+e[jt],this.set(this.x*e[Vt]+this.y*e[Nt]+this.z*e[Ot]+e[Lt],this.x*e[Yt]+this.y*e[Dt]+this.z*e[Ft]+e[Bt],this.x*e[Xt]+this.y*e[_t]+this.z*e[Wt]+e[Ut])}project(t){let e=t.values;this.w=this.x*e[Gt]+this.y*e[Zt]+this.z*e[zt]+e[jt];let s=1/this.w;return this.set((this.x*e[Vt]+this.y*e[Nt]+this.z*e[Ot]+e[Lt])*s,(this.x*e[Yt]+this.y*e[Dt]+this.z*e[Ft]+e[Bt])*s,(this.x*e[Xt]+this.y*e[_t]+this.z*e[Wt]+e[Ut])*s)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}distance(t){let e=t.x-this.x,s=t.y-this.y,i=t.z-this.z;return Math.sqrt(e*e+s*s+i*i)}copy(){return new kt(this.x,this.y,this.z)}}const Vt=0,Nt=4,Ot=8,Lt=12,Yt=1,Dt=5,Ft=9,Bt=13,Xt=2,_t=6,Wt=10,Ut=14,Gt=3,Zt=7,zt=11,jt=15;class Ht{temp=new Float32Array(16);values=new Float32Array(16);static xAxis=null;static yAxis=null;static zAxis=null;static tmpMatrix=new Ht;constructor(){let t=this.values;this.identity(),t[Vt]=1,t[Dt]=1,t[Wt]=1,t[jt]=1}set(t){return this.values.set(t),this}transpose(){let t=this.temp,e=this.values;return t[Vt]=e[Vt],t[Nt]=e[Yt],t[Ot]=e[Xt],t[Lt]=e[Gt],t[Yt]=e[Nt],t[Dt]=e[Dt],t[Ft]=e[_t],t[Bt]=e[Zt],t[Xt]=e[Ot],t[_t]=e[Ft],t[Wt]=e[Wt],t[Ut]=e[zt],t[Gt]=e[Lt],t[Zt]=e[Bt],t[zt]=e[Ut],t[jt]=e[jt],this.set(t)}identity(){let t=this.values;return t[Vt]=1,t[Nt]=0,t[Ot]=0,t[Lt]=0,t[Yt]=0,t[Dt]=1,t[Ft]=0,t[Bt]=0,t[Xt]=0,t[_t]=0,t[Wt]=1,t[Ut]=0,t[Gt]=0,t[Zt]=0,t[zt]=0,t[jt]=1,this}invert(){let t=this.values,e=this.temp,s=t[Gt]*t[_t]*t[Ft]*t[Lt]-t[Xt]*t[Zt]*t[Ft]*t[Lt]-t[Gt]*t[Dt]*t[Wt]*t[Lt]+t[Yt]*t[Zt]*t[Wt]*t[Lt]+t[Xt]*t[Dt]*t[zt]*t[Lt]-t[Yt]*t[_t]*t[zt]*t[Lt]-t[Gt]*t[_t]*t[Ot]*t[Bt]+t[Xt]*t[Zt]*t[Ot]*t[Bt]+t[Gt]*t[Nt]*t[Wt]*t[Bt]-t[Vt]*t[Zt]*t[Wt]*t[Bt]-t[Xt]*t[Nt]*t[zt]*t[Bt]+t[Vt]*t[_t]*t[zt]*t[Bt]+t[Gt]*t[Dt]*t[Ot]*t[Ut]-t[Yt]*t[Zt]*t[Ot]*t[Ut]-t[Gt]*t[Nt]*t[Ft]*t[Ut]+t[Vt]*t[Zt]*t[Ft]*t[Ut]+t[Yt]*t[Nt]*t[zt]*t[Ut]-t[Vt]*t[Dt]*t[zt]*t[Ut]-t[Xt]*t[Dt]*t[Ot]*t[jt]+t[Yt]*t[_t]*t[Ot]*t[jt]+t[Xt]*t[Nt]*t[Ft]*t[jt]-t[Vt]*t[_t]*t[Ft]*t[jt]-t[Yt]*t[Nt]*t[Wt]*t[jt]+t[Vt]*t[Dt]*t[Wt]*t[jt];if(0==s)throw new Error("non-invertible matrix");let i=1/s;return e[Vt]=t[Ft]*t[Ut]*t[Zt]-t[Bt]*t[Wt]*t[Zt]+t[Bt]*t[_t]*t[zt]-t[Dt]*t[Ut]*t[zt]-t[Ft]*t[_t]*t[jt]+t[Dt]*t[Wt]*t[jt],e[Nt]=t[Lt]*t[Wt]*t[Zt]-t[Ot]*t[Ut]*t[Zt]-t[Lt]*t[_t]*t[zt]+t[Nt]*t[Ut]*t[zt]+t[Ot]*t[_t]*t[jt]-t[Nt]*t[Wt]*t[jt],e[Ot]=t[Ot]*t[Bt]*t[Zt]-t[Lt]*t[Ft]*t[Zt]+t[Lt]*t[Dt]*t[zt]-t[Nt]*t[Bt]*t[zt]-t[Ot]*t[Dt]*t[jt]+t[Nt]*t[Ft]*t[jt],e[Lt]=t[Lt]*t[Ft]*t[_t]-t[Ot]*t[Bt]*t[_t]-t[Lt]*t[Dt]*t[Wt]+t[Nt]*t[Bt]*t[Wt]+t[Ot]*t[Dt]*t[Ut]-t[Nt]*t[Ft]*t[Ut],e[Yt]=t[Bt]*t[Wt]*t[Gt]-t[Ft]*t[Ut]*t[Gt]-t[Bt]*t[Xt]*t[zt]+t[Yt]*t[Ut]*t[zt]+t[Ft]*t[Xt]*t[jt]-t[Yt]*t[Wt]*t[jt],e[Dt]=t[Ot]*t[Ut]*t[Gt]-t[Lt]*t[Wt]*t[Gt]+t[Lt]*t[Xt]*t[zt]-t[Vt]*t[Ut]*t[zt]-t[Ot]*t[Xt]*t[jt]+t[Vt]*t[Wt]*t[jt],e[Ft]=t[Lt]*t[Ft]*t[Gt]-t[Ot]*t[Bt]*t[Gt]-t[Lt]*t[Yt]*t[zt]+t[Vt]*t[Bt]*t[zt]+t[Ot]*t[Yt]*t[jt]-t[Vt]*t[Ft]*t[jt],e[Bt]=t[Ot]*t[Bt]*t[Xt]-t[Lt]*t[Ft]*t[Xt]+t[Lt]*t[Yt]*t[Wt]-t[Vt]*t[Bt]*t[Wt]-t[Ot]*t[Yt]*t[Ut]+t[Vt]*t[Ft]*t[Ut],e[Xt]=t[Dt]*t[Ut]*t[Gt]-t[Bt]*t[_t]*t[Gt]+t[Bt]*t[Xt]*t[Zt]-t[Yt]*t[Ut]*t[Zt]-t[Dt]*t[Xt]*t[jt]+t[Yt]*t[_t]*t[jt],e[_t]=t[Lt]*t[_t]*t[Gt]-t[Nt]*t[Ut]*t[Gt]-t[Lt]*t[Xt]*t[Zt]+t[Vt]*t[Ut]*t[Zt]+t[Nt]*t[Xt]*t[jt]-t[Vt]*t[_t]*t[jt],e[Wt]=t[Nt]*t[Bt]*t[Gt]-t[Lt]*t[Dt]*t[Gt]+t[Lt]*t[Yt]*t[Zt]-t[Vt]*t[Bt]*t[Zt]-t[Nt]*t[Yt]*t[jt]+t[Vt]*t[Dt]*t[jt],e[Ut]=t[Lt]*t[Dt]*t[Xt]-t[Nt]*t[Bt]*t[Xt]-t[Lt]*t[Yt]*t[_t]+t[Vt]*t[Bt]*t[_t]+t[Nt]*t[Yt]*t[Ut]-t[Vt]*t[Dt]*t[Ut],e[Gt]=t[Ft]*t[_t]*t[Gt]-t[Dt]*t[Wt]*t[Gt]-t[Ft]*t[Xt]*t[Zt]+t[Yt]*t[Wt]*t[Zt]+t[Dt]*t[Xt]*t[zt]-t[Yt]*t[_t]*t[zt],e[Zt]=t[Nt]*t[Wt]*t[Gt]-t[Ot]*t[_t]*t[Gt]+t[Ot]*t[Xt]*t[Zt]-t[Vt]*t[Wt]*t[Zt]-t[Nt]*t[Xt]*t[zt]+t[Vt]*t[_t]*t[zt],e[zt]=t[Ot]*t[Dt]*t[Gt]-t[Nt]*t[Ft]*t[Gt]-t[Ot]*t[Yt]*t[Zt]+t[Vt]*t[Ft]*t[Zt]+t[Nt]*t[Yt]*t[zt]-t[Vt]*t[Dt]*t[zt],e[jt]=t[Nt]*t[Ft]*t[Xt]-t[Ot]*t[Dt]*t[Xt]+t[Ot]*t[Yt]*t[_t]-t[Vt]*t[Ft]*t[_t]-t[Nt]*t[Yt]*t[Wt]+t[Vt]*t[Dt]*t[Wt],t[Vt]=e[Vt]*i,t[Nt]=e[Nt]*i,t[Ot]=e[Ot]*i,t[Lt]=e[Lt]*i,t[Yt]=e[Yt]*i,t[Dt]=e[Dt]*i,t[Ft]=e[Ft]*i,t[Bt]=e[Bt]*i,t[Xt]=e[Xt]*i,t[_t]=e[_t]*i,t[Wt]=e[Wt]*i,t[Ut]=e[Ut]*i,t[Gt]=e[Gt]*i,t[Zt]=e[Zt]*i,t[zt]=e[zt]*i,t[jt]=e[jt]*i,this}determinant(){let t=this.values;return t[Gt]*t[_t]*t[Ft]*t[Lt]-t[Xt]*t[Zt]*t[Ft]*t[Lt]-t[Gt]*t[Dt]*t[Wt]*t[Lt]+t[Yt]*t[Zt]*t[Wt]*t[Lt]+t[Xt]*t[Dt]*t[zt]*t[Lt]-t[Yt]*t[_t]*t[zt]*t[Lt]-t[Gt]*t[_t]*t[Ot]*t[Bt]+t[Xt]*t[Zt]*t[Ot]*t[Bt]+t[Gt]*t[Nt]*t[Wt]*t[Bt]-t[Vt]*t[Zt]*t[Wt]*t[Bt]-t[Xt]*t[Nt]*t[zt]*t[Bt]+t[Vt]*t[_t]*t[zt]*t[Bt]+t[Gt]*t[Dt]*t[Ot]*t[Ut]-t[Yt]*t[Zt]*t[Ot]*t[Ut]-t[Gt]*t[Nt]*t[Ft]*t[Ut]+t[Vt]*t[Zt]*t[Ft]*t[Ut]+t[Yt]*t[Nt]*t[zt]*t[Ut]-t[Vt]*t[Dt]*t[zt]*t[Ut]-t[Xt]*t[Dt]*t[Ot]*t[jt]+t[Yt]*t[_t]*t[Ot]*t[jt]+t[Xt]*t[Nt]*t[Ft]*t[jt]-t[Vt]*t[_t]*t[Ft]*t[jt]-t[Yt]*t[Nt]*t[Wt]*t[jt]+t[Vt]*t[Dt]*t[Wt]*t[jt]}translate(t,e,s){let i=this.values;return i[Lt]+=t,i[Bt]+=e,i[Ut]+=s,this}copy(){return(new Ht).set(this.values)}projection(t,e,s,i){this.identity();let n=s*(Math.PI/180),a=t*(1/Math.tan(n/2)),r=a*i,o=this.values;return o[Vt]=t/r,o[Yt]=0,o[Xt]=0,o[Gt]=0,o[Nt]=0,o[Dt]=t/a,o[_t]=0,o[Zt]=0,o[Ot]=0,o[Ft]=0,o[Wt]=-(e+t)/(e-t),o[zt]=-1,o[Lt]=0,o[Bt]=0,o[Ut]=-2*e*t/(e-t),o[jt]=0,this}ortho2d(t,e,s,i){return this.ortho(t,t+s,e,e+i,0,1)}ortho(t,e,s,i,n,a){this.identity();let r=2/(e-t),o=2/(i-s),l=-2/(a-n),h=-(e+t)/(e-t),c=-(i+s)/(i-s),d=-(a+n)/(a-n),u=this.values;return u[Vt]=r,u[Yt]=0,u[Xt]=0,u[Gt]=0,u[Nt]=0,u[Dt]=o,u[_t]=0,u[Zt]=0,u[Ot]=0,u[Ft]=0,u[Wt]=l,u[zt]=0,u[Lt]=h,u[Bt]=c,u[Ut]=d,u[jt]=1,this}multiply(t){let e=this.temp,s=this.values,i=t.values;return e[Vt]=s[Vt]*i[Vt]+s[Nt]*i[Yt]+s[Ot]*i[Xt]+s[Lt]*i[Gt],e[Nt]=s[Vt]*i[Nt]+s[Nt]*i[Dt]+s[Ot]*i[_t]+s[Lt]*i[Zt],e[Ot]=s[Vt]*i[Ot]+s[Nt]*i[Ft]+s[Ot]*i[Wt]+s[Lt]*i[zt],e[Lt]=s[Vt]*i[Lt]+s[Nt]*i[Bt]+s[Ot]*i[Ut]+s[Lt]*i[jt],e[Yt]=s[Yt]*i[Vt]+s[Dt]*i[Yt]+s[Ft]*i[Xt]+s[Bt]*i[Gt],e[Dt]=s[Yt]*i[Nt]+s[Dt]*i[Dt]+s[Ft]*i[_t]+s[Bt]*i[Zt],e[Ft]=s[Yt]*i[Ot]+s[Dt]*i[Ft]+s[Ft]*i[Wt]+s[Bt]*i[zt],e[Bt]=s[Yt]*i[Lt]+s[Dt]*i[Bt]+s[Ft]*i[Ut]+s[Bt]*i[jt],e[Xt]=s[Xt]*i[Vt]+s[_t]*i[Yt]+s[Wt]*i[Xt]+s[Ut]*i[Gt],e[_t]=s[Xt]*i[Nt]+s[_t]*i[Dt]+s[Wt]*i[_t]+s[Ut]*i[Zt],e[Wt]=s[Xt]*i[Ot]+s[_t]*i[Ft]+s[Wt]*i[Wt]+s[Ut]*i[zt],e[Ut]=s[Xt]*i[Lt]+s[_t]*i[Bt]+s[Wt]*i[Ut]+s[Ut]*i[jt],e[Gt]=s[Gt]*i[Vt]+s[Zt]*i[Yt]+s[zt]*i[Xt]+s[jt]*i[Gt],e[Zt]=s[Gt]*i[Nt]+s[Zt]*i[Dt]+s[zt]*i[_t]+s[jt]*i[Zt],e[zt]=s[Gt]*i[Ot]+s[Zt]*i[Ft]+s[zt]*i[Wt]+s[jt]*i[zt],e[jt]=s[Gt]*i[Lt]+s[Zt]*i[Bt]+s[zt]*i[Ut]+s[jt]*i[jt],this.set(this.temp)}multiplyLeft(t){let e=this.temp,s=this.values,i=t.values;return e[Vt]=i[Vt]*s[Vt]+i[Nt]*s[Yt]+i[Ot]*s[Xt]+i[Lt]*s[Gt],e[Nt]=i[Vt]*s[Nt]+i[Nt]*s[Dt]+i[Ot]*s[_t]+i[Lt]*s[Zt],e[Ot]=i[Vt]*s[Ot]+i[Nt]*s[Ft]+i[Ot]*s[Wt]+i[Lt]*s[zt],e[Lt]=i[Vt]*s[Lt]+i[Nt]*s[Bt]+i[Ot]*s[Ut]+i[Lt]*s[jt],e[Yt]=i[Yt]*s[Vt]+i[Dt]*s[Yt]+i[Ft]*s[Xt]+i[Bt]*s[Gt],e[Dt]=i[Yt]*s[Nt]+i[Dt]*s[Dt]+i[Ft]*s[_t]+i[Bt]*s[Zt],e[Ft]=i[Yt]*s[Ot]+i[Dt]*s[Ft]+i[Ft]*s[Wt]+i[Bt]*s[zt],e[Bt]=i[Yt]*s[Lt]+i[Dt]*s[Bt]+i[Ft]*s[Ut]+i[Bt]*s[jt],e[Xt]=i[Xt]*s[Vt]+i[_t]*s[Yt]+i[Wt]*s[Xt]+i[Ut]*s[Gt],e[_t]=i[Xt]*s[Nt]+i[_t]*s[Dt]+i[Wt]*s[_t]+i[Ut]*s[Zt],e[Wt]=i[Xt]*s[Ot]+i[_t]*s[Ft]+i[Wt]*s[Wt]+i[Ut]*s[zt],e[Ut]=i[Xt]*s[Lt]+i[_t]*s[Bt]+i[Wt]*s[Ut]+i[Ut]*s[jt],e[Gt]=i[Gt]*s[Vt]+i[Zt]*s[Yt]+i[zt]*s[Xt]+i[jt]*s[Gt],e[Zt]=i[Gt]*s[Nt]+i[Zt]*s[Dt]+i[zt]*s[_t]+i[jt]*s[Zt],e[zt]=i[Gt]*s[Ot]+i[Zt]*s[Ft]+i[zt]*s[Wt]+i[jt]*s[zt],e[jt]=i[Gt]*s[Lt]+i[Zt]*s[Bt]+i[zt]*s[Ut]+i[jt]*s[jt],this.set(this.temp)}lookAt(t,e,s){Ht.initTemps();let i=Ht.xAxis,n=Ht.yAxis,a=Ht.zAxis;a.setFrom(e).normalize(),i.setFrom(e).normalize(),i.cross(s).normalize(),n.setFrom(i).cross(a).normalize(),this.identity();let r=this.values;return r[Vt]=i.x,r[Nt]=i.y,r[Ot]=i.z,r[Yt]=n.x,r[Dt]=n.y,r[Ft]=n.z,r[Xt]=-a.x,r[_t]=-a.y,r[Wt]=-a.z,Ht.tmpMatrix.identity(),Ht.tmpMatrix.values[Lt]=-t.x,Ht.tmpMatrix.values[Bt]=-t.y,Ht.tmpMatrix.values[Ut]=-t.z,this.multiply(Ht.tmpMatrix),this}static initTemps(){null===Ht.xAxis&&(Ht.xAxis=new kt),null===Ht.yAxis&&(Ht.yAxis=new kt),null===Ht.zAxis&&(Ht.zAxis=new kt)}}class Qt{position=new kt(0,0,0);direction=new kt(0,0,-1);up=new kt(0,1,0);near=0;far=100;fov=0;zoom=1;viewportWidth=0;viewportHeight=0;projectionView=new Ht;inverseProjectionView=new Ht;projection=new Ht;view=new Ht;is_perspective=!1;tmp=new kt;constructor(t,e){this.viewportWidth=t,this.viewportHeight=e,this.update()}update(){let t=this.projection,e=this.view,s=this.projectionView,i=this.inverseProjectionView,n=this.zoom,a=this.viewportWidth,r=this.viewportHeight;t.ortho(n*(-a/2),n*(a/2),n*(-r/2),n*(r/2),this.near,this.far),e.lookAt(this.position,this.direction,this.up),s.set(t.values),s.multiply(e),i.set(s.values).invert()}screenToWorld(t,e,s){let i=t.x,n=t.y,a=t.z,r=this.tmp;return r.x=i/e*2-1,r.y=n/s*2-1,r.z=a,r.project(this.inverseProjectionView),t.set(r.x,r.y,r.z),t}worldToScreen(t){let e=new kt(t.x,t.y,t.z);return e.multiply(this.projectionView),e.x=(e.x+1)/2*this.viewportWidth,e.y=(e.y+1)/2*this.viewportHeight,new kt(e.x,e.y,0)}setViewport(t,e){this.viewportWidth=t,this.viewportHeight=e}}class Jt{position=new kt(0,0,0);direction=new kt(0,0,-1);up=new kt(0,1,0);near=1;far=1e3;zoom=1;fov=45;viewportWidth=0;viewportHeight=0;projectionView=new Ht;inverseProjectionView=new Ht;projection=new Ht;view=new Ht;is_perspective=!0;tmp=new kt;constructor(t,e){this.viewportWidth=t,this.viewportHeight=e,this.update()}update(t=!1){let e=this.projection,s=this.view,i=this.projectionView,n=this.inverseProjectionView;try{e.projection(this.near,this.far,this.fov,this.viewportWidth/this.viewportHeight),s.lookAt(this.position,this.direction,this.up),i.set(e.values),i.multiply(s),n.set(i.values).invert()}catch(e){if(t)throw e}}screenToWorld(t,e,s){let i=t.x,n=t.y,a=t.z,r=this.tmp;return r.x=i/e*2-1,r.y=n/s*2-1,r.z=a,r.project(this.inverseProjectionView),t.set(r.x,r.y,r.z),t}worldToScreen(t){let e=new kt(t.x,t.y,t.z);e.project(this.projectionView),e.x=(e.x+1)/2*this.viewportWidth,e.y=(e.y+1)/2*this.viewportHeight;let s=new kt(e.x,e.y,e.z);return s.w=e.w,s}setViewport(t,e){this.viewportWidth=t,this.viewportHeight=e}}class qt{vertexShader;fragmentShader;static MVP_MATRIX="u_projTrans";static POSITION="a_position";static COLOR="a_color";static COLOR2="a_color2";static TEXCOORDS="a_texCoords";static SAMPLER="u_texture";context;vs=null;vsSource;fs=null;fsSource;program=null;tmp2x2=new Float32Array(4);tmp3x3=new Float32Array(9);tmp4x4=new Float32Array(16);getProgram(){return this.program}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}getVertexShaderSource(){return this.vsSource}getFragmentSource(){return this.fsSource}constructor(t,e,s){this.vertexShader=e,this.fragmentShader=s,this.vsSource=e,this.fsSource=s,this.context=t instanceof v?t:new v(t),this.context.addRestorable(this),this.compile()}compile(){let t=this.context.gl;try{this.vs=this.compileShader(t.VERTEX_SHADER,this.vertexShader),this.fs=this.compileShader(t.FRAGMENT_SHADER,this.fragmentShader),this.program=this.compileProgram(this.vs,this.fs)}catch(t){throw console.log("Shader compilation error",t),this.dispose(),t}}compileShader(t,e){let s=this.context.gl,i=s.createShader(t);if(s.shaderSource(i,e),s.compileShader(i),!s.getShaderParameter(i,s.COMPILE_STATUS)){let t="Couldn't compile shader: "+s.getShaderInfoLog(i);if(s.deleteShader(i),!s.isContextLost())throw new Error(t)}return i}compileProgram(t,e){let s=this.context.gl,i=s.createProgram();if(s.attachShader(i,t),s.attachShader(i,e),s.linkProgram(i),!s.getProgramParameter(i,s.LINK_STATUS)){let t="Couldn't compile shader program: "+s.getProgramInfoLog(i);if(s.deleteProgram(i),!s.isContextLost())throw new Error(t)}return i}restore(){this.compile()}bind(){this.context.gl.useProgram(this.program)}unbind(){this.context.gl.useProgram(null)}setUniformi(t,e){this.context.gl.uniform1i(this.getUniformLocation(t),e)}setUniformf(t,e){this.context.gl.uniform1f(this.getUniformLocation(t),e)}setUniform2f(t,e,s){this.context.gl.uniform2f(this.getUniformLocation(t),e,s)}setUniform3f(t,e,s,i){this.context.gl.uniform3f(this.getUniformLocation(t),e,s,i)}setUniform4f(t,e,s,i,n){this.context.gl.uniform4f(this.getUniformLocation(t),e,s,i,n)}setUniform2x2f(t,e){let s=this.context.gl;this.tmp2x2.set(e),s.uniformMatrix2fv(this.getUniformLocation(t),!1,this.tmp2x2)}setUniform3x3f(t,e){let s=this.context.gl;this.tmp3x3.set(e),s.uniformMatrix3fv(this.getUniformLocation(t),!1,this.tmp3x3)}setUniform4x4f(t,e){let s=this.context.gl;this.tmp4x4.set(e),s.uniformMatrix4fv(this.getUniformLocation(t),!1,this.tmp4x4)}getUniformLocation(t){let e=this.context.gl,s=e.getUniformLocation(this.program,t);if(!s&&!e.isContextLost())throw new Error(`Couldn't find location for uniform ${t}`);return s}getAttributeLocation(t){let e=this.context.gl,s=e.getAttribLocation(this.program,t);if(-1==s&&!e.isContextLost())throw new Error(`Couldn't find location for attribute ${t}`);return s}dispose(){this.context.removeRestorable(this);let t=this.context.gl;this.vs&&(t.deleteShader(this.vs),this.vs=null),this.fs&&(t.deleteShader(this.fs),this.fs=null),this.program&&(t.deleteProgram(this.program),this.program=null)}static newColoredTextured(t){let e=`\n\t\t\t\tattribute vec4 ${qt.POSITION};\n\t\t\t\tattribute vec4 ${qt.COLOR};\n\t\t\t\tattribute vec2 ${qt.TEXCOORDS};\n\t\t\t\tuniform mat4 ${qt.MVP_MATRIX};\n\t\t\t\tvarying vec4 v_color;\n\t\t\t\tvarying vec2 v_texCoords;\n\n\t\t\t\tvoid main () {\n\t\t\t\t\tv_color = ${qt.COLOR};\n\t\t\t\t\tv_texCoords = ${qt.TEXCOORDS};\n\t\t\t\t\tgl_Position = ${qt.MVP_MATRIX} * ${qt.POSITION};\n\t\t\t\t}\n\t\t\t`;return new qt(t,e,"\n\t\t\t\t#ifdef GL_ES\n\t\t\t\t\t#define LOWP lowp\n\t\t\t\t\tprecision mediump float;\n\t\t\t\t#else\n\t\t\t\t\t#define LOWP\n\t\t\t\t#endif\n\t\t\t\tvarying LOWP vec4 v_color;\n\t\t\t\tvarying vec2 v_texCoords;\n\t\t\t\tuniform sampler2D u_texture;\n\n\t\t\t\tvoid main () {\n\t\t\t\t\tgl_FragColor = v_color * texture2D(u_texture, v_texCoords);\n\t\t\t\t}\n\t\t\t")}static newTwoColoredTextured(t){let e=`\n\t\t\t\tattribute vec4 ${qt.POSITION};\n\t\t\t\tattribute vec4 ${qt.COLOR};\n\t\t\t\tattribute vec4 ${qt.COLOR2};\n\t\t\t\tattribute vec2 ${qt.TEXCOORDS};\n\t\t\t\tuniform mat4 ${qt.MVP_MATRIX};\n\t\t\t\tvarying vec4 v_light;\n\t\t\t\tvarying vec4 v_dark;\n\t\t\t\tvarying vec2 v_texCoords;\n\n\t\t\t\tvoid main () {\n\t\t\t\t\tv_light = ${qt.COLOR};\n\t\t\t\t\tv_dark = ${qt.COLOR2};\n\t\t\t\t\tv_texCoords = ${qt.TEXCOORDS};\n\t\t\t\t\tgl_Position = ${qt.MVP_MATRIX} * ${qt.POSITION};\n\t\t\t\t}\n\t\t\t`;return new qt(t,e,"\n\t\t\t\t#ifdef GL_ES\n\t\t\t\t\t#define LOWP lowp\n\t\t\t\t\tprecision mediump float;\n\t\t\t\t#else\n\t\t\t\t\t#define LOWP\n\t\t\t\t#endif\n\t\t\t\tvarying LOWP vec4 v_light;\n\t\t\t\tvarying LOWP vec4 v_dark;\n\t\t\t\tvarying vec2 v_texCoords;\n\t\t\t\tuniform sampler2D u_texture;\n\n\t\t\t\tvoid main () {\n\t\t\t\t\tvec4 texColor = texture2D(u_texture, v_texCoords);\n\t\t\t\t\tgl_FragColor.a = texColor.a * v_light.a;\n\t\t\t\t\tgl_FragColor.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n\t\t\t\t}\n\t\t\t")}static newColored(t){let e=`\n\t\t\t\tattribute vec4 ${qt.POSITION};\n\t\t\t\tattribute vec4 ${qt.COLOR};\n\t\t\t\tuniform mat4 ${qt.MVP_MATRIX};\n\t\t\t\tvarying vec4 v_color;\n\n\t\t\t\tvoid main () {\n\t\t\t\t\tv_color = ${qt.COLOR};\n\t\t\t\t\tgl_Position = ${qt.MVP_MATRIX} * ${qt.POSITION};\n\t\t\t\t}\n\t\t\t`;return new qt(t,e,"\n\t\t\t\t#ifdef GL_ES\n\t\t\t\t\t#define LOWP lowp\n\t\t\t\t\tprecision mediump float;\n\t\t\t\t#else\n\t\t\t\t\t#define LOWP\n\t\t\t\t#endif\n\t\t\t\tvarying LOWP vec4 v_color;\n\n\t\t\t\tvoid main () {\n\t\t\t\t\tgl_FragColor = v_color;\n\t\t\t\t}\n\t\t\t")}}class Kt{attributes;context;vertices;verticesBuffer;verticesLength=0;dirtyVertices=!1;indices;indicesBuffer;indicesLength=0;dirtyIndices=!1;elementsPerVertex=0;getAttributes(){return this.attributes}maxVertices(){return this.vertices.length/this.elementsPerVertex}numVertices(){return this.verticesLength/this.elementsPerVertex}setVerticesLength(t){this.dirtyVertices=!0,this.verticesLength=t}getVertices(){return this.vertices}maxIndices(){return this.indices.length}numIndices(){return this.indicesLength}setIndicesLength(t){this.dirtyIndices=!0,this.indicesLength=t}getIndices(){return this.indices}getVertexSizeInFloats(){let t=0;for(var e=0;e<this.attributes.length;e++)t+=this.attributes[e].numElements;return t}constructor(t,e,s,i){this.attributes=e,this.context=t instanceof v?t:new v(t),this.elementsPerVertex=0;for(let t=0;t<e.length;t++)this.elementsPerVertex+=e[t].numElements;this.vertices=new Float32Array(s*this.elementsPerVertex),this.indices=new Uint16Array(i),this.context.addRestorable(this)}setVertices(t){if(this.dirtyVertices=!0,t.length>this.vertices.length)throw Error("Mesh can't store more than "+this.maxVertices()+" vertices");this.vertices.set(t,0),this.verticesLength=t.length}setIndices(t){if(this.dirtyIndices=!0,t.length>this.indices.length)throw Error("Mesh can't store more than "+this.maxIndices()+" indices");this.indices.set(t,0),this.indicesLength=t.length}draw(t,e){this.drawWithOffset(t,e,0,this.indicesLength>0?this.indicesLength:this.verticesLength/this.elementsPerVertex)}drawWithOffset(t,e,s,i){let n=this.context.gl;(this.dirtyVertices||this.dirtyIndices)&&this.update(),this.bind(t),this.indicesLength>0?n.drawElements(e,i,n.UNSIGNED_SHORT,2*s):n.drawArrays(e,s,i),this.unbind(t)}bind(t){let e=this.context.gl;e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer);let s=0;for(let i=0;i<this.attributes.length;i++){let n=this.attributes[i],a=t.getAttributeLocation(n.name);e.enableVertexAttribArray(a),e.vertexAttribPointer(a,n.numElements,e.FLOAT,!1,4*this.elementsPerVertex,4*s),s+=n.numElements}this.indicesLength>0&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer)}unbind(t){let e=this.context.gl;for(let s=0;s<this.attributes.length;s++){let i=this.attributes[s],n=t.getAttributeLocation(i.name);e.disableVertexAttribArray(n)}e.bindBuffer(e.ARRAY_BUFFER,null),this.indicesLength>0&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}update(){let t=this.context.gl;this.dirtyVertices&&(this.verticesBuffer||(this.verticesBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.verticesBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices.subarray(0,this.verticesLength),t.DYNAMIC_DRAW),this.dirtyVertices=!1),this.dirtyIndices&&(this.indicesBuffer||(this.indicesBuffer=t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices.subarray(0,this.indicesLength),t.DYNAMIC_DRAW),this.dirtyIndices=!1)}restore(){this.verticesBuffer=null,this.indicesBuffer=null,this.update()}dispose(){this.context.removeRestorable(this);let t=this.context.gl;t.deleteBuffer(this.verticesBuffer),t.deleteBuffer(this.indicesBuffer)}}class $t{name;type;numElements;constructor(t,e,s){this.name=t,this.type=e,this.numElements=s}}class te extends $t{constructor(){super(qt.POSITION,ne.Float,2)}}class ee extends $t{constructor(t=0){super(qt.TEXCOORDS+(0==t?"":t),ne.Float,2)}}class se extends $t{constructor(){super(qt.COLOR,ne.Float,4)}}class ie extends $t{constructor(){super(qt.COLOR2,ne.Float,4)}}var ne,ae,re,oe;!function(t){t[t.Float=0]="Float"}(ne||(ne={}));class le{context;drawCalls;isDrawing=!1;mesh;shader=null;lastTexture=null;verticesLength=0;indicesLength=0;srcBlend;dstBlend;constructor(t,e=!0,s=10920){if(s>10920)throw new Error("Can't have more than 10920 triangles per batch: "+s);this.context=t instanceof v?t:new v(t);let i=e?[new te,new se,new ee,new ie]:[new te,new se,new ee];this.mesh=new Kt(t,i,s,3*s),this.srcBlend=this.context.gl.SRC_ALPHA,this.dstBlend=this.context.gl.ONE_MINUS_SRC_ALPHA}begin(t){let e=this.context.gl;if(this.isDrawing)throw new Error("PolygonBatch is already drawing. Call PolygonBatch.end() before calling PolygonBatch.begin()");this.drawCalls=0,this.shader=t,this.lastTexture=null,this.isDrawing=!0,e.enable(e.BLEND),e.blendFunc(this.srcBlend,this.dstBlend)}setBlendMode(t,e){let s=this.context.gl;this.srcBlend=t,this.dstBlend=e,this.isDrawing&&(this.flush(),s.blendFunc(this.srcBlend,this.dstBlend))}draw(t,e,s){t!=this.lastTexture?(this.flush(),this.lastTexture=t):(this.verticesLength+e.length>this.mesh.getVertices().length||this.indicesLength+s.length>this.mesh.getIndices().length)&&this.flush();let i=this.mesh.numVertices();this.mesh.getVertices().set(e,this.verticesLength),this.verticesLength+=e.length,this.mesh.setVerticesLength(this.verticesLength);let n=this.mesh.getIndices();for(let t=this.indicesLength,e=0;e<s.length;t++,e++)n[t]=s[e]+i;this.indicesLength+=s.length,this.mesh.setIndicesLength(this.indicesLength)}flush(){let t=this.context.gl;0!=this.verticesLength&&(this.lastTexture.bind(),this.mesh.draw(this.shader,t.TRIANGLES),this.verticesLength=0,this.indicesLength=0,this.mesh.setVerticesLength(0),this.mesh.setIndicesLength(0),this.drawCalls++)}end(){let t=this.context.gl;if(!this.isDrawing)throw new Error("PolygonBatch is not drawing. Call PolygonBatch.begin() before calling PolygonBatch.end()");(this.verticesLength>0||this.indicesLength>0)&&this.flush(),this.shader=null,this.lastTexture=null,this.isDrawing=!1,t.disable(t.BLEND)}getDrawCalls(){return this.drawCalls}dispose(){this.mesh.dispose()}}class he{context;isDrawing=!1;mesh;shapeType=ae.Filled;color=new I(1,1,1,1);shader;vertexIndex=0;tmp=new P;srcBlend;dstBlend;constructor(t,e=10920){if(e>10920)throw new Error("Can't have more than 10920 triangles per batch: "+e);this.context=t instanceof v?t:new v(t),this.mesh=new Kt(t,[new te,new se],e,0),this.srcBlend=this.context.gl.SRC_ALPHA,this.dstBlend=this.context.gl.ONE_MINUS_SRC_ALPHA}begin(t){if(this.isDrawing)throw new Error("ShapeRenderer.begin() has already been called");this.shader=t,this.vertexIndex=0,this.isDrawing=!0;let e=this.context.gl;e.enable(e.BLEND),e.blendFunc(this.srcBlend,this.dstBlend)}setBlendMode(t,e){let s=this.context.gl;this.srcBlend=t,this.dstBlend=e,this.isDrawing&&(this.flush(),s.blendFunc(this.srcBlend,this.dstBlend))}setColor(t){this.color.setFromColor(t)}setColorWith(t,e,s,i){this.color.set(t,e,s,i)}point(t,e,s=null){this.check(ae.Point,1),null===s&&(s=this.color),this.vertex(t,e,s)}line(t,e,s,i,n=null){this.check(ae.Line,2),this.mesh.getVertices(),this.vertexIndex,null===n&&(n=this.color),this.vertex(t,e,n),this.vertex(s,i,n)}triangle(t,e,s,i,n,a,r,o=null,l=null,h=null){this.check(t?ae.Filled:ae.Line,3),this.mesh.getVertices(),this.vertexIndex,null===o&&(o=this.color),null===l&&(l=this.color),null===h&&(h=this.color),t?(this.vertex(e,s,o),this.vertex(i,n,l),this.vertex(a,r,h)):(this.vertex(e,s,o),this.vertex(i,n,l),this.vertex(i,n,o),this.vertex(a,r,l),this.vertex(a,r,o),this.vertex(e,s,l))}quad(t,e,s,i,n,a,r,o,l,h=null,c=null,d=null,u=null){this.check(t?ae.Filled:ae.Line,3),this.mesh.getVertices(),this.vertexIndex,null===h&&(h=this.color),null===c&&(c=this.color),null===d&&(d=this.color),null===u&&(u=this.color),t?(this.vertex(e,s,h),this.vertex(i,n,c),this.vertex(a,r,d),this.vertex(a,r,d),this.vertex(o,l,u),this.vertex(e,s,h)):(this.vertex(e,s,h),this.vertex(i,n,c),this.vertex(i,n,c),this.vertex(a,r,d),this.vertex(a,r,d),this.vertex(o,l,u),this.vertex(o,l,u),this.vertex(e,s,h))}rect(t,e,s,i,n,a=null){this.quad(t,e,s,e+i,s,e+i,s+n,e,s+n,a,a,a,a)}rectLine(t,e,s,i,n,a,r=null){this.check(t?ae.Filled:ae.Line,8),null===r&&(r=this.color);let o=this.tmp.set(n-s,e-i);o.normalize(),a*=.5;let l=o.x*a,h=o.y*a;t?(this.vertex(e+l,s+h,r),this.vertex(e-l,s-h,r),this.vertex(i+l,n+h,r),this.vertex(i-l,n-h,r),this.vertex(i+l,n+h,r),this.vertex(e-l,s-h,r)):(this.vertex(e+l,s+h,r),this.vertex(e-l,s-h,r),this.vertex(i+l,n+h,r),this.vertex(i-l,n-h,r),this.vertex(i+l,n+h,r),this.vertex(e+l,s+h,r),this.vertex(i-l,n-h,r),this.vertex(e-l,s-h,r))}x(t,e,s){this.line(t-s,e-s,t+s,e+s),this.line(t-s,e+s,t+s,e-s)}polygon(t,e,s,i=null){if(s<3)throw new Error("Polygon must contain at least 3 vertices");this.check(ae.Line,2*s),null===i&&(i=this.color),this.mesh.getVertices(),this.vertexIndex,s<<=1;let n=t[e<<=1],a=t[e+1],r=e+s;for(let o=e,l=e+s-2;o<l;o+=2){let e=t[o],s=t[o+1],l=0,h=0;o+2>=r?(l=n,h=a):(l=t[o+2],h=t[o+3]),this.vertex(e,s,i),this.vertex(l,h,i)}}circle(t,e,s,i,n=null,a=0){if(0===a&&(a=Math.max(1,6*R.cbrt(i)|0)),a<=0)throw new Error("segments must be > 0.");null===n&&(n=this.color);let r=2*R.PI/a,o=Math.cos(r),l=Math.sin(r),h=i,c=0;if(t){this.check(ae.Filled,3*a+3),a--;for(let t=0;t<a;t++){this.vertex(e,s,n),this.vertex(e+h,s+c,n);let t=h;h=o*h-l*c,c=l*t+o*c,this.vertex(e+h,s+c,n)}this.vertex(e,s,n),this.vertex(e+h,s+c,n)}else{this.check(ae.Line,2*a+2);for(let t=0;t<a;t++){this.vertex(e+h,s+c,n);let t=h;h=o*h-l*c,c=l*t+o*c,this.vertex(e+h,s+c,n)}this.vertex(e+h,s+c,n)}h=i,c=0,this.vertex(e+h,s+c,n)}curve(t,e,s,i,n,a,r,o,l,h=null){this.check(ae.Line,2*l+2),null===h&&(h=this.color);let c=1/l,d=c*c,u=c*c*c,m=3*c,g=3*d,f=6*d,p=6*u,w=t-2*s+n,x=e-2*i+a,b=3*(s-n)-t+r,y=3*(i-a)-e+o,v=t,A=e,E=(s-t)*m+w*g+b*u,S=(i-e)*m+x*g+y*u,M=w*f+b*p,I=x*f+y*p,R=b*p,T=y*p;for(;l-- >0;)this.vertex(v,A,h),v+=E,A+=S,E+=M,S+=I,M+=R,I+=T,this.vertex(v,A,h);this.vertex(v,A,h),this.vertex(r,o,h)}vertex(t,e,s){let i=this.vertexIndex,n=this.mesh.getVertices();n[i++]=t,n[i++]=e,n[i++]=s.r,n[i++]=s.g,n[i++]=s.b,n[i++]=s.a,this.vertexIndex=i}end(){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");this.flush(),this.context.gl.disable(this.context.gl.BLEND),this.isDrawing=!1}flush(){0!=this.vertexIndex&&(this.mesh.setVerticesLength(this.vertexIndex),this.mesh.draw(this.shader,this.shapeType),this.vertexIndex=0)}check(t,e){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");if(this.shapeType==t){if(!(this.mesh.maxVertices()-this.mesh.numVertices()<e))return;this.flush()}else this.flush(),this.shapeType=t}dispose(){this.mesh.dispose()}}!function(t){t[t.Point=0]="Point",t[t.Line=1]="Line",t[t.Filled=4]="Filled"}(ae||(ae={}));class ce{minX=0;minY=0;maxX=0;maxY=0;boundingBoxes=new Array;polygons=new Array;polygonPool=new C((()=>T.newFloatArray(16)));update(t,e){if(null==t)throw new Error("skeleton cannot be null.");let s=this.boundingBoxes,i=this.polygons,n=this.polygonPool,a=t.slots,r=a.length;s.length=0,n.freeAll(i),i.length=0;for(let t=0;t<r;t++){let e=a[t];if(!e.bone.active)continue;let r=e.getAttachment();if(r instanceof O){let t=r;s.push(t);let a=n.obtain();a.length!=t.worldVerticesLength&&(a=T.newFloatArray(t.worldVerticesLength)),i.push(a),t.computeWorldVertices(e,0,t.worldVerticesLength,a,0,2)}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)}aabbCompute(){let t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=this.polygons;for(let a=0,r=n.length;a<r;a++){let r=n[a],o=r;for(let n=0,a=r.length;n<a;n+=2){let a=o[n],r=o[n+1];t=Math.min(t,a),e=Math.min(e,r),s=Math.max(s,a),i=Math.max(i,r)}}this.minX=t,this.minY=e,this.maxX=s,this.maxY=i}aabbContainsPoint(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY}aabbIntersectsSegment(t,e,s,i){let n=this.minX,a=this.minY,r=this.maxX,o=this.maxY;if(t<=n&&s<=n||e<=a&&i<=a||t>=r&&s>=r||e>=o&&i>=o)return!1;let l=(i-e)/(s-t),h=l*(n-t)+e;if(h>a&&h<o)return!0;if(h=l*(r-t)+e,h>a&&h<o)return!0;let c=(a-e)/l+t;return c>n&&c<r||(c=(o-e)/l+t,c>n&&c<r)}aabbIntersectsSkeleton(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY}containsPoint(t,e){let s=this.polygons;for(let i=0,n=s.length;i<n;i++)if(this.containsPointPolygon(s[i],t,e))return this.boundingBoxes[i];return null}containsPointPolygon(t,e,s){let i=t,n=t.length,a=n-2,r=!1;for(let t=0;t<n;t+=2){let n=i[t+1],o=i[a+1];if(n<s&&o>=s||o<s&&n>=s){let l=i[t];l+(s-n)/(o-n)*(i[a]-l)<e&&(r=!r)}a=t}return r}intersectsSegment(t,e,s,i){let n=this.polygons;for(let a=0,r=n.length;a<r;a++)if(this.intersectsSegmentPolygon(n[a],t,e,s,i))return this.boundingBoxes[a];return null}intersectsSegmentPolygon(t,e,s,i,n){let a=t,r=t.length,o=e-i,l=s-n,h=e*n-s*i,c=a[r-2],d=a[r-1];for(let t=0;t<r;t+=2){let r=a[t],u=a[t+1],m=c*u-d*r,g=c-r,f=d-u,p=o*f-l*g,w=(h*g-o*m)/p;if((w>=c&&w<=r||w>=r&&w<=c)&&(w>=e&&w<=i||w>=i&&w<=e)){let t=(h*f-l*m)/p;if((t>=d&&t<=u||t>=u&&t<=d)&&(t>=s&&t<=n||t>=n&&t<=s))return!0}c=r,d=u}return!1}getPolygon(t){if(null==t)throw new Error("boundingBox cannot be null.");let e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]}getWidth(){return this.maxX-this.minX}getHeight(){return this.maxY-this.minY}}class de{boneLineColor=new I(1,0,0,1);boneOriginColor=new I(0,1,0,1);attachmentLineColor=new I(0,0,1,.5);triangleLineColor=new I(1,.64,0,.5);pathColor=(new I).setFromString("FF7F00");clipColor=new I(.8,0,0,2);aabbColor=new I(0,1,0,.5);drawBones=!0;drawRegionAttachments=!0;drawBoundingBoxes=!0;drawMeshHull=!0;drawMeshTriangles=!0;drawPaths=!0;drawSkeletonXY=!1;drawClipping=!0;premultipliedAlpha=!1;scale=1;boneWidth=2;context;bounds=new ce;temp=new Array;vertices=T.newFloatArray(2048);static LIGHT_GRAY=new I(192/255,192/255,192/255,1);static GREEN=new I(0,1,0,1);constructor(t){this.context=t instanceof v?t:new v(t)}draw(t,e,s=null){let i=e.x,n=e.y,a=this.context.gl,r=this.premultipliedAlpha?a.ONE:a.SRC_ALPHA;t.setBlendMode(r,a.ONE_MINUS_SRC_ALPHA);let o=e.bones;if(this.drawBones){t.setColor(this.boneLineColor);for(let e=0,a=o.length;e<a;e++){let a=o[e];if(s&&s.indexOf(a.data.name)>-1)continue;if(null==a.parent)continue;let r=i+a.data.length*a.a+a.worldX,l=n+a.data.length*a.c+a.worldY;t.rectLine(!0,i+a.worldX,n+a.worldY,r,l,this.boneWidth*this.scale)}this.drawSkeletonXY&&t.x(i,n,4*this.scale)}if(this.drawRegionAttachments){t.setColor(this.attachmentLineColor);let s=e.slots;for(let e=0,i=s.length;e<i;e++){let i=s[e],n=i.getAttachment();if(n instanceof B){let e=n,s=this.vertices;e.computeWorldVertices(i.bone,s,0,2),t.line(s[0],s[1],s[2],s[3]),t.line(s[2],s[3],s[4],s[5]),t.line(s[4],s[5],s[6],s[7]),t.line(s[6],s[7],s[0],s[1])}}}if(this.drawMeshHull||this.drawMeshTriangles){let s=e.slots;for(let e=0,i=s.length;e<i;e++){let i=s[e];if(!i.bone.active)continue;let n=i.getAttachment();if(!(n instanceof Y))continue;let a=n,r=this.vertices;a.computeWorldVertices(i,0,a.worldVerticesLength,r,0,2);let o=a.triangles,l=a.hullLength;if(this.drawMeshTriangles){t.setColor(this.triangleLineColor);for(let e=0,s=o.length;e<s;e+=3){let s=2*o[e],i=2*o[e+1],n=2*o[e+2];t.triangle(!1,r[s],r[s+1],r[i],r[i+1],r[n],r[n+1])}}if(this.drawMeshHull&&l>0){t.setColor(this.attachmentLineColor),l=2*(l>>1);let e=r[l-2],s=r[l-1];for(let i=0,n=l;i<n;i+=2){let n=r[i],a=r[i+1];t.line(n,a,e,s),e=n,s=a}}}}if(this.drawBoundingBoxes){let s=this.bounds;s.update(e,!0),t.setColor(this.aabbColor),t.rect(!1,s.minX,s.minY,s.getWidth(),s.getHeight());let i=s.polygons,n=s.boundingBoxes;for(let e=0,s=i.length;e<s;e++){let s=i[e];t.setColor(n[e].color),t.polygon(s,0,s.length)}}if(this.drawPaths){let s=e.slots;for(let e=0,i=s.length;e<i;e++){let i=s[e];if(!i.bone.active)continue;let n=i.getAttachment();if(!(n instanceof D))continue;let a=n,r=a.worldVerticesLength,o=this.temp=T.setArraySize(this.temp,r,0);a.computeWorldVertices(i,0,r,o,0,2);let l=this.pathColor,h=o[2],c=o[3],d=0,u=0;if(a.closed){t.setColor(l);let e=o[0],s=o[1],i=o[r-2],n=o[r-1];d=o[r-4],u=o[r-3],t.curve(h,c,e,s,i,n,d,u,32),t.setColor(de.LIGHT_GRAY),t.line(h,c,e,s),t.line(d,u,i,n)}r-=4;for(let e=4;e<r;e+=6){let s=o[e],i=o[e+1],n=o[e+2],a=o[e+3];d=o[e+4],u=o[e+5],t.setColor(l),t.curve(h,c,s,i,n,a,d,u,32),t.setColor(de.LIGHT_GRAY),t.line(h,c,s,i),t.line(d,u,n,a),h=d,c=u}}}if(this.drawBones){t.setColor(this.boneOriginColor);for(let e=0,a=o.length;e<a;e++){let a=o[e];s&&s.indexOf(a.data.name)>-1||t.circle(!0,i+a.worldX,n+a.worldY,3*this.scale,de.GREEN,8)}}if(this.drawClipping){let s=e.slots;t.setColor(this.clipColor);for(let e=0,i=s.length;e<i;e++){let i=s[e];if(!i.bone.active)continue;let n=i.getAttachment();if(!(n instanceof L))continue;let a=n,r=a.worldVerticesLength,o=this.temp=T.setArraySize(this.temp,r,0);a.computeWorldVertices(i,0,r,o,0,2);for(let e=0,s=o.length;e<s;e+=2){let s=o[e],i=o[e+1],n=o[(e+2)%o.length],a=o[(e+3)%o.length];t.line(s,i,n,a)}}}}dispose(){}}class ue{convexPolygons=new Array;convexPolygonsIndices=new Array;indicesArray=new Array;isConcaveArray=new Array;triangles=new Array;polygonPool=new C((()=>new Array));polygonIndicesPool=new C((()=>new Array));triangulate(t){let e=t,s=t.length>>1,i=this.indicesArray;i.length=0;for(let t=0;t<s;t++)i[t]=t;let n=this.isConcaveArray;n.length=0;for(let t=0,a=s;t<a;++t)n[t]=ue.isConcave(t,s,e,i);let a=this.triangles;for(a.length=0;s>3;){let t=s-1,r=0,o=1;for(;;){t:if(!n[r]){let a=i[t]<<1,l=i[r]<<1,h=i[o]<<1,c=e[a],d=e[a+1],u=e[l],m=e[l+1],g=e[h],f=e[h+1];for(let a=(o+1)%s;a!=t;a=(a+1)%s){if(!n[a])continue;let t=i[a]<<1,s=e[t],r=e[t+1];if(ue.positiveArea(g,f,c,d,s,r)&&ue.positiveArea(c,d,u,m,s,r)&&ue.positiveArea(u,m,g,f,s,r))break t}break}if(0==o){do{if(!n[r])break;r--}while(r>0);break}t=r,r=o,o=(o+1)%s}a.push(i[(s+r-1)%s]),a.push(i[r]),a.push(i[(r+1)%s]),i.splice(r,1),n.splice(r,1),s--;let l=(s+r-1)%s,h=r==s?0:r;n[l]=ue.isConcave(l,s,e,i),n[h]=ue.isConcave(h,s,e,i)}return 3==s&&(a.push(i[2]),a.push(i[0]),a.push(i[1])),a}decompose(t,e){let s=t,i=this.convexPolygons;this.polygonPool.freeAll(i),i.length=0;let n=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(n),n.length=0;let a=this.polygonIndicesPool.obtain();a.length=0;let r=this.polygonPool.obtain();r.length=0;let o=-1,l=0;for(let t=0,h=e.length;t<h;t+=3){let h=e[t]<<1,c=e[t+1]<<1,d=e[t+2]<<1,u=s[h],m=s[h+1],g=s[c],f=s[c+1],p=s[d],w=s[d+1],x=!1;if(o==h){let t=r.length-4,e=ue.winding(r[t],r[t+1],r[t+2],r[t+3],p,w),s=ue.winding(p,w,r[0],r[1],r[2],r[3]);e==l&&s==l&&(r.push(p),r.push(w),a.push(d),x=!0)}x||(r.length>0?(i.push(r),n.push(a)):(this.polygonPool.free(r),this.polygonIndicesPool.free(a)),r=this.polygonPool.obtain(),r.length=0,r.push(u),r.push(m),r.push(g),r.push(f),r.push(p),r.push(w),a=this.polygonIndicesPool.obtain(),a.length=0,a.push(h),a.push(c),a.push(d),l=ue.winding(u,m,g,f,p,w),o=h)}r.length>0&&(i.push(r),n.push(a));for(let t=0,e=i.length;t<e;t++){if(a=n[t],0==a.length)continue;let s=a[0],o=a[a.length-1];r=i[t];let l=r.length-4,h=r[l],c=r[l+1],d=r[l+2],u=r[l+3],m=r[0],g=r[1],f=r[2],p=r[3],w=ue.winding(h,c,d,u,m,g);for(let l=0;l<e;l++){if(l==t)continue;let e=n[l];if(3!=e.length)continue;let x=e[0],b=e[1],y=e[2],v=i[l],A=v[v.length-2],E=v[v.length-1];if(x!=s||b!=o)continue;let S=ue.winding(h,c,d,u,A,E),M=ue.winding(A,E,m,g,f,p);S==w&&M==w&&(v.length=0,e.length=0,r.push(A),r.push(E),a.push(y),h=d,c=u,d=A,u=E,l=0)}}for(let t=i.length-1;t>=0;t--)r=i[t],0==r.length&&(i.splice(t,1),this.polygonPool.free(r),a=n[t],n.splice(t,1),this.polygonIndicesPool.free(a));return i}static isConcave(t,e,s,i){let n=i[(e+t-1)%e]<<1,a=i[t]<<1,r=i[(t+1)%e]<<1;return!this.positiveArea(s[n],s[n+1],s[a],s[a+1],s[r],s[r+1])}static positiveArea(t,e,s,i,n,a){return t*(a-i)+s*(e-a)+n*(i-e)>=0}static winding(t,e,s,i,n,a){let r=s-t,o=i-e;return n*o-a*r+r*e-t*o>=0?1:-1}}class me{triangulator=new ue;clippingPolygon=new Array;clipOutput=new Array;clippedVertices=new Array;clippedTriangles=new Array;scratch=new Array;clipAttachment;clippingPolygons;clipStart(t,e){if(null!=this.clipAttachment)return 0;this.clipAttachment=e;let s=e.worldVerticesLength,i=T.setArraySize(this.clippingPolygon,s);e.computeWorldVertices(t,0,s,i,0,2);let n=this.clippingPolygon;me.makeClockwise(n);let a=this.clippingPolygons=this.triangulator.decompose(n,this.triangulator.triangulate(n));for(let t=0,e=a.length;t<e;t++){let e=a[t];me.makeClockwise(e),e.push(e[0]),e.push(e[1])}return a.length}clipEndWithSlot(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()}clipEnd(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)}isClipping(){return null!=this.clipAttachment}clipTriangles(t,e,s,i,n,a,r,o){let l=this.clipOutput,h=this.clippedVertices,c=this.clippedTriangles,d=this.clippingPolygons,u=this.clippingPolygons.length,m=o?12:8,g=0;h.length=0,c.length=0;t:for(let e=0;e<i;e+=3){let i=s[e]<<1,f=t[i],p=t[i+1],w=n[i],x=n[i+1];i=s[e+1]<<1;let b=t[i],y=t[i+1],v=n[i],A=n[i+1];i=s[e+2]<<1;let E=t[i],S=t[i+1],M=n[i],I=n[i+1];for(let t=0;t<u;t++){let e=h.length;if(!this.clip(f,p,b,y,E,S,d[t],l)){let t=T.setArraySize(h,e+3*m);t[e]=f,t[e+1]=p,t[e+2]=a.r,t[e+3]=a.g,t[e+4]=a.b,t[e+5]=a.a,o?(t[e+6]=w,t[e+7]=x,t[e+8]=r.r,t[e+9]=r.g,t[e+10]=r.b,t[e+11]=r.a,t[e+12]=b,t[e+13]=y,t[e+14]=a.r,t[e+15]=a.g,t[e+16]=a.b,t[e+17]=a.a,t[e+18]=v,t[e+19]=A,t[e+20]=r.r,t[e+21]=r.g,t[e+22]=r.b,t[e+23]=r.a,t[e+24]=E,t[e+25]=S,t[e+26]=a.r,t[e+27]=a.g,t[e+28]=a.b,t[e+29]=a.a,t[e+30]=M,t[e+31]=I,t[e+32]=r.r,t[e+33]=r.g,t[e+34]=r.b,t[e+35]=r.a):(t[e+6]=w,t[e+7]=x,t[e+8]=b,t[e+9]=y,t[e+10]=a.r,t[e+11]=a.g,t[e+12]=a.b,t[e+13]=a.a,t[e+14]=v,t[e+15]=A,t[e+16]=E,t[e+17]=S,t[e+18]=a.r,t[e+19]=a.g,t[e+20]=a.b,t[e+21]=a.a,t[e+22]=M,t[e+23]=I),e=c.length;let s=T.setArraySize(c,e+3);s[e]=g,s[e+1]=g+1,s[e+2]=g+2,g+=3;continue t}{let t=l.length;if(0==t)continue;let s=y-S,i=E-b,n=f-E,d=S-p,u=1/(s*n+i*(p-S)),R=t>>1,C=this.clipOutput,P=T.setArraySize(h,e+R*m);for(let l=0;l<t;l+=2){let t=C[l],h=C[l+1];P[e]=t,P[e+1]=h,P[e+2]=a.r,P[e+3]=a.g,P[e+4]=a.b,P[e+5]=a.a;let c=t-E,g=h-S,f=(s*c+i*g)*u,p=(d*c+n*g)*u,b=1-f-p;P[e+6]=w*f+v*p+M*b,P[e+7]=x*f+A*p+I*b,o&&(P[e+8]=r.r,P[e+9]=r.g,P[e+10]=r.b,P[e+11]=r.a),e+=m}e=c.length;let k=T.setArraySize(c,e+3*(R-2));R--;for(let t=1;t<R;t++)k[e]=g,k[e+1]=g+t,k[e+2]=g+t+1,e+=3;g+=R+1}}}}clip(t,e,s,i,n,a,r,o){let l=o,h=!1,c=null;r.length%4>=2?(c=o,o=this.scratch):c=this.scratch,c.length=0,c.push(t),c.push(e),c.push(s),c.push(i),c.push(n),c.push(a),c.push(t),c.push(e),o.length=0;let d=r,u=r.length-4;for(let t=0;;t+=2){let e=d[t],s=d[t+1],i=d[t+2],n=d[t+3],a=e-i,r=s-n,m=c,g=c.length-2,f=o.length;for(let t=0;t<g;t+=2){let l=m[t],c=m[t+1],d=m[t+2],u=m[t+3],g=a*(u-n)-r*(d-i)>0;if(a*(c-n)-r*(l-i)>0){if(g){o.push(d),o.push(u);continue}let t=u-c,a=d-l,r=t*(i-e)-a*(n-s);if(Math.abs(r)>1e-6){let h=(a*(s-c)-t*(e-l))/r;o.push(e+(i-e)*h),o.push(s+(n-s)*h)}else o.push(e),o.push(s)}else if(g){let t=u-c,a=d-l,r=t*(i-e)-a*(n-s);if(Math.abs(r)>1e-6){let h=(a*(s-c)-t*(e-l))/r;o.push(e+(i-e)*h),o.push(s+(n-s)*h)}else o.push(e),o.push(s);o.push(d),o.push(u)}h=!0}if(f==o.length)return l.length=0,!0;if(o.push(o[0]),o.push(o[1]),t==u)break;let p=o;(o=c).length=0,c=p}if(l!=o){l.length=0;for(let t=0,e=o.length-2;t<e;t++)l[t]=o[t]}else l.length=l.length-2;return h}static makeClockwise(t){let e=t,s=t.length,i=e[s-2]*e[1]-e[0]*e[s-1],n=0,a=0,r=0,o=0;for(let t=0,l=s-3;t<l;t+=2)n=e[t],a=e[t+1],r=e[t+2],o=e[t+3],i+=n*o-r*a;if(!(i<0))for(let t=0,i=s-2,n=s>>1;t<n;t+=2){let s=e[t],n=e[t+1],a=i-t;e[t]=e[a],e[t+1]=e[a+1],e[a]=s,e[a+1]=n}}}class ge{vertices;numVertices;numFloats;constructor(t,e,s){this.vertices=t,this.numVertices=e,this.numFloats=s}}class fe{static QUAD_TRIANGLES=[0,1,2,2,3,0];premultipliedAlpha=!1;vertexEffect=null;tempColor=new I;tempColor2=new I;vertices;vertexSize=8;twoColorTint=!1;renderable=new ge(null,0,0);clipper=new me;temp=new P;temp2=new P;temp3=new I;temp4=new I;constructor(t,e=!0){this.twoColorTint=e,e&&(this.vertexSize+=4),this.vertices=T.newFloatArray(1024*this.vertexSize)}draw(t,e,s=-1,i=-1){let n=this.clipper,a=this.premultipliedAlpha,r=this.twoColorTint,o=null,l=this.temp,h=this.temp2,c=this.temp3,d=this.temp4,u=this.renderable,m=null,g=null,f=e.drawOrder,p=null,w=e.color,x=r?12:8,b=!1;-1==s&&(b=!0);for(let e=0,y=f.length;e<y;e++){let y=n.isClipping()?2:x,v=f[e];if(!v.bone.active){n.clipEndWithSlot(v);continue}if(s>=0&&s==v.data.index&&(b=!0),!b){n.clipEndWithSlot(v);continue}i>=0&&i==v.data.index&&(b=!1);let E=v.getAttachment(),S=null;if(E instanceof B){let t=E;u.vertices=this.vertices,u.numVertices=4,u.numFloats=y<<2,t.computeWorldVertices(v.bone,u.vertices,0,y),g=fe.QUAD_TRIANGLES,m=t.uvs,S=t.region.renderObject.texture,p=t.color}else{if(!(E instanceof Y)){if(E instanceof L){let t=E;n.clipStart(v,t);continue}n.clipEndWithSlot(v);continue}{let t=E;u.vertices=this.vertices,u.numVertices=t.worldVerticesLength>>1,u.numFloats=u.numVertices*y,u.numFloats>u.vertices.length&&(u.vertices=this.vertices=T.newFloatArray(u.numFloats)),t.computeWorldVertices(v,0,t.worldVerticesLength,u.vertices,0,y),g=t.triangles,S=t.region.renderObject.texture,m=t.uvs,p=t.color}}if(null!=S){let e=v.color,s=this.tempColor;s.r=w.r*e.r*p.r,s.g=w.g*e.g*p.g,s.b=w.b*e.b*p.b,s.a=w.a*e.a*p.a,a&&(s.r*=s.a,s.g*=s.a,s.b*=s.a);let i=this.tempColor2;null==v.darkColor?i.set(0,0,0,1):(a?(i.r=v.darkColor.r*s.a,i.g=v.darkColor.g*s.a,i.b=v.darkColor.b*s.a):i.setFromColor(v.darkColor),i.a=a?1:0);let f=v.data.blendMode;if(f!=o&&(o=f,t.setBlendMode(A.getSourceGLBlendMode(o,a),A.getDestGLBlendMode(o))),n.isClipping()){n.clipTriangles(u.vertices,u.numFloats,g,g.length,m,s,i,r);let e=new Float32Array(n.clippedVertices),a=n.clippedTriangles;if(null!=this.vertexEffect){let t=this.vertexEffect,s=e;if(r)for(let i=0,n=e.length;i<n;i+=x)l.x=s[i],l.y=s[i+1],c.set(s[i+2],s[i+3],s[i+4],s[i+5]),h.x=s[i+6],h.y=s[i+7],d.set(s[i+8],s[i+9],s[i+10],s[i+11]),t.transform(l,h,c,d),s[i]=l.x,s[i+1]=l.y,s[i+2]=c.r,s[i+3]=c.g,s[i+4]=c.b,s[i+5]=c.a,s[i+6]=h.x,s[i+7]=h.y,s[i+8]=d.r,s[i+9]=d.g,s[i+10]=d.b,s[i+11]=d.a;else for(let i=0,n=e.length;i<n;i+=x)l.x=s[i],l.y=s[i+1],c.set(s[i+2],s[i+3],s[i+4],s[i+5]),h.x=s[i+6],h.y=s[i+7],d.set(0,0,0,0),t.transform(l,h,c,d),s[i]=l.x,s[i+1]=l.y,s[i+2]=c.r,s[i+3]=c.g,s[i+4]=c.b,s[i+5]=c.a,s[i+6]=h.x,s[i+7]=h.y}t.draw(S,e,a)}else{let e=u.vertices;if(null!=this.vertexEffect){let t=this.vertexEffect;if(r)for(let n=0,a=0,r=u.numFloats;n<r;n+=x,a+=2)l.x=e[n],l.y=e[n+1],h.x=m[a],h.y=m[a+1],c.setFromColor(s),d.setFromColor(i),t.transform(l,h,c,d),e[n]=l.x,e[n+1]=l.y,e[n+2]=c.r,e[n+3]=c.g,e[n+4]=c.b,e[n+5]=c.a,e[n+6]=h.x,e[n+7]=h.y,e[n+8]=d.r,e[n+9]=d.g,e[n+10]=d.b,e[n+11]=d.a;else for(let i=0,n=0,a=u.numFloats;i<a;i+=x,n+=2)l.x=e[i],l.y=e[i+1],h.x=m[n],h.y=m[n+1],c.setFromColor(s),d.set(0,0,0,0),t.transform(l,h,c,d),e[i]=l.x,e[i+1]=l.y,e[i+2]=c.r,e[i+3]=c.g,e[i+4]=c.b,e[i+5]=c.a,e[i+6]=h.x,e[i+7]=h.y}else if(r)for(let t=2,n=0,a=u.numFloats;t<a;t+=x,n+=2)e[t]=s.r,e[t+1]=s.g,e[t+2]=s.b,e[t+3]=s.a,e[t+4]=m[n],e[t+5]=m[n+1],e[t+6]=i.r,e[t+7]=i.g,e[t+8]=i.b,e[t+9]=i.a;else for(let t=2,i=0,n=u.numFloats;t<n;t+=x,i+=2)e[t]=s.r,e[t+1]=s.g,e[t+2]=s.b,e[t+3]=s.a,e[t+4]=m[i],e[t+5]=m[i+1];let n=u.vertices.subarray(0,u.numFloats);t.draw(S,n,g)}}n.clipEndWithSlot(v)}n.clipEnd()}}class pe{context;canvas;orthoCamera;perspectiveCamera;camera;batcher;twoColorTint=!1;batcherShader;shapes;shapesShader;activeRenderer=null;skeletonRenderer;skeletonDebugRenderer;QUAD=[0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0];QUAD_TRIANGLES=[0,1,2,2,3,0];WHITE=new I(1,1,1,1);constructor(t,e,s=!0){this.canvas=t,this.context=e instanceof v?e:new v(e),this.twoColorTint=s,this.orthoCamera=new Qt(t.width,t.height),this.perspectiveCamera=new Jt(t.width,t.height),this.camera=this.perspectiveCamera,this.batcherShader=s?qt.newTwoColoredTextured(this.context):qt.newColoredTextured(this.context),this.batcher=new le(this.context,s),this.shapesShader=qt.newColored(this.context),this.shapes=new he(this.context),this.skeletonRenderer=new fe(this.context,s),this.skeletonDebugRenderer=new de(this.context)}begin(){this.camera.update(),this.enableRenderer(this.batcher)}drawSkeleton(t,e=!1,s=-1,i=-1){this.enableRenderer(this.batcher),this.skeletonRenderer.premultipliedAlpha=e,this.skeletonRenderer.draw(this.batcher,t,s,i)}drawSkeletonDebug(t,e=!1,s=null){this.enableRenderer(this.shapes),this.skeletonDebugRenderer.premultipliedAlpha=e,this.skeletonDebugRenderer.draw(this.shapes,t,s)}drawTexture(t,e,s,i,n,a=null){this.enableRenderer(this.batcher),null===a&&(a=this.WHITE);let r=this.QUAD;var o=0;r[o++]=e,r[o++]=s,r[o++]=a.r,r[o++]=a.g,r[o++]=a.b,r[o++]=a.a,r[o++]=0,r[o++]=1,this.twoColorTint&&(r[o++]=0,r[o++]=0,r[o++]=0,r[o++]=0),r[o++]=e+i,r[o++]=s,r[o++]=a.r,r[o++]=a.g,r[o++]=a.b,r[o++]=a.a,r[o++]=1,r[o++]=1,this.twoColorTint&&(r[o++]=0,r[o++]=0,r[o++]=0,r[o++]=0),r[o++]=e+i,r[o++]=s+n,r[o++]=a.r,r[o++]=a.g,r[o++]=a.b,r[o++]=a.a,r[o++]=1,r[o++]=0,this.twoColorTint&&(r[o++]=0,r[o++]=0,r[o++]=0,r[o++]=0),r[o++]=e,r[o++]=s+n,r[o++]=a.r,r[o++]=a.g,r[o++]=a.b,r[o++]=a.a,r[o++]=0,r[o++]=0,this.twoColorTint&&(r[o++]=0,r[o++]=0,r[o++]=0,r[o++]=0),this.batcher.draw(t,r,this.QUAD_TRIANGLES)}drawTextureUV(t,e,s,i,n,a,r,o,l,h=null){this.enableRenderer(this.batcher),null===h&&(h=this.WHITE);let c=this.QUAD;var d=0;c[d++]=e,c[d++]=s,c[d++]=h.r,c[d++]=h.g,c[d++]=h.b,c[d++]=h.a,c[d++]=a,c[d++]=r,this.twoColorTint&&(c[d++]=0,c[d++]=0,c[d++]=0,c[d++]=0),c[d++]=e+i,c[d++]=s,c[d++]=h.r,c[d++]=h.g,c[d++]=h.b,c[d++]=h.a,c[d++]=o,c[d++]=r,this.twoColorTint&&(c[d++]=0,c[d++]=0,c[d++]=0,c[d++]=0),c[d++]=e+i,c[d++]=s+n,c[d++]=h.r,c[d++]=h.g,c[d++]=h.b,c[d++]=h.a,c[d++]=o,c[d++]=l,this.twoColorTint&&(c[d++]=0,c[d++]=0,c[d++]=0,c[d++]=0),c[d++]=e,c[d++]=s+n,c[d++]=h.r,c[d++]=h.g,c[d++]=h.b,c[d++]=h.a,c[d++]=a,c[d++]=l,this.twoColorTint&&(c[d++]=0,c[d++]=0,c[d++]=0,c[d++]=0),this.batcher.draw(t,c,this.QUAD_TRIANGLES)}drawTextureRotated(t,e,s,i,n,a,r,o,l=null,h=!1){this.enableRenderer(this.batcher),null===l&&(l=this.WHITE);let c=this.QUAD,d=e+a,u=s+r,m=-a,g=-r,f=i-a,p=n-r,w=m,x=g,b=m,y=p,v=f,A=p,E=f,S=g,M=0,I=0,T=0,C=0,P=0,k=0,V=0,N=0;if(0!=o){let t=R.cosDeg(o),e=R.sinDeg(o);M=t*w-e*x,I=e*w+t*x,V=t*b-e*y,N=e*b+t*y,P=t*v-e*A,k=e*v+t*A,T=P+(M-V),C=k+(I-N)}else M=w,I=x,V=b,N=y,P=v,k=A,T=E,C=S;M+=d,I+=u,T+=d,C+=u,P+=d,k+=u,V+=d,N+=u;var O=0;c[O++]=M,c[O++]=I,c[O++]=l.r,c[O++]=l.g,c[O++]=l.b,c[O++]=l.a,c[O++]=0,c[O++]=1,this.twoColorTint&&(c[O++]=0,c[O++]=0,c[O++]=0,c[O++]=0),c[O++]=T,c[O++]=C,c[O++]=l.r,c[O++]=l.g,c[O++]=l.b,c[O++]=l.a,c[O++]=1,c[O++]=1,this.twoColorTint&&(c[O++]=0,c[O++]=0,c[O++]=0,c[O++]=0),c[O++]=P,c[O++]=k,c[O++]=l.r,c[O++]=l.g,c[O++]=l.b,c[O++]=l.a,c[O++]=1,c[O++]=0,this.twoColorTint&&(c[O++]=0,c[O++]=0,c[O++]=0,c[O++]=0),c[O++]=V,c[O++]=N,c[O++]=l.r,c[O++]=l.g,c[O++]=l.b,c[O++]=l.a,c[O++]=0,c[O++]=0,this.twoColorTint&&(c[O++]=0,c[O++]=0,c[O++]=0,c[O++]=0),this.batcher.draw(t,c,this.QUAD_TRIANGLES)}drawRegion(t,e,s,i,n,a=null,r=!1){this.enableRenderer(this.batcher),null===a&&(a=this.WHITE);let o=this.QUAD;var l=0;o[l++]=e,o[l++]=s,o[l++]=a.r,o[l++]=a.g,o[l++]=a.b,o[l++]=a.a,o[l++]=t.u,o[l++]=t.v2,this.twoColorTint&&(o[l++]=0,o[l++]=0,o[l++]=0,o[l++]=0),o[l++]=e+i,o[l++]=s,o[l++]=a.r,o[l++]=a.g,o[l++]=a.b,o[l++]=a.a,o[l++]=t.u2,o[l++]=t.v2,this.twoColorTint&&(o[l++]=0,o[l++]=0,o[l++]=0,o[l++]=0),o[l++]=e+i,o[l++]=s+n,o[l++]=a.r,o[l++]=a.g,o[l++]=a.b,o[l++]=a.a,o[l++]=t.u2,o[l++]=t.v,this.twoColorTint&&(o[l++]=0,o[l++]=0,o[l++]=0,o[l++]=0),o[l++]=e,o[l++]=s+n,o[l++]=a.r,o[l++]=a.g,o[l++]=a.b,o[l++]=a.a,o[l++]=t.u,o[l++]=t.v,this.twoColorTint&&(o[l++]=0,o[l++]=0,o[l++]=0,o[l++]=0),this.batcher.draw(t.texture,o,this.QUAD_TRIANGLES)}line(t,e,s,i,n=null,a=null){this.enableRenderer(this.shapes),this.shapes.line(t,e,s,i,n)}triangle(t,e,s,i,n,a,r,o=null,l=null,h=null){this.enableRenderer(this.shapes),this.shapes.triangle(t,e,s,i,n,a,r,o,l,h)}quad(t,e,s,i,n,a,r,o,l,h=null,c=null,d=null,u=null){this.enableRenderer(this.shapes),this.shapes.quad(t,e,s,i,n,a,r,o,l,h,c,d,u)}rect(t,e,s,i,n,a=null){this.enableRenderer(this.shapes),this.shapes.rect(t,e,s,i,n,a)}rectLine(t,e,s,i,n,a,r=null){this.enableRenderer(this.shapes),this.shapes.rectLine(t,e,s,i,n,a,r)}polygon(t,e,s,i=null){this.enableRenderer(this.shapes),this.shapes.polygon(t,e,s,i)}circle(t,e,s,i,n=null,a=0){this.enableRenderer(this.shapes),this.shapes.circle(t,e,s,i,n,a)}curve(t,e,s,i,n,a,r,o,l,h=null){this.enableRenderer(this.shapes),this.shapes.curve(t,e,s,i,n,a,r,o,l,h)}end(){this.activeRenderer===this.batcher?this.batcher.end():this.activeRenderer===this.shapes&&this.shapes.end(),this.activeRenderer=null}resize(t){let e=this.canvas,s=0,i=0;if(e instanceof HTMLCanvasElement?(s=e.clientWidth,i=e.clientHeight):e instanceof OffscreenCanvas&&(s=e.width,i=e.height),e.width==s&&e.height==i||(e.width=s,e.height=i),this.context.gl.viewport(0,0,e.width,e.height),t===re.Stretch);else if(t===re.Expand)this.camera.setViewport(s,i);else if(t===re.Fit){let t=e.width,s=e.height,i=this.camera.viewportWidth,n=this.camera.viewportHeight,a=n/i<s/t?i/t:n/s;this.camera.viewportWidth=t*a,this.camera.viewportHeight=s*a}this.camera.update()}enableRenderer(t){this.activeRenderer!==t&&(this.end(),t instanceof le?(this.batcherShader.bind(),this.batcherShader.setUniform4x4f(qt.MVP_MATRIX,this.camera.projectionView.values),this.batcherShader.setUniformi("u_texture",0),this.batcher.begin(this.batcherShader),this.activeRenderer=this.batcher):t instanceof he?(this.shapesShader.bind(),this.shapesShader.setUniform4x4f(qt.MVP_MATRIX,this.camera.projectionView.values),this.shapes.begin(this.shapesShader),this.activeRenderer=this.shapes):this.activeRenderer=this.skeletonDebugRenderer)}dispose(){this.batcher.dispose(),this.batcherShader.dispose(),this.shapes.dispose(),this.shapesShader.dispose(),this.skeletonDebugRenderer.dispose()}}!function(t){t[t.Stretch=0]="Stretch",t[t.Expand=1]="Expand",t[t.Fit=2]="Fit"}(re||(re={}));class we{static FADE_SECONDS=1;static loaded=0;static spinnerImg=null;static logoImg=null;renderer;logo=null;spinner=null;angle=0;fadeOut=0;timeKeeper=new k;backgroundColor=new I(.135,.135,.135,1);tempColor=new I;firstDraw=0;static SPINNER_DATA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKMAAACjCAYAAADmbK6AAAAACXBIWXMAAAsTAAALEwEAmpwYAAALB2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNS41IChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTYtMDktMDhUMTQ6MjU6MTIrMDI6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTgtMTEtMTVUMTY6NDA6NTkrMDE6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE4LTExLTE1VDE2OjQwOjU5KzAxOjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpmZDhlNTljMC02NGJjLTIxNGQtODAyZi1jZDlhODJjM2ZjMGMiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDpmYmNmZWJlYS03MjY2LWE0NGQtOTI4NS0wOTJmNGNhYzk4ZWEiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHRpZmY6T3JpZW50YXRpb249IjEiIHRpZmY6WFJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpZUmVzb2x1dGlvbj0iNzIwMDAwLzEwMDAwIiB0aWZmOlJlc29sdXRpb25Vbml0PSIyIiBleGlmOkNvbG9yU3BhY2U9IjY1NTM1IiBleGlmOlBpeGVsWERpbWVuc2lvbj0iMjk3IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iMjQyIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiIHN0RXZ0OndoZW49IjIwMTYtMDktMDhUMTQ6MjU6MTIrMDI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1LjUgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiNThlMTlkNi0xYTRjLTQyNDEtODU0ZC01MDVlZjYxMjRhODQiIHN0RXZ0OndoZW49IjIwMTgtMTEtMTVUMTY6NDA6MjMrMDE6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjQ3YzYzYzIwLWJkYjgtYzM0YS1hYzMyLWQ5MDdjOWEyOTA0MCIgc3RFdnQ6d2hlbj0iMjAxOC0xMS0xNVQxNjo0MDo1OSswMTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY29udmVydGVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJmcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvcG5nIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJkZXJpdmVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJjb252ZXJ0ZWQgZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ZmQ4ZTU5YzAtNjRiYy0yMTRkLTgwMmYtY2Q5YTgyYzNmYzBjIiBzdEV2dDp3aGVuPSIyMDE4LTExLTE1VDE2OjQwOjU5KzAxOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo0N2M2M2MyMC1iZGI4LWMzNGEtYWMzMi1kOTA3YzlhMjkwNDAiIHN0UmVmOmRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo2OWRmZjljYy01YzFiLWE5NDctOTc3OS03ODgxZjM0ODk3MDMiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiLz4gPHBob3Rvc2hvcDpEb2N1bWVudEFu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";static SPINE_LOGO_DATA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKUAAABsCAYAAAALzHKmAAAACXBIWXMAAAsTAAALEwEAmpwYAAALB2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNS41IChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTYtMDktMDhUMTQ6MjU6MTIrMDI6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTgtMTEtMTVUMTY6NDA6NTkrMDE6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE4LTExLTE1VDE2OjQwOjU5KzAxOjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowMTdhZGQ3Ni04OTZlLThlNGUtYmM5MS00ZjEyNjI1YjA3MjgiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDplMTViNGE2ZS1hMDg3LWEzNDktODdhOS1mNDYzYjE2MzQ0Y2MiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHRpZmY6T3JpZW50YXRpb249IjEiIHRpZmY6WFJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpZUmVzb2x1dGlvbj0iNzIwMDAwLzEwMDAwIiB0aWZmOlJlc29sdXRpb25Vbml0PSIyIiBleGlmOkNvbG9yU3BhY2U9IjY1NTM1IiBleGlmOlBpeGVsWERpbWVuc2lvbj0iMjk3IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iMjQyIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiIHN0RXZ0OndoZW49IjIwMTYtMDktMDhUMTQ6MjU6MTIrMDI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1LjUgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiNThlMTlkNi0xYTRjLTQyNDEtODU0ZC01MDVlZjYxMjRhODQiIHN0RXZ0OndoZW49IjIwMTgtMTEtMTVUMTY6NDA6MjMrMDE6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjJlNjJiMWM2LWIxYzQtNDk0MC04MDMxLWU4ZDkyNTBmODJjNSIgc3RFdnQ6d2hlbj0iMjAxOC0xMS0xNVQxNjo0MDo1OSswMTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY29udmVydGVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJmcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvcG5nIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJkZXJpdmVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJjb252ZXJ0ZWQgZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MDE3YWRkNzYtODk2ZS04ZTRlLWJjOTEtNGYxMjYyNWIwNzI4IiBzdEV2dDp3aGVuPSIyMDE4LTExLTE1VDE2OjQwOjU5KzAxOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoyZTYyYjFjNi1iMWM0LTQ5NDAtODAzMS1lOGQ5MjUwZjgyYzUiIHN0UmVmOmRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo2OWRmZjljYy01YzFiLWE5NDctOTc3OS03ODgxZjM0ODk3MDMiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowODMzNWIyYy04NzYyLWQzNGMtOTBhOS02ODJjYjJmYTQ2M2UiLz4gPHBob3Rvc2hvcDpEb2N1bWVudEFu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";constructor(t){if(this.renderer=t,this.timeKeeper.maxDelta=9,null===we.logoImg){let t=navigator.userAgent.indexOf("Safari")>-1;we.logoImg=new Image,we.logoImg.src=we.SPINE_LOGO_DATA,t||(we.logoImg.crossOrigin="anonymous"),we.logoImg.onload=t=>{we.loaded++},we.spinnerImg=new Image,we.spinnerImg.src=we.SPINNER_DATA,t||(we.spinnerImg.crossOrigin="anonymous"),we.spinnerImg.onload=t=>{we.loaded++}}}draw(t=!1){if(t&&this.fadeOut>we.FADE_SECONDS)return;this.timeKeeper.update();let e=Math.abs(Math.sin(this.timeKeeper.totalTime+.75));this.angle-=this.timeKeeper.delta/1.4*360*(1+1.5*Math.pow(e,5));let s=this.renderer,i=s.canvas,n=s.context.gl;if(s.resize(re.Stretch),s.camera,t){if(this.fadeOut+=this.timeKeeper.delta*(this.timeKeeper.totalTime<1?2:1),this.fadeOut>we.FADE_SECONDS)return;e=1-this.fadeOut/we.FADE_SECONDS,this.tempColor.setFromColor(this.backgroundColor),this.tempColor.a=1-(e-1)*(e-1),s.begin();let t=i.width/2;s.quad(!0,0-t,0,i.width-t,0,i.width-t,i.height,0-t,i.height,this.tempColor,this.tempColor,this.tempColor,this.tempColor),s.end()}else n.clearColor(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.a),n.clear(n.COLOR_BUFFER_BIT),this.tempColor.a=1;if(this.tempColor.set(1,1,1,this.tempColor.a),2!=we.loaded)return;null===this.logo&&(this.logo=new E(s.context,we.logoImg),this.spinner=new E(s.context,we.spinnerImg)),this.logo.update(!1),this.spinner.update(!1);let a=this.logo.getImage().width,r=this.logo.getImage().height,o=this.spinner.getImage().width,l=this.spinner.getImage().height;s.batcher.setBlendMode(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),s.begin(),s.drawTexture(this.logo,-a/2,(i.height-r)/2,a,r,this.tempColor),s.drawTextureRotated(this.spinner,-o/2,(i.height-l)/2,o,l,o/2,l/2,this.angle,this.tempColor),s.end()}}class xe{static emptyAnimation=new J("<empty>",[],0);static SUBSEQUENT=0;static FIRST=1;static HOLD=2;static HOLD_MIX=3;static SETUP=1;static CURRENT=2;data;tracks=new Array;timeScale=1;unkeyedState=0;events=new Array;listeners=new Array;queue=new ye(this);propertyIDs=new M;animationsChanged=!1;trackEntryPool=new C((()=>new be));constructor(t){this.data=t}update(t){t*=this.timeScale;let e=this.tracks;for(let s=0,i=e.length;s<i;s++){let i=e[s];if(null==i)continue;i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast;let n=t*i.timeScale;if(i.delay>0){if(i.delay-=n,i.delay>0)continue;n=-i.delay,i.delay=0}let a=i.next;if(null!=a){let e=i.trackLast-a.delay;if(e>=0){for(a.delay=0,a.trackTime+=0==i.timeScale?0:(e/i.timeScale+t)*a.timeScale,i.trackTime+=n,this.setCurrent(s,a,!0);null!=a.mixingFrom;)a.mixTime+=t,a=a.mixingFrom;continue}}else if(i.trackLast>=i.trackEnd&&null==i.mixingFrom){e[s]=null,this.queue.end(i),this.disposeNext(i);continue}if(null!=i.mixingFrom&&this.updateMixingFrom(i,t)){let t=i.mixingFrom;for(i.mixingFrom=null,null!=t&&(t.mixingTo=null);null!=t;)this.queue.end(t),t=t.mixingFrom}i.trackTime+=n}this.queue.drain()}updateMixingFrom(t,e){let s=t.mixingFrom;if(null==s)return!0;let i=this.updateMixingFrom(s,e);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=s.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=s.mixingFrom,null!=s.mixingFrom&&(s.mixingFrom.mixingTo=t),t.interruptAlpha=s.interruptAlpha,this.queue.end(s)),i):(s.trackTime+=e*s.timeScale,t.mixTime+=e,!1)}apply(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();let e=this.events,s=this.tracks,i=!1;for(let a=0,r=s.length;a<r;a++){let r=s[a];if(null==r||r.delay>0)continue;i=!0;let o=0==a?d.first:r.mixBlend,l=r.alpha;null!=r.mixingFrom?l*=this.applyMixingFrom(r,t,o):r.trackTime>=r.trackEnd&&null==r.next&&(l=0);let h=r.animationLast,c=r.getAnimationTime(),m=r.animation.timelines.length,g=r.animation.timelines;if(0==a&&1==l||o==d.add)for(let s=0;s<m;s++){T.webkit602BugfixHelper(l,o);var n=g[s];n instanceof nt?this.applyAttachmentTimeline(n,t,c,o,!0):n.apply(t,h,c,e,l,o,u.mixIn)}else{let s=r.timelineMode,i=0==r.timelinesRotation.length;i&&T.setArraySize(r.timelinesRotation,m<<1,null);let n=r.timelinesRotation;for(let a=0;a<m;a++){let r=g[a],m=s[a]==xe.SUBSEQUENT?o:d.setup;r instanceof K?this.applyRotateTimeline(r,t,c,l,m,n,a<<1,i):r instanceof nt?this.applyAttachmentTimeline(r,t,c,o,!0):(T.webkit602BugfixHelper(l,o),r.apply(t,h,c,e,l,m,u.mixIn))}}this.queueEvents(r,c),e.length=0,r.nextAnimationLast=c,r.nextTrackLast=r.trackTime}for(var a=this.unkeyedState+xe.SETUP,r=t.slots,o=0,l=t.slots.length;o<l;o++){var h=r[o];if(h.attachmentState==a){var c=h.data.attachmentName;h.attachment=null==c?null:t.getAttachment(h.data.index,c)}}return this.unkeyedState+=2,this.queue.drain(),i}applyMixingFrom(t,e,s){let i=t.mixingFrom;null!=i.mixingFrom&&this.applyMixingFrom(i,e,s);let n=0;0==t.mixDuration?(n=1,s==d.first&&(s=d.setup)):(n=t.mixTime/t.mixDuration,n>1&&(n=1),s!=d.first&&(s=i.mixBlend));let a=n<i.eventThreshold?this.events:null,r=n<i.attachmentThreshold,o=n<i.drawOrderThreshold,l=i.animationLast,h=i.getAnimationTime(),c=i.animation.timelines.length,m=i.animation.timelines,g=i.alpha*t.interruptAlpha,f=g*(1-n);if(s==d.add)for(let t=0;t<c;t++)m[t].apply(e,l,h,a,f,s,u.mixOut);else{let t=i.timelineMode,n=i.timelineHoldMix,p=0==i.timelinesRotation.length;p&&T.setArraySize(i.timelinesRotation,c<<1,null);let w=i.timelinesRotation;i.totalAlpha=0;for(let x=0;x<c;x++){let c,b=m[x],y=u.mixOut,v=0;switch(t[x]){case xe.SUBSEQUENT:if(!o&&b instanceof lt)continue;c=s,v=f;break;case xe.FIRST:c=d.setup,v=f;break;case xe.HOLD:c=d.setup,v=g;break;default:c=d.setup;let t=n[x];v=g*Math.max(0,1-t.mixTime/t.mixDuration)}i.totalAlpha+=v,b instanceof K?this.applyRotateTimeline(b,e,h,v,c,w,x<<1,p):b instanceof nt?this.applyAttachmentTimeline(b,e,h,c,r):(T.webkit602BugfixHelper(v,s),o&&b instanceof lt&&c==d.setup&&(y=u.mixIn),b.apply(e,l,h,a,v,c,y))}}return t.mixDuration>0&&this.queueEvents(i,h),this.events.length=0,i.nextAnimationLast=h,i.nextTrackLast=i.trackTime,n}applyAttachmentTimeline(t,e,s,i,n){var a=e.slots[t.slotIndex];if(a.bone.active){var r,o=t.frames;s<o[0]?i!=d.setup&&i!=d.first||this.setAttachment(e,a,a.data.attachmentName,n):(r=s>=o[o.length-1]?o.length-1:J.binarySearch(o,s)-1,this.setAttachment(e,a,t.attachmentNames[r],n)),a.attachmentState<=this.unkeyedState&&(a.attachmentState=this.unkeyedState+xe.SETUP)}}setAttachment(t,e,s,i){e.attachment=null==s?null:t.getAttachment(e.data.index,s),i&&(e.attachmentState=this.unkeyedState+xe.CURRENT)}applyRotateTimeline(t,e,s,i,n,a,r,o){if(o&&(a[r]=0),1==i)return void t.apply(e,0,s,null,1,n,u.mixIn);let l=t,h=l.frames,c=e.bones[l.boneIndex];if(!c.active)return;let m=0,g=0;if(s<h[0])switch(n){case d.setup:c.rotation=c.data.rotation;default:return;case d.first:m=c.rotation,g=c.data.rotation}else if(m=n==d.setup?c.data.rotation:c.rotation,s>=h[h.length-K.ENTRIES])g=c.data.rotation+h[h.length+K.PREV_ROTATION];else{let t=J.binarySearch(h,s,K.ENTRIES),e=h[t+K.PREV_ROTATION],i=h[t],n=l.getCurvePercent((t>>1)-1,1-(s-i)/(h[t+K.PREV_TIME]-i));g=h[t+K.ROTATION]-e,g-=360*(16384-(16384.499999999996-g/360|0)),g=e+g*n+c.data.rotation,g-=360*(16384-(16384.499999999996-g/360|0))}let f=0,p=g-m;if(p-=360*(16384-(16384.499999999996-p/360|0)),0==p)f=a[r];else{let t=0,e=0;o?(t=0,e=p):(t=a[r],e=a[r+1]);let s=p>0,i=t>=0;R.signum(e)!=R.signum(p)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*R.signum(t)),i=s),f=p+t-t%360,i!=s&&(f+=360*R.signum(t)),a[r]=f}a[r+1]=p,m+=f*i,c.rotation=m-360*(16384-(16384.499999999996-m/360|0))}queueEvents(t,e){let s=t.animationStart,i=t.animationEnd,n=i-s,a=t.trackLast%n,r=this.events,o=0,l=r.length;for(;o<l;o++){let e=r[o];if(e.time<a)break;e.time>i||this.queue.event(t,e)}let h=!1;for(h=t.loop?0==n||a>t.trackTime%n:e>=i&&t.animationLast<i,h&&this.queue.complete(t);o<l;o++)r[o].time<s||this.queue.event(t,r[o])}clearTracks(){let t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;let e=this.tracks[t];if(null==e)return;this.queue.end(e),this.disposeNext(e);let s=e;for(;;){let t=s.mixingFrom;if(null==t)break;this.queue.end(t),s.mixingFrom=null,s.mixingTo=null,s=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,s){let i=this.expandToIndex(t);this.tracks[t]=e,null!=i&&(s&&this.queue.interrupt(i),e.mixingFrom=i,i.mixingTo=e,e.mixTime=0,null!=i.mixingFrom&&i.mixDuration>0&&(e.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,s){let i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,i,s)}setAnimationWith(t,e,s){if(null==e)throw new Error("animation cannot be null.");let i=!0,n=this.expandToIndex(t);null!=n&&(-1==n.nextTrackLast?(this.tracks[t]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.disposeNext(n),n=n.mixingFrom,i=!1):this.disposeNext(n));let a=this.trackEntry(t,e,s,n);return this.setCurrent(t,a,i),this.queue.drain(),a}addAnimation(t,e,s,i){let n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,n,s,i)}addAnimationWith(t,e,s,i){if(null==e)throw new Error("animation cannot be null.");let n=this.expandToIndex(t);if(null!=n)for(;null!=n.next;)n=n.next;let a=this.trackEntry(t,e,s,n);if(null==n)this.setCurrent(t,a,!0),this.queue.drain();else if(n.next=a,i<=0){let t=n.animationEnd-n.animationStart;0!=t?(n.loop?i+=t*(1+(n.trackTime/t|0)):i+=Math.max(t,n.trackTime),i-=this.data.getMix(n.animation,e)):i=n.trackTime}return a.delay=i,a}setEmptyAnimation(t,e){let s=this.setAnimationWith(t,xe.emptyAnimation,!1);return s.mixDuration=e,s.trackEnd=e,s}addEmptyAnimation(t,e,s){s<=0&&(s-=e);let i=this.addAnimationWith(t,xe.emptyAnimation,!1,s);return i.mixDuration=e,i.trackEnd=e,i}setEmptyAnimations(t){let e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,s=this.tracks.length;e<s;e++){let s=this.tracks[e];null!=s&&this.setEmptyAnimation(s.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(T.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,s,i){let n=this.trackEntryPool.obtain();return n.trackIndex=t,n.animation=e,n.loop=s,n.holdPrevious=!1,n.eventThreshold=0,n.attachmentThreshold=0,n.drawOrderThreshold=0,n.animationStart=0,n.animationEnd=e.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.interruptAlpha=1,n.mixTime=0,n.mixDuration=null==i?0:this.data.getMix(i.animation,e),n.mixBlend=d.replace,n}disposeNext(t){let e=t.next;for(;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();for(let t=0,e=this.tracks.length;t<e;t++){let e=this.tracks[t];if(null!=e){for(;null!=e.mixingFrom;)e=e.mixingFrom;do{null!=e.mixingFrom&&e.mixBlend==d.add||this.computeHold(e),e=e.mixingTo}while(null!=e)}}}computeHold(t){let e=t.mixingTo,s=t.animation.timelines,i=t.animation.timelines.length,n=T.setArraySize(t.timelineMode,i);t.timelineHoldMix.length=0;let a=T.setArraySize(t.timelineHoldMix,i),r=this.propertyIDs;if(null!=e&&e.holdPrevious)for(let t=0;t<i;t++)r.add(s[t].getPropertyId()),n[t]=xe.HOLD;else t:for(let o=0;o<i;o++){let i=s[o],l=i.getPropertyId();if(r.add(l))if(null==e||i instanceof nt||i instanceof lt||i instanceof ot||!e.animation.hasTimeline(l))n[o]=xe.FIRST;else{for(let s=e.mixingTo;null!=s;s=s.mixingTo)if(!s.animation.hasTimeline(l)){if(t.mixDuration>0){n[o]=xe.HOLD_MIX,a[o]=s;continue t}break}n[o]=xe.HOLD}else n[o]=xe.SUBSEQUENT}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){let e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}}class be{animation;next;mixingFrom;mixingTo;listener;trackIndex;loop;holdPrevious;eventThreshold;attachmentThreshold;drawOrderThreshold;animationStart;animationEnd;animationLast;nextAnimationLast;delay;trackTime;trackLast;nextTrackLast;trackEnd;timeScale;alpha;mixTime;mixDuration;interruptAlpha;totalAlpha;mixBlend=d.replace;timelineMode=new Array;timelineHoldMix=new Array;timelinesRotation=new Array;reset(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){let t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}}class ye{objects=[];drainDisabled=!1;animState;constructor(t){this.animState=t}start(t){this.objects.push(oe.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(oe.interrupt),this.objects.push(t)}end(t){this.objects.push(oe.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(oe.dispose),this.objects.push(t)}complete(t){this.objects.push(oe.complete),this.objects.push(t)}event(t,e){this.objects.push(oe.event),this.objects.push(t),this.objects.push(e)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;let t=this.objects,e=this.animState.listeners;for(let s=0;s<t.length;s+=2){let i=t[s],n=t[s+1];switch(i){case oe.start:null!=n.listener&&n.listener.start&&n.listener.start(n);for(let t=0;t<e.length;t++)e[t].start&&e[t].start(n);break;case oe.interrupt:null!=n.listener&&n.listener.interrupt&&n.listener.interrupt(n);for(let t=0;t<e.length;t++)e[t].interrupt&&e[t].interrupt(n);break;case oe.end:null!=n.listener&&n.listener.end&&n.listener.end(n);for(let t=0;t<e.length;t++)e[t].end&&e[t].end(n);case oe.dispose:null!=n.listener&&n.listener.dispose&&n.listener.dispose(n);for(let t=0;t<e.length;t++)e[t].dispose&&e[t].dispose(n);this.animState.trackEntryPool.free(n);break;case oe.complete:null!=n.listener&&n.listener.complete&&n.listener.complete(n);for(let t=0;t<e.length;t++)e[t].complete&&e[t].complete(n);break;case oe.event:let i=t[2+s++];null!=n.listener&&n.listener.event&&n.listener.event(n,i);for(let t=0;t<e.length;t++)e[t].event&&e[t].event(n,i)}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}!function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(oe||(oe={}));class ve{skeletonData;animationToMixTime={};defaultMix=0;constructor(t){if(null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,s){let i=this.skeletonData.findAnimation(t);if(null==i)throw new Error("Animation not found: "+t);let n=this.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);this.setMixWith(i,n,s)}setMixWith(t,e,s){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");let i=t.name+"."+e.name;this.animationToMixTime[i]=s}getMix(t,e){let s=t.name+"."+e.name,i=this.animationToMixTime[s];return void 0===i?this.defaultMix:i}}class Ae{static PLAY_ANIMATION="PLAY_ANIMATION";static WANDER="WANDER";static WALK_TO="WALK_TO";static PACE_AROUND="PACE_AROUND"}function Ee(t,e,s){const i=t.config.startPosY*s.height;t.setPositionY(i);let n=e.toLowerCase().includes("sit");t.canvasBB.y<0?(t.IsEnemySprite()||n)&&t.setPositionY(i-t.canvasBB.y):t.canvasBB.y>0&&t.IsEnemySprite()&&t.setPositionY(i-t.canvasBB.y)}class Se{actionData;startPosition;endPosition;currentAnimation;constructor(t){this.actionData=t,this.currentAnimation=null,this.endPosition=null}getRandomPosition(t,e){let s=e.width/2,i=Math.random();return new P(i*e.width-s,t.y)}SetAnimation(t,e,s){Ee(t,e,s),this.currentAnimation=e,this.currentAnimation.includes("Move")&&(this.startPosition=null,this.endPosition=null)}GetAnimations(){return this.actionData.animations}UpdatePhysics(t,e,s){if(this.currentAnimation.includes("Move")){null==this.endPosition&&(this.startPosition=t.getPosition(),this.endPosition=this.getRandomPosition(t.getPosition(),s));let i=this.endPosition.subtract(t.getPosition());i.length()<5&&(t.setPosition(this.endPosition.x,this.endPosition.y,0),this.startPosition=t.getPosition(),this.endPosition=this.getRandomPosition(t.getPosition(),s)),i.normalize(),t.setVelocity(i.x*t.getMovementSpeedX()*e,i.y*t.getMovementSpeedY()*e,0)}else t.setVelocity(0,0,0)}}class Me{actionData;startPosition=null;endPosition=null;constructor(t){this.actionData=t,this.startPosition=null,this.endPosition=null}getRandomPosition(t,e){let s=e.width/2;return new P(Math.random()*e.width-s,t.y)}SetAnimation(t,e,s){Ee(t,e,s)}GetAnimations(){return[this.actionData.wander_animation]}UpdatePhysics(t,e,s){null==this.endPosition&&(this.startPosition=t.getPosition(),this.endPosition=this.getRandomPosition(t.getPosition(),s));let i=this.endPosition.subtract(t.getPosition());i.length()<5&&(t.setPosition(this.endPosition.x,this.endPosition.y,0),this.startPosition=t.getPosition(),this.endPosition=this.getRandomPosition(t.getPosition(),s)),i.normalize(),t.setVelocity(i.x*t.getMovementSpeedX()*e,i.y*t.getMovementSpeedY()*e,0)}}class Ie{actionData;startPosition=null;endPosition=null;startDir=null;reachedDestination;constructor(t){this.actionData=t,this.startPosition=null,this.endPosition=null,this.startDir=null,this.reachedDestination=!1}SetAnimation(t,e,s){Ee(t,e,s)}GetAnimations(){return this.reachedDestination?[this.actionData.walk_to_final_animation]:[this.actionData.walk_to_animation]}UpdatePhysics(t,e,s){if(this.reachedDestination)return;if(null==this.endPosition){this.startPosition=t.getPosition();let e=new P(this.actionData.target_pos.x,this.actionData.target_pos.y);this.endPosition=new P(e.x*s.width-s.width/2,0),this.startDir=this.endPosition.subtract(this.startPosition),this.startDir.length()<10&&(this.reachedDestination=!0),this.startDir=this.startDir.normalize()}let i=this.endPosition.subtract(t.getPosition()).normalize(),n=this.startDir.angle(i);Math.abs(Math.PI-n)<.001||this.reachedDestination?(t.setPosition(this.endPosition.x,this.endPosition.y,0),this.startPosition=t.getPosition(),t.setVelocity(0,0,0),this.reachedDestination=!0,t.InitAnimationState()):t.setVelocity(i.x*t.getMovementSpeedX()*e,i.y*t.getMovementSpeedY()*e,0)}}class Re{actionData;startPosition=null;endPosition=null;reachedDestination;constructor(t){this.actionData=t,this.startPosition=null,this.endPosition=null,this.reachedDestination=!1}SetAnimation(t,e,s){Ee(t,e,s)}GetAnimations(){return[this.actionData.pace_around_animation]}UpdatePhysics(t,e,s){if(this.reachedDestination){this.reachedDestination=!1;let t=this.startPosition;return this.startPosition=this.endPosition,void(this.endPosition=t)}if(null==this.endPosition){let e=40*Math.random(),i=40*Math.random(),n=new kt(this.actionData.pace_start_pos.x,this.actionData.pace_start_pos.y,e),a=new kt(this.actionData.pace_end_pos.x,this.actionData.pace_end_pos.y,i);this.startPosition=new kt(n.x*s.width-s.width/2,n.y*s.height,n.z),this.endPosition=new kt(a.x*s.width-s.width/2,a.y*s.height,a.z),this.endPosition.copy().sub(t.getPosition3()).length()<10&&(this.reachedDestination=!0)}let i=this.endPosition.copy().sub(t.getPosition3()).normalize();this.endPosition.copy().sub(t.getPosition3()).length()<10||this.reachedDestination?(t.setPosition(this.endPosition.x,this.endPosition.y,this.endPosition.z),t.setVelocity(0,0,0),this.reachedDestination=!0):t.setVelocity(i.x*t.getMovementSpeedX()*e,i.y*t.getMovementSpeedY()*e,i.z*t.getMovementSpeedZ()*e)}}class Te{messages=[];constructor(t){this.messages=t}}class Ce{messages=[];currentMessage=null;showTimeRemaining=0;showing=!1;AddMessage(t){let e=t.split(/\s+/);e=e.flatMap((t=>t.length>30?t.match(new RegExp(".{1,30}","g")):t));let s=[],i="";for(let t of e)i.length+t.length+1>30?(s.push(i),i=t):i+=" "+t;""!=i&&s.push(i);for(let t=0;t<s.length;t+=3)this.messages.push(new Te(s.slice(t,t+3)))}HasMessages(){return this.messages.length>0}GetCurrentMessageBlock(){return this.currentMessage}Update(t){null!=this.currentMessage?this.showing&&(this.showTimeRemaining-=t,this.showTimeRemaining<=0&&(this.messages.length>0?(this.currentMessage=this.messages.shift(),this.showTimeRemaining=5):(this.showing=!1,this.currentMessage=null))):this.HasMessages()&&(this.currentMessage=this.messages.shift(),this.showTimeRemaining=5,this.showing=!0)}}class Pe{loaded;skeleton;animationState;time=new k;paused=!1;playTime=0;speed=1;config;lastAnimation=null;viewport=null;canvasBB=null;canvasBBCalculated=0;offscreenRender=null;movementSpeed=new kt;position=new kt;scale=new P(1,1);velocity=new kt(0,0,0);startPosition=null;currentAction=null;load_attempts=0;max_load_attempts=10;load_perma_failed=!1;loadedWhen=(new Date).getTime();messageQueue=new Ce;constructor(t,e,s){this.offscreenRender=s,this.loadedWhen=(new Date).getTime(),this.viewport=e,this.ResetWithConfig(t);let i=Math.random()*e.width-e.width/2;this.position=new kt(i,0,0),null==t.startPosX&&null==t.startPosY||(this.position=new kt(t.startPosX*e.width-e.width/2,t.startPosY*e.height,0))}getRenderingBoundingBox(){return this.canvasBB?{x:this.canvasBB.x,y:this.canvasBB.y,width:this.canvasBB.width,height:this.canvasBB.height}:{x:0,y:0,width:this.viewport.width/10,height:this.viewport.height/10}}getPosition(){return new P(this.position.x,this.position.y)}getPosition3(){return new kt(this.position.x,this.position.y,this.position.z)}getPositionX(){return this.position.x}getPositionY(){return this.position.y}getPositionZ(){return this.position.z}setPositionX(t){this.position.x=t}setPositionY(t){this.position.y=t}setPositionZ(t){this.position.z=t}setPosition(t,e,s){this.position.x=t,this.position.y=e,this.position.z=void 0!==s?s:0}getMovmentSpeed(){return new P(this.movementSpeed.x,this.movementSpeed.y)}getMovmentSpeed3(){return new kt(this.movementSpeed.x,this.movementSpeed.y,this.movementSpeed.z)}getMovementSpeedX(){return this.movementSpeed.x}getMovementSpeedY(){return this.movementSpeed.y}getMovementSpeedZ(){return this.movementSpeed.z}setMovementSpeedX(t){this.movementSpeed.x=t}setMovementSpeedY(t){this.movementSpeed.y=t}setMovementSpeedZ(t){this.movementSpeed.z=t}setMovementSpeed(t,e,s){this.movementSpeed.x=t,this.movementSpeed.y=e,this.movementSpeed.z=void 0!==s?s:this.config.defaultMovementSpeedPxZ}getVelocity(){return new P(this.velocity.x,this.velocity.y)}getVelocity3(){return new kt(this.velocity.x,this.velocity.y,this.velocity.z)}setVelocity(t,e,s){this.velocity=new kt(null!=t?t:this.velocity.x,null!=e?e:this.velocity.y,null!=s?s:this.velocity.z)}InitAnimations(){this.initAnimationsInternal(this.currentAction.GetAnimations())}GetAnimations(){return this.currentAction.GetAnimations()}ResetWithConfig(t){this.load_attempts=0,this.load_perma_failed=!1,this.loaded=!1,this.canvasBBCalculated=0,this.skeleton=null,this.animationState=null,this.time=new k,this.paused=!1,this.playTime=0,this.speed=1,this.config=t,null!==t.movementSpeedPxX&&null!==t.movementSpeedPxY&&null!==t.movementSpeedPxZ?this.movementSpeed=new kt(t.movementSpeedPxX,t.movementSpeedPxY,t.movementSpeedPxZ):this.movementSpeed=new kt(t.defaultMovementSpeedPxX+Math.random()*t.defaultMovementSpeedPxX/2,t.defaultMovementSpeedPxY,t.defaultMovementSpeedPxZ),this.scale.x=Math.sign(this.scale.x)*t.scaleX,this.scale.y=Math.sign(this.scale.y)*t.scaleY,this.currentAction=function(t,e){switch(t){case Ae.PLAY_ANIMATION:return new Se(e);case Ae.WANDER:return new Me(e);case Ae.WALK_TO:return new Ie(e);case Ae.PACE_AROUND:return new Re(e);default:return console.log("Unknown action name ",t),null}}(this.config.action,this.config.action_data)}UpdatePhysics(t,e){this.messageQueue.Update(t),this.currentAction.UpdatePhysics(this,t,e),this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.position.z+=this.velocity.z,0!=this.velocity.x&&(this.velocity.x>0?this.scale.x=this.config.scaleX:this.scale.x=-this.config.scaleX),this.setSkeletonMovementData(e)}InitAnimationState(){let t=this.skeleton.data,e=new ve(t);e.defaultMix=this.config.defaultMix,this.animationState=new xe(e),this.config.animation_listener&&(this.animationState.clearListeners(),this.animationState.addListener(this.config.animation_listener)),this.GetAnimations()&&this.animationState&&(this.animationState.getCurrent(0)||this.InitAnimations())}GetUsernameHeaderHeight(){let t=this.getRenderingBoundingBox();return t.height+t.y+10}IsEnemySprite(){return this.config.chibiId.startsWith("enemy_")}IsOperatorSprite(){return!this.IsEnemySprite()}IsOperatorSitting(){let t=this.GetAnimations();return!this.IsEnemySprite()&&t[0].toLowerCase().includes("sit")}EnqueueChatMessage(t){this.messageQueue.AddMessage(t)}GetChatMessages(){return this.messageQueue.GetCurrentMessageBlock()}setSkeletonMovementData(t){this.skeleton.x=this.position.x+this.config.extraOffsetX,this.skeleton.y=this.position.y+this.config.extraOffsetY,this.skeleton.scaleX=this.scale.x,this.skeleton.scaleY=this.scale.y}recordAnimation(t){this.currentAction.SetAnimation(this,t,this.viewport),this.lastAnimation=t}initAnimationsInternal(t){this.setAnimationState(t),this.recordAnimation(t[0]);let e=this.canvasBB.width,s=this.canvasBB.height;if(e>this.config.maxSizePx||s>this.config.maxSizePx){console.log("Resizing actor",this.config.chibiId,"to",this.config.maxSizePx);let i=e/s,n=0,a=0;s>e?(n=i*this.config.maxSizePx,a=this.config.maxSizePx):(n=this.config.maxSizePx,a=this.config.maxSizePx/i);let r=n*this.config.scaleX/e,o=a*this.config.scaleY/s;this.config.defaultScaleX=this.config.scaleX,this.config.defaultScaleY=this.config.scaleY,this.config.scaleX=r,this.config.scaleY=o,this.scale.x=Math.sign(this.scale.x)*this.config.scaleX,this.scale.y=Math.sign(this.scale.y)*this.config.scaleY,this.skeleton.scaleX=this.scale.x,this.skeleton.scaleY=this.scale.y,this.setAnimationState(t),this.recordAnimation(t[0])}}setAnimationState(t){let e=t[0];this.canvasBB=this.getCanvasBoundingBox(t),this.animationState.timeScale=this.config.animationPlaySpeed,this.animationState.clearTracks(),this.skeleton.setToSetupPose(),this.animationState.setAnimation(0,e,!0);let s=null;for(let e=1;e<t.length;e++)s=this.animationState.addAnimation(0,t[e],!1,0);s&&this.animationState.addListener({start:(t=>{this.recordAnimation(t.animation.name)}).bind(this),interrupt:function(t){},end:function(t){},complete:(i=>{if(null==i.next){this.animationState.setAnimation(0,e,!0);for(let e=1;e<t.length;e++)s=this.animationState.addAnimation(0,t[e],!1,0)}}).bind(this),dispose:function(t){},event:function(t,e){}})}getCanvasBoundingBox(t){let e=t[0],s=this.skeleton.x,i=this.skeleton.y,n=this.getPositionZ(),a=this.skeleton.scaleX,r=this.skeleton.scaleY,o=this.skeleton.data.findAnimation(e);this.animationState.clearTracks(),this.skeleton.setToSetupPose(),this.animationState.setAnimationWith(0,o,!0),this.skeleton.x=0,this.skeleton.y=0,this.setPositionZ(0),this.skeleton.scaleX=Math.abs(this.config.scaleX),this.skeleton.scaleY=Math.abs(this.config.scaleY),this.animationState.update(0),this.animationState.apply(this.skeleton),this.skeleton.updateWorldTransform();let l=new P,h=new P;this.skeleton.getBounds(l,h);let c={x:l.x,y:l.y,width:h.x,height:h.y},d={x:c.x,y:c.y,width:c.width,height:c.height};if(null!=this.offscreenRender){let t=this.offscreenRender.getBoundingBox(this,c);d.x=t.x,d.y=t.y,d.width=t.width,d.height=t.height}else{let t=c,e=200/.45*this.config.scaleX;this.IsOperatorSprite()?(Math.abs(t.y)>e&&(t.y=0),t.height>e&&(t.height=e),t.width>e&&(t.width=e)):this.IsEnemySprite()&&Math.abs(t.y),d.x=t.x,d.y=t.y,d.width=t.width,d.height=t.height}return this.skeleton.x=s,this.skeleton.y=i,this.setPositionZ(n),this.skeleton.scaleX=a,this.skeleton.scaleY=r,d}}class ke{defaultOffscreenCanvasWidth=800;defaultOffscreenCanvasHeight=800;offscreenCanvas;offscreenContext;offscreenSceneRenderer;constructor(t=null){try{this.offscreenCanvas=null!==t?t:new OffscreenCanvas(this.defaultOffscreenCanvasWidth,this.defaultOffscreenCanvasHeight),this.offscreenContext=new v(this.offscreenCanvas,{alpha:!0}),this.offscreenSceneRenderer=new pe(this.offscreenCanvas,this.offscreenContext,!0)}catch(t){console.log("Sorry, your browser does not support WebGL.<br><br>Please use the latest version of Firefox, Chrome, Edge, or Safari.")}}getBoundingBox(t,e){let s=this.offscreenContext.gl,i=(new I).setFromString("#00000000");s.clearColor(i.r,i.g,i.b,i.a),s.clear(s.COLOR_BUFFER_BIT),this.offscreenCanvas.width=e.width+2*Math.abs(e.x),this.offscreenCanvas.height=e.height+e.height+2*Math.abs(e.y),this.offscreenCanvas.height>3e3&&(this.offscreenCanvas.height=3e3),this.offscreenSceneRenderer.resize(re.Expand);let n={x:0,y:0,width:this.offscreenCanvas.width,height:this.offscreenCanvas.height};Ne(this.offscreenSceneRenderer.camera,t,n),this.offscreenSceneRenderer.camera.position.y=0,this.offscreenSceneRenderer.begin(),this.offscreenSceneRenderer.drawSkeleton(t.skeleton,t.config.premultipliedAlpha),this.offscreenSceneRenderer.end();let a=this.offscreenCanvas.width,r=this.offscreenCanvas.height,o=new Uint8Array(a*r*4);s.readPixels(0,0,a,r,s.RGBA,s.UNSIGNED_BYTE,o);let l=Number.POSITIVE_INFINITY,h=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=Number.NEGATIVE_INFINITY;for(let t=0;t<a;t++)for(let e=0;e<r;e++)255==o[4*(e*a+t)+3]&&(l=Math.min(l,t),h=Math.min(h,e),c=Math.max(c,t),d=Math.max(d,e));let u=new P,m=new P;return u.x=-(a/2-l),u.y=h-r/2,m.x=c-l,m.y=d-h,t.canvasBBCalculated+=1,console.log("actor canvasBBCalculated",t.config.userDisplayName,t.canvasBBCalculated),console.log(u,m,l,c,h,d),{x:u.x,y:u.y,width:m.x,height:m.y}}}function Ve(t,e,s,i){let n=t.width,a=t.height,r=new Jt(n,a);return r.near=e,r.far=s,r.fov=i,r.zoom=1,r.position.x=0,r.position.y=0,r.position.z=0,r.update(),n/2*-r.projectionView.values[Vt]}function Ne(t,e,s){t.position.x=0,t.position.y=s.height/2,t.position.z=-Ve(s,t.near,t.far,t.fov),t.position.z+=e.getPositionZ(),t.direction=new kt(0,0,-1),t.update()}function Oe(t,e){let s=new Array,i=(t,e,s)=>{for(var n=0;n<t.children.length;n++){let a=t.children[n];a.id===e&&s.push(a),i(a,e,s)}};return i(t,e,s),s}function Le(t,e){let s=new Array,i=(t,e,s)=>{for(var n=0;n<t.children.length;n++){let a=t.children[n];a.classList.contains(e)&&s.push(a),i(a,e,s)}};return i(t,e,s),s}function Ye(t){let e=document.createElement("div");return e.innerHTML=t,e.children[0]}function De(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&#34;").replace(/'/g,"&#39;"):""}function Fe(t){return/^[a-zA-Z0-9_-]{1,100}$/.test(t)}class Be{snaps;snapPercentage;big;slider;value;knob;change;constructor(t=0,e=.1,s=!1){this.snaps=t,this.snapPercentage=e,this.big=s}render(){this.slider=Ye(`\n\t\t\t\t<div class="spine-player-slider ${this.big?"big":""}">\n\t\t\t\t\t<div class="spine-player-slider-value"></div>\n\t\t\t\t\t\x3c!--<div class="spine-player-slider-knob"></div>--\x3e\n\t\t\t\t</div>\n\t\t\t`),this.value=Le(this.slider,"spine-player-slider-value")[0],this.setValue(0);let t=new Ct(this.slider);var e=!1;return t.addListener({down:(t,s)=>{e=!0,this.value.classList.add("hovering")},up:(t,s)=>{e=!1;let i=t/this.slider.clientWidth;i=i=Math.max(0,Math.min(i,1)),this.setValue(t/this.slider.clientWidth),this.change&&this.change(i),this.value.classList.remove("hovering")},moved:(t,s)=>{if(e){let e=t/this.slider.clientWidth;e=Math.max(0,Math.min(e,1)),e=this.setValue(t/this.slider.clientWidth),this.change&&this.change(e)}},dragged:(t,e)=>{let s=t/this.slider.clientWidth;s=Math.max(0,Math.min(s,1)),s=this.setValue(t/this.slider.clientWidth),this.change&&this.change(s)}}),this.slider}setValue(t){if(t=Math.max(0,Math.min(1,t)),this.snaps>0){let e=t%(1/this.snaps);e<1/this.snaps*this.snapPercentage?t-=e:e>1/this.snaps-1/this.snaps*this.snapPercentage&&(t=t-e+1/this.snaps),t=Math.max(0,Math.min(1,t))}return this.value.style.width=100*t+"%",t}}class Xe{static HOVER_COLOR_INNER=new I(.478,0,0,.25);static HOVER_COLOR_OUTER=new I(1,1,1,1);static NON_HOVER_COLOR_INNER=new I(.478,0,0,.5);static NON_HOVER_COLOR_OUTER=new I(1,0,0,.8);sceneRenderer;dom;playerControls;canvas;textCanvas;textCanvasContext;timelineSlider;playButton;context;loadingScreen;assetManager;paused=!1;actors=new Map;playerConfig=null;parent;stopRequestAnimationFrame=!1;lastRequestAnimationFrameId=0;windowFpsFrameCount=0;webSocket=null;renderCallbacks=[];actorQueue=[];actorQueueIndex=null;offscreenRender=null;constructor(t,e){this.parent="string"==typeof t?document.getElementById(t):t,this.playerConfig=this.validatePlayerConfig(e),this.parent.appendChild(this.setupDom())}setWebsocket(t){this.webSocket=t}validatePlayerConfig(t){if(!t)throw new Error("Please pass a configuration to new.SpinePlayer().");return t.alpha||(t.alpha=!1),t.backgroundColor||(t.backgroundColor="#000000"),t.fullScreenBackgroundColor||(t.fullScreenBackgroundColor=t.backgroundColor),void 0===t.showControls&&(t.showControls=!0),t.runtimeDebugInfoDumpIntervalSec||(t.runtimeDebugInfoDumpIntervalSec=60),t.textSize||(t.textSize=14),t.textFont||(t.textFont="lato"),t.cameraPerspectiveNear||(t.cameraPerspectiveNear=1),t.cameraPerspectiveFar||(t.cameraPerspectiveFar=1e3),t.useAccurateBoundingBox||(t.useAccurateBoundingBox=!1),t}validateActorConfig(t){if(!t)throw new Error("Please pass a configuration to new.SpinePlayer().");if(!t.jsonUrl&&!t.skelUrl)throw new Error("Please specify the URL of the skeleton JSON or .skel file.");if(!t.atlasUrl)throw new Error("Please specify the URL of the atlas file.");if(void 0===t.premultipliedAlpha&&(t.premultipliedAlpha=!0),t.scaleX||(t.scaleX=1),t.scaleY||(t.scaleY=1),t.extraOffsetX||(t.extraOffsetX=0),t.extraOffsetY||(t.extraOffsetY=0),t.success||(t.success=(t,e)=>{}),t.error||(t.error=(t,e,s)=>{}),t.animation_listener||(t.animation_listener={event:function(t,e){},complete:function(t){},start:function(t){},end:function(t){},interrupt:function(t){},dispose:function(t){}}),t.skins&&t.skin&&t.skins.indexOf(t.skin)<0)throw new Error("Default skin '"+t.skin+"' is not contained in the list of selectable skins "+De(JSON.stringify(t.skins))+".");if(void 0===t.defaultMix&&(t.defaultMix=.25),null==t.configScaleX&&(t.configScaleX=1),null==t.configScaleY&&(t.configScaleY=1),null==t.scaleX&&(t.scaleX=.45),null==t.scaleY&&(t.scaleY=.45),null==t.maxSizePx&&(t.maxSizePx=350),null==t.startPosX&&(t.startPosX=null),null==t.startPosY&&(t.startPosY=null),null==t.extraOffsetX&&(t.extraOffsetX=0),null==t.extraOffsetY&&(t.extraOffsetY=0),null==t.defaultMovementSpeedPxX&&(t.defaultMovementSpeedPxX=80),null==t.defaultMovementSpeedPxY&&(t.defaultMovementSpeedPxY=80),null==t.defaultMovementSpeedPxZ&&(t.defaultMovementSpeedPxZ=80),null==t.movementSpeedPxX&&(t.movementSpeedPxX=null),null==t.movementSpeedPxY&&(t.movementSpeedPxY=null),null==t.movementSpeedPxZ&&(t.movementSpeedPxZ=t.defaultMovementSpeedPxZ),null==t.chibiId&&(t.chibiId=crypto.randomUUID()),null==t.userDisplayName&&(t.userDisplayName=crypto.randomUUID()),!Fe(t.chibiId))throw Error("ChibiId is not valid");if(!Fe(t.userDisplayName))throw Error("userDisplayName is not valid");if(null==t.action)throw Error("config.action must be set");return t}showError(t,e){let s=Le(this.dom,"spine-player-error")[0];s.classList.remove("spine-player-hidden"),s.innerHTML=`<p style="text-align: center; align-self: center;">${e}</p>`,t.config.error(this,t,e)}hideError(){Le(this.dom,"spine-player-error")[0].classList.add("spine-player-hidden")}setupDom(){let t=this.dom=Ye('\n\t\t\t\t<div class="spine-player">\n\t\t\t\t\t<div class="spine-player-error spine-player-hidden"></div>\n\t\t\t\t\t<canvas id="spine-canvas" class="spine-player-canvas"></canvas>\n\t\t\t\t\t<canvas id="spine-text" class="spine-player-text-canvas"></canvas>\n\t\t\t\t\t<div class="spine-player-controls spine-player-popup-parent spine-player-controls-hidden">\n\t\t\t\t\t\t<div class="spine-player-timeline">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="spine-player-buttons">\n\t\t\t\t\t\t\t<button id="spine-player-button-play-pause" class="spine-player-button spine-player-button-icon-pause"></button>\n\t\t\t\t\t\t\t<div class="spine-player-button-spacer"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t');try{this.canvas=Oe(t,"spine-canvas")[0],this.textCanvas=Oe(t,"spine-text")[0],this.textCanvasContext=this.textCanvas.getContext("2d");var e={alpha:this.playerConfig.alpha};this.context=new v(this.canvas,e),this.sceneRenderer=new pe(this.canvas,this.context,!0),this.loadingScreen=new we(this.sceneRenderer),this.playerConfig.useAccurateBoundingBox?(this.offscreenRender=new ke,this.assetManager=new S([this.context,this.offscreenRender.offscreenContext])):(this.offscreenRender=null,this.assetManager=new S([this.context]))}catch(e){return console.log("Sorry, your browser does not support WebGL.<br><br>Please use the latest version of Firefox, Chrome, Edge, or Safari."),t}var s,i,n,a;s=this.sceneRenderer.camera,i=this.playerConfig.cameraPerspectiveNear,n=this.playerConfig.cameraPerspectiveFar,a=this.playerConfig.viewport,s.near=i,s.far=n,s.zoom=1,s.position.x=0,s.position.y=a.height/2,s.position.z=-Ve(a,s.near,s.far,s.fov),s.direction=new kt(0,0,-1),s.update(),this.lastRequestAnimationFrameId=requestAnimationFrame((()=>this.drawFrame())),performance.mark("fps_window_start"),this.windowFpsFrameCount=0,this.playerConfig.runtimeDebugInfoDumpIntervalSec>0&&setInterval((()=>this.callbackSendRuntimeUpdateInfo()),1e3*this.playerConfig.runtimeDebugInfoDumpIntervalSec),this.playerControls=Le(t,"spine-player-controls")[0];let r=Le(t,"spine-player-timeline")[0];return this.timelineSlider=new Be,r.appendChild(this.timelineSlider.render()),this.playButton=Oe(t,"spine-player-button-play-pause")[0],this.playButton.onclick=()=>{this.paused?this.play():this.pause()},window.onresize=()=>{this.drawFrame(!1)},this.setupInput(),t}callbackSendRuntimeUpdateInfo(){performance.mark("fps_window_end");const t=performance.measure("fps_window_time","fps_window_start","fps_window_end"),e=this.windowFpsFrameCount/(t.duration/1e3);if(null!=this.webSocket){const t=JSON.stringify({type_name:"RUNTIME_DEBUG_UPDATE",average_fps:e});this.webSocket.send(t)}performance.mark("fps_window_start"),this.windowFpsFrameCount=0}addActorToUpdateQueue(t,e){this.actorQueue.push({actorName:t,config:e}),null==this.actorQueueIndex&&(this.actorQueueIndex=setTimeout((()=>this.consumeActorUpdateQueue()),100))}consumeActorUpdateQueue(){if(console.log("actorUpdateQueue: ",this.actorQueue.length),0==this.actorQueue.length)return void(this.actorQueueIndex=null);if(!this.assetManager.isLoadingComplete())return void(this.actorQueueIndex=setTimeout((()=>this.consumeActorUpdateQueue()),100));let t=this.actorQueue.shift();this.changeOrAddActor(t.actorName,t.config),this.actorQueueIndex=setTimeout((()=>this.consumeActorUpdateQueue()),100)}changeOrAddActor(t,e){if(this.actors.has(t)){let s=this.actors.get(t);s.ResetWithConfig(e),this.setupActor(s)}else{let s=new Pe(e,this.playerConfig.viewport,this.offscreenRender);this.setupActor(s),this.actors.set(t,s)}}getActor(t){return this.actors.get(t)}getActorNames(){return Array.from(this.actors.keys())}removeActor(t){this.actors.delete(t)}showChatMessage(t,e){this.actors.has(t)&&this.actors.get(t).EnqueueChatMessage(e)}setupActor(t){let e=t.config;try{t.config=this.validateActorConfig(t.config)}catch(e){return void this.showError(t,e)}if(e.rawDataURIs)for(let t in e.rawDataURIs){let s=e.rawDataURIs[t];this.assetManager.setRawDataURI(t,s)}e.jsonUrl?this.assetManager.loadText(e.jsonUrl):this.assetManager.loadBinary(e.skelUrl),this.assetManager.loadTextureAtlas(e.atlasUrl),e.backgroundImage&&e.backgroundImage.url&&this.assetManager.loadTexture(e.backgroundImage.url)}updateCameraSettings(t,e,s){Ne(t,e,s)}drawText(t,e,s){let i=this.playerConfig.viewport,n=this.sceneRenderer.camera.worldToScreen(new kt(e,s,0)),a=new P(n.x,n.y);a.y=i.height-a.y,e=a.x,s=a.y;let r=this.textCanvasContext;r.save(),r.translate(e,s),r.font=this.playerConfig.textSize+"px "+this.playerConfig.textFont,r.textBaseline="bottom";let o=0,l=0,h=[];for(let e=0;e<t.length;e++){let s=r.measureText(t[e]),i=s.actualBoundingBoxAscent-s.actualBoundingBoxDescent,n=s.width;o=Math.max(o,n),l+=i,h.push(i)}r.beginPath(),r.fillStyle="black",r.strokeStyle="#333",r.lineWidth=5,r.roundRect(-o/2-5,5,o+10,-l-10,3),r.stroke(),r.fill(),r.beginPath(),r.fillStyle="black",r.moveTo(-5,5),r.lineTo(0,10),r.lineTo(5,5),r.closePath(),r.fill(),r.beginPath(),r.strokeStyle="#333",r.lineWidth=2,r.moveTo(-5,5),r.lineTo(0,10),r.lineTo(5,5),r.stroke(),r.closePath(),r.fillStyle="white";let c=-l;for(let e=0;e<t.length;e++){c+=h[e];let s=t[e];r.fillText(s,-o/2,c)}r.restore()}drawFrame(t=!0){t&&!this.stopRequestAnimationFrame&&(this.lastRequestAnimationFrameId=requestAnimationFrame((()=>this.drawFrame())));let e=this.context.gl;var s=document,i=s.fullscreenElement||s.webkitFullscreenElement||s.mozFullScreenElement||s.msFullscreenElement;let n=(new I).setFromString(i?this.playerConfig.fullScreenBackgroundColor:this.playerConfig.backgroundColor);e.clearColor(n.r,n.g,n.b,n.a),e.clear(e.COLOR_BUFFER_BIT),this.textCanvas.width=this.textCanvas.clientWidth,this.textCanvas.height=this.textCanvas.clientHeight,this.textCanvasContext.clearRect(0,0,this.textCanvas.width,this.textCanvas.height),this.sceneRenderer.resize(re.Expand);let a=Array.from(this.actors.keys()).sort(((t,e)=>{let s=this.actors.get(t),i=this.actors.get(e),n=i.getPositionZ()-s.getPositionZ();return 0==n?s.loadedWhen-i.loadedWhen:n})),r=!0;for(let t of a){let e=this.actors.get(t);if(e.load_perma_failed)continue;if(this.assetManager.isLoadingComplete()&&null==e.skeleton&&this.loadSkeleton(e),!e.loaded){r=!1;continue}let s=this.playerConfig.viewport;if(!e.paused&&e.GetAnimations().length>0){e.time.update();let t=e.time.delta*e.speed,i=e.animationState.getCurrent(0).animation.duration;for(e.playTime+=t;e.playTime>=i&&0!=i;)e.playTime-=i;e.playTime=Math.max(0,Math.min(e.playTime,i)),this.timelineSlider.setValue(e.playTime/i),e.UpdatePhysics(t,s),e.skeleton.setToSetupPose(),e.animationState.update(t),e.animationState.apply(e.skeleton)}if(e.skeleton.updateWorldTransform(),this.updateCameraSettings(this.sceneRenderer.camera,e,s),this.sceneRenderer.begin(),e.config.backgroundImage&&e.config.backgroundImage.url){let t=this.assetManager.get(e.config.backgroundImage.url);e.config.backgroundImage.hasOwnProperty("x")&&e.config.backgroundImage.hasOwnProperty("y")&&e.config.backgroundImage.hasOwnProperty("width")&&e.config.backgroundImage.hasOwnProperty("height")?this.sceneRenderer.drawTexture(t,e.config.backgroundImage.x,e.config.backgroundImage.y,e.config.backgroundImage.width,e.config.backgroundImage.height):this.sceneRenderer.drawTexture(t,s.x,s.y,s.width,s.height)}if(this.sceneRenderer.drawSkeleton(e.skeleton,e.config.premultipliedAlpha),this.drawActorText(e),this.sceneRenderer.end(),this.playerConfig.viewport.debugRender){this.sceneRenderer.begin();let t=e.getPosition(),s=e.getRenderingBoundingBox();this.sceneRenderer.rect(!1,t.x+s.x,t.y+s.y,s.width,s.height,I.RED),this.sceneRenderer.rect(!1,0,0,e.config.maxSizePx,e.config.maxSizePx,I.ORANGE),this.sceneRenderer.circle(!0,t.x,t.y,10,I.RED),this.sceneRenderer.circle(!0,0,0,10,I.BLUE),this.sceneRenderer.end()}}this.broadcastRenderCallback(),r&&(this.assetManager.clearErrors(),this.hideError()),this.windowFpsFrameCount+=1}drawActorText(t){let e=t.GetChatMessages();e?this.drawText(e.messages,t.getPositionX(),t.getPositionY()+t.GetUsernameHeaderHeight()):this.drawText([t.config.userDisplayName],t.getPositionX(),t.getPositionY()+t.GetUsernameHeaderHeight())}registerRenderCallback(t){return this.renderCallbacks.push(t),()=>{this.renderCallbacks=this.renderCallbacks.filter((e=>e!==t))}}broadcastRenderCallback(){for(let t=0;t<this.renderCallbacks.length;t++)this.renderCallbacks[t](this.context)}scale(t,e,s,i){let n=i/s>e/t?s/t:i/e,a=new P;return a.x=t*n,a.y=e*n,a}loadSkeleton(t){if(t.loaded||t.load_perma_failed)return;if(this.assetManager.hasErrors())return void this.showError(t,"Error: assets could not be loaded.<br><br>"+De(JSON.stringify(this.assetManager.getErrors())));let e,s=this.assetManager.get(t.config.atlasUrl);if(t.config.jsonUrl){let i=this.assetManager.get(t.config.jsonUrl),n=new Rt(new X(s));try{e=n.readSkeletonData(i)}catch(e){return void this.showError(t,"Error: could not load skeleton .json.<br><br>"+De(JSON.stringify(e)))}}else{let i=this.assetManager.get(t.config.skelUrl),n=new Et(new X(s));try{e=n.readSkeletonData(i)}catch(e){return void this.showError(t,"Error: could not load skeleton .skel.<br><br>"+De(JSON.stringify(e)))}}if(t.skeleton=new Q(e),t.config.skin||e.skins.length>0&&(t.config.skin=e.skins[0].name),t.config.skins&&t.config.skin.length>0&&t.config.skins.forEach((e=>{t.skeleton.data.findSkin(e)||this.showError(t,`Error: skin '${e}' in selectable skin list does not exist in skeleton.`)})),t.config.skin){if(!t.skeleton.data.findSkin(t.config.skin))return void this.showError(t,`Error: skin '${t.config.skin}' does not exist in skeleton.`);t.skeleton.setSkinByName(t.config.skin),t.skeleton.setSlotsToSetupPose()}t.InitAnimationState(),t.config.success(this,t),t.loaded=!0}cancelId=0;setupInput(){let t=this.canvas;new Ct(t).addListener({down:(t,e)=>{},dragged:(t,e)=>{},moved:(t,e)=>{},up:(t,e)=>{this.playerConfig.showControls&&(this.paused?this.play():this.pause())}});var e=!0,s=!1;document.addEventListener("mousemove",(t=>{t instanceof MouseEvent&&i(t.clientX,t.clientY)})),document.addEventListener("touchmove",(t=>{if(t instanceof TouchEvent){var e=t.changedTouches;if(e.length>0){var s=e[0];i(s.clientX,s.clientY)}}}));let i=(t,i)=>{if(!this.playerConfig.showControls)return;let a=Le(this.dom,"spine-player-popup");if(e=n(t,i,this.playerControls.getBoundingClientRect()),s=n(t,i,this.canvas.getBoundingClientRect()),clearTimeout(this.cancelId),0!=a.length||e||s||this.paused?this.playerControls.classList.remove("spine-player-controls-hidden"):this.playerControls.classList.add("spine-player-controls-hidden"),!e&&0==a.length&&!this.paused){let t=()=>{this.paused||this.playerControls.classList.add("spine-player-controls-hidden")};this.cancelId=setTimeout(t,1e3)}},n=(t,e,s)=>{let i=t-s.left,n=e-s.top;return i>=0&&i<=s.width&&n>=0&&n<=s.height}}play(){this.paused=!1,this.cancelId=setTimeout((()=>{this.paused||this.playerControls.classList.add("spine-player-controls-hidden")}),1e3),this.playButton.classList.remove("spine-player-button-icon-play"),this.playButton.classList.add("spine-player-button-icon-pause");for(let[t,e]of this.actors)e.paused=!1,e.animationState&&(e.animationState.getCurrent(0)||e.InitAnimations())}pause(){this.paused=!0,this.playerControls.classList.remove("spine-player-controls-hidden"),clearTimeout(this.cancelId),this.playButton.classList.remove("spine-player-button-icon-pause"),this.playButton.classList.add("spine-player-button-icon-play");for(let[t,e]of this.actors)e.paused=!0}getSceneRenderer(){return this.sceneRenderer}}class _e{socket;spinePlayer;spinePlayerConfig;actorConfig;defaultBackoffTimeMsec;backoffTimeMsec;backOffMaxtimeMsec;channelName;runtimeConfig;constructor(t,e){this.runtimeConfig=e;const{width:s,height:i,debugMode:n,chibiScale:a}=e;let r=new FontFace("lato","url(/public/fonts/Lato/Lato-Black.ttf)");r.load().then((()=>{document.fonts.add(r)})),this.channelName=t,this.socket=null,this.spinePlayer=null,this.defaultBackoffTimeMsec=15e3,this.backoffTimeMsec=15e3,this.backOffMaxtimeMsec=3e5,this.openWebSocket(this.channelName),null==this.spinePlayer&&(this.spinePlayerConfig={backgroundColor:"#00000000",alpha:!0,showControls:!0,viewport:{x:0,y:0,width:s,height:i,padLeft:0,padRight:0,padTop:0,padBottom:0,debugRender:n},fullScreenBackgroundColor:null,backgroundImage:null,textSize:14,textFont:"lato",runtimeDebugInfoDumpIntervalSec:60,chibiScale:this.runtimeConfig.chibiScale,useAccurateBoundingBox:this.runtimeConfig.accurateBoundingBoxFlag,cameraPerspectiveNear:1,cameraPerspectiveFar:2e3},console.log("Creating a new spine player"),this.spinePlayer=new Xe("container",this.spinePlayerConfig))}openWebSocket(t){const e=("https:"===window.location.protocol?"wss:":"ws:")+"//"+location.host+`/ws/?channelName=${t}`;console.log("Openning websocket"),this.socket=new WebSocket(e),this.socket.addEventListener("open",(t=>{console.log("Socket opened"),this.backoffTimeMsec=this.defaultBackoffTimeMsec,this.spinePlayer.setWebsocket(this.socket)})),this.socket.addEventListener("message",this.messageHandler.bind(this)),this.socket.addEventListener("close",(t=>{console.log("Close received: ",t),this.spinePlayer.setWebsocket(null),this.backoffTimeMsec*=2,this.backoffTimeMsec<this.backOffMaxtimeMsec&&(console.log("Retrying in "+this.backoffTimeMsec+"ms"),setTimeout((()=>this.openWebSocket(this.channelName)),this.backoffTimeMsec))})),this.socket.addEventListener("error",(t=>{console.log("Error received: ",t)}))}messageHandler(t){let e=JSON.parse(t.data);"SET_OPERATOR"==e.type_name?(console.log("Message received: ",e),this.swapCharacter(e)):"REMOVE_OPERATOR"==e.type_name?(console.log("Message received: ",e),this.removeCharacter(e)):"SHOW_CHAT_MESSAGE"==e.type_name&&this.showChatMessage(e)}swapCharacter(t){let e=t.user_name,s=null,i=null;null!=t.start_pos&&(s=t.start_pos.x,i=t.start_pos.y);let n=1,a=1;null!=t.sprite_scale&&(n=t.sprite_scale.x,a=t.sprite_scale.y);let r=350;null!=t.max_sprite_pixel_size&&(r=t.max_sprite_pixel_size);let o=80,l=80;null!=t.movement_speed_px&&(o=t.movement_speed_px),null!=t.movement_speed_py&&(o=t.movement_speed_py),null!=t.movement_speed_pz&&(l=t.movement_speed_pz);let h=null,c=null,d=l;null!=t.movement_speed&&(h=Math.floor(t.movement_speed.x*o),c=Math.floor(80*t.movement_speed.y));let u=o,m=l;this.actorConfig={chibiId:t.operator_id,userDisplayName:t.user_name_display,skelUrl:t.skel_file,atlasUrl:t.atlas_file,startPosX:s,startPosY:i,defaultMovementSpeedPxX:u,defaultMovementSpeedPxY:80,defaultMovementSpeedPxZ:m,movementSpeedPxX:h,movementSpeedPxY:c,movementSpeedPxZ:d,configScaleX:n,configScaleY:a,scaleX:.45*this.runtimeConfig.chibiScale*n,scaleY:.45*this.runtimeConfig.chibiScale*a,maxSizePx:r,premultipliedAlpha:!0,animationPlaySpeed:t.animation_speed?t.animation_speed:1,extraOffsetX:0,extraOffsetY:0,action:t.action,action_data:t.action_data,success:(t,e)=>{},error:(t,e,s)=>{e.load_attempts+=1,e.load_attempts>e.max_load_attempts&&(e.load_perma_failed=!0),console.log(this),console.log(s)}},this.spinePlayer.addActorToUpdateQueue(e,this.actorConfig)}removeCharacter(t){this.spinePlayer&&this.spinePlayer.removeActor(t.user_name)}showChatMessage(t){this.spinePlayer&&this.spinePlayer.showChatMessage(t.user_name,t.message)}}},169:(t,e,s)=>{function i(t){const e="true"===t.get("debug"),s="true"===t.get("accurate_bb"),i=Math.max(Math.min(parseFloat(t.get("scale"))||1,3),.1),[n,a]=function(t){let e=t.has("width")?Number.parseInt(t.get("width")):1920,s=t.has("height")?Number.parseInt(t.get("height")):1080,i=document.getElementById("container");return Number.isInteger(e)||(e=1920),Number.isInteger(s)||(s=1080),e=Math.max(e,0),s=Math.max(s,0),console.log(e,s),i.style.width=`${e}px`,i.style.height=`${s}px`,[e,s]}(t);return{width:n,height:a,debugMode:e,chibiScale:i,accurateBoundingBoxFlag:s}}s.d(e,{T:()=>i})}}]);
//# sourceMappingURL=682.7565b62e6bc09a95430f.js.map